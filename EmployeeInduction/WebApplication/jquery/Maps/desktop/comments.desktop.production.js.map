{"version":3,"sources":["jquery/workportal/desktop/widget/project.dashboard.menu.activity/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.discussions/bizagi.workportal.desktop.widgets.project.discussions.js","jquery/workportal/desktop/widget/project.discussion.sidebar/bizagi.workportal.desktop.widgets.project.discussion.sidebar.js","jquery/workportal/desktop/widget/project.caseState/bizagi.workportal.desktop.widgets.project.caseState.js","jquery/workportal/desktop/widget/project.activityState/bizagi.workportal.desktop.widgets.project.activityState.js","jquery/workportal/desktop/widget/project.processState/bizagi.workportal.desktop.widgets.project.processState.js","jquery/workportal/desktop/widget/project.users/bizagi.workportal.desktop.widgets.project.users.js","jquery/workportal/desktop/widget/project.subprocesses.data/bizagi.workportal.desktop.widgets.project.subprocesses.data.js","jquery/workportal/desktop/widget/project.events/bizagi.workportal.desktop.widgets.project.events.js","jquery/workportal/desktop/widget/project.subprocesses/bizagi.workportal.desktop.widgets.project.subprocesses.js","jquery/workportal/desktop/widget/project.activity.description/bizagi.workportal.project.activity.description.js"],"names":["bizagi","workportal","widgets","widget","extend","init","workportalFacade","dataService","params","self","this","_super","loadTemplates","project-dashboard-menu","getTemplate","concat","renderContent","content","$","postRender","contextsLeftSidebarCaseDashboard","forEach","context","sub","proxy","updateView","event","args","plan","idActivitySelected","undefined","clean","$content","getContent","empty","type","showContextByMenuDashboard","argsTemplate","showFormOverview","menuDashboard","showFormActivity","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isAdhocProcess","util","isEnableFeature","showPlanOptionMenu","contextPlanOptionMenu","contextFormActivityOptionMenu","render","appendTo","toUpperCase","addClass","siblings","removeClass","handlerEvents","loadContentById","preventDefault","$item","target","closest","hasClass","data","when","autoSave","done","document","getLevelNavigator","pub","currentLevelNavigator","parseInt","nameItemNavigator","newLevelNavigator","localization","getResource","refreshLastItemBreadcrumb","histName","level","subMenuHandler","$comments","$files","$timeline","on","toggle","options","action","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","idCase","idTask","idWorkflow","idWorkItem","idWorkitem","referrer","publish","unsub","off","injector","register","project","dashboard","menu","activity","project-content-dashboard","template","setTimeout","window","trigger","ui","kendo","Widget","ProjectAttachments","element","that","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","name","wrapper","multiple","dropZone","maxFilesSize","currentUser","uploadMaxFileSize","enabled","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","select","_filterMaxFilesSize","complete","interval","setInterval","find","length","_showNotificationCompleteUpload","clearInterval","progress","_onProgressFile","success","push","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","title","notifierTitle","animation","open","duration","close","visible","resizable","draggable","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","replace","Math","round","cancel","retry","$file","_getFileItemByUID","uid","percent","percentComplete","css","width","text","hide","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$target","$fileWrapper","$uploadWrapper","guid","remove","_onRemoveFile","_onRetryFile","file","grep","i","validation","_isValidFile","message","setStatus","valid","size","inArray","extension","total","_notifySizeExceeded","show","_switchEvents","currentTarget","cancelFilesUpload","destroy","status","prop","errorUploadiis","plugin","jQuery","base","notifier","typeResource","plugins","dialogBoxDiscussion","attchComments","attchDiscussions","addition","listDataDiscussion","userPictures","commentsList","globalTags","tempTagsBeforeDelete","tempTagsToDelete","keySentenceAddTag","project-discussions","project-discussions-popup","project-discussions-list","project-discussions-comments","project-discussions-attachments","project-attachments","templateHomeDiscussions","$contentWidget","popupDiscussion","initPluginPopupDiscussion","form","buttonShowFormNewDiscussion","subject","description","buttonShowPopupDiscussionToAdd","buttonAddDiscussion","buttonCancel","formDiscussion","attachments","edition","tagsFilter","initPluginTagsFilter","tagsMultiSelect","initPluginTagsMultiSelect","getDiscussions","eventsHandler","restrictedEventsHandler","getDataDiscussions","idUsersCreatedDiscussions","map","user","idUsersCreatedComments","property","comments","csvGuidUsers","a","seen","out","len","j","item","removeDuplicateItemsFromArray","idUser","join","getDataUsers","then","renderUserProfilesAndImages","setClassesTagsByDiscussion","onNotifyOpenPopup","showFormAddDiscussion","renderUserProfile","templatePopupDiscussion","formContent","newitemtext","categoriesMultiSelect","isDelete","createNewTag","kendoMultiSelect","change","valuesSelected","value","slice","dataitems","dataSource","tag","indexOf","filter","Boolean","pos","newtag","dataItemAddNew","at","refresh","list","itemData","add","dataBound","_prev","isfound","insert","search","dataTextField","dataValueField","hideOrShowDiscussionsByFilter","autoClose","tagMode","valueClass","validateAddCommentForm","$wrapperForm","result","$textAreaComment","val","trim","commentValidation","parent","next","html","validateAddDiscussionForm","$subjectDiscussion","$descriptionDiscussion","subjectValidation","descriptionValidation","applyFileAttachments","kendoProjectAttachments","serviceLocator","getUrl","onSuccessFile","addFileData","supportFileExt","uploadMaxFilesSize","defer","Deferred","paramsGetDiscussions","globalParent","radNumber","flowContext","id","getDiscussionsData","pipe","response","callForListComments","sortDiscussions","updateTemplateListDiscussion","resolve","promise","usersGuids","height","getUsersData","always","array","splice","arrayUnique","discussions","generalDefer","commentsDefer","addGlobalTags","tags","idParent","dateTime","getDateServer","count","getCommentsData","apply","sortedDiscussion","sort","b","dateA","date","unshift","pop","resetDiscussionAttachments","sendDataUpdateDiscussion","filesObj","prepareFilesToSave","tagsDiscussion","getTagsDiscussionBySave","guidsTagsDiscussionToDelete","getGuidsTagsDiscussionToDelete","toString","general","attachmentsToCreate","attachmentsToDelete","editDiscussion","discussion","getDiscussionDataByGUID","onClosePopupDiscussion","removeGlobalTags","showSucessMessage","printf","showErrorMessage","validateStringIsGuid","test","sendDataInsertDiscussion","postDiscussion","newDiscussion","tagsTextSelected","dataSourceTags","tagTextSelected","tagFound","isGuidTextSelected","tagSource","isGuid","differenceArrays","guidsTagsCurrentDiscussion","setStateUIShowMoreComments","$commentsContainer","state","$containerButtonMoreComments","$buttonShowMoreComments","$messageNoMoreComments","$messageLoadingComments","getCurrentUserInfo","userName","picture","createTagsOnServer","iTagAdd","tagGlobal","postTag","guidTagsToDelete","allGuidsMoreGuidsDelete","itemTag","secureGuidsForDelete","guidDelete","guidSecureDelete","idTag","deleteTag","iTagGlobal","iDiscussion","tagsBySpace","templateListDiscussions","contentRenderListDiscussions","listDataDiscussions","isOpen","parseBoolean","isClosedForAllUsers","returnServedCommentByParentId","parentId","mapTempComments","append","resourceTitlePopup","dialog","modal","zIndex","maximize","onOpenPopupDiscussion","resetFormDiscussion","userPicture","$parent","$img","$text","attr","getInitials","base64Prefix","iUser","switchCommentsEvents","is","onShowButtonsPanel","onCancelComment","$container","onCreateComment","onViewComment","onViewMoreComments","onRemoveFiles","onEditDiscussion","showConfirmationBox","onDeleteComment","onDownloadAttachment","stopPropagation","setDiscussionsDataByGUID","guidTagsDiscussion","renderAttachments","$commentWrapper","toggleClass","getMoreComments","getCommentsCountByParent","dateLastComment","responseMoreComments","Array","prototype","renderCommentByDiscussion","idUsersLoaded","idUsersNewComments","csvIdUsersMissingLoad","not","get","fail","guidParent","moreComments","$commentsDOM","tmplComment","renderObject","getCommentByGuid","parentGuid","commentGuid","x","lengthx","index","currentFiles","removeFiles","tmpSplice","fileGuid","comment","deleteComment","XMLHttpRequest","JSON","parse","$wrapper","sender","$liTarget","guidAttachment","nameFile","getDownloadAttachment","$commentContainer","$buttonsWrp","$textarea","$uploadForm","$vlTooltip","$fileList","reset","$rplWrp","$addCommentContainer","$uploadList","postComment","newComment","isIE","fileList","onClickCancel","detach","focus","onSubmitFormDiscussion","resetWidget","hasOwnProperty","$source","$textareaSource","$textareaTarget","$uploadListSource","first","$uploadListTarget","supportNav","project-discussion-sidebar","onShowPopupDiscussion","sidebar","contextsSidebarActivity","datePickerRegional","project-caseState","project-caseState-popup-release","project-caseState-remaining","releaseDialogBox","popupRelease","buttonAccept","onClickAcceptRelease","onClickCancelRelease","isFavoriteCase","isFavorite","showCaseNumber","creationDate","INVARIANT_FORMAT","creationDateObject","dateFormatter","getDateFromFormat","creationDateFormat","getFormattedDate","solutionDateObject","solutionDate","solutionDateFormat","currentDate","Date","calculateDataForTemplate","showGraphicQuery","idCaseForGraphicQuery","idWorkFlow","isAdhoc","idProcess","idAdhocProcess","showHelpUrl","helpUrl","paramsEffectiveDuration","fromDate","getTime","toDate","differenceCreationToCurrent","relativeTime","getRelativeTime","now","relativeTimeState","colorStateCase","percentCompleteBar","contentTemplate","validateUrlWellFormed","security","menuSecurity","urlHelp","isEmpty","onClickFavorite","goToCase","showBackNextNavigation","dateObj","monthsNames","monthNames","shortMonth","getMonth","bizagiLanguage","BIZAGI_LANGUAGE","substring","datepicker","formatDate","favoriteOptions","idObject","favoriteType","addFavorite","favoritesData","guidFavorite","idFavorites","delFavorite","onSelectMenu","onClickMenuReasign","onClickMenuRelease","loader","startAndThen","widgetName","BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE","closeVisible","modalParameters","releaseActivity","currentInboxView","showMessageBox","callGetEffectiveDuration","d","getEffectiveDuration","cntxtSidebarActivity","getBackCase","getNextCase","getListKey","lstIdCases","key","nextCase","backCase","caseState","project-activityState-wrapper","currentState","currentWorkitem","objectWorkItem","activityName","activityIsEvent","isEvent","initDateObject","entryDateWorkItem","initDateFormat","estimatedSolutionDateObject","estimatedSolutionDate","estimatedSolutionDateFormat","updateTemplateWidget","initilizeActionMenu","allowsReassign","btReassing","btShareActivity","onClickShareActivity","button","getShareActivity","unbind","diffMillisecondsCurrentToEstimated","diffMillisecondsCreationToSolution","paramsEffectiveDurationOpened","currentDateExceededEstimatedDate","paramsEffectiveDurationInitialToEstimated","differenceCreatedToCurrent","differenceCurrentToEstimated","differenceInitialToEstimated","colorState","showEstimatedSolutionDate","percentBar","getPercentBar","canShareActivity","isShared","totalMinutes","sectionMinutes","override","enableShareActivity","shareActivityTooltip","activityButton","texto","tooltip","tooltipClass","my","of","collision","activityState","project-process-state","displayName","onClickGoToParentCase","routingExecute","processState","relatedusers","users","loadedUsers","project-users","onRenderFinish","showCreatorInformation","typesAssignUser","createdBy","userId","typeName","userIds","userInfo","usersAdapter","createJsonUserInfo","username","email","userinformation","responseSubprocessState","responseSubprocess","newValue","auxArrayListSubprocessesState","auxArrayListSubprocesses","newItem","isArray","Class","project-subprocesses-tootip-custom-properties","initializeTooltip","selectorTooltip","indexSubprocess","idCustData","itemsFinded","getContentTooltip","$id","hover","stop","fadeTo","textLI","templateTooltip","rowCustomProperty","nameProperty","valueProperty","arrayCustomsProperties","auxValueProperty","subprocessData","getSubprocessData","custData","custDataTypes","custFields","formatMonetaryCell","formatBoolean","formatDecimalCell","objectTemplate","nameSubprocess","contentTableCustomProperties","subProcessData","subProcess","subProcesses","subProcPersonalized","customFields","CustFields","Object","keys","subprocesses","project-events","getArgsTemplate","responseArgsTemplate","onClickGoEvent","def","callSummaryCaseEvents","responseEvents","elementEvent","summaryCaseEvents","events","project-subprocesses","summarySubProcess","organizeDataForSubprocesses","showSubProcess","each","tempSubprocesses","renderWidget","onClickGoSubprocess","pluginTooltip","project-activity-description","getWorkitemDescription","tskDescription"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity\").concat(\"#project-dashboard-menu1\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n         self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Update view\r\n    * @param event\r\n    * @param params\r\n    */\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.params.plan.idActivitySelected = undefined;\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      if(typeof event.type !== \"undefined\"){\r\n         self.params.showContextByMenuDashboard = event.type;\r\n      }\r\n\r\n      var argsTemplate = {\r\n         showFormOverview: self.params.menuDashboard.showFormOverview,\r\n         showFormActivity: self.params.menuDashboard.showFormActivity,\r\n         showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu &&\r\n            (!self.params.isAdhocProcess ||\r\n            (self.params.isAdhocProcess && bizagi.util.isEnableFeature(\"enableTimelineOnLiveProcesses\"))),\r\n         showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\r\n         contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\r\n         contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu\r\n      };\r\n\r\n      //Update widget\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      template.render(argsTemplate).appendTo($content);\r\n\r\n      if(self.params.showContextByMenuDashboard){\r\n         $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n      }\r\n\r\n      self.handlerEvents();\r\n   },\r\n\r\n   /**\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if (!$item.hasClass(\"active\")) {\r\n\r\n         var showContextByMenuDashboard = $item.data(\"context\");\r\n\r\n         if (showContextByMenuDashboard) {\r\n            $.when(bizagi.util.autoSave()).done(function () {\r\n               $(document).data('auto-save', '');\r\n\r\n               var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\" });\r\n               var currentLevelNavigator = parseInt(getLevelNavigator[0], 10);\r\n               var nameItemNavigator = \"\";\r\n               var newLevelNavigator = currentLevelNavigator;\r\n\r\n               if(showContextByMenuDashboard == \"PLANACTIVITIES\"){\r\n                  newLevelNavigator = currentLevelNavigator + 1;\r\n                  nameItemNavigator = bizagi.localization.getResource(\"workportal-project-casedashboard-plan\");\r\n               }\r\n\r\n               self.params.refreshLastItemBreadcrumb = false;\r\n               self.pub(\"notify\", {\r\n                  type: showContextByMenuDashboard.toUpperCase(),\r\n                  args: $.extend(self.params, { showContextByMenuDashboard: showContextByMenuDashboard,\r\n                     histName: nameItemNavigator,\r\n                     level: newLevelNavigator })\r\n               });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n            });\r\n         }\r\n      }\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n       var self = this;\r\n       var content = self.getContent();\r\n       var $comments = $(\"[data-context='COMMENTS']\", content);\r\n       var $files = $(\"[data-context='FILES']\", content);\r\n       var $timeline = $(\"[data-context='TIMELINE']\", content);\r\n\r\n       $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n           $comments.toggle();\r\n           $files.toggle();\r\n           $timeline.toggle();\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Handler events\r\n    */\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      self.subMenuHandler();\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\", $.proxy(self.loadContentById, self));\r\n\r\n       // Bind for click event on refresh botton\r\n       $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).on(\"click\", function () {\r\n           var options = {\r\n               action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n               idCase: self.params.idCase,\r\n               idTask: self.params.idTask,\r\n               idWorkflow: self.params.idWorkflow,\r\n               idWorkItem: self.params.idWorkitem,\r\n               referrer: self.params.referrer || \"inboxGrid\"\r\n           };\r\n           self.publish(\"executeAction\", options);\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Clean widgets and events\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n      $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).off();\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-content-dashboard\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n\r\n      setTimeout(function(){\r\n         $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\r\n      }, 1000);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\r\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\r\n\r\n (function ($) {\r\n\r\n     // shorten references to variables. this is better for uglification \r\n     var kendo = window.kendo,\r\n      ui = kendo.ui,\r\n      Widget = ui.Widget;\r\n\r\n     var ProjectAttachments = Widget.extend({\r\n\r\n         init: function (element, options) {\r\n\r\n             var that = this;\r\n\r\n             // base call to initialize widget\r\n             Widget.fn.init.call(that, element, options);\r\n\r\n             that._maxFilesSize = options.maxSize;\r\n             that._fileList = [];\r\n             that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\r\n             that._supportFileExt = options.extensions;\r\n             that._uploadMaxFilesSize = options.maxSize;\r\n             that.upload = that._initUpload();\r\n             that.loadNotifier = that._initLoadNotifier();\r\n             that.notification = that._initNotification();\r\n\r\n             that._eventsHandler();\r\n\r\n             that._initLocalization(that.options.localization);\r\n         },\r\n\r\n         options: {\r\n             name: \"ProjectAttachments\",\r\n             wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\r\n             multiple: true,\r\n             dropZone: true,\r\n             maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\r\n             enabled: true,\r\n             localization: {}\r\n         },\r\n\r\n         _initUpload: function () {\r\n\r\n             var that = this,\r\n              options = that.options,\r\n              localization = options.localization || {},\r\n              auxNumberFilesSuccess = 0;\r\n\r\n             that._initLocalization(localization);\r\n\r\n             return this.element.kendoUpload({\r\n                 async: {\r\n                     saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\r\n                     autoUpload: true\r\n                 },\r\n                 select: function (event) {\r\n                     that._filterMaxFilesSize(event);\r\n                     auxNumberFilesSuccess = 0;\r\n                 },\r\n                 complete: function(){\r\n                     var interval = setInterval(function(){\r\n                        if( that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0){\r\n                            that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\r\n                            clearInterval(interval);\r\n                        }\r\n                     }, 300);\r\n                 },\r\n                 upload: options.upload,\r\n                 progress: function (event) {\r\n                     that._onProgressFile(event);\r\n                 },\r\n                 success: function (event) {\r\n                     that._fileList.push(event.files[0]);\r\n                     auxNumberFilesSuccess += 1;\r\n                     options.success(event);\r\n                 },\r\n                 error: function (event) {\r\n                     that.onErrorFile(event);\r\n                 },\r\n                 localization: {\r\n                     select: localization.selectFiles,\r\n                     dropFilesHere: localization.dropFilesHere\r\n                 },\r\n                 multiple: options.multiple,\r\n                 enabled: options.enabled,\r\n                 dropZone: options.dropZone,\r\n                 showFileList: false\r\n             }).data(\"kendoUpload\");\r\n\r\n         },\r\n\r\n         _initNotification: function(){\r\n             return $(\"<div></div>\").kendoNotification({\r\n                 position: {\r\n                     pinned: true\r\n                 }\r\n             }).data(\"kendoNotification\");\r\n         },\r\n\r\n         _initLoadNotifier: function () {\r\n\r\n             var that = this,\r\n                    localization = that.options.localization,\r\n                    $wrapper = that.options.wrapper;\r\n\r\n             return $wrapper.kendoWindow({\r\n                 title: localization.notifierTitle,\r\n                 actions: [\"Close\"],\r\n                 animation: {\r\n                     open: {\r\n                         duration: 100\r\n                     },\r\n                     close: {\r\n                         duration: 100\r\n                     }\r\n                 },\r\n                 open: function() {\r\n                     this.wrapper.addClass(\"project-attachments-wrapper-window\");\r\n                 },\r\n                 visible: false,\r\n                 resizable: false,\r\n                 draggable: false,\r\n                 maxHeight: \"300px\",\r\n                 minWidth: \"430px\"\r\n             }).data(\"kendoWindow\");\r\n\r\n         },\r\n\r\n         _initLocalization: function(objectOptionsLocalization){\r\n             var that = this;\r\n             var optionsLocalizationByDefault = {\r\n                 selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\r\n                 notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\r\n                 errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error-type\"),\r\n                 errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\r\n                 errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\r\n                 errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", (Math.round(that._maxFilesSize/1000000, -1))),\r\n                 dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\r\n                 cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\r\n                 retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\r\n                 close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\")\r\n             };\r\n\r\n             $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\r\n         },\r\n\r\n         _onProgressFile: function (event) {\r\n\r\n             var that = this;\r\n             var $file = that._getFileItemByUID(event.files[0].uid);\r\n             var percent = event.percentComplete;\r\n\r\n             $(\".k-progress\", $file).css({\r\n                 width: percent + \"%\"\r\n             });\r\n\r\n             $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\r\n\r\n             if (percent === 100){ $(\".k-upload-action .k-icon\", $file).hide(); }\r\n         },\r\n\r\n         _onShowUploadNotifier: function (event) {\r\n\r\n             var that = this,\r\n                files = event.files,\r\n                template = that.options.template;\r\n\r\n             that.loadNotifier.content(template.render({ files: files }));\r\n             that.loadNotifier.wrapper.css({\r\n                 top: \"auto\",\r\n                 left: \"auto\",\r\n                 bottom: \"1em\",\r\n                 right: \"1em\"\r\n             });\r\n\r\n             that.loadNotifier.open();\r\n         },\r\n\r\n        _showNotificationCompleteUpload: function(wrapperMessage, auxNumberFilesSuccess){\r\n            var that = this;\r\n            if( wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\r\n            {\r\n                that._autoHideMessage(wrapperMessage);\r\n            }\r\n        },\r\n\r\n         _autoHideMessage: function(wrapperMessage){\r\n             var that = this;\r\n             setTimeout(function(){\r\n                 wrapperMessage.fadeOut(function(){\r\n                     that.loadNotifier.close();\r\n                 });\r\n             }, 2000);\r\n         },\r\n\r\n         _onCancelFile: function ($target) {\r\n             var that = this,\r\n                 $fileWrapper = $target.closest(\"li\"),\r\n                 $uploadWrapper = that.upload.wrapper,\r\n                 guid = $fileWrapper.data(\"guid\");\r\n\r\n             $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRemoveFile: function ($target) {\r\n             var $fileWrapper = $target.closest(\"li\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRetryFile: function ($target) {\r\n             var that = this;\r\n             var $file = $target.closest(\"li\");\r\n             var guid = $file.data(\"guid\");\r\n             var file = $.grep(that._fileList, function (i) {\r\n                 return i.uid === guid;\r\n             });\r\n\r\n             that.options.retry(file[0]);\r\n         },\r\n\r\n         onErrorFile: function (event) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             file = event.files[0],\r\n             validation = that._isValidFile(file);\r\n             var message = (validation.message !== \"\") ? validation.message : localization.errorUpload;\r\n\r\n             that.setStatus(\"ERROR\", file.uid, message);\r\n         },\r\n\r\n         _isValidFile: function (file) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             valid = true,\r\n             message = \"\";\r\n\r\n             if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0 ) {\r\n                 message = localization.errorSize;\r\n                 valid = false;\r\n             }\r\n\r\n             if(!that._onlyValidateServerFileExtension){\r\n                 if ($.inArray(file.extension, that._supportFileExt) === -1) {\r\n                     message = localization.errorSecurity;\r\n                     valid = false;\r\n                 }\r\n             }\r\n\r\n             return {\r\n                 valid: valid,\r\n                 message: message\r\n             };\r\n         },\r\n\r\n         _filterMaxFilesSize: function (event) {\r\n            \r\n            var that = this;\r\n            var total = 0;\r\n\r\n            for (var i = 0, length = event.files.length; i < length; i++){\r\n                total += event.files[i].size;\r\n            }\r\n            if (total > that._maxFilesSize) {\r\n                that._notifySizeExceeded();\r\n                event.preventDefault();\r\n            } else {\r\n                that._onShowUploadNotifier(event);\r\n            }\r\n         },\r\n\r\n         _notifySizeExceeded: function(){\r\n         \r\n             var that = this;\r\n\r\n             that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\r\n         },\r\n\r\n         _getFileItemByUID: function (uid) {\r\n             var that = this;\r\n             return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\r\n         },\r\n\r\n         _switchEvents: function (event) {\r\n             var that = this;\r\n             var $target = $(\".k-icon\", event.currentTarget);\r\n             if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\r\n                 that._onRemoveFile($target);\r\n             } else if ($target.hasClass(\"k-retry\")) {\r\n                 that._onRetryFile($target);\r\n             } else if ($target.hasClass(\"k-cancel\")) {\r\n                 that._onCancelFile($target);\r\n             }\r\n         },\r\n\r\n         _eventsHandler: function () {\r\n             var that = this;\r\n\r\n             that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\r\n                 that._switchEvents(event);\r\n             });\r\n         },\r\n\r\n         cancelFilesUpload: function(){\r\n             var that = this;\r\n             var $uploadWrapper = that.upload.wrapper;\r\n\r\n             $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\r\n             that.close();\r\n         },\r\n\r\n         close: function () {\r\n             this.loadNotifier.close();\r\n         },\r\n\r\n         destroy: function () {\r\n             this.loadNotifier.destroy();\r\n             this.upload.destroy();\r\n         },\r\n\r\n         setStatus: function (status, uid, message) {\r\n\r\n             var $file = this._getFileItemByUID(uid),\r\n                 localization = this.options.localization;\r\n\r\n             switch (status) {\r\n                 case \"SUCCESS\":\r\n                     $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\r\n                     $(\".k-errormsg\", $file).text(\"\");\r\n                     break;\r\n                 case \"ERROR\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\r\n                     $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\r\n                     break;\r\n                 case \"RETRY\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\r\n                     $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\r\n                     break;\r\n             }\r\n         }\r\n\r\n     });\r\n\r\n     ui.plugin(ProjectAttachments);\r\n })(jQuery);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Discussions Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.discussions\", {}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, notifier, params) {\r\n\r\n        var self = this;\r\n\r\n        self.typeResource = \"DiscussionGuid\";\r\n        self.plugins = {};\r\n        self.dialogBoxDiscussion = {};\r\n        self.attchComments = {};\r\n        self.attchDiscussions = {\r\n            remove: [],\r\n            addition: []\r\n        };\r\n        self.listDataDiscussion = [];\r\n        self.userPictures = [];\r\n        self.commentsList = {};\r\n\r\n        self.globalTags = [];\r\n\r\n        self.tempTagsBeforeDelete = [];\r\n        self.tempTagsToDelete = [];\r\n        self.keySentenceAddTag = bizagi.localization.getResource(\"workportal-project-discussion-add-new-tag\") + \": \";\r\n        self.notifier = notifier;\r\n\r\n\r\n        //Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-discussions\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-wrapper\"),\r\n            \"project-discussions-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-popup-wrapper\"),\r\n            \"project-discussions-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-list-wrapper\"),\r\n            \"project-discussions-comments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-comments-list\"),\r\n            \"project-discussions-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-attachments-list\"),\r\n            \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\")\r\n        });\r\n\r\n    },\r\n\r\n    /*\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var templateHomeDiscussions = self.getTemplate(\"project-discussions\");\r\n\r\n        self.content = templateHomeDiscussions.render({});\r\n        return self.content;\r\n    },\r\n\r\n    /*\r\n     * Post render and links events with handlers\r\n     */\r\n    postRender: function () {\r\n\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        self.plugins.popupDiscussion = self.initPluginPopupDiscussion();\r\n        var popupDiscussion = self.plugins.popupDiscussion;\r\n\r\n        //reference for html elements\r\n        self.form = {\r\n            buttonShowFormNewDiscussion: $(\".ui-bizagi-wp-action-new\", $contentWidget),\r\n            title: $(\".ui-bizagi-wp-project-popupform-h4\", popupDiscussion),\r\n            subject: $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", popupDiscussion),\r\n            description: $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", popupDiscussion),\r\n            buttonShowPopupDiscussionToAdd: $(\"#ui-bizagi-wp-project-discussions-button-action-show-popup-to-add\", $contentWidget),\r\n            buttonAddDiscussion: $(\"#ui-bizagi-wp-project-discussions-popup-action-add-discussion\", popupDiscussion),\r\n            buttonCancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", popupDiscussion),\r\n            formDiscussion: $(\".ui-bizagi-wp-project-discussions-popup\", popupDiscussion),\r\n            attachments: $(\".ui-bizagi-wp-project-discussions-attachments-cmnwrapper\", popupDiscussion),\r\n            edition: false\r\n        };\r\n\r\n        self.plugins.tagsFilter = self.initPluginTagsFilter();\r\n\r\n        self.plugins.tagsMultiSelect = self.initPluginTagsMultiSelect(popupDiscussion);\r\n\r\n        //Load discussions\r\n        self.getDiscussions();\r\n        self.eventsHandler();\r\n        self.restrictedEventsHandler();\r\n    },\r\n\r\n    getDiscussions: function(){\r\n        var self = this;\r\n\r\n        self.getDataDiscussions().done(function () {\r\n\r\n            var idUsersCreatedDiscussions = $.map(self.listDataDiscussion, function (element) {\r\n                return element.user;\r\n            });\r\n\r\n            var idUsersCreatedComments = $.map(self.commentsList, function (property) {\r\n                return $.map(property.comments, function (property) {\r\n                    return property.user;\r\n                });\r\n            });\r\n\r\n            function removeDuplicateItemsFromArray(a) {\r\n                var seen = {};\r\n                var out = [];\r\n                var len = a.length;\r\n                var j = 0;\r\n                for (var i = 0; i < len; i++) {\r\n                    var item = a[i];\r\n                    if (seen[item] !== 1) {\r\n                        seen[item] = 1;\r\n                        out[j++] = item;\r\n                    }\r\n                }\r\n                return out;\r\n            }\r\n\r\n            var csvGuidUsers = removeDuplicateItemsFromArray(idUsersCreatedDiscussions.concat(idUsersCreatedComments).concat(bizagi.currentUser.idUser)).join(\",\");\r\n\r\n            self.getDataUsers(csvGuidUsers).then(function () {\r\n                self.renderUserProfilesAndImages();\r\n            });\r\n\r\n            self.setClassesTagsByDiscussion();\r\n\r\n        });\r\n        \r\n    },\r\n\r\n    /*\r\n     * Notifies when an event is raised\r\n     */\r\n    onNotifyOpenPopup: function () {\r\n        var self = this;\r\n\r\n        self.form.edition = false;\r\n        self.showFormAddDiscussion(\"workportal-project-discussion-adddiscussion\");\r\n        self.renderUserProfile();\r\n    },\r\n\r\n    /*\r\n     * Init plugins\r\n     */\r\n    initPluginPopupDiscussion: function () {\r\n        var self = this;\r\n        var templatePopupDiscussion = self.getTemplate(\"project-discussions-popup\");\r\n        self.dialogBoxDiscussion.formContent = templatePopupDiscussion.render({attachments: []});\r\n        return self.dialogBoxDiscussion.formContent;\r\n    },\r\n\r\n\r\n    initPluginTagsMultiSelect: function (popupDiscussion) {\r\n        var self = this;\r\n        var tags = [];\r\n        var categoriesMultiSelect = popupDiscussion.find(\"#ui-bizagi-wp-project-discussions-options-multiselect-tags\");\r\n        var newitemtext;\r\n        var isDelete = false;\r\n        var createNewTag = false;\r\n        return categoriesMultiSelect.kendoMultiSelect({\r\n            change: function () {\r\n                var valuesSelected = this.value().slice(0);\r\n\r\n                var dataitems = this.dataSource.data();\r\n                if (valuesSelected.length > 0) {\r\n                    if (dataitems[0].tag.replace(self.keySentenceAddTag, \"\").indexOf(valuesSelected[valuesSelected.length - 1]) !== -1) {\r\n                        //fix because the value dont complete by millisecond\r\n                        valuesSelected[valuesSelected.length - 1] = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\r\n                    }\r\n                }\r\n\r\n\r\n                valuesSelected = valuesSelected.filter(Boolean); //Remove empty items\r\n\r\n                //remove duplicate items\r\n                valuesSelected = valuesSelected.filter(function (value, pos, self) {\r\n                    return self.indexOf(value) === pos;\r\n                });\r\n\r\n                var newtag = \"\";\r\n\r\n                if (dataitems.length > 0) {\r\n                    if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\r\n                        newtag = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\r\n\r\n                        var dataItemAddNew = {};\r\n                        if (valuesSelected.indexOf(newtag) !== -1) {\r\n                            dataItemAddNew = this.dataSource.at(0);\r\n                            isDelete = true;\r\n                            this.dataSource.remove(dataItemAddNew);\r\n                            isDelete = false;\r\n                            this.refresh();\r\n                            createNewTag = true;\r\n                        }\r\n                        else {\r\n                            if (newtag) {\r\n                                if ($(\"li:first\", this.list).hasClass(\"k-state-focused\")) {\r\n                                    createNewTag = true;\r\n                                    valuesSelected.push(newtag);\r\n                                }\r\n                                dataItemAddNew = this.dataSource.at(0);\r\n                                isDelete = true;\r\n                                this.dataSource.remove(dataItemAddNew);\r\n                                isDelete = false;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                if (newtag) {\r\n                    if (createNewTag) {\r\n                        var existInDatasource = this.dataSource.data().filter(function (itemData) {\r\n                            return itemData.tag === newtag;\r\n                        });\r\n                        if (existInDatasource.length === 0) {\r\n                            this.dataSource.add({guid: newtag, tag: newtag});\r\n                        }\r\n                        createNewTag = false;\r\n                    }\r\n                }\r\n                this.dataSource.filter({});\r\n                this.value(valuesSelected);\r\n\r\n            },\r\n            dataBound: function () {\r\n                if ((newitemtext || this._prev) && newitemtext !== this._prev && !isDelete) {\r\n                    newitemtext = this._prev;\r\n\r\n                    var dataitems = this.dataSource.data();\r\n\r\n                    var isfound = false;\r\n                    if (dataitems.length > 0) {\r\n                        if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\r\n                            dataitems[0].tag = self.keySentenceAddTag + newitemtext;\r\n                            this.refresh();\r\n                            isfound = true;\r\n                            $(\"li\", this.list).removeClass(\"k-state-focused\");\r\n                            $(\"li:first\", this.list).addClass(\"k-state-focused\");\r\n                        }\r\n                    }\r\n\r\n                    if (!isfound) //Is found item with text \"Add new tag:\" ?\r\n                    {\r\n                        this.dataSource.insert(0, {tag: self.keySentenceAddTag + newitemtext, guid: newitemtext});\r\n                    }\r\n\r\n                    if (this.dataSource.total() == 0) {\r\n                        this.search();\r\n                        this.open();\r\n                        this.refresh();\r\n                        $(\"li\", this.list).removeClass(\"k-state-focused\");\r\n                        $(\"li:first\", this.list).addClass(\"k-state-focused\");\r\n                    }\r\n                }\r\n            },\r\n            dataSource: tags,\r\n            dataTextField: \"tag\",\r\n            dataValueField: \"guid\",\r\n            filter: \"contains\",\r\n            animation: false\r\n        }).data(\"kendoMultiSelect\");\r\n    },\r\n\r\n    initPluginTagsFilter: function () {\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n        return $(\"#ui-bizagi-wp-project-discussions-options-tags-filter\", $contentWidget).kendoMultiSelect({\r\n            change: function () {\r\n                self.hideOrShowDiscussionsByFilter();\r\n            },\r\n            autoClose: false,\r\n            tagMode: \"single\",\r\n            dataTextField: \"tag\",\r\n            dataValueField: \"guid\"\r\n        }).data(\"kendoMultiSelect\");\r\n    },\r\n\r\n    hideOrShowDiscussionsByFilter: function () {\r\n        var self = this;\r\n        var valuesSelected = self.plugins.tagsFilter.value();\r\n        if (valuesSelected.length > 0) {\r\n            $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).hide();\r\n            valuesSelected.forEach(function (valueClass) {\r\n                $(\".ui-bizagi-wp-project-discussions-item.\" + valueClass, self.getContent()).show();\r\n            });\r\n        }\r\n        else {\r\n            $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).show();\r\n        }\r\n    },\r\n\r\n    validateAddCommentForm: function($wrapperForm){\r\n        var result = false;\r\n        var $textAreaComment = $(\"textarea\", $wrapperForm);\r\n        if($textAreaComment.val().trim() === \"\"){\r\n            var commentValidation = bizagi.localization.getResource(\"workportal-project-discussion-requiredcomment\");\r\n            $textAreaComment.parent().next().find('span').html(commentValidation);\r\n        }\r\n        else{\r\n            $textAreaComment.parent().next().find('span').empty();\r\n            result = true;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    validateAddDiscussionForm: function($wrapperForm){\r\n        var result = false;\r\n        var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", $wrapperForm);\r\n        var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", $wrapperForm);\r\n        if($subjectDiscussion.val().trim() !== \"\" && $descriptionDiscussion.val().trim() !== \"\"){\r\n            result = true;\r\n        }\r\n        if($subjectDiscussion.val().trim() === \"\"){\r\n            var subjectValidation = bizagi.localization.getResource(\"workportal-project-discussion-subjectrequired\");\r\n            $subjectDiscussion.parent().find(\"span\").html(subjectValidation);\r\n        }\r\n        else{\r\n            $subjectDiscussion.parent().find(\"span\").empty();\r\n        }\r\n        if($descriptionDiscussion.val().trim() === \"\"){\r\n            var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\r\n            $descriptionDiscussion.parent().next().find(\"span\").html(descriptionValidation);\r\n        }\r\n        else{\r\n            $descriptionDiscussion.parent().next().find(\"span\").empty();\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    applyFileAttachments: function (type) {\r\n\r\n        var self = this;\r\n        var content = (type === \"DISCUSSIONS\") ? self.plugins.popupDiscussion : self.getContent();\r\n\r\n        return $(\".ui-bizagi-wp-project-discussions-attachment-upload\", content).kendoProjectAttachments({\r\n            saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\r\n            template: self.getTemplate(\"project-attachments\"),\r\n            success: function (event) {\r\n                self.onSuccessFile(event, type);\r\n            },\r\n            upload: $.proxy(self.addFileData, self),\r\n            dropZone: false,\r\n            extensions: self.supportFileExt,\r\n            maxSize: self.uploadMaxFilesSize\r\n        }).data(\"kendoProjectAttachments\");\r\n    },\r\n\r\n    addFileData: function (event) {\r\n\r\n        var uid = event.files[0].uid;\r\n\r\n        event.files[0].guid = uid;\r\n        event.data = {\r\n            guid: uid\r\n        };\r\n    },\r\n\r\n\r\n    /*\r\n     *  Get data for discussions\r\n     */\r\n    getDataDiscussions: function () {\r\n\r\n        var self = this,\r\n            defer = $.Deferred();\r\n\r\n        var paramsGetDiscussions = {\r\n            globalParent: self.radNumber,\r\n            typeResource: self.typeResource\r\n        };\r\n\r\n        if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\r\n            paramsGetDiscussions.globalParent = self.params.plan.id;\r\n        }\r\n\r\n        self.dataService.getDiscussionsData(paramsGetDiscussions).pipe(function (response) {\r\n            return self.callForListComments(response);\r\n        }).done(function (response) {\r\n            self.listDataDiscussion = self.sortDiscussions(response);\r\n            self.updateTemplateListDiscussion();\r\n            defer.resolve();\r\n        });\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n     *  Get data for users\r\n     */\r\n    getDataUsers: function (usersGuids) {\r\n        var self = this,\r\n            defer = $.Deferred();\r\n\r\n        var params = {\r\n            usersGuids: usersGuids,\r\n            width: 50,\r\n            height: 50\r\n        };\r\n\r\n        if(params.usersGuids){\r\n            self.dataService.getUsersData(params).always(function (response) {\r\n\r\n                function arrayUnique(array) {\r\n                    var a = array.concat();\r\n                    for (var i = 0; i < a.length; ++i) {\r\n                        for (var j = i + 1; j < a.length; ++j) {\r\n                            if (a[i] === a[j]) {\r\n                                a.splice(j--, 1);\r\n                            }\r\n                        }\r\n                    }\r\n                    return a;\r\n                }\r\n\r\n                self.userPictures = arrayUnique(self.userPictures.concat(response));\r\n                defer.resolve();\r\n            });\r\n        }\r\n        else{\r\n            defer.resolve();\r\n        }\r\n\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n     * Call list of comments by discussion\r\n     */\r\n    callForListComments: function (discussions) {\r\n\r\n        var self = this,\r\n            generalDefer = $.Deferred(),\r\n            commentsDefer = [];\r\n\r\n        for (var i = 0, length = discussions.length - 1; i <= length; i++) {\r\n\r\n            self.addGlobalTags(discussions[i].tags, false);\r\n\r\n            var params = {\r\n                idParent: discussions[i].guid,\r\n                dateTime: self.getDateServer(),\r\n                count: 6\r\n            };\r\n\r\n            self.commentsList[params.idParent] = {\r\n                comments: [],\r\n                count: 0,\r\n                total: 0\r\n            };\r\n\r\n            var defer = $.when(self.dataService.getCommentsData(params)).done(function (response) {\r\n                if (response.length > 0) {\r\n                    self.commentsList[response[0].parent] = {\r\n                        comments: response,\r\n                        count: response.length,\r\n                        total: 0\r\n                    };\r\n                }\r\n            });\r\n\r\n            commentsDefer.push(defer);\r\n        }\r\n\r\n        $.when.apply($, commentsDefer).done(function () {\r\n            generalDefer.resolve(discussions);\r\n        });\r\n\r\n        return generalDefer.promise();\r\n    },\r\n\r\n    sortDiscussions: function (discussions) {\r\n        var sortedDiscussion = [];\r\n        if (discussions.length) {\r\n            sortedDiscussion = discussions.sort(function (a, b) {\r\n                var dateA = a.date;\r\n                var dateB = b.date;\r\n\r\n                return (dateB - dateA);\r\n            });\r\n\r\n            if (sortedDiscussion.length > 0) {\r\n                sortedDiscussion.unshift(sortedDiscussion.pop());\r\n            }\r\n        }\r\n        return sortedDiscussion;\r\n    },\r\n\r\n    resetDiscussionAttachments: function () {\r\n\r\n        var self = this;\r\n        var popupDiscussion = self.plugins.popupDiscussion;       \r\n        $(\".ui-bizagi-wp-project-attachments-list\", popupDiscussion).empty();\r\n\r\n        self.plugins.tagsMultiSelect.value([]);\r\n        \r\n        self.attchDiscussions.addition = [];\r\n        self.attchDiscussions.remove = [];\r\n        self.getDiscussions();       \r\n    },\r\n\r\n    sendDataUpdateDiscussion: function (guid) {\r\n\r\n        var self = this;\r\n        var filesObj = self.prepareFilesToSave();\r\n        self.form.buttonAddDiscussion.prop(\"disabled\", true);\r\n\r\n        var tagsDiscussion = self.getTagsDiscussionBySave();\r\n        var guidsTagsDiscussionToDelete = self.getGuidsTagsDiscussionToDelete();\r\n\r\n        var params = {\r\n            content: {\r\n                name: self.form.subject.val(),\r\n                description: self.form.description.val(),\r\n                globalParent: self.radNumber.toString(),\r\n                user: bizagi.currentUser.idUser,\r\n                attachments: filesObj.attachments,\r\n                guid: guid,\r\n                tags: tagsDiscussion,\r\n                typeResource: \"DiscussionGuid\",\r\n                general: false,\r\n                date: self.getDateServer()\r\n            },\r\n            attachmentsToCreate: filesObj.attachmentsToCreate,\r\n            attachmentsToDelete: filesObj.attachmentsToDelete\r\n        };\r\n\r\n        self.plugins.attchDiscussions.close();\r\n\r\n        self.dataService.editDiscussion(params).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                self.addGlobalTags(tagsDiscussion, true);\r\n\r\n                var discussion = self.getDiscussionDataByGUID(guid);\r\n                discussion.name = params.content.name;\r\n                discussion.description = params.content.description;\r\n                discussion.attachments = params.content.attachments;\r\n                discussion.tags = params.content.tags;\r\n\r\n                self.onClosePopupDiscussion();\r\n\r\n                self.resetDiscussionAttachments();\r\n                self.updateTemplateListDiscussion();\r\n\r\n                self.removeGlobalTags(guidsTagsDiscussionToDelete);\r\n\r\n                self.notifier.showSucessMessage(\r\n                    printf(bizagi.localization.getResource(\"workportal-project-discussion-edited\"), \"\"));\r\n            } else {\r\n\r\n                self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n\r\n                self.onClosePopupDiscussion();\r\n                self.notifier.showErrorMessage(\r\n                   printf(bizagi.localization.getResource(\"workportal-project-discussion-error-edition\"), \"\"));\r\n            }\r\n\r\n\r\n            self.renderUserProfilesAndImages();\r\n\r\n            self.setClassesTagsByDiscussion();\r\n            self.hideOrShowDiscussionsByFilter();\r\n        });\r\n\r\n    },\r\n    validateStringIsGuid: function (value) {\r\n        var validGuid = /^({|()?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}(}|))?$/;\r\n        var emptyGuid = /^({|()?0{8}-(0{4}-){3}0{12}(}|))?$/;\r\n        return validGuid.test(value) && !emptyGuid.test(value);\r\n    },\r\n\r\n    sendDataInsertDiscussion: function (guid) {\r\n\r\n        var self = this;\r\n        var filesObj = self.prepareFilesToSave();\r\n\r\n        self.form.buttonAddDiscussion.prop(\"disabled\", true);\r\n\r\n        var tagsDiscussion = self.getTagsDiscussionBySave();\r\n\r\n        var params = {\r\n            content: {\r\n                name: self.form.subject.val(),\r\n                description: self.form.description.val(),\r\n                globalParent: self.radNumber.toString(),\r\n                user: bizagi.currentUser.idUser,\r\n                attachments: filesObj.attachments,\r\n                guid: guid,\r\n                tags: tagsDiscussion,\r\n                typeResource: \"DiscussionGuid\",\r\n                general: false,\r\n                date: self.getDateServer()\r\n            },\r\n            attachmentsToCreate: filesObj.attachmentsToCreate,\r\n            attachmentsToDelete: filesObj.attachmentsToDelete\r\n        };\r\n\r\n        self.plugins.attchDiscussions.close();\r\n\r\n        self.dataService.postDiscussion(params).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n\r\n                self.addGlobalTags(tagsDiscussion, true);\r\n\r\n                self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n\r\n                var newDiscussion = {\r\n                    \"name\": params.content.name,\r\n                    \"description\": params.content.description,\r\n                    \"date\": params.content.date,\r\n                    \"user\": params.content.user,\r\n                    \"attachments\": params.content.attachments,\r\n                    \"radNumber\": params.content.globalParent,\r\n                    \"general\": params.content.general,\r\n                    \"guid\": params.content.guid,\r\n                    \"tags\": params.content.tags,\r\n                    \"typeResource\": params.content.typeResource\r\n                };\r\n\r\n                self.commentsList[params.content.guid] = {\r\n                    comments: [],\r\n                    count: 0,\r\n                    total: 0\r\n                };\r\n\r\n                if (self.listDataDiscussion.length === 0) {//Add first discussion\r\n                    self.listDataDiscussion.push(newDiscussion);\r\n                }\r\n                else {//Add discussion in position 1\r\n                    self.listDataDiscussion.splice(1, 0, newDiscussion);\r\n                }\r\n\r\n                self.resetDiscussionAttachments();\r\n                self.onClosePopupDiscussion();\r\n                self.notifier.showSucessMessage(\r\n                   printf(bizagi.localization.getResource(\"workportal-project-discussion-created\"), \"\"));\r\n                self.updateTemplateListDiscussion();\r\n\r\n\r\n            }\r\n            else {\r\n                self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n                self.onClosePopupDiscussion();\r\n                self.notifier.showErrorMessage(\r\n                   printf(bizagi.localization.getResource(\"workportal-project-discussion-error-creation\"), \"\"));\r\n            }\r\n\r\n            self.renderUserProfilesAndImages();\r\n\r\n            self.setClassesTagsByDiscussion();\r\n            self.hideOrShowDiscussionsByFilter();\r\n        });\r\n    },\r\n\r\n    getTagsDiscussionBySave: function () {\r\n        var self = this;\r\n        var tagsTextSelected = self.plugins.tagsMultiSelect.value();\r\n        var dataSourceTags = self.plugins.tagsMultiSelect.dataSource.data();\r\n\r\n        var tagsDiscussion = [];\r\n        tagsTextSelected.forEach(function (tagTextSelected) {\r\n            var isGuidTextSelected = self.validateStringIsGuid(tagTextSelected);\r\n\r\n            var tagFound;\r\n            if (isGuidTextSelected) {\r\n                tagFound = dataSourceTags.filter(function (tagSource) {\r\n                    return tagSource.guid === tagTextSelected;\r\n                });\r\n            }\r\n            else {\r\n                tagFound = dataSourceTags.filter(function (tagSource) {\r\n                    var isGuid = self.validateStringIsGuid(tagSource.guid);\r\n                    return tagSource.tag === tagTextSelected && !isGuid;\r\n                });\r\n            }\r\n\r\n            if (tagFound.length === 1) {\r\n                tagsDiscussion.push({\r\n                    guid: isGuidTextSelected ? tagFound[0].guid : tagFound[0].uid,\r\n                    tag: tagFound[0].tag\r\n                });\r\n            }\r\n\r\n        });\r\n\r\n        return tagsDiscussion;\r\n    },\r\n\r\n    //b: minuendo, a: sustraendo\r\n    differenceArrays: function (b, a) {\r\n        return b.filter(function (i) {\r\n            return a.indexOf(i) < 0;\r\n        });\r\n    },\r\n\r\n    getGuidsTagsDiscussionToDelete: function () {\r\n        var self = this;\r\n        var guidsTagsCurrentDiscussion = self.plugins.tagsMultiSelect.value();\r\n        return self.differenceArrays(self.tempTagsBeforeDelete, guidsTagsCurrentDiscussion);\r\n    },\r\n\r\n    /*\r\n     *   UI Functions\r\n     */\r\n    setStateUIShowMoreComments: function ($commentsContainer, state) {\r\n        var $containerButtonMoreComments = $commentsContainer.siblings(\".ui-bizagi-wp-project-discussion-showmore-comments\");\r\n        var $buttonShowMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-comments-button\");\r\n        var $messageNoMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-no-more-comments\");\r\n        var $messageLoadingComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-loading-comments\");\r\n\r\n        if (state === \"ALLOW_MORE_COMMENTS\") {\r\n            $buttonShowMoreComments.show();\r\n            $messageNoMoreComments.hide();\r\n            $messageLoadingComments.hide();\r\n        }\r\n\r\n        if (state === \"LOADING_MORE_COMMENTS\") {\r\n            $buttonShowMoreComments.hide();\r\n            $messageNoMoreComments.hide();\r\n            $messageLoadingComments.show();\r\n        }\r\n\r\n        if (state === \"NO_MORE_COMMENTS\") {\r\n            $buttonShowMoreComments.hide();\r\n            $messageNoMoreComments.show();\r\n            $messageLoadingComments.hide();\r\n        }\r\n    },\r\n\r\n    getCurrentUserInfo: function () {\r\n        return {\r\n            name: bizagi.currentUser.userName,\r\n            id: bizagi.currentUser.idUser,\r\n            picture: \"\"\r\n        };\r\n    },\r\n\r\n    /*Functions about tags*/\r\n\r\n    addGlobalTags: function (tagsDiscussion, createTagsOnServer) {\r\n        var self = this;\r\n\r\n        for (var iTagAdd = 0; iTagAdd < tagsDiscussion.length; iTagAdd += 1) {\r\n            var existTag = self.globalTags.filter(function (tagGlobal) {\r\n                return tagGlobal.tag === tagsDiscussion[iTagAdd].tag;\r\n            });\r\n            if (existTag.length === 0) {\r\n                tagsDiscussion[iTagAdd].globalParent = self.radNumber;\r\n                self.globalTags.push(tagsDiscussion[iTagAdd]);\r\n                if (createTagsOnServer) {\r\n                    self.dataService.postTag(tagsDiscussion[iTagAdd]);\r\n                }\r\n            }\r\n        }\r\n\r\n        //Sync tags\r\n        self.plugins.tagsFilter.dataSource.data(self.globalTags);\r\n        self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\r\n    },\r\n\r\n    removeGlobalTags: function (guidTagsToDelete) {\r\n        var self = this;\r\n        var allGuidsTagsAllDiscussions = $.map(self.listDataDiscussion, function (discussion) {\r\n            return $.map(discussion.tags, function (itemTag) {\r\n                return itemTag.guid;\r\n            });\r\n        });\r\n\r\n        var allGuidsMoreGuidsDelete = allGuidsTagsAllDiscussions.concat(guidTagsToDelete);\r\n\r\n        var secureGuidsForDelete = [];\r\n        guidTagsToDelete.forEach(function (guidDelete) {\r\n            var existGuidOnlyTimeThenDelete = allGuidsMoreGuidsDelete.filter(function (guid) {\r\n                return guid === guidDelete;\r\n            });\r\n            if (existGuidOnlyTimeThenDelete.length === 1) {\r\n                secureGuidsForDelete.push(guidDelete);\r\n            }\r\n        });\r\n\r\n\r\n        secureGuidsForDelete.forEach(function (guidSecureDelete) {\r\n            //delete with service\r\n            var params = {idTag: guidSecureDelete};\r\n            self.dataService.deleteTag(params);\r\n\r\n            //delete globalTags\r\n            for (var iTagGlobal = self.globalTags.length - 1; iTagGlobal >= 0; iTagGlobal -= 1) {\r\n                if (self.globalTags[iTagGlobal].guid === guidSecureDelete) {\r\n                    self.globalTags.splice(iTagGlobal, 1);\r\n                }\r\n            }\r\n        });\r\n\r\n        //Sync tags\r\n        self.plugins.tagsFilter.dataSource.data(self.globalTags);\r\n        self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\r\n    },\r\n\r\n    setClassesTagsByDiscussion: function () {\r\n        var self = this;\r\n        for (var iDiscussion = 0; iDiscussion < self.listDataDiscussion.length; iDiscussion += 1) {\r\n            var textTagsDiscussion = $.map(self.listDataDiscussion[iDiscussion].tags, function (itemTag) {\r\n                return itemTag.guid;\r\n            });\r\n            var tagsBySpace = textTagsDiscussion.join(\" \");\r\n\r\n            $(\".ui-bizagi-wp-project-discussions-item[data-guid='\" + self.listDataDiscussion[iDiscussion].guid + \"']\", self.getContent()).addClass(tagsBySpace);\r\n        }\r\n    },\r\n\r\n    updateTemplateListDiscussion: function () {\r\n\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n        var templateListDiscussions = self.getTemplate(\"project-discussions-list\");\r\n        var user = self.getCurrentUserInfo();\r\n        var contentRenderListDiscussions = templateListDiscussions.render({\r\n            listDataDiscussions: self.listDataDiscussion,\r\n            user: user,\r\n            isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\r\n            returnServedCommentByParentId: function (parentId) {\r\n                return self.returnServedCommentByParentId(parentId);\r\n            }\r\n        });\r\n        for (var i = 0; i < this.listDataDiscussion.length; i++) {\r\n            this.mapTempComments($(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"),\r\n                contentRenderListDiscussions.find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"));\r\n        }\r\n        $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).empty().append(contentRenderListDiscussions);\r\n\r\n        self.plugins.attchComments = self.applyFileAttachments(\"COMMENTS\");\r\n    },\r\n\r\n    showFormAddDiscussion: function (resourceTitlePopup) {\r\n        var self = this;\r\n\r\n        if (self.plugins.attchComments) {\r\n            self.plugins.attchComments.close();\r\n        }\r\n        self.dialogBoxDiscussion.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"650px\",\r\n            modal: true,\r\n            zIndex: 1,\r\n            title: bizagi.localization.getResource(resourceTitlePopup),\r\n            maximize: true,\r\n            open:  $.proxy(self.onOpenPopupDiscussion, self),\r\n            close: function () {\r\n                self.resetDiscussionAttachments();\r\n                self.onClosePopupDiscussion();\r\n            }\r\n        });\r\n    },\r\n\r\n    resetFormDiscussion: function () {\r\n        var self = this;\r\n\r\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n        self.form.subject.val(\"\");\r\n        self.form.description.val(\"\");\r\n\r\n        var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", self.dialogBoxDiscussion.formContent);\r\n        var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", self.dialogBoxDiscussion.formContent);\r\n        $subjectDiscussion.parent().find(\"span\").empty();\r\n        $descriptionDiscussion.parent().next().find(\"span\").empty();\r\n    },\r\n\r\n    renderUserProfile: function(){\r\n        var self = this;\r\n\r\n        var userPicture = $.grep(self.userPictures, function (userPicture) {\r\n            return userPicture.id === bizagi.currentUser.idUser;\r\n        })[0];\r\n\r\n        var base64Prefix = \"data:image/png;base64,\";\r\n        var $parent = $(\".ui-bizagi-wp-project-popupform-user\");\r\n        var $img = $parent.find(\".bz-wp-avatar-img\");\r\n        var $text = $parent.find(\".bz-wp-avatar-label\");\r\n\r\n        if (userPicture) {\r\n            if (userPicture.picture) {\r\n                $img.attr(\"src\", base64Prefix + userPicture.picture);\r\n            } else {\r\n                $img.hide();\r\n                $text.html(userPicture.name.getInitials()).show();\r\n            }\r\n        }  \r\n    },\r\n\r\n    renderUserProfilesAndImages: function () {\r\n        var self = this;\r\n\r\n        var userPicture = $.grep(self.userPictures, function (userPicture) {\r\n            return userPicture.id === bizagi.currentUser.idUser;\r\n        })[0];\r\n\r\n        var base64Prefix = \"data:image/png;base64,\";\r\n\r\n        if (userPicture) {\r\n            $(\".ui-bizagi-wp-project-discussions-create-comment .bz-wp-discussion-username\").html(userPicture.name);\r\n            if (userPicture.picture) {\r\n                $(\".ui-bizagi-wp-project-discussions-item-user img\").attr(\"src\", base64Prefix + userPicture.picture);\r\n                $(\".ui-bizagi-wp-project-popupform-image-current-user\").attr(\"src\", base64Prefix + userPicture.picture);\r\n            } else {\r\n                $(\".ui-bizagi-wp-project-discussions-item-user label.bz-wp-avatar-label\").html(userPicture.name.getInitials()).show();\r\n                $(\".ui-bizagi-wp-project-discussions-item-user img\").hide();\r\n            }\r\n        }\r\n\r\n        for (var iUser = 0; iUser < self.userPictures.length; iUser++) {\r\n            $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-discussion-username\").html(self.userPictures[iUser].name);\r\n            if (self.userPictures[iUser].picture) {\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").attr(\"src\", base64Prefix + self.userPictures[iUser].picture);\r\n            } else {\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").hide();\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] label.bz-wp-avatar-label\").html(self.userPictures[iUser].name.getInitials());\r\n            }\r\n        }\r\n    },\r\n\r\n    /*EVENTS*/\r\n    switchCommentsEvents: function (event) {\r\n\r\n        var self = this;\r\n        var $target = $(event.target);\r\n        var $parent = $target.parent();\r\n\r\n        if ($target.is(\"textarea\")) {\r\n            self.onShowButtonsPanel($target);\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-cancel\")) {\r\n\r\n            self.onCancelComment($target);\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-share\")) {\r\n\r\n            var $container = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\r\n            if (self.validateAddCommentForm($container)) {\r\n                var guid = Math.guid();\r\n                self.onCreateComment($target, guid);\r\n            }\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-view\")) {\r\n            self.onViewComment($target);\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussion-showmore-comments-button\")) {\r\n            self.onViewMoreComments($target);\r\n        } else if ($target.hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\r\n            self.onRemoveFiles($target);\r\n        } else if ($parent.hasClass(\"biz-wp-user-icon-admin\") && $parent.hasClass(\"biz-wp-action-edit-discussion\")) {\r\n            self.onEditDiscussion($target);\r\n        } else if ($parent.hasClass(\"ui-bizagi-wp-project-discussion-delete\")) {\r\n\r\n            $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-discussion-querydelete\"), \"\", \"info\")).done(function () {\r\n                self.onDeleteComment($parent);\r\n            });\r\n\r\n        } else if ($parent.hasClass(\"bz-bizagi-wp-project-discussions-attachment-itemwrapper\")) {\r\n            self.onDownloadAttachment($target.closest(\"li\"));\r\n        }\r\n\r\n        event.stopPropagation();\r\n    },\r\n\r\n    onEditDiscussion: function ($target) {\r\n\r\n        var self = this;\r\n        var $discussionCnt = $target.closest(\".ui-bizagi-wp-project-discussions-item\");\r\n        var guid = $discussionCnt.data(\"guid\");\r\n\r\n        self.setDiscussionsDataByGUID(guid);\r\n        self.showFormAddDiscussion(\"workportal-project-discussion-edit\");\r\n    },\r\n\r\n    setDiscussionsDataByGUID: function (guid) {\r\n\r\n        var self = this;\r\n\r\n        var discussion = self.getDiscussionDataByGUID(guid);\r\n        var $container = $(\".ui-bizagi-wp-project-attachments-list\", self.form.attachments);\r\n\r\n        self.form.edition = {\r\n            guid: guid\r\n        };\r\n\r\n        self.attchDiscussions = {\r\n            addition: discussion.attachments,\r\n            remove: []\r\n        };\r\n\r\n        self.form.title.text(bizagi.localization.getResource(\"workportal-project-discussion-edit\"));\r\n        self.form.subject.val(discussion.name);\r\n        self.form.description.val(discussion.description);\r\n\r\n        var guidTagsDiscussion = $.map(discussion.tags, function (itemTag) {\r\n            return itemTag.guid;\r\n        });\r\n        self.plugins.tagsMultiSelect.value(guidTagsDiscussion);\r\n        self.tempTagsBeforeDelete = [];\r\n        self.tempTagsBeforeDelete = self.tempTagsBeforeDelete.concat(self.plugins.tagsMultiSelect.value());\r\n\r\n        self.renderAttachments(discussion.attachments, \"DISCUSSIONS\", $container);\r\n\r\n    },\r\n\r\n    getDiscussionDataByGUID: function (guid) {\r\n\r\n        var self = this;\r\n        var discussion;\r\n\r\n        for (var i = self.listDataDiscussion.length - 1; i >= 0; i--) {\r\n            if (self.listDataDiscussion[i].guid === guid) {\r\n                discussion = self.listDataDiscussion[i];\r\n                i = 0;\r\n            }\r\n        }\r\n\r\n        return discussion;\r\n    },\r\n\r\n    onViewComment: function ($target) {\r\n        var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-comment-truncatewrapper\");\r\n        $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-shortcomment\");\r\n        $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-longcomment\");\r\n    },\r\n\r\n    onViewMoreComments: function ($target) {\r\n        var self = this;\r\n        var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussion-showmore-comments\");\r\n        var $commentsContainer = $commentWrapper.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\r\n        var idParent = $commentsContainer.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\r\n\r\n        if (!self.commentsList[idParent].total) {\r\n            //only one time call service if total is null\r\n            self.dataService.getCommentsCountByParent(idParent).done(function (response) {\r\n                self.commentsList[idParent].total = response.count;\r\n                self.getMoreComments(idParent, $commentsContainer);\r\n            });\r\n        }\r\n        else {\r\n            self.getMoreComments(idParent, $commentsContainer);\r\n        }\r\n    },\r\n\r\n    getMoreComments: function (idParent, $commentsContainer) {\r\n        var self = this;\r\n\r\n        //validate total comments vs count comments\r\n        if (self.commentsList[idParent].total > self.commentsList[idParent].comments.length) {\r\n\r\n            self.setStateUIShowMoreComments($commentsContainer, \"LOADING_MORE_COMMENTS\");\r\n\r\n            var dateLastComment;\r\n            if (self.commentsList[idParent].comments.length === 0) {\r\n                dateLastComment = self.getDateServer();\r\n            }\r\n            else {\r\n                dateLastComment = self.commentsList[idParent].comments[self.commentsList[idParent].comments.length - 1].date;\r\n            }\r\n\r\n            //substract one millisecond\r\n            dateLastComment -= 1;\r\n\r\n            self.dataService.getCommentsData(\r\n                {\r\n                    dateTime: dateLastComment,\r\n                    idParent: idParent,\r\n                    count: 6\r\n                }\r\n            ).done(function (responseMoreComments) {\r\n\r\n                    if (responseMoreComments.length) {\r\n                        Array.prototype.push.apply(self.commentsList[idParent].comments, responseMoreComments);\r\n                        self.commentsList[idParent].count += responseMoreComments.length;\r\n\r\n                        self.renderCommentByDiscussion($commentsContainer, idParent, responseMoreComments);\r\n                        self.renderUserProfilesAndImages();\r\n\r\n                        if (responseMoreComments.length > 5) {\r\n                            self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\r\n                        } else {\r\n                            self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\r\n                        }\r\n\r\n                        //Get profiles of idUsers not download in this moment\r\n                        var idUsersLoaded = $.map(self.userPictures, function (element) {\r\n                            return element.id;\r\n                        });\r\n\r\n                        var idUsersNewComments = $.map(self.commentsList, function (property) {\r\n                            return $.map(property.comments, function (property) {\r\n                                return property.user;\r\n                            });\r\n                        });\r\n\r\n                        var arrayIdUsersMissingLoad = $(idUsersNewComments).not(idUsersLoaded).get();\r\n                        var csvIdUsersMissingLoad = arrayIdUsersMissingLoad.join(\",\");\r\n\r\n                        self.getDataUsers(csvIdUsersMissingLoad).then(function () {\r\n                            self.renderUserProfilesAndImages();\r\n                        });\r\n\r\n                    }\r\n                    else {\r\n                        self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\r\n                    }\r\n                }).fail(function () {\r\n                    self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\r\n                });\r\n        }\r\n        else {\r\n            self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\r\n        }\r\n\r\n    },\r\n\r\n    renderCommentByDiscussion: function ($container, guidParent, moreComments) {\r\n\r\n        var self = this,\r\n            tmplComment = self.getTemplate(\"project-discussions-comments\"),\r\n            $commentsDOM,\r\n            renderObject = {\r\n                comments: [],\r\n                user: self.getCurrentUserInfo(),\r\n                isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers)\r\n            };\r\n\r\n        if (!moreComments.length) {\r\n            renderObject.comments = self.commentsList[guidParent].comments;\r\n            $commentsDOM = tmplComment.render(renderObject);\r\n            $container.html($commentsDOM);\r\n        } else {\r\n            renderObject.comments = moreComments;\r\n            $commentsDOM = tmplComment.render(renderObject);\r\n            $container.append($commentsDOM);\r\n        }\r\n    },\r\n\r\n    getCommentByGuid: function (parentGuid, commentGuid) {\r\n\r\n        var self = this;\r\n        var commentsList = self.commentsList[parentGuid].comments;\r\n\r\n        for (var i = 0, length = commentsList.length; i < length; i++) {\r\n\r\n            if (commentsList[i].guid === commentGuid) {\r\n                var attachments = [];\r\n\r\n                for (var x = 0, lengthx = commentsList[i].attachments.length; x < lengthx; x++) {\r\n                    attachments.push(commentsList[i].attachments[x].guid);\r\n                }\r\n\r\n                return {\r\n                    attachments: attachments,\r\n                    index: i\r\n                };\r\n            }\r\n        }\r\n\r\n        return {};\r\n    },\r\n\r\n    returnServedCommentByParentId: function (parentId) {\r\n        var self = this;\r\n\r\n        if (typeof self.commentsList[parentId] !== \"undefined\") {\r\n            return self.commentsList[parentId];\r\n        }\r\n    },\r\n\r\n    /*\r\n     *   Events\r\n     */\r\n    onShowButtonsPanel: function ($target) {\r\n        var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\").find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\r\n        $buttonsWrp.show();\r\n    },\r\n\r\n    onRemoveFiles: function ($target) {\r\n        var self = this;\r\n        var $container = $target.closest(\"li\"),\r\n            type = $container.closest(\".ui-bizagi-wp-project-attachments-list\").data(\"type\"),\r\n            fileGuid = $container.data(\"fileguid\");\r\n        var currentFiles, removeFiles, tmpSplice;\r\n\r\n        if (type === \"COMMENT\") {\r\n            var guid = $container.closest(\".ui-bizagi-wp-project-discussions-add-comment\").data(\"guid\");\r\n            currentFiles = self.attchComments[guid].addition;\r\n            removeFiles = self.attchComments[guid].remove;\r\n\r\n        } else {\r\n            currentFiles = self.attchDiscussions.addition;\r\n            removeFiles = self.attchDiscussions.remove;\r\n        }\r\n\r\n        for (var i = 0, length = currentFiles.length - 1; i <= length; i++) {\r\n\r\n            if (currentFiles[i].guid === fileGuid) {\r\n                tmpSplice = currentFiles.splice(i, 1);\r\n                removeFiles.push(tmpSplice[0].guid);\r\n                i = length;\r\n            }\r\n        }\r\n\r\n        $container.remove();\r\n    },\r\n\r\n    onDeleteComment: function ($target) {\r\n        var self = this;\r\n        var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\r\n        var commentGuid = $commentWrapper.data(\"cmmtguid\");\r\n        var parentGuid = $commentWrapper.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\r\n        var comment = self.getCommentByGuid(parentGuid, commentGuid);\r\n\r\n        var params = {\r\n            content: {\r\n                guid: commentGuid\r\n            },\r\n            attachmentsToDelete: comment.attachments\r\n        };\r\n\r\n        $.when(self.dataService.deleteComment(params)).always(function (response) {\r\n            if (response.status === 200 || typeof (response.status) === \"undefined\") {\r\n                self.commentsList[parentGuid].comments.splice(comment.index, 1);\r\n                $commentWrapper.remove();\r\n            } else {\r\n                self.notifier.showErrorMessage(\r\n                    printf(bizagi.localization.getResource(\"workportal-project-discussion-errordelete\"), \"\"));\r\n            }\r\n        });\r\n    },\r\n\r\n    onSuccessFile: function (event, type) {\r\n        var self = this;\r\n        var files = event.files;\r\n        var status = (event.XMLHttpRequest.response) ? JSON.parse(event.XMLHttpRequest.response) : {};\r\n\r\n        if (!status.error) {\r\n            var $wrapper = $(event.sender.element).closest(\".ui-bizagi-wp-project-discussion-textwrapper\");\r\n            var $container = $wrapper.find(\".ui-bizagi-wp-project-attachments-list\");\r\n\r\n            if (type === \"DISCUSSIONS\") {\r\n                self.plugins.attchDiscussions.setStatus(\"SUCCESS\", files[0].guid);\r\n                Array.prototype.push.apply(self.attchDiscussions.addition, files);\r\n            } else {\r\n                self.plugins.attchComments.setStatus(\"SUCCESS\", files[0].guid);\r\n                var guid = $wrapper.data(\"guid\");\r\n\r\n                if (self.attchComments[guid]) {\r\n                    Array.prototype.push.apply(self.attchComments[guid].addition, files);\r\n                } else {\r\n                    self.attchComments[guid] = {\r\n                        addition: files,\r\n                        remove: []\r\n                    };\r\n                }\r\n\r\n                self.onShowButtonsPanel($container.parent());\r\n            }\r\n\r\n            self.renderAttachments(files, type, $container);\r\n        } else {\r\n\r\n            if (type === \"DISCUSSIONS\") {\r\n                self.plugins.attchDiscussions.onErrorFile(event);\r\n            } else {\r\n                self.plugins.attchComments.onErrorFile(event);\r\n            }\r\n        }\r\n    },\r\n\r\n    onDownloadAttachment: function ($liTarget) {\r\n        var self = this;\r\n        var guidAttachment = $liTarget.data(\"fileguid\");\r\n\r\n        if (guidAttachment !== \"\") {\r\n            var nameFile = $liTarget.find(\".bz-bizagi-wp-project-discussions-attachment-filename\").text();\r\n            self.dataService.getDownloadAttachment(guidAttachment, nameFile);\r\n        }\r\n    },\r\n\r\n    onCancelComment: function ($target) {\r\n        var self = this;\r\n        var $commentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\r\n        var $buttonsWrp = $commentContainer.find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\r\n        var $textarea = $commentContainer.find(\"textarea\");\r\n        var $uploadForm = $commentContainer.find(\".ui-bizagi-wp-project-discussions-add-attachments form\");\r\n        var $vlTooltip = $commentContainer.find(\".k-tooltip-validation\");\r\n        var $fileList = $commentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\r\n        var guid = $commentContainer.data(\"guid\");\r\n\r\n        self.attchComments[guid] = {\r\n            addition: [],\r\n            remove: []\r\n        };\r\n\r\n        self.plugins.attchComments.cancelFilesUpload();\r\n\r\n        $uploadForm[0].reset();\r\n        $fileList.empty();\r\n        $textarea.val(\"\");\r\n        $vlTooltip.hide();\r\n        $buttonsWrp.hide();\r\n    },\r\n\r\n    onCreateComment: function ($target, guid) {\r\n        var self = this;\r\n        var $rplWrp = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\r\n        var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\r\n        var $addCommentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\r\n        var $textarea = $addCommentContainer.find(\"textarea\");\r\n        var $uploadList = $addCommentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\r\n        var idParent = $addCommentContainer.data(\"guid\");\r\n        var filesObj = self.prepareFilesToSave(\"COMMENTS\", idParent);\r\n\r\n        var params = {\r\n            content: {\r\n                guid: guid,\r\n                attachments: filesObj.attachments,\r\n                text: $textarea.val(),\r\n                parent: idParent,\r\n                date: self.getDateServer(),\r\n                user: bizagi.currentUser.idUser\r\n            },\r\n            attachmentsToCreate: filesObj.attachmentsToCreate,\r\n            attachmentsToDelete: filesObj.attachmentsToDelete\r\n        };\r\n\r\n        $.when(self.dataService.postComment(params)).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                var $commentContainer = $rplWrp.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\r\n                var newComment = {\r\n                    user: params.content.user,\r\n                    attachments: params.content.attachments,\r\n                    text: params.content.text,\r\n                    guid: params.content.guid,\r\n                    parent: params.content.parent,\r\n                    date: params.content.date\r\n                };\r\n\r\n                //reset for a new comment\r\n                self.attchComments[params.content.parent] = {\r\n                    addition: [],\r\n                    remove: []\r\n                };\r\n\r\n                $textarea.val(\"\");\r\n                $uploadList.empty();\r\n                $buttonsWrp.hide();\r\n\r\n                //Add new comment to the list\r\n                self.commentsList[newComment.parent].comments.unshift(newComment);\r\n                self.renderCommentByDiscussion($commentContainer, newComment.parent, []);\r\n\r\n                self.plugins.attchComments.close();\r\n                self.renderUserProfilesAndImages();\r\n            }\r\n        });\r\n    },\r\n\r\n    renderAttachments: function (files, type, $container) {\r\n        var self = this;\r\n        var attachTemplate = self.getTemplate(\"project-discussions-attachments\");\r\n\r\n        var $fileList = attachTemplate.render({attachments: files, type: type});\r\n        $container.append($fileList);\r\n        if(bizagi.util.isIE()){//\"shake\" files container for IE error\r\n            $(\".ui-bizagi-wp-project-attachments-list li\").hide(10,function() {\r\n                $(this).show();\r\n            });\r\n        }\r\n    },\r\n\r\n    prepareFilesToSave: function (type, guid) {\r\n\r\n        var self = this;\r\n        var files = [],\r\n            fileList = (type === \"COMMENTS\") ? self.attchComments[guid] : self.attchDiscussions,\r\n            attachmentsToCreate = [];\r\n\r\n        fileList = fileList || {addition: [], remove: []};\r\n\r\n        for (var i = 0, length = fileList.addition.length - 1; i <= length; i++) {\r\n            files.push({\r\n                guid: fileList.addition[i].guid,\r\n                name: fileList.addition[i].name\r\n            });\r\n\r\n            attachmentsToCreate.push(fileList.addition[i].guid);\r\n        }\r\n\r\n        return {\r\n            attachments: files,\r\n            attachmentsToCreate: attachmentsToCreate,\r\n            attachmentsToDelete: fileList.remove\r\n        };\r\n    },\r\n\r\n    onClickCancel: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n\r\n        self.resetDiscussionAttachments();\r\n        self.onClosePopupDiscussion();\r\n\r\n        self.plugins.attchDiscussions.cancelFilesUpload();\r\n    },\r\n\r\n    onClosePopupDiscussion: function () {\r\n        var self = this;\r\n        self.resetFormDiscussion();\r\n        self.plugins.attchDiscussions.destroy();\r\n        self.dialogBoxDiscussion.formContent.dialog(\"destroy\");\r\n        self.dialogBoxDiscussion.formContent.detach();\r\n    },\r\n\r\n    onOpenPopupDiscussion: function () {\r\n        var self = this;\r\n\r\n        self.plugins.attchDiscussions = self.applyFileAttachments(\"DISCUSSIONS\");\r\n\r\n        //popup\r\n        self.dialogBoxDiscussion.formContent.parent().css(\"z-index\",10001);\r\n        //overlay\r\n        self.dialogBoxDiscussion.formContent.parent().parent().find(\".ui-widget-overlay\").css(\"z-index\",10001);\r\n\r\n        setTimeout(function () {\r\n            self.form.subject.focus();\r\n        }, 50);\r\n    },\r\n\r\n    onSubmitFormDiscussion: function (event) {\r\n        event.preventDefault();\r\n\r\n        var self = this;\r\n        var guid;\r\n        if (self.validateAddDiscussionForm(self.dialogBoxDiscussion.formContent)) {\r\n            if (self.form.edition.guid) {\r\n                guid = self.form.edition.guid;\r\n                $.proxy(self.sendDataUpdateDiscussion(guid), self);\r\n            } else {\r\n                guid = Math.guid();\r\n                $.proxy(self.sendDataInsertDiscussion(guid), self);\r\n            }\r\n        }\r\n    },\r\n\r\n    restrictedEventsHandler: function () {\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\",\".bz-bizagi-wp-project-discussions-attachment-itemwrapper\", $.proxy(self.switchCommentsEvents, self));\r\n    },\r\n\r\n    eventsHandler: function () {\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        //Add events\r\n        self.form.buttonShowFormNewDiscussion.on(\"click\", $.proxy(self.onNotifyOpenPopup, self));\r\n        self.form.buttonCancel.on(\"click\", $.proxy(self.onClickCancel, self));\r\n        self.form.buttonAddDiscussion.on(\"click\", $.proxy(self.onSubmitFormDiscussion, self));\r\n        self.form.attachments.on(\"click\", \".bz-bizagi-wp-project-discussions-attachment-delete, .bz-bizagi-wp-project-discussions-attachment-itemwrapper\", function (event) {\r\n\r\n            if ($(event.target).hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\r\n                self.onRemoveFiles($(event.target));\r\n            } else {\r\n                self.onDownloadAttachment($(event.target).closest(\"li\"));\r\n            }\r\n\r\n            event.stopPropagation();\r\n        });\r\n\r\n        $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\", \".ui-bizagi-wp-project-discussions-add-comment textarea\" +\r\n            \", .ui-bizagi-wp-project-discussions-comment-buttons-cancel\" +\r\n            \", .ui-bizagi-wp-project-discussions-comment-buttons-share\" +\r\n            \", .ui-bizagi-wp-project-discussion-showmore-comments button\" +\r\n            \", .bz-bizagi-wp-project-discussions-attachment-delete\" +\r\n            \", .ui-bizagi-wp-project-discussion-delete\" +\r\n            \", .bz-bizagi-wp-project-discussions-attachment-itemwrapper\" +\r\n            \", .ui-bizagi-wp-project-discussions-comment-view\" +\r\n            \", .ui-bizagi-wp-project-discussions-items-edition\" +\r\n            \", .biz-wp-action-edit-discussion\", $.proxy(self.switchCommentsEvents, self));\r\n\r\n        self.sub(\"changeProjectWidget\", function () {\r\n            self.resetWidget();\r\n        });\r\n        self.sub(\"OPEN_POPUP_DISCUSSION\", $.proxy(self.onNotifyOpenPopup, self));\r\n    },\r\n\r\n    resetWidget: function () {\r\n        var self = this;\r\n        self.userPictures = [];\r\n        if (self.plugins.attchComments) {\r\n            self.plugins.attchComments.close();\r\n        }\r\n    },\r\n\r\n    clean: function () {\r\n\r\n        var self = this;\r\n        self.resetWidget();\r\n\r\n        if(self.form && self.form.buttonShowFormNewDiscussion){\r\n            self.form.buttonShowFormNewDiscussion.off(\"click\", $.proxy(self.onNotifyOpenPopup, self));\r\n        }\r\n\r\n\r\n        for (var i in self.plugins) {\r\n            if (self.plugins[i] && self.plugins[i].hasOwnProperty(\"destroy\")) {\r\n                if (self.plugins[i].destroy) {\r\n                    self.plugins[i].destroy();\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    mapTempComments: function ($source, $target){\r\n            var $textareaSource = $source.find(\"textarea\");\r\n            var $textareaTarget = $target.find(\"textarea\");\r\n            var $uploadListSource = $source.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\r\n            var $uploadListTarget = $target.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\r\n            $textareaTarget.val($textareaSource.val());\r\n            $uploadListTarget.empty().append($uploadListSource.html());\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.discussions\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.discussions], true);","/*\r\n *   Name: Bizagi Workportal project Discussion Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.discussion.sidebar\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      params = params || {};\r\n      params.supportNav = false;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-discussion-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussion.sidebar\").concat(\"#project-discussion-sidebar\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-discussion-sidebar\");\r\n      self.content = template.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers)});\r\n\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      var $contentWidget = self.getContent();\r\n      $(\".ui-bizagi-wp-project-discussions-sidebar-action-add > a\", $contentWidget).on(\"click\"\r\n         ,$.proxy(self.onShowPopupDiscussion, self));\r\n   },\r\n\r\n   /**\r\n    * Events elements\r\n    */\r\n   onShowPopupDiscussion: function () {\r\n      var self = this;\r\n      self.pub(\"notify\", {\r\n         type: \"OPEN_POPUP_DISCUSSION\",\r\n         args: {}\r\n      });\r\n   }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.discussion.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.discussion.sidebar], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Case State Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.caseState\", {}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n        //Regional\r\n        self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-caseState\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.caseState\").concat(\"#project-caseState-wrapper\"),\r\n            \"project-caseState-popup-release\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.caseState\").concat(\"#project-caseState-popup-release\"),\r\n            \"project-caseState-remaining\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.caseState\").concat(\"#project-caseState-remaining\")\r\n        });\r\n\r\n        self.releaseDialogBox = {};\r\n    },\r\n\r\n    /**\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n\r\n        self.releaseDialogBox.formContent = self.getTemplate(\"project-caseState-popup-release\").render({});\r\n\r\n        return self.content;\r\n    },\r\n\r\n    /*\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n        var cntxtSidebarActivity = self.contextsSidebarActivity || [];\r\n        //Handlers\r\n        cntxtSidebarActivity.forEach(function (context) {\r\n            self.sub(context, $.proxy(self.updateView, self));\r\n        });\r\n\r\n        self.plugins = {};\r\n        self.plugins.popupRelease = {\r\n            form: {\r\n                buttonAccept: $(\"#button-accept-release\", self.releaseDialogBox.formContent),\r\n                buttonCancel: $(\"#button-cancel-release\", self.releaseDialogBox.formContent)\r\n            }\r\n        };\r\n\r\n        self.plugins.popupRelease.form.buttonAccept.on(\"click\", $.proxy(self.onClickAcceptRelease, self));\r\n        self.plugins.popupRelease.form.buttonCancel.on(\"click\", $.proxy(self.onClickCancelRelease, self));\r\n\r\n    },\r\n\r\n    /**\r\n     * Update view when load case\r\n     * @param event\r\n     * @param params\r\n     */\r\n    updateView: function (event, params) {\r\n        var self = this;\r\n        $.extend(self.params, params.args);\r\n        var args = params.args;\r\n        self.getContent().empty();\r\n\r\n        var argsTemplate = {};\r\n\r\n        //is Favorite Case\r\n        argsTemplate.isFavoriteCase = \"off\";\r\n        if (args.isFavorite && JSON.parse(args.isFavorite)) {\r\n            argsTemplate.isFavoriteCase = \"bz-icon-star\";\r\n        }\r\n        else {\r\n            argsTemplate.isFavoriteCase = \"bz-icon-star-outline\";\r\n        }\r\n\r\n        self.showCaseNumber(args, argsTemplate);\r\n\r\n        //Begin Calculated Remaining Date\r\n        if (args.creationDate) {\r\n            var INVARIANT_FORMAT = \"MM/dd/yyyy H:mm\";\r\n            var creationDate = args.creationDate;\r\n            var creationDateObject = bizagi.util.dateFormatter.getDateFromFormat(creationDate, INVARIANT_FORMAT);\r\n            argsTemplate.creationDateFormat = self.getFormattedDate(creationDateObject);\r\n\r\n            var solutionDateObject = bizagi.util.dateFormatter.getDateFromFormat(args.solutionDate, INVARIANT_FORMAT);\r\n            argsTemplate.solutionDateFormat = self.getFormattedDate(solutionDateObject);\r\n\r\n            var currentDate = new Date();\r\n            self.calculateDataForTemplate(argsTemplate, creationDateObject, currentDate, solutionDateObject, args);\r\n        }\r\n        $(self.getContent()).on(\"click\", \".show-diagram-case\", function () {\r\n            var isAdhoc = false;\r\n            if (!self.params.isAdhocProcess || typeof self.params.isAdhocProcess === 'undefined') {\r\n                isAdhoc = false;\r\n            } else {\r\n                isAdhoc = true;\r\n            }\r\n            if (isAdhoc) {\r\n                self.showGraphicQuery({ idCase: self.params.idCaseForGraphicQuery || self.params.idCase, idWorkflow: self.params.idWorkFlow, isAdhoc: true, idProcess: self.params.idAdhocProcess });\r\n            } else {\r\n                self.showGraphicQuery({ idCase: self.params.idCaseForGraphicQuery || self.params.idCase, idWorkflow: self.params.idWorkFlow });\r\n            }\r\n\r\n        });\r\n\r\n        $(self.getContent()).on(\"click\", \".show-process-help\", function () {\r\n            self.showHelpUrl(self.params.helpUrl);\r\n        });\r\n\r\n    },\r\n\r\n    /**\r\n     * Calculate percent bar\r\n     * @param argsTemplate\r\n     * @param creationDateObject\r\n     * @param currentDate\r\n     * @param solutionDateObject\r\n     * @param args\r\n     */\r\n    calculateDataForTemplate: function (argsTemplate, creationDateObject, currentDate, solutionDateObject, args) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        var paramsEffectiveDuration = {};\r\n        paramsEffectiveDuration.idUser = bizagi.currentUser.idUser;\r\n        if (bizagi.util.parseBoolean(args.isOpen)) {\r\n            paramsEffectiveDuration.fromDate = creationDateObject.getTime();\r\n            paramsEffectiveDuration.toDate = currentDate.getTime();\r\n        }\r\n        else {\r\n            paramsEffectiveDuration.fromDate = solutionDateObject.getTime();\r\n            paramsEffectiveDuration.toDate = currentDate.getTime();\r\n        }\r\n\r\n        var differenceCreationToCurrent = paramsEffectiveDuration.toDate - paramsEffectiveDuration.fromDate;\r\n        var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - differenceCreationToCurrent), null, false);\r\n        if (bizagi.util.parseBoolean(args.isOpen)) {\r\n            argsTemplate.relativeTimeState = bizagi.localization.getResource(\"workportal-project-case-state-opened\").replace(\"%s\", relativeTime);\r\n            argsTemplate.colorStateCase = \"Opened\";\r\n        }\r\n        else {\r\n            argsTemplate.relativeTimeState = bizagi.localization.getResource(\"workportal-project-case-state-closed\").replace(\"%s\", relativeTime);\r\n            argsTemplate.colorStateCase = \"Closed\";\r\n        }\r\n\r\n        argsTemplate.percentCompleteBar = 100;\r\n        argsTemplate.isOpen = bizagi.util.parseBoolean(args.isOpen);\r\n        //Update widget\r\n        var contentTemplate = self.getTemplate(\"project-caseState-remaining\");\r\n        contentTemplate\r\n            .render($.extend(args, argsTemplate))\r\n            .appendTo($(\"#ui-bizagi-remaining\", $content));\r\n    },\r\n\r\n    /**\r\n     * Show case number\r\n     * @param args\r\n     * @param argsTemplate\r\n     */\r\n    showCaseNumber: function (args, argsTemplate) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n        var contentTemplate = self.getTemplate(\"project-caseState\");\r\n        var isAdhoc = false;\r\n        if (!this.params.isAdhocProcess || typeof this.params.isAdhocProcess === 'undefined') {\r\n            isAdhoc = false;\r\n        }\r\n        else {\r\n            isAdhoc = this.params.isAdhocProcess;\r\n        }\r\n\r\n        self.params.helpUrl = bizagi.util.validateUrlWellFormed(self.params.helpUrl);\r\n\r\n        contentTemplate\r\n            .render(\r\n                $.extend(\r\n                    args,\r\n                    argsTemplate,\r\n                    {\r\n                        security: bizagi.menuSecurity,\r\n                        isAdhocProcess: isAdhoc,\r\n                        urlHelp: !bizagi.util.isEmpty(self.params.helpUrl)\r\n                    }\r\n                )\r\n            )\r\n            .appendTo($content);\r\n        //Handle events\r\n        $(\".case-summary-favorite\", $content).on(\"click\", $.proxy(self.onClickFavorite, self));\r\n        // Set back and next case navigation\r\n        $(\".case-summary-back\", self.content).on(\"click\", $.proxy(self.goToCase, self, 'back'));\r\n        $(\".case-summary-next\", self.content).on(\"click\", $.proxy(self.goToCase, self, 'next'));\r\n\r\n        self.showBackNextNavigation();\r\n    },\r\n\r\n    /**\r\n     * Get Format date\r\n     * @param dateObj\r\n     * @returns {string}\r\n     */\r\n    getFormattedDate: function (dateObj) {\r\n        var self = this;\r\n        var monthsNames = self.datePickerRegional.monthNames;\r\n        var shortMonth = dateObj.getMonth();\r\n        var bizagiLanguage = BIZAGI_LANGUAGE;\r\n        if (bizagiLanguage != null && bizagiLanguage != undefined && bizagiLanguage.length > 0 && bizagiLanguage.substring(0, 2) == \"fr\")\r\n            return $.datepicker.formatDate(\"dd\", dateObj) + \" \" + monthsNames[shortMonth];\r\n        else\r\n            return monthsNames[shortMonth] + \" \" + $.datepicker.formatDate(\"dd\", dateObj);\r\n    },\r\n\r\n    /***\r\n     * Events\r\n     */\r\n    onClickFavorite: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n        var favoriteOptions = {};\r\n        if ($(event.target).hasClass(\"bz-icon-star-outline\")) {\r\n            favoriteOptions = {\r\n                idObject: self.params.idCase,\r\n                favoriteType: \"CASES\"\r\n            };\r\n            $.when(self.dataService.addFavorite(favoriteOptions)).done(function (favoritesData) {\r\n                self.params.guidFavorite = favoritesData.idFavorites;\r\n                $(event.target).removeClass(\"bz-icon-star-outline\");\r\n                $(event.target).addClass(\"bz-icon-star\");\r\n            });\r\n        }\r\n        else {\r\n            favoriteOptions = {\r\n                idObject: self.params.guidFavorite,\r\n                favoriteType: \"CASES\"\r\n            };\r\n            $.when(self.dataService.delFavorite(favoriteOptions)).done(function () {\r\n                $(event.target).addClass(\"bz-icon-star-outline\");\r\n                $(event.target).removeClass(\"bz-icon-star\");\r\n            });\r\n        }\r\n    },\r\n\r\n    showHelpUrl: function (urlHelp) {\r\n        window.open(urlHelp);\r\n    },\r\n\r\n    /**\r\n     Events\r\n     */\r\n    onSelectMenu: function (event, ui) {\r\n        var self = this;\r\n        if ($(event.currentTarget).find(\"i\").length === 0) {\r\n            var item = $(ui.item).data(\"item\");\r\n            switch (item) {\r\n                case \"reassing\":\r\n                    self.onClickMenuReasign();\r\n                    break;\r\n                case \"release\":\r\n                    self.onClickMenuRelease();\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Executed when user reasign case\r\n     */\r\n    onClickMenuReasign: function () {\r\n        var self = this;\r\n        var idCase = self.params.idCase;\r\n        var idWorkItem = self.params.idWorkitem;\r\n        bizagi.loader.startAndThen(\"admin\").then(function () {\r\n            $.when(self.publish(\"showDialogWidget\", {\r\n                widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,\r\n                data: {\r\n                    \"idCase\": idCase,\r\n                    \"idWorkItem\": idWorkItem\r\n                },\r\n                closeVisible: false,\r\n                maximize: true,\r\n                modalParameters: {\r\n                    title: bizagi.localization.getResource(\"render-actions-reassign\"),\r\n                    width: \"910px\",\r\n                    id: \"CaseAdmin\"\r\n                }\r\n            }));\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Triggered when select option from contextual menu\r\n     */\r\n    onClickMenuRelease: function () {\r\n        var self = this;\r\n        self.releaseDialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"660px\",\r\n            modal: true,\r\n            title: bizagi.localization.getResource(\"workportal-widget-dialog-box-release-ok\"),\r\n            maximize: true,\r\n            close: function () {\r\n                self.releaseDialogBox.formContent.dialog(\"destroy\");\r\n                self.releaseDialogBox.formContent.detach();\r\n            }\r\n        });\r\n    },\r\n\r\n\r\n    /**\r\n     * Triggered when user click over accept button\r\n     */\r\n    onClickAcceptRelease: function () {\r\n        var self = this;\r\n        var params = {\r\n            idCase: self.params.idCase,\r\n            idWorkItem: self.params.idWorkitem\r\n        };\r\n        $.when(self.dataService.releaseActivity(params)).done(function (data) {\r\n            var status = data.status ? data.status : \"\";\r\n            var message;\r\n            switch (status) {\r\n                case \"Success\":\r\n                    //go to inbox\r\n                    self.publish(\"changeWidget\", {\r\n                        widgetName: bizagi.workportal.currentInboxView\r\n                    });\r\n                    break;\r\n\r\n                case \"ConfigurationError\":\r\n                    message = self.getResource(\"workportal-widget-dialog-box-release-configuration-error-message\").replace(\"{0}\", params.idWorkItem);\r\n                    bizagi.showMessageBox(message, self.getResource(\"workportal-widget-dialog-box-release-error\"), \"error\", false);\r\n                    break;\r\n\r\n                default:\r\n                    message = self.getResource(\"workportal-widget-dialog-box-release-error-message\").replace(\"{0}\", params.idWorkItem);\r\n                    bizagi.showMessageBox(message, self.getResource(\"workportal-widget-dialog-box-release-error\"), \"error\", false);\r\n                    break;\r\n            }\r\n        }).fail(function () {\r\n            var message = self.getResource(\"workportal-widget-dialog-box-release-error-message\").replace(\"{0}\", params.idWorkItem);\r\n            bizagi.showMessageBox(message, self.getResource(\"workportal-widget-dialog-box-release-error\"), \"error\", false);\r\n        });\r\n        self.releaseDialogBox.formContent.dialog(\"destroy\");\r\n        self.releaseDialogBox.formContent.detach();\r\n    },\r\n\r\n    /**\r\n     * Close dialog release case\r\n     */\r\n    onClickCancelRelease: function () {\r\n        var self = this;\r\n        self.releaseDialogBox.formContent.dialog(\"destroy\");\r\n        self.releaseDialogBox.formContent.detach();\r\n    },\r\n\r\n    /**\r\n     * Call service effective duration by schedule work\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    callGetEffectiveDuration: function (params) {\r\n        var self = this;\r\n        var d = $.Deferred();\r\n\r\n        if (params.fromDate) {\r\n            $.when(\r\n                self.dataService.getEffectiveDuration(params)\r\n            ).done(function (data) {\r\n                d.resolve(data);\r\n            });\r\n        }\r\n        else {\r\n            d.resolve(null);\r\n        }\r\n\r\n        return d.promise();\r\n    },\r\n\r\n    /**\r\n     * Clean plugins and events\r\n     */\r\n    clean: function () {\r\n        var self = this;\r\n        $(\".show-diagram-case\", self.getContent()).off();\r\n        var cntxtSidebarActivity = self.contextsSidebarActivity || [];\r\n        this.params = {};\r\n        cntxtSidebarActivity.forEach(function (context) {\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n        });\r\n    },\r\n\r\n    goToCase: function (action) {\r\n        var self = this;\r\n        var idCase = (action == 'back' ? self.getBackCase() : self.getNextCase());\r\n        if (idCase > 0) {\r\n            self.publish(\"executeAction\", {\r\n                action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                idCase: idCase\r\n            });\r\n        }\r\n    },\r\n\r\n    getListKey: function () {\r\n        var self = this;\r\n        bizagi.lstIdCases = bizagi.lstIdCases || {};\r\n        if (bizagi.lstIdCases.length > 1) {\r\n            for (var i = 0; i < bizagi.lstIdCases.length; i++) {\r\n                if (self.params.idCase == bizagi.lstIdCases[i]) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n        return -1;\r\n    },\r\n\r\n    getNextCase: function () {\r\n        var self = this;\r\n        var nextIdCase = 0;\r\n        var key = self.getListKey();\r\n\r\n        // Check if last element\r\n        if (bizagi.lstIdCases.length == (key + 1) || bizagi.lstIdCases.length == 1) {\r\n            nextIdCase = -1;\r\n        } else {\r\n            nextIdCase = bizagi.lstIdCases[key + 1];\r\n        }\r\n\r\n        return nextIdCase;\r\n    },\r\n\r\n    getBackCase: function () {\r\n        var self = this;\r\n        var prevIdCase = 0;\r\n        var key = self.getListKey();\r\n\r\n        // Check if first element\r\n        if (key == 0) {\r\n            prevIdCase = -1;\r\n        } else {\r\n            prevIdCase = bizagi.lstIdCases[key - 1] || -1;\r\n        }\r\n\r\n        return prevIdCase;\r\n    },\r\n\r\n    showBackNextNavigation: function () {\r\n        var self = this;\r\n        var nextCase = self.getNextCase();\r\n        var backCase = self.getBackCase();\r\n        nextCase <= 0 ? $(\".case-summary-next\", self.content).hide() : $(\".case-summary-next\", self.content).show();\r\n        backCase <= 0 ? $(\".case-summary-back\", self.content).hide() : $(\".case-summary-back\", self.content).show();\r\n\r\n        if (nextCase <= 0 && backCase <= 0) {\r\n            $(\".content-right-sidebar\").removeClass(\"bz-state-number--active-case\");\r\n            $(\".bz-case-navigation\").hide();\r\n        }\r\n        else {\r\n            $(\".content-right-sidebar\").addClass(\"bz-state-number--active-case\");\r\n            $(\".bz-case-navigation\").show();\r\n        }\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.caseState\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.caseState]);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Activity State Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.activityState\", {}, {\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n      //Regional\r\n      self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-activityState-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.activityState\").concat(\"#project-activityState-wrapper\")\r\n      });\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /*\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      self.contextsSidebarActivity.forEach(function (context) {\r\n         self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n\r\n   },\r\n\r\n   updateView: function (event, params) {\r\n      var self = this,\r\n         args = params.args;\r\n      self.params = args;\r\n      self.getContent();\r\n\r\n      var argsTemplate = {};\r\n      var currentState = args.currentState || [];\r\n\r\n      var currentWorkitem = currentState.filter(function (objectWorkItem) { return objectWorkItem.idWorkItem == args.idWorkitem; })[0];\r\n      \r\n\r\n      if (currentWorkitem) {\r\n         argsTemplate.activityName = currentWorkitem.state;\r\n         argsTemplate.activityIsEvent = bizagi.util.parseBoolean(currentWorkitem.isEvent);\r\n\r\n\r\n         var INVARIANT_FORMAT = \"MM/dd/yyyy H:mm\";\r\n         var initDateObject = bizagi.util.dateFormatter.getDateFromFormat(currentWorkitem.entryDateWorkItem, INVARIANT_FORMAT);\r\n         if (initDateObject.getTime) {\r\n            argsTemplate.initDateFormat = self.getFormattedDate(initDateObject);\r\n         }\r\n\r\n         var currentDate = new Date();\r\n         var estimatedSolutionDateObject = bizagi.util.dateFormatter.getDateFromFormat(currentWorkitem.estimatedSolutionDate, INVARIANT_FORMAT);\r\n         argsTemplate.estimatedSolutionDateFormat = \"\";\r\n\r\n         if (initDateObject.getTime && estimatedSolutionDateObject.getTime && currentWorkitem) {\r\n            self.calculateDataForTemplate(currentWorkitem, argsTemplate, initDateObject, currentDate, estimatedSolutionDateObject,currentState);\r\n         }\r\n         else {\r\n            //Update widget\r\n            self.updateTemplateWidget(argsTemplate,currentState);\r\n         }\r\n      }\r\n   },\r\n\r\n   initilizeActionMenu: function (currentState) {\r\n      var self = this;\r\n      var allowsReassign = false;\r\n\r\n      if (currentState && currentState.length > 0) {\r\n         for (j = 0; j < currentState.length; ++j) {\r\n            if (currentState[j] && self.params && currentState[j].idWorkItem == self.params.idWorkitem) {\r\n               allowsReassign = bizagi.util.parseBoolean(currentState[j].allowsReassign) || false;\r\n            }\r\n         }\r\n      }\r\n      var btReassing = $(\"#bt-case-action-reassing\", self.content);\r\n      var btShareActivity= $(\"#ui-bizagi-wp-project-activity-button:not(.ui-bizagi-wp-project-activity-shared)\", self.content);\r\n\r\n      if (allowsReassign) {\r\n         btReassing.show();\r\n      }\r\n      btReassing.on(\"click\", function(){\r\n         self.onClickMenuReasign();\r\n      });\r\n      btShareActivity.on(\"click\", function(){\r\n         self.onClickShareActivity();\r\n      });\r\n   },\r\n   /**\r\n     * Executed when user reasign case\r\n     */\r\n    onClickMenuReasign: function () {\r\n      var self = this;\r\n      var idCase = self.params.idCase;\r\n      var idWorkItem = self.params.idWorkitem;\r\n      bizagi.loader.startAndThen(\"admin\").then(function () {\r\n         $.when(self.publish(\"showDialogWidget\", {\r\n            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,\r\n            data: {\r\n               \"idCase\": idCase,\r\n               \"idWorkItem\": idWorkItem\r\n            },\r\n            closeVisible: false,\r\n            maximize: true,\r\n            modalParameters: {\r\n               title: bizagi.localization.getResource(\"render-actions-reassign\"),\r\n               width: \"910px\",\r\n               id: \"CaseAdmin\"\r\n            }\r\n         }));\r\n      });\r\n  },\r\n\r\n   /**\r\n    * let share the activity\r\n    */\r\n   onClickShareActivity: function () {\r\n         var self = this;\r\n         var params= {\r\n            \"idWorkItem\": self.params.idWorkitem\r\n         };\r\n         var button=$(\"#ui-bizagi-wp-project-activity-button\", self.content);\r\n         button.attr(\"disabled\", true);\r\n         $.when(self.dataService.getShareActivity(params)).done(function (data) {\r\n            var notifier = window.parent.bizagi.injector.get('notifier');\r\n            if (data.value===true) {\r\n               button.addClass(\"ui-bizagi-wp-project-activity-shared\")\r\n                  .unbind(\"click\");\r\n               notifier.showSucessMessage(bizagi.localization.getResource(\"workportal-project-activity-success-message\"), '');\r\n            } else {\r\n               notifier.showErrorMessage(bizagi.localization.getResource(\"workportal-project-activity-error-message\"), '');\r\n            }\r\n         }).always(function () {\r\n            button.attr(\"disabled\", false);\r\n         });\r\n   },\r\n\r\n   calculateDataForTemplate: function (currentWorkitem, argsTemplate, creationDateObject, currentDate, estimatedSolutionDateObject, currentState) {\r\n      var self = this;\r\n\r\n      var diffMillisecondsOpened = new Date(Date.now() - creationDateObject.getTime());\r\n      var diffMillisecondsCurrentToEstimated = (currentDate.getTime() - estimatedSolutionDateObject.getTime());\r\n      var diffMillisecondsCreationToSolution = (creationDateObject.getTime() - estimatedSolutionDateObject.getTime());\r\n\r\n      var paramsEffectiveDurationOpened = {\r\n         idUser: bizagi.currentUser.idUser,\r\n         fromDate: creationDateObject.getTime(),\r\n         toDate: Date.now()\r\n      };\r\n\r\n      var currentDateExceededEstimatedDate = false;\r\n      var paramsEffectiveDuration = {\r\n         idUser: bizagi.currentUser.idUser,\r\n         fromDate: currentDate.getTime(),\r\n         toDate: estimatedSolutionDateObject.getTime()\r\n      };\r\n      var paramsEffectiveDurationInitialToEstimated = {};\r\n      if (diffMillisecondsCurrentToEstimated > 0) {//Exceeded limit estimatedSolution\r\n         paramsEffectiveDuration.fromDate = estimatedSolutionDateObject.getTime();\r\n         paramsEffectiveDuration.toDate = currentDate.getTime();\r\n         currentDateExceededEstimatedDate = true;\r\n      }\r\n      else {\r\n         paramsEffectiveDurationInitialToEstimated.idUser = bizagi.currentUser.idUser;\r\n         paramsEffectiveDurationInitialToEstimated.fromDate = creationDateObject.getTime();\r\n         paramsEffectiveDurationInitialToEstimated.toDate = estimatedSolutionDateObject.getTime();\r\n      }\r\n\r\n      var differenceCreatedToCurrent = paramsEffectiveDurationOpened.toDate - paramsEffectiveDurationOpened.fromDate;\r\n      var differenceCurrentToEstimated = paramsEffectiveDuration.toDate - paramsEffectiveDuration.fromDate;\r\n      var differenceInitialToEstimated = diffMillisecondsCurrentToEstimated > 0 ? 0 : paramsEffectiveDurationInitialToEstimated.toDate - paramsEffectiveDurationInitialToEstimated.fromDate;\r\n\r\n      var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - differenceCreatedToCurrent), null, false);\r\n      argsTemplate.colorState = currentWorkitem.colorState;\r\n      argsTemplate.relativeTimeState = bizagi.localization.getResource(\"workportal-project-activity-state-opened\").replace(\"%s\", relativeTime);\r\n      argsTemplate.percentCompleteBar = 100;\r\n\r\n      if (diffMillisecondsCreationToSolution === 0) {\r\n         argsTemplate.showEstimatedSolutionDate = false;\r\n      }\r\n      else {\r\n         argsTemplate.showEstimatedSolutionDate = true;\r\n         if (currentDateExceededEstimatedDate === false) {\r\n            var percentBar = self.getPercentBar((differenceInitialToEstimated / 1000 / 60), (differenceCurrentToEstimated / 1000 / 60));\r\n            argsTemplate.percentCompleteBar = percentBar.percent;\r\n         }\r\n      }\r\n\r\n      if (currentWorkitem) {\r\n         argsTemplate.isEvent = bizagi.util.parseBoolean(currentWorkitem.isEvent);\r\n         argsTemplate.canShareActivity = currentWorkitem.canShareActivity;\r\n         argsTemplate.isShared = currentWorkitem.isShared;\r\n      }\r\n\r\n      argsTemplate.estimatedSolutionDateFormat = self.getFormattedDate(estimatedSolutionDateObject);\r\n\r\n      //Update widget\r\n      self.updateTemplateWidget(argsTemplate, currentState);\r\n   },\r\n\r\n   getPercentBar: function (totalMinutes, sectionMinutes) {\r\n      var response = {};\r\n      response.percent = Math.round((1 - (sectionMinutes / totalMinutes)) * 100);\r\n      return response;\r\n   },\r\n\r\n\r\n   updateTemplateWidget: function (argsTemplate, currentState) {\r\n      var self = this,\r\n         $content = self.getContent().empty();\r\n      if (bizagi.override.enableShareActivity===false) {\r\n         argsTemplate.canShareActivity=false;\r\n         argsTemplate.isShared=false;\r\n      }\r\n      //Update widget\r\n      var contentTemplate = self.getTemplate(\"project-activityState-wrapper\");\r\n      contentTemplate\r\n         .render(argsTemplate).appendTo($content);\r\n\r\n      if (currentState.length > 0) {\r\n         self.initilizeActionMenu(currentState);\r\n      }\r\n      self.shareActivityTooltip();\r\n   },\r\n\r\n   /**\r\n    * show tooltip when the activity is shared or can be\r\n    */\r\n   shareActivityTooltip: function(){\r\n      var self = this;\r\n      var activityButton=$(\"#ui-bizagi-wp-project-activity-button\", self.content);\r\n      activityButton.on('mouseenter', function () {\r\n         var texto=activityButton.hasClass(\"ui-bizagi-wp-project-activity-shared\")?\"workportal-project-activity-shared\":\"workportal-project-activity-share\";\r\n         activityButton.attr(\"title\", bizagi.localization.getResource(texto));\r\n      });\r\n      activityButton.tooltip({\r\n         tooltipClass: \"custom-tooltip-styling-bottom-bar\", \r\n         position: {\r\n            my: 'right top',\r\n            at: 'left top',\r\n            of: activityButton,\r\n            collision: 'flip'\r\n         }\r\n      });\r\n   },\r\n\r\n   getFormattedDate: function (dateObj) {\r\n      var self = this;\r\n      var monthsNames = self.datePickerRegional.monthNames;\r\n      var shortMonth = dateObj.getMonth();\r\n      var bizagiLanguage = BIZAGI_LANGUAGE;\r\n      if (bizagiLanguage != null && bizagiLanguage != undefined && bizagiLanguage.length > 0 && bizagiLanguage.substring(0, 2) == \"fr\")\r\n         return $.datepicker.formatDate(\"dd\", dateObj) + \" \" + monthsNames[shortMonth];\r\n      else\r\n         return monthsNames[shortMonth] + \" \" + $.datepicker.formatDate(\"dd\", dateObj);\r\n   },\r\n\r\n   clean: function () {\r\n      var self = this;\r\n      var cntxtSidebarActivity = self.contextsSidebarActivity || [];\r\n      this.params = {};\r\n      cntxtSidebarActivity.forEach(function (context) {\r\n         self.unsub(context, $.proxy(self.updateView, self));\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n   callGetEffectiveDuration: function (params) {\r\n      var self = this;\r\n      var d = $.Deferred();\r\n\r\n      //Fix .NET, multiple call service with same data in a few milliseconds\r\n      setTimeout(function () {\r\n         if (params.fromDate) {\r\n            $.when(\r\n               self.dataService.getEffectiveDuration(params)\r\n            ).done(function (data) {\r\n               d.resolve(data);\r\n            });\r\n         }\r\n         else {\r\n            d.resolve(null);\r\n         }\r\n      }, 200);\r\n\r\n\r\n      return d.promise();\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.activityState\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.activityState]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Process State Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.processState\", {}, {\r\n      /*\r\n       *   Constructor\r\n       */\r\n      init: function (workportalFacade, dataService, params) {\r\n         var self = this;\r\n\r\n         // Call base\r\n         self._super(workportalFacade, dataService, params);\r\n\r\n         self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n         //Load templates\r\n         self.loadTemplates({\r\n            \"project-process-state\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.processState\").concat(\"#project-process-state\")\r\n         });\r\n      },\r\n\r\n      /*\r\n       * Renders the template defined in the widget\r\n       */\r\n      renderContent: function () {\r\n         var self = this;\r\n         var template = self.getTemplate(\"project-process-state\");\r\n         self.content = template.render({});\r\n         return self.content;\r\n      },\r\n\r\n      /*\r\n       * links events with handlers\r\n       */\r\n      postRender: function () {\r\n         var self = this;\r\n\r\n         //Handlers\r\n         self.contextsSidebarActivity.forEach(function(context){\r\n            self.sub(context, $.proxy(self.updateView, self));\r\n         });\r\n      },\r\n\r\n      updateView: function (event, params) {\r\n         var self = this,\r\n            args = params.args,\r\n            $content = self.getContent().empty();\r\n         self.params = args;\r\n\r\n         var argsTemplate = {};\r\n         argsTemplate[\"showParentProcess\"] = (args[\"idParentCase\"] >= 1) ? true : false;\r\n         argsTemplate[\"parentProcess\"] = {\r\n            \"displayName\": args[\"parentDisplayName\"],\r\n            \"idCase\": args[\"idParentCase\"],\r\n            \"idWorkItem\": args[\"idWorkItem\"],\r\n            \"idTask\": args[\"idTask\"] == \"0\" ? \"\" : args[\"idTask\"],\r\n            \"idWorkflow\": args[\"idWorkflowParentCase\"]\r\n         };\r\n\r\n         //Update widget\r\n         var contentTemplate = self.getTemplate(\"project-process-state\");\r\n         contentTemplate\r\n            .render($.extend(args, argsTemplate))\r\n            .appendTo($content);\r\n\r\n         //handle click\r\n\r\n         $(\"#go-to-parent-case\", $content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\r\n\r\n      },\r\n\r\n      onClickGoToParentCase: function (event) {\r\n         event.preventDefault();\r\n         var self = this;\r\n\r\n         self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\r\n      },\r\n\r\n      clean: function () {\r\n         var self = this;\r\n         self.params = {};\r\n         self.contextsSidebarActivity.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n   }\r\n);\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.processState', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.processState]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Users Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.users\", {}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, relatedusers, params) {\r\n        var self = this;\r\n        self.relatedusers = relatedusers;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n        self.plugins = {};\r\n        self.users = [];\r\n        self.loadedUsers = false;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-users\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.users\").concat(\"#project-users-main\")\r\n        });\r\n    },\r\n\r\n    /*\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    /*\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        //Handlers\r\n        self.contextsSidebarActivity.forEach(function(context){\r\n            self.sub(context, $.proxy(self.updateView, self));\r\n        });\r\n        self.sub('ON_RENDER_FINISH', $.proxy(self.onRenderFinish, self));\r\n    },\r\n\r\n    updateView: function (event, params) {\r\n        var self = this;\r\n        self.params = params;\r\n        setTimeout(function(){\r\n            if(self.loadedUsers === false){\r\n                self.onRenderFinish();\r\n            }\r\n        }, 500);\r\n    },\r\n\r\n    onRenderFinish: function(){\r\n        var self = this;\r\n        var args = self.params.args;\r\n        var $content = self.getContent().empty();\r\n        self.loadedUsers = true;\r\n\r\n        var contentTemplate = self.getTemplate(\"project-users\");\r\n        contentTemplate.render().appendTo($content);\r\n        self.showCreatorInformation($content);\r\n\r\n        var typesAssignUser = [{\r\n            id: args.createdBy.userId,\r\n            typeName: \"owner\"\r\n        }];\r\n\r\n        if (args.idCase > 0) {\r\n            self.relatedusers.render(self.content, \".relatedusers-wrapper\", args.idCase, typesAssignUser);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * show the information of the creator case\r\n     * @param {string} $content html conteiner\r\n     */\r\n    showCreatorInformation: function ($content) {\r\n        var self = this;\r\n        var params = {\r\n           userIds: self.params.args.createdBy.userId,\r\n           width: 50,\r\n           height: 50\r\n        };\r\n  \r\n        self.dataService.getUsersData(params).done(function (user) {\r\n            var userInfo = usersAdapter.createJsonUserInfo(\r\n                user[0].id,\r\n                user[0].name,\r\n                user[0].username,\r\n                user[0].picture?\"data:image/png;base64,\"+user[0].picture:undefined,\r\n                user[0].email,\r\n                user[0].name.getInitials(),\r\n                false,\r\n                true,\r\n                [],\r\n                []\r\n                );\r\n            $content.find(\"#ui-bizagi-wp-project-users-wrapper .ui-bizagi-wp-project-users-creator-info\").userinformation(self, { user: userInfo });\r\n        });\r\n    },\r\n\r\n    clean: function () {\r\n        var self = this;\r\n        self.loadedUsers = false;\r\n        self.contextsSidebarActivity.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n        });\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.users\", [\"workportalFacade\", \"dataService\", \"relatedusers\", bizagi.workportal.widgets.project.users]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Subprocesses Data Tooltip\r\n *   Author: Bizagi Latam\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.subprocesses.data\", {\r\n    \r\n    responseSubprocessState: {},\r\n    responseSubprocess: function(newValue){\r\n        if(newValue){\r\n            responseSubprocessState = newValue;\r\n        }\r\n        return responseSubprocessState;\r\n    },\r\n\r\n    auxArrayListSubprocessesState: [],\r\n    auxArrayListSubprocesses: function(newItem){\r\n        if(newItem){\r\n            if(jQuery.isArray(newItem) && newItem.length === 0){\r\n                this.auxArrayListSubprocessesState.length = 0; //clean array if change reference\r\n            }\r\n            else{\r\n                return this.auxArrayListSubprocessesState.push(newItem);\r\n            }\r\n        }\r\n        else{\r\n            return this.auxArrayListSubprocessesState;\r\n        }\r\n    }\r\n}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        // Init static properties\r\n        self.Class.auxArrayListSubprocesses([]);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-subprocesses-tootip-custom-properties\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.subprocesses.data\").concat(\"#project-subprocesses-tooltip-custom-properties-wrapper\")\r\n        });\r\n    },\r\n\r\n\r\n    initializeTooltip: function (selectorTooltip) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        $(selectorTooltip, $content).tooltip({\r\n            position: {\r\n                collision: \"flipfit\",\r\n                my: \"right center\", at: \"left-10 center\"\r\n            },\r\n            show: null, // show immediately\r\n            content: function () {\r\n\r\n                var idCase = $(this).closest(\"li\").find(\"#idCase\").val();\r\n                var itemsFinded = self.Class.auxArrayListSubprocesses().filter(function(item){\r\n                    return item.idCase == idCase;\r\n                });\r\n\r\n                var indexSubprocess, idCustData, text;\r\n                if(itemsFinded.length > 0){\r\n                    indexSubprocess = itemsFinded[0].indexSubprocess;\r\n                    idCustData = itemsFinded[0].idCustData;\r\n                    text = $(this).text();\r\n\r\n                    return self.getContentTooltip(indexSubprocess, idCustData, text,\r\n                        self.getTemplate(\"project-subprocesses-tootip-custom-properties\"));\r\n                }\r\n\r\n                \r\n            },\r\n            open: function (event, ui) {\r\n                if (typeof (event.originalEvent) === 'undefined') {\r\n                    return false;\r\n                }\r\n                var $id = $(ui.tooltip).attr('id');\r\n                // close any lingering tooltips\r\n                $('div.ui-tooltip').not('#' + $id).remove();\r\n            },\r\n            close: function (event, ui) {\r\n                ui.tooltip.hover(function () {\r\n                    $(this).stop(true).fadeTo(400, 1);\r\n                },\r\n                    function () {\r\n                        $(this).fadeOut('400', function () {\r\n                            $(this).remove();\r\n                        });\r\n                    });\r\n            }\r\n        });\r\n    },\r\n\r\n    getContentTooltip: function (indexSubprocess, idCustData, textLI, templateTooltip) {\r\n        var self = this;\r\n\r\n        //when not show custom columns\r\n        if (idCustData == \"-1\") {\r\n            idCustData = \"0\";//So show only basic data subprocess\r\n        }\r\n\r\n        var rowCustomProperty = function (nameProperty, valueProperty) {\r\n            return {\r\n                nameProperty: nameProperty,\r\n                valueProperty: valueProperty\r\n            };\r\n        };\r\n\r\n        var arrayCustomsProperties = [];\r\n        var auxValueProperty = \"\";\r\n        var subprocessData = self.getSubprocessData(indexSubprocess, idCustData);\r\n        var custData = subprocessData.custData;\r\n        var custDataTypes = subprocessData.custDataTypes;\r\n        var custFields = subprocessData.custFields;\r\n        var displayName = subprocessData.displayName;\r\n\r\n        //subproceso\r\n        arrayCustomsProperties.push(new rowCustomProperty(bizagi.localization.getResource(\"workportal-widget-inboxcommon-subprocess\"), displayName));\r\n\r\n        //Others custom properties\r\n        if (custData.length) {\r\n            for (var i = 0; i < custData.length; i += 1) {\r\n                auxValueProperty = custData[i];\r\n                if (custDataTypes) {\r\n                    if (custDataTypes[i] == \"Money\") {\r\n                        auxValueProperty = bizagi.util.formatMonetaryCell(auxValueProperty);\r\n                    } else {\r\n                        if (custDataTypes[i] == \"Boolean\") {\r\n                            auxValueProperty = bizagi.util.formatBoolean(auxValueProperty);\r\n                        } else {\r\n                            if (custDataTypes[i] == \"Float\" || custDataTypes[i] == \"Real\") {\r\n                                auxValueProperty = bizagi.util.formatDecimalCell(auxValueProperty);\r\n                            }\r\n                            else {\r\n                                if (typeof auxValueProperty === \"function\") {\r\n                                    auxValueProperty = \"\";\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                arrayCustomsProperties.push(new rowCustomProperty(custFields[i], auxValueProperty));\r\n            }\r\n        }\r\n\r\n        //Render properties\r\n        var objectTemplate = {};\r\n        objectTemplate.arrayCustomsProperties = arrayCustomsProperties;\r\n        objectTemplate.nameSubprocess = textLI;\r\n        var contentTemplate = templateTooltip;\r\n        var contentTableCustomProperties = $('<div class=\"bizagi-custom-tooltip-subprocesses\"></div>');\r\n        contentTemplate.render(objectTemplate).appendTo(contentTableCustomProperties);\r\n\r\n        return contentTableCustomProperties.html();\r\n    },\r\n\r\n    getSubprocessData: function (indexSubprocess, idCustData) {\r\n        var self = this;\r\n        var subProcessData = {};\r\n        var subProcess = self.Class.responseSubprocess().subProcesses;\r\n        var subProcPersonalized = self.Class.responseSubprocess().subProcPersonalized;\r\n\r\n        if (subProcess && subProcess.length > 0) {\r\n            subProcessData.custData = subProcess[indexSubprocess].custData;\r\n            subProcessData.custDataTypes = subProcess[indexSubprocess].custDataTypes;\r\n            var customFields = self.Class.responseSubprocess().CustFields[idCustData];\r\n            subProcessData.custFields = customFields[Object.keys(customFields)[0]];\r\n            subProcessData.displayName = subProcess[indexSubprocess].displayName;\r\n        } else if (subProcPersonalized && Object.keys(subProcPersonalized).length > 0) {\r\n            subProcessData.custData = subProcPersonalized[0].subProcesses[indexSubprocess].custData;\r\n            subProcessData.custDataTypes = subProcPersonalized[0].subProcesses[indexSubprocess].custDataTypes;\r\n            subProcessData.custFields = subProcPersonalized[0].CustFields[0];\r\n            subProcessData.displayName = subProcPersonalized[0].subProcesses[indexSubprocess].displayName;\r\n        }\r\n        return subProcessData;\r\n    },\r\n\r\n\r\n    clean: function () {\r\n\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.subprocesses.data\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.subprocesses.data]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Events Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.subprocesses.data.extend(\"bizagi.workportal.widgets.project.events\", { }, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n        \"project-events\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.events\").concat(\"#project-events-wrapper\")\r\n      });\r\n    },\r\n\r\n    /*\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n      var self = this;\r\n      var template = self.getTemplate(\"project-events\");\r\n      self.content = template.render({});\r\n      return self.content;\r\n    },\r\n\r\n    /*\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n      var self = this;\r\n\r\n      //Handlers\r\n      self.contextsSidebarActivity.forEach(function (context) {\r\n        self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n    },\r\n\r\n    updateView: function (event, params) {\r\n      var self = this,\r\n        args = params.args,\r\n        $content = self.getContent().empty();\r\n      self.params = args;\r\n\r\n      $.when(self.getArgsTemplate(args)).done(function (responseArgsTemplate) {\r\n        //Update widget\r\n        var contentTemplate = self.getTemplate(\"project-events\");\r\n        contentTemplate\r\n          .render($.extend(args, responseArgsTemplate))\r\n          .appendTo($content);\r\n\r\n        $(\".list-events li.event a\", $content).on(\"click\", $.proxy(self.onClickGoEvent, self));\r\n\r\n        self.initializeTooltip(\".list-events li\");\r\n      });\r\n    },\r\n\r\n    getArgsTemplate: function (args) {\r\n      var def = $.Deferred(),\r\n        argsTemplate = {},\r\n        self = this;\r\n\r\n      //check if show event tab or not\r\n      if (args[\"countEvents\"] >= 1) {\r\n        for (var i = 0; i < args[\"currentState\"].length; i++) {\r\n          if (args[\"currentState\"][i][\"isEvent\"] == \"true\" && args[\"currentState\"][i][\"idWorkItem\"] == args.idWorkitem) {\r\n            args[\"countEvents\"] = args[\"countEvents\"] - 1;\r\n          }\r\n        }\r\n      }\r\n      argsTemplate[\"showEvents\"] = (args[\"countEvents\"] >= 1) ? true : false;\r\n\r\n      if (argsTemplate[\"showEvents\"]) {\r\n        $.when(self.callSummaryCaseEvents(args.idCase)).done(function (responseEvents) {\r\n          args[\"showEvents\"] = (responseEvents[\"events\"].length >= 1) ? true : false;\r\n\r\n          if (args[\"showEvents\"]) {\r\n            argsTemplate[\"events\"] = [];\r\n            responseEvents[\"events\"].forEach(function (elementEvent) {\r\n              argsTemplate[\"events\"].push($.extend(elementEvent[Object.keys(elementEvent)[0]],\r\n                { idWorkFlow: responseEvents[\"idWorkFlow\"] }));\r\n            });\r\n          }\r\n          def.resolve(argsTemplate);\r\n        });\r\n      }\r\n      else {\r\n        def.resolve(argsTemplate);\r\n      }\r\n      return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Events UI\r\n     */\r\n\r\n    onClickGoEvent: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n      $.when(bizagi.util.autoSave()).done(function () {\r\n        self.routingExecute($(event.target).closest(\"li\"));\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Call services\r\n     */\r\n\r\n    /*\r\n     *  Get data for users\r\n     */\r\n    callSummaryCaseEvents: function (idCase) {\r\n      var self = this,\r\n        def = $.Deferred();\r\n\r\n      $.when(\r\n        self.dataService.summaryCaseEvents({\r\n          idCase: idCase\r\n        })\r\n      ).done(function (events) {\r\n        def.resolve(events);\r\n      });\r\n\r\n      return def.promise();\r\n    },\r\n\r\n    clean: function () {\r\n      var self = this;\r\n      this.params = {};\r\n      self.contextsSidebarActivity.forEach(function (context) {\r\n        self.unsub(context, $.proxy(self.updateView, self));\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.events', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.events], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Subprocesses Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.subprocesses.data.extend(\"bizagi.workportal.widgets.project.subprocesses\", {\r\n\r\n    responseSubprocess: function (newValue) {\r\n        return this._super(newValue);\r\n    },\r\n\r\n    auxArrayListSubprocesses: function (newValue) {\r\n        return this._super(newValue);\r\n    }\r\n\r\n}, {\r\n        /*\r\n         *   Constructor\r\n         */\r\n        init: function (workportalFacade, dataService, params) {\r\n            var self = this;\r\n\r\n            // Call base\r\n            self._super(workportalFacade, dataService, params);\r\n\r\n            self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n            //Load templates\r\n            self.loadTemplates({\r\n                \"project-subprocesses\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.subprocesses\").concat(\"#project-subprocesses-wrapper\")\r\n            });\r\n        },\r\n\r\n        /*\r\n         * Renders the template defined in the widget\r\n         */\r\n        renderContent: function () {\r\n            var self = this;\r\n            self.content = $(\"<div></div>\");\r\n            return self.content;\r\n        },\r\n\r\n        /*\r\n         * links events with handlers\r\n         */\r\n        postRender: function () {\r\n            var self = this;\r\n\r\n            //Handlers\r\n            self.contextsSidebarActivity.forEach(function (context) {\r\n                self.sub(context, $.proxy(self.updateView, self));\r\n            });\r\n        },\r\n\r\n        updateView: function (event, params) {\r\n            var self = this,\r\n                args = params.args,\r\n                $content = self.getContent().empty();\r\n            self.params = args;\r\n\r\n            if (self.params.idCase > 0) {\r\n                $.when(\r\n                    self.dataService.summarySubProcess({\r\n                        idCase: self.params.idCase\r\n                    })\r\n                ).done(function (responseSubprocess) {\r\n                    self.Class.responseSubprocess(responseSubprocess);\r\n\r\n                    self.organizeDataForSubprocesses(self.params);\r\n                });\r\n            }\r\n        },\r\n\r\n        organizeDataForSubprocesses: function (args) {\r\n            var self = this;\r\n            if (self.Class.responseSubprocess().showSubProcess) {\r\n                $.each(self.Class.responseSubprocess().subProcesses, function (key) {\r\n                    var custData = self.Class.responseSubprocess().subProcesses[key].custData;\r\n                    if (custData && custData.length) {\r\n                        for (var i = 0; i < custData.length; i += 1) {\r\n                            if (custData[i] === null) {\r\n                                custData[i] = \"\";\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                });\r\n\r\n                var subProcess = self.Class.responseSubprocess().subProcesses || self.Class.responseSubprocess().subProcPersonalized;\r\n\r\n                //prepare array with subprocess\r\n                self.Class.auxArrayListSubprocesses([]);\r\n                for (var i = 0; i < Object.keys(subProcess).length; i += 1) {\r\n                    var tempSubprocesses = subProcess[i];\r\n\r\n                    self.Class.auxArrayListSubprocesses({\r\n                        isOpen: tempSubprocesses.isOpen,\r\n                        radNumber: tempSubprocesses.radNumber,\r\n                        displayName: tempSubprocesses.displayName,\r\n                        idCase: tempSubprocesses.idCase,\r\n                        indexSubprocess: i,\r\n                        idCustData: tempSubprocesses.idCustData\r\n                    });\r\n                    if (tempSubprocesses.subProcesses) {\r\n                        Object.keys(tempSubprocesses).forEach(function (key) {//only one iteration\r\n                            self.Class.auxArrayListSubprocesses({\r\n                                isOpen: tempSubprocesses[key].isOpen,\r\n                                radNumber: tempSubprocesses[key].radNumber,\r\n                                displayName: tempSubprocesses[key].displayName,\r\n                                idCase: tempSubprocesses[key].idCase,\r\n                                indexSubprocess: i,\r\n                                idCustData: tempSubprocesses[key].idCustData\r\n                            });\r\n                        });\r\n                    }\r\n                }\r\n\r\n                self.renderWidget();\r\n            }\r\n        },\r\n\r\n        renderWidget: function () {\r\n            var self = this;\r\n            var $content = self.getContent();\r\n\r\n            //Update widget\r\n            var contentTemplate = self.getTemplate(\"project-subprocesses\");\r\n            contentTemplate\r\n                .render({ auxArrayListSubprocesses: self.Class.auxArrayListSubprocesses() })\r\n                .appendTo($content);\r\n\r\n            $(\".list-subprocesses a\", $content).on(\"click\", $.proxy(self.onClickGoSubprocess, self));\r\n\r\n            self.initializeTooltip(\".list-subprocesses li\");\r\n        },\r\n\r\n\r\n        /**\r\n         * Events UI\r\n         */\r\n\r\n        onClickGoSubprocess: function (event) {\r\n            event.preventDefault();\r\n            var self = this;\r\n\r\n            self.routingExecute($(event.target).closest(\"li\"));\r\n        },\r\n\r\n        clean: function () {\r\n            var self = this;\r\n\r\n            self.params = {};\r\n            self.pluginTooltip = null;\r\n\r\n            self.contextsSidebarActivity.forEach(function (context) {\r\n                self.unsub(context, $.proxy(self.updateView, self));\r\n            });\r\n        }\r\n    }\r\n);\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.subprocesses\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.subprocesses]);","/*\r\n    Name   : Bizagi Workportal Project Activity Description\r\n    Created on : Jun 27, 2017\r\n    Author     : Diana Mogollon\r\n*/\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.activity.description\", {}, {\r\n\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        params = params || {};\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-activity-description\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.activity.description\").concat(\"#project-activity-description\")\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"project-activity-description\");\r\n        var description = self.getWorkitemDescription();\r\n\r\n        if (description) {\r\n            self.content = template.render({ description: description });\r\n        } else {\r\n            self.content = $('<div />');\r\n        }\r\n\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n        \r\n    },\r\n\r\n    getWorkitemDescription: function () {\r\n        var self = this;\r\n        var params = self.params || {};\r\n        var idWorkitem = params.idWorkitem || 0;\r\n        var currentState = params.currentState || [];\r\n        var description = \"\";\r\n\r\n        for (var i = 0; i < currentState.length; i++) {\r\n            if (idWorkitem == currentState[i].idWorkItem) {\r\n                description = currentState[i].tskDescription;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return description;\r\n    },\r\n    \r\n    /**\r\n     * Clean widget\r\n     */\r\n    clean: function () {\r\n        \r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.activity.description', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.activity.description], true);\r\n"]}