{"version":3,"sources":["jquery/workportal/desktop/widget/decontextualized.plans.manager/bizagi.workportal.desktop.widgets.plans.manager.js","jquery/workportal/desktop/widget/decontextualized.plans.topmenu/bizagi.workportal.desktop.widgets.plans.topmenu.js","jquery/workportal/desktop/widget/decontextualized.plans.manager/jquery.knob.js","jquery/workportal/desktop/widget/decontextualized.plans.filters/bizagi.workportal.desktop.widgets.plans.filters.js","jquery/workportal/desktop/widget/project.plan.activities.sidebar/bizagi.workportal.desktop.widgets.project.plan.activities.sidebar.js","jquery/workportal/desktop/widget/project.plan.create/bizagi.workportal.desktop.project.plan.create.js","jquery/workportal/desktop/widget/project.plan.edit/bizagi.workportal.desktop.project.plan.edit.js","jquery/workportal/desktop/widget/project.plan.template.create/bizagi.workportal.desktop.project.plan.template.create.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.reassigncase.js"],"names":["bizagi","workportal","widgets","widget","extend","usersMap","init","workportalFacade","dataService","actionService","notifier","planTemplateCreate","planPopupEdit","serviceOrderActivitiesByTransitions","params","self","this","_super","plans","editDialogBox","allIdUsers","allGuidUsers","globalHandlersService","injector","get","usersFromIdPlan","Array","loadTemplates","plans.manager.wrapper","getTemplate","concat","plans.manager.empty","plans.manager.users","plans.manager.activities.tooltip","plans.manager.context.menu.content","renderContent","content","$","postRender","getCalculatedDateServer","sub","proxy","updateView","showSucessMessage","printf","localization","getResource","showErrorMessage","args","histName","planState","level","pub","type","configureHandlers","$content","getContent","on","onClickPlan","event","stopPropagation","planId","target","closest","data","activities","forEach","activity","runningActivity","goToWorkOnIt","idCase","idWorkItem","ev","idPlan","plan","name","id","showPlanDashBoard","servicesPD","services","behaviors","projectDashboard","showContextByMenuDashboard","menuPlanDashboard","showCommentsOptionMenu","getMenuDashboardSecurity","menuSecurity","isVisibleButtonComments","showFilesOptionMenu","isVisibleButtonFiles","showTimeLineOptionMenu","isVisibleButtonTimeLine","length","substring","contextualized","flowContext","when","getRadNumberForPlanDashboard","done","responseRadNumber","radNumber","deletePlan","showConfirmationBox","always","response","status","executePlan","activitiesLength","putExecutePlan","updateParams","currentState","startDate","getDateServer","updatePlan","closePlan","fail","openPopupEditTemplate","planSelected","selectedPlan","showPopup","openPopupSaveTemplate","showPopupAddTemplatePlan","empty","template","getData","arrayPlans","processData","totalAssignees","assignees","append","render","knob","updatePlanDetails","configureContextMenu","addClass","removeClass","getPictureAndName","idCurrentPlan","thereWasUsersMap","j","user","userAssigned","picture","orderActivitiesByTransitions","transitions","getActivitiesByTransitions","i","fromDate","creationDate","toDate","dueDate","Date","util","dateFormatter","getRelativeTime","value","completedActivities","dueDateFormat","getFormattedDate","locatedState","toLowerCase","idsUsers","deferreds","push","idUserCreator","def","getMetaData","paintPlanDetails","configureActivitiesTooltip","apply","then","equalizeHeights","getUsers","getUsersFromIdPlan","id_activity","usersFromPlan","map","uuser","usersAdapter","createJsonUserInfo","username","email","getInitials","progressPlan","currentActivities","planUsersId","planUsers","users","nameFirstDate","firstDate","lastUpdateToCalculatedClosed","$currentCard","auxLastDate","finishDate","workItemState","progress","indexOf","a","u","undefined","Math","round","find","html","val","trigger","click","preventDefault","attr","usersAssignees","publish","widgetName","BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL","closeVisible","maximize","modalParameters","title","width","height","refreshInbox","getVisibleButtonWorkonit","join","show","hide","formatFirstDate","key","dateObject","dateFormat","dateInvariant","formatInvariant","formatInvariantDate","text","planProgress","currentActiveActivities","responseVisibility","action","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","toolTiptemplate","tooltip","$elementsTmpl","estimatedFinishDate","userName","userPicture","formatedEstimatedFinishDate","formatDate","activityItem","configureUserTooltip","not","$target","id_userSelected","userParam","usertooltip","lstUsers","lstCurrentUsers","usersGuids","getUsersData","isAnonymized","configureAvatar","k","idUser","$avatar","menuTemplate","planCard","planName","planCurrentState","planActivitiesLength","parseInt","pendingActivities","isNaN","completed","contextMenuContent","menu","configureMenuHandlers","position","my","at","of","collision","document","one","remove","defer","Deferred","paramsActivities","paramsWorkItems","paramsTransition","getActivities","getWorkitemsPlan","getTransitionsByPlan","responseActivities","responseWorkitems","responseTransitions","mergePropertiesActivitiesWithWorkitems","resolve","promise","getCurrentTimeDateServer","differenceMillisecondsServer","getDifferenceBetweenDates","date","getTime","$args","getUserPlans","getEmptyDataMessage","workItems","workItemFilter","filter","workItem","guidActivity","wiEntryDate","wiSolutionDate","wiEstimatedSolutionDate","clean","unsub","register","manager","planCreate","plans.topmenu.wrapper","onClickAddPlan","showPopupAddPlan","paramsNewPlan","topmenu","max","min","c","d","t","e","originalEvent","touches","o","s","g","v","cv","x","y","w","h","$c","isInit","fgColor","pColor","dH","cH","eH","rH","scale","relative","relativeWidth","relativeHeight","$div","run","cf","conf","_carve","_configure","_draw","stopper","readOnly","cursor","thickness","lineCap","displayInput","displayPrevious","inputColor","font","fontWeight","inline","step","rotation","draw","change","cancel","release","format","parse","parseFloat","flip","is","each","$this","bind","_validate","createElement","wrap","before","parent","G_vmlCanvasManager","initElement","getContext","message","toString","window","devicePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","Object","copy","_listen","_xy","css","clear","_touch","touchMove","xy2val","pageX","pageY","unbind","_mouse","mouseMove","keyCode","offset","left","top","listen","resize","h2rgba","_clear","rgb","f","Dial","call","startAngle","xy","radius","lineWidth","cursorExt","w2","PI2","PI","bgColor","angleOffset","angleArc","triggerRelease","ret","atan2","mwTimerStop","mwTimerRelease","kval","to","mw","ori","deltaX","detail","wheelDeltaX","deltaY","wheelDeltaY","clearTimeout","setTimeout","m","kv","37","38","39","40","kc","String","fromCharCode","match","inArray","endAngle","abs","vertical-align","margin-top","margin-left","border","background","text-align","color","padding","-webkit-appearance","visibility","angle","arc","sa","ea","pa","r","beginPath","strokeStyle","stroke","fn","dial","plansLinks","plans.filters.wrapper","filteredData","items","setSelectedFilter","item","siblings","onLoadPlansView","onClickFilter","off","filters","project-plan-activities-sidebar","project","sidebar","plan-create","dialogBox","initPlugins","formContent","elements","inputName","inputTemplate","buttonSave","buttonCancel","onClickSavePlan","closeDialogBox","dialog","detach","templateGuid","getTemplatesByParentWorkItem","parentWorkItem","guidWorkItem","comboDataSource","combo","uicombo","isEditable","itemValue","obj","itemText","onChange","ui","keydown","resizable","draggable","modal","close","validateParams","createNewPlan","parentWorkItemRaw","currentUser","description","waitForCompletion","idTemplate","sendDataInsertPlan","encodeHtml","nameValidation","next","postPlan","responseText","xhr","reject","create","planToEdit","plans.manager.popup.edit.plan","closeEditDialogBox","inputDueDate","datepicker","initEditDialogBox","decodeHtmlEntities","inputDesc","inputWaitForCompletion","prop","getDateFormatByDatePickerJqueryUI","editPlanTemplate","saveEditedPlan","validateEditDialogBoxParams","getParamsUpdatePlan","paramsEditPlan","dueDateRaw","getEndHourWorkingByDate","dateTime","edit","idPlanSelected","plan-template-create","onClickSaveTemplate","validateSaveDialogBoxParams","createTemplateByPlan","admin","caseSearch","admin.case.search","admin.case.search.fields","admin.case.search.button","admin.case.search.result","admin.case.search.pagination","admin.case.search.invalidate","admin.case.search.reassign","admin.case.search.reassign.form","admin.case.search.action.result","useNewEngine","getWidgetName","BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE","tmpl","loadtemplates","generalContentTmpl","fieldsContentTmpl","buttonContentTmpl","resultContentTmpl","paginationTmpl","invalidateContentTmpl","reassignContentTmpl","reassignFormTmpl","actionResultContentTmpl","maxElemShow","maxPageToShow","processNavigation","setupData","selectedTasks","cases","selectedTasksToShow","setupInitialData","setupDatePicker","setupProcessTree","setupMainButtons","taskItem","idtask","showReassignForm","fields","buttonBackAction","selectedUserId","selectedUserName","searchParams","processTree","controlType","treeRoutSelected","processtree","canvas","setupUsersSearchForm","usersTable","userstable","userLinkLabel","parentDef","userId","assignEventReassignLinks","findResults","pageToShow","Page","getAdminCasesList","resultList","totalRecords","records","totalPages","total","rows","showCasesSearchResultFrame","setupActionsButton","paginationHtml","pageToshow","summaryWrapper","pagerData","pagination","page","pages","pageNumber","bizagiPagination","actualPage","listElement","clickCallBack","options","showMessageBox","error","log","processedItems","preprocessResultList","headers","resultTemplate","invalidateForm","reassignForm","setupActivitiesLink","setupGraphicQueryEvent","processResultItem","rowItem","taskElements","taskElementsLength","currentTaskObj","taskColumnIndexLength","rowItemData","idWorkflow","idWorkFlow","resultArray","firstRowItem","taskColumnIndex","columnIndex","resultTaskArray","fieldName","columnsID","caseNumber","process","task","taskDueDate","isArray","splice","processTaskObjectUser","processTaskObject","processTaskObjectDate","estimatedSolutionDate","processCreationDate","processDueDate","idworkflow","taskData","totalTask","taskObject","taskName","colorState","idTask","assignee","invalidateCases","selectedCases","reason","JSON","stringify","abortReassignItems","abortResult","showActionResultFrame","showReassignTasksFrame","tasks","split","reassignTasks","idNewUser","reassignCurrent","reassignResult","result","itemsFailed","resultStatus","deleted","reassigned","innerHTML","replace","buttons","widgetButtonSet","idAppToSend","idCategorytoSend","idProcessToSend","errorMessage","errorFieldName","selectedProcessRoute","getTreeRouteSelected","h_action","I_ProcessState","h_idApp","I_Users","eventAsTask","orderType","order","orderField","I_radNumber","I_idWFClass","I_USERFULLNAME","I_USERPOSITION","I_From__CreationDate","I_To__CreationDate","h_idWFClassAuth","I_idCategory","I_idApplication","PageSize","isDate","backToMainForm","backToCases","getAttribute","columnOrderId","columnOrderBy","columnOrderName","showGraphicQuery"],"mappings":"AAKAA,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,8CAEpCC,YAIAC,KAAM,SAAUC,EAAkBC,EAAaC,EAAeC,EAAUC,EAAoBC,EAAeC,EAAoCC,GAC3I,IAAIC,EAAOC,KAEXD,EAAKE,OAAOV,EAAkBC,EAAaM,GAC3CC,EAAKF,oCAAsCA,EAE3CE,EAAKG,SACLH,EAAKI,iBACLJ,EAAKK,cACLL,EAAKM,gBACLN,EAAKL,SAAWA,EAChBK,EAAKJ,mBAAqBA,EAC1BI,EAAKH,cAAgBA,EACrBG,EAAKO,sBAAwBtB,OAAOuB,SAASC,IAAI,yBACjDT,EAAKU,gBAAgBC,QAGrBX,EAAKY,eACDC,wBAAyB5B,OAAO6B,YAAY,mEAAmEC,OAAO,0BACtHC,sBAAuB/B,OAAO6B,YAAY,mEAAmEC,OAAO,gCACpHE,sBAAuBhC,OAAO6B,YAAY,mEAAmEC,OAAO,wBACpHG,mCAAoCjC,OAAO6B,YAAY,mEAAmEC,OAAO,qCACjII,qCAAsClC,OAAO6B,YAAY,mEAAmEC,OAAO,0CAQ3IK,cAAe,WAIX,OAHWnB,KAENoB,QAAUC,EAAE,UAFNrB,KAGCoB,SAMhBE,WAAY,WACR,IAAIvB,EAAOC,KAEXD,EAAKwB,0BAELxB,EAAKyB,IAAI,aAAcH,EAAEI,MAAM1B,EAAK2B,WAAY3B,IAEhDA,EAAKJ,mBAAmB6B,IAAI,6BAA8B,WACtDzB,EAAKL,SAASiC,kBACVC,OAAO5C,OAAO6C,aAAaC,YAAY,mDAAoD,OAEnG/B,EAAKJ,mBAAmB6B,IAAI,4BAA6B,WACrDzB,EAAKL,SAASqC,iBACVH,OAAO5C,OAAO6C,aAAaC,YAAY,gDAAiD,OAGhG/B,EAAKH,cAAc4B,IAAI,oBAAqB,WACxC,IAAIQ,GACAC,SAAUlC,EAAKD,OAAOmC,SACtBC,UAAWnC,EAAKD,OAAOoC,UACvBC,MAAO,GAEXpC,EAAKqC,IAAI,UACLC,KAAM,aACNL,KAAMX,EAAEjC,OAAOW,EAAKD,OAAQkC,KAGhCjC,EAAKL,SAASiC,kBACVC,OAAO5C,OAAO6C,aAAaC,YAAY,wCAAyC,OAGxF/B,EAAKH,cAAc4B,IAAI,mBAAoB,WACvCzB,EAAKL,SAASqC,iBACVH,OAAO5C,OAAO6C,aAAaC,YAAY,qCAAsC,QAQzFQ,kBAAmB,WACf,IAAIvC,EAAOC,KACPuC,EAAWxC,EAAKyC,aACpBnB,EAAE,0BAA2BkB,GAAUE,GAAG,QAASpB,EAAEI,MAAM1B,EAAK2C,YAAa3C,IAC7EsB,EAAE,wCAAyCkB,GAAUE,GAAG,QAAS,SAAUE,GACvEA,EAAMC,kBACN,IAEIC,EAFSxB,EAAEsB,EAAMG,QACCC,QAAQ,2BACRC,KAAK,WAC3BjD,EAAKG,MAAM2C,GAAQI,WAAWC,QAAQ,SAASC,GACvCpD,EAAKqD,gBAAgBD,IACrBpD,EAAKsD,aAAaF,EAASG,OAAQH,EAASI,iBAU5Db,YAAa,SAAUc,GACnB,IACIV,EAASzB,EAAEmC,EAAGV,QAAQC,QAAQ,2BAC9BU,EAASX,EAAOE,KAAK,WAErBU,GACAC,KAFWb,EAAOE,KAAK,aAGvBY,GAAIH,GANGzD,KAQN6D,kBAAkBH,IAO3BG,kBAAmB,SAAUH,GACzB,IAAI3D,EAAOC,KACP8D,EAAa,IAAI9E,OAAOC,WAAW8E,SAASC,UAAUC,iBAAiBlE,EAAKP,aAEhFO,EAAKD,OAAOoE,2BAA6B,iBACzCnE,EAAKD,OAAOqE,qBACZpE,EAAKD,OAAOqE,kBAAkBC,uBAC1BN,EAAWO,yBAAyBrF,OAAOsF,cAAcC,wBAC7DxE,EAAKD,OAAOqE,kBAAkBK,oBAC1BV,EAAWO,yBAAyBrF,OAAOsF,cAAcG,qBAC7D1E,EAAKD,OAAOqE,kBAAkBO,uBAC1BZ,EAAWO,yBAAyBrF,OAAOsF,cAAcK,yBAE7DjB,EAAO3D,EAAKG,MAAMwD,EAAKE,KACdD,KAAKiB,OAAS,KACnBlB,EAAKC,KAAOD,EAAKC,KAAKkB,UAAU,EAAG,IAAM,OAG1CnB,EAAKoB,uBACE/E,EAAKD,OAAOiF,YAGtB1D,EAAE2D,KAAKlB,EAAWmB,6BAA6BvB,EAAKE,GAAIF,EAAKoB,iBAAiBI,KAAK,SAAUC,GACzFpF,EAAKD,OAAOsF,UAAYD,EACxB,IAAInD,GACA0B,KAAMA,EACNvB,MAAO,EACPF,SAAUyB,EAAKC,MAEnB5D,EAAKqC,IAAI,UACLC,KAAMtC,EAAKD,OAAOoE,2BAClBlC,KAAMX,EAAEjC,OAAOW,EAAKD,OAAQkC,QASxCqD,WAAY,SAAU3B,GAClB,IAAI3D,EAAOC,KACXqB,EAAE2D,KAAKhG,OAAOsG,oBAAoBtG,OAAO6C,aAAaC,YAAY,sDAAuD,GAAI,SAASoD,KAAK,WACvI,IAAIpF,GACA8D,GAAIF,EAAKE,IAEbvC,EAAE2D,KAAKjF,EAAKP,YAAY6F,WAAWvF,IAASyF,OAAO,SAAUC,GACzD,GAAwB,MAApBA,EAASC,aAA+C,IAArBD,EAAe,OAAmB,CACrEnE,EAAEjC,OAAOW,EAAKD,OAAO4D,KAAM5D,GAC3B,IAAIkC,GACAC,SAAUlC,EAAKD,OAAOmC,SACtBC,UAAWnC,EAAKD,OAAOoC,UACvBC,MAAO,GAEXpC,EAAKqC,IAAI,UACLC,KAAM,aACNL,KAAMX,EAAEjC,OAAOW,EAAKD,OAAQkC,KAEhCjC,EAAKL,SAASiC,kBACVC,OAAO5C,OAAO6C,aAAaC,YAAY,0CAA2C,UAGtF/B,EAAKL,SAASqC,iBACVH,OAAO5C,OAAO6C,aAAaC,YAAY,uCAAwC,UAUnG4D,YAAa,SAAUhC,GACnB,IAAI3D,EAAOC,KAEX,GAD8B0D,EAAKiC,iBACL,EAAG,CAC7B,IAAI7F,GACA2D,OAAQC,EAAKE,IAEjBvC,EAAE2D,KAAKjF,EAAKP,YAAYoG,eAAe9F,IAASoF,KAAK,WACjD,IAAIW,EAAe9F,EAAKG,MAAMwD,EAAKE,IAC/BiC,IACAA,EAAaC,aAAe,YAC5BD,EAAexE,EAAEjC,OAAOyG,GAAgBE,UAAWhG,EAAKiG,kBACxD3E,EAAE2D,KAAKjF,EAAKP,YAAYyG,WAAWJ,IAAeX,KAAK,WACnD,IAAIlD,GACAC,SAAUlC,EAAKD,OAAOmC,SACtBC,UAAWnC,EAAKD,OAAOoC,UACvBC,MAAO,GAEXpC,EAAKqC,IAAI,UACLC,KAAM,aACNL,KAAMX,EAAEjC,OAAOW,EAAKD,OAAQkC,KAEhCjC,EAAKL,SAASiC,kBACVC,OAAO5C,OAAO6C,aAAaC,YAAY,gDAAiD,eAKxG/B,EAAKL,SAASqC,iBACVH,OAAO5C,OAAO6C,aAAaC,YAAY,sEAAuE,MAQ1HoE,UAAW,SAAUxC,GACjB,IAAI3D,EAAOC,KACP6F,EAAe9F,EAAKG,MAAMwD,EAAKE,IAC/BiC,IACAA,EAAaC,aAAe,SAC5BzE,EAAE2D,KAAKjF,EAAKP,YAAY0G,WAAWzC,OAAQC,EAAKE,MAAMsB,KAAK,WACvD7D,EAAE2D,KAAKjF,EAAKP,YAAYyG,WAAWJ,IAAeX,KAAK,WACnD,IAAIlD,GACAC,SAAUlC,EAAKD,OAAOmC,SACtBC,UAAWnC,EAAKD,OAAOoC,UACvBC,MAAO,GAEXpC,EAAKqC,IAAI,UACLC,KAAM,aACNL,KAAMX,EAAEjC,OAAOW,EAAKD,OAAQkC,KAEhCjC,EAAKL,SAASiC,kBACVC,OAAO5C,OAAO6C,aAAaC,YAAY,yCAA0C,SAE1FqE,KAAK,WACJpG,EAAKL,SAASqC,iBACVH,OAAO5C,OAAO6C,aAAaC,YAAY,sCAAuC,SAQ9FsE,sBAAuB,WACnB,IAAIrG,EAAOC,KACPqG,EAAetG,EAAKG,MAAMH,EAAKuG,aAAa1C,QAEhD7D,EAAKH,cAAc2G,UAAUxG,EAAKD,OAAQC,EAAKP,YAAa6G,IAMhEG,sBAAuB,WACnB,IAAIzG,EAAOC,KACPqG,EAAetG,EAAKG,MAAMH,EAAKuG,aAAa1C,QAEhD7D,EAAKJ,mBAAmB8G,yBAAyB1G,EAAKD,OAClDC,EAAKP,YAAa6G,EAAavB,eAAgBuB,EAAazC,KASpElC,WAAY,SAAUiB,EAAO7C,GACzB,IAAIC,EAAOC,KACXD,EAAKD,OAASA,EAAOkC,KACrBjC,EAAKyC,aAAakE,QAClB,IAAIC,EAAW5G,EAAKc,YAAY,yBAEhCQ,EAAE2D,KAAKjF,EAAK6G,WACP1B,KAAK,SAAUlC,GACZ,GAAIA,EAAK4B,OAAS,EAAG,CACjB7E,EAAKqB,QAAQsF,QACb3G,EAAK8G,WAAa9G,EAAK+G,YAAY9D,GACnC,IAAI+D,EAAiBhH,EAAK8G,WAAWjC,OACjCoC,EAAYjH,EAAK8G,WACrBG,EAAUD,eAAiBA,EAC3BhH,EAAKqB,QAAQ6F,OAAON,EAASO,QAAQhH,MAAO8G,KAC5C3F,EAAE,sBAAuBtB,EAAKqB,SAAS+F,OACvCpH,EAAKqH,oBACLrH,EAAKuC,oBACLvC,EAAKsH,uBAELhG,EAAE,yCAAyCiG,SAAS,0BAA0BC,YAAY,8BAG1FxH,EAAKqB,QAAQsF,QACb3G,EAAKqB,QAAQ6F,OAAOlH,EAAKc,YAAY,uBAAuBqG,aAI5EM,kBAAmB,SAASC,GACxB,IAAI1H,EAAOC,KACX,IAA6B,IAA1BD,EAAK2H,kBACA3H,EAAKV,SACL,IAAK,IAAIsI,EAAI,EAAGA,EAAI5H,EAAKU,gBAAgBgH,GAAe7C,OAAQ+C,GAAK,EAAG,CACpE,IAAIC,EAAO7H,EAAKV,SAASU,EAAKU,gBAAgBgH,GAAeE,GAAGE,cAChE9H,EAAKU,gBAAgBgH,GAAeE,GAAGG,QAAUF,EAAKE,QACtD/H,EAAKU,gBAAgBgH,GAAeE,GAAGhE,KAAOiE,EAAKjE,OAYnEoE,6BAA8B,SAAS9E,EAAY+E,GAE/C,OADWhI,KACCH,oCACZoI,2BAA2BhF,EAAY+E,IAQ3ClB,YAAa,SAAU9D,GAGnB,IAFA,IACI4B,EAAS5B,EAAK4B,OACTsD,EAAI,EAAGA,EAAItD,EAAQsD,GAAK,EAAG,CAFzBlI,KAGFE,MAAM8C,EAAKkF,GAAGtE,IAAMZ,EAAKkF,GAC9B,IAAIC,EAAWnF,EAAKkF,GAAGnC,WAAa/C,EAAKkF,GAAGE,aACxCC,EAASrF,EAAKkF,GAAGI,QAEjBH,IACAA,EAAW,IAAII,KAAKJ,GACpBnF,EAAKkF,GAAGC,SAAWnJ,OAAOwJ,KAAKC,cAAcC,gBAAgBP,EAAU,MAAM,IAG7EE,IACAA,EAAS,IAAIE,KAAKF,GAClBrF,EAAKkF,GAAGG,OAASrJ,OAAOwJ,KAAKC,cAAcC,gBAAgBL,EAAQ,MAAM,IAG7ErF,EAAKkF,GAAGS,MAAQ,EAChB3F,EAAKkF,GAAGU,oBAAsB,EAC9B5F,EAAKkF,GAAGvC,iBAAmB,EACxB3C,EAAKkF,GAAGI,UACPtF,EAAKkF,GAAGW,cArBL7I,KAqB0B8I,iBAAiB,IAAIP,KAAKvF,EAAKkF,GAAGI,WAGnEtF,EAAKkF,GAAGa,aAAe/J,OAAO6C,aAAaC,YAAY,iCAAmCkB,EAAKkF,GAAGpC,aAAakD,eAGnH,OAAOhG,GAMXoE,kBAAmB,WAKf,IAJA,IAAIrH,EAAOC,KACPiJ,KACAC,KAEKhB,EAAI,EAAGA,EAAInI,EAAK8G,WAAWjC,OAAQsD,GAAK,EAAG,CAChDe,EAASE,KAAKpJ,EAAK8G,WAAWqB,GAAGkB,eACjC,IAAIC,EAAMtJ,EAAKuJ,YAAYvJ,EAAK8G,WAAWqB,GAAGtE,IAE9CvC,EAAE2D,KAAKqE,EAAKtJ,EAAK8G,WAAWqB,GAAGtE,IAC1BsB,KAAK,SAAUjC,EAAYwE,GACxB1H,EAAKG,MAAMuH,GAAexE,WAAaA,EACvClD,EAAKwJ,iBAAiBtG,EAAYwE,GAClC1H,EAAKyJ,2BAA2BvG,EAAYwE,KAEpDyB,EAAUC,KAAKE,GAGnBhI,EAAE2D,KAAKyE,MAAMpI,EAAG6H,GAAWQ,KAAK,WAC5BrI,EAAEsI,gBAAgB,2BAClB5J,EAAK6J,SAASX,EAASnI,OAAOf,EAAKK,gBAO3CyJ,mBAAmB,SAASC,GACxB,IAAI/J,EAAKC,KACL+J,KAOJ,OANAhK,EAAKU,gBAAgBqJ,GAAaE,IAAI,SAASC,GAC3C,IAAIrC,EAAO7H,EAAKV,SAAS4K,EAAMpC,cAC/BkC,EAAcZ,KACVe,aAAaC,mBAAmBF,EAAMpC,aAAcD,EAAKjE,KAAMiE,EAAKwC,SAAUxC,EAAKE,QAASF,EAAKyC,MAAOzC,EAAKjE,KAAK2G,eAAc,GAAO,EAAOL,EAAMhH,kBAGrJ8G,GAQXR,iBAAkB,SAAUtG,EAAYwE,GACpC,IAAI1H,EAAOC,KACP2F,EAAmB1C,EAAW2B,OAC9BgE,EAAsB,EACtB2B,EAAe,EACfC,KACAC,KACAC,KACA/D,EAAW5G,EAAKc,YAAY,uBAChCd,EAAKG,MAAMuH,GAAekD,SAC1B,IAsGIC,EACAC,EAvGAC,EAA+B/K,EAAKG,MAAMuH,GAAe1B,WAAahG,EAAKG,MAAMuH,GAAeW,aAEhG2C,EAAe1J,EAAE,kBAAoBtB,EAAKG,MAAMuH,GAAe7D,GAAK,KAAM7D,EAAKqB,SACnF,GAAsB,GAAlBuE,EACA5F,EAAKU,gBAAgBgH,KAAmBI,aAAa9H,EAAKG,MAAMuH,GAAe2B,cAAcnG,oBAC5F,CACDlD,EAAKU,gBAAgBgH,MACrB,IAAK,IAAIS,EAAI,EAAGA,EAAIvC,EAAkBuC,GAAK,EAAG,CAE1C,IAAI8C,EAAe/H,EAAWiF,GAAG+C,YAAchI,EAAWiF,GAAGnC,UAC7D+E,EAA+BA,EAA+BE,EAAcA,EAAcF,EAEtD,cAAhC7H,EAAWiF,GAAGgD,gBACdtC,GAAuB,EACvB3F,EAAWiF,GAAGiD,SAAW,KAEzBpL,EAAKqD,gBAAgBH,EAAWiF,MAChCsC,EAAkBrB,KAAKlG,EAAWiF,GAAGvE,MACrCV,EAAWiF,GAAGiD,SAAW,GAEzBV,EAAYW,QAAQnI,EAAWiF,GAAGL,cAAgB,GAClD9H,EAAKG,MAAMuH,GAAekD,MAAM1H,EAAWiF,GAAGL,eAAiB5E,EAAWiF,IAC1EuC,EAAYtB,KAAKlG,EAAWiF,GAAGL,eAG/B9H,EAAKG,MAAMuH,GAAekD,MAAM1H,EAAWiF,GAAGL,cAAcsB,KAAKlG,EAAWiF,IAE5EnI,EAAKK,WAAWgL,QAAQnI,EAAWiF,GAAGL,cAAgB,IACtD9H,EAAKK,WAAW+I,KAAKlG,EAAWiF,GAAGL,cACnC9H,EAAKM,aAAa8I,KAAKlG,EAAWiF,GAAGL,eAEzC0C,GAAgBtH,EAAWiF,GAAGiD,SAGlC,IAAK,IAAIxD,EAAI,EAAGA,EAAI8C,EAAY7F,OAAQ+C,GAAK,EACzC,GAAK5H,EAAKV,SAASoL,EAAY9C,IAW1B,CACD,IAAIC,EAAO7H,EAAKV,SAASoL,EAAY9C,IACrC+C,EAAUvB,KAAKvB,GACfF,kBAAmB,EACnB3H,EAAKU,gBAAgBgH,GAAe0B,MAAMtB,aAAa4C,EAAY9C,GAAI1E,qBAdvElD,EAAK2H,kBAAmB,EACxBgD,EAAUvB,MACNtB,aAAc4C,EAAY9C,GAC1BG,QAAS,GACTnE,KAAM,KAEV5D,EAAKU,gBAAgBgH,GAAe0B,KAChCe,aAAaC,mBAAmBM,EAAY9C,GAAG,GAAI,GAAI,GAAI,GAAG,IAAI,GAAO,UAYrF,IAAI,IAAI0D,EAAE,EAAGA,EAAItL,EAAKG,MAAMuH,GAAexE,WAAW2B,OAAQyG,IAC1D,IAAI,IAAIC,EAAE,EAAGA,EAAKvL,EAAKU,gBAAgBgH,GAAe7C,OAAQ0G,IACvDvL,EAAKU,gBAAgBgH,GAAe6D,GAAGzD,eAAiB9H,EAAKG,MAAMuH,GAAexE,WAAWoI,GAAGxD,eACtC0D,MAAtDxL,EAAKU,gBAAgBgH,GAAe6D,GAAe,aAClDvL,EAAKU,gBAAgBgH,GAAe6D,GAAe,eACvDvL,EAAKU,gBAAgBgH,GAAe6D,GAAe,WAAEnC,KAAKpJ,EAAKG,MAAMuH,GAAexE,WAAWoI,KAK3Gd,EAAeiB,KAAKC,MAAMlB,EAAe5E,GAEzCoF,EAAaW,KAAK,4BAA4BC,KAAK/C,GACnDmC,EAAaW,KAAK,oCAAoCC,KAAKhG,GAC3DoF,EAAaW,KAAK,uBAAuBE,IAAIrB,GAAcsB,QAAQ,UACnEnB,EAAUjH,OAAS1D,EAAKG,MAAMuH,GAAe7D,GAC7CmH,EAAaW,KAAK,oBAAoBC,KAAKhF,EAASO,QAAQyD,MAAOD,KACnEK,EAAaW,KAAK,cAAcI,MAAM,SAASnJ,GAC3CA,EAAMoJ,iBACNpJ,EAAMC,kBACN,IAAIkH,EAAYzI,EAAErB,MAAMgM,KAAK,gBAC7BjM,EAAKyH,kBAAkBsC,GACvB,IAAImC,EAAiBlM,EAAK8J,mBAAmBC,GAC7C/J,EAAKO,sBAAsB4L,QAAQ,oBAC/BC,WAAYnN,OAAOC,WAAWC,QAAQC,OAAOiN,qCAC7CC,cAAc,EACdrJ,KAAMiJ,EACNK,UAAU,EACVC,iBACIC,MAAOxN,OAAO6C,aAAaC,YAAY,kCAAmC,KAAKmK,EAAerH,OAAO,IACrG6H,MAAO,IACPC,OAAQ,IACRC,cAAc,OAKvB5M,EAAK6M,yBAAyB7M,EAAKG,MAAMuH,GAAgB8C,EAAcC,IACtEO,EAAaW,KAAK,6BAA6BC,KAAKnB,EAAkBqC,KAAK,MAC3E9B,EAAaW,KAAK,2BAA2BoB,SAG7C/B,EAAaW,KAAK,6BAA6BqB,OAC/ChC,EAAaW,KAAK,2BAA2BqB,QAMP,YAA3ChN,EAAKG,MAAMuH,GAAe3B,cACzB8E,EAAgB5L,OAAO6C,aAAaC,YAAY,6CAChD+I,EAAY9K,EAAKG,MAAMuH,GAAeW,cAES,cAA3CrI,EAAKG,MAAMuH,GAAe3B,cAC9B8E,EAAgB5L,OAAO6C,aAAaC,YAAY,4CAChD+I,EAAY9K,EAAKG,MAAMuH,GAAe1B,WAES,WAA3ChG,EAAKG,MAAMuH,GAAe3B,eAC9B8E,EAAgB5L,OAAO6C,aAAaC,YAAY,6CAChD+I,EAAYC,GAGhB,IAAIkC,EAAkBjN,EAAK+I,iBAAiB,IAAIP,KAAKsC,IACrDE,EAAaW,KAAK,oBAAoBC,KAAKf,EAAgB,KAAOoC,IAGtElL,YAAa,SAAUmL,GACnB,OAAOjO,OAAO6C,aAAaC,YAAYmL,IAG3CnE,iBAAkB,SAASoE,GACvB,IACIC,EADOnN,KACW8B,YAAY,cAC9BsL,EAAgBpO,OAAOwJ,KAAKC,cAAc4E,gBAAgBH,GAAY,GACtE9L,EAAUC,EAAE,4BAA8B+L,EAAgB,WAE9D,OADApO,OAAOwJ,KAAK8E,oBAAoBlM,EAAS+L,GAClC/L,EAAQmM,QAUnBX,yBAA0B,SAASlJ,EAAM8J,EAAcC,GACnD,IAAIC,GAAqB,EAIzB,MAHyB,cAAtBhK,EAAKoC,cAAgC0H,EAAe,KAAOC,EAAwB7I,OAAS,IAC3F8I,GAAqB,GAElBA,GAQXrK,aAAc,SAASC,EAAQC,GAChBvD,KACNkM,QAAQ,iBACTyB,OAAQ3O,OAAOC,WAAW2O,QAAQD,OAAOE,iCACzCvK,OAAQA,EACRC,WAAYA,KASpBiG,2BAA4B,SAAUvG,EAAYwE,GAC9C,IAAI1H,EAAOC,KACP8N,EAAkB/N,EAAKc,YAAY,oCACjBQ,EAAE,kBAAoBoG,EAAgB,KAAM1H,EAAKqB,SACvDsK,KAAK,6BAA6BqC,SAC9C3M,QAAS,WACL,IAAI4M,EAAgB3M,IAapB,OAZA4B,EAAWC,QAAQ,SAAUC,GACzB,GAAIpD,EAAKqD,gBAAgBD,GAAW,CAChC,IAAI8K,EAAuB9K,EAA4B,oBAAI,IAAIoF,KAAKpF,EAAS8K,qBAAuB,KAChGlO,EAAKV,SAAS8D,EAAS0E,gBACvB1E,EAAS+K,SAAWnO,EAAKV,SAAS8D,EAAS0E,cAAclE,KACzDR,EAASgL,YAAcpO,EAAKV,SAAS8D,EAAS0E,cAAcC,QAC5D3E,EAASiL,4BAA8B,EAAwBpP,OAAOwJ,KAAKC,cAAc4F,WAAWJ,EAAqBjP,OAAO6C,aAAaC,YAAY,eAAiB,MAE9K,IAAIwM,EAAeR,EAAgB5G,QAAQ/D,SAAUA,IACrD6K,EAAc7E,KAAKM,MAAMuE,EAAeM,MAGzCN,MAUnB5K,gBAAiB,SAASD,GAEtB,MAAkC,WAA3BA,EAAS+H,eAAyD,aAA3B/H,EAAS+H,eAM3DqD,qBAAsB,WAClB,IAAIxO,EAAOC,KACXqB,EAAE,wBAAyBtB,EAAKqB,SAASoN,IAAI,cAAc/L,GAAG,aAAc,GAAI,SAAUe,GACtF,IAAIiL,EAAUpN,EAAEmC,EAAGV,QACf4L,EAAgBD,EAAQ1L,QAAQ,iBAAiBiJ,KAAK,eACtDvE,EAAcgH,EAAQ1L,QAAQ,2BAA2BiJ,KAAK,gBAC9DpE,EAAK7H,EAAKU,gBAAgBgH,GAAeiE,KAAK,SAAS9D,GACvD,OAAOA,EAAKC,cAAc6G,IAE9B,GAAG9G,GAAQA,EAAKC,cAAc6G,EAAgB,CAC1C,IAAIzL,KACJ2E,EAAK3E,WAAW+G,IAAI,SAAS7G,GACzBF,EAAWkG,KAAKhG,EAASQ,QAE7BiE,EAAK7H,EAAKV,SAASuI,EAAKC,cACxB,IAAI8G,EAAUzE,aAAaC,mBAAmBvC,EAAKC,aAAcD,EAAKjE,KAAMiE,EAAKwC,SAAUxC,EAAKE,QAASF,EAAKyC,MAAOzC,EAAKjE,KAAK2G,eAAe,GAAM,EAAOrH,MAC3JwL,EAAQ1L,QAAQ,oBAAoB6L,YAAY7O,GAAM+C,OAAO2L,EAAQ7G,KAAK+G,QAStF/E,SAAU,SAAUiF,GAIhB,IAHA,IAAI9O,EAAOC,KACP8O,KACAlK,EAASiK,EAASjK,OACbsD,EAAI,EAAGA,EAAItD,EAAQsD,GAAK,EACxBnI,EAAKV,SAASwP,EAAS3G,KACxB4G,EAAgB3F,KAAK0F,EAAS3G,IAGtC,GAAI4G,EAAgBlK,OAAS,EAAG,CAC5B,IAAI9E,GACAiP,WAAYF,EAAShC,OACrBJ,MAAO,GACPC,OAAQ,IAEZrL,EAAE2D,KAAKjF,EAAKP,YAAYwP,aAAalP,IAASoF,KAAK,SAAUyF,GAEzD,IADA,IAAI/F,EAAS+F,EAAM/F,OACVsD,EAAI,EAAGA,EAAItD,EAAQsD,GAAK,EAC7BnI,EAAKV,SAASsL,EAAMzC,GAAGtE,KACnBkE,QAAU6C,EAAMzC,GAAU,QAAI,yBAA2ByC,EAAMzC,GAAGJ,QAAU,GAC5EnE,KAAMgH,EAAMzC,GAAGvE,MAAQ,GACvBkE,aAAc8C,EAAMzC,GAAGtE,GACvBwG,SAAUO,EAAMzC,GAAGkC,SACnB6E,aAActE,EAAMzC,GAAG+G,aACvB5E,MAAOM,EAAMzC,GAAGmC,OAEpBtK,EAAKmP,gBAAgBvE,EAAMzC,GAAGtE,IAElC7D,EAAKwO,6BAEN,CACH,IAAK,IAAIY,EAAI,EAAGA,EAAIN,EAASjK,OAAQuK,GAAK,EACtCpP,EAAKmP,gBAAgBL,EAASM,IAElCpP,EAAKwO,yBAQbW,gBAAiB,SAAUE,GACvB,IACIC,EAAUhO,EAAE,iBAAmB+N,EAAS,KADjCpP,KAC4CoB,SAD5CpB,KAEFX,SAAS+P,GAAQtH,QACtBuH,EAAQ3D,KAAK,qBAAqBM,KAAK,MAHhChM,KAG4CX,SAAS+P,GAAQtH,UAGpEuH,EAAQ3D,KAAK,qBAAqBqB,OAClCsC,EAAQ3D,KAAK,6BAA6BC,KAPnC3L,KAO6CX,SAAS+P,GAAQzL,KAAK2G,eAAewC,SAOjGzF,qBAAsB,WAClB,IAAItH,EAAOC,KACPuC,EAAWxC,EAAKyC,aAChB8M,EAAevP,EAAKc,YAAY,sCACpCQ,EAAE,sBAAuBkB,GAAUE,GAAG,QAAS,SAAUE,GACrDA,EAAMC,kBACN,IAAIE,EAASzB,EAAEsB,EAAMG,QACjByM,EAAWzM,EAAOC,QAAQ,2BAC1BF,EAAS0M,EAASvM,KAAK,WACvBwM,EAAWD,EAASvM,KAAK,aACzByM,EAAmBF,EAASvM,KAAK,sBACjC0M,EAAuBC,SAASJ,EAAS7D,KAAK,oCAAoCC,OAAQ,GAC1F/C,EAAsB+G,SAASJ,EAAS7D,KAAK,4BAA4BC,OAAQ,GACjFiE,EAAqBC,MAAMH,IAAyBG,MAAMjH,GAAwB,EAAI8G,EAAuB9G,EACjH7I,EAAKuG,cACD1C,GAAIf,EACJc,KAAM6L,EACN7J,iBAAkBkK,MAAMH,GAAwB,EAAIA,EACpDI,UAAYF,GAAqB,GAErC,IAAIG,EAAqBT,EAAapI,QAClCpB,aAAc2J,EACdK,UAAW/P,EAAKuG,aAAawJ,YAEjCzO,EAAE,sCAAuCkB,GAAU0E,OAAO8I,GAC1DA,EAAmBC,OACnBjQ,EAAKkQ,sBAAsBF,GAE3BA,EAAmBG,UACfC,GAAI,WACJC,GAAI,cACJC,GAAIvN,EACJwN,UAAW,QAEfP,EAAmBjD,OACnBzL,EAAEkP,UAAUC,IAAI,QAAS,WACrBT,EAAmBU,WAEvBpP,EAAE,2BAA2BmP,IAAI,QAAS,WACtCT,EAAmBU,WAEvBpP,EAAE,uBAAuBmP,IAAI,QAAS,WAClCT,EAAmBU,cAU/BR,sBAAuB,SAAUF,GAC7B,IAAIhQ,EAAOC,KACXqB,EAAE,QAAS0O,GAAoBtN,GAAG,QAAS,SAAUE,GACjDA,EAAMC,kBACN7C,EAAKqG,sBAAsBrG,EAAKuG,gBAEpCjF,EAAE,QAAS0O,GAAoBtN,GAAG,QAAS,SAAUE,GACjDA,EAAMC,kBACN7C,EAAKyG,sBAAsBzG,EAAKuG,gBAEpCjF,EAAE,UAAW0O,GAAoBtN,GAAG,QAAS,SAAUE,GACnDA,EAAMC,kBACN7C,EAAK2F,YAAY3F,EAAKuG,gBAE1BjF,EAAE,UAAW0O,GAAoBtN,GAAG,QAAS,SAAUE,GACnDA,EAAMC,kBACN7C,EAAKsF,WAAWtF,EAAKuG,gBAEzBjF,EAAE,SAAU0O,GAAoBtN,GAAG,QAAS,SAAUE,GAClDA,EAAMC,kBACN7C,EAAKmG,UAAUnG,EAAKuG,iBAU5BgD,YAAa,SAAU7F,GACnB,IAAI1D,EAAOC,KACP0Q,EAAQrP,EAAEsP,WACVC,GAAoBnN,OAAQA,GAC5BoN,GAAmBpN,OAAQA,GAC3BqN,GAAoBrN,OAAQA,GAUhC,OATApC,EAAE2D,KAAKjF,EAAKP,YAAYuR,cAAcH,GAClC7Q,EAAKP,YAAYwR,iBAAiBH,GAClC9Q,EAAKP,YAAYyR,qBAAqBH,IAAmB5L,KACzD,SAAUgM,EAAoBC,EAAmBC,GAC7C,IAAInO,EACJA,EAAalD,EAAKgI,6BAA8BmJ,EAAoBE,GACpErR,EAAKsR,uCAAuCpO,EAAYkO,GACxDT,EAAMY,QAAQrO,KAEfyN,EAAMa,WAOjBhQ,wBAAyB,WACrB,IAAIxB,EAAOC,KACX,OAAOqB,EAAE2D,KAAKjF,EAAKP,YAAYgS,4BAA4BtM,KAAK,SAAUM,GACtEzF,EAAK0R,6BAA+BzS,OAAOwJ,KAAKC,cAAciJ,0BAA0B,IAAInJ,KAAQ,IAAIA,KAAK/C,EAASmM,MAAO,mBASrI3L,cAAe,WAEX,OADgB,IAAIuC,MACHqJ,UAAY5R,KAAKyR,8BAOtC7K,QAAS,WACL,IACIiL,KAIJ,MAH8B,QAFnB7R,KAEFF,OAAOoC,YACZ2P,EAAM/L,aAHC9F,KAGmBF,OAAOoC,WAH1BlC,KAKCR,YAAYsS,aAAaD,IAOzCE,oBAAqB,WAEjB,OADW/R,KACEa,YAAY,wBAG7BwQ,uCAAwC,SAAUpO,EAAY+O,GAC1D/O,EAAWC,QAAQ,SAAUC,GACzB,IAAI8O,EAAiBD,EAAUE,OAAO,SAAUC,GAC5C,OAAOA,EAASC,cAAgBjP,EAASS,KAEzCqO,EAAerN,OAAS,GACxBvD,EAAEjC,OAAO+D,GACL4C,UAAWkM,EAAe,GAAGI,aAAe,KAC5CpH,WAAYgH,EAAe,GAAGK,gBAAkB,KAChD/O,WAAY0O,EAAe,GAAG1O,WAC9B2H,cAAe+G,EAAe,GAAG/G,cACjC5H,OAAQ2O,EAAe,GAAG3O,OAC1B2K,oBAAqBgE,EAAe,GAAGM,yBAA2BpP,EAAS8K,yBAS3FuE,MAAO,WACH,IAAIzS,EAAOC,KACXD,EAAKD,UACLC,EAAK0S,MAAM,aAAcpR,EAAEI,MAAM1B,EAAK2B,WAAY3B,IAClDA,EAAKJ,mBAAmB8S,MAAM,8BAC9B1S,EAAKJ,mBAAmB8S,MAAM,6BAC9B1S,EAAKH,cAAc6S,MAAM,qBACzB1S,EAAKH,cAAc6S,MAAM,uBAIjCzT,OAAOuB,SAASmS,SAAS,2CAA4C,mBAAoB,cAAe,gBAAiB,WACrH,yDACA,8CACA,oEACA1T,OAAOC,WAAWC,QAAQgB,MAAMyS,UCn4BpC3T,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,8CAEpCE,KAAM,SAAUC,EAAkBC,EAAaoT,EAAY9S,GAC5CE,KACNF,OAASA,EADHE,KAGNC,OAAOV,EAAkBC,EAAaM,GAHhCE,KAIN4S,WAAaA,EAJP5S,KAMNW,eACDkS,wBAAyB7T,OAAO6B,YAAY,mEAAmEC,OAAO,6BAI9HK,cAAe,WACX,IACIwF,EADO3G,KACSa,YAAY,yBAEhC,OAHWb,KAENoB,QAAUuF,EAASO,WAFblH,KAGCoB,SAGhBE,WAAY,WACGtB,KACNsC,qBAKTA,kBAAmB,WACf,IACIC,EADOvC,KACSwC,aACpBnB,EAAE,mBAAoBkB,GAAUE,GAAG,QAASpB,EAAEI,MAFnCzB,KAE8C8S,eAF9C9S,QAKf8S,eAAgB,WACZ,IAAI/S,EAAOC,KAEXD,EAAK6S,WAAWG,iBAAiBhT,EAAKD,OAAQC,EAAKP,aAAa,GAChEO,EAAK6S,WAAWH,MAAM,eACtB1S,EAAK6S,WAAWpR,IAAI,cAAe,SAAUgC,EAAI1D,GAC7C,IAAIkT,EAAgBlT,EAAOkT,cACvB/Q,EAAW+Q,EAAcrP,KACzBqP,EAAcrP,KAAKiB,OAAS,KAC5B3C,EAAW+Q,EAAcrP,KAAKkB,UAAU,EAAG,IAAM,OAErD9E,EAAKD,OAAOsF,UAAYtF,EAAOsF,UAC/BrF,EAAKD,OAAOoE,2BAA6B,iBACzCnE,EAAKqC,IAAI,UACLC,KAAM,iBACNL,KAAMX,EAAEjC,OAAOW,EAAKD,QAChB4D,KAAM5D,EAAOkT,cACb7Q,MAAO,EACPF,SAAUA,WAS9BjD,OAAOuB,SAASmS,SAAS,2CAA4C,mBAAoB,cAAe,gDAAiD1T,OAAOC,WAAWC,QAAQgB,MAAM+S,UClEzL,SAAe5R,GAKX,aAKA,IAAI8N,KACA+D,EAAM1H,KAAK0H,IACXC,EAAM3H,KAAK2H,IAEfhE,EAAEiE,KACFjE,EAAEiE,EAAEC,EAAIhS,EAAEkP,UACVpB,EAAEiE,EAAEE,EAAI,SAAUC,GACd,OAAOA,EAAEC,cAAcC,QAAQ7O,OAAS,GAa5CuK,EAAEuE,EAAI,WACF,IAAIC,EAAI3T,KAERA,KAAK0T,EAAI,KACT1T,KAAKqB,EAAI,KACTrB,KAAKkI,EAAI,KACTlI,KAAK4T,EAAI,KACT5T,KAAK6T,EAAI,KACT7T,KAAK8T,GAAK,KACV9T,KAAK+T,EAAI,EACT/T,KAAKgU,EAAI,EACThU,KAAKiU,EAAI,EACTjU,KAAKkU,EAAI,EACTlU,KAAKmU,GAAK,KACVnU,KAAKoT,EAAI,KACTpT,KAAKsT,EAAI,EACTtT,KAAKoU,QAAS,EACdpU,KAAKqU,QAAU,KACfrU,KAAKsU,OAAS,KACdtU,KAAKuU,GAAK,KACVvU,KAAKwU,GAAK,KACVxU,KAAKyU,GAAK,KACVzU,KAAK0U,GAAK,KACV1U,KAAK2U,MAAQ,EACb3U,KAAK4U,UAAW,EAChB5U,KAAK6U,eAAgB,EACrB7U,KAAK8U,gBAAiB,EACtB9U,KAAK+U,KAAO,KAEZ/U,KAAKgV,IAAM,WACP,IAAIC,EAAK,SAAU1B,EAAG2B,GAClB,IAAI/F,EACJ,IAAKA,KAAK+F,EACNvB,EAAED,EAAEvE,GAAK+F,EAAK/F,GAElBwE,EAAEwB,SAAS7V,OACXqU,EAAEyB,aACAC,SAGN,IAAIrV,KAAKqB,EAAE2B,KAAK,aAAhB,CAgHA,GA/GAhD,KAAKqB,EAAE2B,KAAK,aAAa,GAEzBhD,KAAKZ,SACLY,KAAK0T,EAAIrS,EAAEjC,QAEP+T,SAA4B5H,IAAvBvL,KAAKqB,EAAE2B,KAAK,OAAuBhD,KAAKqB,EAAE2B,KAAK,OAAS,EAC7DkQ,SAA4B3H,IAAvBvL,KAAKqB,EAAE2B,KAAK,OAAuBhD,KAAKqB,EAAE2B,KAAK,OAAS,IAC7DsS,SAAS,EACTC,SAAUvV,KAAKqB,EAAE2B,KAAK,aAA4C,aAA5BhD,KAAKqB,EAAE2K,KAAK,YAGlDwJ,SAAkC,IAA1BxV,KAAKqB,EAAE2B,KAAK,UAAsB,GAC/BhD,KAAKqB,EAAE2B,KAAK,YAAa,EACpCyS,UAAWzV,KAAKqB,EAAE2B,KAAK,cACTwI,KAAK0H,IAAI1H,KAAK2H,IAAInT,KAAKqB,EAAE2B,KAAK,aAAc,GAAI,MAChD,IACd0S,QAAS1V,KAAKqB,EAAE2B,KAAK,YAAc,OACnCyJ,MAAOzM,KAAKqB,EAAE2B,KAAK,UAAY,IAC/B0J,OAAQ1M,KAAKqB,EAAE2B,KAAK,WAAa,IACjC2S,aAA6C,MAA/B3V,KAAKqB,EAAE2B,KAAK,iBAA2BhD,KAAKqB,EAAE2B,KAAK,gBACjE4S,gBAAiB5V,KAAKqB,EAAE2B,KAAK,mBAC7BqR,QAASrU,KAAKqB,EAAE2B,KAAK,YAAc,UACnC6S,WAAY7V,KAAKqB,EAAE2B,KAAK,cACxB8S,KAAM9V,KAAKqB,EAAE2B,KAAK,SAAW,QAC7B+S,WAAY/V,KAAKqB,EAAE2B,KAAK,gBAAkB,OAC1CgT,QAAQ,EACRC,KAAMjW,KAAKqB,EAAE2B,KAAK,SAAW,EAC7BkT,SAAUlW,KAAKqB,EAAE2B,KAAK,YAGtBmT,KAAM,KACNC,OAAQ,KACRC,OAAQ,KACRC,QAAS,KAGTC,OAAQ,SAAU1C,GACd,OAAOA,GAEX2C,MAAO,SAAU3C,GACb,OAAO4C,WAAW5C,KAEvB7T,KAAK0T,GAIR1T,KAAK0T,EAAEgD,KAA2B,kBAApB1W,KAAK0T,EAAEwC,UAAoD,QAApBlW,KAAK0T,EAAEwC,SACvDlW,KAAK0T,EAAEmC,aACR7V,KAAK0T,EAAEmC,WAAa7V,KAAK0T,EAAEW,SAI3BrU,KAAKqB,EAAEsV,GAAG,aAGV3W,KAAK6T,KACL7T,KAAKkI,EAAIlI,KAAKqB,EAAEqK,KAAK,SACrB1L,KAAKkI,EAAE0O,KAAK,SAAUzH,GAClB,IAAI0H,EAAQxV,EAAErB,MACd2T,EAAEzL,EAAEiH,GAAK0H,EACTlD,EAAEE,EAAE1E,GAAKwE,EAAED,EAAE8C,MAAMK,EAAMjL,OAEzBiL,EAAMC,KACF,cACA,WACI,IAAIlL,KACJA,EAAIuD,GAAK0H,EAAMjL,MACf+H,EAAE/H,IAAI+H,EAAEoD,UAAUnL,QAI9B5L,KAAKqB,EAAEqK,KAAK,UAAU+E,WAItBzQ,KAAKkI,EAAIlI,KAAKqB,EACdrB,KAAK6T,EAAI7T,KAAK0T,EAAE8C,MAAMxW,KAAKqB,EAAEuK,OAClB,KAAX5L,KAAK6T,IAAa7T,KAAK6T,EAAI7T,KAAK0T,EAAEP,KAClCnT,KAAKqB,EAAEyV,KACH,cACA,WACInD,EAAE/H,IAAI+H,EAAEoD,UAAUpD,EAAED,EAAE8C,MAAM7C,EAAEtS,EAAEuK,aAM3C5L,KAAK0T,EAAEiC,cAAgB3V,KAAKqB,EAAE0L,OAG/B/M,KAAKmU,GAAK9S,EAAEkP,SAASyG,cAAc,WAAWhL,MAC1CS,MAAOzM,KAAK0T,EAAEjH,MACdC,OAAQ1M,KAAK0T,EAAEhH,SAKnB1M,KAAK+U,KAAO1T,EAAE,gBACPrB,KAAK0T,EAAEsC,OAAS,kBAAoB,IACrC,SAAWhW,KAAK0T,EAAEjH,MAAQ,aAAezM,KAAK0T,EAAEhH,OAAS,eAG/D1M,KAAKqB,EAAE4V,KAAKjX,KAAK+U,MAAMmC,OAAOlX,KAAKmU,IACnCnU,KAAK+U,KAAO/U,KAAKqB,EAAE8V,SAEe,oBAAvBC,oBACPA,mBAAmBC,YAAYrX,KAAKmU,GAAG,IAG3CnU,KAAKoT,EAAIpT,KAAKmU,GAAG,GAAGmD,WAAatX,KAAKmU,GAAG,GAAGmD,WAAW,MAAQ,MAE1DtX,KAAKoT,EACN,MACIzP,KAAM,8BACN4T,QAAS,sDACTC,SAAU,WAAc,OAAOxX,KAAK2D,KAAO,KAAO3D,KAAKuX,UAgD/D,OA3CAvX,KAAK2U,OAAS8C,OAAOC,kBAAoB,IACzB1X,KAAKoT,EAAEuE,8BACP3X,KAAKoT,EAAEwE,2BACP5X,KAAKoT,EAAEyE,0BACP7X,KAAKoT,EAAE0E,yBACP9X,KAAKoT,EAAE2E,wBAA0B,GAIjD/X,KAAK6U,cAAgB7U,KAAK0T,EAAEjH,MAAQ,GAAM,GACjBzM,KAAK0T,EAAEjH,MAAMrB,QAAQ,KAC9CpL,KAAK8U,eAAiB9U,KAAK0T,EAAEhH,OAAS,GAAM,GACnB1M,KAAK0T,EAAEhH,OAAOtB,QAAQ,KAC/CpL,KAAK4U,SAAW5U,KAAK6U,eAAiB7U,KAAK8U,eAG3C9U,KAAKmV,SAGDnV,KAAK6T,aAAamE,QAClBhY,KAAK8T,MACL9T,KAAKiY,KAAKjY,KAAK6T,EAAG7T,KAAK8T,KAEvB9T,KAAK8T,GAAK9T,KAAK6T,EAInB7T,KAAKqB,EACAyV,KAAK,YAAa7B,GAClBkC,SACAL,KAAK,YAAa7B,GAGvBjV,KAAKkY,UACA9C,aACA+C,MACA7Y,OAELU,KAAKoU,QAAS,EAEdpU,KAAKqB,EAAEuK,IAAI5L,KAAK0T,EAAE6C,OAAOvW,KAAK6T,IAC9B7T,KAAKqV,QAEErV,OAGXA,KAAKmV,OAAS,WACV,GAAInV,KAAK4U,SAAU,CACf,IAAIX,EAAIjU,KAAK6U,cACL7U,KAAK+U,KAAKoC,SAAS1K,QACnBkD,SAAS3P,KAAK0T,EAAEjH,OAAS,IACvBzM,KAAK+U,KAAKoC,SAAS1K,QACzByH,EAAIlU,KAAK8U,eACL9U,KAAK+U,KAAKoC,SAASzK,SACnBiD,SAAS3P,KAAK0T,EAAEhH,QAAU,IACxB1M,KAAK+U,KAAKoC,SAASzK,SAG7B1M,KAAKiU,EAAIjU,KAAKkU,EAAI1I,KAAK2H,IAAIc,EAAGC,QAE9BlU,KAAKiU,EAAIjU,KAAK0T,EAAEjH,MAChBzM,KAAKkU,EAAIlU,KAAK0T,EAAEhH,OAuBpB,OAnBA1M,KAAK+U,KAAKqD,KACN3L,MAASzM,KAAKiU,EAAI,KAClBvH,OAAU1M,KAAKkU,EAAI,OAIvBlU,KAAKmU,GAAGnI,MACJS,MAAOzM,KAAKiU,EACZvH,OAAQ1M,KAAKkU,IAIE,IAAflU,KAAK2U,QACL3U,KAAKmU,GAAG,GAAG1H,MAAQzM,KAAKmU,GAAG,GAAG1H,MAAQzM,KAAK2U,MAC3C3U,KAAKmU,GAAG,GAAGzH,OAAS1M,KAAKmU,GAAG,GAAGzH,OAAS1M,KAAK2U,MAC7C3U,KAAKmU,GAAG1H,MAAMzM,KAAKiU,GACnBjU,KAAKmU,GAAGzH,OAAO1M,KAAKkU,IAGjBlU,MAGXA,KAAKqV,MAAQ,WAGT,IAAIhC,GAAI,EAERM,EAAEC,EAAID,EAAEP,EAERO,EAAE0E,QAEF1E,EAAEY,KAAOlB,EAAIM,EAAEY,OAET,IAANlB,GAAeM,EAAEwC,QAGrBnW,KAAKsY,OAAS,SAAU/E,GACpB,IAAIgF,EAAY,SAAUhF,GACtB,IAAIM,EAAIF,EAAE6E,OACEjF,EAAEC,cAAcC,QAAQE,EAAEL,GAAGmF,MAC7BlF,EAAEC,cAAcC,QAAQE,EAAEL,GAAGoF,OAGrC7E,GAAKF,EAAEG,KAEPH,EAAEa,KAAkB,IAAZb,EAAEa,GAAGX,KAEjBF,EAAEyC,OAAOzC,EAAEoD,UAAUlD,IACrBF,EAAE0B,WAoBN,OAhBArV,KAAKsT,EAAInE,EAAEiE,EAAEE,EAAEC,GAGfgF,EAAUhF,GAGVpE,EAAEiE,EAAEC,EACCyD,KAAK,cAAeyB,GACpBzB,KACG,aACA,WACI3H,EAAEiE,EAAEC,EAAEsF,OAAO,0BACbhF,EAAE/H,IAAI+H,EAAEG,MAIb9T,MAGXA,KAAK4Y,OAAS,SAAUrF,GACpB,IAAIsF,EAAY,SAAUtF,GACtB,IAAIM,EAAIF,EAAE6E,OAAOjF,EAAEkF,MAAOlF,EAAEmF,OAExB7E,GAAKF,EAAEG,KAEPH,EAAEa,KAAmB,IAAZb,EAAEa,GAAGX,KAElBF,EAAEyC,OAAOzC,EAAEoD,UAAUlD,IACrBF,EAAE0B,WA+BN,OA3BAwD,EAAUtF,GAGVpE,EAAEiE,EAAEC,EACCyD,KAAK,cAAe+B,GACpB/B,KAEG,UACA,SAAUvD,GACN,GAAkB,KAAdA,EAAEuF,QAAgB,CAGlB,GAFA3J,EAAEiE,EAAEC,EAAEsF,OAAO,iCAEThF,EAAEc,KAAiB,IAAXd,EAAEc,KACV,OAEJd,EAAE0C,YAIbS,KACG,YACA,SAAUvD,GACNpE,EAAEiE,EAAEC,EAAEsF,OAAO,iCACbhF,EAAE/H,IAAI+H,EAAEG,MAIb9T,MAGXA,KAAKmY,IAAM,WACP,IAAIzE,EAAI1T,KAAKmU,GAAG4E,SAIhB,OAHA/Y,KAAK+T,EAAIL,EAAEsF,KACXhZ,KAAKgU,EAAIN,EAAEuF,IAEJjZ,MAGXA,KAAKkY,QAAU,WA8BX,OA7BKlY,KAAK0T,EAAE6B,SAmBRvV,KAAKqB,EAAE2K,KAAK,WAAY,aAlBxBhM,KAAKmU,GACA2C,KACG,YACA,SAAUvD,GACNA,EAAExH,iBACF4H,EAAEwE,MAAMS,OAAOrF,KAGtBuD,KACG,aACA,SAAUvD,GACNA,EAAExH,iBACF4H,EAAEwE,MAAMG,OAAO/E,KAI3BvT,KAAKkZ,UAKLlZ,KAAK4U,UACLvT,EAAEoW,QAAQ0B,OAAO,WACbxF,EAAEwB,SAAS7V,OACXqU,EAAE0B,UAIHrV,MAGXA,KAAKoV,WAAa,WAed,OAZIpV,KAAK0T,EAAEyC,OAAMnW,KAAKuU,GAAKvU,KAAK0T,EAAEyC,MAC9BnW,KAAK0T,EAAE0C,SAAQpW,KAAKwU,GAAKxU,KAAK0T,EAAE0C,QAChCpW,KAAK0T,EAAE2C,SAAQrW,KAAKyU,GAAKzU,KAAK0T,EAAE2C,QAChCrW,KAAK0T,EAAE4C,UAAStW,KAAK0U,GAAK1U,KAAK0T,EAAE4C,SAEjCtW,KAAK0T,EAAEkC,iBACP5V,KAAKsU,OAAStU,KAAKoZ,OAAOpZ,KAAK0T,EAAEW,QAAS,OAC1CrU,KAAKqU,QAAUrU,KAAKoZ,OAAOpZ,KAAK0T,EAAEW,QAAS,QAE3CrU,KAAKqU,QAAUrU,KAAK0T,EAAEW,QAGnBrU,MAGXA,KAAKqZ,OAAS,WACVrZ,KAAKmU,GAAG,GAAG1H,MAAQzM,KAAKmU,GAAG,GAAG1H,OAGlCzM,KAAK+W,UAAY,SAAUlD,GACvB,IAAIjI,MAAYiI,EAAI,GAAM,GAAM,IAAQA,EAAI7T,KAAK0T,EAAEuC,MAAUjW,KAAK0T,EAAEuC,KACpE,OAAOzK,KAAKC,MAAY,IAANG,GAAa,KAInC5L,KAAKkZ,OAAS,aACdlZ,KAAKZ,OAAS,aACdY,KAAKV,KAAO,aACZU,KAAKoW,OAAS,SAAUvC,KACxB7T,KAAK4L,IAAM,SAAUiI,KACrB7T,KAAKwY,OAAS,SAAUzE,EAAGC,KAC3BhU,KAAKmW,KAAO,aACZnW,KAAKqY,MAAQ,WAAcrY,KAAKqZ,UAGhCrZ,KAAKoZ,OAAS,SAAUlF,EAAG7I,GACvB,IAAIiO,EAQJ,OAPApF,EAAIA,EAAErP,UAAU,EAAG,GAOZ,SANPyU,GACI3J,SAASuE,EAAErP,UAAU,EAAG,GAAI,IAC5B8K,SAASuE,EAAErP,UAAU,EAAG,GAAI,IAC5B8K,SAASuE,EAAErP,UAAU,EAAG,GAAI,MAGX,GAAK,IAAMyU,EAAI,GAAK,IAAMA,EAAI,GAAK,IAAMjO,EAAI,KAGtErL,KAAKiY,KAAO,SAAUsB,EAAGjG,GACrB,IAAK,IAAIpL,KAAKqR,EACVjG,EAAEpL,GAAKqR,EAAErR,KASrBiH,EAAEqK,KAAO,WACLrK,EAAEuE,EAAE+F,KAAKzZ,MAETA,KAAK0Z,WAAa,KAClB1Z,KAAK2Z,GAAK,KACV3Z,KAAK4Z,OAAS,KACd5Z,KAAK6Z,UAAY,KACjB7Z,KAAK8Z,UAAY,KACjB9Z,KAAK+Z,GAAK,KACV/Z,KAAKga,IAAM,EAAIxO,KAAKyO,GAEpBja,KAAKZ,OAAS,WACVY,KAAK0T,EAAIrS,EAAEjC,QACP8a,QAASla,KAAKqB,EAAE2B,KAAK,YAAc,UACnCmX,YAAana,KAAKqB,EAAE2B,KAAK,gBAAkB,EAC3CoX,SAAUpa,KAAKqB,EAAE2B,KAAK,aAAe,IACrCgT,QAAQ,GACThW,KAAK0T,IAGZ1T,KAAK4L,IAAM,SAAUiI,EAAGwG,GACpB,GAAI,MAAQxG,EAeR,OAAO7T,KAAK6T,EAZZA,EAAI7T,KAAK0T,EAAE8C,MAAM3C,IAEM,IAAnBwG,GACGxG,GAAK7T,KAAK6T,GACV7T,KAAK0U,KACU,IAAf1U,KAAK0U,GAAGb,KAEf7T,KAAK8T,GAAK9T,KAAK0T,EAAE4B,QAAUpC,EAAIC,EAAIU,EAAG7T,KAAK0T,EAAER,KAAMlT,KAAK0T,EAAEP,KAAOU,EACjE7T,KAAK6T,EAAI7T,KAAK8T,GACd9T,KAAKqB,EAAEuK,IAAI5L,KAAK0T,EAAE6C,OAAOvW,KAAK6T,IAC9B7T,KAAKqV,UAMbrV,KAAKwY,OAAS,SAAUzE,EAAGC,GACvB,IAAI3I,EAAGiP,EAuBP,OArBAjP,EAAIG,KAAK+O,MACGxG,GAAK/T,KAAK+T,EAAI/T,KAAK+Z,MACjB/F,EAAIhU,KAAKgU,EAAIhU,KAAK+Z,KACpB/Z,KAAKma,YAEbna,KAAK0T,EAAEgD,OACPrL,EAAIrL,KAAKoa,SAAW/O,EAAIrL,KAAKga,KAG7Bha,KAAKoa,UAAYpa,KAAKga,KAAQ3O,EAAI,GAAOA,GAAK,GAG9CA,EAAI,EACGA,EAAI,IACXA,GAAKrL,KAAKga,KAGdM,EAAOjP,GAAKrL,KAAK0T,EAAER,IAAMlT,KAAK0T,EAAEP,KAAOnT,KAAKoa,SAAYpa,KAAK0T,EAAEP,IAE/DnT,KAAK0T,EAAE4B,UAAYgF,EAAMpH,EAAIC,EAAImH,EAAKta,KAAK0T,EAAER,KAAMlT,KAAK0T,EAAEP,MAEnDmH,GAGXta,KAAKkZ,OAAS,WAGV,IAAcsB,EACVC,EAoCAC,EACAC,EAtCAhH,EAAI3T,KAEJ4a,EAAK,SAAUrH,GACXA,EAAExH,iBAEF,IAAI8O,EAAMtH,EAAEC,cACRsH,EAASD,EAAIE,QAAUF,EAAIG,YAC3BC,EAASJ,EAAIE,QAAUF,EAAIK,YAC3BrH,EAAIF,EAAEoD,UAAUpD,EAAED,EAAE8C,MAAM7C,EAAEtS,EAAEuK,SAEtBkP,EAAS,GAAKG,EAAS,EACrBtH,EAAED,EAAEuC,KACJ6E,EAAS,GAAKG,EAAS,GAAKtH,EAAED,EAAEuC,KAAO,GAGrDpC,EAAIX,EAAIC,EAAIU,EAAGF,EAAED,EAAER,KAAMS,EAAED,EAAEP,KAE7BQ,EAAE/H,IAAIiI,GAAG,GAELF,EAAEe,KAEFyG,aAAaX,GACbA,EAAcY,WAAW,WACrBzH,EAAEe,GAAGb,GACL2G,EAAc,MACf,KAGEC,IACDA,EAAiBW,WAAW,WACpBZ,GACA7G,EAAEe,GAAGb,GACT4G,EAAiB,MAClB,QAMfY,EAAI,EACJC,GACIC,IAAK5H,EAAED,EAAEuC,KACTuF,GAAI7H,EAAED,EAAEuC,KACRwF,GAAI9H,EAAED,EAAEuC,KACRyF,IAAK/H,EAAED,EAAEuC,MAGjBjW,KAAKqB,EACAyV,KACG,UACA,SAAUvD,GACN,IAAIoI,EAAKpI,EAAEuF,QASX,GANI6C,GAAM,IAAMA,GAAM,MAClBA,EAAKpI,EAAEuF,QAAU6C,EAAK,IAG1BjB,EAAO/K,SAASiM,OAAOC,aAAaF,IAEhC9L,MAAM6K,KACE,KAAPiB,GACS,IAAPA,GACO,IAAPA,GACO,MAAPA,IACQ,MAAPA,GACGhI,EAAEtS,EAAEuK,MAAMkQ,MAAM,QACpBvI,EAAExH,iBAGD1K,EAAE0a,QAAQJ,GAAK,GAAI,GAAI,GAAI,MAAQ,GAAG,CACtCpI,EAAExH,iBAEF,IAAI8H,EAAIF,EAAED,EAAE8C,MAAM7C,EAAEtS,EAAEuK,OAAS0P,EAAGK,GAAMN,EACxC1H,EAAED,EAAE4B,UAAYzB,EAAIX,EAAIC,EAAIU,EAAGF,EAAED,EAAER,KAAMS,EAAED,EAAEP,MAE7CQ,EAAEyC,OAAOzC,EAAEoD,UAAUlD,IACrBF,EAAE0B,QAGFsF,EAAKlD,OAAO2D,WAAW,WACnBC,GAAK,GACN,OAKlBvE,KACG,QACA,SAAUvD,GACF1D,MAAM6K,GACFC,IACAlD,OAAO0D,aAAaR,GACpBA,EAAK,KACLU,EAAI,EACJ1H,EAAE/H,IAAI+H,EAAEtS,EAAEuK,QAIb+H,EAAEtS,EAAEuK,MAAQ+H,EAAED,EAAER,KAAOS,EAAEtS,EAAEuK,IAAI+H,EAAED,EAAER,MAChCS,EAAEtS,EAAEuK,MAAQ+H,EAAED,EAAEP,KAAOQ,EAAEtS,EAAEuK,IAAI+H,EAAED,EAAEP,OAKvDnT,KAAKmU,GAAG2C,KAAK,4BAA6B8D,GAC1C5a,KAAKqB,EAAEyV,KAAK,4BAA6B8D,IAG7C5a,KAAKV,KAAO,YACJU,KAAK6T,EAAI7T,KAAK0T,EAAEP,KACbnT,KAAK6T,EAAI7T,KAAK0T,EAAER,OAAOlT,KAAK6T,EAAI7T,KAAK0T,EAAEP,KAE9CnT,KAAKqB,EAAEuK,IAAI5L,KAAK6T,GAChB7T,KAAK+Z,GAAK/Z,KAAKiU,EAAI,EACnBjU,KAAK8Z,UAAY9Z,KAAK0T,EAAE8B,OAAS,IACjCxV,KAAK2Z,GAAK3Z,KAAK+Z,GAAK/Z,KAAK2U,MACzB3U,KAAK6Z,UAAY7Z,KAAK2Z,GAAK3Z,KAAK0T,EAAE+B,UAClCzV,KAAK0V,QAAU1V,KAAK0T,EAAEgC,QACtB1V,KAAK4Z,OAAS5Z,KAAK2Z,GAAK3Z,KAAK6Z,UAAY,EAEzC7Z,KAAK0T,EAAEyG,cACHna,KAAK0T,EAAEyG,YAActK,MAAM7P,KAAK0T,EAAEyG,aAAe,EAAIna,KAAK0T,EAAEyG,aAEhEna,KAAK0T,EAAE0G,WACHpa,KAAK0T,EAAE0G,SAAWvK,MAAM7P,KAAK0T,EAAE0G,UAAYpa,KAAKga,IAAMha,KAAK0T,EAAE0G,UAGjEpa,KAAKma,YAAcna,KAAK0T,EAAEyG,YAAc3O,KAAKyO,GAAK,IAClDja,KAAKoa,SAAWpa,KAAK0T,EAAE0G,SAAW5O,KAAKyO,GAAK,IAG5Cja,KAAK0Z,WAAa,IAAMlO,KAAKyO,GAAKja,KAAKma,YACvCna,KAAKgc,SAAW,IAAMxQ,KAAKyO,GAAKja,KAAKma,YAAcna,KAAKoa,SAExD,IAAIzG,EAAIT,EACJ0I,OAAOpQ,KAAKyQ,IAAIjc,KAAK0T,EAAER,MAAMtO,OAC7BgX,OAAOpQ,KAAKyQ,IAAIjc,KAAK0T,EAAEP,MAAMvO,OAC7B,GACA,EAEJ5E,KAAK0T,EAAEiC,cACA3V,KAAKkI,EAAEkQ,KACN3L,OAAWzM,KAAKiU,EAAI,EAAI,GAAM,GAAK,KACnCvH,QAAY1M,KAAKiU,EAAI,GAAM,GAAK,KAChC/D,SAAY,WACZgM,iBAAkB,SAClBC,cAAgBnc,KAAKiU,EAAI,GAAM,GAAK,KACpCmI,cAAe,KAAiB,EAATpc,KAAKiU,EAAQ,EAAI,GAAM,GAAK,KACnDoI,OAAU,EACVC,WAAc,OACdxG,KAAQ9V,KAAK0T,EAAEqC,WAAa,KAAQ/V,KAAKiU,EAAIN,GAAM,GAAK,MAAQ3T,KAAK0T,EAAEoC,KACvEyG,aAAc,SACdC,MAASxc,KAAK0T,EAAEmC,YAAc7V,KAAK0T,EAAEW,QACrCoI,QAAW,MACXC,qBAAsB,UACpB1c,KAAKkI,EAAEkQ,KACT3L,MAAS,MACTkQ,WAAc,YAI1B3c,KAAKoW,OAAS,SAAUvC,GACpB7T,KAAK8T,GAAKD,EACV7T,KAAKqB,EAAEuK,IAAI5L,KAAK0T,EAAE6C,OAAO1C,KAG7B7T,KAAK4c,MAAQ,SAAU/I,GACnB,OAAQA,EAAI7T,KAAK0T,EAAEP,KAAOnT,KAAKoa,UAAYpa,KAAK0T,EAAER,IAAMlT,KAAK0T,EAAEP,MAGnEnT,KAAK6c,IAAM,SAAUhJ,GACjB,IAAIiJ,EAAIC,EAaR,OAZAlJ,EAAI7T,KAAK4c,MAAM/I,GAGXkJ,EAFA/c,KAAK0T,EAAEgD,MACPoG,EAAK9c,KAAKgc,SAAW,MACXnI,EAAI,MAEdiJ,EAAK9c,KAAK0Z,WAAa,MACb7F,EAAI,KAElB7T,KAAK0T,EAAE8B,SACCsH,EAAKC,EAAK/c,KAAK8Z,aACfiD,GAAU/c,KAAK8Z,YAGnBnG,EAAGmJ,EACHvJ,EAAGwJ,EACH1J,EAAGrT,KAAK0T,EAAEgD,OAAS1W,KAAK0T,EAAE8B,SAIlCxV,KAAKmW,KAAO,WACR,IAEI6G,EAFA5J,EAAIpT,KAAK4T,EACTvI,EAAIrL,KAAK6c,IAAI7c,KAAK8T,IAElBmJ,EAAI,EAER7J,EAAEyG,UAAY7Z,KAAK6Z,UACnBzG,EAAEsC,QAAU1V,KAAK0V,QAEM,SAAnB1V,KAAK0T,EAAEwG,UACP9G,EAAE8J,YACF9J,EAAE+J,YAAcnd,KAAK0T,EAAEwG,QACvB9G,EAAEyJ,IAAI7c,KAAK2Z,GAAI3Z,KAAK2Z,GAAI3Z,KAAK4Z,OAAQ5Z,KAAKgc,SAAW,KAAShc,KAAK0Z,WAAa,MAAS,GACzFtG,EAAEgK,UAGFpd,KAAK0T,EAAEkC,kBACPoH,EAAKhd,KAAK6c,IAAI7c,KAAK6T,GACnBT,EAAE8J,YACF9J,EAAE+J,YAAcnd,KAAKsU,OACrBlB,EAAEyJ,IAAI7c,KAAK2Z,GAAI3Z,KAAK2Z,GAAI3Z,KAAK4Z,OAAQoD,EAAGrJ,EAAGqJ,EAAGzJ,EAAGyJ,EAAG3J,GACpDD,EAAEgK,SACFH,EAAIjd,KAAK8T,IAAM9T,KAAK6T,GAGxBT,EAAE8J,YACF9J,EAAE+J,YAAcF,EAAIjd,KAAK0T,EAAEW,QAAUrU,KAAKqU,QAC1CjB,EAAEyJ,IAAI7c,KAAK2Z,GAAI3Z,KAAK2Z,GAAI3Z,KAAK4Z,OAAQvO,EAAEsI,EAAGtI,EAAEkI,EAAGlI,EAAEgI,GACjDD,EAAEgK,UAGNpd,KAAKqW,OAAS,WACVrW,KAAK4L,IAAI5L,KAAK6T,KAItBxS,EAAEgc,GAAGC,KAAOjc,EAAEgc,GAAGlW,KAAO,SAAUuM,GAC9B,OAAO1T,KAAK4W,KACR,WACI,IAAIvD,EAAI,IAAIlE,EAAEqK,KACdnG,EAAEK,EAAIA,EACNL,EAAEhS,EAAIA,EAAErB,MACRqT,EAAE2B,QAERmC,UA1wBV,CA4wBG9V,GCvwBHrC,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,8CAGpCE,KAAM,SAAUC,EAAkBC,EAAaM,GAChCE,KACNF,OAASA,EADHE,KAGNC,OAAOV,EAAkBC,EAAaM,GAHhCE,KAKNud,WAAave,OAAOuB,SAASC,IAAI,mDAAoDV,GAL/EE,KAQNW,eACD6c,wBAAyBxe,OAAO6B,YAAY,mEAAmEC,OAAO,4BAM9HK,cAAe,WACX,IACI6B,EAEA2D,EADA8W,KAOJ,OALA9W,EAJW3G,KAIKa,YAAY,yBAC5BmC,EALWhD,KAKC4G,UACZ6W,EAAaC,MAAQ1a,EAAK0a,MANf1d,KAONoB,QAAUuF,EAASO,OAAOuW,GAPpBzd,KASCoB,SAIhBE,WAAY,WACGtB,KACNsC,qBAGTqb,kBAAmB,SAASC,GACxBvc,EAAEuc,GAAMtW,SAAS,oBAAoBuW,WAAWtW,YAAY,qBAGhEuW,gBAAiB,SAASnb,EAAO7C,GAClBE,KACN2d,kBAAkBtc,EAAE,oCAAsCvB,EAAOkC,KAAKE,UAAY,KAD5ElC,KACuFoB,WAGtGkB,kBAAmB,WACf,IAAIvC,EAAOC,KACPuC,EAAWxC,EAAKyC,aACpBnB,EAAE,wBAAyBkB,GAAUE,GAAG,QAASpB,EAAEI,MAAM1B,EAAKge,cAAehe,IAC7EA,EAAKyB,IAAI,aAAcH,EAAEI,MAAM1B,EAAK+d,gBAAiB/d,KAGzDyS,MAAO,WACH,IACIjQ,EADOvC,KACSwC,aAEhBD,GACAlB,EAAE,wBAAyBkB,GAAUyb,IAAI,SAJlChe,KAMNyS,MAAM,aAAcpR,EAAEI,MANhBzB,KAM2B8d,gBAN3B9d,QAUf4G,QAAS,WAEL,OADW5G,KACCud,WAAW3W,WAG3BmX,cAAe,SAAUva,GACrB,IACIV,EAASzB,EAAEmC,EAAGV,QAAQC,QAAQ,yBAC9ByJ,EAAQ1J,EAAOE,KAAK,SACpBA,EAAOF,EAAOE,KAAK,QACZA,EAAKgG,cAJLhJ,KAMN2d,kBAAkB7a,GAEvB,IAAId,GACAC,SAAUuK,EACVtK,UAAWc,EACXb,MAAO,GAXAnC,KAaNoC,IAAI,UACLC,KAAM,aACNL,KAAMX,EAAEjC,OAfDY,KAeaF,OAAQkC,QAOxChD,OAAOuB,SAASmS,SAAS,2CAA4C,mBAAoB,cAAe1T,OAAOC,WAAWC,QAAQgB,MAAM+d,UC7FxIjf,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,gEAKpCE,KAAM,SAAUC,EAAkBC,EAAaM,GAChCE,KAGNC,OAAOV,EAAkBC,EAAaM,GAE3CA,EAASA,MALEE,KAQNW,eACDud,kCAAmClf,OAAO6B,YAAY,6DAA6DC,OAAO,uCAQlIK,cAAe,WACX,IAEIwF,EAFO3G,KAESa,YAAY,mCAGhC,OALWb,KAGNoB,QAAUuF,EAASO,WAHblH,KAKCoB,WAIpBpC,OAAOuB,SAASmS,SAAS,6DAA8D,mBAAoB,cAAe1T,OAAOC,WAAWC,QAAQif,QAAQza,KAAKT,WAAWmb,UAAU,GClCtLpf,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,oDAIrCE,KAAM,SAAUC,EAAkBC,EAAaE,EAAUI,GACtD,IAAIC,EAAOC,KACXD,EAAKD,OAASA,EACdC,EAAK+E,eAGL/E,EAAKE,OAAOV,EAAkBC,EAAaM,GAC3CC,EAAKL,SAAWA,EAGhBK,EAAKY,eACF0d,cAAerf,OAAO6B,YAAY,yDAAyDC,OAAO,kBAGrGf,EAAKue,cAGRnd,cAAe,WAGZ,OAFWnB,KACNoB,QAAUC,EAAE,eADNrB,KAECoB,SAGfE,WAAY,WACEtB,KACNue,eAGRA,YAAa,WACV,IAAIxe,EAAOC,KACR2G,EAAW5G,EAAKc,YAAY,eAC/Bd,EAAKue,UAAUE,YAAc7X,EAASO,WACtCnH,EAAKue,UAAUG,UACZC,UAAWrd,EAAE,mBAAoBtB,EAAKue,UAAUE,aAChDG,cAAetd,EAAE,kBAAmBtB,EAAKue,UAAUE,aACnDI,WAAYvd,EAAE,6BAA8BtB,EAAKue,UAAUE,aAC3DK,aAAcxd,EAAE,6BAA8BtB,EAAKue,UAAUE,cAEhEze,EAAKue,UAAUG,SAASG,WAAWnc,GAAG,QAASpB,EAAEI,MAAM1B,EAAK+e,gBAAiB/e,IAC7EA,EAAKue,UAAUG,SAASI,aAAapc,GAAG,QAASpB,EAAEI,MAAM1B,EAAKgf,eAAgBhf,IAE9EA,EAAKL,SAAWV,OAAOuB,SAASC,IAAI,aAGvCue,eAAgB,WACF/e,KACNse,UAAUE,YAAYQ,OAAO,WADvBhf,KAENse,UAAUE,YAAYS,SAFhBjf,KAGNse,UAAUY,aAAe,IAGjCnM,iBAAkB,SAAUjT,EAAQN,EAAasF,GAC9C,IAAI/E,EAAOC,KACXD,EAAKD,OAASA,EACdC,EAAKP,YAAcA,EACnBO,EAAK+E,eAAiBA,EACtB/E,EAAKqB,QAAUC,EAAE,eACjBtB,EAAKwe,cAELxe,EAAKue,UAAUG,SAASE,cAAchT,KAAK,IAC3C5L,EAAKP,YAAY2f,8BAA8BC,eAAgBtf,EAAOuf,eAAena,KAAK,SAAUlC,GACjG,IAAIsc,GAAmBC,SAAW3b,GAAI,aACtC0b,EAAgBC,MAAQvc,EACxBjD,EAAKue,UAAUG,SAASE,cAAca,SACnCC,YAAY,EACZzc,KAAMsc,EACNI,UAAW,SAAUC,GAClB,OAAOA,EAAI/b,IAEdgc,SAAU,SAAUD,GACjB,OAAOA,EAAIhc,MAEdkc,SAAU,SAAUF,GACjB,IAAIhX,EAAQgX,EAAIG,GAAG9c,KAAK,SACxBjD,EAAKue,UAAUG,SAASE,cAAc/S,IAAIjD,GAC1C5I,EAAKue,UAAUY,aAAevW,GAC/ByP,IAAI,kBAGTrY,EAAKue,UAAUG,SAASE,cAAcoB,QAAQ,WACtB,GAAjBpd,MAAMmW,SAAiC,IAAjBnW,MAAMmW,UAC7BnW,MAAMoJ,iBACNhM,EAAKue,UAAUY,aAAe,GAC9Bnf,EAAKue,UAAUG,SAASE,cAAc/S,IAAI,IAC1CvK,EAAE,QAAStB,EAAKue,UAAUG,SAASE,eAAe/S,IAAI,OAIzD5I,EAAK4B,OAAS,EACbvD,EAAE,kBAAmBtB,EAAKue,UAAUE,aAAa1R,OAGjDzL,EAAE,kBAAmBtB,EAAKue,UAAUE,aAAazR,SAErD5G,KAAK,WACL9E,EAAE,kBAAmBtB,EAAKue,UAAUE,aAAazR,SAEpDhN,EAAKue,UAAUE,YAAYQ,QACxBgB,WAAW,EACXC,WAAW,EACXvT,OAAQ,OACRD,MAAO,QACPyT,OAAO,EACP1T,MAAOxN,OAAO6C,aAAaC,YAAY,gDACvCwK,UAAU,EACV6T,MAAO,WACJpgB,EAAKue,UAAUE,YAAYQ,OAAO,WAClCjf,EAAKue,UAAUE,YAAYS,aAKpCH,gBAAiB,SAAUnc,GACxBA,EAAMoJ,iBACK/L,KACFogB,kBADEpgB,KAEHqgB,iBAKXA,cAAe,WACZ,IAAItgB,EAAOC,KACPsgB,EAAoBvgB,EAAKD,OAAOuf,cAAgB,KAEhDrM,GACD5J,cAAepK,OAAOuhB,YAAYnR,OAClCxL,QAAI2H,EACJxF,UAAW,KACXqC,aAAc,KACdgX,eAAgBkB,EAChBE,YAAa,KACb1a,aAAc,UACdnC,KAAM5D,EAAKue,UAAUG,SAASC,UAAU9S,MACxC6U,mBAAmB,EACnBnY,QAAS,KACTxD,eAAgB/E,EAAK+E,eACrB4b,WAAY3gB,EAAKue,UAAUY,cAE9B7d,EAAE2D,KAAKjF,EAAK4gB,mBAAmB3N,IAAgBtJ,KAAK,SAAUlE,IAC3DwN,EAAgB3R,EAAEjC,OAAO4T,GAAgBpP,GAAI4B,EAAS5B,MACxCX,cACd+P,EAAcrI,SAGd,IAAI7G,EAAa,IAAI9E,OAAOC,WAAW8E,SAASC,UAAUC,iBAAiBlE,EAAKP,aAChFO,EAAKD,OAAOqE,qBACZpE,EAAKD,OAAOqE,kBAAkBC,uBAC1BN,EAAWO,yBAAyBrF,OAAOsF,cAAcC,wBAC7DxE,EAAKD,OAAOqE,kBAAkBK,oBAC1BV,EAAWO,yBAAyBrF,OAAOsF,cAAcG,qBAC7D1E,EAAKD,OAAOqE,kBAAkBO,uBAC1BZ,EAAWO,yBAAyBrF,OAAOsF,cAAcK,wBAG7DqO,EAAcrP,KAAO3E,OAAOwJ,KAAKoY,WAAW5N,EAAcrP,MAEzDtC,EAAE2D,KAAKlB,EAAWmB,6BAA6B+N,EAAcpP,GAAIoP,EAAclO,iBAAiBI,KAAK,SAAUC,GAC3GpF,EAAKqC,IAAI,eAAiB4Q,cAAeA,EAAe5N,UAAWD,IACnEpF,EAAKgf,iBACLhf,EAAKL,SAASiC,kBACVC,OAAO5C,OAAO6C,aAAaC,YAAY,mCAAoC,UAK1Fse,eAAgB,WACb,IACIzc,EADO3D,KACKse,UAAUG,SAASC,UACnC,GAAI/a,EAAKiI,OAAwB,KAAfjI,EAAKiI,MACpB,OAAO,EAEP,IAAIiV,EAAiB7hB,OAAO6C,aAAaC,YAAY,qDAErD,OADA6B,EAAKmd,OAAOpV,KAAK,QAAQC,KAAKkV,IACvB,GAIbF,mBAAoB,SAAU7gB,GAC3B,IACI4Q,EAAQrP,EAAEsP,WASd,OARAtP,EAAE2D,KAFShF,KAECR,YAAYuhB,SAASjhB,IAASyF,OAAO,SAAUC,EAAUwb,EAAcC,GAC7D,MAAfA,EAAIxb,OACLiL,EAAMY,QAAQ9L,GAGdkL,EAAMwQ,WAGLxQ,EAAMa,aAInBvS,OAAOuB,SAASmS,SAAS,iDAAkD,mBAAoB,cAAe,WAAY1T,OAAOC,WAAWC,QAAQif,QAAQza,KAAKyd,SCrMjKniB,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,kDAIpCE,KAAM,SAAUC,EAAkBC,EAAaE,EAAUI,GACrD,IAAIC,EAAOC,KACXD,EAAKD,OAASA,EACdC,EAAKqhB,WAGLrhB,EAAKE,OAAOV,EAAkBC,EAAaM,GAC3CC,EAAKL,SAAWA,EAGhBK,EAAKY,eACD0gB,gCAAiCriB,OAAO6B,YAAY,uDAAuDC,OAAO,oCAGtHf,EAAKI,kBAGTgB,cAAe,WAGX,OAFWnB,KACNoB,QAAUC,EAAE,eADNrB,KAECoB,SAGhBE,WAAY,aAIZggB,mBAAoB,WACLthB,KACNG,cAAcse,SAAS8C,aAAaC,WAAW,WADzCxhB,KAENG,cAAcqe,YAAYQ,OAAO,WAF3Bhf,KAGNG,cAAcqe,YAAYS,UAGnC1Y,UAAW,SAAUzG,EAAQN,EAAa4hB,GACtC,IAAIrhB,EAAOC,KACP0Q,EAAQrP,EAAEsP,WA0Bd,OAzBA5Q,EAAKqhB,WAAaA,EAClBrhB,EAAK0hB,kBAAkBL,GACvBrhB,EAAKI,cAAcse,SAASC,UAAU9S,IAAI5M,OAAOwJ,KAAKkZ,mBAAmBN,EAAWzd,OACpF5D,EAAKI,cAAcse,SAASkD,UAAU/V,IAAI5M,OAAOwJ,KAAKkZ,mBAAmBN,EAAWZ,cACpFzgB,EAAKI,cAAcse,SAASmD,uBAAuBC,KAAM,UAAWT,EAAWX,mBAC/E1gB,EAAKI,cAAcse,SAAS8C,aAAaC,aACzCzhB,EAAKI,cAAcse,SAAS8C,aAAaC,WAAW,SAAU,aAAcxiB,OAAOwJ,KAAKC,cAAcqZ,qCACnGV,EAAW9Y,SACVvI,EAAKI,cAAcse,SAAS8C,aAAaC,WAAW,UAAW,IAAIjZ,KAAK6Y,EAAW9Y,UAEvFvI,EAAKI,cAAcqe,YAAYQ,QAC3BgB,WAAW,EACXC,WAAW,EACXvT,OAAQ,OACRD,MAAO,QACPyT,OAAO,EACP1T,MAAOxN,OAAO6C,aAAaC,YAAY,oCACvCwK,UAAU,EACV6T,MAAO,SAAU3c,EAAIsc,GACjB/f,EAAKI,cAAcse,SAAS8C,aAAaC,WAAW,WACpDzhB,EAAKI,cAAcqe,YAAYQ,OAAO,WACtCjf,EAAKI,cAAcqe,YAAYS,SAC/BvO,EAAMY,aAGPZ,EAAMa,WAGjBkQ,kBAAmB,SAAU/d,GACzB,IAAI3D,EAAOC,KACP+hB,EAAmBhiB,EAAKc,YAAY,iCACxCd,EAAKI,cAAcqe,YAAcuD,EAAiB7a,OAAOxD,GACzD3D,EAAKI,cAAcse,UACfC,UAAWrd,EAAE,mBAAoBtB,EAAKI,cAAcqe,aACpDmD,UAAWtgB,EAAE,mBAAoBtB,EAAKI,cAAcqe,aACpD+C,aAAclgB,EAAE,sBAAuBtB,EAAKI,cAAcqe,aAC1DoD,uBAAwBvgB,EAAE,2BAA4BtB,EAAKI,cAAcqe,aACzEI,WAAYvd,EAAE,2BAA4BtB,EAAKI,cAAcqe,aAC7DK,aAAcxd,EAAE,2BAA4BtB,EAAKI,cAAcqe,cAEnEze,EAAKI,cAAcse,SAASG,WAAWnc,GAAG,QAASpB,EAAEI,MAAM1B,EAAKiiB,eAAgBjiB,IAChFA,EAAKI,cAAcse,SAASI,aAAapc,GAAG,QAASpB,EAAEI,MAAM1B,EAAKuhB,mBAAoBvhB,KAI1FiiB,eAAgB,SAAUrf,GACtBA,EAAMoJ,iBACN,IAAIhM,EAAOC,KACPD,EAAKkiB,+BACL5gB,EAAE2D,KAAKjF,EAAKmiB,uBAAuBhd,KAAK,SAASW,GAC7CxE,EAAE2D,KAAKjF,EAAKP,YAAYyG,WAAWJ,IAAeX,KAAK,WACnDnF,EAAKuhB,qBACLvhB,EAAKqC,IAAI,qBACL+f,eAAgBtc,MAGrBM,KAAK,WACJpG,EAAKqC,IAAI,yBAMzB8f,oBAAqB,WACjB,IAAIniB,EAAOC,KACP0Q,EAAQrP,EAAEsP,WACV9K,MACJA,EAAe9F,EAAKqhB,YAEPzd,KAAO5D,EAAKI,cAAcse,SAASC,UAAU9S,MAC1D/F,EAAa2a,YAAczgB,EAAKI,cAAcse,SAASkD,UAAU/V,MACA,IAA9D7L,EAAKI,cAAcse,SAASmD,uBAAuBhd,SAClDiB,EAAa4a,kBAAoB1gB,EAAKI,cAAcse,SAASmD,uBAAuBC,KAAK,YAG7F,IAAIO,EAAariB,EAAKI,cAAcse,SAAS8C,aAAaC,WAAW,WACrE,GAAGY,EAAW,CACV,IAAItiB,GACAsP,OAAQpQ,OAAOuhB,YAAYnR,OAC3BuC,KAAMyQ,EAAWxQ,WAErBvQ,EAAE2D,KAAKjF,EAAKP,YAAY6iB,wBAAwBviB,IAASoF,KAAK,SAAUlC,GACpE6C,EAAayC,QAAUtF,EAAKsf,SAC5B5R,EAAMY,QAAQzL,UAIlB6K,EAAMY,QAAQzL,GAGlB,OAAO6K,EAAMa,WAIjB0Q,4BAA6B,WACzB,IACIte,EADO3D,KACKG,cAAcse,SAASC,UACvC,GAAI/a,EAAKiI,OAAwB,KAAfjI,EAAKiI,MACnB,OAAO,EAEP,IAAIiV,EAAiB7hB,OAAO6C,aAAaC,YAAY,qDAErD,OADA6B,EAAKmd,OAAOpV,KAAK,QAAQC,KAAKkV,IACvB,KAKnB7hB,OAAOuB,SAASmS,SAAS,+CAAgD,mBAAoB,cAAe,WAAY1T,OAAOC,WAAWC,QAAQif,QAAQza,KAAK6e,OAAO,GCpJtKvjB,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,6DAIpCE,KAAM,SAAUC,EAAkBC,EAAaM,GAC3C,IAAIC,EAAOC,KACXD,EAAKD,OAASA,EACdC,EAAK+E,eACL/E,EAAKyiB,eAGLziB,EAAKE,OAAOV,EAAkBC,EAAaM,GAG3CC,EAAKY,eACD8hB,uBAAwBzjB,OAAO6B,YAAY,kEAAkEC,OAAO,2BAGxHf,EAAKue,cAGTnd,cAAe,WAGX,OAFWnB,KACNoB,QAAUC,EAAE,eADNrB,KAECoB,SAGhBE,WAAY,WACGtB,KACNue,eAGTA,YAAa,WACT,IAAIxe,EAAOC,KACP2G,EAAW5G,EAAKc,YAAY,wBAChCd,EAAKue,UAAUE,YAAc7X,EAASO,WACtCnH,EAAKue,UAAUG,UACXC,UAAWrd,EAAE,uBAAwBtB,EAAKue,UAAUE,aACpDI,WAAYvd,EAAE,iCAAkCtB,EAAKue,UAAUE,aAC/DK,aAAcxd,EAAE,iCAAkCtB,EAAKue,UAAUE,cAErEze,EAAKue,UAAUG,SAASG,WAAWnc,GAAG,QAASpB,EAAEI,MAAM1B,EAAK2iB,oBAAqB3iB,IACjFA,EAAKue,UAAUG,SAASI,aAAapc,GAAG,QAASpB,EAAEI,MAAM1B,EAAKgf,eAAgBhf,KAGlFgf,eAAgB,WACD/e,KACNse,UAAUE,YAAYQ,OAAO,WADvBhf,KAENse,UAAUE,YAAYS,UAG/BxY,yBAA0B,SAAU3G,EAAQN,EAAasF,EAAgB0d,GACrE,IAAIziB,EAAOC,KACXD,EAAKD,OAASA,EACdC,EAAKP,YAAcA,EACnBO,EAAK+E,eAAiBA,EACtB/E,EAAKyiB,eAAiBA,EACtBziB,EAAKqB,QAAUC,EAAE,eACjBtB,EAAKwe,cAELxe,EAAKue,UAAUE,YAAYQ,QACvBgB,WAAW,EACXC,WAAW,EACXvT,OAAQ,OACRD,MAAO,QACPyT,OAAO,EACP1T,MAAOxN,OAAO6C,aAAaC,YAAY,yDACvCwK,UAAU,EACV6T,MAAO,SAAU3c,EAAIsc,GACjB/f,EAAKue,UAAUE,YAAYQ,OAAO,WAClCjf,EAAKue,UAAUE,YAAYS,aAKvCyD,oBAAqB,SAAU/f,GAC3BA,EAAMoJ,iBACN,IAAIhM,EAAOC,KAEX,GAAID,EAAK4iB,8BAA+B,CACpC,IAAI7iB,GACA2D,OAAQ1D,EAAKyiB,eACb7e,KAAM5D,EAAKue,UAAUG,SAASC,UAAU9S,OAE5CvK,EAAE2D,KAAKjF,EAAKP,YAAYojB,qBAAqB9iB,IAASoF,KAAK,WACvDnF,EAAKgf,iBACLhf,EAAKqC,IAAI,mCACV+D,KAAK,WACJpG,EAAKqC,IAAI,oCAMrBugB,4BAA6B,WACzB,IACIhf,EADO3D,KACKse,UAAUG,SAASC,UACnC,GAAI/a,EAAKiI,OAAwB,KAAfjI,EAAKiI,MACnB,OAAO,EAEP,IAAIiV,EAAiB7hB,OAAO6C,aAAaC,YAAY,qDAErD,OADA6B,EAAKmd,OAAOpV,KAAK,QAAQC,KAAKkV,IACvB,KAKnB7hB,OAAOuB,SAASmS,SAAS,0DAA2D,mBAAoB,cAAe1T,OAAOC,WAAWC,QAAQif,QAAQza,KAAKiD,SAASwa,SCzGvKniB,OAAOC,WAAWC,QAAQ2jB,MAAMC,WAAW1jB,OAAO,6CAC9CE,KAAM,SAAUC,EAAkBC,EAAaM,GAChCE,KAGNC,OAAOV,EAAkBC,EAAaM,GAHhCE,KAMNW,eACDoiB,oBAAqB/jB,OAAO6B,YAAY,sDAAsDC,OAAO,kDACrGkiB,2BAA4BhkB,OAAO6B,YAAY,sDAAsDC,OAAO,yDAC5GmiB,2BAA4BjkB,OAAO6B,YAAY,sDAAsDC,OAAO,0DAC5GoiB,2BAA4BlkB,OAAO6B,YAAY,sDAAsDC,OAAO,yDAC5GqiB,+BAAgCnkB,OAAO6B,YAAY,sDAAsDC,OAAO,6DAChHsiB,+BAAgCpkB,OAAO6B,YAAY,sDAAsDC,OAAO,6DAChHuiB,6BAA8BrkB,OAAO6B,YAAY,sDAAsDC,OAAO,2DAC9GwiB,kCAAmCtkB,OAAO6B,YAAY,sDAAsDC,OAAO,gEACnHyiB,kCAAmCvkB,OAAO6B,YAAY,sDAAsDC,OAAO,gEACnH0iB,cAAc,KAGtBC,cAAe,WACX,OAAOzkB,OAAOC,WAAWC,QAAQC,OAAOukB,wCAG5CviB,cAAe,WACX,IAEIC,EADAuF,EADO3G,KACSa,YAAY,qBAKhC,OAFAO,EAJWpB,KAIIoB,QAAUC,EAAEsiB,KAAKhd,MAJrB3G,KAKN4jB,gBACExiB,GAIXwiB,cAAe,WACX,IAAI7jB,EAAOC,KAGXD,EAAK8jB,mBAAqB9jB,EAAKc,YAAY,qBAC3Cd,EAAK+jB,kBAAoB/jB,EAAKc,YAAY,4BAC1Cd,EAAKgkB,kBAAoBhkB,EAAKc,YAAY,4BAC1Cd,EAAKikB,kBAAoBjkB,EAAKc,YAAY,4BAC1Cd,EAAKkkB,eAAiBlkB,EAAKc,YAAY,gCACvCd,EAAKmkB,sBAAwBnkB,EAAKc,YAAY,gCAC9Cd,EAAKokB,oBAAsBpkB,EAAKc,YAAY,8BAC5Cd,EAAKqkB,iBAAmBrkB,EAAKc,YAAY,mCACzCd,EAAKskB,wBAA0BtkB,EAAKc,YAAY,oCAGpDS,WAAY,WACGtB,KACNskB,YAAc,GADRtkB,KAENukB,cAAgB,EAFVvkB,KAKNwkB,qBALMxkB,KAMNykB,aAMTA,UAAW,WACP,IAAI1kB,EAAOC,KAGP0kB,GACAC,UAEAC,KAEJ7kB,EAAK8kB,mBACL9kB,EAAK+kB,kBACL/kB,EAAKglB,mBACLhlB,EAAKilB,mBAELN,EAAcC,MAAMxb,MAChB7F,OAAQvD,EAAKD,OAAOkD,KAAKM,OACzBC,WAAYxD,EAAKD,OAAOkD,KAAKO,aAEjCqhB,EAAoBzb,MAChB8b,SAAUllB,EAAKD,OAAOkD,KAAKM,OAAS,KAAOvD,EAAKD,OAAOkD,KAAKkiB,OAC5D3hB,WAAYxD,EAAKD,OAAOkD,KAAKO,aAGjCxD,EAAK2kB,cAAgBA,EACrB3kB,EAAK6kB,oBAAsBA,EAC3B7kB,EAAKolB,iBAAiBplB,EAAKqB,QAASrB,EAAK6kB,sBAM7CC,iBAAkB,WACd,IAEIO,EAFArlB,EAAOC,KACPoB,EAAUrB,EAAKyC,aAInBzC,EAAKslB,iBAAmB,iBACxBtlB,EAAKulB,eAAiB,GACtBvlB,EAAKwlB,iBAAmB,GACxBxlB,EAAK2kB,cAAgB,GACrB3kB,EAAK6kB,oBAAsB,GAC3B7kB,EAAKylB,aAAe,GACpBzlB,EAAK0lB,YAAc,GAInBpkB,EAAE,iBAAiBsK,KAAK3M,OAAO6C,aAAaC,YAAY,+CACxDT,EAAE,YAAaD,GAASqP,SACxBpP,EAAE,kBAAmBD,GAASqP,SAC9BpP,EAAE,kCAAmCD,GAASqP,SAG9C2U,EAAS/jB,EAAEsiB,KAAK5jB,EAAKqkB,qBACrBhjB,EAAQ6F,OAAOme,IAMnBN,gBAAiB,WACb,IACI1jB,EADOpB,KACQwC,aAEnBnB,EAAE,0BAA2BD,GAASogB,YAClCkE,YAAa,SACbvY,WAAY,cAOpB4X,iBAAkB,WACd,IAAIhlB,EAAOC,KACPoB,EAAUrB,EAAKyC,aAEnBxD,OAAO2mB,oBACPtkB,EAAE,gBAAgBoP,SAElB1Q,EAAK0lB,YAAc,IAAIzmB,OAAOC,WAAWC,QAAQ0mB,YAAY7lB,EAAKR,iBAAkBQ,EAAKP,YAAa6B,EAAEjC,OAAOW,EAAKD,QAChH+lB,OAAQxkB,EAAE,eAAgBD,MAG9BrB,EAAK0lB,YAAYve,UAMrB4e,qBAAsB,WAClB,IAAI/lB,EAAOC,KACPoB,EAAUrB,EAAKyC,aACf6G,EAAMhI,EAAEsP,WAEZtP,EAAE,4BAA4BsK,KAAK,IAEnC5L,EAAKgmB,WAAa,IAAI/mB,OAAOC,WAAWC,QAAQ8mB,WAAWjmB,EAAKR,iBAAkBQ,EAAKP,YAAa6B,EAAEjC,OAAOW,EAAKD,QAC9G+lB,OAAQxkB,EAAE,2BAA4BD,GACtC6kB,eAAgBjnB,OAAO6C,aAAaC,YAAY,+CAChDokB,UAAW7c,KAGftJ,EAAKgmB,WAAW7e,SAEhB7F,EAAE2D,KAAKqE,GAAKnE,KAAK,SAAUihB,EAAQjY,GAC/BnO,EAAKqmB,yBAAyBD,EAAQjY,MAO9CmY,YAAa,SAAUjlB,EAAStB,EAAQwmB,GACpC,IAAIvmB,EAAOC,KAGEF,EAAOymB,KAApBD,GAAsD,EAEtDjlB,EAAE2D,KACEjF,EAAKP,YAAYgnB,kBAAkB1mB,IACrCoF,KAAK,SAAUuhB,GAYb,GATAplB,EAAE,iBAAiBoP,SACnBpP,EAAE,+BAA+BoP,SACjCpP,EAAE,iCAAiCoP,SAGnC1Q,EAAK2mB,aAAeD,EAAWE,QAE/B5mB,EAAK6mB,WAAaH,EAAWI,MAEzBJ,EAAWK,KAAKliB,OAAS,EAAG,CAE5B7E,EAAKgnB,2BAA2B3lB,EAASqlB,GACzC1mB,EAAKinB,mBAAmB5lB,GAExB,IAGI6lB,EAHAC,EAAcnnB,EAAKwkB,cAAgBxkB,EAAK6mB,WAAc7mB,EAAK6mB,WAAa7mB,EAAKwkB,cAC7E4C,EAAiB9lB,EAAE,+BACnB+lB,KAIJA,EAAUC,WAActnB,EAAK6mB,WAAa,EAC1CQ,EAAUE,KAAOb,EAAWa,KAC5BF,EAAUG,SAEV,IAAK,IAAIrf,EAAI,EAAGA,GAAKgf,EAAYhf,IAC7Bkf,EAAiB,MAAElf,IACfsf,WAActf,GAKtB+e,EAAiB5lB,EAAEsiB,KAAK5jB,EAAKkkB,eAAgBmD,GAAWzb,OACxDwb,EAAelgB,OAAOggB,GAGtB5lB,EAAE,MAAMomB,kBACJnD,YAAavkB,EAAKukB,YAClBsC,WAAY7mB,EAAK6mB,WACjBc,WAAYjB,EAAWa,KACvBK,YAAatmB,EAAE,+BACfumB,cAAe,SAAUC,GACrB9nB,EAAKsmB,YAAYjlB,EAAStB,EAAQ+nB,EAAQP,cAIlDtoB,OAAO8oB,eAAe9oB,OAAO6C,aAAaC,YAAY,6CAA8C,SAAU,aAInHqE,KAAK,SAAU4hB,GACd/oB,OAAOgpB,IAAID,MAOnBhB,2BAA4B,SAAU3lB,EAASqlB,GAC3C,IAAI1mB,EAAOC,KAEPioB,EAAiBloB,EAAKmoB,qBAAqBzB,EAAW0B,QAAS1B,GAC/D2B,EAAiB/mB,EAAEsiB,KAAK5jB,EAAKikB,mBAC7BmE,QAAS1B,EAAW0B,QACpBrB,KAAMmB,IAGNI,EAAiBhnB,EAAEsiB,KAAK5jB,EAAKmkB,0BAC7BoE,EAAejnB,EAAEsiB,KAAK5jB,EAAKokB,wBAE/B9iB,EAAE,YAAaD,GAAS2L,OACxB1L,EAAE,kBAAmBD,GAASuK,KAAKyc,GACnC/mB,EAAE,8BAA+BD,GAAS6F,OAAOohB,GACjDhnB,EAAE,8BAA+BD,GAAS6F,OAAOqhB,GAEjDjnB,EAAE,iBAAiBsK,KAAK3M,OAAO6C,aAAaC,YAAY,kDACxDT,EAAE,+BAAgCD,GAAS2L,OAC3C1L,EAAE,yBAA0BD,GAAS2L,OACrC1L,EAAE,uBAAwBD,GAASgX,IAAI,UAAW,UAElDrY,EAAKwoB,oBAAoBnnB,GACzBrB,EAAKyoB,uBAAuBpnB,IAMhC8mB,qBAAsB,SAAUC,EAAS1B,GAOrC,IANA,IAEIwB,KACArjB,EAAS6hB,EAAWK,KAAKliB,OACzBsD,EAAI,EAEDA,EAAItD,EAAQsD,IACf+f,EAAe9e,KAPRnJ,KAOkByoB,kBAAkBN,EAAS1B,EAAWK,KAAK5e,KAGxE,OAAO+f,GAMXQ,kBAAmB,SAAUN,EAASO,GAClC,IAUIC,EACAC,EAEAC,EAGAC,EAhBA/oB,EAAOC,KAEP+oB,EAAcL,EAAQ1lB,KACtBM,EAASolB,EAAQplB,OACjB0lB,EAAaN,EAAQO,WAErBC,KACAC,KAQAC,KAGAzhB,GAAK,EACL0hB,EAAc,EAEdC,GAAkB,EAQtB,IALAH,EAAahgB,MACTvF,GAAI,iBACJ+E,MAAOrF,IAGJqE,IAAMwgB,EAAQvjB,OAAS,GAE1B,OAAQujB,EAAQxgB,GAAG4hB,WACf,KAAKxpB,EAAKypB,UAAUC,WAEhBN,EAAahgB,MACTvF,GAAI,aACJ+E,OACIrF,OAAUA,EACVmmB,WAAcV,EAAYM,MAIlCA,IACA,MAEJ,KAAKtpB,EAAKypB,UAAUE,QAEhBP,EAAahgB,MACTvF,GAAI,aACJ+E,MAAOogB,EAAYM,KAGvBA,IACA,MAEJ,KAAKtpB,EAAKypB,UAAUtb,SACpB,KAAKnO,EAAKypB,UAAUG,KACpB,KAAK5pB,EAAKypB,UAAUI,YAGhB,QAAqBre,IAAjBod,EAA4B,CAE5B,IADA,IAAIxZ,EAAI4Z,EAAYnkB,OACbuK,KAAM,GACT,GAAIzO,MAAMmpB,QAAQd,EAAY5Z,IAAK,CAC/BwZ,EAAeI,EAAY5Z,GAG3Bma,GAAkB,EAClB,MAGRD,IAIAC,GAGInB,EAAQxgB,GAAG4hB,WAAaxpB,EAAKypB,UAAUI,aACvCb,EAAYe,OAAOniB,EAAG,GAG1BkhB,EAAiBF,EAAa,GAE1B5oB,EAAKypB,UAAUtb,UAAYia,EAAQxgB,GAAG4hB,WACtCJ,EAAeA,EAAaroB,OAAOf,EAAKgqB,sBAAsBlB,KAEL,GAArDO,EAAgBhe,QAAQrL,EAAKypB,UAAUtb,WACvCkb,EAAgBjgB,KAAKpJ,EAAKypB,UAAUtb,WAEpCnO,EAAKypB,UAAUG,MAAQxB,EAAQxgB,GAAG4hB,WAClCJ,EAAeA,EAAaroB,OAAOf,EAAKiqB,kBAAkBnB,EAAgBvlB,KAErB,GAAjD8lB,EAAgBhe,QAAQrL,EAAKypB,UAAUG,OACvCP,EAAgBjgB,KAAKpJ,EAAKypB,UAAUG,OAEpC5pB,EAAKypB,UAAUI,aAAezB,EAAQxgB,GAAG4hB,YACzCJ,EAAeA,EAAaroB,OAAOf,EAAKkqB,sBAAsBpB,KAEF,GAAxDO,EAAgBhe,QAAQrL,EAAKypB,UAAUI,cACvCR,EAAgBjgB,KAAKpJ,EAAKypB,UAAUI,eAIhDzB,EAAQxgB,GAAG4hB,WAAaxpB,EAAKypB,UAAUI,cAEvCT,EAAeA,EAAaroB,QACxBopB,sBAAyBnB,EAAYphB,MAGmB,GAAxDyhB,EAAgBhe,QAAQrL,EAAKypB,UAAUI,cACvCR,EAAgBjgB,KAAKpJ,EAAKypB,UAAUI,cAIhD,MAQJ,KAAK7pB,EAAKypB,UAAUW,oBAEhBhB,EAAahgB,MACTvF,GAAI,sBACJ+E,MAAOogB,EAAYM,KAGvBA,IACA,MAEJ,KAAKtpB,EAAKypB,UAAUY,eAEhBjB,EAAahgB,MACTvF,GAAI,iBACJ+E,MAAOogB,EAAYM,KAGvBA,IACA,MAEJ,QACIF,EAAahgB,MACTvF,GAAI,cACJ+E,MAAOogB,EAAYM,KAGvBA,IAuBZ,GAjBAF,EAAahgB,MACTvF,GAAI,cACJ+E,OACIrF,OAAUA,EACV+mB,WAAcrB,KAKtBE,EAAY/f,MACR6C,KAAM,YACNhJ,KAAMmmB,KAGVP,EAAqBD,EAAeA,EAAa/jB,OAAS,GAGjC,EAAG,CACxBkkB,EAAwBM,EAAgBxkB,OACxC,IAAK,IAAIsD,EAAI,EAAGA,EAAI0gB,EAAoB1gB,IAAK,CAEzC,IAAIoiB,KAIJ,IAHInb,GAAK,EAGFA,IAAM2Z,EAAwB,GAC7BM,EAAgBja,IAAMpP,EAAKypB,UAAUG,KACrCW,EAASnhB,KAAKpJ,EAAKiqB,kBAAkBrB,EAAazgB,GAAI5E,IAElD8lB,EAAgBja,IAAMpP,EAAKypB,UAAUI,YACrCU,EAASnhB,KAAKpJ,EAAKkqB,sBAAsBtB,EAAazgB,KAElDkhB,EAAgBja,IAAMpP,EAAKypB,UAAUtb,UACrCoc,EAASnhB,KAAKpJ,EAAKgqB,sBAAsBpB,EAAazgB,KAGtEghB,EAAY/f,MACR6C,KAAM,WACNhJ,KAAMsnB,KAKlB,OACItnB,KAAMkmB,EACNqB,UAAW3B,IAOnBoB,kBAAmB,SAAUQ,EAAYlnB,GAQrC,OANImnB,SAAYD,EAAWC,SACvBC,WAAcF,EAAWE,WACzBpnB,OAAUA,EACVC,WAAcinB,EAAWjnB,WACzBonB,OAAUH,EAAWG,SAQ7BV,sBAAuB,SAAUO,GAC7B,IAAI7K,KAGJ,OAFC6K,EAAgC,sBAAI7K,EAAIuK,sBAAwBM,EAAWN,sBAAwBvK,EAAIuK,sBAAwB,GAEzHvK,GAMXoK,sBAAuB,SAAUS,GAC7B,IAAI7K,KAGJ,OAFC6K,EAAmB,SAAI7K,EAAIzR,SAAWsc,EAAWI,SAAWjL,EAAIzR,SAAW,GAErEyR,GAMXkL,gBAAiB,SAAUzpB,GACvB,IAAIrB,EAAOC,KACP8qB,GACAnG,UAGJtjB,EAAE,yCAA0CD,GAASwV,KAAK,WACtD,IAAIhL,EAAMvK,EAAErB,MAAM4L,MAClBkf,EAAcnG,MAAMxb,MAChB7F,OAAQsI,MAIkB,GAA9Bkf,EAAcnG,MAAM/f,OACpB5F,OAAO8oB,eAAe9oB,OAAO6C,aAAaC,YAAY,0DAA2D,SAAU,WAE3HT,EAAE2D,KAAKhG,OAAOsG,oBAAoBtG,OAAO6C,aAAaC,YAAY,4DAA6D,SAAU,YACpIoD,KAAK,WACF,IAAI6lB,EAAS1pB,EAAE,aAAcD,GAASwK,MAClC9L,GACA6N,OAAQ,QACRgX,MAAOqG,KAAKC,UAAUH,GACtBC,OAAQA,GAGZ1pB,EAAE2D,KAAKjF,EAAKP,YAAY0rB,mBAAmBprB,IAASoF,KAAK,SAAUimB,GAC/DprB,EAAKqrB,sBAAsBhqB,EAAS+pB,EAAY3lB,SAAU,gBAC3DW,KAAK,SAAU4hB,GACd/oB,OAAOgpB,IAAID,QAS/BsD,uBAAwB,SAAUjqB,GAC9B,IACIsjB,GACAC,UAEAC,KAEJvjB,EAAE,6CAA8CD,GAASwV,KAAK,WAC1D,IAAI0U,EAAQjqB,EAAErB,MAAM4L,MACpB0f,EAAQA,EAAMC,MAAM,KACpB7G,EAAcC,MAAMxb,MAChB7F,OAAQgoB,EAAM,GACd/nB,WAAY+nB,EAAM,KAEtB1G,EAAoBzb,MAChB8b,SAAUqG,EAAM,GAAK,KAAOA,EAAM,GAClC/nB,WAAY+nB,EAAM,OAIQ,GAA9B1G,EAAoBhgB,OACpB5F,OAAO8oB,eAAe9oB,OAAO6C,aAAaC,YAAY,wDAAyD,SAAU,YApBlH9B,KAsBF0kB,cAAgBA,EAtBd1kB,KAuBF4kB,oBAAsBA,EAvBpB5kB,KAwBFmlB,iBAAiB/jB,EAASwjB,KAOvCO,iBAAkB,SAAU/jB,EAASwjB,GACtB5kB,KACNqlB,iBAAmB,cACxB,IAAI+C,EAAiB/mB,EAAEsiB,KAFZ3jB,KAEsBokB,kBAC7BkH,MAAO1G,IAGXvjB,EAAE,kBAAmBD,GAAS2L,OAC9B1L,EAAE,mBAAoBD,GAASuK,KAAKyc,GACpC/mB,EAAE,+BAAgCD,GAAS2L,OAC3C1L,EAAE,yBAA0BD,GAAS2L,OACrC1L,EAAE,iBAAiBsK,KAAK3M,OAAO6C,aAAaC,YAAY,qDAV7C9B,KAWN8lB,wBAOT0F,cAAe,WACX,IAAIzrB,EAAOC,KACPoB,EAAUrB,EAAKyC,aAEf1C,GACA6N,OAAQ,gBACRgX,MAAOqG,KAAKC,UAAUlrB,EAAK2kB,eAC3B+G,UAAW1rB,EAAKulB,gBAGpBjkB,EAAE2D,KAAKjF,EAAKP,YAAYksB,gBAAgB5rB,IAASoF,KAAK,SAAUymB,GAC5D5rB,EAAKqrB,sBAAsBhqB,EAASuqB,EAAenmB,SAAU,cAC9DW,KAAK,SAAU4hB,GACd/oB,OAAOgpB,IAAID,MAOnBqD,sBAAuB,SAAUhqB,EAASwqB,EAAQvpB,GAC9C,IACIsL,EAASie,EAAOhnB,OAAS,EAAI,WAAa,GAC1C8Y,EAAQ,GACRmO,EAAc,GACdC,KAGJ,GAAc,eAFdne,EAAStL,EAAOsL,GAGZ,IAAK,IAAIzF,EAAI,EAAGA,EAAI0jB,EAAOhnB,OAAQsD,IACN,GAArB0jB,EAAO1jB,GAAG6jB,SACVrO,EAAQkO,EAAO1jB,GAAG5E,OAClBoa,GAAUxV,EAAI,EAAK0jB,EAAOhnB,OAAS,KAAO,GAC1CknB,EAAa,IAAK,IAElBD,EAAcD,EAAO1jB,GAAG5E,OACxBuoB,GAAgB3jB,EAAI,EAAK0jB,EAAOhnB,OAAS,KAAO,GAChDknB,EAAa,IAAK,QAGvB,GAAc,sBAAVne,EACP,IAASzF,EAAI,EAAGA,EAAI0jB,EAAOhnB,OAAQsD,IACN,GAArB0jB,EAAO1jB,GAAG6jB,SACVrO,GAASkO,EAAO1jB,GAAG5E,OACnBoa,GAAUxV,EAAI,EAAK0jB,EAAOhnB,OAAS,KAAO,GAC1CknB,EAAa,IAAK,IAElBD,GAAeD,EAAO1jB,GAAG5E,OACzBuoB,GAAgB3jB,EAAI,EAAK0jB,EAAOhnB,OAAS,KAAO,GAChDknB,EAAa,IAAK,QAGvB,GAAc,YAAVne,EACP,IAASzF,EAAI,EAAGA,EAAI0jB,EAAOhnB,OAAQsD,IACH,GAAxB0jB,EAAO1jB,GAAG8jB,YACVtO,GAASkO,EAAO1jB,GAAG5E,OACnBoa,GAAUxV,EAAI,EAAK0jB,EAAOhnB,OAAS,KAAO,GAC1CknB,EAAa,IAAK,IAElBD,EAAcD,EAAO1jB,GAAG5E,OACxBuoB,GAAgB3jB,EAAI,EAAK0jB,EAAOhnB,OAAS,KAAO,GAChDknB,EAAa,IAAK,QAGvB,GAAc,oBAAVne,EAA8B,CACrC+P,GAAS,aACTmO,GAAe,aACf,IAAS3jB,EAAI,EAAGA,EAAI0jB,EAAOhnB,OAAQsD,IACH,GAAxB0jB,EAAO1jB,GAAG8jB,YACVtO,GAASkO,EAAO1jB,GAAG5E,OAAS,QAC5BwoB,EAAa,IAAK,IAElBD,GAAeD,EAAO1jB,GAAG5E,OAAS,QAClCwoB,EAAa,IAAK,GAG1BpO,GAAS,QACTmO,GAAe,QAInB,IAAIzD,EAAiB/mB,EAAEsiB,KA5DZ3jB,KA4DsBqkB,yBAC7B1W,OAAQA,EACRme,aAAcA,IAKlB1D,GADAA,GADAA,GADAA,EAAiBA,EAAe,GAAG6D,UAAUC,QAAQ,MAAO,WAAaxO,EAAQ,cACjDwO,QAAQ,MAAO,WAAaL,EAAc,cAC1CK,QAAQ,MAlE7BlsB,KAkEyCulB,mBACpB2G,QAAQ,MAnE7BlsB,KAmEyCulB,kBAGxC,cAARljB,GAAsBhB,EAAE,iBAAiBsK,KAAK3M,OAAO6C,aAAaC,YAAY,8DAClFT,EAAE,YAAaD,GAASuK,KAAK,IAC7BtK,EAAE,kBAAmBD,GAASgX,IAAI,UAAW,UAC7C/W,EAAE,kBAAmBD,GAASuK,KAAKyc,GACnC/mB,EAAE,mBAAoBD,GAASqP,SAC/BpP,EAAE,cAAeD,GAASqP,SAC1BpP,EAAE,uBAAwBD,GAASgX,IAAI,UAAW,QAClD/W,EAAE,+BAAgCD,GAASgX,IAAI,UAAW,QAC1D/W,EAAE,yBAA0BD,GAASgX,IAAI,UAAW,QACpD/W,EAAE,yBAA0BD,GAASgX,IAAI,UAAW,UACpD/W,EAAE,kCAAkC0L,OACpC1L,EAAE,kCAAkC0L,OAjFzB/M,KAmFN+lB,WAAW+F,cAAgD,GAAhCA,EAAa1gB,SAAQ,IAUzD4Z,iBAAkB,WACd,IAAIjlB,EAAOC,KACPoB,EAAUrB,EAAKyC,aACf2pB,EAAU9qB,EAAEsiB,KAAK5jB,EAAKgkB,sBAE1B3iB,EAAQ6F,OAAOklB,GAEf,IAAIC,EAAkB/qB,EAAE,kCAAmCD,GAE3DC,EAAE,+BAAgC+qB,GAAiBtgB,MAAM,SAAUyH,GAG/DlS,EAAE,qBAAsBD,GAASwK,IAAI,IACrCvK,EAAE,0BAA2BD,GAASwK,IAAI,IAC1C7L,EAAKglB,qBAIT1jB,EAAE,yBAA0B+qB,GAAiBtgB,MAAM,SAAUyH,GAEzD,IAAI8Y,EAAc,GACdC,EAAmB,GACnBC,EAAkB,GAClBC,EAAe,GACfC,EAAiB,GAEjBC,EAAuB3sB,EAAK0lB,YAAYkH,uBAExCD,EAAqB9nB,OAAS,IACK,GAA/B8nB,EAAqB9nB,QACrBynB,EAAcK,EAAqB,GACnCH,EAAkBG,EAAqB,GACvCJ,EAAmB,KAGnBD,EAAcK,EAAqBA,EAAqB9nB,OAAS,GACjE0nB,EAAmBI,EAAqB,GACxCH,EAAkBG,EAAqB,KAI/C,IAAI5sB,GACA8sB,SAAU,WACVC,eAAgB,UAChBC,QAAS,GACTC,QAAS,MACTC,aAAa,EACbC,UAAW,EACXC,MAAO,GACPC,WAAY,GACZC,YAAa/rB,EAAE,cAAcuK,MAC7ByhB,YAAad,EACbe,eAAgBjsB,EAAE,kBAAkBuK,MACpC2hB,eAAgBlsB,EAAE,sBAAsBuK,MACxC4hB,qBAAsBnsB,EAAE,cAAcuK,MACtC6hB,mBAAoBpsB,EAAE,WAAWuK,MACjC8hB,gBAAiB,GACjBC,aAAcrB,EACdsB,gBAAiBvB,EACjBwB,SAAU9tB,EAAKukB,aAIU,IAAzBjjB,EAAE,cAAcuK,OAAgB5M,OAAOwJ,KAAKslB,OAAOzsB,EAAE,cAAcuK,OAKtC,IAAtBvK,EAAE,WAAWuK,OAAgB5M,OAAOwJ,KAAKslB,OAAOzsB,EAAE,WAAWuK,QAMpE7L,EAAKylB,aAAe1lB,EACpBC,EAAKsmB,YAAYjlB,EAAStB,KAN1B0sB,EAAextB,OAAO6C,aAAaC,YAAY,mCAC/C2qB,EAAiBztB,OAAO6C,aAAaC,YAAY,6CACjD0qB,EAAeA,EAAaN,QAAQ,MAAOO,GAC3CztB,OAAO8oB,eAAe0E,EAAc,SAAU,aAR9CA,EAAextB,OAAO6C,aAAaC,YAAY,mCAC/C2qB,EAAiBztB,OAAO6C,aAAaC,YAAY,gDACjD0qB,EAAeA,EAAaN,QAAQ,MAAOO,GAC3CztB,OAAO8oB,eAAe0E,EAAc,SAAU,cAatDnrB,EAAE,uBAAwB+qB,GAAiBtgB,MAAM,SAAUyH,GAC1B,kBAAzBxT,EAAKslB,iBACLtlB,EAAKguB,iBAC2B,eAAzBhuB,EAAKslB,kBACZtlB,EAAKiuB,gBAIb3sB,EAAE,yBAA0B+qB,GAAiBtgB,MAAM,SAAUyH,GACzDxT,EAAKmM,QAAQ,yBAQrB8hB,YAAa,WAET,IACI5sB,EADOpB,KACQwC,aADRxC,KAGNqlB,iBAAmB,iBACxBhkB,EAAE,kBAAmBD,GAAS0L,OAC9BzL,EAAE,mBAAoBD,GAASuK,KAAK,IACpCtK,EAAE,eAAeoP,SACjBpP,EAAE,iBAAiBsK,KAAK3M,OAAO6C,aAAaC,YAAY,kDACxDT,EAAE,+BAAgCD,GAAS2L,OAC3C1L,EAAE,yBAA0BD,GAAS2L,QAMzCghB,eAAgB,WAEZ,IACI3sB,EADOpB,KACQwC,aAEnBnB,EAAE,YAAaD,GAAS0L,OACxBzL,EAAE,kBAAmBD,GAASuK,KAAK,IACnCtK,EAAE,iBAAiBsK,KAAK3M,OAAO6C,aAAaC,YAAY,+CACxDT,EAAE,+BAAgCD,GAAS0L,OAC3CzL,EAAE,yBAA0BD,GAAS0L,OACrCzL,EAAE,uBAAwBD,GAASgX,IAAI,UAAW,SAMtDgO,yBAA0B,SAAUD,EAAQjY,GAC7BlO,KACNslB,eAAiBa,EADXnmB,KAENulB,iBAAmBrX,EAFblO,KAGNwrB,iBAMTxE,mBAAoB,SAAU5lB,GAC1B,IAAIrB,EAAOC,KAGXqB,EAAE,6BAA8BD,GAAS0K,MAAM,SAAUyH,GACrDxT,EAAK8qB,gBAAgBzpB,KAIzBC,EAAE,2BAA4BD,GAAS0K,MAAM,SAAUyH,GACnDxT,EAAKsrB,uBAAuBjqB,MAOpCmnB,oBAAqB,SAAUnnB,GAC3B,IAAIrB,EAAOC,KAGXqB,EAAE,mBAAoBD,GAAS0K,MAAM,WACjC/L,EAAKmM,QAAQ,iBACTyB,OAAQ3O,OAAOC,WAAW2O,QAAQD,OAAOE,iCACzCvK,OAAQjC,EAAErB,MAAM,GAAGiuB,aAAa,eAChC1qB,WAAYlC,EAAErB,MAAM,GAAGiuB,aAAa,mBACpCtD,OAAQtpB,EAAErB,MAAM,GAAGiuB,aAAa,iBAEpCluB,EAAKmM,QAAQ,wBAKjB7K,EAAE,eAAgBD,GAAS0K,MAAM,WAC7B/L,EAAKmM,QAAQ,iBACTyB,OAAQ3O,OAAOC,WAAW2O,QAAQD,OAAOE,iCACzCvK,OAAQjC,EAAErB,MAAM,GAAGiuB,aAAa,eAChC1qB,WAAY,GACZonB,OAAQ,KAEZ5qB,EAAKmM,QAAQ,wBAIjB7K,EAAE,uBAAwBD,GAAS0K,MAAM,WACrC,IAAIoiB,EAAgB7sB,EAAErB,MAAM,GAAGiuB,aAAa,oBACxCE,EAAgB9sB,EAAErB,MAAM,GAAGiuB,aAAa,kBACxCG,EAAkB/sB,EAAErB,MAAM,GAAGiuB,aAAa,wBAG1CE,EADiB,KAAjBA,EACgB,EAEA,EAGpBpuB,EAAKylB,aAAa0H,MAAQgB,EAC1BnuB,EAAKylB,aAAayH,UAAYkB,EAC9BpuB,EAAKylB,aAAa2H,WAAaiB,EAC/BruB,EAAKsmB,YAAYjlB,EAASrB,EAAKylB,aAAczlB,EAAKylB,aAAae,SAQvEiC,uBAAwB,SAAUpnB,GAE9B,IAAIrB,EAAOC,KAGXqB,EAAE,4BAA6BD,GAAS0K,MAAM,WAC1C,IAAIxI,EAASjC,EAAErB,MAAMgD,KAAK,UACtBgmB,EAAa3nB,EAAErB,MAAMgD,KAAK,cAC9BjD,EAAKsuB,kBACD/qB,OAAQA,EACR0lB,WAAYA","sourcesContent":["/*\r\n *   Name: Bizagi Workportal Desktop descontextualized plans Manager\r\n *   Author: Ivn Ricardo Taimal Narvez\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend('bizagi.workportal.widgets.plans.manager', {}, {\r\n\r\n    usersMap: {},\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, actionService, notifier, planTemplateCreate, planPopupEdit, serviceOrderActivitiesByTransitions,params) {\r\n        var self = this;\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n        self.serviceOrderActivitiesByTransitions = serviceOrderActivitiesByTransitions;\r\n\r\n        self.plans = {};\r\n        self.editDialogBox = {};\r\n        self.allIdUsers = [];\r\n        self.allGuidUsers = [];\r\n        self.notifier = notifier;\r\n        self.planTemplateCreate = planTemplateCreate;\r\n        self.planPopupEdit = planPopupEdit;\r\n        self.globalHandlersService = bizagi.injector.get('globalHandlersService');\r\n        self.usersFromIdPlan=Array();\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            'plans.manager.wrapper': bizagi.getTemplate('bizagi.workportal.desktop.widget.decontextualized.plans.manager').concat('#plans-manager-wrapper'),\r\n            'plans.manager.empty': bizagi.getTemplate('bizagi.workportal.desktop.widget.decontextualized.plans.manager').concat('#plans-manager-empty-message'),\r\n            'plans.manager.users': bizagi.getTemplate('bizagi.workportal.desktop.widget.decontextualized.plans.manager').concat('#plans-manager-users'),\r\n            'plans.manager.activities.tooltip': bizagi.getTemplate('bizagi.workportal.desktop.widget.decontextualized.plans.manager').concat('#plans-manager-activities-tooltip'),\r\n            'plans.manager.context.menu.content': bizagi.getTemplate('bizagi.workportal.desktop.widget.decontextualized.plans.manager').concat('#plans-manager-context-menu-content')\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Renders the template defined in the widget\r\n     * @return {*|jQuery|HTMLElement}\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n\r\n        self.content = $('<div/>'); // self.getEmptyDataMessage().render({});\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        self.getCalculatedDateServer();\r\n\r\n        self.sub('PLANS-VIEW', $.proxy(self.updateView, self));\r\n\r\n        self.planTemplateCreate.sub('planTemplateCreatedSuccess', function () {\r\n            self.notifier.showSucessMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-create-template-success'), ''));\r\n        });\r\n        self.planTemplateCreate.sub('planTemplateCreatedFailed', function () {\r\n            self.notifier.showErrorMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-create-template-fail'), ''));\r\n        });\r\n\r\n        self.planPopupEdit.sub('planEditedSuccess', function () {\r\n            var args = {\r\n                histName: self.params.histName,\r\n                planState: self.params.planState,\r\n                level: 1\r\n            };\r\n            self.pub('notify', {\r\n                type: 'PLANS-VIEW',\r\n                args: $.extend(self.params, args)\r\n            });\r\n\r\n            self.notifier.showSucessMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-edit-success'), ''));\r\n        });\r\n\r\n        self.planPopupEdit.sub('planEditedFailed', function () {\r\n            self.notifier.showErrorMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-edit-fail'), ''));\r\n        });\r\n\r\n    },\r\n\r\n    /**\r\n     * Binds events to handles\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n        $('.wdg-plans-manager-card', $content).on('click', $.proxy(self.onClickPlan, self));\r\n        $('.wdg-plans-manager-card .btn-workonit', $content).on('click', function (event) {\r\n            event.stopPropagation();\r\n            var target = $(event.target);\r\n            var planCard = target.closest('.wdg-plans-manager-card');\r\n            var planId = planCard.data('plan-id');\r\n            self.plans[planId].activities.forEach(function(activity) {\r\n                if (self.runningActivity(activity)) {\r\n                    self.goToWorkOnIt(activity.idCase, activity.idWorkItem);\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param ev\r\n     */\r\n    onClickPlan: function (ev) {\r\n        var self = this,\r\n            target = $(ev.target).closest('.wdg-plans-manager-card'),\r\n            idPlan = target.data('plan-id'),\r\n            namePlan = target.data('plan-name');\r\n        var plan = {\r\n            name: namePlan,\r\n            id: idPlan\r\n        };\r\n        self.showPlanDashBoard(plan);\r\n    },\r\n\r\n    /**\r\n     * Show plan dashboard\r\n     * @param plan\r\n     */\r\n    showPlanDashBoard: function (plan) {\r\n        var self = this;\r\n        var servicesPD = new bizagi.workportal.services.behaviors.projectDashboard(self.dataService);\r\n\r\n        self.params.showContextByMenuDashboard = \"PLANACTIVITIES\";\r\n        self.params.menuPlanDashboard = {};\r\n        self.params.menuPlanDashboard.showCommentsOptionMenu =\r\n            servicesPD.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonComments;\r\n        self.params.menuPlanDashboard.showFilesOptionMenu =\r\n            servicesPD.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonFiles;\r\n        self.params.menuPlanDashboard.showTimeLineOptionMenu =\r\n            servicesPD.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonTimeLine;\r\n\r\n        plan = self.plans[plan.id];\r\n        if (plan.name.length > 28) {\r\n            plan.name = plan.name.substring(0, 29) + \"...\";\r\n        }\r\n\r\n        if(plan.contextualized){\r\n           delete self.params.flowContext;\r\n        }\r\n\r\n        $.when(servicesPD.getRadNumberForPlanDashboard(plan.id, plan.contextualized)).done(function (responseRadNumber) {\r\n            self.params.radNumber = responseRadNumber;\r\n            var args = {\r\n                plan: plan,\r\n                level: 2,\r\n                histName: plan.name\r\n            };\r\n            self.pub('notify', {\r\n                type: self.params.showContextByMenuDashboard,\r\n                args: $.extend(self.params, args)\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n     * delete plan\r\n     * @param plan\r\n     */\r\n    deletePlan: function (plan) {\r\n        var self = this;\r\n        $.when(bizagi.showConfirmationBox(bizagi.localization.getResource('workportal-project-plan-action-delete-confirmation'), '', 'info')).done(function () {\r\n            var params = {\r\n                id: plan.id\r\n            };\r\n            $.when(self.dataService.deletePlan(params)).always(function (response) {\r\n                if (response.status === 200 || typeof (response.status) === \"undefined\") {\r\n                    $.extend(self.params.plan, params);\r\n                    var args = {\r\n                        histName: self.params.histName,\r\n                        planState: self.params.planState,\r\n                        level: 1\r\n                    };\r\n                    self.pub('notify', {\r\n                        type: 'PLANS-VIEW',\r\n                        args: $.extend(self.params, args)\r\n                    });\r\n                    self.notifier.showSucessMessage(\r\n                        printf(bizagi.localization.getResource('workportal-project-plan-delete-success'), ''));\r\n                }\r\n                else{\r\n                    self.notifier.showErrorMessage(\r\n                        printf(bizagi.localization.getResource('workportal-project-plan-delete-fail'), ''));\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Execute plan\r\n     * @param plan\r\n     */\r\n    executePlan: function (plan) {\r\n        var self = this;\r\n        var numberActivitiesCreated = plan.activitiesLength;\r\n        if (numberActivitiesCreated > 0) {\r\n            var params = {\r\n                idPlan: plan.id\r\n            };\r\n            $.when(self.dataService.putExecutePlan(params)).done(function () {\r\n                var updateParams = self.plans[plan.id];\r\n                if (updateParams) {\r\n                    updateParams.currentState = 'EXECUTING';\r\n                    updateParams = $.extend(updateParams, { startDate: self.getDateServer() });\r\n                    $.when(self.dataService.updatePlan(updateParams)).done(function () {\r\n                        var args = {\r\n                            histName: self.params.histName,\r\n                            planState: self.params.planState,\r\n                            level: 1\r\n                        };\r\n                        self.pub('notify', {\r\n                            type: 'PLANS-VIEW',\r\n                            args: $.extend(self.params, args)\r\n                        });\r\n                        self.notifier.showSucessMessage(\r\n                            printf(bizagi.localization.getResource('workportal-project-plan-state-change-running'), ''));\r\n                    });\r\n                }\r\n            });\r\n        } else {\r\n            self.notifier.showErrorMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-action-execute-message-activities-required'), ''));\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Close plan\r\n     * @param plan\r\n     */\r\n    closePlan: function (plan) {\r\n        var self = this;\r\n        var updateParams = self.plans[plan.id];\r\n        if (updateParams) {\r\n            updateParams.currentState = 'CLOSED';\r\n            $.when(self.dataService.closePlan({idPlan: plan.id})).done(function () {\r\n                $.when(self.dataService.updatePlan(updateParams)).done(function () {\r\n                    var args = {\r\n                        histName: self.params.histName,\r\n                        planState: self.params.planState,\r\n                        level: 1\r\n                    };\r\n                    self.pub('notify', {\r\n                        type: 'PLANS-VIEW',\r\n                        args: $.extend(self.params, args)\r\n                    });\r\n                    self.notifier.showSucessMessage(\r\n                        printf(bizagi.localization.getResource('workportal-project-plan-close-success'), ''));\r\n                });\r\n            }).fail(function () {\r\n                self.notifier.showErrorMessage(\r\n                    printf(bizagi.localization.getResource('workportal-project-plan-close-fail'), ''));\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Show popup for edit plan\r\n     */\r\n    openPopupEditTemplate: function () {\r\n        var self = this;\r\n        var planSelected = self.plans[self.selectedPlan.id] || {};\r\n\r\n        self.planPopupEdit.showPopup(self.params, self.dataService, planSelected);    \r\n    },\r\n\r\n    /**\r\n     * Show popup for save plan as template\r\n     */\r\n    openPopupSaveTemplate: function () {\r\n        var self = this;\r\n        var planSelected = self.plans[self.selectedPlan.id] || {};\r\n\r\n        self.planTemplateCreate.showPopupAddTemplatePlan(self.params,\r\n            self.dataService, planSelected.contextualized, planSelected.id);\r\n\r\n    },\r\n\r\n    /**\r\n     * Render content widget\r\n     * @param event\r\n     * @param params\r\n     */\r\n    updateView: function (event, params) {\r\n        var self = this;\r\n        self.params = params.args;\r\n        self.getContent().empty();\r\n        var template = self.getTemplate('plans.manager.wrapper');\r\n\r\n        $.when(self.getData())\r\n            .done(function (data) {\r\n                if (data.length > 0) {\r\n                    self.content.empty();\r\n                    self.arrayPlans = self.processData(data);\r\n                    var totalAssignees = self.arrayPlans.length;\r\n                    var assignees = self.arrayPlans;\r\n                    assignees.totalAssignees = totalAssignees;\r\n                    self.content.append(template.render({plans: assignees}));\r\n                    $('.wdg-plans-row-dial', self.content).knob();\r\n                    self.updatePlanDetails();\r\n                    self.configureHandlers();\r\n                    self.configureContextMenu();\r\n                   \r\n                    $(\"#ui-bizagi-wp-project-homeportal-main\").addClass(\"disabled-right-sidebar\").removeClass(\"enabled-right-sidebar\");\r\n                }\r\n                else {\r\n                    self.content.empty();\r\n                    self.content.append(self.getTemplate('plans.manager.empty').render());\r\n                }\r\n            });\r\n    },\r\n    getPictureAndName: function(idCurrentPlan){ //The first time that the page is loaded usersMap doesn't have data. So this method verify and complete the data if this is not completed\r\n        var self = this;\r\n        if(self.thereWasUsersMap === false){\r\n            if (self.usersMap) {\r\n                for (var j = 0; j < self.usersFromIdPlan[idCurrentPlan].length; j += 1) {\r\n                    var user = self.usersMap[self.usersFromIdPlan[idCurrentPlan][j].userAssigned];\r\n                    self.usersFromIdPlan[idCurrentPlan][j].picture = user.picture;\r\n                    self.usersFromIdPlan[idCurrentPlan][j].name = user.name;\r\n                }\r\n            }\r\n        }\r\n    },\r\n   \r\n\r\n    /**\r\n     *\r\n     * @param activities\r\n     * @param transitions\r\n     */\r\n    orderActivitiesByTransitions: function(activities, transitions){\r\n        var self = this;\r\n        return self.serviceOrderActivitiesByTransitions.\r\n        getActivitiesByTransitions(activities, transitions);\r\n    },\r\n\r\n    /**\r\n     * Process data for render widget\r\n     * @param data\r\n     * @returns {*}\r\n     */\r\n    processData: function (data) {\r\n        var self = this;\r\n        var length = data.length;\r\n        for (var i = 0; i < length; i += 1) {\r\n            self.plans[data[i].id] = data[i];\r\n            var fromDate = data[i].startDate || data[i].creationDate;\r\n            var toDate = data[i].dueDate;\r\n\r\n            if (fromDate) {\r\n                fromDate = new Date(fromDate);\r\n                data[i].fromDate = bizagi.util.dateFormatter.getRelativeTime(fromDate, null, false);\r\n            }\r\n\r\n            if (toDate) {\r\n                toDate = new Date(toDate);\r\n                data[i].toDate = bizagi.util.dateFormatter.getRelativeTime(toDate, null, false);\r\n            }\r\n\r\n            data[i].value = 0;\r\n            data[i].completedActivities = 0;\r\n            data[i].activitiesLength = 0;\r\n            if(data[i].dueDate){\r\n                data[i].dueDateFormat = self.getFormattedDate(new Date(data[i].dueDate));\r\n            }\r\n\r\n            data[i].locatedState = bizagi.localization.getResource(\"workportal-project-plan-state-\" + data[i].currentState.toLowerCase());\r\n        }\r\n\r\n        return data;\r\n    },\r\n\r\n    /**\r\n     * Update sections details plans\r\n     */\r\n    updatePlanDetails: function () {\r\n        var self = this,\r\n            idsUsers = [],\r\n            deferreds = [];\r\n        \r\n        for (var i = 0; i < self.arrayPlans.length; i += 1) {\r\n            idsUsers.push(self.arrayPlans[i].idUserCreator);\r\n            var def = self.getMetaData(self.arrayPlans[i].id);\r\n\r\n            $.when(def, self.arrayPlans[i].id)\r\n                .done(function (activities, idCurrentPlan) {\r\n                    self.plans[idCurrentPlan].activities = activities;\r\n                    self.paintPlanDetails(activities, idCurrentPlan);\r\n                    self.configureActivitiesTooltip(activities, idCurrentPlan);\r\n                });\r\n            deferreds.push(def);\r\n        }\r\n\r\n        $.when.apply($, deferreds).then(function () {\r\n            $.equalizeHeights(\".wdg-plans-manager-card\");\r\n            self.getUsers(idsUsers.concat(self.allIdUsers));\r\n        });\r\n    },\r\n\r\n    /***\r\n     * return the array users from an activity\r\n     */\r\n    getUsersFromIdPlan:function(id_activity) {\r\n        var self=this;\r\n        var usersFromPlan=[];\r\n        self.usersFromIdPlan[id_activity].map(function(uuser) {\r\n            var user = self.usersMap[uuser.userAssigned];\r\n            usersFromPlan.push(\r\n                usersAdapter.createJsonUserInfo(uuser.userAssigned, user.name, user.username, user.picture, user.email, user.name.getInitials(),false, false, uuser.activities, [])\r\n            );\r\n        });\r\n        return usersFromPlan;\r\n    },\r\n\r\n    /**\r\n     * Render plan details\r\n     * @param activities\r\n     * @param idCurrentPlan\r\n     */\r\n    paintPlanDetails: function (activities, idCurrentPlan) {\r\n        var self = this;\r\n        var activitiesLength = activities.length,\r\n            completedActivities = 0,\r\n            progressPlan = 0,\r\n            currentActivities = [],\r\n            planUsersId = [],\r\n            planUsers = [],\r\n            template = self.getTemplate('plans.manager.users');\r\n        self.plans[idCurrentPlan].users = {};\r\n        var lastUpdateToCalculatedClosed = self.plans[idCurrentPlan].startDate || self.plans[idCurrentPlan].creationDate;\r\n\r\n        var $currentCard = $('[data-plan-id=\"' + self.plans[idCurrentPlan].id + '\"]', self.content);\r\n        if (activitiesLength==0) {\r\n            self.usersFromIdPlan[idCurrentPlan] = [{userAssigned:self.plans[idCurrentPlan].idUserCreator,activities:[]}];\r\n        }else{\r\n            self.usersFromIdPlan[idCurrentPlan] =[];\r\n            for (var i = 0; i < activitiesLength; i += 1) {\r\n\r\n                var auxLastDate = (activities[i].finishDate || activities[i].startDate);\r\n                lastUpdateToCalculatedClosed = lastUpdateToCalculatedClosed < auxLastDate ? auxLastDate : lastUpdateToCalculatedClosed;\r\n\r\n                if (activities[i].workItemState === 'Completed') {\r\n                    completedActivities += 1;\r\n                    activities[i].progress = 100;\r\n                }\r\n                if (self.runningActivity(activities[i])) {\r\n                    currentActivities.push(activities[i].name);\r\n                    activities[i].progress = 0;\r\n                }\r\n                if (planUsersId.indexOf(activities[i].userAssigned) < 0) {\r\n                    self.plans[idCurrentPlan].users[activities[i].userAssigned] = [activities[i]];\r\n                    planUsersId.push(activities[i].userAssigned);\r\n                }\r\n                else {\r\n                    self.plans[idCurrentPlan].users[activities[i].userAssigned].push(activities[i]);\r\n                }\r\n                if (self.allIdUsers.indexOf(activities[i].userAssigned) < 0) {\r\n                    self.allIdUsers.push(activities[i].userAssigned);\r\n                    self.allGuidUsers.push(activities[i].userAssigned);\r\n                }\r\n                progressPlan += activities[i].progress;\r\n            }\r\n            \r\n            for (var j = 0; j < planUsersId.length; j += 1) {\r\n                if (!self.usersMap[planUsersId[j]]) {\r\n                    self.thereWasUsersMap = false;\r\n                    planUsers.push({\r\n                        userAssigned: planUsersId[j],\r\n                        picture: '',\r\n                        name: '',\r\n                    });\r\n                    self.usersFromIdPlan[idCurrentPlan].push(\r\n                        usersAdapter.createJsonUserInfo(planUsersId[j],'', '', '', '','' ,false, false, [], [])\r\n                    );\r\n                }\r\n                else {\r\n                    var user = self.usersMap[planUsersId[j]];\r\n                    planUsers.push(user);\r\n                    thereWasUsersMap = true;\r\n                    self.usersFromIdPlan[idCurrentPlan].push({userAssigned:planUsersId[j], activities:[]});\r\n                }\r\n            }\r\n          \r\n            //Add activities to self.usersFromIdPlan\r\n            for(var a=0; a < self.plans[idCurrentPlan].activities.length; a++){\r\n                for(var u=0; u <  self.usersFromIdPlan[idCurrentPlan].length; u++){\r\n                    if(self.usersFromIdPlan[idCurrentPlan][u].userAssigned === self.plans[idCurrentPlan].activities[a].userAssigned){\r\n                        if(self.usersFromIdPlan[idCurrentPlan][u][\"activities\"]==undefined)\r\n                            self.usersFromIdPlan[idCurrentPlan][u][\"activities\"]=[];\r\n                        self.usersFromIdPlan[idCurrentPlan][u][\"activities\"].push(self.plans[idCurrentPlan].activities[a]);\r\n                    }\r\n                }\r\n            }\r\n\r\n            progressPlan = Math.round(progressPlan / activitiesLength);\r\n\r\n            $currentCard.find('.wdg-plans-row-completed').html(completedActivities);\r\n            $currentCard.find('.wdg-plans-row-activities-length').html(activitiesLength);\r\n            $currentCard.find('.wdg-plans-row-dial').val(progressPlan).trigger('change');\r\n            planUsers.idPlan = self.plans[idCurrentPlan].id;\r\n            $currentCard.find('.wdg-plans-users').html(template.render({users: planUsers}));\r\n            $currentCard.find(\".moreUsers\").click(function(event) {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                var id_activity=$(this).attr(\"data-plan-id\");\r\n                self.getPictureAndName(id_activity);\r\n                var usersAssignees = self.getUsersFromIdPlan(id_activity);\r\n                self.globalHandlersService.publish(\"showDialogWidget\", {\r\n                    widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL,\r\n                    closeVisible: true,\r\n                    data: usersAssignees,\r\n                    maximize: true,\r\n                    modalParameters: {\r\n                        title: bizagi.localization.getResource(\"workportal-project-users-title\")+ \" (\"+usersAssignees.length+\")\",\r\n                        width: 790,\r\n                        height: 526,\r\n                        refreshInbox: false\r\n                    }\r\n                });\r\n             });\r\n\r\n            if(self.getVisibleButtonWorkonit(self.plans[idCurrentPlan], progressPlan, currentActivities)){\r\n                $currentCard.find('.wdg-plans-row-activities').html(currentActivities.join(','));\r\n                $currentCard.find('.wdg-plans-workonit-row').show();\r\n            }\r\n            else{\r\n                $currentCard.find('.wdg-plans-activities-row').hide();\r\n                $currentCard.find('.wdg-plans-workonit-row').hide();\r\n            }\r\n        }\r\n\r\n        var nameFirstDate;\r\n        var firstDate;\r\n        if(self.plans[idCurrentPlan].currentState === \"PENDING\"){\r\n            nameFirstDate = bizagi.localization.getResource(\"workportal-general-properties-last-update\");\r\n            firstDate = self.plans[idCurrentPlan].creationDate;\r\n        }\r\n        else if(self.plans[idCurrentPlan].currentState === \"EXECUTING\"){\r\n            nameFirstDate = bizagi.localization.getResource(\"workportal-general-properties-start-date\");\r\n            firstDate = self.plans[idCurrentPlan].startDate;\r\n        }\r\n        else if(self.plans[idCurrentPlan].currentState === \"CLOSED\"){\r\n            nameFirstDate = bizagi.localization.getResource(\"workportal-general-properties-closed-date\");\r\n            firstDate = lastUpdateToCalculatedClosed;\r\n        }\r\n\r\n        var formatFirstDate = self.getFormattedDate(new Date(firstDate));\r\n        $currentCard.find('.first-date-plan').html(nameFirstDate + \": \" + formatFirstDate);\r\n    },\r\n\r\n    getResource: function (key) {\r\n        return bizagi.localization.getResource(key);\r\n    },\r\n\r\n    getFormattedDate: function(dateObject){\r\n        var self = this;\r\n        var dateFormat = self.getResource(\"dateFormat\");\r\n        var dateInvariant = bizagi.util.dateFormatter.formatInvariant(dateObject, false);\r\n        var content = $(\"<span class='formatDate'>\" + dateInvariant + \"</span>\");\r\n        bizagi.util.formatInvariantDate(content, dateFormat);\r\n        return content.text();\r\n    },\r\n\r\n    /**\r\n     * Get visible property of the button work on it\r\n     * @param plan\r\n     * @param planProgress\r\n     * @returns {boolean}\r\n     * @param currentActiveActivities\r\n     */\r\n    getVisibleButtonWorkonit: function(plan, planProgress, currentActiveActivities){\r\n        var responseVisibility = false;\r\n        if(plan.currentState === \"EXECUTING\" && planProgress < 100 && currentActiveActivities.length > 0){\r\n            responseVisibility = true;\r\n        }\r\n        return responseVisibility;\r\n    },\r\n\r\n    /**\r\n     * Go to Workitem\r\n     * @param idCase\r\n     * @param idWorkItem\r\n     */\r\n    goToWorkOnIt: function(idCase, idWorkItem){\r\n        var self = this;\r\n        self.publish(\"executeAction\", {\r\n            action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n            idCase: idCase,\r\n            idWorkItem: idWorkItem\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param activities\r\n     * @param idCurrentPlan\r\n     */\r\n    configureActivitiesTooltip: function (activities, idCurrentPlan) {\r\n        var self = this;\r\n        var toolTiptemplate = self.getTemplate('plans.manager.activities.tooltip');\r\n        var currentPlanCard = $('[data-plan-id=\"' + idCurrentPlan + '\"]', self.content);\r\n        currentPlanCard.find('.wdg-plans-activities-row').tooltip({\r\n            content: function () {\r\n                var $elementsTmpl = $();\r\n                activities.forEach(function (activity) {\r\n                    if (self.runningActivity(activity)) {\r\n                        var estimatedFinishDate = (activity.estimatedFinishDate) ? new Date(activity.estimatedFinishDate) : null;\r\n                        if (self.usersMap[activity.userAssigned]) {\r\n                            activity.userName = self.usersMap[activity.userAssigned].name;\r\n                            activity.userPicture = self.usersMap[activity.userAssigned].picture;\r\n                            activity.formatedEstimatedFinishDate = (estimatedFinishDate) ? bizagi.util.dateFormatter.formatDate(estimatedFinishDate, bizagi.localization.getResource(\"dateFormat\")) : null;\r\n                        }\r\n                        var activityItem = toolTiptemplate.render({activity: activity});\r\n                        $elementsTmpl.push.apply($elementsTmpl, activityItem);\r\n                    }\r\n                });\r\n                return $elementsTmpl;\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Know if the activity is running\r\n     * @param activity\r\n     * @returns {boolean}\r\n     */\r\n    runningActivity: function(activity){\r\n        //Inactive represent created but user dont access yet\r\n        return activity.workItemState === 'Active' || activity.workItemState === 'Inactive';\r\n    },\r\n\r\n    /**\r\n     * User tooltip\r\n     */\r\n    configureUserTooltip: function () {\r\n        var self = this;\r\n        $(\".wdg-plans-users > li\", self.content).not('.icon-more').on('mouseenter', '', function (ev) {\r\n            var $target = $(ev.target);\r\n            var id_userSelected=$target.closest(\"[data-iduser]\").attr('data-iduser');\r\n            var idCurrentPlan=$target.closest(\".wdg-plans-manager-card\").attr('data-plan-id');\r\n            var user=self.usersFromIdPlan[idCurrentPlan].find(function(user) {\r\n                return user.userAssigned==id_userSelected;\r\n            });\r\n            if(user && user.userAssigned==id_userSelected){\r\n                var activities=[];\r\n                user.activities.map(function(activity) {\r\n                    activities.push(activity.name);\r\n                });\r\n                user=self.usersMap[user.userAssigned];\r\n                var userParam=usersAdapter.createJsonUserInfo(user.userAssigned, user.name, user.username, user.picture, user.email, user.name.getInitials(), false,false, activities, []);\r\n                $target.closest(\".wdg-plans-users\").usertooltip(self,{target:$target,user:userParam});\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get data users\r\n     * @param lstUsers\r\n     */\r\n    getUsers: function (lstUsers) {\r\n        var self = this;\r\n        var lstCurrentUsers = [];\r\n        var length = lstUsers.length;\r\n        for (var i = 0; i < length; i += 1) {\r\n            if (!self.usersMap[lstUsers[i]]) {\r\n                lstCurrentUsers.push(lstUsers[i]);\r\n            }\r\n        }\r\n        if (lstCurrentUsers.length > 0) {\r\n            var params = {\r\n                usersGuids: lstUsers.join(),\r\n                width: 32,\r\n                height: 32\r\n            };\r\n            $.when(self.dataService.getUsersData(params)).done(function (users) {\r\n                var length = users.length;\r\n                for (var i = 0; i < length; i += 1) {\r\n                    self.usersMap[users[i].id] = {\r\n                        picture: (users[i].picture) ? 'data:image/png;base64,' + users[i].picture : '',\r\n                        name: users[i].name || '',\r\n                        userAssigned: users[i].id,\r\n                        username: users[i].username,\r\n                        isAnonymized: users[i].isAnonymized,\r\n                        email: users[i].email\r\n                    };\r\n                    self.configureAvatar(users[i].id);\r\n                }\r\n                self.configureUserTooltip();\r\n            });\r\n        } else {\r\n            for (var k = 0; k < lstUsers.length; k += 1) {\r\n                self.configureAvatar(lstUsers[k]);\r\n            }\r\n            self.configureUserTooltip();\r\n        }\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param idUser\r\n     */\r\n    configureAvatar: function (idUser) {\r\n        var self = this;\r\n        var $avatar = $('[data-iduser=\"' + idUser + '\"]', self.content);\r\n        if (self.usersMap[idUser].picture) {\r\n            $avatar.find('.bz-wp-avatar-img').attr('src', self.usersMap[idUser].picture);\r\n        }\r\n        else {\r\n            $avatar.find('.bz-wp-avatar-img').hide();\r\n            $avatar.find('.wdg-plans-row-user-label').html(self.usersMap[idUser].name.getInitials()).show();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Configure context menu by plan\r\n     */\r\n    configureContextMenu: function () {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n        var menuTemplate = self.getTemplate('plans.manager.context.menu.content');\r\n        $('.wdg-plans-leftmenu', $content).on('click', function (event) {\r\n            event.stopPropagation();\r\n            var target = $(event.target);\r\n            var planCard = target.closest('.wdg-plans-manager-card');\r\n            var planId = planCard.data('plan-id');\r\n            var planName = planCard.data('plan-name');\r\n            var planCurrentState = planCard.data('plan-current-state');\r\n            var planActivitiesLength = parseInt(planCard.find('.wdg-plans-row-activities-length').html(), 0);\r\n            var completedActivities = parseInt(planCard.find('.wdg-plans-row-completed').html(), 0);\r\n            var pendingActivities = (isNaN(planActivitiesLength) || isNaN(completedActivities)) ? 0 : planActivitiesLength - completedActivities;\r\n            self.selectedPlan = {\r\n                id: planId,\r\n                name: planName,\r\n                activitiesLength: isNaN(planActivitiesLength) ? 0 : planActivitiesLength,\r\n                completed: (pendingActivities <= 0)\r\n            };\r\n            var contextMenuContent = menuTemplate.render({\r\n                currentState: planCurrentState,\r\n                completed: self.selectedPlan.completed\r\n            });\r\n            $('.plans-manager-context-menu-wrapper', $content).append(contextMenuContent);\r\n            contextMenuContent.menu();\r\n            self.configureMenuHandlers(contextMenuContent);\r\n\r\n            contextMenuContent.position({\r\n                my: 'left top',\r\n                at: 'left bottom',\r\n                of: target,\r\n                collision: 'fit'\r\n            });\r\n            contextMenuContent.show();\r\n            $(document).one('click', function () {\r\n                contextMenuContent.remove();\r\n            });\r\n            $('.wdg-plans-manager-card').one('click', function () {\r\n                contextMenuContent.remove();\r\n            });\r\n            $('.wdg-plans-leftmenu').one('click', function () {\r\n                contextMenuContent.remove();\r\n            });\r\n            // return false;\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Events on contextual menu by plan\r\n     * @param contextMenuContent\r\n     */\r\n    configureMenuHandlers: function (contextMenuContent) {\r\n        var self = this;\r\n        $('#edit', contextMenuContent).on('click', function (event) {\r\n            event.stopPropagation();\r\n            self.openPopupEditTemplate(self.selectedPlan);\r\n        });\r\n        $('#save', contextMenuContent).on('click', function (event) {\r\n            event.stopPropagation();\r\n            self.openPopupSaveTemplate(self.selectedPlan);\r\n        });\r\n        $('#enable', contextMenuContent).on('click', function (event) {\r\n            event.stopPropagation();\r\n            self.executePlan(self.selectedPlan);\r\n        });\r\n        $('#delete', contextMenuContent).on('click', function (event) {\r\n            event.stopPropagation();\r\n            self.deletePlan(self.selectedPlan);\r\n        });\r\n        $('#close', contextMenuContent).on('click', function (event) {\r\n            event.stopPropagation();\r\n            self.closePlan(self.selectedPlan);\r\n        });\r\n    },\r\n\r\n\r\n    /**\r\n     * Get activities and workitems and merge\r\n     * @param idPlan\r\n     * @returns {*}\r\n     */\r\n    getMetaData: function (idPlan) {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        var paramsActivities = {idPlan: idPlan};\r\n        var paramsWorkItems = {idPlan: idPlan};\r\n        var paramsTransition = {idPlan: idPlan};\r\n        $.when(self.dataService.getActivities(paramsActivities),\r\n            self.dataService.getWorkitemsPlan(paramsWorkItems),\r\n            self.dataService.getTransitionsByPlan(paramsTransition)).done(\r\n            function (responseActivities, responseWorkitems, responseTransitions) {\r\n                var activities = responseActivities || [];\r\n                activities = self.orderActivitiesByTransitions( responseActivities, responseTransitions );\r\n                self.mergePropertiesActivitiesWithWorkitems(activities, responseWorkitems);\r\n                defer.resolve(activities);\r\n            });\r\n        return defer.promise();\r\n\r\n    },\r\n    /**\r\n     * Calculated date server\r\n     * @returns {*}\r\n     */\r\n    getCalculatedDateServer: function(){\r\n        var self = this;\r\n        return $.when(self.dataService.getCurrentTimeDateServer()).done(function (response) {\r\n            self.differenceMillisecondsServer = bizagi.util.dateFormatter.getDifferenceBetweenDates(new Date(), new Date(response.date), \"milliseconds\");\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * Return date server\r\n     * @return {*}\r\n     */\r\n    getDateServer: function () {\r\n        var dateLocal = new Date();\r\n        return dateLocal.getTime() + this.differenceMillisecondsServer;\r\n    },\r\n\r\n\r\n    /**\r\n     * @return {object} data\r\n     */\r\n    getData: function () {\r\n        var self = this;\r\n        var $args = {};\r\n        if (self.params.planState !== 'all') {\r\n            $args.currentState = self.params.planState;\r\n        }\r\n        return self.dataService.getUserPlans($args);\r\n    },\r\n\r\n    /**\r\n     * Gets Message when there aren't data\r\n     * @returns {templateEmptyData}\r\n     */\r\n    getEmptyDataMessage: function () {\r\n        var self = this;\r\n        return  self.getTemplate('plans.manager.empty');\r\n    },\r\n\r\n    mergePropertiesActivitiesWithWorkitems: function (activities, workItems) {\r\n        activities.forEach(function (activity) {\r\n            var workItemFilter = workItems.filter(function (workItem) {\r\n                return workItem.guidActivity == activity.id;\r\n            });\r\n            if (workItemFilter.length > 0) {\r\n                $.extend(activity, {\r\n                    startDate: workItemFilter[0].wiEntryDate || null,\r\n                    finishDate: workItemFilter[0].wiSolutionDate || null,\r\n                    idWorkItem: workItemFilter[0].idWorkItem,\r\n                    workItemState: workItemFilter[0].workItemState,\r\n                    idCase: workItemFilter[0].idCase,\r\n                    estimatedFinishDate: workItemFilter[0].wiEstimatedSolutionDate || activity.estimatedFinishDate\r\n                });\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Detach events\r\n     */\r\n    clean: function () {\r\n        var self = this;\r\n        self.params = {};\r\n        self.unsub('PLANS-VIEW', $.proxy(self.updateView, self));\r\n        self.planTemplateCreate.unsub('planTemplateCreatedSuccess');\r\n        self.planTemplateCreate.unsub('planTemplateCreatedFailed');\r\n        self.planPopupEdit.unsub('planEditedSuccess');\r\n        self.planPopupEdit.unsub('planEditedFailed');\r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.plans.manager', ['workportalFacade', 'dataService', 'actionService', 'notifier',\r\n    'bizagi.workportal.widgets.project.plan.template.create',\r\n    'bizagi.workportal.widgets.project.plan.edit',\r\n    'bizagi.workportal.services.behaviors.orderActivitiesByTransitions',\r\n    bizagi.workportal.widgets.plans.manager]);","/*\r\n *   Name: Bizagi Workportal Desktop  plan topmenu controller\r\n *   Author: Ivn Ricardo Taimal Narvez\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend('bizagi.workportal.widgets.plans.topmenu', {}, {\r\n\r\n    init: function (workportalFacade, dataService, planCreate, params) {\r\n        var self = this;\r\n        self.params = params;\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n        self.planCreate = planCreate;\r\n        //Load templates\r\n        self.loadTemplates({\r\n            'plans.topmenu.wrapper': bizagi.getTemplate('bizagi.workportal.desktop.widget.decontextualized.plans.topmenu').concat('#plans-topmenu-wrapper')\r\n        });\r\n    },\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate('plans.topmenu.wrapper');\r\n        self.content = template.render({});\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.configureHandlers();\r\n    },\r\n    /**\r\n     * Binds events to handles\r\n     */\r\n    configureHandlers: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n        $('.wdg-topmenu-add', $content).on('click', $.proxy(self.onClickAddPlan, self));\r\n    },\r\n\r\n    onClickAddPlan: function () {\r\n        var self = this;\r\n\r\n        self.planCreate.showPopupAddPlan(self.params, self.dataService, false);\r\n        self.planCreate.unsub('planCreated');\r\n        self.planCreate.sub('planCreated', function (ev, params) {\r\n            var paramsNewPlan = params.paramsNewPlan;\r\n            var histName = paramsNewPlan.name;\r\n            if (paramsNewPlan.name.length > 28) {\r\n                histName = paramsNewPlan.name.substring(0, 29) + '...';\r\n            }\r\n            self.params.radNumber = params.radNumber;\r\n            self.params.showContextByMenuDashboard = 'PLANACTIVITIES';\r\n            self.pub('notify', {\r\n                type: 'PLANACTIVITIES',\r\n                args: $.extend(self.params, {\r\n                    plan: params.paramsNewPlan,\r\n                    level: 2,\r\n                    histName: histName\r\n                })\r\n            });\r\n        });\r\n    }\r\n\r\n\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.plans.topmenu', ['workportalFacade', 'dataService', 'bizagi.workportal.widgets.project.plan.create', bizagi.workportal.widgets.plans.topmenu]);","(function knob($) {\n\n    /**\n     * Kontrol library\n     */\n    \"use strict\";\n\n    /**\n     * Definition of globals and core\n     */\n    var k = {}, // kontrol\n        max = Math.max,\n        min = Math.min;\n\n    k.c = {};\n    k.c.d = $(document);\n    k.c.t = function (e) {\r\n        return e.originalEvent.touches.length - 1;\r\n    };\n\n    /**\n     * Kontrol Object\n     *\n     * Definition of an abstract UI control\n     *\n     * Each concrete component must call this one.\n     * <code>\n     * k.o.call(this);\n     * </code>\n     */\n    k.o = function () {\r\n        var s = this;\n\n        this.o = null; // array of options\n        this.$ = null; // jQuery wrapped element\n        this.i = null; // mixed HTMLInputElement or array of HTMLInputElement\n        this.g = null; // deprecated 2D graphics context for 'pre-rendering'\n        this.v = null; // value ; mixed array or integer\n        this.cv = null; // change value ; not commited value\n        this.x = 0; // canvas x position\n        this.y = 0; // canvas y position\n        this.w = 0; // canvas width\n        this.h = 0; // canvas height\n        this.$c = null; // jQuery canvas element\n        this.c = null; // rendered canvas context\n        this.t = 0; // touches index\n        this.isInit = false;\n        this.fgColor = null; // main color\n        this.pColor = null; // previous color\n        this.dH = null; // draw hook\n        this.cH = null; // change hook\n        this.eH = null; // cancel hook\n        this.rH = null; // release hook\n        this.scale = 1; // scale factor\n        this.relative = false;\n        this.relativeWidth = false;\n        this.relativeHeight = false;\n        this.$div = null; // component div\n\n        this.run = function () {\r\n            var cf = function (e, conf) {\r\n                var k;\n                for (k in conf) {\r\n                    s.o[k] = conf[k];\r\n                }\n                s._carve().init();\n                s._configure()\n                 ._draw();\r\n            };\n\n            if (this.$.data('kontroled')) return;\n            this.$.data('kontroled', true);\n\n            this.extend();\n            this.o = $.extend({\n                // Config\n                min: this.$.data('min') !== undefined ? this.$.data('min') : 0,\n                max: this.$.data('max') !== undefined ? this.$.data('max') : 100,\n                stopper: true,\n                readOnly: this.$.data('readonly') || (this.$.attr('readonly') === 'readonly'),\n\n                // UI\n                cursor: this.$.data('cursor') === true && 30\n                        || this.$.data('cursor') || 0,\n                thickness: this.$.data('thickness')\n                           && Math.max(Math.min(this.$.data('thickness'), 1), 0.01)\n                           || 0.35,\n                lineCap: this.$.data('linecap') || 'butt',\n                width: this.$.data('width') || 200,\n                height: this.$.data('height') || 200,\n                displayInput: this.$.data('displayinput') == null || this.$.data('displayinput'),\n                displayPrevious: this.$.data('displayprevious'),\n                fgColor: this.$.data('fgcolor') || '#87CEEB',\n                inputColor: this.$.data('inputcolor'),\n                font: this.$.data('font') || 'Arial',\n                fontWeight: this.$.data('font-weight') || 'bold',\n                inline: false,\n                step: this.$.data('step') || 1,\n                rotation: this.$.data('rotation'),\n\n                // Hooks\n                draw: null, // function () {}\n                change: null, // function (value) {}\n                cancel: null, // function () {}\n                release: null, // function (value) {}\n\n                // Output formatting, allows to add unit: %, ms ...\n                format: function (v) {\r\n                    return v;\r\n                },\n                parse: function (v) {\r\n                    return parseFloat(v);\r\n                }\r\n            }, this.o\n            );\n\n            // finalize options\n            this.o.flip = this.o.rotation === 'anticlockwise' || this.o.rotation === 'acw';\n            if (!this.o.inputColor) {\r\n                this.o.inputColor = this.o.fgColor;\r\n            }\n\n            // routing value\n            if (this.$.is('fieldset')) {\n\n                // fieldset = array of integer\n                this.v = {};\n                this.i = this.$.find('input');\n                this.i.each(function (k) {\r\n                    var $this = $(this);\n                    s.i[k] = $this;\n                    s.v[k] = s.o.parse($this.val());\n\n                    $this.bind(\n                        'change blur',\n                        function () {\r\n                            var val = {};\n                            val[k] = $this.val();\n                            s.val(s._validate(val));\r\n                        }\n                    );\r\n                });\n                this.$.find('legend').remove();\r\n            } else {\n\n                // input = integer\n                this.i = this.$;\n                this.v = this.o.parse(this.$.val());\n                this.v === '' && (this.v = this.o.min);\n                this.$.bind(\n                    'change blur',\n                    function () {\r\n                        s.val(s._validate(s.o.parse(s.$.val())));\r\n                    }\n                );\r\n\n            }\n\n            !this.o.displayInput && this.$.hide();\n\n            // adds needed DOM elements (canvas, div)\n            this.$c = $(document.createElement('canvas')).attr({\r\n                width: this.o.width,\n                height: this.o.height\r\n            });\n\n            // wraps all elements in a div\n            // add to DOM before Canvas init is triggered\n            this.$div = $('<div style=\"'\n                + (this.o.inline ? 'display:inline;' : '')\n                + 'width:' + this.o.width + 'px;height:' + this.o.height + 'px;'\n                + '\"></div>');\n\n            this.$.wrap(this.$div).before(this.$c);\n            this.$div = this.$.parent();\n\n            if (typeof G_vmlCanvasManager !== 'undefined') {\r\n                G_vmlCanvasManager.initElement(this.$c[0]);\r\n            }\n\n            this.c = this.$c[0].getContext ? this.$c[0].getContext('2d') : null;\n\n            if (!this.c) {\r\n                throw {\r\n                    name: \"CanvasNotSupportedException\",\n                    message: \"Canvas not supported. Please use excanvas on IE8.0.\",\n                    toString: function () { return this.name + \": \" + this.message }\r\n                }\r\n            }\n\n            // hdpi support\n            this.scale = (window.devicePixelRatio || 1) / (\n                            this.c.webkitBackingStorePixelRatio ||\n                            this.c.mozBackingStorePixelRatio ||\n                            this.c.msBackingStorePixelRatio ||\n                            this.c.oBackingStorePixelRatio ||\n                            this.c.backingStorePixelRatio || 1\n                         );\n\n            // detects relative width / height\n            this.relativeWidth = this.o.width % 1 !== 0\n                                  && this.o.width.indexOf('%');\n            this.relativeHeight = this.o.height % 1 !== 0\n                                  && this.o.height.indexOf('%');\n            this.relative = this.relativeWidth || this.relativeHeight;\n\n            // computes size and carves the component\n            this._carve();\n\n            // prepares props for transaction\n            if (this.v instanceof Object) {\r\n                this.cv = {};\n                this.copy(this.v, this.cv);\r\n            } else {\r\n                this.cv = this.v;\r\n            }\n\n            // binds configure event\n            this.$\n                .bind(\"configure\", cf)\n                .parent()\n                .bind(\"configure\", cf);\n\n            // finalize init\n            this._listen()\n                ._configure()\n                ._xy()\n                .init();\n\n            this.isInit = true;\n\n            this.$.val(this.o.format(this.v));\n            this._draw();\n\n            return this;\r\n        };\n\n        this._carve = function () {\r\n            if (this.relative) {\r\n                var w = this.relativeWidth ?\n                        this.$div.parent().width() *\n                        parseInt(this.o.width) / 100\n                        : this.$div.parent().width(),\n                    h = this.relativeHeight ?\n                        this.$div.parent().height() *\n                        parseInt(this.o.height) / 100\n                        : this.$div.parent().height();\n\n                // apply relative\n                this.w = this.h = Math.min(w, h);\r\n            } else {\r\n                this.w = this.o.width;\n                this.h = this.o.height;\r\n            }\n\n            // finalize div\n            this.$div.css({\r\n                'width': this.w + 'px',\n                'height': this.h + 'px'\r\n            });\n\n            // finalize canvas with computed width\n            this.$c.attr({\r\n                width: this.w,\n                height: this.h\r\n            });\n\n            // scaling\n            if (this.scale !== 1) {\r\n                this.$c[0].width = this.$c[0].width * this.scale;\n                this.$c[0].height = this.$c[0].height * this.scale;\n                this.$c.width(this.w);\n                this.$c.height(this.h);\r\n            }\n\n            return this;\r\n        }\n\n        this._draw = function () {\n\n            // canvas pre-rendering\n            var d = true;\n\n            s.g = s.c;\n\n            s.clear();\n\n            s.dH && (d = s.dH());\n\n            d !== false && s.draw();\r\n        };\n\n        this._touch = function (e) {\r\n            var touchMove = function (e) {\r\n                var v = s.xy2val(\n                            e.originalEvent.touches[s.t].pageX,\n                            e.originalEvent.touches[s.t].pageY\n                        );\n\n                if (v == s.cv) return;\n\n                if (s.cH && s.cH(v) === false) return;\n\n                s.change(s._validate(v));\n                s._draw();\r\n            };\n\n            // get touches index\n            this.t = k.c.t(e);\n\n            // First touch\n            touchMove(e);\n\n            // Touch events listeners\n            k.c.d\n                .bind(\"touchmove.k\", touchMove)\n                .bind(\n                    \"touchend.k\",\n                    function () {\r\n                        k.c.d.unbind('touchmove.k touchend.k');\n                        s.val(s.cv);\r\n                    }\n                );\n\n            return this;\r\n        };\n\n        this._mouse = function (e) {\r\n            var mouseMove = function (e) {\r\n                var v = s.xy2val(e.pageX, e.pageY);\n\n                if (v == s.cv) return;\n\n                if (s.cH && (s.cH(v) === false)) return;\n\n                s.change(s._validate(v));\n                s._draw();\r\n            };\n\n            // First click\n            mouseMove(e);\n\n            // Mouse events listeners\n            k.c.d\n                .bind(\"mousemove.k\", mouseMove)\n                .bind(\n                    // Escape key cancel current change\n                    \"keyup.k\",\n                    function (e) {\r\n                        if (e.keyCode === 27) {\r\n                            k.c.d.unbind(\"mouseup.k mousemove.k keyup.k\");\n\n                            if (s.eH && s.eH() === false)\n                                return;\n\n                            s.cancel();\r\n                        }\r\n                    }\n                )\n                .bind(\n                    \"mouseup.k\",\n                    function (e) {\r\n                        k.c.d.unbind('mousemove.k mouseup.k keyup.k');\n                        s.val(s.cv);\r\n                    }\n                );\n\n            return this;\r\n        };\n\n        this._xy = function () {\r\n            var o = this.$c.offset();\n            this.x = o.left;\n            this.y = o.top;\n\n            return this;\r\n        };\n\n        this._listen = function () {\r\n            if (!this.o.readOnly) {\r\n                this.$c\n                    .bind(\n                        \"mousedown\",\n                        function (e) {\r\n                            e.preventDefault();\n                            s._xy()._mouse(e);\r\n                        }\n                    )\n                    .bind(\n                        \"touchstart\",\n                        function (e) {\r\n                            e.preventDefault();\n                            s._xy()._touch(e);\r\n                        }\n                    );\n\n                this.listen();\r\n            } else {\r\n                this.$.attr('readonly', 'readonly');\r\n            }\n\n            if (this.relative) {\r\n                $(window).resize(function () {\r\n                    s._carve().init();\n                    s._draw();\r\n                });\r\n            }\n\n            return this;\r\n        };\n\n        this._configure = function () {\n\n            // Hooks\n            if (this.o.draw) this.dH = this.o.draw;\n            if (this.o.change) this.cH = this.o.change;\n            if (this.o.cancel) this.eH = this.o.cancel;\n            if (this.o.release) this.rH = this.o.release;\n\n            if (this.o.displayPrevious) {\r\n                this.pColor = this.h2rgba(this.o.fgColor, \"0.4\");\n                this.fgColor = this.h2rgba(this.o.fgColor, \"0.6\");\r\n            } else {\r\n                this.fgColor = this.o.fgColor;\r\n            }\n\n            return this;\r\n        };\n\n        this._clear = function () {\r\n            this.$c[0].width = this.$c[0].width;\r\n        };\n\n        this._validate = function (v) {\r\n            var val = (~~(((v < 0) ? -0.5 : 0.5) + (v / this.o.step))) * this.o.step;\n            return Math.round(val * 100) / 100;\r\n        };\n\n        // Abstract methods\n        this.listen = function () { }; // on start, one time\n        this.extend = function () { }; // each time configure triggered\n        this.init = function () { }; // each time configure triggered\n        this.change = function (v) { }; // on change\n        this.val = function (v) { }; // on release\n        this.xy2val = function (x, y) { }; //\n        this.draw = function () { }; // on change / on release\n        this.clear = function () { this._clear(); };\n\n        // Utils\n        this.h2rgba = function (h, a) {\r\n            var rgb;\n            h = h.substring(1, 7)\n            rgb = [\n                parseInt(h.substring(0, 2), 16),\n                parseInt(h.substring(2, 4), 16),\n                parseInt(h.substring(4, 6), 16)\n            ];\n\n            return \"rgba(\" + rgb[0] + \",\" + rgb[1] + \",\" + rgb[2] + \",\" + a + \")\";\r\n        };\n\n        this.copy = function (f, t) {\r\n            for (var i in f) {\r\n                t[i] = f[i];\r\n            }\r\n        };\r\n    };\n\n\n    /**\n     * k.Dial\n     */\n    k.Dial = function () {\r\n        k.o.call(this);\n\n        this.startAngle = null;\n        this.xy = null;\n        this.radius = null;\n        this.lineWidth = null;\n        this.cursorExt = null;\n        this.w2 = null;\n        this.PI2 = 2 * Math.PI;\n\n        this.extend = function () {\r\n            this.o = $.extend({\r\n                bgColor: this.$.data('bgcolor') || '#EEEEEE',\n                angleOffset: this.$.data('angleoffset') || 0,\n                angleArc: this.$.data('anglearc') || 360,\n                inline: true\r\n            }, this.o);\r\n        };\n\n        this.val = function (v, triggerRelease) {\r\n            if (null != v) {\n\n                // reverse format\n                v = this.o.parse(v);\n\n                if (triggerRelease !== false\n                    && v != this.v\n                    && this.rH\n                    && this.rH(v) === false) { return; }\n\n                this.cv = this.o.stopper ? max(min(v, this.o.max), this.o.min) : v;\n                this.v = this.cv;\n                this.$.val(this.o.format(this.v));\n                this._draw();\r\n            } else {\r\n                return this.v;\r\n            }\r\n        };\n\n        this.xy2val = function (x, y) {\r\n            var a, ret;\n\n            a = Math.atan2(\n                        x - (this.x + this.w2),\n                        -(y - this.y - this.w2)\n                    ) - this.angleOffset;\n\n            if (this.o.flip) {\r\n                a = this.angleArc - a - this.PI2;\r\n            }\n\n            if (this.angleArc != this.PI2 && (a < 0) && (a > -0.5)) {\n\n                // if isset angleArc option, set to min if .5 under min\n                a = 0;\r\n            } else if (a < 0) {\r\n                a += this.PI2;\r\n            }\n\n            ret = (a * (this.o.max - this.o.min) / this.angleArc) + this.o.min;\n\n            this.o.stopper && (ret = max(min(ret, this.o.max), this.o.min));\n\n            return ret;\r\n        };\n\n        this.listen = function () {\n\n            // bind MouseWheel\n            var s = this, mwTimerStop,\n                mwTimerRelease,\n                mw = function (e) {\r\n                    e.preventDefault();\n\n                    var ori = e.originalEvent,\n                        deltaX = ori.detail || ori.wheelDeltaX,\n                        deltaY = ori.detail || ori.wheelDeltaY,\n                        v = s._validate(s.o.parse(s.$.val()))\n                            + (\n                                deltaX > 0 || deltaY > 0\n                                ? s.o.step\n                                : deltaX < 0 || deltaY < 0 ? -s.o.step : 0\n                              );\n\n                    v = max(min(v, s.o.max), s.o.min);\n\n                    s.val(v, false);\n\n                    if (s.rH) {\n                        // Handle mousewheel stop\n                        clearTimeout(mwTimerStop);\n                        mwTimerStop = setTimeout(function () {\r\n                            s.rH(v);\n                            mwTimerStop = null;\r\n                        }, 100);\n\n                        // Handle mousewheel releases\n                        if (!mwTimerRelease) {\r\n                            mwTimerRelease = setTimeout(function () {\r\n                                if (mwTimerStop)\n                                    s.rH(v);\n                                mwTimerRelease = null;\r\n                            }, 200);\r\n                        }\r\n                    }\r\n                },\n                kval,\n                to,\n                m = 1,\n                kv = {\r\n                    37: -s.o.step,\n                    38: s.o.step,\n                    39: s.o.step,\n                    40: -s.o.step\r\n                };\n\n            this.$\n                .bind(\n                    \"keydown\",\n                    function (e) {\r\n                        var kc = e.keyCode;\n\n                        // numpad support\n                        if (kc >= 96 && kc <= 105) {\r\n                            kc = e.keyCode = kc - 48;\r\n                        }\n\n                        kval = parseInt(String.fromCharCode(kc));\n\n                        if (isNaN(kval)) {\r\n                            (kc !== 13)                     // enter\n                            && kc !== 8                     // bs\n                            && kc !== 9                     // tab\n                            && kc !== 189                   // -\n                            && (kc !== 190\n                                || s.$.val().match(/\\./))   // . allowed once\n                            && e.preventDefault();\n\n                            // arrows\n                            if ($.inArray(kc, [37, 38, 39, 40]) > -1) {\r\n                                e.preventDefault();\n\n                                var v = s.o.parse(s.$.val()) + kv[kc] * m;\n                                s.o.stopper && (v = max(min(v, s.o.max), s.o.min));\n\n                                s.change(s._validate(v));\n                                s._draw();\n\n                                // long time keydown speed-up\n                                to = window.setTimeout(function () {\r\n                                    m *= 2;\r\n                                }, 30);\r\n                            }\r\n                        }\r\n                    }\n                )\n                .bind(\n                    \"keyup\",\n                    function (e) {\r\n                        if (isNaN(kval)) {\r\n                            if (to) {\r\n                                window.clearTimeout(to);\n                                to = null;\n                                m = 1;\n                                s.val(s.$.val());\r\n                            }\r\n                        } else {\n                            // kval postcond\n                            (s.$.val() > s.o.max && s.$.val(s.o.max))\n                            || (s.$.val() < s.o.min && s.$.val(s.o.min));\r\n                        }\r\n                    }\n                );\n\n            this.$c.bind(\"mousewheel DOMMouseScroll\", mw);\n            this.$.bind(\"mousewheel DOMMouseScroll\", mw)\r\n        };\n\n        this.init = function () {\r\n            if (this.v < this.o.min\n                || this.v > this.o.max) { this.v = this.o.min; }\n\n            this.$.val(this.v);\n            this.w2 = this.w / 2;\n            this.cursorExt = this.o.cursor / 100;\n            this.xy = this.w2 * this.scale;\n            this.lineWidth = this.xy * this.o.thickness;\n            this.lineCap = this.o.lineCap;\n            this.radius = this.xy - this.lineWidth / 2;\n\n            this.o.angleOffset\n            && (this.o.angleOffset = isNaN(this.o.angleOffset) ? 0 : this.o.angleOffset);\n\n            this.o.angleArc\n            && (this.o.angleArc = isNaN(this.o.angleArc) ? this.PI2 : this.o.angleArc);\n\n            // deg to rad\n            this.angleOffset = this.o.angleOffset * Math.PI / 180;\n            this.angleArc = this.o.angleArc * Math.PI / 180;\n\n            // compute start and end angles\n            this.startAngle = 1.5 * Math.PI + this.angleOffset;\n            this.endAngle = 1.5 * Math.PI + this.angleOffset + this.angleArc;\n\n            var s = max(\n                String(Math.abs(this.o.max)).length,\n                String(Math.abs(this.o.min)).length,\n                2\n            ) + 2;\n\n            this.o.displayInput\n                && this.i.css({\r\n                    'width': ((this.w / 2 + 4) >> 0) + 'px',\n                    'height': ((this.w / 3) >> 0) + 'px',\n                    'position': 'absolute',\n                    'vertical-align': 'middle',\n                    'margin-top': ((this.w / 3) >> 0) + 'px',\n                    'margin-left': '-' + ((this.w * 3 / 4 + 2) >> 0) + 'px',\n                    'border': 0,\n                    'background': 'none',\n                    'font': this.o.fontWeight + ' ' + ((this.w / s) >> 0) + 'px ' + this.o.font,\n                    'text-align': 'center',\n                    'color': this.o.inputColor || this.o.fgColor,\n                    'padding': '0px',\n                    '-webkit-appearance': 'none'\r\n                }) || this.i.css({\r\n                    'width': '0px',\n                    'visibility': 'hidden'\r\n                });\r\n        };\n\n        this.change = function (v) {\r\n            this.cv = v;\n            this.$.val(this.o.format(v));\r\n        };\n\n        this.angle = function (v) {\r\n            return (v - this.o.min) * this.angleArc / (this.o.max - this.o.min);\r\n        };\n\n        this.arc = function (v) {\r\n            var sa, ea;\n            v = this.angle(v);\n            if (this.o.flip) {\r\n                sa = this.endAngle + 0.00001;\n                ea = sa - v - 0.00001;\r\n            } else {\r\n                sa = this.startAngle - 0.00001;\n                ea = sa + v + 0.00001;\r\n            }\n            this.o.cursor\n                && (sa = ea - this.cursorExt)\n                && (ea = ea + this.cursorExt);\n\n            return {\r\n                s: sa,\n                e: ea,\n                d: this.o.flip && !this.o.cursor\r\n            };\r\n        };\n\n        this.draw = function () {\r\n            var c = this.g,                 // context\n                a = this.arc(this.cv),      // Arc\n                pa,                         // Previous arc\n                r = 1;\n\n            c.lineWidth = this.lineWidth;\n            c.lineCap = this.lineCap;\n\n            if (this.o.bgColor !== \"none\") {\r\n                c.beginPath();\n                c.strokeStyle = this.o.bgColor;\n                c.arc(this.xy, this.xy, this.radius, this.endAngle - 0.00001, this.startAngle + 0.00001, true);\n                c.stroke();\r\n            }\n\n            if (this.o.displayPrevious) {\r\n                pa = this.arc(this.v);\n                c.beginPath();\n                c.strokeStyle = this.pColor;\n                c.arc(this.xy, this.xy, this.radius, pa.s, pa.e, pa.d);\n                c.stroke();\n                r = this.cv == this.v;\r\n            }\n\n            c.beginPath();\n            c.strokeStyle = r ? this.o.fgColor : this.fgColor;\n            c.arc(this.xy, this.xy, this.radius, a.s, a.e, a.d);\n            c.stroke();\r\n        };\n\n        this.cancel = function () {\r\n            this.val(this.v);\r\n        };\r\n    };\n\n    $.fn.dial = $.fn.knob = function (o) {\r\n        return this.each(\n            function () {\r\n                var d = new k.Dial();\n                d.o = o;\n                d.$ = $(this);\n                d.run();\r\n            }\n        ).parent();\r\n    };\r\n})($);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop  plan filters controller\r\n *   Author: Ivn Ricardo Taimal Narvez\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend('bizagi.workportal.widgets.plans.filters', {}, {\r\n\r\n\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        self.params = params;\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.plansLinks = bizagi.injector.get('bizagi.workportal.widgets.decontextualized.plans', params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            'plans.filters.wrapper': bizagi.getTemplate('bizagi.workportal.desktop.widget.decontextualized.plans.filters').concat('#plans-filter-wrapper')\r\n        });\r\n\r\n    },\r\n\r\n\r\n    renderContent: function () {\r\n        var self = this,\r\n            data,\r\n            filteredData = {},\r\n            template;\r\n        template = self.getTemplate('plans.filters.wrapper');\r\n        data = self.getData();\r\n        filteredData.items = data.items;\r\n        self.content = template.render(filteredData);\r\n\r\n        return self.content;\r\n    },\r\n\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.configureHandlers();\r\n    },\r\n\r\n    setSelectedFilter: function(item){\r\n        $(item).addClass(\"wdg-ftr-selected\").siblings().removeClass(\"wdg-ftr-selected\");\r\n    },\r\n\r\n    onLoadPlansView: function(event, params){\r\n        var self = this;\r\n        self.setSelectedFilter($(\".wdg-plan-filter-card[data-data='\" + params.args.planState + \"']\", self.content));\r\n    },\r\n\r\n    configureHandlers: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n        $('.wdg-plan-filter-card', $content).on('click', $.proxy(self.onClickFilter, self));\r\n        self.sub('PLANS-VIEW', $.proxy(self.onLoadPlansView, self));\r\n    },\r\n\r\n    clean: function () {\r\n        var self = this,\r\n            $content = self.getContent();\r\n\r\n        if ($content) {\r\n            $('.wdg-plan-filter-card', $content).off('click');\r\n        }\r\n        self.unsub('PLANS-VIEW', $.proxy(self.onLoadPlansView, self));\r\n    },\r\n\r\n\r\n    getData: function () {\r\n        var self = this;\r\n        return self.plansLinks.getData();\r\n    },\r\n\r\n    onClickFilter: function (ev) {\r\n        var self = this,\r\n            target = $(ev.target).closest('.wdg-plan-filter-card'),\r\n            title = target.data('title'),\r\n            data = target.data('data'),\r\n            icon = data.toLowerCase();\r\n\r\n        self.setSelectedFilter(target);\r\n\r\n        var args = {\r\n            histName: title,\r\n            planState: data,\r\n            level: 1\r\n        };\r\n        self.pub('notify', {\r\n            type: 'PLANS-VIEW',\r\n            args: $.extend(self.params, args)\r\n        });\r\n    }\r\n\r\n\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.plans.filters', ['workportalFacade', 'dataService', bizagi.workportal.widgets.plans.filters]);\r\n","/*\r\n *   Name: Bizagi Workportal Project File Sidebar\r\n *   Author: David Romero Estrada\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activities.sidebar\", {}, {\r\n\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        params = params || {};\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-plan-activities-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activities.sidebar\").concat(\"#project-plan-activities-sidebar\")\r\n        });\r\n\r\n    },\r\n\r\n    /*\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n\r\n        var template = self.getTemplate(\"project-plan-activities-sidebar\");\r\n        self.content = template.render({});\r\n\r\n        return self.content;\r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.plan.activities.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.plan.activities.sidebar], true);","/**\r\n * Name: Bizagi Workportal Desktop Create plan\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.create\", {}, {\r\n   /**\r\n    * Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, notifier, params) {\r\n      var self = this;\r\n      self.params = params;\r\n      self.contextualized;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n      self.notifier = notifier;\r\n\r\n      //Load template\r\n      self.loadTemplates({\r\n         \"plan-create\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.plan.create\").concat(\"#plan-create\")\r\n      });\r\n\r\n      self.dialogBox = {};\r\n   },\r\n\r\n   renderContent: function(){\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.initPlugins();\r\n   },\r\n\r\n   initPlugins: function () {\r\n      var self = this,\r\n         template = self.getTemplate('plan-create');\r\n      self.dialogBox.formContent = template.render({});\r\n      self.dialogBox.elements = {\r\n         inputName: $('#input-name-plan', self.dialogBox.formContent),\r\n         inputTemplate: $('#templates-plan', self.dialogBox.formContent),\r\n         buttonSave: $('#button-accept-create-plan', self.dialogBox.formContent),\r\n         buttonCancel: $('#button-cancel-create-plan', self.dialogBox.formContent)\r\n      };\r\n      self.dialogBox.elements.buttonSave.on('click', $.proxy(self.onClickSavePlan, self));\r\n      self.dialogBox.elements.buttonCancel.on('click', $.proxy(self.closeDialogBox, self));\r\n\r\n      self.notifier = bizagi.injector.get('notifier');\r\n   },\r\n\r\n   closeDialogBox: function () {\r\n      var self = this;\r\n      self.dialogBox.formContent.dialog('destroy');\r\n      self.dialogBox.formContent.detach();\r\n      self.dialogBox.templateGuid = '';\r\n   },\r\n\r\n   showPopupAddPlan: function (params, dataService, contextualized) {\r\n      var self = this;\r\n      self.params = params;\r\n      self.dataService = dataService;\r\n      self.contextualized = contextualized;\r\n      self.content = $(\"<div></div>\");\r\n      self.initPlugins();\r\n\r\n      self.dialogBox.elements.inputTemplate.html('');\r\n      self.dataService.getTemplatesByParentWorkItem({parentWorkItem: params.guidWorkItem}).done(function (data) {\r\n         var comboDataSource = {combo: [], id: 'templates'};\r\n         comboDataSource.combo = data;\r\n         self.dialogBox.elements.inputTemplate.uicombo({\r\n            isEditable: false,\r\n            data: comboDataSource,\r\n            itemValue: function (obj) {\r\n               return obj.id;\r\n            },\r\n            itemText: function (obj) {\r\n               return obj.name;\r\n            },\r\n            onChange: function (obj) {\r\n               var value = obj.ui.data('value');\r\n               self.dialogBox.elements.inputTemplate.val(value);\r\n               self.dialogBox.templateGuid = value;\r\n            },css:'display: none'\r\n         });\r\n\r\n         self.dialogBox.elements.inputTemplate.keydown(function () {\r\n            if (event.keyCode == 8 || event.keyCode == 46) {\r\n               event.preventDefault();\r\n               self.dialogBox.templateGuid = '';\r\n               self.dialogBox.elements.inputTemplate.val('');\r\n               $('input', self.dialogBox.elements.inputTemplate).val('');\r\n            }\r\n         });\r\n\r\n         if(data.length > 0){\r\n             $(\".field-template\", self.dialogBox.formContent).show();\r\n         }\r\n          else{\r\n             $(\".field-template\", self.dialogBox.formContent).hide();\r\n         }\r\n      }).fail(function(){\r\n         $(\".field-template\", self.dialogBox.formContent).hide();\r\n      });\r\n      self.dialogBox.formContent.dialog({\r\n         resizable: false,\r\n         draggable: false,\r\n         height: 'auto',\r\n         width: '600px',\r\n         modal: true,\r\n         title: bizagi.localization.getResource('workportal-project-plan-popup-title-add-plan'),\r\n         maximize: false,\r\n         close: function () {\r\n            self.dialogBox.formContent.dialog('destroy');\r\n            self.dialogBox.formContent.detach();\r\n         }\r\n      });\r\n   },\r\n\r\n   onClickSavePlan: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n      if (self.validateParams()) {\r\n         self.createNewPlan();\r\n      }\r\n\r\n   },\r\n\r\n   createNewPlan: function () {\r\n      var self = this;\r\n      var parentWorkItemRaw = self.params.guidWorkItem || null;\r\n\r\n      var paramsNewPlan = {\r\n         idUserCreator: bizagi.currentUser.idUser,\r\n         id: undefined,\r\n         startDate: null,\r\n         creationDate: null,\r\n         parentWorkItem: parentWorkItemRaw,\r\n         description: null,\r\n         currentState: 'PENDING',\r\n         name: self.dialogBox.elements.inputName.val(),\r\n         waitForCompletion: true,\r\n         dueDate: null,\r\n         contextualized: self.contextualized,\r\n         idTemplate: self.dialogBox.templateGuid\r\n      };\r\n      $.when(self.sendDataInsertPlan(paramsNewPlan)).then(function (response) {\r\n         paramsNewPlan = $.extend(paramsNewPlan, {id: response.id});\r\n         paramsNewPlan.activities = [];\r\n         paramsNewPlan.users = [];\r\n\r\n         //Set security menuDashboard\r\n         var servicesPD = new bizagi.workportal.services.behaviors.projectDashboard(self.dataService);\r\n         self.params.menuPlanDashboard = {};\r\n         self.params.menuPlanDashboard.showCommentsOptionMenu =\r\n             servicesPD.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonComments;\r\n         self.params.menuPlanDashboard.showFilesOptionMenu =\r\n             servicesPD.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonFiles;\r\n         self.params.menuPlanDashboard.showTimeLineOptionMenu =\r\n             servicesPD.getMenuDashboardSecurity(bizagi.menuSecurity).isVisibleButtonTimeLine;\r\n\r\n          //XSS Security\r\n         paramsNewPlan.name = bizagi.util.encodeHtml(paramsNewPlan.name);\r\n\r\n          $.when(servicesPD.getRadNumberForPlanDashboard(paramsNewPlan.id, paramsNewPlan.contextualized)).done(function (responseRadNumber) {\r\n              self.pub('planCreated', { paramsNewPlan: paramsNewPlan, radNumber: responseRadNumber});\r\n              self.closeDialogBox();\r\n              self.notifier.showSucessMessage(\r\n                  printf(bizagi.localization.getResource('workportal-project-plan-created'), ''));\r\n          });\r\n      });\r\n   },\r\n\r\n   validateParams: function () {\r\n      var self = this;\r\n      var name = self.dialogBox.elements.inputName;\r\n      if (name.val() && name.val() !== '') {\r\n         return true;\r\n      } else {\r\n         var nameValidation = bizagi.localization.getResource('workportal-project-plan-popup-field-name-required');\r\n         name.next().find('span').html(nameValidation);\r\n         return false;\r\n      }\r\n   },\r\n\r\n   sendDataInsertPlan: function (params) {\r\n      var self = this;\r\n      var defer = $.Deferred();\r\n      $.when(self.dataService.postPlan(params)).always(function (response, responseText, xhr) {\r\n         if (xhr.status === 201) {\r\n            defer.resolve(response);\r\n         }\r\n         else {\r\n            defer.reject();\r\n         }\r\n      });\r\n      return defer.promise();\r\n   }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.plan.create', ['workportalFacade', 'dataService', 'notifier', bizagi.workportal.widgets.project.plan.create]);\r\n","/**\r\n * Name: Bizagi Workportal Desktop Edit plan\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.edit\", {}, {\r\n    /**\r\n     * Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, notifier, params) {\r\n        var self = this;\r\n        self.params = params;\r\n        self.planToEdit;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n        self.notifier = notifier;\r\n\r\n        //Load template\r\n        self.loadTemplates({\r\n            'plans.manager.popup.edit.plan': bizagi.getTemplate('bizagi.workportal.desktop.widgets.project.plan.edit').concat('#plans-manager-popup-edit-plan')\r\n        });\r\n\r\n        self.editDialogBox = {};\r\n    },\r\n\r\n    renderContent: function(){\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n    },\r\n\r\n    closeEditDialogBox: function () {\r\n        var self = this;\r\n        self.editDialogBox.elements.inputDueDate.datepicker(\"destroy\");\r\n        self.editDialogBox.formContent.dialog('destroy');\r\n        self.editDialogBox.formContent.detach();\r\n    },\r\n\r\n    showPopup: function (params, dataService, planToEdit) {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        self.planToEdit = planToEdit;\r\n        self.initEditDialogBox(planToEdit);\r\n        self.editDialogBox.elements.inputName.val(bizagi.util.decodeHtmlEntities(planToEdit.name));\r\n        self.editDialogBox.elements.inputDesc.val(bizagi.util.decodeHtmlEntities(planToEdit.description));\r\n        self.editDialogBox.elements.inputWaitForCompletion.prop( \"checked\", planToEdit.waitForCompletion);\r\n        self.editDialogBox.elements.inputDueDate.datepicker();\r\n        self.editDialogBox.elements.inputDueDate.datepicker(\"option\", \"dateFormat\", bizagi.util.dateFormatter.getDateFormatByDatePickerJqueryUI());\r\n        if(planToEdit.dueDate){\r\n            self.editDialogBox.elements.inputDueDate.datepicker('setDate', new Date(planToEdit.dueDate));\r\n        }\r\n        self.editDialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: 'auto',\r\n            width: '600px',\r\n            modal: true,\r\n            title: bizagi.localization.getResource('workportal-project-plan-editplan'),\r\n            maximize: true,\r\n            close: function (ev, ui) {\r\n                self.editDialogBox.elements.inputDueDate.datepicker(\"destroy\");\r\n                self.editDialogBox.formContent.dialog('destroy');\r\n                self.editDialogBox.formContent.detach();\r\n                defer.resolve();\r\n            }\r\n        });\r\n        return defer.promise();\r\n    },\r\n\r\n    initEditDialogBox: function (plan) {\r\n        var self = this,\r\n            editPlanTemplate = self.getTemplate('plans.manager.popup.edit.plan');\r\n        self.editDialogBox.formContent = editPlanTemplate.render(plan);\r\n        self.editDialogBox.elements = {\r\n            inputName: $('#input-name-plan', self.editDialogBox.formContent),\r\n            inputDesc: $('#input-desc-plan', self.editDialogBox.formContent),\r\n            inputDueDate: $('#input-dueDate-plan', self.editDialogBox.formContent),\r\n            inputWaitForCompletion: $('#input-waitForCompletion', self.editDialogBox.formContent),\r\n            buttonSave: $('#button-accept-edit-plan', self.editDialogBox.formContent),\r\n            buttonCancel: $('#button-cancel-edit-plan', self.editDialogBox.formContent)\r\n        };\r\n        self.editDialogBox.elements.buttonSave.on('click', $.proxy(self.saveEditedPlan, self));\r\n        self.editDialogBox.elements.buttonCancel.on('click', $.proxy(self.closeEditDialogBox, self));\r\n    },\r\n\r\n\r\n    saveEditedPlan: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n        if (self.validateEditDialogBoxParams()) {\r\n            $.when(self.getParamsUpdatePlan()).done(function(updateParams){\r\n                $.when(self.dataService.updatePlan(updateParams)).done(function () {\r\n                    self.closeEditDialogBox();\r\n                    self.pub('planEditedSuccess', {\r\n                        paramsEditPlan: updateParams\r\n                    });\r\n\r\n                }).fail(function () {\r\n                    self.pub('planEditedFailed');\r\n                });\r\n            });\r\n        }\r\n    },\r\n\r\n    getParamsUpdatePlan: function(){\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        var updateParams = {};\r\n        updateParams = self.planToEdit;\r\n\r\n        updateParams.name = self.editDialogBox.elements.inputName.val();\r\n        updateParams.description = self.editDialogBox.elements.inputDesc.val();\r\n        if(self.editDialogBox.elements.inputWaitForCompletion.length !== 0){\r\n            updateParams.waitForCompletion = self.editDialogBox.elements.inputWaitForCompletion.prop(\"checked\");\r\n        }\r\n\r\n        var dueDateRaw = self.editDialogBox.elements.inputDueDate.datepicker('getDate');\r\n        if(dueDateRaw){\r\n            var params = {\r\n                idUser: bizagi.currentUser.idUser,\r\n                date: dueDateRaw.getTime()\r\n            };\r\n            $.when(self.dataService.getEndHourWorkingByDate(params)).done(function (data) {\r\n                updateParams.dueDate = data.dateTime;\r\n                defer.resolve(updateParams);\r\n            });\r\n        }\r\n        else{\r\n            defer.resolve(updateParams);\r\n        }\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n\r\n    validateEditDialogBoxParams: function () {\r\n        var self = this;\r\n        var name = self.editDialogBox.elements.inputName;\r\n        if (name.val() && name.val() !== '') {\r\n            return true;\r\n        } else {\r\n            var nameValidation = bizagi.localization.getResource('workportal-project-plan-popup-field-name-required');\r\n            name.next().find('span').html(nameValidation);\r\n            return false;\r\n        }\r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.plan.edit', ['workportalFacade', 'dataService', 'notifier', bizagi.workportal.widgets.project.plan.edit], true);","/**\r\n * Name: Bizagi Workportal Desktop Create plan template\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.template.create\", {}, {\r\n    /**\r\n     * Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        self.params = params;\r\n        self.contextualized;\r\n        self.idPlanSelected;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load template\r\n        self.loadTemplates({\r\n            \"plan-template-create\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.plan.template.create\").concat(\"#plan-template-create\")\r\n        });\r\n\r\n        self.dialogBox = {};\r\n    },\r\n\r\n    renderContent: function(){\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.initPlugins();\r\n    },\r\n\r\n    initPlugins: function () {\r\n        var self = this,\r\n            template = self.getTemplate('plan-template-create');\r\n        self.dialogBox.formContent = template.render({});\r\n        self.dialogBox.elements = {\r\n            inputName: $('#input-name-template', self.dialogBox.formContent),\r\n            buttonSave: $('#button-accept-create-template', self.dialogBox.formContent),\r\n            buttonCancel: $('#button-cancel-create-template', self.dialogBox.formContent)\r\n        };\r\n        self.dialogBox.elements.buttonSave.on('click', $.proxy(self.onClickSaveTemplate, self));\r\n        self.dialogBox.elements.buttonCancel.on('click', $.proxy(self.closeDialogBox, self));\r\n    },\r\n\r\n    closeDialogBox: function () {\r\n        var self = this;\r\n        self.dialogBox.formContent.dialog('destroy');\r\n        self.dialogBox.formContent.detach();\r\n    },\r\n\r\n    showPopupAddTemplatePlan: function (params, dataService, contextualized, idPlanSelected) {\r\n        var self = this;\r\n        self.params = params;\r\n        self.dataService = dataService;\r\n        self.contextualized = contextualized;\r\n        self.idPlanSelected = idPlanSelected;\r\n        self.content = $(\"<div></div>\");\r\n        self.initPlugins();\r\n\r\n        self.dialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: 'auto',\r\n            width: '600px',\r\n            modal: true,\r\n            title: bizagi.localization.getResource('workportal-project-plan-action-popup-save-as-template'),\r\n            maximize: false,\r\n            close: function (ev, ui) {\r\n                self.dialogBox.formContent.dialog('destroy');\r\n                self.dialogBox.formContent.detach();\r\n            }\r\n        });\r\n    },\r\n\r\n    onClickSaveTemplate: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n\r\n        if (self.validateSaveDialogBoxParams()) {\r\n            var params = {\r\n                idPlan: self.idPlanSelected,\r\n                name: self.dialogBox.elements.inputName.val()\r\n            };\r\n            $.when(self.dataService.createTemplateByPlan(params)).done(function () {\r\n                self.closeDialogBox();\r\n                self.pub('planTemplateCreatedSuccess', {});\r\n            }).fail(function () {\r\n                self.pub('planTemplateCreatedFailed', {});\r\n            });\r\n        }\r\n\r\n    },\r\n\r\n    validateSaveDialogBoxParams: function () {\r\n        var self = this;\r\n        var name = self.dialogBox.elements.inputName;\r\n        if (name.val() && name.val() !== '') {\r\n            return true;\r\n        } else {\r\n            var nameValidation = bizagi.localization.getResource('workportal-project-plan-popup-field-name-required');\r\n            name.next().find('span').html(nameValidation);\r\n            return false;\r\n        }\r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.plan.template.create', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.plan.template.create]);","/**\r\n* Name: BizAgi Desktop Widget Reassing Case\r\n* @author NAN\r\n*/\r\n\r\n\r\nbizagi.workportal.widgets.admin.caseSearch.extend(\"bizagi.workportal.widgets.reassigncase\", {}, {\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"admin.case.search\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.admin.caseSearch\").concat(\"#ui-bizagi-workportal-widget-admin-case-search\"),\r\n            \"admin.case.search.fields\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.admin.caseSearch\").concat(\"#ui-bizagi-workportal-widget-admin-case-search-fields\"),\r\n            \"admin.case.search.button\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.admin.caseSearch\").concat(\"#ui-bizagi-workportal-widget-admin-case-search-buttons\"),\r\n            \"admin.case.search.result\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.admin.caseSearch\").concat(\"#ui-bizagi-workportal-widget-admin-case-search-result\"),\r\n            \"admin.case.search.pagination\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.admin.caseSearch\").concat(\"#ui-bizagi-workportal-widget-admin-case-search-pagination\"),\r\n            \"admin.case.search.invalidate\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.admin.caseSearch\").concat(\"#ui-bizagi-workportal-widget-admin-case-search-invalidate\"),\r\n            \"admin.case.search.reassign\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.admin.caseSearch\").concat(\"#ui-bizagi-workportal-widget-admin-case-search-reassign\"),\r\n            \"admin.case.search.reassign.form\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.admin.caseSearch\").concat(\"#ui-bizagi-workportal-widget-admin-case-search-reassign-form\"),\r\n            \"admin.case.search.action.result\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.admin.caseSearch\").concat(\"#ui-bizagi-workportal-widget-admin-case-search-action-result\"),\r\n            useNewEngine: false\r\n        });\r\n    },\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE;\r\n    },\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"admin.case.search\");\r\n        var content;\r\n\r\n        content = self.content = $.tmpl(template, {});\r\n        self.loadtemplates();\r\n        return content;\r\n    },\r\n\r\n\r\n    loadtemplates: function () {\r\n        var self = this;\r\n\r\n        //Template vars \r\n        self.generalContentTmpl = self.getTemplate(\"admin.case.search\");\r\n        self.fieldsContentTmpl = self.getTemplate(\"admin.case.search.fields\");\r\n        self.buttonContentTmpl = self.getTemplate(\"admin.case.search.button\");\r\n        self.resultContentTmpl = self.getTemplate(\"admin.case.search.result\");\r\n        self.paginationTmpl = self.getTemplate(\"admin.case.search.pagination\");\r\n        self.invalidateContentTmpl = self.getTemplate(\"admin.case.search.invalidate\");\r\n        self.reassignContentTmpl = self.getTemplate(\"admin.case.search.reassign\");\r\n        self.reassignFormTmpl = self.getTemplate(\"admin.case.search.reassign.form\");\r\n        self.actionResultContentTmpl = self.getTemplate(\"admin.case.search.action.result\");\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.maxElemShow = 10;\r\n        self.maxPageToShow = 5;\r\n\r\n        //load form data\r\n        self.processNavigation = [];\r\n        self.setupData();\r\n    },\r\n\r\n    /*\r\n    * Setup form data\r\n    */\r\n    setupData: function () {\r\n        var self = this;\r\n\r\n\r\n        var selectedTasks = {\r\n            cases: []\r\n        };\r\n        var selectedTasksToShow = [];\r\n\r\n        self.setupInitialData();\r\n        self.setupDatePicker();\r\n        self.setupProcessTree();\r\n        self.setupMainButtons();\r\n\r\n        selectedTasks.cases.push({\r\n            idCase: self.params.data.idCase,\r\n            idWorkItem: self.params.data.idWorkItem\r\n        });\r\n        selectedTasksToShow.push({\r\n            taskItem: self.params.data.idCase + \": \" + self.params.data.idtask,\r\n            idWorkItem: self.params.data.idWorkItem\r\n        });\r\n\r\n        self.selectedTasks = selectedTasks;\r\n        self.selectedTasksToShow = selectedTasksToShow;\r\n        self.showReassignForm(self.content, self.selectedTasksToShow);\r\n    },\r\n\r\n    /*\r\n    * Load form data\r\n    */\r\n    setupInitialData: function () {\r\n        var self = this,\r\n            content = self.getContent(),\r\n            fields;\r\n\r\n        //set self variables to default\r\n        self.buttonBackAction = \"backToMainForm\";\r\n        self.selectedUserId = \"\";\r\n        self.selectedUserName = \"\";\r\n        self.selectedTasks = \"\";\r\n        self.selectedTasksToShow = \"\";\r\n        self.searchParams = \"\";\r\n        self.processTree = \"\";\r\n\r\n\r\n        //set content form to default\r\n        $(\"#generalTitle\").html(bizagi.localization.getResource(\"workportal-widget-admincasesearch-subtitle\"));\r\n        $(\"#mainForm\", content).remove();\r\n        $(\"#dinamicContent\", content).remove();\r\n        $(\"#case-search-log-data-buttonset\", content).remove();\r\n\r\n        //append fields to wrapper\r\n        fields = $.tmpl(self.reassignFormTmpl, {});\r\n        content.append(fields);\r\n    },\r\n\r\n    /*\r\n    * Load dateTime plugin and apply to respective fields\r\n    */\r\n    setupDatePicker: function () {\r\n        var self = this,\r\n            content = self.getContent();\r\n\r\n        $(\".biz-wp-form-datepicker\", content).datepicker({\r\n            controlType: 'select',\r\n            dateFormat: 'dd/mm/yy'\r\n        });\r\n    },\r\n\r\n    /*\r\n    * initialize the process tree widget\r\n    */\r\n    setupProcessTree: function () {\r\n        var self = this,\r\n            content = self.getContent();\r\n\r\n        bizagi.treeRoutSelected = [];\r\n        $(\"#treeLinksId\").remove();\r\n\r\n        self.processTree = new bizagi.workportal.widgets.processtree(self.workportalFacade, self.dataService, $.extend(self.params, {\r\n            canvas: $(\"#processTree\", content)\r\n        }));\r\n\r\n        self.processTree.render();\r\n    },\r\n\r\n    /*\r\n    * initialize the users search form widget\r\n    */\r\n    setupUsersSearchForm: function () {\r\n        var self = this,\r\n            content = self.getContent(),\r\n            def = $.Deferred();\r\n\r\n        $(\"#biz-wp-users-table-form\").html(\"\");\r\n\r\n        self.usersTable = new bizagi.workportal.widgets.userstable(self.workportalFacade, self.dataService, $.extend(self.params, {\r\n            canvas: $(\"#biz-wp-users-table-form\", content),\r\n            userLinkLabel: [bizagi.localization.getResource(\"workportal-widget-admincasesearch-reassign\")],\r\n            parentDef: def\r\n        }));\r\n\r\n        self.usersTable.render();\r\n\r\n        $.when(def).done(function (userId, userName) {\r\n            self.assignEventReassignLinks(userId, userName);\r\n        });\r\n    },\r\n\r\n    /*\r\n    * Find cases results using the input data\r\n    */\r\n    findResults: function (content, params, pageToShow) {\r\n        var self = this;\r\n\r\n        //If there is not a page to Show, begins whith the fist one\r\n        pageToShow ? params.Page = pageToShow : params.Page = 1;\r\n\r\n        $.when(\r\n            self.dataService.getAdminCasesList(params)\r\n        ).done(function (resultList) {\r\n\r\n            //clean old results\r\n            $(\".biz-wp-table\").remove();\r\n            $(\".case-search-action-wrapper\").remove();\r\n            $(\"#biz-wp-table-summary-wrapper\").remove();\r\n\r\n            //Keep in track the total Records\r\n            self.totalRecords = resultList.records;\r\n            //keep in track the total pages\r\n            self.totalPages = resultList.total;\r\n\r\n            if (resultList.rows.length > 0) {\r\n\r\n                self.showCasesSearchResultFrame(content, resultList);\r\n                self.setupActionsButton(content);\r\n\r\n                var pageToshow = (self.maxPageToShow > self.totalPages) ? self.totalPages : self.maxPageToShow;\r\n                var summaryWrapper = $(\"#biz-wp-table-pager-wrapper\"),\r\n                    pagerData = {},\r\n                    paginationHtml;\r\n\r\n                // show or hide \"load more\" button\r\n                pagerData.pagination = (self.totalPages > 1) ? true : false;\r\n                pagerData.page = resultList.page;\r\n                pagerData.pages = {};\r\n\r\n                for (var i = 1; i <= pageToshow; i++) {\r\n                    pagerData[\"pages\"][i] = {\r\n                        \"pageNumber\": i\r\n                    };\r\n                }\r\n\r\n                //load and append the paginator to the result table\r\n                paginationHtml = $.tmpl(self.paginationTmpl, pagerData).html();\r\n                summaryWrapper.append(paginationHtml);\r\n\r\n                //add data and behaviour to pager\r\n                $(\"ul\").bizagiPagination({\r\n                    maxElemShow: self.maxElemShow,\r\n                    totalPages: self.totalPages,\r\n                    actualPage: resultList.page,\r\n                    listElement: $(\"#biz-wp-table-pager-wrapper\"),\r\n                    clickCallBack: function (options) {\r\n                        self.findResults(content, params, options.page);\r\n                    }\r\n                });\r\n            } else {\r\n                bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-authentication-log-none\"), \"Bizagi\", \"warning\");\r\n            }\r\n\r\n\r\n        }).fail(function (error) {\r\n            bizagi.log(error);\r\n        });\r\n    },\r\n\r\n    /*\r\n    * Show cases search result frames\r\n    */\r\n    showCasesSearchResultFrame: function (content, resultList) {\r\n        var self = this;\r\n\r\n        var processedItems = self.preprocessResultList(resultList.headers, resultList);\r\n        var resultTemplate = $.tmpl(self.resultContentTmpl, {\r\n            headers: resultList.headers,\r\n            rows: processedItems\r\n        });\r\n\r\n        var invalidateForm = $.tmpl(self.invalidateContentTmpl, {}),\r\n            reassignForm = $.tmpl(self.reassignContentTmpl, {});\r\n\r\n        $(\"#mainForm\", content).hide();\r\n        $(\"#dinamicContent\", content).html(resultTemplate);\r\n        $(\".case-search-action-wrapper\", content).append(invalidateForm);\r\n        $(\".case-search-action-wrapper\", content).append(reassignForm);\r\n\r\n        $(\"#generalTitle\").html(bizagi.localization.getResource(\"workportal-widget-admincasesearch-table-title\"));\r\n        $(\"#btn-admin-case-search-clear\", content).hide();\r\n        $(\"#btn-admin-case-search\", content).hide();\r\n        $(\"#btn-admin-case-back\", content).css(\"display\", \"inline\");\r\n\r\n        self.setupActivitiesLink(content);\r\n        self.setupGraphicQueryEvent(content);\r\n    },\r\n\r\n    /*\r\n    *\r\n    */\r\n    preprocessResultList: function (headers, resultList) {\r\n        var self = this;\r\n\r\n        var processedItems = [],\r\n            length = resultList.rows.length,\r\n            i = 0;\r\n\r\n        for (; i < length; i++) {\r\n            processedItems.push(self.processResultItem(headers, resultList.rows[i]));\r\n        }\r\n\r\n        return processedItems;\r\n    },\r\n\r\n    /*\r\n    * Process each result item\r\n    */\r\n    processResultItem: function (headers, rowItem) {\r\n        var self = this;\r\n\r\n        var rowItemData = rowItem.data,\r\n            idCase = rowItem.idCase,\r\n            idWorkflow = rowItem.idWorkFlow;\r\n\r\n        var resultArray = [],\r\n            firstRowItem = [];\r\n\r\n        //Handle the task elements\r\n        var taskElements,\r\n            taskElementsLength;\r\n\r\n        var currentTaskObj;\r\n\r\n        var taskColumnIndex = [],\r\n            taskColumnIndexLength;\r\n\r\n        var j = -1,\r\n            columnIndex = 0;\r\n\r\n        var resultTaskArray = false;\r\n\r\n\r\n        firstRowItem.push({\r\n            id: \"checkCaseAdmin\",\r\n            value: idCase\r\n        });\r\n\r\n        while (j++ < headers.length - 1) {\r\n\r\n            switch (headers[j].fieldName) {\r\n                case self.columnsID.caseNumber:\r\n                    //Insert case number\r\n                    firstRowItem.push({\r\n                        id: \"caseNumber\",\r\n                        value: {\r\n                            'idCase': idCase,\r\n                            'caseNumber': rowItemData[columnIndex]\r\n                        }\r\n                    });\r\n\r\n                    columnIndex++;\r\n                    break;\r\n\r\n                case self.columnsID.process:\r\n                    //Insert process name\r\n                    firstRowItem.push({\r\n                        id: \"idWorkItem\",\r\n                        value: rowItemData[columnIndex]\r\n                    });\r\n\r\n                    columnIndex++;\r\n                    break;\r\n\r\n                case self.columnsID.userName:\r\n                case self.columnsID.task:\r\n                case self.columnsID.taskDueDate:\r\n\r\n                    //Gets the row elements if is not already assigned to taskElements array\r\n                    if (taskElements === undefined) {\r\n                        var k = rowItemData.length;\r\n                        while (k-- > 0) {\r\n                            if (Array.isArray(rowItemData[k])) {\r\n                                taskElements = rowItemData[k];\r\n\r\n                                //Notifies the existence of the array of task elements\r\n                                resultTaskArray = true;\r\n                                break;\r\n                            }\r\n                        }\r\n                        columnIndex++;\r\n                    }\r\n\r\n                    //set the current task obj\r\n                    if (resultTaskArray) {\r\n\r\n                        //Removes the unecessary due date\r\n                        if (headers[j].fieldName == self.columnsID.taskDueDate) {\r\n                            rowItemData.splice(j, 1);\r\n                        }\r\n\r\n                        currentTaskObj = taskElements[0];\r\n\r\n                        if (self.columnsID.userName == headers[j].fieldName) {\r\n                            firstRowItem = firstRowItem.concat(self.processTaskObjectUser(currentTaskObj));\r\n\r\n                            if (taskColumnIndex.indexOf(self.columnsID.userName) == -1)\r\n                                taskColumnIndex.push(self.columnsID.userName);\r\n                        } else\r\n                            if (self.columnsID.task == headers[j].fieldName) {\r\n                                firstRowItem = firstRowItem.concat(self.processTaskObject(currentTaskObj, idCase));\r\n\r\n                                if (taskColumnIndex.indexOf(self.columnsID.task) == -1)\r\n                                    taskColumnIndex.push(self.columnsID.task);\r\n                            } else\r\n                                if (self.columnsID.taskDueDate == headers[j].fieldName) {\r\n                                    firstRowItem = firstRowItem.concat(self.processTaskObjectDate(currentTaskObj));\r\n\r\n                                    if (taskColumnIndex.indexOf(self.columnsID.taskDueDate) == -1)\r\n                                        taskColumnIndex.push(self.columnsID.taskDueDate);\r\n                                }\r\n                        //TODO : userLocation logic in case its come inside the task array\r\n                    } else {\r\n                        if (headers[j].fieldName == self.columnsID.taskDueDate) {\r\n                            //inserts the estimated Solution date in a object\r\n                            firstRowItem = firstRowItem.concat({\r\n                                'estimatedSolutionDate': rowItemData[j]\r\n                            });\r\n\r\n                            if (taskColumnIndex.indexOf(self.columnsID.taskDueDate) == -1)\r\n                                taskColumnIndex.push(self.columnsID.taskDueDate);\r\n                        }\r\n                    }\r\n\r\n                    break;\r\n                //TODO : create case logic for single element, or create the required logic whe userLocation comes in the task list array               \r\n                /*\r\n                case self.columnsID.userLocation:\r\n                break;\r\n                /**/ \r\n\r\n\r\n                case self.columnsID.processCreationDate:\r\n                    //Creation Date\r\n                    firstRowItem.push({\r\n                        id: \"processCreationDate\",\r\n                        value: rowItemData[columnIndex]\r\n                    });\r\n\r\n                    columnIndex++;\r\n                    break;\r\n\r\n                case self.columnsID.processDueDate:\r\n                    //Task Due Date\r\n                    firstRowItem.push({\r\n                        id: \"processDueDate\",\r\n                        value: rowItemData[columnIndex]\r\n                    });\r\n\r\n                    columnIndex++;\r\n                    break;\r\n\r\n                default:\r\n                    firstRowItem.push({\r\n                        id: \"customField\",\r\n                        value: rowItemData[columnIndex]\r\n                    });\r\n\r\n                    columnIndex++;\r\n                    break;\r\n            }\r\n        }\r\n\r\n        //Inserts view Process Column\r\n        firstRowItem.push({\r\n            id: \"viewProcess\",\r\n            value: {\r\n                'idCase': idCase,\r\n                'idworkflow': idWorkflow\r\n            }\r\n        });\r\n\r\n        //Insert the first row element\r\n        resultArray.push({\r\n            attr: \"first_row\",\r\n            data: firstRowItem\r\n        });\r\n\r\n        taskElementsLength = taskElements ? taskElements.length : 0;\r\n\r\n        //If there is more task, add the remaining rows\r\n        if (taskElementsLength > 1) {\r\n            taskColumnIndexLength = taskColumnIndex.length;\r\n            for (var i = 1; i < taskElementsLength; i++) {\r\n\r\n                var taskData = [],\r\n                    k = -1;\r\n                //Adds the elements in the right order as the columns are\r\n\r\n                while (k++ < taskColumnIndexLength - 1) {\r\n                    if (taskColumnIndex[k] == self.columnsID.task)\r\n                        taskData.push(self.processTaskObject(taskElements[i], idCase));\r\n                    else\r\n                        if (taskColumnIndex[k] == self.columnsID.taskDueDate)\r\n                            taskData.push(self.processTaskObjectDate(taskElements[i]));\r\n                        else\r\n                            if (taskColumnIndex[k] == self.columnsID.userName)\r\n                                taskData.push(self.processTaskObjectUser(taskElements[i]));\r\n                }\r\n\r\n                resultArray.push({\r\n                    attr: \"next_row\",\r\n                    data: taskData\r\n                });\r\n            }\r\n        }\r\n\r\n        return {\r\n            data: resultArray,\r\n            totalTask: taskElementsLength\r\n        };\r\n    },\r\n\r\n    /*\r\n    *   Process each task object\r\n    */\r\n    processTaskObject: function (taskObject, idCase) {\r\n        var obj = {\r\n            'taskName': taskObject.taskName,\r\n            'colorState': taskObject.colorState,\r\n            'idCase': idCase,\r\n            'idWorkItem': taskObject.idWorkItem,\r\n            'idTask': taskObject.idTask\r\n        };\r\n        return obj;\r\n    },\r\n\r\n    /*\r\n    * Process task object detecting if is has or not estimated solution date\r\n    */\r\n    processTaskObjectDate: function (taskObject) {\r\n        var obj = {};\r\n        (taskObject.estimatedSolutionDate) ? obj.estimatedSolutionDate = taskObject.estimatedSolutionDate : obj.estimatedSolutionDate = \"\";\r\n\r\n        return obj;\r\n    },\r\n\r\n    /*\r\n    * Process task object detecting if is has or not estimated solution date\r\n    */\r\n    processTaskObjectUser: function (taskObject) {\r\n        var obj = {};\r\n        (taskObject.assignee) ? obj.userName = taskObject.assignee : obj.userName = \"\";\r\n\r\n        return obj;\r\n    },\r\n\r\n    /*\r\n    * Invalidate selected cases\r\n    */\r\n    invalidateCases: function (content) {\r\n        var self = this;\r\n        var selectedCases = {\r\n            cases: []\r\n        };\r\n\r\n        $(\"input:checkbox[name=CaseAdmin]:checked\", content).each(function () {\r\n            var val = $(this).val();\r\n            selectedCases.cases.push({\r\n                idCase: val\r\n            });\r\n        });\r\n\r\n        if (selectedCases.cases.length == 0) {\r\n            bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-admincasesearch-invalidate-empty-msg\"), \"Bizagi\", \"warning\");\r\n        } else {\r\n            $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-widget-admincasesearch-invalidate-confirm-msg\"), \"Bizagi\", \"warning\"))\r\n                .done(function () {\r\n                    var reason = $(\"#txtReason\", content).val();\r\n                    var params = {\r\n                        action: \"abort\",\r\n                        cases: JSON.stringify(selectedCases),\r\n                        reason: reason\r\n                    };\r\n\r\n                    $.when(self.dataService.abortReassignItems(params)).done(function (abortResult) {\r\n                        self.showActionResultFrame(content, abortResult.response, \"invalidate\");\r\n                    }).fail(function (error) {\r\n                        bizagi.log(error);\r\n                    });\r\n                });\r\n        }\r\n    },\r\n\r\n    /*\r\n    * Reassign selected tasks\r\n    */\r\n    showReassignTasksFrame: function (content) {\r\n        var self = this;\r\n        var selectedTasks = {\r\n            cases: []\r\n        };\r\n        var selectedTasksToShow = [];\r\n\r\n        $(\"input:checkbox[name=workItemAdmin]:checked\", content).each(function () {\r\n            var tasks = $(this).val();\r\n            tasks = tasks.split(\"|\");\r\n            selectedTasks.cases.push({\r\n                idCase: tasks[0],\r\n                idWorkItem: tasks[1]\r\n            });\r\n            selectedTasksToShow.push({\r\n                taskItem: tasks[0] + \": \" + tasks[2],\r\n                idWorkItem: tasks[1]\r\n            });\r\n        });\r\n\r\n        if (selectedTasksToShow.length == 0) {\r\n            bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-admincasesearch-reassign-empty-msg\"), \"Bizagi\", \"warning\");\r\n        } else {\r\n            self.selectedTasks = selectedTasks;\r\n            self.selectedTasksToShow = selectedTasksToShow;\r\n            self.showReassignForm(content, selectedTasksToShow);\r\n        }\r\n    },\r\n\r\n    /*\r\n    * Show Reassign frame\r\n    */\r\n    showReassignForm: function (content, selectedTasksToShow) {\r\n        var self = this;\r\n        self.buttonBackAction = \"backToCases\";\r\n        var resultTemplate = $.tmpl(self.reassignFormTmpl, {\r\n            tasks: selectedTasksToShow\r\n        });\r\n\r\n        $(\"#dinamicContent\", content).hide();\r\n        $(\"#dinamicContent2\", content).html(resultTemplate);\r\n        $(\"#btn-admin-case-search-clear\", content).hide();\r\n        $(\"#btn-admin-case-search\", content).hide();\r\n        $(\"#generalTitle\").html(bizagi.localization.getResource(\"workportal-widget-admincasesearch-reassign-title\"));\r\n        self.setupUsersSearchForm();\r\n\r\n    },\r\n\r\n    /*\r\n    * Reassign one or more taskt to other user\r\n    */\r\n    reassignTasks: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        var params = {\r\n            action: \"reassignItems\",\r\n            cases: JSON.stringify(self.selectedTasks),\r\n            idNewUser: self.selectedUserId\r\n        };\r\n\r\n        $.when(self.dataService.reassignCurrent(params)).done(function (reassignResult) {\r\n            self.showActionResultFrame(content, reassignResult.response, \"reassign\");\r\n        }).fail(function (error) {\r\n            bizagi.log(error);\r\n        });\r\n    },\r\n\r\n    /*\r\n    * Show Invalidate / Reassign Result frame\r\n    */\r\n    showActionResultFrame: function (content, result, type) {\r\n        var self = this;\r\n        var action = result.length > 1 ? \"-several\" : \"\";\r\n        var items = \"\";\r\n        var itemsFailed = \"\";\r\n        var resultStatus = [];\r\n        action = type + action;\r\n\r\n        if (action == \"invalidate\") {\r\n            for (var i = 0; i < result.length; i++) {\r\n                if (result[i].deleted == true) {\r\n                    items = result[i].idCase;\r\n                    items += (i + 1) < result.length ? \", \" : \"\";\r\n                    resultStatus[0] = true;\r\n                } else {\r\n                    itemsFailed = result[i].idCase;\r\n                    itemsFailed += (i + 1) < result.length ? \", \" : \"\";\r\n                    resultStatus[1] = false;\r\n                }\r\n            }\r\n        } else if (action == \"invalidate-several\") {\r\n            for (var i = 0; i < result.length; i++) {\r\n                if (result[i].deleted == true) {\r\n                    items += result[i].idCase;\r\n                    items += (i + 1) < result.length ? \", \" : \"\";\r\n                    resultStatus[0] = true;\r\n                } else {\r\n                    itemsFailed += result[i].idCase;\r\n                    itemsFailed += (i + 1) < result.length ? \", \" : \"\";\r\n                    resultStatus[1] = false;\r\n                }\r\n            }\r\n        } else if (action == \"reassign\") {\r\n            for (var i = 0; i < result.length; i++) {\r\n                if (result[i].reassigned == true) {\r\n                    items += result[i].idCase;\r\n                    items += (i + 1) < result.length ? \", \" : \"\";\r\n                    resultStatus[0] = true;\r\n                } else {\r\n                    itemsFailed = result[i].idCase;\r\n                    itemsFailed += (i + 1) < result.length ? \", \" : \"\";\r\n                    resultStatus[1] = false;\r\n                }\r\n            }\r\n        } else if (action == \"reassign-several\") {\r\n            items += \"<br/><br/>\";\r\n            itemsFailed += \"<br/><br/>\";\r\n            for (var i = 0; i < result.length; i++) {\r\n                if (result[i].reassigned == true) {\r\n                    items += result[i].idCase + \"<br/>\";\r\n                    resultStatus[0] = true;\r\n                } else {\r\n                    itemsFailed += result[i].idCase + \"<br/>\";\r\n                    resultStatus[1] = false;\r\n                }\r\n            }\r\n            items += \"<br/>\";\r\n            itemsFailed += \"<br/>\";\r\n        }\r\n\r\n        //load result template\r\n        var resultTemplate = $.tmpl(self.actionResultContentTmpl, {\r\n            action: action,\r\n            resultStatus: resultStatus\r\n        });\r\n        resultTemplate = resultTemplate[0].innerHTML.replace(\"{0}\", \"<strong>\" + items + \"</strong>\");\r\n        resultTemplate = resultTemplate.replace(\"{3}\", \"<strong>\" + itemsFailed + \"</strong>\");\r\n        resultTemplate = resultTemplate.replace(\"{1}\", self.selectedUserName);\r\n        resultTemplate = resultTemplate.replace(\"{1}\", self.selectedUserName);\r\n\r\n        //reset and load respective result data and elements\r\n        if (type == \"invalidate\") $(\"#generalTitle\").html(bizagi.localization.getResource(\"workportal-widget-admincasesearch-invalidate-result-title\"));\r\n        $(\"#mainForm\", content).html(\"\");\r\n        $(\"#dinamicContent\", content).css(\"display\", \"inline\");\r\n        $(\"#dinamicContent\", content).html(resultTemplate);\r\n        $(\"#dinamicContent2\", content).remove();\r\n        $(\"#usersTable\", content).remove();\r\n        $(\"#btn-admin-case-back\", content).css(\"display\", \"none\");\r\n        $(\"#btn-admin-case-search-clear\", content).css(\"display\", \"none\");\r\n        $(\"#btn-admin-case-search\", content).css(\"display\", \"none\");\r\n        $(\"#btn-admin-case-finish\", content).css(\"display\", \"inline\");\r\n        $(\"#biz-wp-userstable-wrapperform\").hide();\r\n        $(\"#biz-wp-userstable-wrapperlist\").hide();\r\n        // Next variable specifies whether is redirecting to inbox or back to the case depending on the result status.\r\n        self.usersTable.resultStatus = (resultStatus.indexOf(false) == -1);\r\n    },\r\n\r\n\r\n\r\n    //******************************** EVENTS ********************************//\r\n\r\n    /*\r\n    * Implement main buttons behaviour\r\n    */\r\n    setupMainButtons: function () {\r\n        var self = this,\r\n            content = self.getContent(),\r\n            buttons = $.tmpl(self.buttonContentTmpl, {});\r\n\r\n        content.append(buttons);\r\n\r\n        var widgetButtonSet = $(\"#case-search-log-data-buttonset\", content);\r\n\r\n        $(\"#btn-admin-case-search-clear\", widgetButtonSet).click(function (e) {\r\n\r\n            //clear all fields\r\n            $(\".biz-wp-input-text\", content).val(\"\");\r\n            $(\".biz-wp-form-datepicker\", content).val(\"\");\r\n            self.setupProcessTree();\r\n\r\n        });\r\n\r\n        $(\"#btn-admin-case-search\", widgetButtonSet).click(function (e) {\r\n\r\n            var idAppToSend = \"\";\r\n            var idCategorytoSend = \"\";\r\n            var idProcessToSend = \"\";\r\n            var errorMessage = \"\";\r\n            var errorFieldName = \"\";\r\n\r\n            var selectedProcessRoute = self.processTree.getTreeRouteSelected();\r\n\r\n            if (selectedProcessRoute.length > 0) {\r\n                if (selectedProcessRoute.length == 2) {\r\n                    idAppToSend = selectedProcessRoute[1];\r\n                    idProcessToSend = selectedProcessRoute[0];\r\n                    idCategorytoSend = \"\";\r\n                }\r\n                else {\r\n                    idAppToSend = selectedProcessRoute[selectedProcessRoute.length - 1];\r\n                    idCategorytoSend = selectedProcessRoute[1];\r\n                    idProcessToSend = selectedProcessRoute[0];\r\n                }\r\n            }\r\n\r\n            var params = {\r\n                h_action: \"getCases\",\r\n                I_ProcessState: \"Running\",\r\n                h_idApp: \"\",\r\n                I_Users: \"ALL\",\r\n                eventAsTask: true,\r\n                orderType: 1,\r\n                order: \"\",\r\n                orderField: \"\",\r\n                I_radNumber: $(\"#caseInput\").val(),\r\n                I_idWFClass: idProcessToSend,\r\n                I_USERFULLNAME: $(\"#userNameInput\").val(),\r\n                I_USERPOSITION: $(\"#userPositionInput\").val(),\r\n                I_From__CreationDate: $(\"#sinceDate\").val(),\r\n                I_To__CreationDate: $(\"#toDate\").val(),\r\n                h_idWFClassAuth: \"\",\r\n                I_idCategory: idCategorytoSend,\r\n                I_idApplication: idAppToSend,\r\n                PageSize: self.maxElemShow\r\n\r\n            };\r\n\r\n            if ($(\"#sinceDate\").val() != \"\" && !bizagi.util.isDate($(\"#sinceDate\").val())) {\r\n                errorMessage = bizagi.localization.getResource(\"workportal-general-invalid-date\");\r\n                errorFieldName = bizagi.localization.getResource(\"workportal-widget-admincasesearch-date-since\");\r\n                errorMessage = errorMessage.replace(\"{0}\", errorFieldName);\r\n                bizagi.showMessageBox(errorMessage, \"Bizagi\", \"warning\");\r\n            } else if ($(\"#toDate\").val() != \"\" && !bizagi.util.isDate($(\"#toDate\").val())) {\r\n                errorMessage = bizagi.localization.getResource(\"workportal-general-invalid-date\");\r\n                errorFieldName = bizagi.localization.getResource(\"workportal-widget-admincasesearch-to-date\");\r\n                errorMessage = errorMessage.replace(\"{0}\", errorFieldName);\r\n                bizagi.showMessageBox(errorMessage, \"Bizagi\", \"warning\");\r\n            } else {\r\n                self.searchParams = params;\r\n                self.findResults(content, params);\r\n            }\r\n\r\n        });\r\n\r\n        $(\"#btn-admin-case-back\", widgetButtonSet).click(function (e) {\r\n            if (self.buttonBackAction == \"backToMainForm\") {\r\n                self.backToMainForm();\r\n            } else if (self.buttonBackAction == \"backToCases\") {\r\n                self.backToCases();\r\n            }\r\n        });\r\n\r\n        $(\"#btn-admin-case-finish\", widgetButtonSet).click(function (e) {\r\n            self.publish(\"closeCurrentDialog\");\r\n        });\r\n\r\n    },\r\n\r\n    /*\r\n    * Back to Cases\r\n    */\r\n    backToCases: function () {\r\n\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        self.buttonBackAction = \"backToMainForm\";\r\n        $(\"#dinamicContent\", content).show();\r\n        $(\"#dinamicContent2\", content).html(\"\");\r\n        $(\"#usersTable\").remove();\r\n        $(\"#generalTitle\").html(bizagi.localization.getResource(\"workportal-widget-admincasesearch-table-title\"));\r\n        $(\"#btn-admin-case-search-clear\", content).hide();\r\n        $(\"#btn-admin-case-search\", content).hide();\r\n    },\r\n\r\n    /*\r\n    * Back to Main Form\r\n    */\r\n    backToMainForm: function () {\r\n\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        $(\"#mainForm\", content).show();\r\n        $(\"#dinamicContent\", content).html(\"\");\r\n        $(\"#generalTitle\").html(bizagi.localization.getResource(\"workportal-widget-admincasesearch-subtitle\"));\r\n        $(\"#btn-admin-case-search-clear\", content).show();\r\n        $(\"#btn-admin-case-search\", content).show();\r\n        $(\"#btn-admin-case-back\", content).css(\"display\", \"none\");\r\n    },\r\n\r\n    /*\r\n    * Set event to reassign link in users table\r\n    */\r\n    assignEventReassignLinks: function (userId, userName) {\r\n        var self = this;\r\n        self.selectedUserId = userId;\r\n        self.selectedUserName = userName;\r\n        self.reassignTasks();\r\n    },\r\n\r\n    /*\r\n    * Implement actions buttons behaviour\r\n    */\r\n    setupActionsButton: function (content) {\r\n        var self = this;\r\n\r\n        //boton invalidar\r\n        $(\"#btn-admin-case-invalidate\", content).click(function (e) {\r\n            self.invalidateCases(content);\r\n        });\r\n\r\n        //boton reasignar\r\n        $(\"#btn-admin-case-reassign\", content).click(function (e) {\r\n            self.showReassignTasksFrame(content);\r\n        });\r\n    },\r\n\r\n    /*\r\n    * Manage cases table links events(cases, activities and view workflow)\r\n    */\r\n    setupActivitiesLink: function (content) {\r\n        var self = this;\r\n\r\n        // Add click event to task (Activity) link\r\n        $(\".activityClicked\", content).click(function () {\r\n            self.publish(\"executeAction\", {\r\n                action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                idCase: $(this)[0].getAttribute(\"data-idCase\"),\r\n                idWorkItem: $(this)[0].getAttribute(\"data-idworkItem\"),\r\n                idTask: $(this)[0].getAttribute(\"data-idTask\")\r\n            });\r\n            self.publish(\"closeCurrentDialog\");\r\n\r\n        });\r\n\r\n        // Add click event to case link\r\n        $(\".caseClicked\", content).click(function () {\r\n            self.publish(\"executeAction\", {\r\n                action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                idCase: $(this)[0].getAttribute(\"data-idCase\"),\r\n                idWorkItem: \"\",\r\n                idTask: \"\"\r\n            });\r\n            self.publish(\"closeCurrentDialog\");\r\n        });\r\n\r\n        // Add click event to column header\r\n        $(\".cases-column-header\", content).click(function () {\r\n            var columnOrderId = $(this)[0].getAttribute(\"data-columnorder\");\r\n            var columnOrderBy = $(this)[0].getAttribute(\"data-ordertype\");\r\n            var columnOrderName = $(this)[0].getAttribute(\"data-columnOrderName\");\r\n\r\n            if (columnOrderBy == \"1\") {\r\n                columnOrderBy = 0;\r\n            } else {\r\n                columnOrderBy = 1;\r\n            }\r\n\r\n            self.searchParams.order = columnOrderId;\r\n            self.searchParams.orderType = columnOrderBy;\r\n            self.searchParams.orderField = columnOrderName;\r\n            self.findResults(content, self.searchParams, self.searchParams.Page);\r\n\r\n        });\r\n    },\r\n\r\n    /*\r\n    * Set up graphic query event\r\n    */\r\n    setupGraphicQueryEvent: function (content) {\r\n\r\n        var self = this;\r\n\r\n        // Add click event to view workflow\r\n        $(\".biz-wp-diagram-view-icon\", content).click(function () {\r\n            var idCase = $(this).data(\"idcase\");\r\n            var idWorkflow = $(this).data('idworkflow');\r\n            self.showGraphicQuery({\r\n                idCase: idCase,\r\n                idWorkflow: idWorkflow\r\n            });\r\n        });\r\n    }\r\n\r\n});"]}