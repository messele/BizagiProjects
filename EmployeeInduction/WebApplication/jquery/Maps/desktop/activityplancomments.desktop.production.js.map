{"version":3,"sources":["jquery/workportal/desktop/widget/project.plan.activity.sidebar/bizagi.workportal.desktop.widgets.project.plan.activity.sidebar.js","jquery/workportal/desktop/widget/project.plan.activity.action/bizagi.workportal.desktop.widgets.project.plan.activity.action.js","jquery/workportal/desktop/widget/project.plan.activity.time/bizagi.workportal.desktop.widgets.project.plan.activity.time.js","jquery/workportal/desktop/widget/project.plan.activity.progress/bizagi.workportal.desktop.widgets.project.plan.activity.progress.js","jquery/workportal/desktop/widget/project.plan.activity.subprocesses/bizagi.workportal.desktop.widgets.project.plan.activity.subprocesses.js","jquery/workportal/desktop/widget/project.plan.activity.parent/bizagi.workportal.desktop.widgets.project.plan.activity.parent.js","jquery/workportal/desktop/widget/project.plan.activity.users/bizagi.workportal.desktop.widgets.project.plan.activity.users.js","jquery/workportal/desktop/widget/project.dashboard.menu.activity.plan/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.plan.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.discussions/bizagi.workportal.desktop.widgets.project.discussions.js","jquery/workportal/desktop/widget/project.discussion.sidebar/bizagi.workportal.desktop.widgets.project.discussion.sidebar.js"],"names":["bizagi","workportal","widgets","project","base","extend","init","workportalFacade","dataService","serviceloadDataPlan","params","self","this","_super","loadTemplates","project-plan-activity-sidebar","getTemplate","concat","renderContent","template","content","render","postRender","sub","$","proxy","onNotifyLoadInfoPlan","event","parans","plan","idActivitySelected","idPlan","id","loadData","getDateServer","subscribe","loadedWithDataActivities","loadedWithDataFirstParent","showContextByMenuDashboard","pub","type","args","clean","unsubscribe","injector","register","activity","sidebar","notifier","dateFormat","localization","getResource","timeFormat","estimatedFinishDateTime","beforeUserAssignedActivity","activity-action-main","activity-action-editionpopup","dialogBox","onNotifyLoadInfoActivityExecution","onNotifyExpandedRightSidebar","$content","getContent","empty","currentActivity","activities","filter","toUpperCase","idUserCreator","currentUser","idUser","userAssigned","argsTemplate","currentActivityName","name","showEditAction","tmpl","append","initilizeActionMenu","initializeTempleteAndEvents","plugins","activityEdition","initPluginPopupEdition","formEditActivity","assignee","date","duration","buttonCancel","buttonUpdate","on","onClickPopupButtonCancel","onClickPopupButtonUpdate","onDeleteDate","onTypeDuration","menu","select","onSelectMenu","removeClass","popupEditActivity","formContent","initializeAutoComplete","element","url","serviceLocator","getUrl","autocomplete","minLength","source","request","response","ajax","data","domain","userName","fullName","term","organization","pag","pagSize","orderField","success","map","users","item","label","user","value","ui","val","IdAssignee","focus","change","initializeDatePicker","datepicker","onSelect","getTime","undefined","util","dateFormatter","getDateFormatByDatePickerJqueryUI","initializeSpiner","desactivateDateByDuration","newValue","target","isNumeric","parseInt","spinner","min","max","placeHolder","spin","keyCode","fieldDurationActive","activateElement","form","currentTarget","find","length","onClickOpenPopupEdition","dialog","resizable","draggable","height","width","modal","title","maximize","open","onOpenPopupEdition","close","onClosePopupEdition","activityDate","isEmpty","estimatedFinishDate","isNaN","formatInvariant","Date","getDateFromInvariant","isMinimumDate","setUserAssignedById","removePopupWidgets","callGetDataUsers","then","responseUsers","preventDefault","next","html","remove","validateParamsOfFormEditActivity","idUserAssigned","updateActivity","progress","startDate","allowEdition","description","finishDate","items","when","editActivityPlan","done","refreshAllWidgets","showSucessMessage","onClickFavorite","favoriteOptions","hasClass","idObject","idCase","favoriteType","addFavorite","favoritesData","guidFavorite","idFavorites","addClass","delFavorite","unsub","messageValidationField","replace","toLowerCase","csvIdUsers","defer","Deferred","userIds","getUsersData","always","resolve","promise","action","widget","EXECUTING_ACTIVITY","FINISHED_ACTIVITY","datePickerRegional","plan-time-main","onNotifyLoadInfoActivitySummary","getStateActivity","time","fromDate","getFormattedDate","getFirstDate","dataProgressWidget","getDataByScenarios","unitTime","auxUnitTime","updateWidget","contentTemplate","relativeTime","getRelativeTime","now","minutes","messageDescripionDifference","keywordResource","messageTime","appendTo","$barRemainingDate","widthNumberDays","css","toString","percentBar","currentState","colorBar","getColorByCreatedAndEstimatedDate","toDate","callGetEffectiveDuration","getColorBar","getPercentBar","getKeywordResourceDescriptionBar","getUnitTime","getUTCDate","dateObj","monthNames","getMonth","formatDate","d","getEffectiveDuration","plan-progress-main","plan-progress-popup-edit","onNotifyUpdateItemFromRender","activityToShow","valuePercentBarComplete","canEdit","popupEditProgress","initPluginPopupEditProgress","formEditProgress","sliderProgress","slider","orientation","range","from","to","step","slide","onChangesliderProgress","each","vals","i","el","numericTextBoxPlugin","format","onChangeNumericTextBoxProgress","decimals","buttonChangeProgress","onShowPopupEditProgress","onClickCancel","onSubmitFormChangeProgress","updateProgressUI","listItems","activityWork","hide","show","text","newPercentProgress","templatePopupEditProgress","onOpenPopupPlan","detach","previusValueProgress","prop","project-subprocesses","project-subprocesses-tootip-custom-properties","subprocesses","plan-parent-main","getPlanParent","planParent","parent","idParent","radNumber","nameParent","displayName","idWorkflow","idWorkItem","idTask","onClickGoToParentCase","routingExecute","closest","usersMap","usersInformation","globalHandlersService","get","usersAssignees","plan-users-main","activityRuning","cvsGuidUsers","activitiesUsers","ownerUserId","ownerUserGuid","push","guidUser","userType","picture","guid","index","userId","userGuid","userAssignedGuid","inArray","justAssignees","addEventHandlersModal","showCreatorInformation","renderUserProfilesAndImages","allUsers","usersAssignee","isOwner","indexOf","isAssignee","usersAdapter","createJsonUserInfo","userCreator","userInfo","username","email","getInitials","userinformation","obj","$li","console","log","not","ev","userSelected","$target","usersActivities","userParam","getIsAssignee","getIsOwner","usertooltip","usersGuids","join","getUsersAssignees","getUserAssignee","tasks","types","actUser","click","stopPropagation","publish","widgetName","BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL","closeVisible","modalParameters","refreshInbox","project-dashboard-menu","contextsLeftSidebarCaseDashboard","forEach","context","updateView","showFormOverview","menuDashboard","showFormActivity","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","showPlanOptionMenu","contextPlanOptionMenu","contextFormActivityOptionMenu","contextualized","siblings","handlerEvents","paramsGetPlan","callGetPlan","responsePlan","loadContentById","$item","autoSave","document","getLevelNavigator","newLevelNavigator","refreshLastItemBreadcrumb","histName","level","getPlan","status","reject","subMenuHandler","$comments","$files","$timeline","toggle","off","dashboard","project-content-dashboard","setTimeout","window","trigger","kendo","Widget","ProjectAttachments","options","that","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","wrapper","multiple","dropZone","maxFilesSize","uploadMaxFileSize","enabled","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","_filterMaxFilesSize","complete","interval","setInterval","_showNotificationCompleteUpload","clearInterval","_onProgressFile","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","notifierTitle","actions","animation","visible","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","Math","round","cancel","retry","$file","_getFileItemByUID","uid","percent","percentComplete","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$fileWrapper","$uploadWrapper","_onRemoveFile","_onRetryFile","file","grep","validation","_isValidFile","message","setStatus","valid","size","extension","total","_notifySizeExceeded","_switchEvents","cancelFilesUpload","destroy","errorUploadiis","plugin","jQuery","typeResource","dialogBoxDiscussion","attchComments","attchDiscussions","addition","listDataDiscussion","userPictures","commentsList","globalTags","tempTagsBeforeDelete","tempTagsToDelete","keySentenceAddTag","project-discussions","project-discussions-popup","project-discussions-list","project-discussions-comments","project-discussions-attachments","project-attachments","templateHomeDiscussions","$contentWidget","popupDiscussion","initPluginPopupDiscussion","buttonShowFormNewDiscussion","subject","buttonShowPopupDiscussionToAdd","buttonAddDiscussion","formDiscussion","attachments","edition","tagsFilter","initPluginTagsFilter","tagsMultiSelect","initPluginTagsMultiSelect","getDiscussions","eventsHandler","restrictedEventsHandler","getDataDiscussions","idUsersCreatedDiscussions","idUsersCreatedComments","property","comments","csvGuidUsers","a","seen","out","len","j","removeDuplicateItemsFromArray","getDataUsers","setClassesTagsByDiscussion","onNotifyOpenPopup","showFormAddDiscussion","renderUserProfile","templatePopupDiscussion","newitemtext","categoriesMultiSelect","isDelete","createNewTag","kendoMultiSelect","valuesSelected","slice","dataitems","dataSource","tag","Boolean","pos","newtag","dataItemAddNew","at","refresh","list","itemData","add","dataBound","_prev","isfound","insert","search","dataTextField","dataValueField","hideOrShowDiscussionsByFilter","autoClose","tagMode","valueClass","validateAddCommentForm","$wrapperForm","result","$textAreaComment","trim","commentValidation","validateAddDiscussionForm","$subjectDiscussion","$descriptionDiscussion","subjectValidation","descriptionValidation","applyFileAttachments","kendoProjectAttachments","onSuccessFile","addFileData","supportFileExt","uploadMaxFilesSize","paramsGetDiscussions","globalParent","flowContext","getDiscussionsData","pipe","callForListComments","sortDiscussions","updateTemplateListDiscussion","array","splice","arrayUnique","discussions","generalDefer","commentsDefer","addGlobalTags","tags","dateTime","count","getCommentsData","apply","sortedDiscussion","sort","b","dateA","unshift","pop","resetDiscussionAttachments","sendDataUpdateDiscussion","filesObj","prepareFilesToSave","tagsDiscussion","getTagsDiscussionBySave","guidsTagsDiscussionToDelete","getGuidsTagsDiscussionToDelete","general","attachmentsToCreate","attachmentsToDelete","editDiscussion","discussion","getDiscussionDataByGUID","onClosePopupDiscussion","removeGlobalTags","printf","showErrorMessage","validateStringIsGuid","test","sendDataInsertDiscussion","postDiscussion","newDiscussion","tagsTextSelected","dataSourceTags","tagTextSelected","tagFound","isGuidTextSelected","tagSource","isGuid","differenceArrays","guidsTagsCurrentDiscussion","setStateUIShowMoreComments","$commentsContainer","state","$containerButtonMoreComments","$buttonShowMoreComments","$messageNoMoreComments","$messageLoadingComments","getCurrentUserInfo","createTagsOnServer","iTagAdd","tagGlobal","postTag","guidTagsToDelete","allGuidsMoreGuidsDelete","itemTag","secureGuidsForDelete","guidDelete","guidSecureDelete","idTag","deleteTag","iTagGlobal","iDiscussion","tagsBySpace","templateListDiscussions","contentRenderListDiscussions","listDataDiscussions","isOpen","parseBoolean","isClosedForAllUsers","returnServedCommentByParentId","parentId","mapTempComments","resourceTitlePopup","zIndex","onOpenPopupDiscussion","resetFormDiscussion","userPicture","$parent","$img","$text","attr","base64Prefix","iUser","switchCommentsEvents","is","onShowButtonsPanel","onCancelComment","$container","onCreateComment","onViewComment","onViewMoreComments","onRemoveFiles","onEditDiscussion","showConfirmationBox","onDeleteComment","onDownloadAttachment","setDiscussionsDataByGUID","guidTagsDiscussion","renderAttachments","$commentWrapper","toggleClass","getMoreComments","getCommentsCountByParent","dateLastComment","responseMoreComments","Array","prototype","renderCommentByDiscussion","idUsersLoaded","idUsersNewComments","csvIdUsersMissingLoad","fail","guidParent","moreComments","$commentsDOM","tmplComment","renderObject","getCommentByGuid","parentGuid","commentGuid","x","lengthx","currentFiles","removeFiles","tmpSplice","fileGuid","comment","deleteComment","XMLHttpRequest","JSON","parse","$wrapper","sender","$liTarget","guidAttachment","nameFile","getDownloadAttachment","$commentContainer","$buttonsWrp","$textarea","$uploadForm","$vlTooltip","$fileList","reset","$rplWrp","$addCommentContainer","$uploadList","postComment","newComment","isIE","fileList","onSubmitFormDiscussion","resetWidget","hasOwnProperty","$source","$textareaSource","$textareaTarget","$uploadListSource","first","$uploadListTarget","supportNav","project-discussion-sidebar","onShowPopupDiscussion"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal Project Activity Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activity.sidebar\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, serviceloadDataPlan, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.serviceloadDataPlan = serviceloadDataPlan;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-plan-activity-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.sidebar\").concat(\"#project-plan-activity-sidebar\")\r\n      });\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-plan-activity-sidebar\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_PLAN\", $.proxy(self.onNotifyLoadInfoPlan, self));\r\n   },\r\n\r\n    onNotifyLoadInfoPlan: function (event, parans) {\r\n        var self = this;\r\n        if (self.params.plan.idActivitySelected) {\r\n\r\n            var params = {idPlan: self.params.plan.id};\r\n            self.serviceloadDataPlan.loadData(params, self.getDateServer, self.params);\r\n            self.serviceloadDataPlan.subscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n            self.serviceloadDataPlan.subscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n        }\r\n        else {\r\n            if (self.params.showContextByMenuDashboard === \"ACTIVITYPLANPROCESSMAP\" ||\r\n                    self.params.showContextByMenuDashboard === \"ACTIVITYPLANLOG\") {\r\n                self.pub(\"notify\", {\r\n                    type: \"DISABLED_RIGHT_SIDEBAR\"\r\n                });\r\n            }\r\n        }\r\n    },\r\n\r\n    loadedWithDataActivities: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOADED_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PROGRESS_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_ACTIVITY_SUMMARY\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    loadedWithDataFirstParent: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    clean: function(){\r\n        var self = this;\r\n        if(self.serviceloadDataPlan){\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n        }\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.sidebar\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.loadDataPlan\", bizagi.workportal.widgets.project.plan.activity.sidebar], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Action\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activity.action\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, notifier, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.dateFormat = bizagi.localization.getResource(\"dateFormat\");\r\n      self.timeFormat = bizagi.localization.getResource(\"timeFormat\");\r\n      self.estimatedFinishDateTime; //Save complete date and time, because datepicker dont save time\r\n\r\n      self.beforeUserAssignedActivity = \"\";\r\n       self.notifier = notifier;\r\n\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"activity-action-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.action\").concat(\"#project-plan-activity-action\"),\r\n         \"activity-action-editionpopup\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.action\").concat(\"#project-plan-activity-action-editionpopup\")\r\n      });\r\n\r\n      self.dialogBox = {};\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @returns {*|jQuery|HTMLElement}\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.sub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      var $content = self.getContent().empty();\r\n\r\n      var currentActivity = {};\r\n      if(self.params.plan.idActivitySelected){\r\n         currentActivity = self.params.plan.activities.filter(function(activity){\r\n            return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n         })[0];\r\n      }\r\n\r\n      if(self.params.plan.idUserCreator === bizagi.currentUser.idUser || currentActivity.userAssigned == bizagi.currentUser.idUser){\r\n\r\n         var argsTemplate = {};\r\n         argsTemplate.currentActivityName = currentActivity.name;\r\n         argsTemplate.showEditAction = true;\r\n         if(self.params.plan.idUserCreator !== bizagi.currentUser.idUser){\r\n             argsTemplate.showEditAction = false;\r\n         }\r\n\r\n         var tmpl = self.getTemplate(\"activity-action-main\");\r\n         $content.append(tmpl.render(argsTemplate));\r\n\r\n         if(argsTemplate.showEditAction){\r\n             self.initilizeActionMenu();\r\n             self.beforeUserAssignedActivity = currentActivity.userAssigned;\r\n             self.content.append($content);\r\n            self.initializeTempleteAndEvents();\r\n         }\r\n      }\r\n   },\r\n\r\n   initializeTempleteAndEvents: function (){\r\n        var self = this;\r\n        self.plugins = {}; \r\n        self.plugins.activityEdition = self.initPluginPopupEdition();\r\n\r\n        self.formEditActivity = {\r\n            assignee: $(\"#activity-form-assignee\", self.plugins.activityEdition),\r\n            date: $(\"#activity-form-date\", self.plugins.activityEdition),\r\n            duration:  $(\"#activity-form-duration\",self.plugins.activityEdition),\r\n            buttonCancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", self.plugins.activityEdition),\r\n            buttonUpdate: $(\"#ui-bizagi-wp-project-popupform-action-update\", self.plugins.activityEdition)\r\n        };\r\n\r\n        self.formEditActivity.buttonCancel.on(\"click\", $.proxy(self.onClickPopupButtonCancel, self));\r\n        self.formEditActivity.buttonUpdate.on(\"click\", $.proxy(self.onClickPopupButtonUpdate, self));\r\n\r\n        self.formEditActivity.date.on(\"keydown\", $.proxy(self.onDeleteDate, self));\r\n        self.formEditActivity.duration.on(\"keyup\", $.proxy(self.onTypeDuration, self));\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   onNotifyExpandedRightSidebar: function(){\r\n      var self = this;\r\n      self.initilizeActionMenu();\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   initilizeActionMenu: function () {\r\n      var self = this;\r\n      $(\"#ui-bizagi-wp-project-plan-activity-action .menu\", self.content).menu({\r\n         select: $.proxy(self.onSelectMenu, self)\r\n      }).removeClass(\"ui-widget-content\");\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @returns dialogBox.formContent\r\n    */\r\n   initPluginPopupEdition: function () {\r\n      var self = this;\r\n      var popupEditActivity = self.getTemplate(\"activity-action-editionpopup\");\r\n      self.dialogBox.formContent = popupEditActivity.render({});\r\n      return self.dialogBox.formContent;\r\n\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeAutoComplete: function (element) {\r\n        var self = this;\r\n        var url = self.dataService.serviceLocator.getUrl(\"admin-getUsersList\");\r\n\r\n        element.autocomplete({\r\n            minLength: 2,\r\n            source: function (request, response) {\r\n                $.ajax({\r\n                    url: url,\r\n                    data: {\r\n                        domain: \"\",\r\n                        userName: \"\",\r\n                        fullName: request.term,\r\n                        organization: \"\",\r\n                        pag: 1,\r\n                        pagSize: 100,\r\n                        orderField: \"fullName\"\r\n                    },\r\n                    success: function (data) {\r\n                        response($.map(data.users, function (item) {\r\n                            return {\r\n                                label: item.user,\r\n                                value: item.idUser\r\n                            };\r\n                        }));\r\n                    }\r\n                });\r\n            },\r\n            select: function (event, ui) {\r\n                var name = ui.item.label;\r\n                element.val(name);\r\n                self.formEditActivity.IdAssignee = ui.item.value;\r\n                return false;\r\n            },\r\n            focus: function () {\r\n                return false;\r\n            },\r\n            change: function (event, ui){\r\n                if(ui.item === null){\r\n                    self.formEditActivity.IdAssignee = null;\r\n                    self.formEditActivity.assignee.val(\"\");\r\n                }\r\n                return false;\r\n            }\r\n\r\n        });\r\n\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeDatePicker: function (element) {\r\n        var self = this;\r\n        element.datepicker({\r\n            onSelect: function () {\r\n                self.formEditActivity.duration.val(\"\");\r\n                self.estimatedFinishDateTime = self.formEditActivity.date.datepicker(\"getDate\") ? self.formEditActivity.date.datepicker(\"getDate\").getTime() : undefined;\r\n            }\r\n        });\r\n        element.datepicker(\"option\", \"dateFormat\", bizagi.util.dateFormatter.getDateFormatByDatePickerJqueryUI());\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeSpiner: function (element) {\r\n        var self = this;\r\n        function desactivateDateByDuration(event, newValue){\r\n            var value = newValue || $(event.target).val();\r\n            if (bizagi.util.isNumeric(value) && parseInt(value, 10) > 0) {\r\n               self.formEditActivity.date.val(\"\");\r\n               self.estimatedFinishDateTime = undefined;\r\n            } else {\r\n               $(event.target).val(\"\");\r\n            }\r\n        }\r\n\r\n        element.spinner({\r\n            min: 1,\r\n            max: 1000,\r\n            placeHolder: bizagi.localization.getResource(\"workportal-hours\"),\r\n            change: function (event) {\r\n                desactivateDateByDuration(event);\r\n            },\r\n            spin: function( event, ui ) {\r\n                desactivateDateByDuration(event, ui.value);\r\n            }\r\n        });\r\n    },\r\n\r\n   /***\r\n    * Events\r\n    * @param event\r\n    */\r\n\r\n   onDeleteDate: function (event) {\r\n      var self = this;\r\n      if (event.keyCode === 8) {\r\n          $(event.target).val(\"\");\r\n          self.fieldDurationActive(true);\r\n      }\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param event\r\n    */\r\n   onTypeDuration: function (event) {\r\n      var self = this;\r\n      var $target = $(event.target);\r\n      if ($target.val() !== \"\") {\r\n          self.estimatedFinishDateTime = undefined;\r\n      } else {\r\n          self.activateElement(self.form.date);\r\n      }\r\n   },\r\n\r\n    /**\r\n     * When select menu\r\n     * @param event\r\n     * @param ui\r\n     */\r\n   onSelectMenu: function (event, ui) {\r\n      var self = this;\r\n      if($(event.currentTarget).find(\"i\").length === 0){\r\n         var item = $(ui.item).data(\"item\");\r\n         switch (item) {\r\n            case \"edit\":\r\n               self.onClickOpenPopupEdition();\r\n               break;\r\n         }\r\n      }\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   onClickOpenPopupEdition: function () {\r\n        var self = this;\r\n        self.initializeTempleteAndEvents();\r\n        self.dialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"600px\",\r\n            modal: true,\r\n            title: bizagi.localization.getResource(\"workportal-project-plan-title-activity-properties\"),\r\n            maximize: true,\r\n            open: $.proxy(self.onOpenPopupEdition, self),\r\n            close: $.proxy(self.onClosePopupEdition, self)\r\n        });\r\n   },\r\n\r\n    /**\r\n    *\r\n    */\r\n    onOpenPopupEdition: function () {\r\n        var self = this;\r\n        var currentActivity = self.params.plan.activities.filter(function(activity){\r\n            return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n        })[0];\r\n\r\n        var activityDate =  (currentActivity && !bizagi.util.isEmpty(currentActivity.estimatedFinishDate)) ? currentActivity.estimatedFinishDate: \"\";\r\n        if(!isNaN(activityDate)){\r\n            activityDate=bizagi.util.dateFormatter.formatInvariant(new Date(activityDate));\r\n        }\r\n        var estimatedFinishDate = activityDate ? bizagi.util.dateFormatter.getDateFromInvariant(activityDate): \"\";\r\n        var isMinimumDate = estimatedFinishDate instanceof Date ? estimatedFinishDate.getTime() < self.getDateServer() : false;\r\n\r\n        self.initializeAutoComplete(self.formEditActivity.assignee);\r\n        self.initializeDatePicker(self.formEditActivity.date);\r\n        self.initializeSpiner(self.formEditActivity.duration);\r\n\r\n        if (currentActivity.userAssigned) {\r\n            self.setUserAssignedById(currentActivity.userAssigned);\r\n        }\r\n\r\n        self.formEditActivity.date.datepicker(\"option\", \"minDate\", new Date(self.getDateServer()));\r\n\r\n        if (currentActivity.estimatedFinishDate && isMinimumDate) {\r\n            self.formEditActivity.date.datepicker(\"option\", \"minDate\", estimatedFinishDate);//set minimum because, if date is past\r\n        }\r\n\r\n        if (currentActivity.estimatedFinishDate) {\r\n            if (estimatedFinishDate){\r\n                self.formEditActivity.date.datepicker(\"setDate\", estimatedFinishDate);\r\n            }\r\n            self.estimatedFinishDateTime = currentActivity.estimatedFinishDate;\r\n        }\r\n\r\n        if (currentActivity.duration) {\r\n            self.formEditActivity.duration.val(parseInt(currentActivity.duration, 10));\r\n        }\r\n   },\r\n\r\n   /**\r\n    * When close popup edition\r\n    */\r\n   onClosePopupEdition: function(){\r\n      var self = this;\r\n      self.removePopupWidgets();\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param idUser\r\n    */\r\n    setUserAssignedById: function (idUser) {\r\n        var self = this;\r\n        //Show images users\r\n        self.callGetDataUsers(idUser).then(function (responseUsers) {\r\n            self.formEditActivity.assignee.val(responseUsers[0].name);\r\n        });\r\n        self.formEditActivity.IdAssignee = idUser;\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param event\r\n    */\r\n    onClickPopupButtonCancel: function(event){\r\n        var self = this;\r\n        event.preventDefault();\r\n        self.removePopupWidgets();\r\n    },\r\n\r\n    /**\r\n    * Remove popup widgets\r\n    */\r\n    removePopupWidgets: function(){\r\n        var self = this;\r\n        self.formEditActivity.assignee.next().find(\"span\").html(\"\");\r\n        self.dialogBox.formContent.remove();\r\n        $(\"#ui-datepicker-div\").remove();\r\n    },\r\n\r\n   /**\r\n    *  Triggered when click update plan activity\r\n    */\r\n    onClickPopupButtonUpdate: function () {\r\n        var self = this;\r\n        if(self.validateParamsOfFormEditActivity()){\r\n            var currentActivity = self.params.plan.activities.filter(function (activity) {\r\n                return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n            })[0];\r\n            var idUserAssigned =  self.formEditActivity.IdAssignee || bizagi.currentUser.idUser;\r\n            if(self.formEditActivity.duration.val()!=\"\"){\r\n                self.params.plan.activities.filter(function (activity) {\r\n                    return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n                })[0].estimatedFinishDate=\"\";\r\n            }\r\n            var updateActivity = {\r\n                progress: currentActivity.progress,\r\n                id: currentActivity.id,\r\n                startDate: currentActivity.startDate,\r\n                duration: self.formEditActivity.duration.val(),\r\n                userAssigned: idUserAssigned,\r\n                allowEdition: currentActivity.allowEdition,\r\n                description: currentActivity.description,\r\n                name: currentActivity.name,\r\n                idPlan: currentActivity.idPlan,\r\n                estimatedFinishDate: self.estimatedFinishDateTime,\r\n                finishDate: currentActivity.finishDate,\r\n                items: currentActivity.items\r\n            };\r\n            $.when(self.dataService.editActivityPlan(updateActivity)).done(function () {\r\n                currentActivity = $.extend(currentActivity, updateActivity);\r\n                self.removePopupWidgets();\r\n\r\n                if (self.beforeUserAssignedActivity !== self.formEditActivity.IdAssignee) {\r\n                    self.pub(\"notify\", {\r\n                        type: \"ACTIVITYPLANCOMMENTS\",\r\n                        args: $.extend(self.params, {refreshAllWidgets: true})\r\n                    });\r\n                }\r\n                else {\r\n                    self.pub(\"notify\", {\r\n                        type: self.params.showContextByMenuDashboard,\r\n                        args: self.params\r\n                    });\r\n                }\r\n\r\n                self.removePopupWidgets();\r\n                self.notifier.showSucessMessage(bizagi.localization.getResource(\"workportal-project-plan-activity-update-message\"));\r\n            });\r\n        }\r\n    },\r\n\r\n   /***\r\n    * Events\r\n    */\r\n   onClickFavorite: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n      var favoriteOptions = {};\r\n      if ($(event.target).hasClass(\"bz-icon-star-outline\")) {\r\n         favoriteOptions = {\r\n            idObject: self.params.idCase,\r\n            favoriteType: \"CASES\"\r\n         };\r\n         $.when(self.dataService.addFavorite(favoriteOptions)).done(function (favoritesData) {\r\n            self.params.guidFavorite = favoritesData.idFavorites;\r\n            $(event.target).removeClass(\"bz-icon-star-outline\");\r\n            $(event.target).addClass(\"bz-icon-star\");\r\n         });\r\n      }\r\n      else {\r\n         favoriteOptions = {\r\n            idObject: self.params.guidFavorite,\r\n            favoriteType: \"CASES\"\r\n         };\r\n         $.when(self.dataService.delFavorite(favoriteOptions)).done(function () {\r\n            $(event.target).addClass(\"bz-icon-star-outline\");\r\n            $(event.target).removeClass(\"bz-icon-star\");\r\n         });\r\n      }\r\n   },\r\n\r\n   /**\r\n    * Clean events and plugins\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      self.unsub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.unsub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n   },\r\n\r\n   /**\r\n    * Validate form edit plan activity\r\n    * @returns {boolean}\r\n    */\r\n    validateParamsOfFormEditActivity: function(){\r\n        var self = this;\r\n        var userAssigned = self.formEditActivity.assignee;\r\n        if (userAssigned.val() && userAssigned.val() !== \"\" && self.formEditActivity.IdAssignee) {\r\n            return true;\r\n        } else {\r\n            var messageValidationField = bizagi.localization.getResource(\"workportal-general-error-field-required\");\r\n            messageValidationField = messageValidationField.replace(\"{0}\", bizagi.localization.getResource(\"workportal-project-plan-assignee\").toLowerCase());\r\n            userAssigned.next().find(\"span\").html(messageValidationField);\r\n            return false;\r\n        }\r\n    },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n   callGetDataUsers: function (csvIdUsers) {\r\n      var self = this,\r\n         defer = $.Deferred();\r\n      var params = {\r\n         userIds: csvIdUsers,\r\n         width: 50,\r\n         height: 50\r\n      };\r\n\r\n      self.dataService.getUsersData(params).always(function (response) {\r\n         defer.resolve(response);\r\n      });\r\n      return defer.promise();\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.action\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.plan.activity.action]);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Time\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n/***\r\n * TODO IMPORTANT: This widget is development with TDD, test this file when changes\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.time\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    *\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Constants\r\n      self.EXECUTING_ACTIVITY = \"EXECUTING\";\r\n      self.FINISHED_ACTIVITY = \"FINISHED\";\r\n\r\n      //Regional\r\n      self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-time-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.time\").concat(\"#project-plan-activity-time\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivitySummary, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivitySummary: function(event, params){\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.getContent().empty();\r\n\r\n      var currentActivity = self.params.plan.activities.filter(function (activity) {\r\n         return activity.id === self.params.plan.idActivitySelected;\r\n      })[0];\r\n\r\n      if(currentActivity.startDate){\r\n         self.getStateActivity(currentActivity);\r\n\r\n         var argsTemplate = {\r\n            time: {\r\n               fromDate: self.getFormattedDate(new Date(self.getFirstDate(currentActivity)))\r\n            }\r\n         };\r\n         var dataProgressWidget = self.getDataByScenarios(currentActivity, true);\r\n\r\n         $.when(dataProgressWidget.unitTime).done(function(auxUnitTime){\r\n            dataProgressWidget = $.extend(dataProgressWidget, {\r\n               unitTime: auxUnitTime\r\n            });\r\n            self.updateWidget($.extend(argsTemplate.time, dataProgressWidget));\r\n         });\r\n\r\n      }\r\n   },\r\n   updateWidget: function(argsTemplate){\r\n      var self = this;\r\n      var $content = self.getContent().empty();\r\n      var contentTemplate = self.getTemplate(\"plan-time-main\");\r\n\r\n      var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - (argsTemplate.unitTime.minutes * 60 * 1000)), null, false);\r\n\r\n      var messageDescripionDifference = bizagi.localization.getResource(\"workportal-project-activity-state-\" + argsTemplate.keywordResource);\r\n      argsTemplate.messageTime = messageDescripionDifference.replace(\"%s\", relativeTime);\r\n\r\n      contentTemplate\r\n         .render(argsTemplate)\r\n         .appendTo($content);\r\n\r\n      //Begin Adjust status bar next to the number days\r\n      var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\r\n      var widthNumberDays = $(\".remaining-days .days\", $content).width();\r\n      $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\r\n\r\n      var $barCompletedDate = $(\".remaining-days .bar-completed\", $content);\r\n\r\n      $barCompletedDate.css(\"width\", argsTemplate.percentBar + \"%\");\r\n      //End Adjust status bar next to the number days\r\n\r\n   },\r\n   getStateActivity: function(activity){\r\n      var self = this;\r\n      if(activity.finishDate){\r\n         activity.currentState = self.FINISHED_ACTIVITY;\r\n         return self.FINISHED_ACTIVITY;\r\n      }\r\n      else{\r\n         activity.currentState = self.EXECUTING_ACTIVITY;\r\n         return self.EXECUTING_ACTIVITY;\r\n      }\r\n   },\r\n   getFirstDate: function(activity){\r\n      var self = this;\r\n      if(activity.currentState === self.EXECUTING_ACTIVITY){\r\n         return activity.startDate;\r\n      } else{\r\n         return activity.finishDate;\r\n      }\r\n   },\r\n   getDataByScenarios: function(activity){\r\n      var self = this;\r\n      var response = {\r\n         colorBar: null,\r\n         percentBar: 100,\r\n         keywordResource: null,\r\n         unitTime: null\r\n      };\r\n      var params = {};\r\n      switch(activity.currentState){\r\n         case self.EXECUTING_ACTIVITY:\r\n            response.keywordResource = \"opened\";\r\n            response.colorBar = self.getColorByCreatedAndEstimatedDate(activity);\r\n\r\n            params = {\r\n               idUser: bizagi.currentUser.idUser,\r\n               fromDate: activity.startDate,\r\n               toDate: Date.now()\r\n            };\r\n            response.unitTime = self.callGetEffectiveDuration(params);\r\n\r\n            break;\r\n         case self.FINISHED_ACTIVITY:\r\n            response.colorBar = \"Gray\";\r\n            response.keywordResource = \"closed\";\r\n            params = {\r\n               idUser: bizagi.currentUser.idUser,\r\n               fromDate: activity.finishDate,\r\n               toDate: Date.now()\r\n            };\r\n            response.unitTime = self.callGetEffectiveDuration(params);\r\n            break;\r\n      }\r\n      return response;\r\n   },\r\n\r\n   getColorBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).colorBar;\r\n   },\r\n   getPercentBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).percentBar;\r\n   },\r\n   getKeywordResourceDescriptionBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).keywordResource;\r\n   },\r\n   getUnitTime: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).unitTime;\r\n   },\r\n\r\n   getColorByCreatedAndEstimatedDate: function(activity){\r\n      var self = this;\r\n      var response = \"Red\";\r\n      if(activity.estimatedFinishDate) {\r\n         if (Date.now() < activity.estimatedFinishDate) {\r\n            var theSameDay = (new Date()).getUTCDate() === (new Date(activity.estimatedFinishDate)).getUTCDate();\r\n            if(theSameDay){\r\n               response = \"Yellow\";\r\n            }\r\n            else{\r\n               response = \"Green\";\r\n            }\r\n         }\r\n      }\r\n      return response;\r\n   },\r\n\r\n   getFormattedDate: function (dateObj) {\r\n      var self = this;\r\n      var monthsNames = self.datePickerRegional.monthNames;\r\n      var shortMonth = dateObj.getMonth();\r\n\r\n      return monthsNames[shortMonth] + \" \" + bizagi.util.dateFormatter.formatDate(dateObj, \"dd hh:mm tt\", bizagi.localization.getResource(\"datePickerRegional\"));\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n   callGetEffectiveDuration: function(params){\r\n      var self = this;\r\n      var d = $.Deferred();\r\n      $.when(\r\n         self.dataService.getEffectiveDuration(params)\r\n      ).done(function (data) {\r\n            d.resolve(data);\r\n         });\r\n      return d.promise();\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.time\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.time], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Progress\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.progress\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.plugins = {};\r\n      self.dialogBox = {};\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-progress-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.progress\").concat(\"#project-plan-activity-progress\"),\r\n         \"plan-progress-popup-edit\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.progress\").concat(\"#project-plan-activity-edit-progress\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.sub(\"UPDATE_ITEMS_FROM_FORMRENDER\", $.proxy(self.onNotifyUpdateItemFromRender, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      var $content = self.getContent().empty();\r\n\r\n      var activityToShow = self.params.plan.activities.filter(function(activity){\r\n         return activity.id.toUpperCase() == self.params.plan.idActivitySelected.toUpperCase();\r\n      })[0];\r\n\r\n      var argsTemplate = {};\r\n      argsTemplate.valuePercentBarComplete = 0;\r\n      argsTemplate.progress = {\r\n         progress: activityToShow.progress,\r\n         canEdit: (activityToShow.items.length === 0)\r\n      };\r\n\r\n      if(argsTemplate.progress.progress){\r\n         argsTemplate.valuePercentBarComplete = argsTemplate.progress.progress;\r\n      }\r\n\r\n      //Update widget\r\n      var templateMain = self.getTemplate(\"plan-progress-main\");\r\n      templateMain.render(argsTemplate).appendTo($content);\r\n\r\n      self.plugins.popupEditProgress = self.initPluginPopupEditProgress();\r\n\r\n      var popupEditProgress = self.plugins.popupEditProgress;\r\n\r\n      self.formEditProgress = {\r\n         sliderProgress: $(\"#sliderProgress\", popupEditProgress).slider({\r\n            orientation: \"horizontal\",\r\n            range: \"min\",\r\n            max: 100,\r\n            width: 100,\r\n            from: 5,\r\n            to: 50,\r\n            step: 1,\r\n            value: argsTemplate.valuePercentBarComplete,\r\n            slide: $.proxy(self.onChangesliderProgress, self),\r\n            change: $.proxy(self.onChangesliderProgress, self)\r\n         }).each(function () {\r\n            var vals = $(this).slider(\"option\", \"max\") - $(this).slider(\"option\", \"min\");\r\n            for (var i = 0; i <= vals; i += 10) {\r\n               var el = $(\"<label class='step'>\" + (i) + \"</label>\").css(\"left\", (i / vals * 100) + \"%\");\r\n               $(this).append(el);\r\n            }\r\n         }),\r\n         numericTextBoxPlugin: $(\"#inputProgressNumericTextBox\", popupEditProgress).spinner({\r\n            format: \"n0\",\r\n            min: 0,\r\n            max: 100,\r\n            spin: $.proxy(self.onChangeNumericTextBoxProgress, self),\r\n            change: $.proxy(self.onChangeNumericTextBoxProgress, self),\r\n            value: argsTemplate.valuePercentBarComplete,\r\n            decimals: 0\r\n         }),\r\n         buttonChangeProgress: $(\"#button-accept-change-progress\", popupEditProgress),\r\n         buttonCancel: $(\"#button-cancel-change-progress\", popupEditProgress)\r\n      };\r\n\r\n      //Handlers\r\n      $(\".action-open-popup-edit-progress\", $content).on(\"click\", $.proxy(self.onShowPopupEditProgress, self));\r\n\r\n      self.formEditProgress.buttonCancel.on(\"click\", $.proxy(self.onClickCancel, self));\r\n      self.formEditProgress.buttonChangeProgress.on(\"click\", $.proxy(self.onSubmitFormChangeProgress, self));\r\n\r\n      self.updateProgressUI(argsTemplate.valuePercentBarComplete);\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", argsTemplate.valuePercentBarComplete);\r\n\r\n   },\r\n\r\n   onNotifyUpdateItemFromRender: function(event, params){\r\n      var self = this;\r\n      var listItems = params.args.items;\r\n      var activityWork = params.args.activityWork;\r\n\r\n      var progress;      \r\n      if(listItems.length > 0){\r\n         //Hide edit progress\r\n         $(\".action-open-popup-edit-progress\", self.content).hide();\r\n      }else{\r\n         $(\".action-open-popup-edit-progress\", self.content).show();\r\n      }\r\n      //set new progress\r\n      $(\".bz-wp-timestamp span\", self.content).text(activityWork);\r\n      $(\".bz-wp-progress-bar\", self.content).css(\"width\", activityWork + \"%\");\r\n\r\n   },\r\n\r\n   updateProgressUI: function(newPercentProgress){\r\n      var self = this,\r\n         $content = self.getContent();\r\n\r\n      $(\".bz-wp-timestamp span\", $content).text(newPercentProgress);\r\n\r\n      //Begin Adjust status bar next to the number days\r\n      var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\r\n      var widthNumberDays = $(\".remaining-days .days\", $content).width();\r\n      $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\r\n\r\n      var $barCompletedDate = $(\".remaining-days .bar-completed\", $content);\r\n\r\n      $barCompletedDate.css(\"width\", newPercentProgress.toString() + \"%\");\r\n      //End Adjust status bar next to the number days\r\n   },\r\n\r\n   initPluginPopupEditProgress: function () {\r\n      var self = this;\r\n      var templatePopupEditProgress = self.getTemplate(\"plan-progress-popup-edit\");\r\n      self.dialogBox.formContent = templatePopupEditProgress.render();\r\n      return self.dialogBox.formContent;\r\n\r\n   },\r\n   /*\r\n    * UI\r\n    */\r\n\r\n   onShowPopupEditProgress: function(){\r\n      var self = this;\r\n\r\n      self.dialogBox.formContent.dialog({\r\n         resizable: false,\r\n         draggable: false,\r\n         height: \"auto\",\r\n         width: \"600px\",\r\n         modal: true,\r\n         title: bizagi.localization.getResource(\"workportal-project-plan-progress-title\"),\r\n         maximize: true,\r\n         open:  $.proxy(self.onOpenPopupPlan, self),\r\n         close: function () {\r\n            self.dialogBox.formContent.dialog(\"destroy\");\r\n            self.dialogBox.formContent.detach();\r\n         }\r\n      });\r\n\r\n      self.previusValueProgress = self.formEditProgress.sliderProgress.slider(\"value\");\r\n\r\n   },\r\n\r\n   onChangeNumericTextBoxProgress: function (event) {\r\n      var self = this;\r\n      var newValue = self.formEditProgress.numericTextBoxPlugin.spinner(\"value\");\r\n      self.formEditProgress.sliderProgress.slider(\"value\", newValue);\r\n   },\r\n\r\n   onChangesliderProgress: function (event) {\r\n      var self = this;\r\n      var newValue = self.formEditProgress.sliderProgress.slider(\"value\");\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", newValue);\r\n   },\r\n\r\n   onClickCancel: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n\r\n      self.dialogBox.formContent.dialog(\"destroy\");\r\n      self.dialogBox.formContent.detach();\r\n      //return before value progress\r\n      self.formEditProgress.sliderProgress.slider(\"value\", self.previusValueProgress);\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", self.previusValueProgress);\r\n   },\r\n\r\n   onSubmitFormChangeProgress: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n\r\n      self.formEditProgress.buttonChangeProgress.prop(\"disabled\", true);\r\n\r\n      var activityToShow = self.params.plan.activities.filter(function(activity){\r\n         return activity.id == self.params.plan.idActivitySelected;\r\n      })[0];\r\n       var params = $.extend(activityToShow, {\r\n           progress:  self.formEditProgress.numericTextBoxPlugin.spinner(\"value\"),\r\n           idPlan: self.params.plan.id\r\n       });\r\n      $.when(self.dataService.editActivityPlan(params)).done(function () {\r\n         self.formEditProgress.buttonChangeProgress.prop(\"disabled\", false);\r\n         activityToShow.progress = self.formEditProgress.numericTextBoxPlugin.spinner(\"value\");\r\n         self.updateProgressUI(activityToShow.progress);\r\n          self.dialogBox.formContent.dialog(\"destroy\");\r\n          self.dialogBox.formContent.detach();\r\n      });\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.progress\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.progress], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Subprocesses Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.subprocesses\", {}, {\r\n      /*\r\n       *   Constructor\r\n       */\r\n      init: function (workportalFacade, dataService, params) {\r\n         var self = this;\r\n\r\n         // Call base\r\n         self._super(workportalFacade, dataService, params);\r\n\r\n         //Load templates\r\n         self.loadTemplates({\r\n            \"project-subprocesses\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.subprocesses\").concat(\"#project-plan-activity-plan-subprocesses-wrapper\"),\r\n            \"project-subprocesses-tootip-custom-properties\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.subprocesses\").concat(\"#project-activity-plan-subprocesses-tooltip-custom-properties-wrapper\")\r\n         });\r\n      },\r\n\r\n      /*\r\n       * Renders the template defined in the widget\r\n       */\r\n      renderContent: function () {\r\n         var self = this;\r\n         self.content = $(\"<div></div>\");\r\n         return self.content;\r\n      },\r\n\r\n      /*\r\n       * links events with handlers\r\n       */\r\n      postRender: function () {\r\n         var self = this;\r\n      }\r\n   }\r\n);\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.subprocesses\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.subprocesses]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Parent\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.parent\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-parent-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.parent\").concat(\"#project-plan-activity-parent\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      var $content = self.getContent().empty();\r\n\r\n         $.when(self.dataService.getPlanParent({idPlan: self.params.plan.id})).done(function (planParent) {\r\n            self.params.plan.parent = planParent;\r\n            if(self.params.plan.parent){\r\n               var argsTemplate = {};\r\n               argsTemplate.parent = {\r\n                  idParent: self.params.plan.parent.radNumber,\r\n                  nameParent: self.params.plan.parent.displayName,\r\n                  idCase: self.params.plan.parent.idCase,\r\n                  idWorkflow: self.params.plan.parent.idWorkflow,\r\n                  idWorkItem: self.params.plan.parent.idWorkItem,\r\n                  idTask: self.params.plan.parent.idTask\r\n               };\r\n\r\n               //Update widget\r\n               var contentTemplate = self.getTemplate(\"plan-parent-main\");\r\n               contentTemplate\r\n                  .render(argsTemplate)\r\n                  .appendTo($content);\r\n\r\n               $(\"#go-to-parent-case\", $content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\r\n            }\r\n         });\r\n\r\n\r\n   },\r\n\r\n   onClickGoToParentCase: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n      self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.parent\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.parent], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Users Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.users\", {}, {\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      self.usersMap = {};\r\n      self.plugins = {};\r\n      self.usersInformation=[];\r\n      self.globalHandlersService = bizagi.injector.get('globalHandlersService');\r\n      self.usersAssignees = [];\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      //The load template the users plan because they are the same\r\n      self.loadTemplates({\r\n         \"plan-users-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.users\").concat(\"#project-plan-users\")\r\n      });\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /*\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n   },\r\n\r\n   /*\r\n    * validate if the activity is running\r\n    */\r\n   activityRuning: function (activity) {\r\n      return activity.startDate !== null && activity.finishDate === null;\r\n   },\r\n\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this,\r\n      cvsGuidUsers = [],\r\n         activitiesUsers = [],\r\n         $content = self.getContent().empty();\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      var ownerUserId = self.params.plan.idUserCreator;\r\n      var ownerUserGuid = self.params.plan.idUserCreator;\r\n\r\n      activitiesUsers.push({ \"idUser\": ownerUserId, \"guidUser\": ownerUserGuid, \"userType\": [\"owner\"] });\r\n      self.usersMap[\"-\" + ownerUserId + \"-\"] = {\r\n         picture: \"\",\r\n         id: ownerUserId,\r\n         guid: ownerUserGuid,\r\n         name: \"\",\r\n         userType: [\"owner\"]\r\n      };\r\n      cvsGuidUsers.push(ownerUserGuid);\r\n      $.each(self.params.plan.activities, function (index, activity) {\r\n         if (self.activityRuning(activity)) {\r\n            var userId = activity.userAssigned;\r\n            var userGuid = activity.userAssignedGuid;\r\n            if (userId === ownerUserId) {\r\n               if($.inArray(\"Assigned\", activitiesUsers[0].userType) === -1){\r\n                  activitiesUsers[0].userType.push(\"Assigned\");\r\n                  self.usersMap[\"-\" + ownerUserId + \"-\"].userType.push(\"Assigned\");\r\n               }\r\n            }\r\n            else {\r\n               self.usersMap[\"-\" + userId + \"-\"] = {\r\n                  picture: \"\",\r\n                  id: userId,\r\n                  name: \"\",\r\n                  userType: [\"Assigned\"]\r\n               };\r\n               if (activitiesUsers.filter(function(user) { return user.idUser == userId; }).length === 0) {\r\n                  var id=userGuid?userGuid:userId;\r\n                  activitiesUsers.push({\"idUser\": id, \"userGuid\": id, \"userType\": [\"Assigned\"]});\r\n                  cvsGuidUsers.push(id);\r\n               }\r\n            }  \r\n         }\r\n      });\r\n      self.activitiesUsers = activitiesUsers;\r\n\r\n      //Update widget\r\n      var contentTemplate = self.getTemplate(\"plan-users-main\");\r\n      contentTemplate\r\n         .render({\r\n            assignee: self.justAssignees(activitiesUsers),\r\n            label: bizagi.localization.getResource(\"workportal-project-plan-assignee\")\r\n         })\r\n         .appendTo($content);\r\n        self.addEventHandlersModal();\r\n      $.when(self.callGetDataUsers(cvsGuidUsers)).then(function () {\r\n         self.showCreatorInformation(ownerUserId);\r\n         self.renderUserProfilesAndImages();\r\n      });\r\n   },\r\n\r\n   /**\r\n    * return standar userAdapter information with only assigned users\r\n    * @param {Array} allUsers \r\n    */\r\n   justAssignees: function (allUsers) {\r\n       var usersAssignee=[];\r\n       allUsers.map(function(user) {\r\n           var isOwner=user.userType.indexOf(\"owner\")!==-1;\r\n           var isAssignee=user.userType.indexOf(\"Assigned\")!==-1;\r\n           usersAssignee.push(usersAdapter.createJsonUserInfo(user.idUser, \"\", \"\", \"\", \"\", \"\", isAssignee, isOwner, [], []));\r\n       });\r\n       return usersAdapter.justAssignees(usersAssignee);\r\n   },\r\n   \r\n   /**\r\n    * show the information of the creator case\r\n    * @param {string} ownerUserId guid user creator\r\n    */\r\n   showCreatorInformation: function (ownerUserId) {\r\n       var self = this;\r\n       var userCreator=self.usersMap[\"-\"+ownerUserId+\"-\"];\r\n       var userInfo = usersAdapter.createJsonUserInfo(\r\n           userCreator.id,\r\n           userCreator.name,\r\n           userCreator.username,\r\n           userCreator.picture?userCreator.picture:undefined,\r\n           userCreator.email,\r\n           userCreator.name.getInitials(),\r\n           false,\r\n           true,\r\n           [],\r\n           []\r\n       );\r\n       self.content.find(\".ui-bizagi-wp-project-plan-users .ui-bizagi-wp-project-users-creator-info\").userinformation(self, { user: userInfo });\r\n   },\r\n\r\n   /**\r\n    * UI\r\n    */\r\n\r\n   renderUserProfilesAndImages: function () {\r\n       var self = this;\r\n       $.each(self.usersMap, function (i, obj) {\r\n           var $li = $(\".ui-bizagi-wp-userlist li[data-iduser=\" + obj.id + \"]\", self.content);\r\n           if (obj.picture !== \"\") {\r\n               $li.find(\"img\").prop(\"src\", obj.picture);\r\n           }\r\n           else {\r\n               $li.find(\"img\").hide();\r\n               if(obj.name!==undefined){\r\n                  $li.find(\"span\").html(obj.name.getInitials());\r\n               }\r\n               else{\r\n                  console.log(\"obj.name is undefined\");\r\n               }\r\n\r\n           }\r\n       });\r\n       $(\".ui-bizagi-wp-userlist li\", self.content).not(\".moreUsers\").on('mouseenter', function (ev) {\r\n         var $target = $(ev.target);  \r\n         var userId = $(this).data(\"iduser\");\r\n         var userSelected;\r\n         $.each(self.usersMap, function (i, obj) {\r\n            if(obj.id === userId)\r\n               userSelected=obj;\r\n        });\r\n         var usersActivities=self.usersAssignees.find(function(assignee) {\r\n            return assignee.userAssigned === userSelected.id;\r\n         });\r\n         var activities=[];\r\n         if(usersActivities)\r\n            usersActivities.activities.map(function(activity) {\r\n               activities.push(activity.name);\r\n            });\r\n         var userParam = usersAdapter.createJsonUserInfo(userSelected.id, userSelected.name, userSelected.username, userSelected.picture, userSelected.email, userSelected.name.getInitials(), self.getIsAssignee(userSelected), self.getIsOwner(userSelected), activities, undefined);\r\n                     \r\n         $target.parent().usertooltip(self,{target:$target,user:userParam});\r\n      });\r\n   },\r\n\r\n   getIsAssignee: function(userSelected){\r\n      if(userSelected.userType.indexOf(\"Assigned\") > -1){\r\n          return true;\r\n      }\r\n      return false;\r\n     },\r\n  \r\n     getIsOwner : function(userSelected){\r\n      if(userSelected.userType.indexOf(\"owner\") > -1){\r\n          return true;\r\n      }\r\n      return false;\r\n     },\r\n   /*\r\n    *  Get data for users\r\n    */\r\n   callGetDataUsers: function (cvsGuidUsers) {\r\n      var self = this,\r\n         params = {},\r\n         defer = $.Deferred();\r\n      params = {\r\n         usersGuids: cvsGuidUsers.join(),\r\n         width: 50,\r\n         height: 50\r\n      };\r\n      $.when(self.dataService.getUsersData(params)).always(function (response) {\r\n        self.usersInformation= response;\r\n         for (var i = 0, length = response.length; i < length; i += 1) {\r\n            if (typeof (response[i].name) === \"undefined\") {\r\n               bizagi.log(response[i] + \" Id Not Found\", response, \"error\");\r\n            } else {\r\n               if(self.usersMap[\"-\" + response[i].id + \"-\"]){\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].picture += (response[i].picture) ? \"data:image/png;base64,\" + response[i].picture : \"\";\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].name = response[i].name || \"\";\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].username = response[i].username || \"\";\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].email = response[i].email || \"\";\r\n               }\r\n               else{\r\n                  console.log(\"The object is undefined\");\r\n               }\r\n            }\r\n         }\r\n         self.getUsersAssignees();\r\n         defer.resolve();\r\n      });\r\n      return defer.promise();\r\n   },\r\n\r\ngetUsersAssignees: function(){\r\n    var self = this;\r\n    for(var i=0; i<self.usersInformation.length; i++){\r\n        self.usersAssignees.push(self.getUserAssignee(self.usersInformation[i]));\r\n    }\r\n\r\n},\r\n\r\ngetUserAssignee: function(user){\r\n    var self =  this;\r\n    var tasks = [];\r\n    $.each(self.params.plan.activities, function (index, activity) {\r\n        var userId = activity.userAssigned;\r\n        if (userId === user.id && self.activityRuning(activity)) {\r\n            tasks.push({ \"name\": activity.name });\r\n        }\r\n    });\r\n    user.tasks = tasks;\r\n    var types = self.activitiesUsers.find(function(actUser) {\r\n        return actUser.idUser == user.id;\r\n    });\r\n    user.userType = types.userType;\r\n\r\n    var userAssignees = usersAdapter.createJsonUserInfo(\r\n        user.id, \r\n        user.name, \r\n        user.username, \r\n        user.picture ? \"data:image/png;base64,\" + user.picture : undefined, \r\n        user.email, \r\n        user.name.getInitials(),\r\n        self.getIsAssignee(user), \r\n        self.getIsOwner(user), \r\n        user.tasks, \r\n        []);\r\n\r\n        return userAssignees;\r\n   },\r\n\r\n   addEventHandlersModal: function () {\r\n    var self =  this;\r\n    $(\".moreUsers\").click(function(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        var usersAssignees = self.usersAssignees || [];\r\n        self.globalHandlersService.publish(\"showDialogWidget\", {\r\n            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL,\r\n            closeVisible: true,\r\n            data: usersAssignees,\r\n            maximize: true,\r\n            modalParameters: {\r\n                title: bizagi.localization.getResource(\"workportal-project-users-title\")+ \" (\"+usersAssignees.length+\")\",\r\n                width: 790,\r\n                height: 526,\r\n                refreshInbox: false\r\n            }\r\n        });\r\n     });\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.users\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.users], true);","/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity Plan\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity.plan\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.plan\").concat(\"#project-dashboard-menu2\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n         self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n\r\n   },\r\n\r\n   /**\r\n    * Update view\r\n    * @param event\r\n    * @param params\r\n    */\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      var argsTemplate = {\r\n         showFormOverview: self.params.menuDashboard.showFormOverview,\r\n         showFormActivity: self.params.menuDashboard.showFormActivity,\r\n         showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu,\r\n         showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\r\n         contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\r\n         contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu,\r\n         contextualized: self.params.plan.contextualized\r\n      };\r\n\r\n      //Update widget\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      template.render(argsTemplate).appendTo($content);\r\n\r\n      if(self.params.showContextByMenuDashboard){\r\n         $(\"li[data-context='\" + event.type.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n      }\r\n\r\n      self.handlerEvents();\r\n\r\n      var paramsGetPlan = {idPlan: self.params.plan.id};\r\n      $.when(self.callGetPlan(paramsGetPlan)).then(function(responsePlan){\r\n         $.extend(self.params.plan, responsePlan);\r\n         self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_PLAN\",\r\n            args: self.params\r\n         });\r\n      });\r\n   },   \r\n\r\n   /**\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if (!$item.hasClass(\"active\")) {\r\n         $.when(bizagi.util.autoSave()).done(function () {\r\n            $(document).data('auto-save', '');\r\n\r\n            var showContextByMenuDashboard = $item.data(\"context\");\r\n            if (showContextByMenuDashboard) {\r\n               var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\"});\r\n               var currentLevelNavigator = parseInt(getLevelNavigator[0]);\r\n               var nameItemNavigator = \"\";\r\n               var newLevelNavigator = currentLevelNavigator;\r\n\r\n               self.params.refreshLastItemBreadcrumb = false;\r\n               self.pub(\"notify\", {\r\n                  type: showContextByMenuDashboard.toUpperCase(),\r\n                  args: $.extend(self.params,{showContextByMenuDashboard: showContextByMenuDashboard,\r\n                     histName: nameItemNavigator,\r\n                     level: newLevelNavigator})\r\n               });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n            }\r\n         });\r\n      }\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n\r\n   callGetPlan: function(params){\r\n      var self = this;\r\n      var defer = $.Deferred();\r\n      self.dataService.getPlan(params).always(function (response) {\r\n         if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n            defer.resolve(response);\r\n         }\r\n         else {\r\n            defer.reject();\r\n         }\r\n      });\r\n\r\n      return defer.promise();\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n       var self = this;\r\n       var content = self.getContent();\r\n       var $comments = $(\"[data-context='ACTIVITYPLANCOMMENTS']\", content);\r\n       var $files = $(\"[data-context='ACTIVITYPLANFILES']\", content);\r\n       var $timeline = $(\"[data-context='ACTIVITYPLANTIMELINE']\", content);\r\n\r\n       $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n           $comments.toggle();\r\n           $files.toggle();\r\n           $timeline.toggle();\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Handler events\r\n    */\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n      self.subMenuHandler();\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\",  $.proxy(self.loadContentById, self));\r\n   },\r\n\r\n   /**\r\n    * Clean widgets and events\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity.plan\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity.plan], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-content-dashboard\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n\r\n      setTimeout(function(){\r\n         $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\r\n      }, 1000);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\r\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\r\n\r\n (function ($) {\r\n\r\n     // shorten references to variables. this is better for uglification \r\n     var kendo = window.kendo,\r\n      ui = kendo.ui,\r\n      Widget = ui.Widget;\r\n\r\n     var ProjectAttachments = Widget.extend({\r\n\r\n         init: function (element, options) {\r\n\r\n             var that = this;\r\n\r\n             // base call to initialize widget\r\n             Widget.fn.init.call(that, element, options);\r\n\r\n             that._maxFilesSize = options.maxSize;\r\n             that._fileList = [];\r\n             that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\r\n             that._supportFileExt = options.extensions;\r\n             that._uploadMaxFilesSize = options.maxSize;\r\n             that.upload = that._initUpload();\r\n             that.loadNotifier = that._initLoadNotifier();\r\n             that.notification = that._initNotification();\r\n\r\n             that._eventsHandler();\r\n\r\n             that._initLocalization(that.options.localization);\r\n         },\r\n\r\n         options: {\r\n             name: \"ProjectAttachments\",\r\n             wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\r\n             multiple: true,\r\n             dropZone: true,\r\n             maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\r\n             enabled: true,\r\n             localization: {}\r\n         },\r\n\r\n         _initUpload: function () {\r\n\r\n             var that = this,\r\n              options = that.options,\r\n              localization = options.localization || {},\r\n              auxNumberFilesSuccess = 0;\r\n\r\n             that._initLocalization(localization);\r\n\r\n             return this.element.kendoUpload({\r\n                 async: {\r\n                     saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\r\n                     autoUpload: true\r\n                 },\r\n                 select: function (event) {\r\n                     that._filterMaxFilesSize(event);\r\n                     auxNumberFilesSuccess = 0;\r\n                 },\r\n                 complete: function(){\r\n                     var interval = setInterval(function(){\r\n                        if( that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0){\r\n                            that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\r\n                            clearInterval(interval);\r\n                        }\r\n                     }, 300);\r\n                 },\r\n                 upload: options.upload,\r\n                 progress: function (event) {\r\n                     that._onProgressFile(event);\r\n                 },\r\n                 success: function (event) {\r\n                     that._fileList.push(event.files[0]);\r\n                     auxNumberFilesSuccess += 1;\r\n                     options.success(event);\r\n                 },\r\n                 error: function (event) {\r\n                     that.onErrorFile(event);\r\n                 },\r\n                 localization: {\r\n                     select: localization.selectFiles,\r\n                     dropFilesHere: localization.dropFilesHere\r\n                 },\r\n                 multiple: options.multiple,\r\n                 enabled: options.enabled,\r\n                 dropZone: options.dropZone,\r\n                 showFileList: false\r\n             }).data(\"kendoUpload\");\r\n\r\n         },\r\n\r\n         _initNotification: function(){\r\n             return $(\"<div></div>\").kendoNotification({\r\n                 position: {\r\n                     pinned: true\r\n                 }\r\n             }).data(\"kendoNotification\");\r\n         },\r\n\r\n         _initLoadNotifier: function () {\r\n\r\n             var that = this,\r\n                    localization = that.options.localization,\r\n                    $wrapper = that.options.wrapper;\r\n\r\n             return $wrapper.kendoWindow({\r\n                 title: localization.notifierTitle,\r\n                 actions: [\"Close\"],\r\n                 animation: {\r\n                     open: {\r\n                         duration: 100\r\n                     },\r\n                     close: {\r\n                         duration: 100\r\n                     }\r\n                 },\r\n                 open: function() {\r\n                     this.wrapper.addClass(\"project-attachments-wrapper-window\");\r\n                 },\r\n                 visible: false,\r\n                 resizable: false,\r\n                 draggable: false,\r\n                 maxHeight: \"300px\",\r\n                 minWidth: \"430px\"\r\n             }).data(\"kendoWindow\");\r\n\r\n         },\r\n\r\n         _initLocalization: function(objectOptionsLocalization){\r\n             var that = this;\r\n             var optionsLocalizationByDefault = {\r\n                 selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\r\n                 notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\r\n                 errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error-type\"),\r\n                 errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\r\n                 errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\r\n                 errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", (Math.round(that._maxFilesSize/1000000, -1))),\r\n                 dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\r\n                 cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\r\n                 retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\r\n                 close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\")\r\n             };\r\n\r\n             $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\r\n         },\r\n\r\n         _onProgressFile: function (event) {\r\n\r\n             var that = this;\r\n             var $file = that._getFileItemByUID(event.files[0].uid);\r\n             var percent = event.percentComplete;\r\n\r\n             $(\".k-progress\", $file).css({\r\n                 width: percent + \"%\"\r\n             });\r\n\r\n             $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\r\n\r\n             if (percent === 100){ $(\".k-upload-action .k-icon\", $file).hide(); }\r\n         },\r\n\r\n         _onShowUploadNotifier: function (event) {\r\n\r\n             var that = this,\r\n                files = event.files,\r\n                template = that.options.template;\r\n\r\n             that.loadNotifier.content(template.render({ files: files }));\r\n             that.loadNotifier.wrapper.css({\r\n                 top: \"auto\",\r\n                 left: \"auto\",\r\n                 bottom: \"1em\",\r\n                 right: \"1em\"\r\n             });\r\n\r\n             that.loadNotifier.open();\r\n         },\r\n\r\n        _showNotificationCompleteUpload: function(wrapperMessage, auxNumberFilesSuccess){\r\n            var that = this;\r\n            if( wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\r\n            {\r\n                that._autoHideMessage(wrapperMessage);\r\n            }\r\n        },\r\n\r\n         _autoHideMessage: function(wrapperMessage){\r\n             var that = this;\r\n             setTimeout(function(){\r\n                 wrapperMessage.fadeOut(function(){\r\n                     that.loadNotifier.close();\r\n                 });\r\n             }, 2000);\r\n         },\r\n\r\n         _onCancelFile: function ($target) {\r\n             var that = this,\r\n                 $fileWrapper = $target.closest(\"li\"),\r\n                 $uploadWrapper = that.upload.wrapper,\r\n                 guid = $fileWrapper.data(\"guid\");\r\n\r\n             $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRemoveFile: function ($target) {\r\n             var $fileWrapper = $target.closest(\"li\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRetryFile: function ($target) {\r\n             var that = this;\r\n             var $file = $target.closest(\"li\");\r\n             var guid = $file.data(\"guid\");\r\n             var file = $.grep(that._fileList, function (i) {\r\n                 return i.uid === guid;\r\n             });\r\n\r\n             that.options.retry(file[0]);\r\n         },\r\n\r\n         onErrorFile: function (event) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             file = event.files[0],\r\n             validation = that._isValidFile(file);\r\n             var message = (validation.message !== \"\") ? validation.message : localization.errorUpload;\r\n\r\n             that.setStatus(\"ERROR\", file.uid, message);\r\n         },\r\n\r\n         _isValidFile: function (file) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             valid = true,\r\n             message = \"\";\r\n\r\n             if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0 ) {\r\n                 message = localization.errorSize;\r\n                 valid = false;\r\n             }\r\n\r\n             if(!that._onlyValidateServerFileExtension){\r\n                 if ($.inArray(file.extension, that._supportFileExt) === -1) {\r\n                     message = localization.errorSecurity;\r\n                     valid = false;\r\n                 }\r\n             }\r\n\r\n             return {\r\n                 valid: valid,\r\n                 message: message\r\n             };\r\n         },\r\n\r\n         _filterMaxFilesSize: function (event) {\r\n            \r\n            var that = this;\r\n            var total = 0;\r\n\r\n            for (var i = 0, length = event.files.length; i < length; i++){\r\n                total += event.files[i].size;\r\n            }\r\n            if (total > that._maxFilesSize) {\r\n                that._notifySizeExceeded();\r\n                event.preventDefault();\r\n            } else {\r\n                that._onShowUploadNotifier(event);\r\n            }\r\n         },\r\n\r\n         _notifySizeExceeded: function(){\r\n         \r\n             var that = this;\r\n\r\n             that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\r\n         },\r\n\r\n         _getFileItemByUID: function (uid) {\r\n             var that = this;\r\n             return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\r\n         },\r\n\r\n         _switchEvents: function (event) {\r\n             var that = this;\r\n             var $target = $(\".k-icon\", event.currentTarget);\r\n             if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\r\n                 that._onRemoveFile($target);\r\n             } else if ($target.hasClass(\"k-retry\")) {\r\n                 that._onRetryFile($target);\r\n             } else if ($target.hasClass(\"k-cancel\")) {\r\n                 that._onCancelFile($target);\r\n             }\r\n         },\r\n\r\n         _eventsHandler: function () {\r\n             var that = this;\r\n\r\n             that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\r\n                 that._switchEvents(event);\r\n             });\r\n         },\r\n\r\n         cancelFilesUpload: function(){\r\n             var that = this;\r\n             var $uploadWrapper = that.upload.wrapper;\r\n\r\n             $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\r\n             that.close();\r\n         },\r\n\r\n         close: function () {\r\n             this.loadNotifier.close();\r\n         },\r\n\r\n         destroy: function () {\r\n             this.loadNotifier.destroy();\r\n             this.upload.destroy();\r\n         },\r\n\r\n         setStatus: function (status, uid, message) {\r\n\r\n             var $file = this._getFileItemByUID(uid),\r\n                 localization = this.options.localization;\r\n\r\n             switch (status) {\r\n                 case \"SUCCESS\":\r\n                     $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\r\n                     $(\".k-errormsg\", $file).text(\"\");\r\n                     break;\r\n                 case \"ERROR\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\r\n                     $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\r\n                     break;\r\n                 case \"RETRY\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\r\n                     $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\r\n                     break;\r\n             }\r\n         }\r\n\r\n     });\r\n\r\n     ui.plugin(ProjectAttachments);\r\n })(jQuery);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Discussions Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.discussions\", {}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, notifier, params) {\r\n\r\n        var self = this;\r\n\r\n        self.typeResource = \"DiscussionGuid\";\r\n        self.plugins = {};\r\n        self.dialogBoxDiscussion = {};\r\n        self.attchComments = {};\r\n        self.attchDiscussions = {\r\n            remove: [],\r\n            addition: []\r\n        };\r\n        self.listDataDiscussion = [];\r\n        self.userPictures = [];\r\n        self.commentsList = {};\r\n\r\n        self.globalTags = [];\r\n\r\n        self.tempTagsBeforeDelete = [];\r\n        self.tempTagsToDelete = [];\r\n        self.keySentenceAddTag = bizagi.localization.getResource(\"workportal-project-discussion-add-new-tag\") + \": \";\r\n        self.notifier = notifier;\r\n\r\n\r\n        //Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-discussions\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-wrapper\"),\r\n            \"project-discussions-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-popup-wrapper\"),\r\n            \"project-discussions-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-list-wrapper\"),\r\n            \"project-discussions-comments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-comments-list\"),\r\n            \"project-discussions-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-attachments-list\"),\r\n            \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\")\r\n        });\r\n\r\n    },\r\n\r\n    /*\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var templateHomeDiscussions = self.getTemplate(\"project-discussions\");\r\n\r\n        self.content = templateHomeDiscussions.render({});\r\n        return self.content;\r\n    },\r\n\r\n    /*\r\n     * Post render and links events with handlers\r\n     */\r\n    postRender: function () {\r\n\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        self.plugins.popupDiscussion = self.initPluginPopupDiscussion();\r\n        var popupDiscussion = self.plugins.popupDiscussion;\r\n\r\n        //reference for html elements\r\n        self.form = {\r\n            buttonShowFormNewDiscussion: $(\".ui-bizagi-wp-action-new\", $contentWidget),\r\n            title: $(\".ui-bizagi-wp-project-popupform-h4\", popupDiscussion),\r\n            subject: $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", popupDiscussion),\r\n            description: $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", popupDiscussion),\r\n            buttonShowPopupDiscussionToAdd: $(\"#ui-bizagi-wp-project-discussions-button-action-show-popup-to-add\", $contentWidget),\r\n            buttonAddDiscussion: $(\"#ui-bizagi-wp-project-discussions-popup-action-add-discussion\", popupDiscussion),\r\n            buttonCancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", popupDiscussion),\r\n            formDiscussion: $(\".ui-bizagi-wp-project-discussions-popup\", popupDiscussion),\r\n            attachments: $(\".ui-bizagi-wp-project-discussions-attachments-cmnwrapper\", popupDiscussion),\r\n            edition: false\r\n        };\r\n\r\n        self.plugins.tagsFilter = self.initPluginTagsFilter();\r\n\r\n        self.plugins.tagsMultiSelect = self.initPluginTagsMultiSelect(popupDiscussion);\r\n\r\n        //Load discussions\r\n        self.getDiscussions();\r\n        self.eventsHandler();\r\n        self.restrictedEventsHandler();\r\n    },\r\n\r\n    getDiscussions: function(){\r\n        var self = this;\r\n\r\n        self.getDataDiscussions().done(function () {\r\n\r\n            var idUsersCreatedDiscussions = $.map(self.listDataDiscussion, function (element) {\r\n                return element.user;\r\n            });\r\n\r\n            var idUsersCreatedComments = $.map(self.commentsList, function (property) {\r\n                return $.map(property.comments, function (property) {\r\n                    return property.user;\r\n                });\r\n            });\r\n\r\n            function removeDuplicateItemsFromArray(a) {\r\n                var seen = {};\r\n                var out = [];\r\n                var len = a.length;\r\n                var j = 0;\r\n                for (var i = 0; i < len; i++) {\r\n                    var item = a[i];\r\n                    if (seen[item] !== 1) {\r\n                        seen[item] = 1;\r\n                        out[j++] = item;\r\n                    }\r\n                }\r\n                return out;\r\n            }\r\n\r\n            var csvGuidUsers = removeDuplicateItemsFromArray(idUsersCreatedDiscussions.concat(idUsersCreatedComments).concat(bizagi.currentUser.idUser)).join(\",\");\r\n\r\n            self.getDataUsers(csvGuidUsers).then(function () {\r\n                self.renderUserProfilesAndImages();\r\n            });\r\n\r\n            self.setClassesTagsByDiscussion();\r\n\r\n        });\r\n        \r\n    },\r\n\r\n    /*\r\n     * Notifies when an event is raised\r\n     */\r\n    onNotifyOpenPopup: function () {\r\n        var self = this;\r\n\r\n        self.form.edition = false;\r\n        self.showFormAddDiscussion(\"workportal-project-discussion-adddiscussion\");\r\n        self.renderUserProfile();\r\n    },\r\n\r\n    /*\r\n     * Init plugins\r\n     */\r\n    initPluginPopupDiscussion: function () {\r\n        var self = this;\r\n        var templatePopupDiscussion = self.getTemplate(\"project-discussions-popup\");\r\n        self.dialogBoxDiscussion.formContent = templatePopupDiscussion.render({attachments: []});\r\n        return self.dialogBoxDiscussion.formContent;\r\n    },\r\n\r\n\r\n    initPluginTagsMultiSelect: function (popupDiscussion) {\r\n        var self = this;\r\n        var tags = [];\r\n        var categoriesMultiSelect = popupDiscussion.find(\"#ui-bizagi-wp-project-discussions-options-multiselect-tags\");\r\n        var newitemtext;\r\n        var isDelete = false;\r\n        var createNewTag = false;\r\n        return categoriesMultiSelect.kendoMultiSelect({\r\n            change: function () {\r\n                var valuesSelected = this.value().slice(0);\r\n\r\n                var dataitems = this.dataSource.data();\r\n                if (valuesSelected.length > 0) {\r\n                    if (dataitems[0].tag.replace(self.keySentenceAddTag, \"\").indexOf(valuesSelected[valuesSelected.length - 1]) !== -1) {\r\n                        //fix because the value dont complete by millisecond\r\n                        valuesSelected[valuesSelected.length - 1] = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\r\n                    }\r\n                }\r\n\r\n\r\n                valuesSelected = valuesSelected.filter(Boolean); //Remove empty items\r\n\r\n                //remove duplicate items\r\n                valuesSelected = valuesSelected.filter(function (value, pos, self) {\r\n                    return self.indexOf(value) === pos;\r\n                });\r\n\r\n                var newtag = \"\";\r\n\r\n                if (dataitems.length > 0) {\r\n                    if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\r\n                        newtag = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\r\n\r\n                        var dataItemAddNew = {};\r\n                        if (valuesSelected.indexOf(newtag) !== -1) {\r\n                            dataItemAddNew = this.dataSource.at(0);\r\n                            isDelete = true;\r\n                            this.dataSource.remove(dataItemAddNew);\r\n                            isDelete = false;\r\n                            this.refresh();\r\n                            createNewTag = true;\r\n                        }\r\n                        else {\r\n                            if (newtag) {\r\n                                if ($(\"li:first\", this.list).hasClass(\"k-state-focused\")) {\r\n                                    createNewTag = true;\r\n                                    valuesSelected.push(newtag);\r\n                                }\r\n                                dataItemAddNew = this.dataSource.at(0);\r\n                                isDelete = true;\r\n                                this.dataSource.remove(dataItemAddNew);\r\n                                isDelete = false;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                if (newtag) {\r\n                    if (createNewTag) {\r\n                        var existInDatasource = this.dataSource.data().filter(function (itemData) {\r\n                            return itemData.tag === newtag;\r\n                        });\r\n                        if (existInDatasource.length === 0) {\r\n                            this.dataSource.add({guid: newtag, tag: newtag});\r\n                        }\r\n                        createNewTag = false;\r\n                    }\r\n                }\r\n                this.dataSource.filter({});\r\n                this.value(valuesSelected);\r\n\r\n            },\r\n            dataBound: function () {\r\n                if ((newitemtext || this._prev) && newitemtext !== this._prev && !isDelete) {\r\n                    newitemtext = this._prev;\r\n\r\n                    var dataitems = this.dataSource.data();\r\n\r\n                    var isfound = false;\r\n                    if (dataitems.length > 0) {\r\n                        if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\r\n                            dataitems[0].tag = self.keySentenceAddTag + newitemtext;\r\n                            this.refresh();\r\n                            isfound = true;\r\n                            $(\"li\", this.list).removeClass(\"k-state-focused\");\r\n                            $(\"li:first\", this.list).addClass(\"k-state-focused\");\r\n                        }\r\n                    }\r\n\r\n                    if (!isfound) //Is found item with text \"Add new tag:\" ?\r\n                    {\r\n                        this.dataSource.insert(0, {tag: self.keySentenceAddTag + newitemtext, guid: newitemtext});\r\n                    }\r\n\r\n                    if (this.dataSource.total() == 0) {\r\n                        this.search();\r\n                        this.open();\r\n                        this.refresh();\r\n                        $(\"li\", this.list).removeClass(\"k-state-focused\");\r\n                        $(\"li:first\", this.list).addClass(\"k-state-focused\");\r\n                    }\r\n                }\r\n            },\r\n            dataSource: tags,\r\n            dataTextField: \"tag\",\r\n            dataValueField: \"guid\",\r\n            filter: \"contains\",\r\n            animation: false\r\n        }).data(\"kendoMultiSelect\");\r\n    },\r\n\r\n    initPluginTagsFilter: function () {\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n        return $(\"#ui-bizagi-wp-project-discussions-options-tags-filter\", $contentWidget).kendoMultiSelect({\r\n            change: function () {\r\n                self.hideOrShowDiscussionsByFilter();\r\n            },\r\n            autoClose: false,\r\n            tagMode: \"single\",\r\n            dataTextField: \"tag\",\r\n            dataValueField: \"guid\"\r\n        }).data(\"kendoMultiSelect\");\r\n    },\r\n\r\n    hideOrShowDiscussionsByFilter: function () {\r\n        var self = this;\r\n        var valuesSelected = self.plugins.tagsFilter.value();\r\n        if (valuesSelected.length > 0) {\r\n            $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).hide();\r\n            valuesSelected.forEach(function (valueClass) {\r\n                $(\".ui-bizagi-wp-project-discussions-item.\" + valueClass, self.getContent()).show();\r\n            });\r\n        }\r\n        else {\r\n            $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).show();\r\n        }\r\n    },\r\n\r\n    validateAddCommentForm: function($wrapperForm){\r\n        var result = false;\r\n        var $textAreaComment = $(\"textarea\", $wrapperForm);\r\n        if($textAreaComment.val().trim() === \"\"){\r\n            var commentValidation = bizagi.localization.getResource(\"workportal-project-discussion-requiredcomment\");\r\n            $textAreaComment.parent().next().find('span').html(commentValidation);\r\n        }\r\n        else{\r\n            $textAreaComment.parent().next().find('span').empty();\r\n            result = true;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    validateAddDiscussionForm: function($wrapperForm){\r\n        var result = false;\r\n        var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", $wrapperForm);\r\n        var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", $wrapperForm);\r\n        if($subjectDiscussion.val().trim() !== \"\" && $descriptionDiscussion.val().trim() !== \"\"){\r\n            result = true;\r\n        }\r\n        if($subjectDiscussion.val().trim() === \"\"){\r\n            var subjectValidation = bizagi.localization.getResource(\"workportal-project-discussion-subjectrequired\");\r\n            $subjectDiscussion.parent().find(\"span\").html(subjectValidation);\r\n        }\r\n        else{\r\n            $subjectDiscussion.parent().find(\"span\").empty();\r\n        }\r\n        if($descriptionDiscussion.val().trim() === \"\"){\r\n            var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\r\n            $descriptionDiscussion.parent().next().find(\"span\").html(descriptionValidation);\r\n        }\r\n        else{\r\n            $descriptionDiscussion.parent().next().find(\"span\").empty();\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    applyFileAttachments: function (type) {\r\n\r\n        var self = this;\r\n        var content = (type === \"DISCUSSIONS\") ? self.plugins.popupDiscussion : self.getContent();\r\n\r\n        return $(\".ui-bizagi-wp-project-discussions-attachment-upload\", content).kendoProjectAttachments({\r\n            saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\r\n            template: self.getTemplate(\"project-attachments\"),\r\n            success: function (event) {\r\n                self.onSuccessFile(event, type);\r\n            },\r\n            upload: $.proxy(self.addFileData, self),\r\n            dropZone: false,\r\n            extensions: self.supportFileExt,\r\n            maxSize: self.uploadMaxFilesSize\r\n        }).data(\"kendoProjectAttachments\");\r\n    },\r\n\r\n    addFileData: function (event) {\r\n\r\n        var uid = event.files[0].uid;\r\n\r\n        event.files[0].guid = uid;\r\n        event.data = {\r\n            guid: uid\r\n        };\r\n    },\r\n\r\n\r\n    /*\r\n     *  Get data for discussions\r\n     */\r\n    getDataDiscussions: function () {\r\n\r\n        var self = this,\r\n            defer = $.Deferred();\r\n\r\n        var paramsGetDiscussions = {\r\n            globalParent: self.radNumber,\r\n            typeResource: self.typeResource\r\n        };\r\n\r\n        if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\r\n            paramsGetDiscussions.globalParent = self.params.plan.id;\r\n        }\r\n\r\n        self.dataService.getDiscussionsData(paramsGetDiscussions).pipe(function (response) {\r\n            return self.callForListComments(response);\r\n        }).done(function (response) {\r\n            self.listDataDiscussion = self.sortDiscussions(response);\r\n            self.updateTemplateListDiscussion();\r\n            defer.resolve();\r\n        });\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n     *  Get data for users\r\n     */\r\n    getDataUsers: function (usersGuids) {\r\n        var self = this,\r\n            defer = $.Deferred();\r\n\r\n        var params = {\r\n            usersGuids: usersGuids,\r\n            width: 50,\r\n            height: 50\r\n        };\r\n\r\n        if(params.usersGuids){\r\n            self.dataService.getUsersData(params).always(function (response) {\r\n\r\n                function arrayUnique(array) {\r\n                    var a = array.concat();\r\n                    for (var i = 0; i < a.length; ++i) {\r\n                        for (var j = i + 1; j < a.length; ++j) {\r\n                            if (a[i] === a[j]) {\r\n                                a.splice(j--, 1);\r\n                            }\r\n                        }\r\n                    }\r\n                    return a;\r\n                }\r\n\r\n                self.userPictures = arrayUnique(self.userPictures.concat(response));\r\n                defer.resolve();\r\n            });\r\n        }\r\n        else{\r\n            defer.resolve();\r\n        }\r\n\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n     * Call list of comments by discussion\r\n     */\r\n    callForListComments: function (discussions) {\r\n\r\n        var self = this,\r\n            generalDefer = $.Deferred(),\r\n            commentsDefer = [];\r\n\r\n        for (var i = 0, length = discussions.length - 1; i <= length; i++) {\r\n\r\n            self.addGlobalTags(discussions[i].tags, false);\r\n\r\n            var params = {\r\n                idParent: discussions[i].guid,\r\n                dateTime: self.getDateServer(),\r\n                count: 6\r\n            };\r\n\r\n            self.commentsList[params.idParent] = {\r\n                comments: [],\r\n                count: 0,\r\n                total: 0\r\n            };\r\n\r\n            var defer = $.when(self.dataService.getCommentsData(params)).done(function (response) {\r\n                if (response.length > 0) {\r\n                    self.commentsList[response[0].parent] = {\r\n                        comments: response,\r\n                        count: response.length,\r\n                        total: 0\r\n                    };\r\n                }\r\n            });\r\n\r\n            commentsDefer.push(defer);\r\n        }\r\n\r\n        $.when.apply($, commentsDefer).done(function () {\r\n            generalDefer.resolve(discussions);\r\n        });\r\n\r\n        return generalDefer.promise();\r\n    },\r\n\r\n    sortDiscussions: function (discussions) {\r\n        var sortedDiscussion = [];\r\n        if (discussions.length) {\r\n            sortedDiscussion = discussions.sort(function (a, b) {\r\n                var dateA = a.date;\r\n                var dateB = b.date;\r\n\r\n                return (dateB - dateA);\r\n            });\r\n\r\n            if (sortedDiscussion.length > 0) {\r\n                sortedDiscussion.unshift(sortedDiscussion.pop());\r\n            }\r\n        }\r\n        return sortedDiscussion;\r\n    },\r\n\r\n    resetDiscussionAttachments: function () {\r\n\r\n        var self = this;\r\n        var popupDiscussion = self.plugins.popupDiscussion;       \r\n        $(\".ui-bizagi-wp-project-attachments-list\", popupDiscussion).empty();\r\n\r\n        self.plugins.tagsMultiSelect.value([]);\r\n        \r\n        self.attchDiscussions.addition = [];\r\n        self.attchDiscussions.remove = [];\r\n        self.getDiscussions();       \r\n    },\r\n\r\n    sendDataUpdateDiscussion: function (guid) {\r\n\r\n        var self = this;\r\n        var filesObj = self.prepareFilesToSave();\r\n        self.form.buttonAddDiscussion.prop(\"disabled\", true);\r\n\r\n        var tagsDiscussion = self.getTagsDiscussionBySave();\r\n        var guidsTagsDiscussionToDelete = self.getGuidsTagsDiscussionToDelete();\r\n\r\n        var params = {\r\n            content: {\r\n                name: self.form.subject.val(),\r\n                description: self.form.description.val(),\r\n                globalParent: self.radNumber.toString(),\r\n                user: bizagi.currentUser.idUser,\r\n                attachments: filesObj.attachments,\r\n                guid: guid,\r\n                tags: tagsDiscussion,\r\n                typeResource: \"DiscussionGuid\",\r\n                general: false,\r\n                date: self.getDateServer()\r\n            },\r\n            attachmentsToCreate: filesObj.attachmentsToCreate,\r\n            attachmentsToDelete: filesObj.attachmentsToDelete\r\n        };\r\n\r\n        self.plugins.attchDiscussions.close();\r\n\r\n        self.dataService.editDiscussion(params).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                self.addGlobalTags(tagsDiscussion, true);\r\n\r\n                var discussion = self.getDiscussionDataByGUID(guid);\r\n                discussion.name = params.content.name;\r\n                discussion.description = params.content.description;\r\n                discussion.attachments = params.content.attachments;\r\n                discussion.tags = params.content.tags;\r\n\r\n                self.onClosePopupDiscussion();\r\n\r\n                self.resetDiscussionAttachments();\r\n                self.updateTemplateListDiscussion();\r\n\r\n                self.removeGlobalTags(guidsTagsDiscussionToDelete);\r\n\r\n                self.notifier.showSucessMessage(\r\n                    printf(bizagi.localization.getResource(\"workportal-project-discussion-edited\"), \"\"));\r\n            } else {\r\n\r\n                self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n\r\n                self.onClosePopupDiscussion();\r\n                self.notifier.showErrorMessage(\r\n                   printf(bizagi.localization.getResource(\"workportal-project-discussion-error-edition\"), \"\"));\r\n            }\r\n\r\n\r\n            self.renderUserProfilesAndImages();\r\n\r\n            self.setClassesTagsByDiscussion();\r\n            self.hideOrShowDiscussionsByFilter();\r\n        });\r\n\r\n    },\r\n    validateStringIsGuid: function (value) {\r\n        var validGuid = /^({|()?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}(}|))?$/;\r\n        var emptyGuid = /^({|()?0{8}-(0{4}-){3}0{12}(}|))?$/;\r\n        return validGuid.test(value) && !emptyGuid.test(value);\r\n    },\r\n\r\n    sendDataInsertDiscussion: function (guid) {\r\n\r\n        var self = this;\r\n        var filesObj = self.prepareFilesToSave();\r\n\r\n        self.form.buttonAddDiscussion.prop(\"disabled\", true);\r\n\r\n        var tagsDiscussion = self.getTagsDiscussionBySave();\r\n\r\n        var params = {\r\n            content: {\r\n                name: self.form.subject.val(),\r\n                description: self.form.description.val(),\r\n                globalParent: self.radNumber.toString(),\r\n                user: bizagi.currentUser.idUser,\r\n                attachments: filesObj.attachments,\r\n                guid: guid,\r\n                tags: tagsDiscussion,\r\n                typeResource: \"DiscussionGuid\",\r\n                general: false,\r\n                date: self.getDateServer()\r\n            },\r\n            attachmentsToCreate: filesObj.attachmentsToCreate,\r\n            attachmentsToDelete: filesObj.attachmentsToDelete\r\n        };\r\n\r\n        self.plugins.attchDiscussions.close();\r\n\r\n        self.dataService.postDiscussion(params).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n\r\n                self.addGlobalTags(tagsDiscussion, true);\r\n\r\n                self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n\r\n                var newDiscussion = {\r\n                    \"name\": params.content.name,\r\n                    \"description\": params.content.description,\r\n                    \"date\": params.content.date,\r\n                    \"user\": params.content.user,\r\n                    \"attachments\": params.content.attachments,\r\n                    \"radNumber\": params.content.globalParent,\r\n                    \"general\": params.content.general,\r\n                    \"guid\": params.content.guid,\r\n                    \"tags\": params.content.tags,\r\n                    \"typeResource\": params.content.typeResource\r\n                };\r\n\r\n                self.commentsList[params.content.guid] = {\r\n                    comments: [],\r\n                    count: 0,\r\n                    total: 0\r\n                };\r\n\r\n                if (self.listDataDiscussion.length === 0) {//Add first discussion\r\n                    self.listDataDiscussion.push(newDiscussion);\r\n                }\r\n                else {//Add discussion in position 1\r\n                    self.listDataDiscussion.splice(1, 0, newDiscussion);\r\n                }\r\n\r\n                self.resetDiscussionAttachments();\r\n                self.onClosePopupDiscussion();\r\n                self.notifier.showSucessMessage(\r\n                   printf(bizagi.localization.getResource(\"workportal-project-discussion-created\"), \"\"));\r\n                self.updateTemplateListDiscussion();\r\n\r\n\r\n            }\r\n            else {\r\n                self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n                self.onClosePopupDiscussion();\r\n                self.notifier.showErrorMessage(\r\n                   printf(bizagi.localization.getResource(\"workportal-project-discussion-error-creation\"), \"\"));\r\n            }\r\n\r\n            self.renderUserProfilesAndImages();\r\n\r\n            self.setClassesTagsByDiscussion();\r\n            self.hideOrShowDiscussionsByFilter();\r\n        });\r\n    },\r\n\r\n    getTagsDiscussionBySave: function () {\r\n        var self = this;\r\n        var tagsTextSelected = self.plugins.tagsMultiSelect.value();\r\n        var dataSourceTags = self.plugins.tagsMultiSelect.dataSource.data();\r\n\r\n        var tagsDiscussion = [];\r\n        tagsTextSelected.forEach(function (tagTextSelected) {\r\n            var isGuidTextSelected = self.validateStringIsGuid(tagTextSelected);\r\n\r\n            var tagFound;\r\n            if (isGuidTextSelected) {\r\n                tagFound = dataSourceTags.filter(function (tagSource) {\r\n                    return tagSource.guid === tagTextSelected;\r\n                });\r\n            }\r\n            else {\r\n                tagFound = dataSourceTags.filter(function (tagSource) {\r\n                    var isGuid = self.validateStringIsGuid(tagSource.guid);\r\n                    return tagSource.tag === tagTextSelected && !isGuid;\r\n                });\r\n            }\r\n\r\n            if (tagFound.length === 1) {\r\n                tagsDiscussion.push({\r\n                    guid: isGuidTextSelected ? tagFound[0].guid : tagFound[0].uid,\r\n                    tag: tagFound[0].tag\r\n                });\r\n            }\r\n\r\n        });\r\n\r\n        return tagsDiscussion;\r\n    },\r\n\r\n    //b: minuendo, a: sustraendo\r\n    differenceArrays: function (b, a) {\r\n        return b.filter(function (i) {\r\n            return a.indexOf(i) < 0;\r\n        });\r\n    },\r\n\r\n    getGuidsTagsDiscussionToDelete: function () {\r\n        var self = this;\r\n        var guidsTagsCurrentDiscussion = self.plugins.tagsMultiSelect.value();\r\n        return self.differenceArrays(self.tempTagsBeforeDelete, guidsTagsCurrentDiscussion);\r\n    },\r\n\r\n    /*\r\n     *   UI Functions\r\n     */\r\n    setStateUIShowMoreComments: function ($commentsContainer, state) {\r\n        var $containerButtonMoreComments = $commentsContainer.siblings(\".ui-bizagi-wp-project-discussion-showmore-comments\");\r\n        var $buttonShowMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-comments-button\");\r\n        var $messageNoMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-no-more-comments\");\r\n        var $messageLoadingComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-loading-comments\");\r\n\r\n        if (state === \"ALLOW_MORE_COMMENTS\") {\r\n            $buttonShowMoreComments.show();\r\n            $messageNoMoreComments.hide();\r\n            $messageLoadingComments.hide();\r\n        }\r\n\r\n        if (state === \"LOADING_MORE_COMMENTS\") {\r\n            $buttonShowMoreComments.hide();\r\n            $messageNoMoreComments.hide();\r\n            $messageLoadingComments.show();\r\n        }\r\n\r\n        if (state === \"NO_MORE_COMMENTS\") {\r\n            $buttonShowMoreComments.hide();\r\n            $messageNoMoreComments.show();\r\n            $messageLoadingComments.hide();\r\n        }\r\n    },\r\n\r\n    getCurrentUserInfo: function () {\r\n        return {\r\n            name: bizagi.currentUser.userName,\r\n            id: bizagi.currentUser.idUser,\r\n            picture: \"\"\r\n        };\r\n    },\r\n\r\n    /*Functions about tags*/\r\n\r\n    addGlobalTags: function (tagsDiscussion, createTagsOnServer) {\r\n        var self = this;\r\n\r\n        for (var iTagAdd = 0; iTagAdd < tagsDiscussion.length; iTagAdd += 1) {\r\n            var existTag = self.globalTags.filter(function (tagGlobal) {\r\n                return tagGlobal.tag === tagsDiscussion[iTagAdd].tag;\r\n            });\r\n            if (existTag.length === 0) {\r\n                tagsDiscussion[iTagAdd].globalParent = self.radNumber;\r\n                self.globalTags.push(tagsDiscussion[iTagAdd]);\r\n                if (createTagsOnServer) {\r\n                    self.dataService.postTag(tagsDiscussion[iTagAdd]);\r\n                }\r\n            }\r\n        }\r\n\r\n        //Sync tags\r\n        self.plugins.tagsFilter.dataSource.data(self.globalTags);\r\n        self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\r\n    },\r\n\r\n    removeGlobalTags: function (guidTagsToDelete) {\r\n        var self = this;\r\n        var allGuidsTagsAllDiscussions = $.map(self.listDataDiscussion, function (discussion) {\r\n            return $.map(discussion.tags, function (itemTag) {\r\n                return itemTag.guid;\r\n            });\r\n        });\r\n\r\n        var allGuidsMoreGuidsDelete = allGuidsTagsAllDiscussions.concat(guidTagsToDelete);\r\n\r\n        var secureGuidsForDelete = [];\r\n        guidTagsToDelete.forEach(function (guidDelete) {\r\n            var existGuidOnlyTimeThenDelete = allGuidsMoreGuidsDelete.filter(function (guid) {\r\n                return guid === guidDelete;\r\n            });\r\n            if (existGuidOnlyTimeThenDelete.length === 1) {\r\n                secureGuidsForDelete.push(guidDelete);\r\n            }\r\n        });\r\n\r\n\r\n        secureGuidsForDelete.forEach(function (guidSecureDelete) {\r\n            //delete with service\r\n            var params = {idTag: guidSecureDelete};\r\n            self.dataService.deleteTag(params);\r\n\r\n            //delete globalTags\r\n            for (var iTagGlobal = self.globalTags.length - 1; iTagGlobal >= 0; iTagGlobal -= 1) {\r\n                if (self.globalTags[iTagGlobal].guid === guidSecureDelete) {\r\n                    self.globalTags.splice(iTagGlobal, 1);\r\n                }\r\n            }\r\n        });\r\n\r\n        //Sync tags\r\n        self.plugins.tagsFilter.dataSource.data(self.globalTags);\r\n        self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\r\n    },\r\n\r\n    setClassesTagsByDiscussion: function () {\r\n        var self = this;\r\n        for (var iDiscussion = 0; iDiscussion < self.listDataDiscussion.length; iDiscussion += 1) {\r\n            var textTagsDiscussion = $.map(self.listDataDiscussion[iDiscussion].tags, function (itemTag) {\r\n                return itemTag.guid;\r\n            });\r\n            var tagsBySpace = textTagsDiscussion.join(\" \");\r\n\r\n            $(\".ui-bizagi-wp-project-discussions-item[data-guid='\" + self.listDataDiscussion[iDiscussion].guid + \"']\", self.getContent()).addClass(tagsBySpace);\r\n        }\r\n    },\r\n\r\n    updateTemplateListDiscussion: function () {\r\n\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n        var templateListDiscussions = self.getTemplate(\"project-discussions-list\");\r\n        var user = self.getCurrentUserInfo();\r\n        var contentRenderListDiscussions = templateListDiscussions.render({\r\n            listDataDiscussions: self.listDataDiscussion,\r\n            user: user,\r\n            isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\r\n            returnServedCommentByParentId: function (parentId) {\r\n                return self.returnServedCommentByParentId(parentId);\r\n            }\r\n        });\r\n        for (var i = 0; i < this.listDataDiscussion.length; i++) {\r\n            this.mapTempComments($(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"),\r\n                contentRenderListDiscussions.find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"));\r\n        }\r\n        $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).empty().append(contentRenderListDiscussions);\r\n\r\n        self.plugins.attchComments = self.applyFileAttachments(\"COMMENTS\");\r\n    },\r\n\r\n    showFormAddDiscussion: function (resourceTitlePopup) {\r\n        var self = this;\r\n\r\n        if (self.plugins.attchComments) {\r\n            self.plugins.attchComments.close();\r\n        }\r\n        self.dialogBoxDiscussion.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"650px\",\r\n            modal: true,\r\n            zIndex: 1,\r\n            title: bizagi.localization.getResource(resourceTitlePopup),\r\n            maximize: true,\r\n            open:  $.proxy(self.onOpenPopupDiscussion, self),\r\n            close: function () {\r\n                self.resetDiscussionAttachments();\r\n                self.onClosePopupDiscussion();\r\n            }\r\n        });\r\n    },\r\n\r\n    resetFormDiscussion: function () {\r\n        var self = this;\r\n\r\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n        self.form.subject.val(\"\");\r\n        self.form.description.val(\"\");\r\n\r\n        var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", self.dialogBoxDiscussion.formContent);\r\n        var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", self.dialogBoxDiscussion.formContent);\r\n        $subjectDiscussion.parent().find(\"span\").empty();\r\n        $descriptionDiscussion.parent().next().find(\"span\").empty();\r\n    },\r\n\r\n    renderUserProfile: function(){\r\n        var self = this;\r\n\r\n        var userPicture = $.grep(self.userPictures, function (userPicture) {\r\n            return userPicture.id === bizagi.currentUser.idUser;\r\n        })[0];\r\n\r\n        var base64Prefix = \"data:image/png;base64,\";\r\n        var $parent = $(\".ui-bizagi-wp-project-popupform-user\");\r\n        var $img = $parent.find(\".bz-wp-avatar-img\");\r\n        var $text = $parent.find(\".bz-wp-avatar-label\");\r\n\r\n        if (userPicture) {\r\n            if (userPicture.picture) {\r\n                $img.attr(\"src\", base64Prefix + userPicture.picture);\r\n            } else {\r\n                $img.hide();\r\n                $text.html(userPicture.name.getInitials()).show();\r\n            }\r\n        }  \r\n    },\r\n\r\n    renderUserProfilesAndImages: function () {\r\n        var self = this;\r\n\r\n        var userPicture = $.grep(self.userPictures, function (userPicture) {\r\n            return userPicture.id === bizagi.currentUser.idUser;\r\n        })[0];\r\n\r\n        var base64Prefix = \"data:image/png;base64,\";\r\n\r\n        if (userPicture) {\r\n            $(\".ui-bizagi-wp-project-discussions-create-comment .bz-wp-discussion-username\").html(userPicture.name);\r\n            if (userPicture.picture) {\r\n                $(\".ui-bizagi-wp-project-discussions-item-user img\").attr(\"src\", base64Prefix + userPicture.picture);\r\n                $(\".ui-bizagi-wp-project-popupform-image-current-user\").attr(\"src\", base64Prefix + userPicture.picture);\r\n            } else {\r\n                $(\".ui-bizagi-wp-project-discussions-item-user label.bz-wp-avatar-label\").html(userPicture.name.getInitials()).show();\r\n                $(\".ui-bizagi-wp-project-discussions-item-user img\").hide();\r\n            }\r\n        }\r\n\r\n        for (var iUser = 0; iUser < self.userPictures.length; iUser++) {\r\n            $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-discussion-username\").html(self.userPictures[iUser].name);\r\n            if (self.userPictures[iUser].picture) {\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").attr(\"src\", base64Prefix + self.userPictures[iUser].picture);\r\n            } else {\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").hide();\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] label.bz-wp-avatar-label\").html(self.userPictures[iUser].name.getInitials());\r\n            }\r\n        }\r\n    },\r\n\r\n    /*EVENTS*/\r\n    switchCommentsEvents: function (event) {\r\n\r\n        var self = this;\r\n        var $target = $(event.target);\r\n        var $parent = $target.parent();\r\n\r\n        if ($target.is(\"textarea\")) {\r\n            self.onShowButtonsPanel($target);\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-cancel\")) {\r\n\r\n            self.onCancelComment($target);\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-share\")) {\r\n\r\n            var $container = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\r\n            if (self.validateAddCommentForm($container)) {\r\n                var guid = Math.guid();\r\n                self.onCreateComment($target, guid);\r\n            }\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-view\")) {\r\n            self.onViewComment($target);\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussion-showmore-comments-button\")) {\r\n            self.onViewMoreComments($target);\r\n        } else if ($target.hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\r\n            self.onRemoveFiles($target);\r\n        } else if ($parent.hasClass(\"biz-wp-user-icon-admin\") && $parent.hasClass(\"biz-wp-action-edit-discussion\")) {\r\n            self.onEditDiscussion($target);\r\n        } else if ($parent.hasClass(\"ui-bizagi-wp-project-discussion-delete\")) {\r\n\r\n            $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-discussion-querydelete\"), \"\", \"info\")).done(function () {\r\n                self.onDeleteComment($parent);\r\n            });\r\n\r\n        } else if ($parent.hasClass(\"bz-bizagi-wp-project-discussions-attachment-itemwrapper\")) {\r\n            self.onDownloadAttachment($target.closest(\"li\"));\r\n        }\r\n\r\n        event.stopPropagation();\r\n    },\r\n\r\n    onEditDiscussion: function ($target) {\r\n\r\n        var self = this;\r\n        var $discussionCnt = $target.closest(\".ui-bizagi-wp-project-discussions-item\");\r\n        var guid = $discussionCnt.data(\"guid\");\r\n\r\n        self.setDiscussionsDataByGUID(guid);\r\n        self.showFormAddDiscussion(\"workportal-project-discussion-edit\");\r\n    },\r\n\r\n    setDiscussionsDataByGUID: function (guid) {\r\n\r\n        var self = this;\r\n\r\n        var discussion = self.getDiscussionDataByGUID(guid);\r\n        var $container = $(\".ui-bizagi-wp-project-attachments-list\", self.form.attachments);\r\n\r\n        self.form.edition = {\r\n            guid: guid\r\n        };\r\n\r\n        self.attchDiscussions = {\r\n            addition: discussion.attachments,\r\n            remove: []\r\n        };\r\n\r\n        self.form.title.text(bizagi.localization.getResource(\"workportal-project-discussion-edit\"));\r\n        self.form.subject.val(discussion.name);\r\n        self.form.description.val(discussion.description);\r\n\r\n        var guidTagsDiscussion = $.map(discussion.tags, function (itemTag) {\r\n            return itemTag.guid;\r\n        });\r\n        self.plugins.tagsMultiSelect.value(guidTagsDiscussion);\r\n        self.tempTagsBeforeDelete = [];\r\n        self.tempTagsBeforeDelete = self.tempTagsBeforeDelete.concat(self.plugins.tagsMultiSelect.value());\r\n\r\n        self.renderAttachments(discussion.attachments, \"DISCUSSIONS\", $container);\r\n\r\n    },\r\n\r\n    getDiscussionDataByGUID: function (guid) {\r\n\r\n        var self = this;\r\n        var discussion;\r\n\r\n        for (var i = self.listDataDiscussion.length - 1; i >= 0; i--) {\r\n            if (self.listDataDiscussion[i].guid === guid) {\r\n                discussion = self.listDataDiscussion[i];\r\n                i = 0;\r\n            }\r\n        }\r\n\r\n        return discussion;\r\n    },\r\n\r\n    onViewComment: function ($target) {\r\n        var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-comment-truncatewrapper\");\r\n        $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-shortcomment\");\r\n        $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-longcomment\");\r\n    },\r\n\r\n    onViewMoreComments: function ($target) {\r\n        var self = this;\r\n        var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussion-showmore-comments\");\r\n        var $commentsContainer = $commentWrapper.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\r\n        var idParent = $commentsContainer.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\r\n\r\n        if (!self.commentsList[idParent].total) {\r\n            //only one time call service if total is null\r\n            self.dataService.getCommentsCountByParent(idParent).done(function (response) {\r\n                self.commentsList[idParent].total = response.count;\r\n                self.getMoreComments(idParent, $commentsContainer);\r\n            });\r\n        }\r\n        else {\r\n            self.getMoreComments(idParent, $commentsContainer);\r\n        }\r\n    },\r\n\r\n    getMoreComments: function (idParent, $commentsContainer) {\r\n        var self = this;\r\n\r\n        //validate total comments vs count comments\r\n        if (self.commentsList[idParent].total > self.commentsList[idParent].comments.length) {\r\n\r\n            self.setStateUIShowMoreComments($commentsContainer, \"LOADING_MORE_COMMENTS\");\r\n\r\n            var dateLastComment;\r\n            if (self.commentsList[idParent].comments.length === 0) {\r\n                dateLastComment = self.getDateServer();\r\n            }\r\n            else {\r\n                dateLastComment = self.commentsList[idParent].comments[self.commentsList[idParent].comments.length - 1].date;\r\n            }\r\n\r\n            //substract one millisecond\r\n            dateLastComment -= 1;\r\n\r\n            self.dataService.getCommentsData(\r\n                {\r\n                    dateTime: dateLastComment,\r\n                    idParent: idParent,\r\n                    count: 6\r\n                }\r\n            ).done(function (responseMoreComments) {\r\n\r\n                    if (responseMoreComments.length) {\r\n                        Array.prototype.push.apply(self.commentsList[idParent].comments, responseMoreComments);\r\n                        self.commentsList[idParent].count += responseMoreComments.length;\r\n\r\n                        self.renderCommentByDiscussion($commentsContainer, idParent, responseMoreComments);\r\n                        self.renderUserProfilesAndImages();\r\n\r\n                        if (responseMoreComments.length > 5) {\r\n                            self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\r\n                        } else {\r\n                            self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\r\n                        }\r\n\r\n                        //Get profiles of idUsers not download in this moment\r\n                        var idUsersLoaded = $.map(self.userPictures, function (element) {\r\n                            return element.id;\r\n                        });\r\n\r\n                        var idUsersNewComments = $.map(self.commentsList, function (property) {\r\n                            return $.map(property.comments, function (property) {\r\n                                return property.user;\r\n                            });\r\n                        });\r\n\r\n                        var arrayIdUsersMissingLoad = $(idUsersNewComments).not(idUsersLoaded).get();\r\n                        var csvIdUsersMissingLoad = arrayIdUsersMissingLoad.join(\",\");\r\n\r\n                        self.getDataUsers(csvIdUsersMissingLoad).then(function () {\r\n                            self.renderUserProfilesAndImages();\r\n                        });\r\n\r\n                    }\r\n                    else {\r\n                        self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\r\n                    }\r\n                }).fail(function () {\r\n                    self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\r\n                });\r\n        }\r\n        else {\r\n            self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\r\n        }\r\n\r\n    },\r\n\r\n    renderCommentByDiscussion: function ($container, guidParent, moreComments) {\r\n\r\n        var self = this,\r\n            tmplComment = self.getTemplate(\"project-discussions-comments\"),\r\n            $commentsDOM,\r\n            renderObject = {\r\n                comments: [],\r\n                user: self.getCurrentUserInfo(),\r\n                isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers)\r\n            };\r\n\r\n        if (!moreComments.length) {\r\n            renderObject.comments = self.commentsList[guidParent].comments;\r\n            $commentsDOM = tmplComment.render(renderObject);\r\n            $container.html($commentsDOM);\r\n        } else {\r\n            renderObject.comments = moreComments;\r\n            $commentsDOM = tmplComment.render(renderObject);\r\n            $container.append($commentsDOM);\r\n        }\r\n    },\r\n\r\n    getCommentByGuid: function (parentGuid, commentGuid) {\r\n\r\n        var self = this;\r\n        var commentsList = self.commentsList[parentGuid].comments;\r\n\r\n        for (var i = 0, length = commentsList.length; i < length; i++) {\r\n\r\n            if (commentsList[i].guid === commentGuid) {\r\n                var attachments = [];\r\n\r\n                for (var x = 0, lengthx = commentsList[i].attachments.length; x < lengthx; x++) {\r\n                    attachments.push(commentsList[i].attachments[x].guid);\r\n                }\r\n\r\n                return {\r\n                    attachments: attachments,\r\n                    index: i\r\n                };\r\n            }\r\n        }\r\n\r\n        return {};\r\n    },\r\n\r\n    returnServedCommentByParentId: function (parentId) {\r\n        var self = this;\r\n\r\n        if (typeof self.commentsList[parentId] !== \"undefined\") {\r\n            return self.commentsList[parentId];\r\n        }\r\n    },\r\n\r\n    /*\r\n     *   Events\r\n     */\r\n    onShowButtonsPanel: function ($target) {\r\n        var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\").find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\r\n        $buttonsWrp.show();\r\n    },\r\n\r\n    onRemoveFiles: function ($target) {\r\n        var self = this;\r\n        var $container = $target.closest(\"li\"),\r\n            type = $container.closest(\".ui-bizagi-wp-project-attachments-list\").data(\"type\"),\r\n            fileGuid = $container.data(\"fileguid\");\r\n        var currentFiles, removeFiles, tmpSplice;\r\n\r\n        if (type === \"COMMENT\") {\r\n            var guid = $container.closest(\".ui-bizagi-wp-project-discussions-add-comment\").data(\"guid\");\r\n            currentFiles = self.attchComments[guid].addition;\r\n            removeFiles = self.attchComments[guid].remove;\r\n\r\n        } else {\r\n            currentFiles = self.attchDiscussions.addition;\r\n            removeFiles = self.attchDiscussions.remove;\r\n        }\r\n\r\n        for (var i = 0, length = currentFiles.length - 1; i <= length; i++) {\r\n\r\n            if (currentFiles[i].guid === fileGuid) {\r\n                tmpSplice = currentFiles.splice(i, 1);\r\n                removeFiles.push(tmpSplice[0].guid);\r\n                i = length;\r\n            }\r\n        }\r\n\r\n        $container.remove();\r\n    },\r\n\r\n    onDeleteComment: function ($target) {\r\n        var self = this;\r\n        var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\r\n        var commentGuid = $commentWrapper.data(\"cmmtguid\");\r\n        var parentGuid = $commentWrapper.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\r\n        var comment = self.getCommentByGuid(parentGuid, commentGuid);\r\n\r\n        var params = {\r\n            content: {\r\n                guid: commentGuid\r\n            },\r\n            attachmentsToDelete: comment.attachments\r\n        };\r\n\r\n        $.when(self.dataService.deleteComment(params)).always(function (response) {\r\n            if (response.status === 200 || typeof (response.status) === \"undefined\") {\r\n                self.commentsList[parentGuid].comments.splice(comment.index, 1);\r\n                $commentWrapper.remove();\r\n            } else {\r\n                self.notifier.showErrorMessage(\r\n                    printf(bizagi.localization.getResource(\"workportal-project-discussion-errordelete\"), \"\"));\r\n            }\r\n        });\r\n    },\r\n\r\n    onSuccessFile: function (event, type) {\r\n        var self = this;\r\n        var files = event.files;\r\n        var status = (event.XMLHttpRequest.response) ? JSON.parse(event.XMLHttpRequest.response) : {};\r\n\r\n        if (!status.error) {\r\n            var $wrapper = $(event.sender.element).closest(\".ui-bizagi-wp-project-discussion-textwrapper\");\r\n            var $container = $wrapper.find(\".ui-bizagi-wp-project-attachments-list\");\r\n\r\n            if (type === \"DISCUSSIONS\") {\r\n                self.plugins.attchDiscussions.setStatus(\"SUCCESS\", files[0].guid);\r\n                Array.prototype.push.apply(self.attchDiscussions.addition, files);\r\n            } else {\r\n                self.plugins.attchComments.setStatus(\"SUCCESS\", files[0].guid);\r\n                var guid = $wrapper.data(\"guid\");\r\n\r\n                if (self.attchComments[guid]) {\r\n                    Array.prototype.push.apply(self.attchComments[guid].addition, files);\r\n                } else {\r\n                    self.attchComments[guid] = {\r\n                        addition: files,\r\n                        remove: []\r\n                    };\r\n                }\r\n\r\n                self.onShowButtonsPanel($container.parent());\r\n            }\r\n\r\n            self.renderAttachments(files, type, $container);\r\n        } else {\r\n\r\n            if (type === \"DISCUSSIONS\") {\r\n                self.plugins.attchDiscussions.onErrorFile(event);\r\n            } else {\r\n                self.plugins.attchComments.onErrorFile(event);\r\n            }\r\n        }\r\n    },\r\n\r\n    onDownloadAttachment: function ($liTarget) {\r\n        var self = this;\r\n        var guidAttachment = $liTarget.data(\"fileguid\");\r\n\r\n        if (guidAttachment !== \"\") {\r\n            var nameFile = $liTarget.find(\".bz-bizagi-wp-project-discussions-attachment-filename\").text();\r\n            self.dataService.getDownloadAttachment(guidAttachment, nameFile);\r\n        }\r\n    },\r\n\r\n    onCancelComment: function ($target) {\r\n        var self = this;\r\n        var $commentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\r\n        var $buttonsWrp = $commentContainer.find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\r\n        var $textarea = $commentContainer.find(\"textarea\");\r\n        var $uploadForm = $commentContainer.find(\".ui-bizagi-wp-project-discussions-add-attachments form\");\r\n        var $vlTooltip = $commentContainer.find(\".k-tooltip-validation\");\r\n        var $fileList = $commentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\r\n        var guid = $commentContainer.data(\"guid\");\r\n\r\n        self.attchComments[guid] = {\r\n            addition: [],\r\n            remove: []\r\n        };\r\n\r\n        self.plugins.attchComments.cancelFilesUpload();\r\n\r\n        $uploadForm[0].reset();\r\n        $fileList.empty();\r\n        $textarea.val(\"\");\r\n        $vlTooltip.hide();\r\n        $buttonsWrp.hide();\r\n    },\r\n\r\n    onCreateComment: function ($target, guid) {\r\n        var self = this;\r\n        var $rplWrp = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\r\n        var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\r\n        var $addCommentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\r\n        var $textarea = $addCommentContainer.find(\"textarea\");\r\n        var $uploadList = $addCommentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\r\n        var idParent = $addCommentContainer.data(\"guid\");\r\n        var filesObj = self.prepareFilesToSave(\"COMMENTS\", idParent);\r\n\r\n        var params = {\r\n            content: {\r\n                guid: guid,\r\n                attachments: filesObj.attachments,\r\n                text: $textarea.val(),\r\n                parent: idParent,\r\n                date: self.getDateServer(),\r\n                user: bizagi.currentUser.idUser\r\n            },\r\n            attachmentsToCreate: filesObj.attachmentsToCreate,\r\n            attachmentsToDelete: filesObj.attachmentsToDelete\r\n        };\r\n\r\n        $.when(self.dataService.postComment(params)).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                var $commentContainer = $rplWrp.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\r\n                var newComment = {\r\n                    user: params.content.user,\r\n                    attachments: params.content.attachments,\r\n                    text: params.content.text,\r\n                    guid: params.content.guid,\r\n                    parent: params.content.parent,\r\n                    date: params.content.date\r\n                };\r\n\r\n                //reset for a new comment\r\n                self.attchComments[params.content.parent] = {\r\n                    addition: [],\r\n                    remove: []\r\n                };\r\n\r\n                $textarea.val(\"\");\r\n                $uploadList.empty();\r\n                $buttonsWrp.hide();\r\n\r\n                //Add new comment to the list\r\n                self.commentsList[newComment.parent].comments.unshift(newComment);\r\n                self.renderCommentByDiscussion($commentContainer, newComment.parent, []);\r\n\r\n                self.plugins.attchComments.close();\r\n                self.renderUserProfilesAndImages();\r\n            }\r\n        });\r\n    },\r\n\r\n    renderAttachments: function (files, type, $container) {\r\n        var self = this;\r\n        var attachTemplate = self.getTemplate(\"project-discussions-attachments\");\r\n\r\n        var $fileList = attachTemplate.render({attachments: files, type: type});\r\n        $container.append($fileList);\r\n        if(bizagi.util.isIE()){//\"shake\" files container for IE error\r\n            $(\".ui-bizagi-wp-project-attachments-list li\").hide(10,function() {\r\n                $(this).show();\r\n            });\r\n        }\r\n    },\r\n\r\n    prepareFilesToSave: function (type, guid) {\r\n\r\n        var self = this;\r\n        var files = [],\r\n            fileList = (type === \"COMMENTS\") ? self.attchComments[guid] : self.attchDiscussions,\r\n            attachmentsToCreate = [];\r\n\r\n        fileList = fileList || {addition: [], remove: []};\r\n\r\n        for (var i = 0, length = fileList.addition.length - 1; i <= length; i++) {\r\n            files.push({\r\n                guid: fileList.addition[i].guid,\r\n                name: fileList.addition[i].name\r\n            });\r\n\r\n            attachmentsToCreate.push(fileList.addition[i].guid);\r\n        }\r\n\r\n        return {\r\n            attachments: files,\r\n            attachmentsToCreate: attachmentsToCreate,\r\n            attachmentsToDelete: fileList.remove\r\n        };\r\n    },\r\n\r\n    onClickCancel: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n\r\n        self.resetDiscussionAttachments();\r\n        self.onClosePopupDiscussion();\r\n\r\n        self.plugins.attchDiscussions.cancelFilesUpload();\r\n    },\r\n\r\n    onClosePopupDiscussion: function () {\r\n        var self = this;\r\n        self.resetFormDiscussion();\r\n        self.plugins.attchDiscussions.destroy();\r\n        self.dialogBoxDiscussion.formContent.dialog(\"destroy\");\r\n        self.dialogBoxDiscussion.formContent.detach();\r\n    },\r\n\r\n    onOpenPopupDiscussion: function () {\r\n        var self = this;\r\n\r\n        self.plugins.attchDiscussions = self.applyFileAttachments(\"DISCUSSIONS\");\r\n\r\n        //popup\r\n        self.dialogBoxDiscussion.formContent.parent().css(\"z-index\",10001);\r\n        //overlay\r\n        self.dialogBoxDiscussion.formContent.parent().parent().find(\".ui-widget-overlay\").css(\"z-index\",10001);\r\n\r\n        setTimeout(function () {\r\n            self.form.subject.focus();\r\n        }, 50);\r\n    },\r\n\r\n    onSubmitFormDiscussion: function (event) {\r\n        event.preventDefault();\r\n\r\n        var self = this;\r\n        var guid;\r\n        if (self.validateAddDiscussionForm(self.dialogBoxDiscussion.formContent)) {\r\n            if (self.form.edition.guid) {\r\n                guid = self.form.edition.guid;\r\n                $.proxy(self.sendDataUpdateDiscussion(guid), self);\r\n            } else {\r\n                guid = Math.guid();\r\n                $.proxy(self.sendDataInsertDiscussion(guid), self);\r\n            }\r\n        }\r\n    },\r\n\r\n    restrictedEventsHandler: function () {\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\",\".bz-bizagi-wp-project-discussions-attachment-itemwrapper\", $.proxy(self.switchCommentsEvents, self));\r\n    },\r\n\r\n    eventsHandler: function () {\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        //Add events\r\n        self.form.buttonShowFormNewDiscussion.on(\"click\", $.proxy(self.onNotifyOpenPopup, self));\r\n        self.form.buttonCancel.on(\"click\", $.proxy(self.onClickCancel, self));\r\n        self.form.buttonAddDiscussion.on(\"click\", $.proxy(self.onSubmitFormDiscussion, self));\r\n        self.form.attachments.on(\"click\", \".bz-bizagi-wp-project-discussions-attachment-delete, .bz-bizagi-wp-project-discussions-attachment-itemwrapper\", function (event) {\r\n\r\n            if ($(event.target).hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\r\n                self.onRemoveFiles($(event.target));\r\n            } else {\r\n                self.onDownloadAttachment($(event.target).closest(\"li\"));\r\n            }\r\n\r\n            event.stopPropagation();\r\n        });\r\n\r\n        $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\", \".ui-bizagi-wp-project-discussions-add-comment textarea\" +\r\n            \", .ui-bizagi-wp-project-discussions-comment-buttons-cancel\" +\r\n            \", .ui-bizagi-wp-project-discussions-comment-buttons-share\" +\r\n            \", .ui-bizagi-wp-project-discussion-showmore-comments button\" +\r\n            \", .bz-bizagi-wp-project-discussions-attachment-delete\" +\r\n            \", .ui-bizagi-wp-project-discussion-delete\" +\r\n            \", .bz-bizagi-wp-project-discussions-attachment-itemwrapper\" +\r\n            \", .ui-bizagi-wp-project-discussions-comment-view\" +\r\n            \", .ui-bizagi-wp-project-discussions-items-edition\" +\r\n            \", .biz-wp-action-edit-discussion\", $.proxy(self.switchCommentsEvents, self));\r\n\r\n        self.sub(\"changeProjectWidget\", function () {\r\n            self.resetWidget();\r\n        });\r\n        self.sub(\"OPEN_POPUP_DISCUSSION\", $.proxy(self.onNotifyOpenPopup, self));\r\n    },\r\n\r\n    resetWidget: function () {\r\n        var self = this;\r\n        self.userPictures = [];\r\n        if (self.plugins.attchComments) {\r\n            self.plugins.attchComments.close();\r\n        }\r\n    },\r\n\r\n    clean: function () {\r\n\r\n        var self = this;\r\n        self.resetWidget();\r\n\r\n        if(self.form && self.form.buttonShowFormNewDiscussion){\r\n            self.form.buttonShowFormNewDiscussion.off(\"click\", $.proxy(self.onNotifyOpenPopup, self));\r\n        }\r\n\r\n\r\n        for (var i in self.plugins) {\r\n            if (self.plugins[i] && self.plugins[i].hasOwnProperty(\"destroy\")) {\r\n                if (self.plugins[i].destroy) {\r\n                    self.plugins[i].destroy();\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    mapTempComments: function ($source, $target){\r\n            var $textareaSource = $source.find(\"textarea\");\r\n            var $textareaTarget = $target.find(\"textarea\");\r\n            var $uploadListSource = $source.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\r\n            var $uploadListTarget = $target.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\r\n            $textareaTarget.val($textareaSource.val());\r\n            $uploadListTarget.empty().append($uploadListSource.html());\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.discussions\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.discussions], true);","/*\r\n *   Name: Bizagi Workportal project Discussion Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.discussion.sidebar\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      params = params || {};\r\n      params.supportNav = false;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-discussion-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussion.sidebar\").concat(\"#project-discussion-sidebar\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-discussion-sidebar\");\r\n      self.content = template.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers)});\r\n\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      var $contentWidget = self.getContent();\r\n      $(\".ui-bizagi-wp-project-discussions-sidebar-action-add > a\", $contentWidget).on(\"click\"\r\n         ,$.proxy(self.onShowPopupDiscussion, self));\r\n   },\r\n\r\n   /**\r\n    * Events elements\r\n    */\r\n   onShowPopupDiscussion: function () {\r\n      var self = this;\r\n      self.pub(\"notify\", {\r\n         type: \"OPEN_POPUP_DISCUSSION\",\r\n         args: {}\r\n      });\r\n   }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.discussion.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.discussion.sidebar], true);"]}