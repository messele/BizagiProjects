{"version":3,"sources":["jquery/workportal/desktop/widget/profly/bizagi.workportal.desktop.widgets.profly.js"],"names":["bizagi","workportal","widgets","widget","extend","init","workportalFacade","dataService","params","this","_super","loadTemplates","project-filespreview-wrapper","getTemplate","concat","renderContent","self","argumentsTemplate","paramsURL","data","route","id","encodeURI","displayName","module","generalTmpl","content","render","util","isIE11OrLower","localStorage","setItem","$","css","width","height","when","reloadToDashboardWhenLoadIFrame","done","isChrome","on","event","currentTarget","contentWindow","location","href","indexOf","reload","defer","Deferred","waitForContentDocumentOnIframe","document","getElementById","contentDocument","setTimeout","resolve","promise","postRender","clean","off","plugins","form","currentFile","filesNumber","injector","register","profly"],"mappings":"AAKAA,OAAOC,WAAWC,QAAQC,OAAOC,OAAO,uCAIpCC,KAAM,SAAUC,EAAkBC,EAAaC,GAChCC,KAGNC,OAAOJ,EAAkBC,EAAaC,GAHhCC,KAMNE,eACDC,+BAAgCZ,OAAOa,YAAY,2CAA2CC,OAAO,oCAO7GC,cAAe,WACX,IAAIC,EAAOP,KAEPQ,GACAC,UAAW,IAEZF,EAAKR,OAAOW,MAAQH,EAAKR,OAAOW,KAAKC,OAASJ,EAAKR,OAAOW,KAAKX,OAAOa,KACrEJ,EAAkBC,UACdI,UAAU,UAAYN,EAAKR,OAAOW,KAAKC,MAAQ,OAASJ,EAAKR,OAAOW,KAAKX,OAAOa,GAAK,gBAAkBL,EAAKR,OAAOW,KAAKX,OAAOe,cAIpIP,EAAKR,OAAOW,MAAQH,EAAKR,OAAOW,KAAKC,OAASJ,EAAKR,OAAOW,KAAKX,OAAOgB,SACrEP,EAAkBC,UACdI,UAAU,UAAYN,EAAKR,OAAOW,KAAKC,MAAQ,WAAaJ,EAAKR,OAAOW,KAAKX,OAAOgB,SAG5F,IAAIC,EAAcT,EAAKH,YAAY,gCAqBnC,OApBAG,EAAKU,QAAUD,EAAYE,OAAOV,GAE/BjB,OAAO4B,KAAKC,kBACXC,aAAaC,QAAQ,gBAAiBd,EAAkBC,WACxDc,EAAEhB,EAAKU,SAASO,KAAMC,MAAO,MAAOC,OAAQ,QAC5CH,EAAEI,KAAKpB,EAAKqB,mCAAmCC,KAAK,WAChDN,EAAEhB,EAAKU,SAASO,IAAI,QAAS,QAAQA,IAAI,SAAU,WAMxDjC,OAAO4B,KAAKW,YACXP,EAAEhB,EAAKU,SAASc,GAAG,OAAQ,SAAUC,IAC+C,IAA7EA,EAAMC,cAAcC,cAAcC,SAASC,KAAKC,QAAQ,iBACvDF,SAASG,WAKd/B,EAAKU,SAGhBW,gCAAiC,WAC7B,IACIW,EAAQhB,EAAEiB,WAYd,OAXA,SAASC,IACFC,SAASC,eAAe,8BAAsG,IAApED,SAASC,eAAe,wBAAwBC,iBACzGF,SAASC,eAAe,wBAAwBC,gBAAgBT,SAAW,8BAC3EU,WAAW,WAAWN,EAAMO,WAAa,MAGzCD,WAAWJ,EAAgC,IAInDA,GACOF,EAAMQ,WAMjBC,WAAY,aAIZC,MAAO,WACH,IAAI1C,EAAOP,KACXuB,EAAE,wBAAyBhB,EAAKU,SAASiC,MACzC3C,EAAK4C,WACL5C,EAAK6C,QACL7C,EAAK8C,eACL9C,EAAK+C,YAAc,KAI3B/D,OAAOgE,SAASC,SAAS,oCAAqC,mBAAoB,cAAejE,OAAOC,WAAWC,QAAQgE","sourcesContent":["/*\r\n *   Name: Bizagi Workportal Desktop Project File Preview\r\n *   Author: David Romero Estrada\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.profly\", {}, {\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-filespreview-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.profly\").concat(\"#project-filespreview-wrapper\")\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        // Define parameters to route angular app\r\n        var argumentsTemplate = {\r\n            paramsURL: ''\r\n        }\r\n        if(self.params.data && self.params.data.route && self.params.data.params.id){\r\n            argumentsTemplate.paramsURL =\r\n                encodeURI('?route=' + self.params.data.route + '&id=' + self.params.data.params.id + '&displayName=' + self.params.data.params.displayName);\r\n\r\n        }\r\n\r\n        if(self.params.data && self.params.data.route && self.params.data.params.module){\r\n            argumentsTemplate.paramsURL =\r\n                encodeURI('?route=' + self.params.data.route + '&module=' + self.params.data.params.module);\r\n        }\r\n\r\n        var generalTmpl = self.getTemplate(\"project-filespreview-wrapper\");\r\n        self.content = generalTmpl.render(argumentsTemplate);\r\n\r\n        if(bizagi.util.isIE11OrLower()){\r\n            localStorage.setItem(\"params_profly\", argumentsTemplate.paramsURL);\r\n            $(self.content).css({ width: '0px', height: '0px' });\r\n            $.when(self.reloadToDashboardWhenLoadIFrame()).done(function(){\r\n                $(self.content).css('width', '100%').css('height', '100%');\r\n            });\r\n        }\r\n\r\n        // this event is triggered when user lost session from form designer.\r\n        // by the moment, only Chrome Users can access to formDesigner.\r\n        if(bizagi.util.isChrome()){\r\n            $(self.content).on(\"load\", function (event) {\r\n                if(event.currentTarget.contentWindow.location.href.indexOf('quickprocess') === -1){\r\n                    location.reload(); // QAF-5934\r\n                }\r\n            });\r\n        }\r\n\r\n        return self.content;\r\n    },\r\n\r\n    reloadToDashboardWhenLoadIFrame: function () {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        function waitForContentDocumentOnIframe(){\r\n            if(document.getElementById('iframe-liveprocesses') && typeof document.getElementById('iframe-liveprocesses').contentDocument !== \"undefined\"){\r\n                document.getElementById('iframe-liveprocesses').contentDocument.location = './jquery/quickprocess/dist/';\r\n                setTimeout(function(){defer.resolve();}, 1000);\r\n            }\r\n            else{\r\n                setTimeout(waitForContentDocumentOnIframe, 50);\r\n            }\r\n        }\r\n\r\n        waitForContentDocumentOnIframe();\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n    * links events with handlers\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n    },\r\n\r\n    clean: function () {\r\n        var self = this;\r\n        $('#iframe-liveprocesses', self.content).off();\r\n        self.plugins = {};\r\n        self.form = {};\r\n        self.currentFile = {};\r\n        self.filesNumber = 0;\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.profly\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.profly]);"]}