{"version":3,"sources":["jquery/workportal/desktop/widget/project.dashboard.menu.activity/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.files/bizagi.workportal.desktop.widgets.project.files.js","jquery/workportal/desktop/widget/project.filesPreview/bizagi.workportal.desktop.widgets.project.filesPreview.js","jquery/workportal/desktop/widget/project.file.sidebar/bizagi.workportal.desktop.widgets.project.file.sidebar.js"],"names":["bizagi","workportal","widgets","widget","extend","init","workportalFacade","dataService","params","self","this","_super","loadTemplates","project-dashboard-menu","getTemplate","concat","renderContent","content","$","postRender","contextsLeftSidebarCaseDashboard","forEach","context","sub","proxy","updateView","event","args","plan","idActivitySelected","undefined","clean","$content","getContent","empty","type","showContextByMenuDashboard","argsTemplate","showFormOverview","menuDashboard","showFormActivity","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isAdhocProcess","util","isEnableFeature","showPlanOptionMenu","contextPlanOptionMenu","contextFormActivityOptionMenu","render","appendTo","toUpperCase","addClass","siblings","removeClass","handlerEvents","loadContentById","preventDefault","$item","target","closest","hasClass","data","when","autoSave","done","document","getLevelNavigator","pub","currentLevelNavigator","parseInt","nameItemNavigator","newLevelNavigator","localization","getResource","refreshLastItemBreadcrumb","histName","level","subMenuHandler","$comments","$files","$timeline","on","toggle","options","action","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","idCase","idTask","idWorkflow","idWorkItem","idWorkitem","referrer","publish","unsub","off","injector","register","project","dashboard","menu","activity","project-content-dashboard","template","setTimeout","window","trigger","ui","kendo","Widget","ProjectAttachments","element","that","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","name","wrapper","multiple","dropZone","maxFilesSize","currentUser","uploadMaxFileSize","enabled","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","select","_filterMaxFilesSize","complete","interval","setInterval","find","length","_showNotificationCompleteUpload","clearInterval","progress","_onProgressFile","success","push","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","title","notifierTitle","animation","open","duration","close","visible","resizable","draggable","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","replace","Math","round","cancel","retry","$file","_getFileItemByUID","uid","percent","percentComplete","css","width","text","hide","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$target","$fileWrapper","$uploadWrapper","guid","remove","_onRemoveFile","_onRetryFile","file","grep","i","validation","_isValidFile","message","setStatus","valid","size","inArray","extension","total","_notifySizeExceeded","show","_switchEvents","currentTarget","cancelFilesUpload","destroy","status","prop","errorUploadiis","plugin","jQuery","base","plugins","prefixBase64","usersData","currentFilesList","fileDateInterval","project-files","project-files-uploaditem","project-files-list","project-attachments","templateHomeFiles","isOpen","parseBoolean","isClosedForAllUsers","renderFilesList","initializeUploadFiles","eventsHandler","restrictedEventsHandler","defer","Deferred","filesLength","globalParent","encodeURIComponent","radNumber","dateTime","date","getDateServer","count","flowContext","id","getFilesListByRadNumber","renderFiles","resolve","promise","$showMoreWrapper","displayFileList","updateRelativeTime","setAdditionalData","notifyFilesNumber","renderNoFiles","noFilesTmpl","resources","$noFiles","tmpl","html","kendoProjectAttachments","serviceLocator","getUrl","onSuccessFile","addFileData","onSaveFileData","supportFileExt","uploadMaxFilesSize","thumbnails","users","guidsUsers","user","attachment","setUserData","join","setThumbnails","usersGuids","height","getUsersData","picture","getFileInfoByGuid","guids","getFilesThumbnails","thumbnail","$wrapper","$img","each","src","toLowerCase","setFilePreview","guidAttch","guidFile","img","userId","fileData","userData","XMLHttpRequest","JSON","parse","response","saveFileData","fail","onRetryFile","toString","description","idUser","attachmentsToCreate","unshift","createProjectFile","always","userName","Date","getTime","photo","reject","$filesList","equalizeHeights","deleteFile","filter","updateFileData","changeRelativeTime","item","relativeTime","dateFormatter","getRelativeTime","onSelectFiles","bannedFiles","isValidFile","bannedFile","splice","showFilesError","resetWidget","switchFilesEvents","stopPropagation","fileName","getDownloadAttachment","parent","mandatory","filesNumber","notifier","datePickerRegional","dialogBox","project-filespreview-wrapper","project-filespreview-preview","project-filespreview-popup","project-filespreview-thenumber","generalTmpl","setFilesNumber","fileEdition","initPluginPopupEdition","form","image","edit","parameters","isEmptyObject","currentFile","$filesNumber","formContent","showPreview","idCurrentUser","applyMenu","setEditionData","val","onResetFileForm","onSaveEdition","onSelectMenu","onOpenEdition","onDeleteFile","onDownloadFile","dialog","modal","maximize","focus","showConfirmationBox","attachmentsToDelete","validateAddFileDescriptionForm","updateProjectFile","showSucessMessage","printf","showErrorMessage","$description","result","$textAreadescription","trim","descriptionValidation","next","detach","filesPreview","supportNav","project-file-sidebar","getWidgetName","BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR","sidebar"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity\").concat(\"#project-dashboard-menu1\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n         self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Update view\r\n    * @param event\r\n    * @param params\r\n    */\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.params.plan.idActivitySelected = undefined;\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      if(typeof event.type !== \"undefined\"){\r\n         self.params.showContextByMenuDashboard = event.type;\r\n      }\r\n\r\n      var argsTemplate = {\r\n         showFormOverview: self.params.menuDashboard.showFormOverview,\r\n         showFormActivity: self.params.menuDashboard.showFormActivity,\r\n         showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu &&\r\n            (!self.params.isAdhocProcess ||\r\n            (self.params.isAdhocProcess && bizagi.util.isEnableFeature(\"enableTimelineOnLiveProcesses\"))),\r\n         showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\r\n         contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\r\n         contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu\r\n      };\r\n\r\n      //Update widget\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      template.render(argsTemplate).appendTo($content);\r\n\r\n      if(self.params.showContextByMenuDashboard){\r\n         $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n      }\r\n\r\n      self.handlerEvents();\r\n   },\r\n\r\n   /**\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if (!$item.hasClass(\"active\")) {\r\n\r\n         var showContextByMenuDashboard = $item.data(\"context\");\r\n\r\n         if (showContextByMenuDashboard) {\r\n            $.when(bizagi.util.autoSave()).done(function () {\r\n               $(document).data('auto-save', '');\r\n\r\n               var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\" });\r\n               var currentLevelNavigator = parseInt(getLevelNavigator[0], 10);\r\n               var nameItemNavigator = \"\";\r\n               var newLevelNavigator = currentLevelNavigator;\r\n\r\n               if(showContextByMenuDashboard == \"PLANACTIVITIES\"){\r\n                  newLevelNavigator = currentLevelNavigator + 1;\r\n                  nameItemNavigator = bizagi.localization.getResource(\"workportal-project-casedashboard-plan\");\r\n               }\r\n\r\n               self.params.refreshLastItemBreadcrumb = false;\r\n               self.pub(\"notify\", {\r\n                  type: showContextByMenuDashboard.toUpperCase(),\r\n                  args: $.extend(self.params, { showContextByMenuDashboard: showContextByMenuDashboard,\r\n                     histName: nameItemNavigator,\r\n                     level: newLevelNavigator })\r\n               });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n            });\r\n         }\r\n      }\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n       var self = this;\r\n       var content = self.getContent();\r\n       var $comments = $(\"[data-context='COMMENTS']\", content);\r\n       var $files = $(\"[data-context='FILES']\", content);\r\n       var $timeline = $(\"[data-context='TIMELINE']\", content);\r\n\r\n       $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n           $comments.toggle();\r\n           $files.toggle();\r\n           $timeline.toggle();\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Handler events\r\n    */\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      self.subMenuHandler();\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\", $.proxy(self.loadContentById, self));\r\n\r\n       // Bind for click event on refresh botton\r\n       $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).on(\"click\", function () {\r\n           var options = {\r\n               action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n               idCase: self.params.idCase,\r\n               idTask: self.params.idTask,\r\n               idWorkflow: self.params.idWorkflow,\r\n               idWorkItem: self.params.idWorkitem,\r\n               referrer: self.params.referrer || \"inboxGrid\"\r\n           };\r\n           self.publish(\"executeAction\", options);\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Clean widgets and events\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n      $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).off();\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-content-dashboard\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n\r\n      setTimeout(function(){\r\n         $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\r\n      }, 1000);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\r\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\r\n\r\n (function ($) {\r\n\r\n     // shorten references to variables. this is better for uglification \r\n     var kendo = window.kendo,\r\n      ui = kendo.ui,\r\n      Widget = ui.Widget;\r\n\r\n     var ProjectAttachments = Widget.extend({\r\n\r\n         init: function (element, options) {\r\n\r\n             var that = this;\r\n\r\n             // base call to initialize widget\r\n             Widget.fn.init.call(that, element, options);\r\n\r\n             that._maxFilesSize = options.maxSize;\r\n             that._fileList = [];\r\n             that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\r\n             that._supportFileExt = options.extensions;\r\n             that._uploadMaxFilesSize = options.maxSize;\r\n             that.upload = that._initUpload();\r\n             that.loadNotifier = that._initLoadNotifier();\r\n             that.notification = that._initNotification();\r\n\r\n             that._eventsHandler();\r\n\r\n             that._initLocalization(that.options.localization);\r\n         },\r\n\r\n         options: {\r\n             name: \"ProjectAttachments\",\r\n             wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\r\n             multiple: true,\r\n             dropZone: true,\r\n             maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\r\n             enabled: true,\r\n             localization: {}\r\n         },\r\n\r\n         _initUpload: function () {\r\n\r\n             var that = this,\r\n              options = that.options,\r\n              localization = options.localization || {},\r\n              auxNumberFilesSuccess = 0;\r\n\r\n             that._initLocalization(localization);\r\n\r\n             return this.element.kendoUpload({\r\n                 async: {\r\n                     saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\r\n                     autoUpload: true\r\n                 },\r\n                 select: function (event) {\r\n                     that._filterMaxFilesSize(event);\r\n                     auxNumberFilesSuccess = 0;\r\n                 },\r\n                 complete: function(){\r\n                     var interval = setInterval(function(){\r\n                        if( that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0){\r\n                            that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\r\n                            clearInterval(interval);\r\n                        }\r\n                     }, 300);\r\n                 },\r\n                 upload: options.upload,\r\n                 progress: function (event) {\r\n                     that._onProgressFile(event);\r\n                 },\r\n                 success: function (event) {\r\n                     that._fileList.push(event.files[0]);\r\n                     auxNumberFilesSuccess += 1;\r\n                     options.success(event);\r\n                 },\r\n                 error: function (event) {\r\n                     that.onErrorFile(event);\r\n                 },\r\n                 localization: {\r\n                     select: localization.selectFiles,\r\n                     dropFilesHere: localization.dropFilesHere\r\n                 },\r\n                 multiple: options.multiple,\r\n                 enabled: options.enabled,\r\n                 dropZone: options.dropZone,\r\n                 showFileList: false\r\n             }).data(\"kendoUpload\");\r\n\r\n         },\r\n\r\n         _initNotification: function(){\r\n             return $(\"<div></div>\").kendoNotification({\r\n                 position: {\r\n                     pinned: true\r\n                 }\r\n             }).data(\"kendoNotification\");\r\n         },\r\n\r\n         _initLoadNotifier: function () {\r\n\r\n             var that = this,\r\n                    localization = that.options.localization,\r\n                    $wrapper = that.options.wrapper;\r\n\r\n             return $wrapper.kendoWindow({\r\n                 title: localization.notifierTitle,\r\n                 actions: [\"Close\"],\r\n                 animation: {\r\n                     open: {\r\n                         duration: 100\r\n                     },\r\n                     close: {\r\n                         duration: 100\r\n                     }\r\n                 },\r\n                 open: function() {\r\n                     this.wrapper.addClass(\"project-attachments-wrapper-window\");\r\n                 },\r\n                 visible: false,\r\n                 resizable: false,\r\n                 draggable: false,\r\n                 maxHeight: \"300px\",\r\n                 minWidth: \"430px\"\r\n             }).data(\"kendoWindow\");\r\n\r\n         },\r\n\r\n         _initLocalization: function(objectOptionsLocalization){\r\n             var that = this;\r\n             var optionsLocalizationByDefault = {\r\n                 selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\r\n                 notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\r\n                 errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error-type\"),\r\n                 errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\r\n                 errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\r\n                 errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", (Math.round(that._maxFilesSize/1000000, -1))),\r\n                 dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\r\n                 cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\r\n                 retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\r\n                 close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\")\r\n             };\r\n\r\n             $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\r\n         },\r\n\r\n         _onProgressFile: function (event) {\r\n\r\n             var that = this;\r\n             var $file = that._getFileItemByUID(event.files[0].uid);\r\n             var percent = event.percentComplete;\r\n\r\n             $(\".k-progress\", $file).css({\r\n                 width: percent + \"%\"\r\n             });\r\n\r\n             $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\r\n\r\n             if (percent === 100){ $(\".k-upload-action .k-icon\", $file).hide(); }\r\n         },\r\n\r\n         _onShowUploadNotifier: function (event) {\r\n\r\n             var that = this,\r\n                files = event.files,\r\n                template = that.options.template;\r\n\r\n             that.loadNotifier.content(template.render({ files: files }));\r\n             that.loadNotifier.wrapper.css({\r\n                 top: \"auto\",\r\n                 left: \"auto\",\r\n                 bottom: \"1em\",\r\n                 right: \"1em\"\r\n             });\r\n\r\n             that.loadNotifier.open();\r\n         },\r\n\r\n        _showNotificationCompleteUpload: function(wrapperMessage, auxNumberFilesSuccess){\r\n            var that = this;\r\n            if( wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\r\n            {\r\n                that._autoHideMessage(wrapperMessage);\r\n            }\r\n        },\r\n\r\n         _autoHideMessage: function(wrapperMessage){\r\n             var that = this;\r\n             setTimeout(function(){\r\n                 wrapperMessage.fadeOut(function(){\r\n                     that.loadNotifier.close();\r\n                 });\r\n             }, 2000);\r\n         },\r\n\r\n         _onCancelFile: function ($target) {\r\n             var that = this,\r\n                 $fileWrapper = $target.closest(\"li\"),\r\n                 $uploadWrapper = that.upload.wrapper,\r\n                 guid = $fileWrapper.data(\"guid\");\r\n\r\n             $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRemoveFile: function ($target) {\r\n             var $fileWrapper = $target.closest(\"li\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRetryFile: function ($target) {\r\n             var that = this;\r\n             var $file = $target.closest(\"li\");\r\n             var guid = $file.data(\"guid\");\r\n             var file = $.grep(that._fileList, function (i) {\r\n                 return i.uid === guid;\r\n             });\r\n\r\n             that.options.retry(file[0]);\r\n         },\r\n\r\n         onErrorFile: function (event) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             file = event.files[0],\r\n             validation = that._isValidFile(file);\r\n             var message = (validation.message !== \"\") ? validation.message : localization.errorUpload;\r\n\r\n             that.setStatus(\"ERROR\", file.uid, message);\r\n         },\r\n\r\n         _isValidFile: function (file) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             valid = true,\r\n             message = \"\";\r\n\r\n             if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0 ) {\r\n                 message = localization.errorSize;\r\n                 valid = false;\r\n             }\r\n\r\n             if(!that._onlyValidateServerFileExtension){\r\n                 if ($.inArray(file.extension, that._supportFileExt) === -1) {\r\n                     message = localization.errorSecurity;\r\n                     valid = false;\r\n                 }\r\n             }\r\n\r\n             return {\r\n                 valid: valid,\r\n                 message: message\r\n             };\r\n         },\r\n\r\n         _filterMaxFilesSize: function (event) {\r\n            \r\n            var that = this;\r\n            var total = 0;\r\n\r\n            for (var i = 0, length = event.files.length; i < length; i++){\r\n                total += event.files[i].size;\r\n            }\r\n            if (total > that._maxFilesSize) {\r\n                that._notifySizeExceeded();\r\n                event.preventDefault();\r\n            } else {\r\n                that._onShowUploadNotifier(event);\r\n            }\r\n         },\r\n\r\n         _notifySizeExceeded: function(){\r\n         \r\n             var that = this;\r\n\r\n             that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\r\n         },\r\n\r\n         _getFileItemByUID: function (uid) {\r\n             var that = this;\r\n             return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\r\n         },\r\n\r\n         _switchEvents: function (event) {\r\n             var that = this;\r\n             var $target = $(\".k-icon\", event.currentTarget);\r\n             if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\r\n                 that._onRemoveFile($target);\r\n             } else if ($target.hasClass(\"k-retry\")) {\r\n                 that._onRetryFile($target);\r\n             } else if ($target.hasClass(\"k-cancel\")) {\r\n                 that._onCancelFile($target);\r\n             }\r\n         },\r\n\r\n         _eventsHandler: function () {\r\n             var that = this;\r\n\r\n             that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\r\n                 that._switchEvents(event);\r\n             });\r\n         },\r\n\r\n         cancelFilesUpload: function(){\r\n             var that = this;\r\n             var $uploadWrapper = that.upload.wrapper;\r\n\r\n             $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\r\n             that.close();\r\n         },\r\n\r\n         close: function () {\r\n             this.loadNotifier.close();\r\n         },\r\n\r\n         destroy: function () {\r\n             this.loadNotifier.destroy();\r\n             this.upload.destroy();\r\n         },\r\n\r\n         setStatus: function (status, uid, message) {\r\n\r\n             var $file = this._getFileItemByUID(uid),\r\n                 localization = this.options.localization;\r\n\r\n             switch (status) {\r\n                 case \"SUCCESS\":\r\n                     $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\r\n                     $(\".k-errormsg\", $file).text(\"\");\r\n                     break;\r\n                 case \"ERROR\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\r\n                     $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\r\n                     break;\r\n                 case \"RETRY\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\r\n                     $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\r\n                     break;\r\n             }\r\n         }\r\n\r\n     });\r\n\r\n     ui.plugin(ProjectAttachments);\r\n })(jQuery);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Files Controller\r\n *   Author: David Romero Estrada\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.files\", {}, {\r\n    /**\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.plugins = {};\r\n        self.prefixBase64 = \"data:image/png;base64,\";\r\n        self.usersData = {};\r\n        self.currentFilesList = [];\r\n        self.fileDateInterval;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-files\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-wrapper\"),\r\n            \"project-files-uploaditem\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-uploaditem\"),\r\n            \"project-files-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-list\"),\r\n            \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\")\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var templateHomeFiles = self.getTemplate(\"project-files\");\r\n        self.content = templateHomeFiles.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) });\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n    * Post render and links events with handlers\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n        $.when(self.renderFilesList()).done(function () {\r\n            self.plugins[\"uploadFiles\"] = self.initializeUploadFiles();\r\n            self.eventsHandler();\r\n            self.restrictedEventsHandler();\r\n        });\r\n    },\r\n\r\n    /**\r\n    *   Render Files List\r\n    */\r\n    renderFilesList: function () {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        var filesLength = self.currentFilesList.length;\r\n        var params = {\r\n            globalParent: encodeURIComponent(self.radNumber),\r\n            dateTime: (!filesLength) ? self.getDateServer() : self.currentFilesList[filesLength - 1].date,\r\n            count: 12\r\n        };\r\n        if(self.params.flowContext ===\"FLOW-DECONTEXTUALIZED-PLANS\"){\r\n            params.globalParent = self.params.plan.id;\r\n        }\r\n        $.when(self.dataService.getFilesListByRadNumber(params)).done(function (files) {\r\n            self.currentFilesList = self.currentFilesList.concat(files);\r\n\r\n            self.renderFiles(files);\r\n\r\n            defer.resolve();\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n    * Render Files\r\n    */\r\n    renderFiles: function(files) {\r\n        \r\n        var self = this;\r\n\r\n        var $content = self.getContent();\r\n        var $showMoreWrapper = $(\"#project-files-showmore\", $content);\r\n        self.displayFileList(files, \"append\");\r\n        self.updateRelativeTime();\r\n\r\n        if (files.length) {\r\n            self.setAdditionalData(files);\r\n        }\r\n\r\n        if (self.currentFilesList.length >= 12) {\r\n            $showMoreWrapper.show();\r\n\r\n            if (files.length < 12) {\r\n                $(\"button\", $showMoreWrapper).remove();\r\n                $(\"#project-files-nomore\", $showMoreWrapper).show();\r\n            }\r\n        }\r\n\r\n        self.notifyFilesNumber(false);\r\n    },\r\n\r\n    /**\r\n    * Render no files\r\n    */\r\n    renderNoFiles: function(){\r\n        \r\n        var self = this;\r\n        var noFilesTmpl = self.workportalFacade.getTemplate(\"info-message\");\r\n        var message = self.resources.getResource(\"workportal-project-files-noavailable\");\r\n\r\n       /* self.disableSideBar();*/\r\n\r\n        var $noFiles = $.tmpl(noFilesTmpl, {\r\n            message: message\r\n        });\r\n\r\n        self.content.html($noFiles);\r\n    },\r\n\r\n    /**\r\n    * Initialize upload files\r\n    */\r\n    initializeUploadFiles: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        return $(\"#project-files-upload\", content).kendoProjectAttachments({\r\n            saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\r\n            template: self.getTemplate(\"project-attachments\"),\r\n            success: $.proxy(self.onSuccessFile, self),\r\n            upload: $.proxy(self.addFileData, self),\r\n            retry: $.proxy(self.onSaveFileData, self),\r\n            enabled: true,\r\n            extensions: self.supportFileExt,\r\n            maxSize: self.uploadMaxFilesSize\r\n        }).data(\"kendoProjectAttachments\");\r\n    },\r\n\r\n    /**\r\n    * Set Additional Data For Files\r\n    */\r\n    setAdditionalData: function (files) {\r\n\r\n        var self = this;\r\n        var thumbnails = [], users = [], guidsUsers = [];\r\n\r\n        for (var i = 0, length = files.length - 1; i <= length; i++) {\r\n            users.push(files[i].user);\r\n            guidsUsers.push(files[i].user);\r\n            thumbnails.push(files[i].attachment.guid);\r\n        }\r\n\r\n        self.setUserData(guidsUsers.join());\r\n        self.setThumbnails(thumbnails.join());\r\n    },\r\n\r\n    /**\r\n    * Set User Data\r\n    */\r\n    setUserData: function (users) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        var params = {\r\n            usersGuids: users,\r\n            width: 50,\r\n            height: 50\r\n        };\r\n\r\n        $.when(self.dataService.getUsersData(params)).done(function (users) {\r\n            for (var i = 0, length = users.length - 1; i <= length; i++) {\r\n                if(users[i].picture){\r\n                    users[i].picture = self.prefixBase64 + users[i].picture;\r\n                }\r\n                self.usersData[\"id\" + users[i].id] = users[i];\r\n                $(\"#project-files-list .ui-bizagi-wp-project-files-user[data-userId=\" + users[i].id + \"]\", $content).text(users[i].name);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Get file list \r\n    */\r\n    getFileInfoByGuid: function (guid) {\r\n        var self = this;\r\n        var file;\r\n        for (var i = 0, length = self.currentFilesList.length; i < length; i++) {\r\n\r\n            if (guid === self.currentFilesList[i].guid) {\r\n                file = self.currentFilesList[i];\r\n                i = length;\r\n            }\r\n        }\r\n        return file;\r\n    },\r\n\r\n    /**\r\n    * Set Thumbnails\r\n    */\r\n    setThumbnails: function (thumbnails) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        var params = {\r\n            guids: thumbnails,\r\n            width: 480,\r\n            height: 150\r\n        };\r\n\r\n        $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\r\n            var thumbnail, $wrapper, $img;\r\n\r\n            $.each(files, function (guid, src) {\r\n                guid = guid.toLowerCase();\r\n                thumbnail = self.prefixBase64 + src;\r\n                $wrapper = $(\"#project-files-list .ui-bizagi-wp-project-files-wrapitem[data-attchGuid=\" + guid + \"]\", $content);\r\n                $img = $(\".ui-bizagi-wp-project-files-thumbnail\", $wrapper);\r\n\r\n                $img.prop(\"src\", thumbnail);\r\n                $(\".ui-bizagi-wp-project-files-icon\", $wrapper).remove();\r\n                $img.css(\"display\", \"block\");\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Set Preview\r\n    */\r\n    setFilePreview: function ($target, guidAttch, guidFile) {\r\n\r\n        var self = this;\r\n        var img = \"\";\r\n        var params = {\r\n            guids: [guidAttch].join(),\r\n            width: 500,\r\n            height: 500\r\n        };\r\n\r\n        $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\r\n            var $userTag = $target.find(\".ui-bizagi-wp-project-files-user\");\r\n            var userId = $userTag.data(\"userid\");\r\n\r\n            $.each(files, function (guid, src) {\r\n                img = self.prefixBase64 + src;\r\n            });\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"FILEPREVIEW\",\r\n                args: {\r\n                    radNumber: encodeURIComponent(self.radNumber),\r\n                    fileData: self.getFileInfoByGuid(guidFile),\r\n                    userData: self.usersData[\"id\" + userId],\r\n                    isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\r\n                    img: img\r\n                }\r\n            });\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"OPEN_RIGHT_SIDEBAR\"\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n    *  On Success File\r\n    */\r\n    onSuccessFile: function (event) {\r\n\r\n        var self = this;\r\n        var status = (event.XMLHttpRequest.response) ? JSON.parse(event.XMLHttpRequest.response) : {};\r\n\r\n        if (!status.error) {\r\n            self.onSaveFileData(event.files[0]);\r\n        } else {\r\n            self.plugins[\"uploadFiles\"].onErrorFile(event);\r\n        }\r\n    },\r\n\r\n    /**\r\n    * On Save File Data\r\n    */\r\n    onSaveFileData: function (file) {\r\n\r\n        var self = this;\r\n\r\n        $.when(self.saveFileData(file)).done(function () {\r\n            self.notifyFilesNumber();\r\n            self.plugins[\"uploadFiles\"].setStatus(\"SUCCESS\", file.uid);\r\n        }).fail(function () {\r\n            self.plugins[\"uploadFiles\"].setStatus(\"RETRY\", file.uid);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Retry file\r\n     * @param $target\r\n     */\r\n    onRetryFile: function ($target) {\r\n        var self = this;\r\n        var $file = $target.closest(\"li\");\r\n        var guid = $file.data(\"guid\");\r\n\r\n        var file = $.grep(self.currentFilesList, function (i) {\r\n            return i.uid === guid;\r\n        });\r\n\r\n        self.onSaveFileData($file, file[0]);\r\n    },\r\n\r\n    /**\r\n     * Add Guid to Files Data\r\n     * @param event\r\n     */\r\n    addFileData: function (event) {\r\n        var self = this;\r\n\r\n        //add guid to send\r\n        event.data = {\r\n            guid: event.files[0].uid\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Save Files\r\n     * @param file\r\n     * @return {*}\r\n     */\r\n    saveFileData: function (file) {\r\n\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n\r\n        var guid = Math.guid();\r\n        var globalParent = self.radNumber ? self.radNumber.toString() : \"\";\r\n        if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\r\n            globalParent = self.params.plan.id;\r\n        }\r\n\r\n        var params = {\r\n            \"content\": {\r\n                \"guid\": guid,\r\n                \"description\": \"\",\r\n                \"name\": file.name,\r\n                \"attachment\": {\r\n                    \"guid\": file.uid,\r\n                    \"name\": file.name\r\n                },\r\n                \"date\": self.getDateServer(),\r\n                \"user\": bizagi.currentUser.idUser,\r\n                \"globalParent\": globalParent\r\n            },\r\n            \"attachmentsToCreate\": [\r\n                file.uid\r\n            ]\r\n        };\r\n\r\n        self.currentFilesList.unshift(file);\r\n\r\n        $.when(self.dataService.createProjectFile(params)).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n\r\n                //extend file data\r\n                $.extend(file, {\r\n                    user: bizagi.currentUser.idUser,\r\n                    userName: bizagi.currentUser.userName,\r\n                    date: new Date().getTime(),\r\n                    attachment: params.content.attachment,\r\n                    guid: params.content.guid,\r\n                    description: params.content.description\r\n                });\r\n\r\n                self.usersData[\"id\" + bizagi.currentUser.idUser] = {\r\n                    picture: bizagi.currentUser.photo,\r\n                    name: bizagi.currentUser.userName,\r\n                    id: bizagi.currentUser.idUser\r\n                };\r\n\r\n                self.displayFileList(file, \"prepend\");\r\n\r\n                self.updateRelativeTime();\r\n                self.setThumbnails(file.uid);\r\n\r\n                defer.resolve();\r\n            } else {\r\n\r\n                defer.reject();\r\n            }\r\n        });\r\n\r\n        return defer;\r\n    },\r\n\r\n    /**\r\n     * Display File List\r\n     * @param files\r\n     * @param action\r\n     */\r\n    displayFileList: function (files, action) {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"project-files-list\");\r\n        var files = files || self.currentFilesList;\r\n        var content = self.getContent();\r\n        var $filesList = tmpl.render({\r\n            files: files\r\n        });\r\n\r\n        $(\"#project-files-list\", content)[action]($filesList);\r\n        $.equalizeHeights(\".bz-card\");\r\n    },\r\n\r\n    /**\r\n     * Delete file\r\n     * @param event\r\n     * @param params\r\n     */\r\n    deleteFile: function(event, params){\r\n        var self = this;\r\n\r\n        var content = self.getContent();\r\n        $(\"div[data-fileguid='\" + params.args.guid + \"']\", content).remove();\r\n\r\n        self.currentFilesList = self.currentFilesList.filter(function( file ) {\r\n            return file.guid !== params.args.guid;\r\n        });\r\n\r\n        self.notifyFilesNumber(true);\r\n    },\r\n\r\n    /**\r\n     * Update File Data\r\n     * @param event\r\n     * @param params\r\n     */\r\n    updateFileData: function (event, params) {\r\n\r\n        var self = this;\r\n        var file = self.getFileInfoByGuid(params.args.guid);\r\n\r\n        file.description = params.args.description;\r\n    },\r\n\r\n    /**\r\n    * Update relative time\r\n    */\r\n    updateRelativeTime: function () {\r\n\r\n        var self = this;\r\n\r\n        if (self.fileDateInterval) clearInterval(self.fileDateInterval);\r\n\r\n        self.fileDateInterval = setInterval($.proxy(self.changeRelativeTime, self), \"7000\");\r\n    },\r\n\r\n    /**\r\n    * Change Relative Time\r\n    */\r\n    changeRelativeTime: function () {\r\n\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        $(\"#project-files-list .ui-bizagi-wp-project-files-date\", $content).each(function (i, item) {\r\n            var dateTime = $(item).data(\"date\");\r\n            var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(dateTime), null, false);\r\n\r\n            $(item).text(relativeTime);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Filter files by some criteria\r\n     * @param event\r\n     */\r\n    onSelectFiles: function (event) {\r\n\r\n        var self = this,\r\n            bannedFiles = [],\r\n            files = event.files;\r\n\r\n        for (var i = files.length - 1; i >= 0; i--) {\r\n\r\n            if (!self.isValidFile(files[i]).valid) {\r\n                var bannedFile = files.splice(i, i + 1);\r\n                bannedFiles.unshift(bannedFile[0]);\r\n            }\r\n        }\r\n\r\n        if (bannedFiles.length > 0) {\r\n            self.showFilesError(bannedFiles);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Reset widget\r\n     */\r\n    resetWidget: function () {\r\n\r\n        var self = this;\r\n        if(self.plugins[\"uploadFiles\"]){\r\n            self.plugins[\"uploadFiles\"].close();\r\n        }\r\n        self.currentFilesList = [];\r\n        clearInterval(self.fileDateInterval);\r\n    },\r\n\r\n    /**\r\n    * Switch Events\r\n    */\r\n    switchFilesEvents: function (event) {\r\n\r\n        event.stopPropagation();\r\n\r\n        var self = this;\r\n        \r\n        var $target = $(event.target),\r\n            $item = $target.closest(\".ui-bizagi-wp-project-files-wrapitem\");\r\n\r\n        if($item.length) {\r\n            \r\n            var guidAttch = $item.data(\"attchguid\"),\r\n                guidFile = $item.data(\"fileguid\");\r\n\r\n            if ($target.hasClass(\"ui-bizagi-wp-project-files-file\")) {\r\n                var fileName = $target.text();\r\n\r\n                self.dataService.getDownloadAttachment(guidAttch, fileName);\r\n            } else{\r\n                self.setFilePreview($item, guidAttch, guidFile);\r\n            }\r\n        \r\n        } else if ($target.parent().prop(\"id\") === \"project-files-showmore\") {\r\n            self.renderFilesList();\r\n        } else if ($target.prop(\"id\") !== \"project-files-upload\") {\r\n            self.notifyFilesNumber(true)\r\n        }\r\n         \r\n    },\r\n\r\n    /**\r\n     * Show number files to right sidebar\r\n     * @param mandatory\r\n     */\r\n    notifyFilesNumber: function(mandatory){\r\n        var self = this;\r\n\r\n        self.pub(\"notify\", {\r\n            type: \"SETFILESNUMBER\",\r\n            args: {\r\n                filesNumber: self.currentFilesList.length,\r\n                mandatory: mandatory\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Restricted Event Handler\r\n     */\r\n    restrictedEventsHandler: function(){\r\n        var self = this;\r\n        self.content.on(\"click\", $.proxy(self.switchFilesEvents, self));\r\n    },\r\n\r\n    /**\r\n    *  Events Handler\r\n    */\r\n    eventsHandler: function () {\r\n\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        self.sub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\r\n        self.sub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\r\n        self.sub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\r\n\r\n        $content.on(\"click\", $.proxy(self.switchFilesEvents, self));\r\n    },\r\n\r\n    /**\r\n    * Clean\r\n    */\r\n    clean: function(){\r\n        var self = this;\r\n        self.resetWidget();\r\n\r\n        self.unsub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\r\n        self.unsub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\r\n        self.unsub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\r\n\r\n        for (var i in self.plugins) {\r\n            if (self.plugins[i])\r\n                self.plugins[i].destroy();\r\n        }\r\n\r\n        clearInterval(self.fileDateInterval);\r\n        self._super();\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.files\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.files], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project File Preview\r\n *   Author: David Romero Estrada\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.filesPreview\", {}, {\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, notifier, params) {\r\n        var self = this;\r\n\r\n        //Regional\r\n        self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n        self.dialogBox = {};\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n        self.notifier = notifier;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-filespreview-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-wrapper\"),\r\n            \"project-filespreview-preview\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-preview\"),\r\n            \"project-filespreview-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-popup\"),\r\n            \"project-filespreview-thenumber\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-thenumber\")\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var generalTmpl = self.getTemplate(\"project-filespreview-wrapper\");\r\n\r\n        self.content = generalTmpl.render();\r\n\r\n        self.sub(\"SETFILESNUMBER\", $.proxy(self.setFilesNumber, self));\r\n\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n    * links events with handlers\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        self.plugins.fileEdition = self.initPluginPopupEdition();\r\n\r\n        self.form = {\r\n            description: $(\"#ui-bizagi-wp-project-filespreview-popup-description\", self.plugins.fileEdition),\r\n            image: $(\".ui-bizagi-wp-project-popupform-user-image\", self.plugins.fileEdition),\r\n            cancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", self.plugins.fileEdition),\r\n            edit: $(\"#ui-bizagi-wp-project-popupform-action-editfile\", self.plugins.fileEdition)\r\n        };\r\n\r\n        self.eventsHandler();\r\n    },\r\n\r\n    setFilesNumber: function (event, params) {\r\n        var self = this;\r\n        var parameters = params.args;\r\n\r\n        if ($.isEmptyObject(self.currentFile) || parameters.mandatory) {\r\n            var tmpl = self.getTemplate(\"project-filespreview-thenumber\");\r\n            var $filesNumber = tmpl.render({ filesNumber: parameters.filesNumber });\r\n            self.currentFile = {};\r\n            $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html($filesNumber);\r\n        }\r\n    },\r\n\r\n    initPluginPopupEdition: function () {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"project-filespreview-popup\");\r\n\r\n        self.dialogBox.formContent = tmpl.render();\r\n\r\n        return self.dialogBox.formContent;\r\n    },\r\n\r\n    showPreview: function (event, params) {\r\n        var self = this;\r\n        var template = self.getTemplate(\"project-filespreview-preview\");\r\n        self.currentFile = params.args;\r\n\r\n        var content = template.render($.extend(params.args,{idCurrentUser: bizagi.currentUser.idUser}));\r\n\r\n        $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html(content);\r\n        self.applyMenu();\r\n    },\r\n\r\n    setEditionData: function () {\r\n        var self = this;\r\n        self.form.description.val(self.currentFile.fileData.description);\r\n        if(self.currentFile.userData.picture){\r\n            self.form.image.prop(\"src\", self.currentFile.userData.picture);\r\n        }\r\n    },\r\n\r\n    eventsHandler: function () {\r\n        var self = this;\r\n        self.form.cancel.on(\"click\", $.proxy(self.onResetFileForm, self));\r\n        self.form.edit.on(\"click\", $.proxy(self.onSaveEdition, self));\r\n        self.sub(\"FILEPREVIEW\", $.proxy(self.showPreview, self));\r\n    },\r\n\r\n    onSelectMenu: function (event, ui) {\r\n        var self = this;\r\n        if($(event.currentTarget).find(\"i\").length === 0){\r\n            var item = $(ui.item).data(\"item\");\r\n            switch (item) {\r\n                case \"edit\":\r\n                    self.onOpenEdition();\r\n                    break;\r\n                case \"delete\":\r\n                    self.onDeleteFile();\r\n                    break;\r\n                case \"download\":\r\n                    self.onDownloadFile();\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    onDownloadFile: function () {\r\n        var self = this;\r\n        self.dataService.getDownloadAttachment(self.currentFile.fileData.attachment.guid, self.currentFile.fileData.name);\r\n    },\r\n\r\n    onOpenEdition: function () {\r\n        var self = this;\r\n\r\n        self.dialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"650px\",\r\n            modal: true,\r\n            title: bizagi.localization.getResource(\"workportal-project-files-editfile\"),\r\n            maximize: true,\r\n            close: function () {\r\n                self.onResetFileForm();\r\n            }\r\n        });\r\n\r\n        self.setEditionData();\r\n        self.form.description.focus();\r\n    },\r\n\r\n    onDeleteFile: function(){\r\n        var self = this;\r\n        $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-file-querydelete\"), \"\", \"info\")).done(function () {\r\n            var params = {\r\n                content: {\r\n                    guid: self.currentFile.fileData.guid\r\n                },\r\n                attachmentsToDelete: [self.currentFile.fileData.attachment.guid]\r\n            };\r\n\r\n            $.when(self.dataService.deleteFile(params)).always(function (response) {\r\n                if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                    self.pub(\"notify\", {\r\n                        type: \"DELETEFILE\",\r\n                        args: {\r\n                            guid: params.content.guid\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    onSaveEdition: function () {\r\n        var self = this;\r\n        if (self.validateAddFileDescriptionForm(self.form.description)) {\r\n            self.currentFile.fileData.description = self.form.description.val();\r\n\r\n            var params = {\r\n                \"content\": {\r\n                    \"guid\": self.currentFile.fileData.guid,\r\n                    \"description\": self.currentFile.fileData.description,\r\n                    \"attachment\": self.currentFile.fileData.attachment,\r\n                    \"name\": self.currentFile.fileData.name,\r\n                    \"date\": self.currentFile.fileData.date,\r\n                    \"user\": bizagi.currentUser.idUser,\r\n                    \"globalParent\": self.currentFile.radNumber\r\n                }\r\n            };\r\n\r\n            $.when(self.dataService.updateProjectFile(params)).always(function (response) {\r\n                if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                    $(\"#ui-bizagi-wp-project-filespreview-description\", self.content).text(params.content.description);\r\n\r\n                    self.onResetFileForm();\r\n                    self.notifier.showSucessMessage(\r\n                       printf(bizagi.localization.getResource(\"workportal-project-files-editionsuccess\"), \"\"));\r\n\r\n                    self.pub(\"notify\", {\r\n                        type: \"UPDATEFILE\",\r\n                        args: {\r\n                            description: params.content.description,\r\n                            guid: params.content.guid\r\n                        }\r\n                    });\r\n                } else {\r\n                    self.onResetFileForm();\r\n                    self.notifier.showErrorMessage(\r\n                       printf(bizagi.localization.getResource(\"workportal-general-error-generic\"), \"\"));\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    validateAddFileDescriptionForm: function($description){\r\n        var result = false,\r\n            $textAreadescription = $description ;\r\n        if($textAreadescription.val().trim() === \"\"){\r\n            var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\r\n            $textAreadescription.parent().next().find(\"span\").html(descriptionValidation);\r\n        }\r\n        else{\r\n            $textAreadescription.parent().next().find(\"span\").empty();\r\n            result = true;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    onResetFileForm: function () {\r\n        var self = this;\r\n        self.form.description.parent().next().find(\"span\").empty();\r\n        self.dialogBox.formContent.dialog(\"destroy\");\r\n        self.dialogBox.formContent.detach();\r\n    },\r\n\r\n    applyMenu: function () {\r\n        var self = this;\r\n\r\n        $(\".ui-bizagi-wp-project-filespreview-edit\", self.content).menu({\r\n            select: $.proxy(self.onSelectMenu, self)\r\n        }).removeClass(\"ui-widget-content\");\r\n    },\r\n\r\n    clean: function () {\r\n        var self = this;\r\n\r\n        self.plugins = {};\r\n        self.form = {};\r\n        self.currentFile = {};\r\n        self.filesNumber = 0;\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.filesPreview\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.filesPreview]);","/*\r\n *   Name: Bizagi Workportal project File Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.file.sidebar\", {}, {\r\n\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        params = params || {};\r\n        params.supportNav = false;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-file-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.file.sidebar\").concat(\"#project-file-sidebar\")\r\n        });\r\n\r\n    },\r\n\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR;\r\n    },\r\n\r\n    /*\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n\r\n        var template = self.getTemplate(\"project-file-sidebar\");\r\n        self.content = template.render({});\r\n\r\n        return self.content;\r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.file.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.file.sidebar], true);"]}