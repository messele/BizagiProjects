{"version":3,"sources":["jquery/workportal/desktop/widget/project.plan.activity.sidebar/bizagi.workportal.desktop.widgets.project.plan.activity.sidebar.js","jquery/workportal/desktop/widget/project.plan.activity.action/bizagi.workportal.desktop.widgets.project.plan.activity.action.js","jquery/workportal/desktop/widget/project.plan.activity.time/bizagi.workportal.desktop.widgets.project.plan.activity.time.js","jquery/workportal/desktop/widget/project.plan.activity.progress/bizagi.workportal.desktop.widgets.project.plan.activity.progress.js","jquery/workportal/desktop/widget/project.plan.activity.subprocesses/bizagi.workportal.desktop.widgets.project.plan.activity.subprocesses.js","jquery/workportal/desktop/widget/project.plan.activity.parent/bizagi.workportal.desktop.widgets.project.plan.activity.parent.js","jquery/workportal/desktop/widget/project.plan.activity.users/bizagi.workportal.desktop.widgets.project.plan.activity.users.js","jquery/workportal/desktop/widget/project.dashboard.menu.activity.plan/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.plan.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.files/bizagi.workportal.desktop.widgets.project.files.js","jquery/workportal/desktop/widget/project.filesPreview/bizagi.workportal.desktop.widgets.project.filesPreview.js","jquery/workportal/desktop/widget/project.file.sidebar/bizagi.workportal.desktop.widgets.project.file.sidebar.js"],"names":["bizagi","workportal","widgets","project","base","extend","init","workportalFacade","dataService","serviceloadDataPlan","params","self","this","_super","loadTemplates","project-plan-activity-sidebar","getTemplate","concat","renderContent","template","content","render","postRender","sub","$","proxy","onNotifyLoadInfoPlan","event","parans","plan","idActivitySelected","idPlan","id","loadData","getDateServer","subscribe","loadedWithDataActivities","loadedWithDataFirstParent","showContextByMenuDashboard","pub","type","args","clean","unsubscribe","injector","register","activity","sidebar","notifier","dateFormat","localization","getResource","timeFormat","estimatedFinishDateTime","beforeUserAssignedActivity","activity-action-main","activity-action-editionpopup","dialogBox","onNotifyLoadInfoActivityExecution","onNotifyExpandedRightSidebar","$content","getContent","empty","currentActivity","activities","filter","toUpperCase","idUserCreator","currentUser","idUser","userAssigned","argsTemplate","currentActivityName","name","showEditAction","tmpl","append","initilizeActionMenu","initializeTempleteAndEvents","plugins","activityEdition","initPluginPopupEdition","formEditActivity","assignee","date","duration","buttonCancel","buttonUpdate","on","onClickPopupButtonCancel","onClickPopupButtonUpdate","onDeleteDate","onTypeDuration","menu","select","onSelectMenu","removeClass","popupEditActivity","formContent","initializeAutoComplete","element","url","serviceLocator","getUrl","autocomplete","minLength","source","request","response","ajax","data","domain","userName","fullName","term","organization","pag","pagSize","orderField","success","map","users","item","label","user","value","ui","val","IdAssignee","focus","change","initializeDatePicker","datepicker","onSelect","getTime","undefined","util","dateFormatter","getDateFormatByDatePickerJqueryUI","initializeSpiner","desactivateDateByDuration","newValue","target","isNumeric","parseInt","spinner","min","max","placeHolder","spin","keyCode","fieldDurationActive","activateElement","form","currentTarget","find","length","onClickOpenPopupEdition","dialog","resizable","draggable","height","width","modal","title","maximize","open","onOpenPopupEdition","close","onClosePopupEdition","activityDate","isEmpty","estimatedFinishDate","isNaN","formatInvariant","Date","getDateFromInvariant","isMinimumDate","setUserAssignedById","removePopupWidgets","callGetDataUsers","then","responseUsers","preventDefault","next","html","remove","validateParamsOfFormEditActivity","idUserAssigned","updateActivity","progress","startDate","allowEdition","description","finishDate","items","when","editActivityPlan","done","refreshAllWidgets","showSucessMessage","onClickFavorite","favoriteOptions","hasClass","idObject","idCase","favoriteType","addFavorite","favoritesData","guidFavorite","idFavorites","addClass","delFavorite","unsub","messageValidationField","replace","toLowerCase","csvIdUsers","defer","Deferred","userIds","getUsersData","always","resolve","promise","action","widget","EXECUTING_ACTIVITY","FINISHED_ACTIVITY","datePickerRegional","plan-time-main","onNotifyLoadInfoActivitySummary","getStateActivity","time","fromDate","getFormattedDate","getFirstDate","dataProgressWidget","getDataByScenarios","unitTime","auxUnitTime","updateWidget","contentTemplate","relativeTime","getRelativeTime","now","minutes","messageDescripionDifference","keywordResource","messageTime","appendTo","$barRemainingDate","widthNumberDays","css","toString","percentBar","currentState","colorBar","getColorByCreatedAndEstimatedDate","toDate","callGetEffectiveDuration","getColorBar","getPercentBar","getKeywordResourceDescriptionBar","getUnitTime","getUTCDate","dateObj","monthNames","getMonth","formatDate","d","getEffectiveDuration","plan-progress-main","plan-progress-popup-edit","onNotifyUpdateItemFromRender","activityToShow","valuePercentBarComplete","canEdit","popupEditProgress","initPluginPopupEditProgress","formEditProgress","sliderProgress","slider","orientation","range","from","to","step","slide","onChangesliderProgress","each","vals","i","el","numericTextBoxPlugin","format","onChangeNumericTextBoxProgress","decimals","buttonChangeProgress","onShowPopupEditProgress","onClickCancel","onSubmitFormChangeProgress","updateProgressUI","listItems","activityWork","hide","show","text","newPercentProgress","templatePopupEditProgress","onOpenPopupPlan","detach","previusValueProgress","prop","project-subprocesses","project-subprocesses-tootip-custom-properties","subprocesses","plan-parent-main","getPlanParent","planParent","parent","idParent","radNumber","nameParent","displayName","idWorkflow","idWorkItem","idTask","onClickGoToParentCase","routingExecute","closest","usersMap","usersInformation","globalHandlersService","get","usersAssignees","plan-users-main","activityRuning","cvsGuidUsers","activitiesUsers","ownerUserId","ownerUserGuid","push","guidUser","userType","picture","guid","index","userId","userGuid","userAssignedGuid","inArray","justAssignees","addEventHandlersModal","showCreatorInformation","renderUserProfilesAndImages","allUsers","usersAssignee","isOwner","indexOf","isAssignee","usersAdapter","createJsonUserInfo","userCreator","userInfo","username","email","getInitials","userinformation","obj","$li","console","log","not","ev","userSelected","$target","usersActivities","userParam","getIsAssignee","getIsOwner","usertooltip","usersGuids","join","getUsersAssignees","getUserAssignee","tasks","types","actUser","click","stopPropagation","publish","widgetName","BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL","closeVisible","modalParameters","refreshInbox","project-dashboard-menu","contextsLeftSidebarCaseDashboard","forEach","context","updateView","showFormOverview","menuDashboard","showFormActivity","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","showPlanOptionMenu","contextPlanOptionMenu","contextFormActivityOptionMenu","contextualized","siblings","handlerEvents","paramsGetPlan","callGetPlan","responsePlan","loadContentById","$item","autoSave","document","getLevelNavigator","newLevelNavigator","refreshLastItemBreadcrumb","histName","level","getPlan","status","reject","subMenuHandler","$comments","$files","$timeline","toggle","off","dashboard","project-content-dashboard","setTimeout","window","trigger","kendo","Widget","ProjectAttachments","options","that","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","wrapper","multiple","dropZone","maxFilesSize","uploadMaxFileSize","enabled","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","_filterMaxFilesSize","complete","interval","setInterval","_showNotificationCompleteUpload","clearInterval","_onProgressFile","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","notifierTitle","actions","animation","visible","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","Math","round","cancel","retry","$file","_getFileItemByUID","uid","percent","percentComplete","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$fileWrapper","$uploadWrapper","_onRemoveFile","_onRetryFile","file","grep","validation","_isValidFile","message","setStatus","valid","size","extension","total","_notifySizeExceeded","_switchEvents","cancelFilesUpload","destroy","errorUploadiis","plugin","jQuery","prefixBase64","usersData","currentFilesList","fileDateInterval","project-files","project-files-uploaditem","project-files-list","project-attachments","templateHomeFiles","isOpen","parseBoolean","isClosedForAllUsers","renderFilesList","initializeUploadFiles","eventsHandler","restrictedEventsHandler","filesLength","globalParent","encodeURIComponent","dateTime","count","flowContext","getFilesListByRadNumber","renderFiles","$showMoreWrapper","displayFileList","updateRelativeTime","setAdditionalData","notifyFilesNumber","renderNoFiles","noFilesTmpl","resources","$noFiles","kendoProjectAttachments","onSuccessFile","addFileData","onSaveFileData","supportFileExt","uploadMaxFilesSize","thumbnails","guidsUsers","attachment","setUserData","setThumbnails","getFileInfoByGuid","guids","getFilesThumbnails","thumbnail","$wrapper","$img","src","setFilePreview","guidAttch","guidFile","img","fileData","userData","XMLHttpRequest","JSON","parse","saveFileData","fail","onRetryFile","attachmentsToCreate","unshift","createProjectFile","photo","$filesList","equalizeHeights","deleteFile","updateFileData","changeRelativeTime","onSelectFiles","bannedFiles","isValidFile","bannedFile","splice","showFilesError","resetWidget","switchFilesEvents","fileName","getDownloadAttachment","mandatory","filesNumber","project-filespreview-wrapper","project-filespreview-preview","project-filespreview-popup","project-filespreview-thenumber","generalTmpl","setFilesNumber","fileEdition","image","edit","parameters","isEmptyObject","currentFile","$filesNumber","showPreview","idCurrentUser","applyMenu","setEditionData","onResetFileForm","onSaveEdition","onOpenEdition","onDeleteFile","onDownloadFile","showConfirmationBox","attachmentsToDelete","validateAddFileDescriptionForm","updateProjectFile","printf","showErrorMessage","$description","result","$textAreadescription","trim","descriptionValidation","filesPreview","supportNav","project-file-sidebar","getWidgetName","BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal Project Activity Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activity.sidebar\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, serviceloadDataPlan, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.serviceloadDataPlan = serviceloadDataPlan;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-plan-activity-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.sidebar\").concat(\"#project-plan-activity-sidebar\")\r\n      });\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-plan-activity-sidebar\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_PLAN\", $.proxy(self.onNotifyLoadInfoPlan, self));\r\n   },\r\n\r\n    onNotifyLoadInfoPlan: function (event, parans) {\r\n        var self = this;\r\n        if (self.params.plan.idActivitySelected) {\r\n\r\n            var params = {idPlan: self.params.plan.id};\r\n            self.serviceloadDataPlan.loadData(params, self.getDateServer, self.params);\r\n            self.serviceloadDataPlan.subscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n            self.serviceloadDataPlan.subscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n        }\r\n        else {\r\n            if (self.params.showContextByMenuDashboard === \"ACTIVITYPLANPROCESSMAP\" ||\r\n                    self.params.showContextByMenuDashboard === \"ACTIVITYPLANLOG\") {\r\n                self.pub(\"notify\", {\r\n                    type: \"DISABLED_RIGHT_SIDEBAR\"\r\n                });\r\n            }\r\n        }\r\n    },\r\n\r\n    loadedWithDataActivities: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOADED_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PROGRESS_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_ACTIVITY_SUMMARY\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    loadedWithDataFirstParent: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    clean: function(){\r\n        var self = this;\r\n        if(self.serviceloadDataPlan){\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n        }\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.sidebar\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.loadDataPlan\", bizagi.workportal.widgets.project.plan.activity.sidebar], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Action\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activity.action\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, notifier, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.dateFormat = bizagi.localization.getResource(\"dateFormat\");\r\n      self.timeFormat = bizagi.localization.getResource(\"timeFormat\");\r\n      self.estimatedFinishDateTime; //Save complete date and time, because datepicker dont save time\r\n\r\n      self.beforeUserAssignedActivity = \"\";\r\n       self.notifier = notifier;\r\n\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"activity-action-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.action\").concat(\"#project-plan-activity-action\"),\r\n         \"activity-action-editionpopup\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.action\").concat(\"#project-plan-activity-action-editionpopup\")\r\n      });\r\n\r\n      self.dialogBox = {};\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @returns {*|jQuery|HTMLElement}\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.sub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      var $content = self.getContent().empty();\r\n\r\n      var currentActivity = {};\r\n      if(self.params.plan.idActivitySelected){\r\n         currentActivity = self.params.plan.activities.filter(function(activity){\r\n            return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n         })[0];\r\n      }\r\n\r\n      if(self.params.plan.idUserCreator === bizagi.currentUser.idUser || currentActivity.userAssigned == bizagi.currentUser.idUser){\r\n\r\n         var argsTemplate = {};\r\n         argsTemplate.currentActivityName = currentActivity.name;\r\n         argsTemplate.showEditAction = true;\r\n         if(self.params.plan.idUserCreator !== bizagi.currentUser.idUser){\r\n             argsTemplate.showEditAction = false;\r\n         }\r\n\r\n         var tmpl = self.getTemplate(\"activity-action-main\");\r\n         $content.append(tmpl.render(argsTemplate));\r\n\r\n         if(argsTemplate.showEditAction){\r\n             self.initilizeActionMenu();\r\n             self.beforeUserAssignedActivity = currentActivity.userAssigned;\r\n             self.content.append($content);\r\n            self.initializeTempleteAndEvents();\r\n         }\r\n      }\r\n   },\r\n\r\n   initializeTempleteAndEvents: function (){\r\n        var self = this;\r\n        self.plugins = {}; \r\n        self.plugins.activityEdition = self.initPluginPopupEdition();\r\n\r\n        self.formEditActivity = {\r\n            assignee: $(\"#activity-form-assignee\", self.plugins.activityEdition),\r\n            date: $(\"#activity-form-date\", self.plugins.activityEdition),\r\n            duration:  $(\"#activity-form-duration\",self.plugins.activityEdition),\r\n            buttonCancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", self.plugins.activityEdition),\r\n            buttonUpdate: $(\"#ui-bizagi-wp-project-popupform-action-update\", self.plugins.activityEdition)\r\n        };\r\n\r\n        self.formEditActivity.buttonCancel.on(\"click\", $.proxy(self.onClickPopupButtonCancel, self));\r\n        self.formEditActivity.buttonUpdate.on(\"click\", $.proxy(self.onClickPopupButtonUpdate, self));\r\n\r\n        self.formEditActivity.date.on(\"keydown\", $.proxy(self.onDeleteDate, self));\r\n        self.formEditActivity.duration.on(\"keyup\", $.proxy(self.onTypeDuration, self));\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   onNotifyExpandedRightSidebar: function(){\r\n      var self = this;\r\n      self.initilizeActionMenu();\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   initilizeActionMenu: function () {\r\n      var self = this;\r\n      $(\"#ui-bizagi-wp-project-plan-activity-action .menu\", self.content).menu({\r\n         select: $.proxy(self.onSelectMenu, self)\r\n      }).removeClass(\"ui-widget-content\");\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @returns dialogBox.formContent\r\n    */\r\n   initPluginPopupEdition: function () {\r\n      var self = this;\r\n      var popupEditActivity = self.getTemplate(\"activity-action-editionpopup\");\r\n      self.dialogBox.formContent = popupEditActivity.render({});\r\n      return self.dialogBox.formContent;\r\n\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeAutoComplete: function (element) {\r\n        var self = this;\r\n        var url = self.dataService.serviceLocator.getUrl(\"admin-getUsersList\");\r\n\r\n        element.autocomplete({\r\n            minLength: 2,\r\n            source: function (request, response) {\r\n                $.ajax({\r\n                    url: url,\r\n                    data: {\r\n                        domain: \"\",\r\n                        userName: \"\",\r\n                        fullName: request.term,\r\n                        organization: \"\",\r\n                        pag: 1,\r\n                        pagSize: 100,\r\n                        orderField: \"fullName\"\r\n                    },\r\n                    success: function (data) {\r\n                        response($.map(data.users, function (item) {\r\n                            return {\r\n                                label: item.user,\r\n                                value: item.idUser\r\n                            };\r\n                        }));\r\n                    }\r\n                });\r\n            },\r\n            select: function (event, ui) {\r\n                var name = ui.item.label;\r\n                element.val(name);\r\n                self.formEditActivity.IdAssignee = ui.item.value;\r\n                return false;\r\n            },\r\n            focus: function () {\r\n                return false;\r\n            },\r\n            change: function (event, ui){\r\n                if(ui.item === null){\r\n                    self.formEditActivity.IdAssignee = null;\r\n                    self.formEditActivity.assignee.val(\"\");\r\n                }\r\n                return false;\r\n            }\r\n\r\n        });\r\n\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeDatePicker: function (element) {\r\n        var self = this;\r\n        element.datepicker({\r\n            onSelect: function () {\r\n                self.formEditActivity.duration.val(\"\");\r\n                self.estimatedFinishDateTime = self.formEditActivity.date.datepicker(\"getDate\") ? self.formEditActivity.date.datepicker(\"getDate\").getTime() : undefined;\r\n            }\r\n        });\r\n        element.datepicker(\"option\", \"dateFormat\", bizagi.util.dateFormatter.getDateFormatByDatePickerJqueryUI());\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeSpiner: function (element) {\r\n        var self = this;\r\n        function desactivateDateByDuration(event, newValue){\r\n            var value = newValue || $(event.target).val();\r\n            if (bizagi.util.isNumeric(value) && parseInt(value, 10) > 0) {\r\n               self.formEditActivity.date.val(\"\");\r\n               self.estimatedFinishDateTime = undefined;\r\n            } else {\r\n               $(event.target).val(\"\");\r\n            }\r\n        }\r\n\r\n        element.spinner({\r\n            min: 1,\r\n            max: 1000,\r\n            placeHolder: bizagi.localization.getResource(\"workportal-hours\"),\r\n            change: function (event) {\r\n                desactivateDateByDuration(event);\r\n            },\r\n            spin: function( event, ui ) {\r\n                desactivateDateByDuration(event, ui.value);\r\n            }\r\n        });\r\n    },\r\n\r\n   /***\r\n    * Events\r\n    * @param event\r\n    */\r\n\r\n   onDeleteDate: function (event) {\r\n      var self = this;\r\n      if (event.keyCode === 8) {\r\n          $(event.target).val(\"\");\r\n          self.fieldDurationActive(true);\r\n      }\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param event\r\n    */\r\n   onTypeDuration: function (event) {\r\n      var self = this;\r\n      var $target = $(event.target);\r\n      if ($target.val() !== \"\") {\r\n          self.estimatedFinishDateTime = undefined;\r\n      } else {\r\n          self.activateElement(self.form.date);\r\n      }\r\n   },\r\n\r\n    /**\r\n     * When select menu\r\n     * @param event\r\n     * @param ui\r\n     */\r\n   onSelectMenu: function (event, ui) {\r\n      var self = this;\r\n      if($(event.currentTarget).find(\"i\").length === 0){\r\n         var item = $(ui.item).data(\"item\");\r\n         switch (item) {\r\n            case \"edit\":\r\n               self.onClickOpenPopupEdition();\r\n               break;\r\n         }\r\n      }\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   onClickOpenPopupEdition: function () {\r\n        var self = this;\r\n        self.initializeTempleteAndEvents();\r\n        self.dialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"600px\",\r\n            modal: true,\r\n            title: bizagi.localization.getResource(\"workportal-project-plan-title-activity-properties\"),\r\n            maximize: true,\r\n            open: $.proxy(self.onOpenPopupEdition, self),\r\n            close: $.proxy(self.onClosePopupEdition, self)\r\n        });\r\n   },\r\n\r\n    /**\r\n    *\r\n    */\r\n    onOpenPopupEdition: function () {\r\n        var self = this;\r\n        var currentActivity = self.params.plan.activities.filter(function(activity){\r\n            return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n        })[0];\r\n\r\n        var activityDate =  (currentActivity && !bizagi.util.isEmpty(currentActivity.estimatedFinishDate)) ? currentActivity.estimatedFinishDate: \"\";\r\n        if(!isNaN(activityDate)){\r\n            activityDate=bizagi.util.dateFormatter.formatInvariant(new Date(activityDate));\r\n        }\r\n        var estimatedFinishDate = activityDate ? bizagi.util.dateFormatter.getDateFromInvariant(activityDate): \"\";\r\n        var isMinimumDate = estimatedFinishDate instanceof Date ? estimatedFinishDate.getTime() < self.getDateServer() : false;\r\n\r\n        self.initializeAutoComplete(self.formEditActivity.assignee);\r\n        self.initializeDatePicker(self.formEditActivity.date);\r\n        self.initializeSpiner(self.formEditActivity.duration);\r\n\r\n        if (currentActivity.userAssigned) {\r\n            self.setUserAssignedById(currentActivity.userAssigned);\r\n        }\r\n\r\n        self.formEditActivity.date.datepicker(\"option\", \"minDate\", new Date(self.getDateServer()));\r\n\r\n        if (currentActivity.estimatedFinishDate && isMinimumDate) {\r\n            self.formEditActivity.date.datepicker(\"option\", \"minDate\", estimatedFinishDate);//set minimum because, if date is past\r\n        }\r\n\r\n        if (currentActivity.estimatedFinishDate) {\r\n            if (estimatedFinishDate){\r\n                self.formEditActivity.date.datepicker(\"setDate\", estimatedFinishDate);\r\n            }\r\n            self.estimatedFinishDateTime = currentActivity.estimatedFinishDate;\r\n        }\r\n\r\n        if (currentActivity.duration) {\r\n            self.formEditActivity.duration.val(parseInt(currentActivity.duration, 10));\r\n        }\r\n   },\r\n\r\n   /**\r\n    * When close popup edition\r\n    */\r\n   onClosePopupEdition: function(){\r\n      var self = this;\r\n      self.removePopupWidgets();\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param idUser\r\n    */\r\n    setUserAssignedById: function (idUser) {\r\n        var self = this;\r\n        //Show images users\r\n        self.callGetDataUsers(idUser).then(function (responseUsers) {\r\n            self.formEditActivity.assignee.val(responseUsers[0].name);\r\n        });\r\n        self.formEditActivity.IdAssignee = idUser;\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param event\r\n    */\r\n    onClickPopupButtonCancel: function(event){\r\n        var self = this;\r\n        event.preventDefault();\r\n        self.removePopupWidgets();\r\n    },\r\n\r\n    /**\r\n    * Remove popup widgets\r\n    */\r\n    removePopupWidgets: function(){\r\n        var self = this;\r\n        self.formEditActivity.assignee.next().find(\"span\").html(\"\");\r\n        self.dialogBox.formContent.remove();\r\n        $(\"#ui-datepicker-div\").remove();\r\n    },\r\n\r\n   /**\r\n    *  Triggered when click update plan activity\r\n    */\r\n    onClickPopupButtonUpdate: function () {\r\n        var self = this;\r\n        if(self.validateParamsOfFormEditActivity()){\r\n            var currentActivity = self.params.plan.activities.filter(function (activity) {\r\n                return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n            })[0];\r\n            var idUserAssigned =  self.formEditActivity.IdAssignee || bizagi.currentUser.idUser;\r\n            if(self.formEditActivity.duration.val()!=\"\"){\r\n                self.params.plan.activities.filter(function (activity) {\r\n                    return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n                })[0].estimatedFinishDate=\"\";\r\n            }\r\n            var updateActivity = {\r\n                progress: currentActivity.progress,\r\n                id: currentActivity.id,\r\n                startDate: currentActivity.startDate,\r\n                duration: self.formEditActivity.duration.val(),\r\n                userAssigned: idUserAssigned,\r\n                allowEdition: currentActivity.allowEdition,\r\n                description: currentActivity.description,\r\n                name: currentActivity.name,\r\n                idPlan: currentActivity.idPlan,\r\n                estimatedFinishDate: self.estimatedFinishDateTime,\r\n                finishDate: currentActivity.finishDate,\r\n                items: currentActivity.items\r\n            };\r\n            $.when(self.dataService.editActivityPlan(updateActivity)).done(function () {\r\n                currentActivity = $.extend(currentActivity, updateActivity);\r\n                self.removePopupWidgets();\r\n\r\n                if (self.beforeUserAssignedActivity !== self.formEditActivity.IdAssignee) {\r\n                    self.pub(\"notify\", {\r\n                        type: \"ACTIVITYPLANCOMMENTS\",\r\n                        args: $.extend(self.params, {refreshAllWidgets: true})\r\n                    });\r\n                }\r\n                else {\r\n                    self.pub(\"notify\", {\r\n                        type: self.params.showContextByMenuDashboard,\r\n                        args: self.params\r\n                    });\r\n                }\r\n\r\n                self.removePopupWidgets();\r\n                self.notifier.showSucessMessage(bizagi.localization.getResource(\"workportal-project-plan-activity-update-message\"));\r\n            });\r\n        }\r\n    },\r\n\r\n   /***\r\n    * Events\r\n    */\r\n   onClickFavorite: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n      var favoriteOptions = {};\r\n      if ($(event.target).hasClass(\"bz-icon-star-outline\")) {\r\n         favoriteOptions = {\r\n            idObject: self.params.idCase,\r\n            favoriteType: \"CASES\"\r\n         };\r\n         $.when(self.dataService.addFavorite(favoriteOptions)).done(function (favoritesData) {\r\n            self.params.guidFavorite = favoritesData.idFavorites;\r\n            $(event.target).removeClass(\"bz-icon-star-outline\");\r\n            $(event.target).addClass(\"bz-icon-star\");\r\n         });\r\n      }\r\n      else {\r\n         favoriteOptions = {\r\n            idObject: self.params.guidFavorite,\r\n            favoriteType: \"CASES\"\r\n         };\r\n         $.when(self.dataService.delFavorite(favoriteOptions)).done(function () {\r\n            $(event.target).addClass(\"bz-icon-star-outline\");\r\n            $(event.target).removeClass(\"bz-icon-star\");\r\n         });\r\n      }\r\n   },\r\n\r\n   /**\r\n    * Clean events and plugins\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      self.unsub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.unsub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n   },\r\n\r\n   /**\r\n    * Validate form edit plan activity\r\n    * @returns {boolean}\r\n    */\r\n    validateParamsOfFormEditActivity: function(){\r\n        var self = this;\r\n        var userAssigned = self.formEditActivity.assignee;\r\n        if (userAssigned.val() && userAssigned.val() !== \"\" && self.formEditActivity.IdAssignee) {\r\n            return true;\r\n        } else {\r\n            var messageValidationField = bizagi.localization.getResource(\"workportal-general-error-field-required\");\r\n            messageValidationField = messageValidationField.replace(\"{0}\", bizagi.localization.getResource(\"workportal-project-plan-assignee\").toLowerCase());\r\n            userAssigned.next().find(\"span\").html(messageValidationField);\r\n            return false;\r\n        }\r\n    },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n   callGetDataUsers: function (csvIdUsers) {\r\n      var self = this,\r\n         defer = $.Deferred();\r\n      var params = {\r\n         userIds: csvIdUsers,\r\n         width: 50,\r\n         height: 50\r\n      };\r\n\r\n      self.dataService.getUsersData(params).always(function (response) {\r\n         defer.resolve(response);\r\n      });\r\n      return defer.promise();\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.action\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.plan.activity.action]);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Time\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n/***\r\n * TODO IMPORTANT: This widget is development with TDD, test this file when changes\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.time\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    *\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Constants\r\n      self.EXECUTING_ACTIVITY = \"EXECUTING\";\r\n      self.FINISHED_ACTIVITY = \"FINISHED\";\r\n\r\n      //Regional\r\n      self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-time-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.time\").concat(\"#project-plan-activity-time\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivitySummary, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivitySummary: function(event, params){\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.getContent().empty();\r\n\r\n      var currentActivity = self.params.plan.activities.filter(function (activity) {\r\n         return activity.id === self.params.plan.idActivitySelected;\r\n      })[0];\r\n\r\n      if(currentActivity.startDate){\r\n         self.getStateActivity(currentActivity);\r\n\r\n         var argsTemplate = {\r\n            time: {\r\n               fromDate: self.getFormattedDate(new Date(self.getFirstDate(currentActivity)))\r\n            }\r\n         };\r\n         var dataProgressWidget = self.getDataByScenarios(currentActivity, true);\r\n\r\n         $.when(dataProgressWidget.unitTime).done(function(auxUnitTime){\r\n            dataProgressWidget = $.extend(dataProgressWidget, {\r\n               unitTime: auxUnitTime\r\n            });\r\n            self.updateWidget($.extend(argsTemplate.time, dataProgressWidget));\r\n         });\r\n\r\n      }\r\n   },\r\n   updateWidget: function(argsTemplate){\r\n      var self = this;\r\n      var $content = self.getContent().empty();\r\n      var contentTemplate = self.getTemplate(\"plan-time-main\");\r\n\r\n      var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - (argsTemplate.unitTime.minutes * 60 * 1000)), null, false);\r\n\r\n      var messageDescripionDifference = bizagi.localization.getResource(\"workportal-project-activity-state-\" + argsTemplate.keywordResource);\r\n      argsTemplate.messageTime = messageDescripionDifference.replace(\"%s\", relativeTime);\r\n\r\n      contentTemplate\r\n         .render(argsTemplate)\r\n         .appendTo($content);\r\n\r\n      //Begin Adjust status bar next to the number days\r\n      var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\r\n      var widthNumberDays = $(\".remaining-days .days\", $content).width();\r\n      $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\r\n\r\n      var $barCompletedDate = $(\".remaining-days .bar-completed\", $content);\r\n\r\n      $barCompletedDate.css(\"width\", argsTemplate.percentBar + \"%\");\r\n      //End Adjust status bar next to the number days\r\n\r\n   },\r\n   getStateActivity: function(activity){\r\n      var self = this;\r\n      if(activity.finishDate){\r\n         activity.currentState = self.FINISHED_ACTIVITY;\r\n         return self.FINISHED_ACTIVITY;\r\n      }\r\n      else{\r\n         activity.currentState = self.EXECUTING_ACTIVITY;\r\n         return self.EXECUTING_ACTIVITY;\r\n      }\r\n   },\r\n   getFirstDate: function(activity){\r\n      var self = this;\r\n      if(activity.currentState === self.EXECUTING_ACTIVITY){\r\n         return activity.startDate;\r\n      } else{\r\n         return activity.finishDate;\r\n      }\r\n   },\r\n   getDataByScenarios: function(activity){\r\n      var self = this;\r\n      var response = {\r\n         colorBar: null,\r\n         percentBar: 100,\r\n         keywordResource: null,\r\n         unitTime: null\r\n      };\r\n      var params = {};\r\n      switch(activity.currentState){\r\n         case self.EXECUTING_ACTIVITY:\r\n            response.keywordResource = \"opened\";\r\n            response.colorBar = self.getColorByCreatedAndEstimatedDate(activity);\r\n\r\n            params = {\r\n               idUser: bizagi.currentUser.idUser,\r\n               fromDate: activity.startDate,\r\n               toDate: Date.now()\r\n            };\r\n            response.unitTime = self.callGetEffectiveDuration(params);\r\n\r\n            break;\r\n         case self.FINISHED_ACTIVITY:\r\n            response.colorBar = \"Gray\";\r\n            response.keywordResource = \"closed\";\r\n            params = {\r\n               idUser: bizagi.currentUser.idUser,\r\n               fromDate: activity.finishDate,\r\n               toDate: Date.now()\r\n            };\r\n            response.unitTime = self.callGetEffectiveDuration(params);\r\n            break;\r\n      }\r\n      return response;\r\n   },\r\n\r\n   getColorBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).colorBar;\r\n   },\r\n   getPercentBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).percentBar;\r\n   },\r\n   getKeywordResourceDescriptionBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).keywordResource;\r\n   },\r\n   getUnitTime: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).unitTime;\r\n   },\r\n\r\n   getColorByCreatedAndEstimatedDate: function(activity){\r\n      var self = this;\r\n      var response = \"Red\";\r\n      if(activity.estimatedFinishDate) {\r\n         if (Date.now() < activity.estimatedFinishDate) {\r\n            var theSameDay = (new Date()).getUTCDate() === (new Date(activity.estimatedFinishDate)).getUTCDate();\r\n            if(theSameDay){\r\n               response = \"Yellow\";\r\n            }\r\n            else{\r\n               response = \"Green\";\r\n            }\r\n         }\r\n      }\r\n      return response;\r\n   },\r\n\r\n   getFormattedDate: function (dateObj) {\r\n      var self = this;\r\n      var monthsNames = self.datePickerRegional.monthNames;\r\n      var shortMonth = dateObj.getMonth();\r\n\r\n      return monthsNames[shortMonth] + \" \" + bizagi.util.dateFormatter.formatDate(dateObj, \"dd hh:mm tt\", bizagi.localization.getResource(\"datePickerRegional\"));\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n   callGetEffectiveDuration: function(params){\r\n      var self = this;\r\n      var d = $.Deferred();\r\n      $.when(\r\n         self.dataService.getEffectiveDuration(params)\r\n      ).done(function (data) {\r\n            d.resolve(data);\r\n         });\r\n      return d.promise();\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.time\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.time], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Progress\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.progress\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.plugins = {};\r\n      self.dialogBox = {};\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-progress-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.progress\").concat(\"#project-plan-activity-progress\"),\r\n         \"plan-progress-popup-edit\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.progress\").concat(\"#project-plan-activity-edit-progress\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.sub(\"UPDATE_ITEMS_FROM_FORMRENDER\", $.proxy(self.onNotifyUpdateItemFromRender, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      var $content = self.getContent().empty();\r\n\r\n      var activityToShow = self.params.plan.activities.filter(function(activity){\r\n         return activity.id.toUpperCase() == self.params.plan.idActivitySelected.toUpperCase();\r\n      })[0];\r\n\r\n      var argsTemplate = {};\r\n      argsTemplate.valuePercentBarComplete = 0;\r\n      argsTemplate.progress = {\r\n         progress: activityToShow.progress,\r\n         canEdit: (activityToShow.items.length === 0)\r\n      };\r\n\r\n      if(argsTemplate.progress.progress){\r\n         argsTemplate.valuePercentBarComplete = argsTemplate.progress.progress;\r\n      }\r\n\r\n      //Update widget\r\n      var templateMain = self.getTemplate(\"plan-progress-main\");\r\n      templateMain.render(argsTemplate).appendTo($content);\r\n\r\n      self.plugins.popupEditProgress = self.initPluginPopupEditProgress();\r\n\r\n      var popupEditProgress = self.plugins.popupEditProgress;\r\n\r\n      self.formEditProgress = {\r\n         sliderProgress: $(\"#sliderProgress\", popupEditProgress).slider({\r\n            orientation: \"horizontal\",\r\n            range: \"min\",\r\n            max: 100,\r\n            width: 100,\r\n            from: 5,\r\n            to: 50,\r\n            step: 1,\r\n            value: argsTemplate.valuePercentBarComplete,\r\n            slide: $.proxy(self.onChangesliderProgress, self),\r\n            change: $.proxy(self.onChangesliderProgress, self)\r\n         }).each(function () {\r\n            var vals = $(this).slider(\"option\", \"max\") - $(this).slider(\"option\", \"min\");\r\n            for (var i = 0; i <= vals; i += 10) {\r\n               var el = $(\"<label class='step'>\" + (i) + \"</label>\").css(\"left\", (i / vals * 100) + \"%\");\r\n               $(this).append(el);\r\n            }\r\n         }),\r\n         numericTextBoxPlugin: $(\"#inputProgressNumericTextBox\", popupEditProgress).spinner({\r\n            format: \"n0\",\r\n            min: 0,\r\n            max: 100,\r\n            spin: $.proxy(self.onChangeNumericTextBoxProgress, self),\r\n            change: $.proxy(self.onChangeNumericTextBoxProgress, self),\r\n            value: argsTemplate.valuePercentBarComplete,\r\n            decimals: 0\r\n         }),\r\n         buttonChangeProgress: $(\"#button-accept-change-progress\", popupEditProgress),\r\n         buttonCancel: $(\"#button-cancel-change-progress\", popupEditProgress)\r\n      };\r\n\r\n      //Handlers\r\n      $(\".action-open-popup-edit-progress\", $content).on(\"click\", $.proxy(self.onShowPopupEditProgress, self));\r\n\r\n      self.formEditProgress.buttonCancel.on(\"click\", $.proxy(self.onClickCancel, self));\r\n      self.formEditProgress.buttonChangeProgress.on(\"click\", $.proxy(self.onSubmitFormChangeProgress, self));\r\n\r\n      self.updateProgressUI(argsTemplate.valuePercentBarComplete);\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", argsTemplate.valuePercentBarComplete);\r\n\r\n   },\r\n\r\n   onNotifyUpdateItemFromRender: function(event, params){\r\n      var self = this;\r\n      var listItems = params.args.items;\r\n      var activityWork = params.args.activityWork;\r\n\r\n      var progress;      \r\n      if(listItems.length > 0){\r\n         //Hide edit progress\r\n         $(\".action-open-popup-edit-progress\", self.content).hide();\r\n      }else{\r\n         $(\".action-open-popup-edit-progress\", self.content).show();\r\n      }\r\n      //set new progress\r\n      $(\".bz-wp-timestamp span\", self.content).text(activityWork);\r\n      $(\".bz-wp-progress-bar\", self.content).css(\"width\", activityWork + \"%\");\r\n\r\n   },\r\n\r\n   updateProgressUI: function(newPercentProgress){\r\n      var self = this,\r\n         $content = self.getContent();\r\n\r\n      $(\".bz-wp-timestamp span\", $content).text(newPercentProgress);\r\n\r\n      //Begin Adjust status bar next to the number days\r\n      var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\r\n      var widthNumberDays = $(\".remaining-days .days\", $content).width();\r\n      $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\r\n\r\n      var $barCompletedDate = $(\".remaining-days .bar-completed\", $content);\r\n\r\n      $barCompletedDate.css(\"width\", newPercentProgress.toString() + \"%\");\r\n      //End Adjust status bar next to the number days\r\n   },\r\n\r\n   initPluginPopupEditProgress: function () {\r\n      var self = this;\r\n      var templatePopupEditProgress = self.getTemplate(\"plan-progress-popup-edit\");\r\n      self.dialogBox.formContent = templatePopupEditProgress.render();\r\n      return self.dialogBox.formContent;\r\n\r\n   },\r\n   /*\r\n    * UI\r\n    */\r\n\r\n   onShowPopupEditProgress: function(){\r\n      var self = this;\r\n\r\n      self.dialogBox.formContent.dialog({\r\n         resizable: false,\r\n         draggable: false,\r\n         height: \"auto\",\r\n         width: \"600px\",\r\n         modal: true,\r\n         title: bizagi.localization.getResource(\"workportal-project-plan-progress-title\"),\r\n         maximize: true,\r\n         open:  $.proxy(self.onOpenPopupPlan, self),\r\n         close: function () {\r\n            self.dialogBox.formContent.dialog(\"destroy\");\r\n            self.dialogBox.formContent.detach();\r\n         }\r\n      });\r\n\r\n      self.previusValueProgress = self.formEditProgress.sliderProgress.slider(\"value\");\r\n\r\n   },\r\n\r\n   onChangeNumericTextBoxProgress: function (event) {\r\n      var self = this;\r\n      var newValue = self.formEditProgress.numericTextBoxPlugin.spinner(\"value\");\r\n      self.formEditProgress.sliderProgress.slider(\"value\", newValue);\r\n   },\r\n\r\n   onChangesliderProgress: function (event) {\r\n      var self = this;\r\n      var newValue = self.formEditProgress.sliderProgress.slider(\"value\");\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", newValue);\r\n   },\r\n\r\n   onClickCancel: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n\r\n      self.dialogBox.formContent.dialog(\"destroy\");\r\n      self.dialogBox.formContent.detach();\r\n      //return before value progress\r\n      self.formEditProgress.sliderProgress.slider(\"value\", self.previusValueProgress);\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", self.previusValueProgress);\r\n   },\r\n\r\n   onSubmitFormChangeProgress: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n\r\n      self.formEditProgress.buttonChangeProgress.prop(\"disabled\", true);\r\n\r\n      var activityToShow = self.params.plan.activities.filter(function(activity){\r\n         return activity.id == self.params.plan.idActivitySelected;\r\n      })[0];\r\n       var params = $.extend(activityToShow, {\r\n           progress:  self.formEditProgress.numericTextBoxPlugin.spinner(\"value\"),\r\n           idPlan: self.params.plan.id\r\n       });\r\n      $.when(self.dataService.editActivityPlan(params)).done(function () {\r\n         self.formEditProgress.buttonChangeProgress.prop(\"disabled\", false);\r\n         activityToShow.progress = self.formEditProgress.numericTextBoxPlugin.spinner(\"value\");\r\n         self.updateProgressUI(activityToShow.progress);\r\n          self.dialogBox.formContent.dialog(\"destroy\");\r\n          self.dialogBox.formContent.detach();\r\n      });\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.progress\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.progress], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Subprocesses Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.subprocesses\", {}, {\r\n      /*\r\n       *   Constructor\r\n       */\r\n      init: function (workportalFacade, dataService, params) {\r\n         var self = this;\r\n\r\n         // Call base\r\n         self._super(workportalFacade, dataService, params);\r\n\r\n         //Load templates\r\n         self.loadTemplates({\r\n            \"project-subprocesses\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.subprocesses\").concat(\"#project-plan-activity-plan-subprocesses-wrapper\"),\r\n            \"project-subprocesses-tootip-custom-properties\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.subprocesses\").concat(\"#project-activity-plan-subprocesses-tooltip-custom-properties-wrapper\")\r\n         });\r\n      },\r\n\r\n      /*\r\n       * Renders the template defined in the widget\r\n       */\r\n      renderContent: function () {\r\n         var self = this;\r\n         self.content = $(\"<div></div>\");\r\n         return self.content;\r\n      },\r\n\r\n      /*\r\n       * links events with handlers\r\n       */\r\n      postRender: function () {\r\n         var self = this;\r\n      }\r\n   }\r\n);\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.subprocesses\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.subprocesses]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Parent\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.parent\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-parent-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.parent\").concat(\"#project-plan-activity-parent\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      var $content = self.getContent().empty();\r\n\r\n         $.when(self.dataService.getPlanParent({idPlan: self.params.plan.id})).done(function (planParent) {\r\n            self.params.plan.parent = planParent;\r\n            if(self.params.plan.parent){\r\n               var argsTemplate = {};\r\n               argsTemplate.parent = {\r\n                  idParent: self.params.plan.parent.radNumber,\r\n                  nameParent: self.params.plan.parent.displayName,\r\n                  idCase: self.params.plan.parent.idCase,\r\n                  idWorkflow: self.params.plan.parent.idWorkflow,\r\n                  idWorkItem: self.params.plan.parent.idWorkItem,\r\n                  idTask: self.params.plan.parent.idTask\r\n               };\r\n\r\n               //Update widget\r\n               var contentTemplate = self.getTemplate(\"plan-parent-main\");\r\n               contentTemplate\r\n                  .render(argsTemplate)\r\n                  .appendTo($content);\r\n\r\n               $(\"#go-to-parent-case\", $content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\r\n            }\r\n         });\r\n\r\n\r\n   },\r\n\r\n   onClickGoToParentCase: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n      self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.parent\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.parent], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Users Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.users\", {}, {\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      self.usersMap = {};\r\n      self.plugins = {};\r\n      self.usersInformation=[];\r\n      self.globalHandlersService = bizagi.injector.get('globalHandlersService');\r\n      self.usersAssignees = [];\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      //The load template the users plan because they are the same\r\n      self.loadTemplates({\r\n         \"plan-users-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.users\").concat(\"#project-plan-users\")\r\n      });\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /*\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n   },\r\n\r\n   /*\r\n    * validate if the activity is running\r\n    */\r\n   activityRuning: function (activity) {\r\n      return activity.startDate !== null && activity.finishDate === null;\r\n   },\r\n\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this,\r\n      cvsGuidUsers = [],\r\n         activitiesUsers = [],\r\n         $content = self.getContent().empty();\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      var ownerUserId = self.params.plan.idUserCreator;\r\n      var ownerUserGuid = self.params.plan.idUserCreator;\r\n\r\n      activitiesUsers.push({ \"idUser\": ownerUserId, \"guidUser\": ownerUserGuid, \"userType\": [\"owner\"] });\r\n      self.usersMap[\"-\" + ownerUserId + \"-\"] = {\r\n         picture: \"\",\r\n         id: ownerUserId,\r\n         guid: ownerUserGuid,\r\n         name: \"\",\r\n         userType: [\"owner\"]\r\n      };\r\n      cvsGuidUsers.push(ownerUserGuid);\r\n      $.each(self.params.plan.activities, function (index, activity) {\r\n         if (self.activityRuning(activity)) {\r\n            var userId = activity.userAssigned;\r\n            var userGuid = activity.userAssignedGuid;\r\n            if (userId === ownerUserId) {\r\n               if($.inArray(\"Assigned\", activitiesUsers[0].userType) === -1){\r\n                  activitiesUsers[0].userType.push(\"Assigned\");\r\n                  self.usersMap[\"-\" + ownerUserId + \"-\"].userType.push(\"Assigned\");\r\n               }\r\n            }\r\n            else {\r\n               self.usersMap[\"-\" + userId + \"-\"] = {\r\n                  picture: \"\",\r\n                  id: userId,\r\n                  name: \"\",\r\n                  userType: [\"Assigned\"]\r\n               };\r\n               if (activitiesUsers.filter(function(user) { return user.idUser == userId; }).length === 0) {\r\n                  var id=userGuid?userGuid:userId;\r\n                  activitiesUsers.push({\"idUser\": id, \"userGuid\": id, \"userType\": [\"Assigned\"]});\r\n                  cvsGuidUsers.push(id);\r\n               }\r\n            }  \r\n         }\r\n      });\r\n      self.activitiesUsers = activitiesUsers;\r\n\r\n      //Update widget\r\n      var contentTemplate = self.getTemplate(\"plan-users-main\");\r\n      contentTemplate\r\n         .render({\r\n            assignee: self.justAssignees(activitiesUsers),\r\n            label: bizagi.localization.getResource(\"workportal-project-plan-assignee\")\r\n         })\r\n         .appendTo($content);\r\n        self.addEventHandlersModal();\r\n      $.when(self.callGetDataUsers(cvsGuidUsers)).then(function () {\r\n         self.showCreatorInformation(ownerUserId);\r\n         self.renderUserProfilesAndImages();\r\n      });\r\n   },\r\n\r\n   /**\r\n    * return standar userAdapter information with only assigned users\r\n    * @param {Array} allUsers \r\n    */\r\n   justAssignees: function (allUsers) {\r\n       var usersAssignee=[];\r\n       allUsers.map(function(user) {\r\n           var isOwner=user.userType.indexOf(\"owner\")!==-1;\r\n           var isAssignee=user.userType.indexOf(\"Assigned\")!==-1;\r\n           usersAssignee.push(usersAdapter.createJsonUserInfo(user.idUser, \"\", \"\", \"\", \"\", \"\", isAssignee, isOwner, [], []));\r\n       });\r\n       return usersAdapter.justAssignees(usersAssignee);\r\n   },\r\n   \r\n   /**\r\n    * show the information of the creator case\r\n    * @param {string} ownerUserId guid user creator\r\n    */\r\n   showCreatorInformation: function (ownerUserId) {\r\n       var self = this;\r\n       var userCreator=self.usersMap[\"-\"+ownerUserId+\"-\"];\r\n       var userInfo = usersAdapter.createJsonUserInfo(\r\n           userCreator.id,\r\n           userCreator.name,\r\n           userCreator.username,\r\n           userCreator.picture?userCreator.picture:undefined,\r\n           userCreator.email,\r\n           userCreator.name.getInitials(),\r\n           false,\r\n           true,\r\n           [],\r\n           []\r\n       );\r\n       self.content.find(\".ui-bizagi-wp-project-plan-users .ui-bizagi-wp-project-users-creator-info\").userinformation(self, { user: userInfo });\r\n   },\r\n\r\n   /**\r\n    * UI\r\n    */\r\n\r\n   renderUserProfilesAndImages: function () {\r\n       var self = this;\r\n       $.each(self.usersMap, function (i, obj) {\r\n           var $li = $(\".ui-bizagi-wp-userlist li[data-iduser=\" + obj.id + \"]\", self.content);\r\n           if (obj.picture !== \"\") {\r\n               $li.find(\"img\").prop(\"src\", obj.picture);\r\n           }\r\n           else {\r\n               $li.find(\"img\").hide();\r\n               if(obj.name!==undefined){\r\n                  $li.find(\"span\").html(obj.name.getInitials());\r\n               }\r\n               else{\r\n                  console.log(\"obj.name is undefined\");\r\n               }\r\n\r\n           }\r\n       });\r\n       $(\".ui-bizagi-wp-userlist li\", self.content).not(\".moreUsers\").on('mouseenter', function (ev) {\r\n         var $target = $(ev.target);  \r\n         var userId = $(this).data(\"iduser\");\r\n         var userSelected;\r\n         $.each(self.usersMap, function (i, obj) {\r\n            if(obj.id === userId)\r\n               userSelected=obj;\r\n        });\r\n         var usersActivities=self.usersAssignees.find(function(assignee) {\r\n            return assignee.userAssigned === userSelected.id;\r\n         });\r\n         var activities=[];\r\n         if(usersActivities)\r\n            usersActivities.activities.map(function(activity) {\r\n               activities.push(activity.name);\r\n            });\r\n         var userParam = usersAdapter.createJsonUserInfo(userSelected.id, userSelected.name, userSelected.username, userSelected.picture, userSelected.email, userSelected.name.getInitials(), self.getIsAssignee(userSelected), self.getIsOwner(userSelected), activities, undefined);\r\n                     \r\n         $target.parent().usertooltip(self,{target:$target,user:userParam});\r\n      });\r\n   },\r\n\r\n   getIsAssignee: function(userSelected){\r\n      if(userSelected.userType.indexOf(\"Assigned\") > -1){\r\n          return true;\r\n      }\r\n      return false;\r\n     },\r\n  \r\n     getIsOwner : function(userSelected){\r\n      if(userSelected.userType.indexOf(\"owner\") > -1){\r\n          return true;\r\n      }\r\n      return false;\r\n     },\r\n   /*\r\n    *  Get data for users\r\n    */\r\n   callGetDataUsers: function (cvsGuidUsers) {\r\n      var self = this,\r\n         params = {},\r\n         defer = $.Deferred();\r\n      params = {\r\n         usersGuids: cvsGuidUsers.join(),\r\n         width: 50,\r\n         height: 50\r\n      };\r\n      $.when(self.dataService.getUsersData(params)).always(function (response) {\r\n        self.usersInformation= response;\r\n         for (var i = 0, length = response.length; i < length; i += 1) {\r\n            if (typeof (response[i].name) === \"undefined\") {\r\n               bizagi.log(response[i] + \" Id Not Found\", response, \"error\");\r\n            } else {\r\n               if(self.usersMap[\"-\" + response[i].id + \"-\"]){\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].picture += (response[i].picture) ? \"data:image/png;base64,\" + response[i].picture : \"\";\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].name = response[i].name || \"\";\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].username = response[i].username || \"\";\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].email = response[i].email || \"\";\r\n               }\r\n               else{\r\n                  console.log(\"The object is undefined\");\r\n               }\r\n            }\r\n         }\r\n         self.getUsersAssignees();\r\n         defer.resolve();\r\n      });\r\n      return defer.promise();\r\n   },\r\n\r\ngetUsersAssignees: function(){\r\n    var self = this;\r\n    for(var i=0; i<self.usersInformation.length; i++){\r\n        self.usersAssignees.push(self.getUserAssignee(self.usersInformation[i]));\r\n    }\r\n\r\n},\r\n\r\ngetUserAssignee: function(user){\r\n    var self =  this;\r\n    var tasks = [];\r\n    $.each(self.params.plan.activities, function (index, activity) {\r\n        var userId = activity.userAssigned;\r\n        if (userId === user.id && self.activityRuning(activity)) {\r\n            tasks.push({ \"name\": activity.name });\r\n        }\r\n    });\r\n    user.tasks = tasks;\r\n    var types = self.activitiesUsers.find(function(actUser) {\r\n        return actUser.idUser == user.id;\r\n    });\r\n    user.userType = types.userType;\r\n\r\n    var userAssignees = usersAdapter.createJsonUserInfo(\r\n        user.id, \r\n        user.name, \r\n        user.username, \r\n        user.picture ? \"data:image/png;base64,\" + user.picture : undefined, \r\n        user.email, \r\n        user.name.getInitials(),\r\n        self.getIsAssignee(user), \r\n        self.getIsOwner(user), \r\n        user.tasks, \r\n        []);\r\n\r\n        return userAssignees;\r\n   },\r\n\r\n   addEventHandlersModal: function () {\r\n    var self =  this;\r\n    $(\".moreUsers\").click(function(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        var usersAssignees = self.usersAssignees || [];\r\n        self.globalHandlersService.publish(\"showDialogWidget\", {\r\n            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL,\r\n            closeVisible: true,\r\n            data: usersAssignees,\r\n            maximize: true,\r\n            modalParameters: {\r\n                title: bizagi.localization.getResource(\"workportal-project-users-title\")+ \" (\"+usersAssignees.length+\")\",\r\n                width: 790,\r\n                height: 526,\r\n                refreshInbox: false\r\n            }\r\n        });\r\n     });\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.users\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.users], true);","/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity Plan\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity.plan\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.plan\").concat(\"#project-dashboard-menu2\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n         self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n\r\n   },\r\n\r\n   /**\r\n    * Update view\r\n    * @param event\r\n    * @param params\r\n    */\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      var argsTemplate = {\r\n         showFormOverview: self.params.menuDashboard.showFormOverview,\r\n         showFormActivity: self.params.menuDashboard.showFormActivity,\r\n         showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu,\r\n         showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\r\n         contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\r\n         contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu,\r\n         contextualized: self.params.plan.contextualized\r\n      };\r\n\r\n      //Update widget\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      template.render(argsTemplate).appendTo($content);\r\n\r\n      if(self.params.showContextByMenuDashboard){\r\n         $(\"li[data-context='\" + event.type.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n      }\r\n\r\n      self.handlerEvents();\r\n\r\n      var paramsGetPlan = {idPlan: self.params.plan.id};\r\n      $.when(self.callGetPlan(paramsGetPlan)).then(function(responsePlan){\r\n         $.extend(self.params.plan, responsePlan);\r\n         self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_PLAN\",\r\n            args: self.params\r\n         });\r\n      });\r\n   },   \r\n\r\n   /**\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if (!$item.hasClass(\"active\")) {\r\n         $.when(bizagi.util.autoSave()).done(function () {\r\n            $(document).data('auto-save', '');\r\n\r\n            var showContextByMenuDashboard = $item.data(\"context\");\r\n            if (showContextByMenuDashboard) {\r\n               var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\"});\r\n               var currentLevelNavigator = parseInt(getLevelNavigator[0]);\r\n               var nameItemNavigator = \"\";\r\n               var newLevelNavigator = currentLevelNavigator;\r\n\r\n               self.params.refreshLastItemBreadcrumb = false;\r\n               self.pub(\"notify\", {\r\n                  type: showContextByMenuDashboard.toUpperCase(),\r\n                  args: $.extend(self.params,{showContextByMenuDashboard: showContextByMenuDashboard,\r\n                     histName: nameItemNavigator,\r\n                     level: newLevelNavigator})\r\n               });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n            }\r\n         });\r\n      }\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n\r\n   callGetPlan: function(params){\r\n      var self = this;\r\n      var defer = $.Deferred();\r\n      self.dataService.getPlan(params).always(function (response) {\r\n         if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n            defer.resolve(response);\r\n         }\r\n         else {\r\n            defer.reject();\r\n         }\r\n      });\r\n\r\n      return defer.promise();\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n       var self = this;\r\n       var content = self.getContent();\r\n       var $comments = $(\"[data-context='ACTIVITYPLANCOMMENTS']\", content);\r\n       var $files = $(\"[data-context='ACTIVITYPLANFILES']\", content);\r\n       var $timeline = $(\"[data-context='ACTIVITYPLANTIMELINE']\", content);\r\n\r\n       $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n           $comments.toggle();\r\n           $files.toggle();\r\n           $timeline.toggle();\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Handler events\r\n    */\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n      self.subMenuHandler();\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\",  $.proxy(self.loadContentById, self));\r\n   },\r\n\r\n   /**\r\n    * Clean widgets and events\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity.plan\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity.plan], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-content-dashboard\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n\r\n      setTimeout(function(){\r\n         $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\r\n      }, 1000);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\r\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\r\n\r\n (function ($) {\r\n\r\n     // shorten references to variables. this is better for uglification \r\n     var kendo = window.kendo,\r\n      ui = kendo.ui,\r\n      Widget = ui.Widget;\r\n\r\n     var ProjectAttachments = Widget.extend({\r\n\r\n         init: function (element, options) {\r\n\r\n             var that = this;\r\n\r\n             // base call to initialize widget\r\n             Widget.fn.init.call(that, element, options);\r\n\r\n             that._maxFilesSize = options.maxSize;\r\n             that._fileList = [];\r\n             that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\r\n             that._supportFileExt = options.extensions;\r\n             that._uploadMaxFilesSize = options.maxSize;\r\n             that.upload = that._initUpload();\r\n             that.loadNotifier = that._initLoadNotifier();\r\n             that.notification = that._initNotification();\r\n\r\n             that._eventsHandler();\r\n\r\n             that._initLocalization(that.options.localization);\r\n         },\r\n\r\n         options: {\r\n             name: \"ProjectAttachments\",\r\n             wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\r\n             multiple: true,\r\n             dropZone: true,\r\n             maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\r\n             enabled: true,\r\n             localization: {}\r\n         },\r\n\r\n         _initUpload: function () {\r\n\r\n             var that = this,\r\n              options = that.options,\r\n              localization = options.localization || {},\r\n              auxNumberFilesSuccess = 0;\r\n\r\n             that._initLocalization(localization);\r\n\r\n             return this.element.kendoUpload({\r\n                 async: {\r\n                     saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\r\n                     autoUpload: true\r\n                 },\r\n                 select: function (event) {\r\n                     that._filterMaxFilesSize(event);\r\n                     auxNumberFilesSuccess = 0;\r\n                 },\r\n                 complete: function(){\r\n                     var interval = setInterval(function(){\r\n                        if( that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0){\r\n                            that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\r\n                            clearInterval(interval);\r\n                        }\r\n                     }, 300);\r\n                 },\r\n                 upload: options.upload,\r\n                 progress: function (event) {\r\n                     that._onProgressFile(event);\r\n                 },\r\n                 success: function (event) {\r\n                     that._fileList.push(event.files[0]);\r\n                     auxNumberFilesSuccess += 1;\r\n                     options.success(event);\r\n                 },\r\n                 error: function (event) {\r\n                     that.onErrorFile(event);\r\n                 },\r\n                 localization: {\r\n                     select: localization.selectFiles,\r\n                     dropFilesHere: localization.dropFilesHere\r\n                 },\r\n                 multiple: options.multiple,\r\n                 enabled: options.enabled,\r\n                 dropZone: options.dropZone,\r\n                 showFileList: false\r\n             }).data(\"kendoUpload\");\r\n\r\n         },\r\n\r\n         _initNotification: function(){\r\n             return $(\"<div></div>\").kendoNotification({\r\n                 position: {\r\n                     pinned: true\r\n                 }\r\n             }).data(\"kendoNotification\");\r\n         },\r\n\r\n         _initLoadNotifier: function () {\r\n\r\n             var that = this,\r\n                    localization = that.options.localization,\r\n                    $wrapper = that.options.wrapper;\r\n\r\n             return $wrapper.kendoWindow({\r\n                 title: localization.notifierTitle,\r\n                 actions: [\"Close\"],\r\n                 animation: {\r\n                     open: {\r\n                         duration: 100\r\n                     },\r\n                     close: {\r\n                         duration: 100\r\n                     }\r\n                 },\r\n                 open: function() {\r\n                     this.wrapper.addClass(\"project-attachments-wrapper-window\");\r\n                 },\r\n                 visible: false,\r\n                 resizable: false,\r\n                 draggable: false,\r\n                 maxHeight: \"300px\",\r\n                 minWidth: \"430px\"\r\n             }).data(\"kendoWindow\");\r\n\r\n         },\r\n\r\n         _initLocalization: function(objectOptionsLocalization){\r\n             var that = this;\r\n             var optionsLocalizationByDefault = {\r\n                 selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\r\n                 notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\r\n                 errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error-type\"),\r\n                 errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\r\n                 errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\r\n                 errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", (Math.round(that._maxFilesSize/1000000, -1))),\r\n                 dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\r\n                 cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\r\n                 retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\r\n                 close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\")\r\n             };\r\n\r\n             $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\r\n         },\r\n\r\n         _onProgressFile: function (event) {\r\n\r\n             var that = this;\r\n             var $file = that._getFileItemByUID(event.files[0].uid);\r\n             var percent = event.percentComplete;\r\n\r\n             $(\".k-progress\", $file).css({\r\n                 width: percent + \"%\"\r\n             });\r\n\r\n             $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\r\n\r\n             if (percent === 100){ $(\".k-upload-action .k-icon\", $file).hide(); }\r\n         },\r\n\r\n         _onShowUploadNotifier: function (event) {\r\n\r\n             var that = this,\r\n                files = event.files,\r\n                template = that.options.template;\r\n\r\n             that.loadNotifier.content(template.render({ files: files }));\r\n             that.loadNotifier.wrapper.css({\r\n                 top: \"auto\",\r\n                 left: \"auto\",\r\n                 bottom: \"1em\",\r\n                 right: \"1em\"\r\n             });\r\n\r\n             that.loadNotifier.open();\r\n         },\r\n\r\n        _showNotificationCompleteUpload: function(wrapperMessage, auxNumberFilesSuccess){\r\n            var that = this;\r\n            if( wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\r\n            {\r\n                that._autoHideMessage(wrapperMessage);\r\n            }\r\n        },\r\n\r\n         _autoHideMessage: function(wrapperMessage){\r\n             var that = this;\r\n             setTimeout(function(){\r\n                 wrapperMessage.fadeOut(function(){\r\n                     that.loadNotifier.close();\r\n                 });\r\n             }, 2000);\r\n         },\r\n\r\n         _onCancelFile: function ($target) {\r\n             var that = this,\r\n                 $fileWrapper = $target.closest(\"li\"),\r\n                 $uploadWrapper = that.upload.wrapper,\r\n                 guid = $fileWrapper.data(\"guid\");\r\n\r\n             $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRemoveFile: function ($target) {\r\n             var $fileWrapper = $target.closest(\"li\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRetryFile: function ($target) {\r\n             var that = this;\r\n             var $file = $target.closest(\"li\");\r\n             var guid = $file.data(\"guid\");\r\n             var file = $.grep(that._fileList, function (i) {\r\n                 return i.uid === guid;\r\n             });\r\n\r\n             that.options.retry(file[0]);\r\n         },\r\n\r\n         onErrorFile: function (event) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             file = event.files[0],\r\n             validation = that._isValidFile(file);\r\n             var message = (validation.message !== \"\") ? validation.message : localization.errorUpload;\r\n\r\n             that.setStatus(\"ERROR\", file.uid, message);\r\n         },\r\n\r\n         _isValidFile: function (file) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             valid = true,\r\n             message = \"\";\r\n\r\n             if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0 ) {\r\n                 message = localization.errorSize;\r\n                 valid = false;\r\n             }\r\n\r\n             if(!that._onlyValidateServerFileExtension){\r\n                 if ($.inArray(file.extension, that._supportFileExt) === -1) {\r\n                     message = localization.errorSecurity;\r\n                     valid = false;\r\n                 }\r\n             }\r\n\r\n             return {\r\n                 valid: valid,\r\n                 message: message\r\n             };\r\n         },\r\n\r\n         _filterMaxFilesSize: function (event) {\r\n            \r\n            var that = this;\r\n            var total = 0;\r\n\r\n            for (var i = 0, length = event.files.length; i < length; i++){\r\n                total += event.files[i].size;\r\n            }\r\n            if (total > that._maxFilesSize) {\r\n                that._notifySizeExceeded();\r\n                event.preventDefault();\r\n            } else {\r\n                that._onShowUploadNotifier(event);\r\n            }\r\n         },\r\n\r\n         _notifySizeExceeded: function(){\r\n         \r\n             var that = this;\r\n\r\n             that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\r\n         },\r\n\r\n         _getFileItemByUID: function (uid) {\r\n             var that = this;\r\n             return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\r\n         },\r\n\r\n         _switchEvents: function (event) {\r\n             var that = this;\r\n             var $target = $(\".k-icon\", event.currentTarget);\r\n             if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\r\n                 that._onRemoveFile($target);\r\n             } else if ($target.hasClass(\"k-retry\")) {\r\n                 that._onRetryFile($target);\r\n             } else if ($target.hasClass(\"k-cancel\")) {\r\n                 that._onCancelFile($target);\r\n             }\r\n         },\r\n\r\n         _eventsHandler: function () {\r\n             var that = this;\r\n\r\n             that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\r\n                 that._switchEvents(event);\r\n             });\r\n         },\r\n\r\n         cancelFilesUpload: function(){\r\n             var that = this;\r\n             var $uploadWrapper = that.upload.wrapper;\r\n\r\n             $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\r\n             that.close();\r\n         },\r\n\r\n         close: function () {\r\n             this.loadNotifier.close();\r\n         },\r\n\r\n         destroy: function () {\r\n             this.loadNotifier.destroy();\r\n             this.upload.destroy();\r\n         },\r\n\r\n         setStatus: function (status, uid, message) {\r\n\r\n             var $file = this._getFileItemByUID(uid),\r\n                 localization = this.options.localization;\r\n\r\n             switch (status) {\r\n                 case \"SUCCESS\":\r\n                     $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\r\n                     $(\".k-errormsg\", $file).text(\"\");\r\n                     break;\r\n                 case \"ERROR\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\r\n                     $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\r\n                     break;\r\n                 case \"RETRY\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\r\n                     $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\r\n                     break;\r\n             }\r\n         }\r\n\r\n     });\r\n\r\n     ui.plugin(ProjectAttachments);\r\n })(jQuery);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Files Controller\r\n *   Author: David Romero Estrada\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.files\", {}, {\r\n    /**\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.plugins = {};\r\n        self.prefixBase64 = \"data:image/png;base64,\";\r\n        self.usersData = {};\r\n        self.currentFilesList = [];\r\n        self.fileDateInterval;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-files\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-wrapper\"),\r\n            \"project-files-uploaditem\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-uploaditem\"),\r\n            \"project-files-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-list\"),\r\n            \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\")\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var templateHomeFiles = self.getTemplate(\"project-files\");\r\n        self.content = templateHomeFiles.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) });\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n    * Post render and links events with handlers\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n        $.when(self.renderFilesList()).done(function () {\r\n            self.plugins[\"uploadFiles\"] = self.initializeUploadFiles();\r\n            self.eventsHandler();\r\n            self.restrictedEventsHandler();\r\n        });\r\n    },\r\n\r\n    /**\r\n    *   Render Files List\r\n    */\r\n    renderFilesList: function () {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        var filesLength = self.currentFilesList.length;\r\n        var params = {\r\n            globalParent: encodeURIComponent(self.radNumber),\r\n            dateTime: (!filesLength) ? self.getDateServer() : self.currentFilesList[filesLength - 1].date,\r\n            count: 12\r\n        };\r\n        if(self.params.flowContext ===\"FLOW-DECONTEXTUALIZED-PLANS\"){\r\n            params.globalParent = self.params.plan.id;\r\n        }\r\n        $.when(self.dataService.getFilesListByRadNumber(params)).done(function (files) {\r\n            self.currentFilesList = self.currentFilesList.concat(files);\r\n\r\n            self.renderFiles(files);\r\n\r\n            defer.resolve();\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n    * Render Files\r\n    */\r\n    renderFiles: function(files) {\r\n        \r\n        var self = this;\r\n\r\n        var $content = self.getContent();\r\n        var $showMoreWrapper = $(\"#project-files-showmore\", $content);\r\n        self.displayFileList(files, \"append\");\r\n        self.updateRelativeTime();\r\n\r\n        if (files.length) {\r\n            self.setAdditionalData(files);\r\n        }\r\n\r\n        if (self.currentFilesList.length >= 12) {\r\n            $showMoreWrapper.show();\r\n\r\n            if (files.length < 12) {\r\n                $(\"button\", $showMoreWrapper).remove();\r\n                $(\"#project-files-nomore\", $showMoreWrapper).show();\r\n            }\r\n        }\r\n\r\n        self.notifyFilesNumber(false);\r\n    },\r\n\r\n    /**\r\n    * Render no files\r\n    */\r\n    renderNoFiles: function(){\r\n        \r\n        var self = this;\r\n        var noFilesTmpl = self.workportalFacade.getTemplate(\"info-message\");\r\n        var message = self.resources.getResource(\"workportal-project-files-noavailable\");\r\n\r\n       /* self.disableSideBar();*/\r\n\r\n        var $noFiles = $.tmpl(noFilesTmpl, {\r\n            message: message\r\n        });\r\n\r\n        self.content.html($noFiles);\r\n    },\r\n\r\n    /**\r\n    * Initialize upload files\r\n    */\r\n    initializeUploadFiles: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        return $(\"#project-files-upload\", content).kendoProjectAttachments({\r\n            saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\r\n            template: self.getTemplate(\"project-attachments\"),\r\n            success: $.proxy(self.onSuccessFile, self),\r\n            upload: $.proxy(self.addFileData, self),\r\n            retry: $.proxy(self.onSaveFileData, self),\r\n            enabled: true,\r\n            extensions: self.supportFileExt,\r\n            maxSize: self.uploadMaxFilesSize\r\n        }).data(\"kendoProjectAttachments\");\r\n    },\r\n\r\n    /**\r\n    * Set Additional Data For Files\r\n    */\r\n    setAdditionalData: function (files) {\r\n\r\n        var self = this;\r\n        var thumbnails = [], users = [], guidsUsers = [];\r\n\r\n        for (var i = 0, length = files.length - 1; i <= length; i++) {\r\n            users.push(files[i].user);\r\n            guidsUsers.push(files[i].user);\r\n            thumbnails.push(files[i].attachment.guid);\r\n        }\r\n\r\n        self.setUserData(guidsUsers.join());\r\n        self.setThumbnails(thumbnails.join());\r\n    },\r\n\r\n    /**\r\n    * Set User Data\r\n    */\r\n    setUserData: function (users) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        var params = {\r\n            usersGuids: users,\r\n            width: 50,\r\n            height: 50\r\n        };\r\n\r\n        $.when(self.dataService.getUsersData(params)).done(function (users) {\r\n            for (var i = 0, length = users.length - 1; i <= length; i++) {\r\n                if(users[i].picture){\r\n                    users[i].picture = self.prefixBase64 + users[i].picture;\r\n                }\r\n                self.usersData[\"id\" + users[i].id] = users[i];\r\n                $(\"#project-files-list .ui-bizagi-wp-project-files-user[data-userId=\" + users[i].id + \"]\", $content).text(users[i].name);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Get file list \r\n    */\r\n    getFileInfoByGuid: function (guid) {\r\n        var self = this;\r\n        var file;\r\n        for (var i = 0, length = self.currentFilesList.length; i < length; i++) {\r\n\r\n            if (guid === self.currentFilesList[i].guid) {\r\n                file = self.currentFilesList[i];\r\n                i = length;\r\n            }\r\n        }\r\n        return file;\r\n    },\r\n\r\n    /**\r\n    * Set Thumbnails\r\n    */\r\n    setThumbnails: function (thumbnails) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        var params = {\r\n            guids: thumbnails,\r\n            width: 480,\r\n            height: 150\r\n        };\r\n\r\n        $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\r\n            var thumbnail, $wrapper, $img;\r\n\r\n            $.each(files, function (guid, src) {\r\n                guid = guid.toLowerCase();\r\n                thumbnail = self.prefixBase64 + src;\r\n                $wrapper = $(\"#project-files-list .ui-bizagi-wp-project-files-wrapitem[data-attchGuid=\" + guid + \"]\", $content);\r\n                $img = $(\".ui-bizagi-wp-project-files-thumbnail\", $wrapper);\r\n\r\n                $img.prop(\"src\", thumbnail);\r\n                $(\".ui-bizagi-wp-project-files-icon\", $wrapper).remove();\r\n                $img.css(\"display\", \"block\");\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Set Preview\r\n    */\r\n    setFilePreview: function ($target, guidAttch, guidFile) {\r\n\r\n        var self = this;\r\n        var img = \"\";\r\n        var params = {\r\n            guids: [guidAttch].join(),\r\n            width: 500,\r\n            height: 500\r\n        };\r\n\r\n        $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\r\n            var $userTag = $target.find(\".ui-bizagi-wp-project-files-user\");\r\n            var userId = $userTag.data(\"userid\");\r\n\r\n            $.each(files, function (guid, src) {\r\n                img = self.prefixBase64 + src;\r\n            });\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"FILEPREVIEW\",\r\n                args: {\r\n                    radNumber: encodeURIComponent(self.radNumber),\r\n                    fileData: self.getFileInfoByGuid(guidFile),\r\n                    userData: self.usersData[\"id\" + userId],\r\n                    isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\r\n                    img: img\r\n                }\r\n            });\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"OPEN_RIGHT_SIDEBAR\"\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n    *  On Success File\r\n    */\r\n    onSuccessFile: function (event) {\r\n\r\n        var self = this;\r\n        var status = (event.XMLHttpRequest.response) ? JSON.parse(event.XMLHttpRequest.response) : {};\r\n\r\n        if (!status.error) {\r\n            self.onSaveFileData(event.files[0]);\r\n        } else {\r\n            self.plugins[\"uploadFiles\"].onErrorFile(event);\r\n        }\r\n    },\r\n\r\n    /**\r\n    * On Save File Data\r\n    */\r\n    onSaveFileData: function (file) {\r\n\r\n        var self = this;\r\n\r\n        $.when(self.saveFileData(file)).done(function () {\r\n            self.notifyFilesNumber();\r\n            self.plugins[\"uploadFiles\"].setStatus(\"SUCCESS\", file.uid);\r\n        }).fail(function () {\r\n            self.plugins[\"uploadFiles\"].setStatus(\"RETRY\", file.uid);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Retry file\r\n     * @param $target\r\n     */\r\n    onRetryFile: function ($target) {\r\n        var self = this;\r\n        var $file = $target.closest(\"li\");\r\n        var guid = $file.data(\"guid\");\r\n\r\n        var file = $.grep(self.currentFilesList, function (i) {\r\n            return i.uid === guid;\r\n        });\r\n\r\n        self.onSaveFileData($file, file[0]);\r\n    },\r\n\r\n    /**\r\n     * Add Guid to Files Data\r\n     * @param event\r\n     */\r\n    addFileData: function (event) {\r\n        var self = this;\r\n\r\n        //add guid to send\r\n        event.data = {\r\n            guid: event.files[0].uid\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Save Files\r\n     * @param file\r\n     * @return {*}\r\n     */\r\n    saveFileData: function (file) {\r\n\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n\r\n        var guid = Math.guid();\r\n        var globalParent = self.radNumber ? self.radNumber.toString() : \"\";\r\n        if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\r\n            globalParent = self.params.plan.id;\r\n        }\r\n\r\n        var params = {\r\n            \"content\": {\r\n                \"guid\": guid,\r\n                \"description\": \"\",\r\n                \"name\": file.name,\r\n                \"attachment\": {\r\n                    \"guid\": file.uid,\r\n                    \"name\": file.name\r\n                },\r\n                \"date\": self.getDateServer(),\r\n                \"user\": bizagi.currentUser.idUser,\r\n                \"globalParent\": globalParent\r\n            },\r\n            \"attachmentsToCreate\": [\r\n                file.uid\r\n            ]\r\n        };\r\n\r\n        self.currentFilesList.unshift(file);\r\n\r\n        $.when(self.dataService.createProjectFile(params)).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n\r\n                //extend file data\r\n                $.extend(file, {\r\n                    user: bizagi.currentUser.idUser,\r\n                    userName: bizagi.currentUser.userName,\r\n                    date: new Date().getTime(),\r\n                    attachment: params.content.attachment,\r\n                    guid: params.content.guid,\r\n                    description: params.content.description\r\n                });\r\n\r\n                self.usersData[\"id\" + bizagi.currentUser.idUser] = {\r\n                    picture: bizagi.currentUser.photo,\r\n                    name: bizagi.currentUser.userName,\r\n                    id: bizagi.currentUser.idUser\r\n                };\r\n\r\n                self.displayFileList(file, \"prepend\");\r\n\r\n                self.updateRelativeTime();\r\n                self.setThumbnails(file.uid);\r\n\r\n                defer.resolve();\r\n            } else {\r\n\r\n                defer.reject();\r\n            }\r\n        });\r\n\r\n        return defer;\r\n    },\r\n\r\n    /**\r\n     * Display File List\r\n     * @param files\r\n     * @param action\r\n     */\r\n    displayFileList: function (files, action) {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"project-files-list\");\r\n        var files = files || self.currentFilesList;\r\n        var content = self.getContent();\r\n        var $filesList = tmpl.render({\r\n            files: files\r\n        });\r\n\r\n        $(\"#project-files-list\", content)[action]($filesList);\r\n        $.equalizeHeights(\".bz-card\");\r\n    },\r\n\r\n    /**\r\n     * Delete file\r\n     * @param event\r\n     * @param params\r\n     */\r\n    deleteFile: function(event, params){\r\n        var self = this;\r\n\r\n        var content = self.getContent();\r\n        $(\"div[data-fileguid='\" + params.args.guid + \"']\", content).remove();\r\n\r\n        self.currentFilesList = self.currentFilesList.filter(function( file ) {\r\n            return file.guid !== params.args.guid;\r\n        });\r\n\r\n        self.notifyFilesNumber(true);\r\n    },\r\n\r\n    /**\r\n     * Update File Data\r\n     * @param event\r\n     * @param params\r\n     */\r\n    updateFileData: function (event, params) {\r\n\r\n        var self = this;\r\n        var file = self.getFileInfoByGuid(params.args.guid);\r\n\r\n        file.description = params.args.description;\r\n    },\r\n\r\n    /**\r\n    * Update relative time\r\n    */\r\n    updateRelativeTime: function () {\r\n\r\n        var self = this;\r\n\r\n        if (self.fileDateInterval) clearInterval(self.fileDateInterval);\r\n\r\n        self.fileDateInterval = setInterval($.proxy(self.changeRelativeTime, self), \"7000\");\r\n    },\r\n\r\n    /**\r\n    * Change Relative Time\r\n    */\r\n    changeRelativeTime: function () {\r\n\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        $(\"#project-files-list .ui-bizagi-wp-project-files-date\", $content).each(function (i, item) {\r\n            var dateTime = $(item).data(\"date\");\r\n            var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(dateTime), null, false);\r\n\r\n            $(item).text(relativeTime);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Filter files by some criteria\r\n     * @param event\r\n     */\r\n    onSelectFiles: function (event) {\r\n\r\n        var self = this,\r\n            bannedFiles = [],\r\n            files = event.files;\r\n\r\n        for (var i = files.length - 1; i >= 0; i--) {\r\n\r\n            if (!self.isValidFile(files[i]).valid) {\r\n                var bannedFile = files.splice(i, i + 1);\r\n                bannedFiles.unshift(bannedFile[0]);\r\n            }\r\n        }\r\n\r\n        if (bannedFiles.length > 0) {\r\n            self.showFilesError(bannedFiles);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Reset widget\r\n     */\r\n    resetWidget: function () {\r\n\r\n        var self = this;\r\n        if(self.plugins[\"uploadFiles\"]){\r\n            self.plugins[\"uploadFiles\"].close();\r\n        }\r\n        self.currentFilesList = [];\r\n        clearInterval(self.fileDateInterval);\r\n    },\r\n\r\n    /**\r\n    * Switch Events\r\n    */\r\n    switchFilesEvents: function (event) {\r\n\r\n        event.stopPropagation();\r\n\r\n        var self = this;\r\n        \r\n        var $target = $(event.target),\r\n            $item = $target.closest(\".ui-bizagi-wp-project-files-wrapitem\");\r\n\r\n        if($item.length) {\r\n            \r\n            var guidAttch = $item.data(\"attchguid\"),\r\n                guidFile = $item.data(\"fileguid\");\r\n\r\n            if ($target.hasClass(\"ui-bizagi-wp-project-files-file\")) {\r\n                var fileName = $target.text();\r\n\r\n                self.dataService.getDownloadAttachment(guidAttch, fileName);\r\n            } else{\r\n                self.setFilePreview($item, guidAttch, guidFile);\r\n            }\r\n        \r\n        } else if ($target.parent().prop(\"id\") === \"project-files-showmore\") {\r\n            self.renderFilesList();\r\n        } else if ($target.prop(\"id\") !== \"project-files-upload\") {\r\n            self.notifyFilesNumber(true)\r\n        }\r\n         \r\n    },\r\n\r\n    /**\r\n     * Show number files to right sidebar\r\n     * @param mandatory\r\n     */\r\n    notifyFilesNumber: function(mandatory){\r\n        var self = this;\r\n\r\n        self.pub(\"notify\", {\r\n            type: \"SETFILESNUMBER\",\r\n            args: {\r\n                filesNumber: self.currentFilesList.length,\r\n                mandatory: mandatory\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Restricted Event Handler\r\n     */\r\n    restrictedEventsHandler: function(){\r\n        var self = this;\r\n        self.content.on(\"click\", $.proxy(self.switchFilesEvents, self));\r\n    },\r\n\r\n    /**\r\n    *  Events Handler\r\n    */\r\n    eventsHandler: function () {\r\n\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        self.sub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\r\n        self.sub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\r\n        self.sub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\r\n\r\n        $content.on(\"click\", $.proxy(self.switchFilesEvents, self));\r\n    },\r\n\r\n    /**\r\n    * Clean\r\n    */\r\n    clean: function(){\r\n        var self = this;\r\n        self.resetWidget();\r\n\r\n        self.unsub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\r\n        self.unsub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\r\n        self.unsub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\r\n\r\n        for (var i in self.plugins) {\r\n            if (self.plugins[i])\r\n                self.plugins[i].destroy();\r\n        }\r\n\r\n        clearInterval(self.fileDateInterval);\r\n        self._super();\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.files\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.files], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project File Preview\r\n *   Author: David Romero Estrada\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.filesPreview\", {}, {\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, notifier, params) {\r\n        var self = this;\r\n\r\n        //Regional\r\n        self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n        self.dialogBox = {};\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n        self.notifier = notifier;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-filespreview-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-wrapper\"),\r\n            \"project-filespreview-preview\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-preview\"),\r\n            \"project-filespreview-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-popup\"),\r\n            \"project-filespreview-thenumber\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-thenumber\")\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var generalTmpl = self.getTemplate(\"project-filespreview-wrapper\");\r\n\r\n        self.content = generalTmpl.render();\r\n\r\n        self.sub(\"SETFILESNUMBER\", $.proxy(self.setFilesNumber, self));\r\n\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n    * links events with handlers\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        self.plugins.fileEdition = self.initPluginPopupEdition();\r\n\r\n        self.form = {\r\n            description: $(\"#ui-bizagi-wp-project-filespreview-popup-description\", self.plugins.fileEdition),\r\n            image: $(\".ui-bizagi-wp-project-popupform-user-image\", self.plugins.fileEdition),\r\n            cancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", self.plugins.fileEdition),\r\n            edit: $(\"#ui-bizagi-wp-project-popupform-action-editfile\", self.plugins.fileEdition)\r\n        };\r\n\r\n        self.eventsHandler();\r\n    },\r\n\r\n    setFilesNumber: function (event, params) {\r\n        var self = this;\r\n        var parameters = params.args;\r\n\r\n        if ($.isEmptyObject(self.currentFile) || parameters.mandatory) {\r\n            var tmpl = self.getTemplate(\"project-filespreview-thenumber\");\r\n            var $filesNumber = tmpl.render({ filesNumber: parameters.filesNumber });\r\n            self.currentFile = {};\r\n            $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html($filesNumber);\r\n        }\r\n    },\r\n\r\n    initPluginPopupEdition: function () {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"project-filespreview-popup\");\r\n\r\n        self.dialogBox.formContent = tmpl.render();\r\n\r\n        return self.dialogBox.formContent;\r\n    },\r\n\r\n    showPreview: function (event, params) {\r\n        var self = this;\r\n        var template = self.getTemplate(\"project-filespreview-preview\");\r\n        self.currentFile = params.args;\r\n\r\n        var content = template.render($.extend(params.args,{idCurrentUser: bizagi.currentUser.idUser}));\r\n\r\n        $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html(content);\r\n        self.applyMenu();\r\n    },\r\n\r\n    setEditionData: function () {\r\n        var self = this;\r\n        self.form.description.val(self.currentFile.fileData.description);\r\n        if(self.currentFile.userData.picture){\r\n            self.form.image.prop(\"src\", self.currentFile.userData.picture);\r\n        }\r\n    },\r\n\r\n    eventsHandler: function () {\r\n        var self = this;\r\n        self.form.cancel.on(\"click\", $.proxy(self.onResetFileForm, self));\r\n        self.form.edit.on(\"click\", $.proxy(self.onSaveEdition, self));\r\n        self.sub(\"FILEPREVIEW\", $.proxy(self.showPreview, self));\r\n    },\r\n\r\n    onSelectMenu: function (event, ui) {\r\n        var self = this;\r\n        if($(event.currentTarget).find(\"i\").length === 0){\r\n            var item = $(ui.item).data(\"item\");\r\n            switch (item) {\r\n                case \"edit\":\r\n                    self.onOpenEdition();\r\n                    break;\r\n                case \"delete\":\r\n                    self.onDeleteFile();\r\n                    break;\r\n                case \"download\":\r\n                    self.onDownloadFile();\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    onDownloadFile: function () {\r\n        var self = this;\r\n        self.dataService.getDownloadAttachment(self.currentFile.fileData.attachment.guid, self.currentFile.fileData.name);\r\n    },\r\n\r\n    onOpenEdition: function () {\r\n        var self = this;\r\n\r\n        self.dialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"650px\",\r\n            modal: true,\r\n            title: bizagi.localization.getResource(\"workportal-project-files-editfile\"),\r\n            maximize: true,\r\n            close: function () {\r\n                self.onResetFileForm();\r\n            }\r\n        });\r\n\r\n        self.setEditionData();\r\n        self.form.description.focus();\r\n    },\r\n\r\n    onDeleteFile: function(){\r\n        var self = this;\r\n        $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-file-querydelete\"), \"\", \"info\")).done(function () {\r\n            var params = {\r\n                content: {\r\n                    guid: self.currentFile.fileData.guid\r\n                },\r\n                attachmentsToDelete: [self.currentFile.fileData.attachment.guid]\r\n            };\r\n\r\n            $.when(self.dataService.deleteFile(params)).always(function (response) {\r\n                if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                    self.pub(\"notify\", {\r\n                        type: \"DELETEFILE\",\r\n                        args: {\r\n                            guid: params.content.guid\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    onSaveEdition: function () {\r\n        var self = this;\r\n        if (self.validateAddFileDescriptionForm(self.form.description)) {\r\n            self.currentFile.fileData.description = self.form.description.val();\r\n\r\n            var params = {\r\n                \"content\": {\r\n                    \"guid\": self.currentFile.fileData.guid,\r\n                    \"description\": self.currentFile.fileData.description,\r\n                    \"attachment\": self.currentFile.fileData.attachment,\r\n                    \"name\": self.currentFile.fileData.name,\r\n                    \"date\": self.currentFile.fileData.date,\r\n                    \"user\": bizagi.currentUser.idUser,\r\n                    \"globalParent\": self.currentFile.radNumber\r\n                }\r\n            };\r\n\r\n            $.when(self.dataService.updateProjectFile(params)).always(function (response) {\r\n                if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                    $(\"#ui-bizagi-wp-project-filespreview-description\", self.content).text(params.content.description);\r\n\r\n                    self.onResetFileForm();\r\n                    self.notifier.showSucessMessage(\r\n                       printf(bizagi.localization.getResource(\"workportal-project-files-editionsuccess\"), \"\"));\r\n\r\n                    self.pub(\"notify\", {\r\n                        type: \"UPDATEFILE\",\r\n                        args: {\r\n                            description: params.content.description,\r\n                            guid: params.content.guid\r\n                        }\r\n                    });\r\n                } else {\r\n                    self.onResetFileForm();\r\n                    self.notifier.showErrorMessage(\r\n                       printf(bizagi.localization.getResource(\"workportal-general-error-generic\"), \"\"));\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    validateAddFileDescriptionForm: function($description){\r\n        var result = false,\r\n            $textAreadescription = $description ;\r\n        if($textAreadescription.val().trim() === \"\"){\r\n            var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\r\n            $textAreadescription.parent().next().find(\"span\").html(descriptionValidation);\r\n        }\r\n        else{\r\n            $textAreadescription.parent().next().find(\"span\").empty();\r\n            result = true;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    onResetFileForm: function () {\r\n        var self = this;\r\n        self.form.description.parent().next().find(\"span\").empty();\r\n        self.dialogBox.formContent.dialog(\"destroy\");\r\n        self.dialogBox.formContent.detach();\r\n    },\r\n\r\n    applyMenu: function () {\r\n        var self = this;\r\n\r\n        $(\".ui-bizagi-wp-project-filespreview-edit\", self.content).menu({\r\n            select: $.proxy(self.onSelectMenu, self)\r\n        }).removeClass(\"ui-widget-content\");\r\n    },\r\n\r\n    clean: function () {\r\n        var self = this;\r\n\r\n        self.plugins = {};\r\n        self.form = {};\r\n        self.currentFile = {};\r\n        self.filesNumber = 0;\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.filesPreview\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.filesPreview]);","/*\r\n *   Name: Bizagi Workportal project File Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.file.sidebar\", {}, {\r\n\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        params = params || {};\r\n        params.supportNav = false;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-file-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.file.sidebar\").concat(\"#project-file-sidebar\")\r\n        });\r\n\r\n    },\r\n\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR;\r\n    },\r\n\r\n    /*\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n\r\n        var template = self.getTemplate(\"project-file-sidebar\");\r\n        self.content = template.render({});\r\n\r\n        return self.content;\r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.file.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.file.sidebar], true);"]}