{"version":3,"sources":["jquery/workportal/desktop/widget/project.dashboard.menu.plan/bizagi.workportal.desktop.widgets.project.dashboard.menu.plan.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.discussions/bizagi.workportal.desktop.widgets.project.discussions.js","jquery/workportal/desktop/widget/project.plan.sidebar/bizagi.workportal.desktop.widgets.project.plan.sidebar.js","jquery/workportal/desktop/widget/project.discussion.sidebar/bizagi.workportal.desktop.widgets.project.discussion.sidebar.js","jquery/workportal/desktop/widget/project.plan.action/bizagi.workportal.desktop.widgets.project.plan.action.js","jquery/workportal/desktop/widget/project.plan.state/bizagi.workportal.desktop.widgets.project.plan.state.js","jquery/workportal/desktop/widget/project.plan.progress/bizagi.workportal.desktop.widgets.project.plan.progress.js","jquery/workportal/desktop/widget/project.plan.time/bizagi.workportal.desktop.widgets.project.plan.time.js","jquery/workportal/desktop/widget/project.plan.parent/bizagi.workportal.desktop.widgets.project.plan.parent.js","jquery/workportal/desktop/widget/project.plan.users/bizagi.workportal.desktop.widgets.project.plan.users.js"],"names":["bizagi","workportal","widgets","widget","extend","init","workportalFacade","dataService","projectDashboard","params","self","this","_super","loadTemplates","project-dashboard-menu","getTemplate","concat","renderContent","content","$","postRender","contextsLeftSidebarCaseDashboard","forEach","context","sub","proxy","updateView","event","args","clean","$content","getContent","empty","template","menuPlanDashboard","menuDashboard","planState","getPlanState","plan","planChild","argsTemplate","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isVisibleShowTimeLine","render","appendTo","showContextByMenuDashboard","toUpperCase","addClass","siblings","removeClass","handlerEvents","currentState","extraValidationShowTimeLine","loadContentById","preventDefault","$item","target","closest","data","backParentPlan","hasClass","pub","type","subMenuHandler","$comments","$files","$timeline","on","toggle","getLevelNavigator","currentLevelNavigator","parseInt","getParamsByBackFromPlan","typeContext","paramsNotify","off","unsub","injector","register","project","dashboard","menu","project-content-dashboard","setTimeout","window","trigger","ui","kendo","Widget","ProjectAttachments","element","options","that","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","localization","name","wrapper","multiple","dropZone","maxFilesSize","currentUser","uploadMaxFileSize","enabled","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","select","_filterMaxFilesSize","complete","interval","setInterval","find","length","_showNotificationCompleteUpload","clearInterval","progress","_onProgressFile","success","push","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","title","notifierTitle","actions","animation","open","duration","close","visible","resizable","draggable","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","getResource","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","replace","Math","round","cancel","retry","$file","_getFileItemByUID","uid","percent","percentComplete","css","width","text","hide","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$target","$fileWrapper","$uploadWrapper","guid","remove","_onRemoveFile","_onRetryFile","file","grep","i","validation","_isValidFile","message","setStatus","valid","size","undefined","inArray","extension","total","_notifySizeExceeded","show","_switchEvents","currentTarget","cancelFilesUpload","destroy","status","prop","errorUploadiis","plugin","jQuery","base","notifier","typeResource","plugins","dialogBoxDiscussion","attchComments","attchDiscussions","addition","listDataDiscussion","userPictures","commentsList","globalTags","tempTagsBeforeDelete","tempTagsToDelete","keySentenceAddTag","project-discussions","project-discussions-popup","project-discussions-list","project-discussions-comments","project-discussions-attachments","project-attachments","templateHomeDiscussions","$contentWidget","popupDiscussion","initPluginPopupDiscussion","form","buttonShowFormNewDiscussion","subject","description","buttonShowPopupDiscussionToAdd","buttonAddDiscussion","buttonCancel","formDiscussion","attachments","edition","tagsFilter","initPluginTagsFilter","tagsMultiSelect","initPluginTagsMultiSelect","getDiscussions","eventsHandler","restrictedEventsHandler","getDataDiscussions","done","idUsersCreatedDiscussions","map","user","idUsersCreatedComments","property","comments","csvGuidUsers","a","seen","out","len","j","item","removeDuplicateItemsFromArray","idUser","join","getDataUsers","then","renderUserProfilesAndImages","setClassesTagsByDiscussion","onNotifyOpenPopup","showFormAddDiscussion","renderUserProfile","templatePopupDiscussion","formContent","newitemtext","categoriesMultiSelect","isDelete","createNewTag","kendoMultiSelect","change","valuesSelected","value","slice","dataitems","dataSource","tag","indexOf","filter","Boolean","pos","newtag","dataItemAddNew","at","refresh","list","itemData","add","dataBound","_prev","isfound","insert","search","dataTextField","dataValueField","hideOrShowDiscussionsByFilter","autoClose","tagMode","valueClass","validateAddCommentForm","$wrapperForm","result","$textAreaComment","val","trim","commentValidation","parent","next","html","validateAddDiscussionForm","$subjectDiscussion","$descriptionDiscussion","subjectValidation","descriptionValidation","applyFileAttachments","kendoProjectAttachments","serviceLocator","getUrl","onSuccessFile","addFileData","supportFileExt","uploadMaxFilesSize","defer","Deferred","paramsGetDiscussions","globalParent","radNumber","flowContext","id","getDiscussionsData","pipe","response","callForListComments","sortDiscussions","updateTemplateListDiscussion","resolve","promise","usersGuids","height","getUsersData","always","array","splice","arrayUnique","discussions","generalDefer","commentsDefer","addGlobalTags","tags","idParent","dateTime","getDateServer","count","when","getCommentsData","apply","sortedDiscussion","sort","b","dateA","date","unshift","pop","resetDiscussionAttachments","sendDataUpdateDiscussion","filesObj","prepareFilesToSave","tagsDiscussion","getTagsDiscussionBySave","guidsTagsDiscussionToDelete","getGuidsTagsDiscussionToDelete","toString","general","attachmentsToCreate","attachmentsToDelete","editDiscussion","discussion","getDiscussionDataByGUID","onClosePopupDiscussion","removeGlobalTags","showSucessMessage","printf","showErrorMessage","validateStringIsGuid","test","sendDataInsertDiscussion","postDiscussion","newDiscussion","tagsTextSelected","dataSourceTags","tagTextSelected","tagFound","isGuidTextSelected","tagSource","isGuid","differenceArrays","guidsTagsCurrentDiscussion","setStateUIShowMoreComments","$commentsContainer","state","$containerButtonMoreComments","$buttonShowMoreComments","$messageNoMoreComments","$messageLoadingComments","getCurrentUserInfo","userName","picture","createTagsOnServer","iTagAdd","tagGlobal","postTag","guidTagsToDelete","allGuidsMoreGuidsDelete","itemTag","secureGuidsForDelete","guidDelete","guidSecureDelete","idTag","deleteTag","iTagGlobal","iDiscussion","tagsBySpace","templateListDiscussions","contentRenderListDiscussions","listDataDiscussions","isOpen","util","parseBoolean","isClosedForAllUsers","returnServedCommentByParentId","parentId","mapTempComments","append","resourceTitlePopup","dialog","modal","zIndex","maximize","onOpenPopupDiscussion","resetFormDiscussion","userPicture","$parent","$img","$text","attr","getInitials","base64Prefix","iUser","switchCommentsEvents","is","onShowButtonsPanel","onCancelComment","$container","onCreateComment","onViewComment","onViewMoreComments","onRemoveFiles","onEditDiscussion","showConfirmationBox","onDeleteComment","onDownloadAttachment","stopPropagation","setDiscussionsDataByGUID","guidTagsDiscussion","renderAttachments","$commentWrapper","toggleClass","getMoreComments","getCommentsCountByParent","dateLastComment","responseMoreComments","Array","prototype","renderCommentByDiscussion","idUsersLoaded","idUsersNewComments","csvIdUsersMissingLoad","not","get","fail","guidParent","moreComments","$commentsDOM","tmplComment","renderObject","getCommentByGuid","parentGuid","commentGuid","x","lengthx","index","currentFiles","removeFiles","tmpSplice","fileGuid","comment","deleteComment","XMLHttpRequest","JSON","parse","$wrapper","sender","$liTarget","guidAttachment","nameFile","getDownloadAttachment","$commentContainer","$buttonsWrp","$textarea","$uploadForm","$vlTooltip","$fileList","reset","$rplWrp","$addCommentContainer","$uploadList","postComment","newComment","isIE","fileList","onClickCancel","detach","focus","onSubmitFormDiscussion","resetWidget","hasOwnProperty","$source","$textareaSource","$textareaTarget","$uploadListSource","first","$uploadListTarget","serviceloadDataPlan","supportNav","project-plan-sidebar","areTemplatedLoaded","idPlan","loadData","subscribe","loadedWithDataActivities","loadedWithDataFirstParent","unsubscribe","sidebar","project-discussion-sidebar","onShowPopupDiscussion","planTemplateCreate","planPopupEdit","PENDING_PLAN","EXECUTING_PLAN","CLOSED_PLAN","CONTEXT_ACTIVITYPLAN","CONTEXT_ACTIVITYPLANOVERVIEW","CONTEXT_PLANCREATE","CONTEXT_ACTIVITYPLANCREATE","showActionsPlan","plan-action-main","tmpl","stateClosedPlan","currentStatePlan","contextualized","initilizeActionMenu","onClosePlan","onNotifyLoadInfoSummaryPlan","clearAlertsOnFocus","setNamePlan","onNotifyExpandedRightSidebar","setStatePlan","statePlan","namePlan","decodeHtmlEntities","onSelectMenu","onClickMenuOpenEdition","onClickMenuDeletePlan","onClickMenuSaveAsTemplate","planSelected","showPopup","showPopupAddTemplatePlan","callDeletePlan","onSubmitFormPlan","focusout","deletePlan","action","plan-state-main","renderWidget","plan-progress-main","valuePercentBarComplete","calculateProgress","colorBar","$barRemainingDate","widthNumberDays","completedActivities","totalActivities","activities","percentProgress","activity","workItemState","datePickerRegional","plan-time-main","dueDate","updateWidget","planDatesToStamp","estimatedFinishDate","Date","getTime","startDate","finishDate","creationDate","closedDate","getClosedDatePlan","getIntervalOnMinutes","relativeTime","dateFormatter","getRelativeTime","now","minutesToShowTime","messageUnitTimeCalculated","keywordResourceDescriptionDifference","getKeywordDifferenceDates","messageDescripionDifference","valueOfTimeCalculated","auxToDate","getSecondDate","auxPercentBar","getWidthBar","auxColorBar","getColorBarByPercent","fromDate","getFormattedDate","getFirstDate","toDate","percentBar","getLastActivity","stringify","activityA","activityB","getDifferenceBetweenDates","firstDate","secondDate","callGetEffectiveDuration","difference","minutes","minutesNowToDueDate","minutesCreateToNow","minutesDueDateToCreate","minutesCreateToDueDate","minutesStartToNow","minutesDueDateToNow","minutesStartToDueDate","milliseconds","intervalMinutes","differenceStartDateToCurrentDate","totalInterval","valuePercentInterval","ceil","differenceStartDateToClosedDate","d","getEffectiveDuration","dateObj","monthNames","getMonth","formatDate","time","plan-parent-main","parentWorkItem","getPlanParent","planParent","nameParent","displayName","idCase","idWorkflow","idWorkItem","idTask","processName","process","planName","isEmpty","guidActivity","goToParentCase","paramsDetailActivity","idActivity","getActivity","allowEdition","msg","onClickGoToParentCase","routingExecute","usersMap","usersInformation","globalHandlersService","usersAssignees","plan-users-main","auxNoRepeatTypesUser","hashTypesUser","assigned","owner","cvsGuidUsers","activitiesUsers","ownerUserGuid","idUserCreator","ownerUserId","userGuid","userType","each","userId","userAssigned","userAssignedGuid","isRunning","guidUser","assignee","justAssignees","label","initilizeTooltip","addEventHandlersModal","callGetDataUsers","showCreatorInformation","allUsers","usersAssignee","isOwner","isAssignee","usersAdapter","createJsonUserInfo","userCreator","userInfo","username","email","userinformation","obj","$li","console","log","csvguidUsers","getUsersAssignees","activityRuning","res_user","getUserAssignee","tasks","types","actUser","ev","id_userSelected","task","userParam","usertooltip","click","publish","widgetName","BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL","closeVisible","modalParameters","refreshInbox","users"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Plan\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.plan\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, projectDashboard, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n      self.projectDashboard = projectDashboard;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.plan\").concat(\"#project-dashboard-menu\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.sub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n   },\r\n\r\n\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      self.params.menuPlanDashboard = self.params.menuPlanDashboard || {};\r\n      $.extend(self.params.menuPlanDashboard, self.params.menuDashboard);\r\n\r\n      self.planState = self.getPlanState(self.params.plan, self.params.planChild);\r\n      var argsTemplate = {\r\n         planState: self.planState,\r\n         showCommentsOptionMenu: self.params.menuPlanDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuPlanDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuPlanDashboard.showTimeLineOptionMenu && self.isVisibleShowTimeLine(self.planState)\r\n      };\r\n      template.render(argsTemplate).appendTo($content);\r\n       \r\n      $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n\r\n      self.handlerEvents();\r\n   },\r\n\r\n    /**\r\n     * Return planState by plan or planChild\r\n     * @param plan\r\n     * @param planChild\r\n     * @returns {*}\r\n     */\r\n    getPlanState: function(plan, planChild){\r\n        var currentState;\r\n        if(planChild && planChild.currentState){\r\n            currentState = planChild.currentState;\r\n        }\r\n        else if(plan && plan.currentState){\r\n            currentState = plan.currentState;\r\n        }\r\n        return currentState;\r\n    },\r\n\r\n    /**\r\n     * Behavior visible timeline option\r\n     */\r\n    isVisibleShowTimeLine: function(planState){\r\n        var self = this;\r\n        var extraValidationShowTimeLine = true;\r\n        if(planState === \"PENDING\"){\r\n            extraValidationShowTimeLine = false;\r\n        }\r\n        return extraValidationShowTimeLine;\r\n    },\r\n\r\n   /*\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if ($item.data(\"context\") === \"PLANBACK\") {\r\n         self.backParentPlan();\r\n      }\r\n      else{\r\n         if (!$item.hasClass(\"active\")) {\r\n            var showContextByMenuDashboard = $item.data(\"context\");\r\n            if (showContextByMenuDashboard) {\r\n\r\n               self.pub(\"notify\", {\r\n                  type: showContextByMenuDashboard.toUpperCase(),\r\n                  args: $.extend(self.params,{showContextByMenuDashboard: showContextByMenuDashboard})\r\n               });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n            }\r\n         }\r\n      }\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n      var self = this;\r\n      var content = self.getContent();\r\n      var $comments = $(\"[data-context='PLANCOMMENTS']\", content);\r\n      var $files = $(\"[data-context='PLANFILES']\", content);\r\n      var $timeline = $(\"[data-context='PLANTIMELINE']\", content);\r\n\r\n      $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n         $comments.toggle();\r\n         $files.toggle();\r\n         if(self.isVisibleShowTimeLine(self.planState)){\r\n            $timeline.toggle();\r\n         }\r\n      });\r\n   },\r\n\r\n   backParentPlan: function(){\r\n      var self = this;\r\n      //when a plan created from an activity is deleted, not created from a case\r\n      var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\"});\r\n      var currentLevelNavigator = parseInt(getLevelNavigator[0]);\r\n      var params = self.projectDashboard.getParamsByBackFromPlan(self.params, currentLevelNavigator);\r\n\r\n      self.pub(\"notify\", {\r\n         type: params.typeContext,\r\n         args: $.extend(self.params, params.paramsNotify)\r\n      });\r\n\r\n   },\r\n\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      self.subMenuHandler();\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\",  $.proxy(self.loadContentById, self));\r\n   },\r\n\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.plan\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.projectDashboard\", bizagi.workportal.widgets.project.dashboard.menu.plan], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-content-dashboard\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n\r\n      setTimeout(function(){\r\n         $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\r\n      }, 1000);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\r\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\r\n\r\n (function ($) {\r\n\r\n     // shorten references to variables. this is better for uglification \r\n     var kendo = window.kendo,\r\n      ui = kendo.ui,\r\n      Widget = ui.Widget;\r\n\r\n     var ProjectAttachments = Widget.extend({\r\n\r\n         init: function (element, options) {\r\n\r\n             var that = this;\r\n\r\n             // base call to initialize widget\r\n             Widget.fn.init.call(that, element, options);\r\n\r\n             that._maxFilesSize = options.maxSize;\r\n             that._fileList = [];\r\n             that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\r\n             that._supportFileExt = options.extensions;\r\n             that._uploadMaxFilesSize = options.maxSize;\r\n             that.upload = that._initUpload();\r\n             that.loadNotifier = that._initLoadNotifier();\r\n             that.notification = that._initNotification();\r\n\r\n             that._eventsHandler();\r\n\r\n             that._initLocalization(that.options.localization);\r\n         },\r\n\r\n         options: {\r\n             name: \"ProjectAttachments\",\r\n             wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\r\n             multiple: true,\r\n             dropZone: true,\r\n             maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\r\n             enabled: true,\r\n             localization: {}\r\n         },\r\n\r\n         _initUpload: function () {\r\n\r\n             var that = this,\r\n              options = that.options,\r\n              localization = options.localization || {},\r\n              auxNumberFilesSuccess = 0;\r\n\r\n             that._initLocalization(localization);\r\n\r\n             return this.element.kendoUpload({\r\n                 async: {\r\n                     saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\r\n                     autoUpload: true\r\n                 },\r\n                 select: function (event) {\r\n                     that._filterMaxFilesSize(event);\r\n                     auxNumberFilesSuccess = 0;\r\n                 },\r\n                 complete: function(){\r\n                     var interval = setInterval(function(){\r\n                        if( that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0){\r\n                            that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\r\n                            clearInterval(interval);\r\n                        }\r\n                     }, 300);\r\n                 },\r\n                 upload: options.upload,\r\n                 progress: function (event) {\r\n                     that._onProgressFile(event);\r\n                 },\r\n                 success: function (event) {\r\n                     that._fileList.push(event.files[0]);\r\n                     auxNumberFilesSuccess += 1;\r\n                     options.success(event);\r\n                 },\r\n                 error: function (event) {\r\n                     that.onErrorFile(event);\r\n                 },\r\n                 localization: {\r\n                     select: localization.selectFiles,\r\n                     dropFilesHere: localization.dropFilesHere\r\n                 },\r\n                 multiple: options.multiple,\r\n                 enabled: options.enabled,\r\n                 dropZone: options.dropZone,\r\n                 showFileList: false\r\n             }).data(\"kendoUpload\");\r\n\r\n         },\r\n\r\n         _initNotification: function(){\r\n             return $(\"<div></div>\").kendoNotification({\r\n                 position: {\r\n                     pinned: true\r\n                 }\r\n             }).data(\"kendoNotification\");\r\n         },\r\n\r\n         _initLoadNotifier: function () {\r\n\r\n             var that = this,\r\n                    localization = that.options.localization,\r\n                    $wrapper = that.options.wrapper;\r\n\r\n             return $wrapper.kendoWindow({\r\n                 title: localization.notifierTitle,\r\n                 actions: [\"Close\"],\r\n                 animation: {\r\n                     open: {\r\n                         duration: 100\r\n                     },\r\n                     close: {\r\n                         duration: 100\r\n                     }\r\n                 },\r\n                 open: function() {\r\n                     this.wrapper.addClass(\"project-attachments-wrapper-window\");\r\n                 },\r\n                 visible: false,\r\n                 resizable: false,\r\n                 draggable: false,\r\n                 maxHeight: \"300px\",\r\n                 minWidth: \"430px\"\r\n             }).data(\"kendoWindow\");\r\n\r\n         },\r\n\r\n         _initLocalization: function(objectOptionsLocalization){\r\n             var that = this;\r\n             var optionsLocalizationByDefault = {\r\n                 selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\r\n                 notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\r\n                 errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error-type\"),\r\n                 errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\r\n                 errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\r\n                 errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", (Math.round(that._maxFilesSize/1000000, -1))),\r\n                 dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\r\n                 cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\r\n                 retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\r\n                 close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\")\r\n             };\r\n\r\n             $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\r\n         },\r\n\r\n         _onProgressFile: function (event) {\r\n\r\n             var that = this;\r\n             var $file = that._getFileItemByUID(event.files[0].uid);\r\n             var percent = event.percentComplete;\r\n\r\n             $(\".k-progress\", $file).css({\r\n                 width: percent + \"%\"\r\n             });\r\n\r\n             $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\r\n\r\n             if (percent === 100){ $(\".k-upload-action .k-icon\", $file).hide(); }\r\n         },\r\n\r\n         _onShowUploadNotifier: function (event) {\r\n\r\n             var that = this,\r\n                files = event.files,\r\n                template = that.options.template;\r\n\r\n             that.loadNotifier.content(template.render({ files: files }));\r\n             that.loadNotifier.wrapper.css({\r\n                 top: \"auto\",\r\n                 left: \"auto\",\r\n                 bottom: \"1em\",\r\n                 right: \"1em\"\r\n             });\r\n\r\n             that.loadNotifier.open();\r\n         },\r\n\r\n        _showNotificationCompleteUpload: function(wrapperMessage, auxNumberFilesSuccess){\r\n            var that = this;\r\n            if( wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\r\n            {\r\n                that._autoHideMessage(wrapperMessage);\r\n            }\r\n        },\r\n\r\n         _autoHideMessage: function(wrapperMessage){\r\n             var that = this;\r\n             setTimeout(function(){\r\n                 wrapperMessage.fadeOut(function(){\r\n                     that.loadNotifier.close();\r\n                 });\r\n             }, 2000);\r\n         },\r\n\r\n         _onCancelFile: function ($target) {\r\n             var that = this,\r\n                 $fileWrapper = $target.closest(\"li\"),\r\n                 $uploadWrapper = that.upload.wrapper,\r\n                 guid = $fileWrapper.data(\"guid\");\r\n\r\n             $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRemoveFile: function ($target) {\r\n             var $fileWrapper = $target.closest(\"li\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRetryFile: function ($target) {\r\n             var that = this;\r\n             var $file = $target.closest(\"li\");\r\n             var guid = $file.data(\"guid\");\r\n             var file = $.grep(that._fileList, function (i) {\r\n                 return i.uid === guid;\r\n             });\r\n\r\n             that.options.retry(file[0]);\r\n         },\r\n\r\n         onErrorFile: function (event) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             file = event.files[0],\r\n             validation = that._isValidFile(file);\r\n             var message = (validation.message !== \"\") ? validation.message : localization.errorUpload;\r\n\r\n             that.setStatus(\"ERROR\", file.uid, message);\r\n         },\r\n\r\n         _isValidFile: function (file) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             valid = true,\r\n             message = \"\";\r\n\r\n             if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0 ) {\r\n                 message = localization.errorSize;\r\n                 valid = false;\r\n             }\r\n\r\n             if(!that._onlyValidateServerFileExtension){\r\n                 if ($.inArray(file.extension, that._supportFileExt) === -1) {\r\n                     message = localization.errorSecurity;\r\n                     valid = false;\r\n                 }\r\n             }\r\n\r\n             return {\r\n                 valid: valid,\r\n                 message: message\r\n             };\r\n         },\r\n\r\n         _filterMaxFilesSize: function (event) {\r\n            \r\n            var that = this;\r\n            var total = 0;\r\n\r\n            for (var i = 0, length = event.files.length; i < length; i++){\r\n                total += event.files[i].size;\r\n            }\r\n            if (total > that._maxFilesSize) {\r\n                that._notifySizeExceeded();\r\n                event.preventDefault();\r\n            } else {\r\n                that._onShowUploadNotifier(event);\r\n            }\r\n         },\r\n\r\n         _notifySizeExceeded: function(){\r\n         \r\n             var that = this;\r\n\r\n             that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\r\n         },\r\n\r\n         _getFileItemByUID: function (uid) {\r\n             var that = this;\r\n             return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\r\n         },\r\n\r\n         _switchEvents: function (event) {\r\n             var that = this;\r\n             var $target = $(\".k-icon\", event.currentTarget);\r\n             if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\r\n                 that._onRemoveFile($target);\r\n             } else if ($target.hasClass(\"k-retry\")) {\r\n                 that._onRetryFile($target);\r\n             } else if ($target.hasClass(\"k-cancel\")) {\r\n                 that._onCancelFile($target);\r\n             }\r\n         },\r\n\r\n         _eventsHandler: function () {\r\n             var that = this;\r\n\r\n             that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\r\n                 that._switchEvents(event);\r\n             });\r\n         },\r\n\r\n         cancelFilesUpload: function(){\r\n             var that = this;\r\n             var $uploadWrapper = that.upload.wrapper;\r\n\r\n             $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\r\n             that.close();\r\n         },\r\n\r\n         close: function () {\r\n             this.loadNotifier.close();\r\n         },\r\n\r\n         destroy: function () {\r\n             this.loadNotifier.destroy();\r\n             this.upload.destroy();\r\n         },\r\n\r\n         setStatus: function (status, uid, message) {\r\n\r\n             var $file = this._getFileItemByUID(uid),\r\n                 localization = this.options.localization;\r\n\r\n             switch (status) {\r\n                 case \"SUCCESS\":\r\n                     $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\r\n                     $(\".k-errormsg\", $file).text(\"\");\r\n                     break;\r\n                 case \"ERROR\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\r\n                     $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\r\n                     break;\r\n                 case \"RETRY\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\r\n                     $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\r\n                     break;\r\n             }\r\n         }\r\n\r\n     });\r\n\r\n     ui.plugin(ProjectAttachments);\r\n })(jQuery);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Discussions Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.discussions\", {}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, notifier, params) {\r\n\r\n        var self = this;\r\n\r\n        self.typeResource = \"DiscussionGuid\";\r\n        self.plugins = {};\r\n        self.dialogBoxDiscussion = {};\r\n        self.attchComments = {};\r\n        self.attchDiscussions = {\r\n            remove: [],\r\n            addition: []\r\n        };\r\n        self.listDataDiscussion = [];\r\n        self.userPictures = [];\r\n        self.commentsList = {};\r\n\r\n        self.globalTags = [];\r\n\r\n        self.tempTagsBeforeDelete = [];\r\n        self.tempTagsToDelete = [];\r\n        self.keySentenceAddTag = bizagi.localization.getResource(\"workportal-project-discussion-add-new-tag\") + \": \";\r\n        self.notifier = notifier;\r\n\r\n\r\n        //Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-discussions\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-wrapper\"),\r\n            \"project-discussions-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-popup-wrapper\"),\r\n            \"project-discussions-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-list-wrapper\"),\r\n            \"project-discussions-comments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-comments-list\"),\r\n            \"project-discussions-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussions\").concat(\"#project-discussions-attachments-list\"),\r\n            \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\")\r\n        });\r\n\r\n    },\r\n\r\n    /*\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var templateHomeDiscussions = self.getTemplate(\"project-discussions\");\r\n\r\n        self.content = templateHomeDiscussions.render({});\r\n        return self.content;\r\n    },\r\n\r\n    /*\r\n     * Post render and links events with handlers\r\n     */\r\n    postRender: function () {\r\n\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        self.plugins.popupDiscussion = self.initPluginPopupDiscussion();\r\n        var popupDiscussion = self.plugins.popupDiscussion;\r\n\r\n        //reference for html elements\r\n        self.form = {\r\n            buttonShowFormNewDiscussion: $(\".ui-bizagi-wp-action-new\", $contentWidget),\r\n            title: $(\".ui-bizagi-wp-project-popupform-h4\", popupDiscussion),\r\n            subject: $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", popupDiscussion),\r\n            description: $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", popupDiscussion),\r\n            buttonShowPopupDiscussionToAdd: $(\"#ui-bizagi-wp-project-discussions-button-action-show-popup-to-add\", $contentWidget),\r\n            buttonAddDiscussion: $(\"#ui-bizagi-wp-project-discussions-popup-action-add-discussion\", popupDiscussion),\r\n            buttonCancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", popupDiscussion),\r\n            formDiscussion: $(\".ui-bizagi-wp-project-discussions-popup\", popupDiscussion),\r\n            attachments: $(\".ui-bizagi-wp-project-discussions-attachments-cmnwrapper\", popupDiscussion),\r\n            edition: false\r\n        };\r\n\r\n        self.plugins.tagsFilter = self.initPluginTagsFilter();\r\n\r\n        self.plugins.tagsMultiSelect = self.initPluginTagsMultiSelect(popupDiscussion);\r\n\r\n        //Load discussions\r\n        self.getDiscussions();\r\n        self.eventsHandler();\r\n        self.restrictedEventsHandler();\r\n    },\r\n\r\n    getDiscussions: function(){\r\n        var self = this;\r\n\r\n        self.getDataDiscussions().done(function () {\r\n\r\n            var idUsersCreatedDiscussions = $.map(self.listDataDiscussion, function (element) {\r\n                return element.user;\r\n            });\r\n\r\n            var idUsersCreatedComments = $.map(self.commentsList, function (property) {\r\n                return $.map(property.comments, function (property) {\r\n                    return property.user;\r\n                });\r\n            });\r\n\r\n            function removeDuplicateItemsFromArray(a) {\r\n                var seen = {};\r\n                var out = [];\r\n                var len = a.length;\r\n                var j = 0;\r\n                for (var i = 0; i < len; i++) {\r\n                    var item = a[i];\r\n                    if (seen[item] !== 1) {\r\n                        seen[item] = 1;\r\n                        out[j++] = item;\r\n                    }\r\n                }\r\n                return out;\r\n            }\r\n\r\n            var csvGuidUsers = removeDuplicateItemsFromArray(idUsersCreatedDiscussions.concat(idUsersCreatedComments).concat(bizagi.currentUser.idUser)).join(\",\");\r\n\r\n            self.getDataUsers(csvGuidUsers).then(function () {\r\n                self.renderUserProfilesAndImages();\r\n            });\r\n\r\n            self.setClassesTagsByDiscussion();\r\n\r\n        });\r\n        \r\n    },\r\n\r\n    /*\r\n     * Notifies when an event is raised\r\n     */\r\n    onNotifyOpenPopup: function () {\r\n        var self = this;\r\n\r\n        self.form.edition = false;\r\n        self.showFormAddDiscussion(\"workportal-project-discussion-adddiscussion\");\r\n        self.renderUserProfile();\r\n    },\r\n\r\n    /*\r\n     * Init plugins\r\n     */\r\n    initPluginPopupDiscussion: function () {\r\n        var self = this;\r\n        var templatePopupDiscussion = self.getTemplate(\"project-discussions-popup\");\r\n        self.dialogBoxDiscussion.formContent = templatePopupDiscussion.render({attachments: []});\r\n        return self.dialogBoxDiscussion.formContent;\r\n    },\r\n\r\n\r\n    initPluginTagsMultiSelect: function (popupDiscussion) {\r\n        var self = this;\r\n        var tags = [];\r\n        var categoriesMultiSelect = popupDiscussion.find(\"#ui-bizagi-wp-project-discussions-options-multiselect-tags\");\r\n        var newitemtext;\r\n        var isDelete = false;\r\n        var createNewTag = false;\r\n        return categoriesMultiSelect.kendoMultiSelect({\r\n            change: function () {\r\n                var valuesSelected = this.value().slice(0);\r\n\r\n                var dataitems = this.dataSource.data();\r\n                if (valuesSelected.length > 0) {\r\n                    if (dataitems[0].tag.replace(self.keySentenceAddTag, \"\").indexOf(valuesSelected[valuesSelected.length - 1]) !== -1) {\r\n                        //fix because the value dont complete by millisecond\r\n                        valuesSelected[valuesSelected.length - 1] = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\r\n                    }\r\n                }\r\n\r\n\r\n                valuesSelected = valuesSelected.filter(Boolean); //Remove empty items\r\n\r\n                //remove duplicate items\r\n                valuesSelected = valuesSelected.filter(function (value, pos, self) {\r\n                    return self.indexOf(value) === pos;\r\n                });\r\n\r\n                var newtag = \"\";\r\n\r\n                if (dataitems.length > 0) {\r\n                    if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\r\n                        newtag = dataitems[0].tag.replace(self.keySentenceAddTag, \"\");\r\n\r\n                        var dataItemAddNew = {};\r\n                        if (valuesSelected.indexOf(newtag) !== -1) {\r\n                            dataItemAddNew = this.dataSource.at(0);\r\n                            isDelete = true;\r\n                            this.dataSource.remove(dataItemAddNew);\r\n                            isDelete = false;\r\n                            this.refresh();\r\n                            createNewTag = true;\r\n                        }\r\n                        else {\r\n                            if (newtag) {\r\n                                if ($(\"li:first\", this.list).hasClass(\"k-state-focused\")) {\r\n                                    createNewTag = true;\r\n                                    valuesSelected.push(newtag);\r\n                                }\r\n                                dataItemAddNew = this.dataSource.at(0);\r\n                                isDelete = true;\r\n                                this.dataSource.remove(dataItemAddNew);\r\n                                isDelete = false;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                if (newtag) {\r\n                    if (createNewTag) {\r\n                        var existInDatasource = this.dataSource.data().filter(function (itemData) {\r\n                            return itemData.tag === newtag;\r\n                        });\r\n                        if (existInDatasource.length === 0) {\r\n                            this.dataSource.add({guid: newtag, tag: newtag});\r\n                        }\r\n                        createNewTag = false;\r\n                    }\r\n                }\r\n                this.dataSource.filter({});\r\n                this.value(valuesSelected);\r\n\r\n            },\r\n            dataBound: function () {\r\n                if ((newitemtext || this._prev) && newitemtext !== this._prev && !isDelete) {\r\n                    newitemtext = this._prev;\r\n\r\n                    var dataitems = this.dataSource.data();\r\n\r\n                    var isfound = false;\r\n                    if (dataitems.length > 0) {\r\n                        if (dataitems[0].tag.indexOf(self.keySentenceAddTag) !== -1) {\r\n                            dataitems[0].tag = self.keySentenceAddTag + newitemtext;\r\n                            this.refresh();\r\n                            isfound = true;\r\n                            $(\"li\", this.list).removeClass(\"k-state-focused\");\r\n                            $(\"li:first\", this.list).addClass(\"k-state-focused\");\r\n                        }\r\n                    }\r\n\r\n                    if (!isfound) //Is found item with text \"Add new tag:\" ?\r\n                    {\r\n                        this.dataSource.insert(0, {tag: self.keySentenceAddTag + newitemtext, guid: newitemtext});\r\n                    }\r\n\r\n                    if (this.dataSource.total() == 0) {\r\n                        this.search();\r\n                        this.open();\r\n                        this.refresh();\r\n                        $(\"li\", this.list).removeClass(\"k-state-focused\");\r\n                        $(\"li:first\", this.list).addClass(\"k-state-focused\");\r\n                    }\r\n                }\r\n            },\r\n            dataSource: tags,\r\n            dataTextField: \"tag\",\r\n            dataValueField: \"guid\",\r\n            filter: \"contains\",\r\n            animation: false\r\n        }).data(\"kendoMultiSelect\");\r\n    },\r\n\r\n    initPluginTagsFilter: function () {\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n        return $(\"#ui-bizagi-wp-project-discussions-options-tags-filter\", $contentWidget).kendoMultiSelect({\r\n            change: function () {\r\n                self.hideOrShowDiscussionsByFilter();\r\n            },\r\n            autoClose: false,\r\n            tagMode: \"single\",\r\n            dataTextField: \"tag\",\r\n            dataValueField: \"guid\"\r\n        }).data(\"kendoMultiSelect\");\r\n    },\r\n\r\n    hideOrShowDiscussionsByFilter: function () {\r\n        var self = this;\r\n        var valuesSelected = self.plugins.tagsFilter.value();\r\n        if (valuesSelected.length > 0) {\r\n            $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).hide();\r\n            valuesSelected.forEach(function (valueClass) {\r\n                $(\".ui-bizagi-wp-project-discussions-item.\" + valueClass, self.getContent()).show();\r\n            });\r\n        }\r\n        else {\r\n            $(\".ui-bizagi-wp-project-discussions-item\", self.getContent()).show();\r\n        }\r\n    },\r\n\r\n    validateAddCommentForm: function($wrapperForm){\r\n        var result = false;\r\n        var $textAreaComment = $(\"textarea\", $wrapperForm);\r\n        if($textAreaComment.val().trim() === \"\"){\r\n            var commentValidation = bizagi.localization.getResource(\"workportal-project-discussion-requiredcomment\");\r\n            $textAreaComment.parent().next().find('span').html(commentValidation);\r\n        }\r\n        else{\r\n            $textAreaComment.parent().next().find('span').empty();\r\n            result = true;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    validateAddDiscussionForm: function($wrapperForm){\r\n        var result = false;\r\n        var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", $wrapperForm);\r\n        var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", $wrapperForm);\r\n        if($subjectDiscussion.val().trim() !== \"\" && $descriptionDiscussion.val().trim() !== \"\"){\r\n            result = true;\r\n        }\r\n        if($subjectDiscussion.val().trim() === \"\"){\r\n            var subjectValidation = bizagi.localization.getResource(\"workportal-project-discussion-subjectrequired\");\r\n            $subjectDiscussion.parent().find(\"span\").html(subjectValidation);\r\n        }\r\n        else{\r\n            $subjectDiscussion.parent().find(\"span\").empty();\r\n        }\r\n        if($descriptionDiscussion.val().trim() === \"\"){\r\n            var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\r\n            $descriptionDiscussion.parent().next().find(\"span\").html(descriptionValidation);\r\n        }\r\n        else{\r\n            $descriptionDiscussion.parent().next().find(\"span\").empty();\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    applyFileAttachments: function (type) {\r\n\r\n        var self = this;\r\n        var content = (type === \"DISCUSSIONS\") ? self.plugins.popupDiscussion : self.getContent();\r\n\r\n        return $(\".ui-bizagi-wp-project-discussions-attachment-upload\", content).kendoProjectAttachments({\r\n            saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\r\n            template: self.getTemplate(\"project-attachments\"),\r\n            success: function (event) {\r\n                self.onSuccessFile(event, type);\r\n            },\r\n            upload: $.proxy(self.addFileData, self),\r\n            dropZone: false,\r\n            extensions: self.supportFileExt,\r\n            maxSize: self.uploadMaxFilesSize\r\n        }).data(\"kendoProjectAttachments\");\r\n    },\r\n\r\n    addFileData: function (event) {\r\n\r\n        var uid = event.files[0].uid;\r\n\r\n        event.files[0].guid = uid;\r\n        event.data = {\r\n            guid: uid\r\n        };\r\n    },\r\n\r\n\r\n    /*\r\n     *  Get data for discussions\r\n     */\r\n    getDataDiscussions: function () {\r\n\r\n        var self = this,\r\n            defer = $.Deferred();\r\n\r\n        var paramsGetDiscussions = {\r\n            globalParent: self.radNumber,\r\n            typeResource: self.typeResource\r\n        };\r\n\r\n        if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\r\n            paramsGetDiscussions.globalParent = self.params.plan.id;\r\n        }\r\n\r\n        self.dataService.getDiscussionsData(paramsGetDiscussions).pipe(function (response) {\r\n            return self.callForListComments(response);\r\n        }).done(function (response) {\r\n            self.listDataDiscussion = self.sortDiscussions(response);\r\n            self.updateTemplateListDiscussion();\r\n            defer.resolve();\r\n        });\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n     *  Get data for users\r\n     */\r\n    getDataUsers: function (usersGuids) {\r\n        var self = this,\r\n            defer = $.Deferred();\r\n\r\n        var params = {\r\n            usersGuids: usersGuids,\r\n            width: 50,\r\n            height: 50\r\n        };\r\n\r\n        if(params.usersGuids){\r\n            self.dataService.getUsersData(params).always(function (response) {\r\n\r\n                function arrayUnique(array) {\r\n                    var a = array.concat();\r\n                    for (var i = 0; i < a.length; ++i) {\r\n                        for (var j = i + 1; j < a.length; ++j) {\r\n                            if (a[i] === a[j]) {\r\n                                a.splice(j--, 1);\r\n                            }\r\n                        }\r\n                    }\r\n                    return a;\r\n                }\r\n\r\n                self.userPictures = arrayUnique(self.userPictures.concat(response));\r\n                defer.resolve();\r\n            });\r\n        }\r\n        else{\r\n            defer.resolve();\r\n        }\r\n\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n     * Call list of comments by discussion\r\n     */\r\n    callForListComments: function (discussions) {\r\n\r\n        var self = this,\r\n            generalDefer = $.Deferred(),\r\n            commentsDefer = [];\r\n\r\n        for (var i = 0, length = discussions.length - 1; i <= length; i++) {\r\n\r\n            self.addGlobalTags(discussions[i].tags, false);\r\n\r\n            var params = {\r\n                idParent: discussions[i].guid,\r\n                dateTime: self.getDateServer(),\r\n                count: 6\r\n            };\r\n\r\n            self.commentsList[params.idParent] = {\r\n                comments: [],\r\n                count: 0,\r\n                total: 0\r\n            };\r\n\r\n            var defer = $.when(self.dataService.getCommentsData(params)).done(function (response) {\r\n                if (response.length > 0) {\r\n                    self.commentsList[response[0].parent] = {\r\n                        comments: response,\r\n                        count: response.length,\r\n                        total: 0\r\n                    };\r\n                }\r\n            });\r\n\r\n            commentsDefer.push(defer);\r\n        }\r\n\r\n        $.when.apply($, commentsDefer).done(function () {\r\n            generalDefer.resolve(discussions);\r\n        });\r\n\r\n        return generalDefer.promise();\r\n    },\r\n\r\n    sortDiscussions: function (discussions) {\r\n        var sortedDiscussion = [];\r\n        if (discussions.length) {\r\n            sortedDiscussion = discussions.sort(function (a, b) {\r\n                var dateA = a.date;\r\n                var dateB = b.date;\r\n\r\n                return (dateB - dateA);\r\n            });\r\n\r\n            if (sortedDiscussion.length > 0) {\r\n                sortedDiscussion.unshift(sortedDiscussion.pop());\r\n            }\r\n        }\r\n        return sortedDiscussion;\r\n    },\r\n\r\n    resetDiscussionAttachments: function () {\r\n\r\n        var self = this;\r\n        var popupDiscussion = self.plugins.popupDiscussion;       \r\n        $(\".ui-bizagi-wp-project-attachments-list\", popupDiscussion).empty();\r\n\r\n        self.plugins.tagsMultiSelect.value([]);\r\n        \r\n        self.attchDiscussions.addition = [];\r\n        self.attchDiscussions.remove = [];\r\n        self.getDiscussions();       \r\n    },\r\n\r\n    sendDataUpdateDiscussion: function (guid) {\r\n\r\n        var self = this;\r\n        var filesObj = self.prepareFilesToSave();\r\n        self.form.buttonAddDiscussion.prop(\"disabled\", true);\r\n\r\n        var tagsDiscussion = self.getTagsDiscussionBySave();\r\n        var guidsTagsDiscussionToDelete = self.getGuidsTagsDiscussionToDelete();\r\n\r\n        var params = {\r\n            content: {\r\n                name: self.form.subject.val(),\r\n                description: self.form.description.val(),\r\n                globalParent: self.radNumber.toString(),\r\n                user: bizagi.currentUser.idUser,\r\n                attachments: filesObj.attachments,\r\n                guid: guid,\r\n                tags: tagsDiscussion,\r\n                typeResource: \"DiscussionGuid\",\r\n                general: false,\r\n                date: self.getDateServer()\r\n            },\r\n            attachmentsToCreate: filesObj.attachmentsToCreate,\r\n            attachmentsToDelete: filesObj.attachmentsToDelete\r\n        };\r\n\r\n        self.plugins.attchDiscussions.close();\r\n\r\n        self.dataService.editDiscussion(params).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                self.addGlobalTags(tagsDiscussion, true);\r\n\r\n                var discussion = self.getDiscussionDataByGUID(guid);\r\n                discussion.name = params.content.name;\r\n                discussion.description = params.content.description;\r\n                discussion.attachments = params.content.attachments;\r\n                discussion.tags = params.content.tags;\r\n\r\n                self.onClosePopupDiscussion();\r\n\r\n                self.resetDiscussionAttachments();\r\n                self.updateTemplateListDiscussion();\r\n\r\n                self.removeGlobalTags(guidsTagsDiscussionToDelete);\r\n\r\n                self.notifier.showSucessMessage(\r\n                    printf(bizagi.localization.getResource(\"workportal-project-discussion-edited\"), \"\"));\r\n            } else {\r\n\r\n                self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n\r\n                self.onClosePopupDiscussion();\r\n                self.notifier.showErrorMessage(\r\n                   printf(bizagi.localization.getResource(\"workportal-project-discussion-error-edition\"), \"\"));\r\n            }\r\n\r\n\r\n            self.renderUserProfilesAndImages();\r\n\r\n            self.setClassesTagsByDiscussion();\r\n            self.hideOrShowDiscussionsByFilter();\r\n        });\r\n\r\n    },\r\n    validateStringIsGuid: function (value) {\r\n        var validGuid = /^({|()?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}(}|))?$/;\r\n        var emptyGuid = /^({|()?0{8}-(0{4}-){3}0{12}(}|))?$/;\r\n        return validGuid.test(value) && !emptyGuid.test(value);\r\n    },\r\n\r\n    sendDataInsertDiscussion: function (guid) {\r\n\r\n        var self = this;\r\n        var filesObj = self.prepareFilesToSave();\r\n\r\n        self.form.buttonAddDiscussion.prop(\"disabled\", true);\r\n\r\n        var tagsDiscussion = self.getTagsDiscussionBySave();\r\n\r\n        var params = {\r\n            content: {\r\n                name: self.form.subject.val(),\r\n                description: self.form.description.val(),\r\n                globalParent: self.radNumber.toString(),\r\n                user: bizagi.currentUser.idUser,\r\n                attachments: filesObj.attachments,\r\n                guid: guid,\r\n                tags: tagsDiscussion,\r\n                typeResource: \"DiscussionGuid\",\r\n                general: false,\r\n                date: self.getDateServer()\r\n            },\r\n            attachmentsToCreate: filesObj.attachmentsToCreate,\r\n            attachmentsToDelete: filesObj.attachmentsToDelete\r\n        };\r\n\r\n        self.plugins.attchDiscussions.close();\r\n\r\n        self.dataService.postDiscussion(params).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n\r\n                self.addGlobalTags(tagsDiscussion, true);\r\n\r\n                self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n\r\n                var newDiscussion = {\r\n                    \"name\": params.content.name,\r\n                    \"description\": params.content.description,\r\n                    \"date\": params.content.date,\r\n                    \"user\": params.content.user,\r\n                    \"attachments\": params.content.attachments,\r\n                    \"radNumber\": params.content.globalParent,\r\n                    \"general\": params.content.general,\r\n                    \"guid\": params.content.guid,\r\n                    \"tags\": params.content.tags,\r\n                    \"typeResource\": params.content.typeResource\r\n                };\r\n\r\n                self.commentsList[params.content.guid] = {\r\n                    comments: [],\r\n                    count: 0,\r\n                    total: 0\r\n                };\r\n\r\n                if (self.listDataDiscussion.length === 0) {//Add first discussion\r\n                    self.listDataDiscussion.push(newDiscussion);\r\n                }\r\n                else {//Add discussion in position 1\r\n                    self.listDataDiscussion.splice(1, 0, newDiscussion);\r\n                }\r\n\r\n                self.resetDiscussionAttachments();\r\n                self.onClosePopupDiscussion();\r\n                self.notifier.showSucessMessage(\r\n                   printf(bizagi.localization.getResource(\"workportal-project-discussion-created\"), \"\"));\r\n                self.updateTemplateListDiscussion();\r\n\r\n\r\n            }\r\n            else {\r\n                self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n                self.onClosePopupDiscussion();\r\n                self.notifier.showErrorMessage(\r\n                   printf(bizagi.localization.getResource(\"workportal-project-discussion-error-creation\"), \"\"));\r\n            }\r\n\r\n            self.renderUserProfilesAndImages();\r\n\r\n            self.setClassesTagsByDiscussion();\r\n            self.hideOrShowDiscussionsByFilter();\r\n        });\r\n    },\r\n\r\n    getTagsDiscussionBySave: function () {\r\n        var self = this;\r\n        var tagsTextSelected = self.plugins.tagsMultiSelect.value();\r\n        var dataSourceTags = self.plugins.tagsMultiSelect.dataSource.data();\r\n\r\n        var tagsDiscussion = [];\r\n        tagsTextSelected.forEach(function (tagTextSelected) {\r\n            var isGuidTextSelected = self.validateStringIsGuid(tagTextSelected);\r\n\r\n            var tagFound;\r\n            if (isGuidTextSelected) {\r\n                tagFound = dataSourceTags.filter(function (tagSource) {\r\n                    return tagSource.guid === tagTextSelected;\r\n                });\r\n            }\r\n            else {\r\n                tagFound = dataSourceTags.filter(function (tagSource) {\r\n                    var isGuid = self.validateStringIsGuid(tagSource.guid);\r\n                    return tagSource.tag === tagTextSelected && !isGuid;\r\n                });\r\n            }\r\n\r\n            if (tagFound.length === 1) {\r\n                tagsDiscussion.push({\r\n                    guid: isGuidTextSelected ? tagFound[0].guid : tagFound[0].uid,\r\n                    tag: tagFound[0].tag\r\n                });\r\n            }\r\n\r\n        });\r\n\r\n        return tagsDiscussion;\r\n    },\r\n\r\n    //b: minuendo, a: sustraendo\r\n    differenceArrays: function (b, a) {\r\n        return b.filter(function (i) {\r\n            return a.indexOf(i) < 0;\r\n        });\r\n    },\r\n\r\n    getGuidsTagsDiscussionToDelete: function () {\r\n        var self = this;\r\n        var guidsTagsCurrentDiscussion = self.plugins.tagsMultiSelect.value();\r\n        return self.differenceArrays(self.tempTagsBeforeDelete, guidsTagsCurrentDiscussion);\r\n    },\r\n\r\n    /*\r\n     *   UI Functions\r\n     */\r\n    setStateUIShowMoreComments: function ($commentsContainer, state) {\r\n        var $containerButtonMoreComments = $commentsContainer.siblings(\".ui-bizagi-wp-project-discussion-showmore-comments\");\r\n        var $buttonShowMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-comments-button\");\r\n        var $messageNoMoreComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-no-more-comments\");\r\n        var $messageLoadingComments = $containerButtonMoreComments.find(\".ui-bizagi-wp-project-discussion-showmore-loading-comments\");\r\n\r\n        if (state === \"ALLOW_MORE_COMMENTS\") {\r\n            $buttonShowMoreComments.show();\r\n            $messageNoMoreComments.hide();\r\n            $messageLoadingComments.hide();\r\n        }\r\n\r\n        if (state === \"LOADING_MORE_COMMENTS\") {\r\n            $buttonShowMoreComments.hide();\r\n            $messageNoMoreComments.hide();\r\n            $messageLoadingComments.show();\r\n        }\r\n\r\n        if (state === \"NO_MORE_COMMENTS\") {\r\n            $buttonShowMoreComments.hide();\r\n            $messageNoMoreComments.show();\r\n            $messageLoadingComments.hide();\r\n        }\r\n    },\r\n\r\n    getCurrentUserInfo: function () {\r\n        return {\r\n            name: bizagi.currentUser.userName,\r\n            id: bizagi.currentUser.idUser,\r\n            picture: \"\"\r\n        };\r\n    },\r\n\r\n    /*Functions about tags*/\r\n\r\n    addGlobalTags: function (tagsDiscussion, createTagsOnServer) {\r\n        var self = this;\r\n\r\n        for (var iTagAdd = 0; iTagAdd < tagsDiscussion.length; iTagAdd += 1) {\r\n            var existTag = self.globalTags.filter(function (tagGlobal) {\r\n                return tagGlobal.tag === tagsDiscussion[iTagAdd].tag;\r\n            });\r\n            if (existTag.length === 0) {\r\n                tagsDiscussion[iTagAdd].globalParent = self.radNumber;\r\n                self.globalTags.push(tagsDiscussion[iTagAdd]);\r\n                if (createTagsOnServer) {\r\n                    self.dataService.postTag(tagsDiscussion[iTagAdd]);\r\n                }\r\n            }\r\n        }\r\n\r\n        //Sync tags\r\n        self.plugins.tagsFilter.dataSource.data(self.globalTags);\r\n        self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\r\n    },\r\n\r\n    removeGlobalTags: function (guidTagsToDelete) {\r\n        var self = this;\r\n        var allGuidsTagsAllDiscussions = $.map(self.listDataDiscussion, function (discussion) {\r\n            return $.map(discussion.tags, function (itemTag) {\r\n                return itemTag.guid;\r\n            });\r\n        });\r\n\r\n        var allGuidsMoreGuidsDelete = allGuidsTagsAllDiscussions.concat(guidTagsToDelete);\r\n\r\n        var secureGuidsForDelete = [];\r\n        guidTagsToDelete.forEach(function (guidDelete) {\r\n            var existGuidOnlyTimeThenDelete = allGuidsMoreGuidsDelete.filter(function (guid) {\r\n                return guid === guidDelete;\r\n            });\r\n            if (existGuidOnlyTimeThenDelete.length === 1) {\r\n                secureGuidsForDelete.push(guidDelete);\r\n            }\r\n        });\r\n\r\n\r\n        secureGuidsForDelete.forEach(function (guidSecureDelete) {\r\n            //delete with service\r\n            var params = {idTag: guidSecureDelete};\r\n            self.dataService.deleteTag(params);\r\n\r\n            //delete globalTags\r\n            for (var iTagGlobal = self.globalTags.length - 1; iTagGlobal >= 0; iTagGlobal -= 1) {\r\n                if (self.globalTags[iTagGlobal].guid === guidSecureDelete) {\r\n                    self.globalTags.splice(iTagGlobal, 1);\r\n                }\r\n            }\r\n        });\r\n\r\n        //Sync tags\r\n        self.plugins.tagsFilter.dataSource.data(self.globalTags);\r\n        self.plugins.tagsMultiSelect.dataSource.data(self.globalTags);\r\n    },\r\n\r\n    setClassesTagsByDiscussion: function () {\r\n        var self = this;\r\n        for (var iDiscussion = 0; iDiscussion < self.listDataDiscussion.length; iDiscussion += 1) {\r\n            var textTagsDiscussion = $.map(self.listDataDiscussion[iDiscussion].tags, function (itemTag) {\r\n                return itemTag.guid;\r\n            });\r\n            var tagsBySpace = textTagsDiscussion.join(\" \");\r\n\r\n            $(\".ui-bizagi-wp-project-discussions-item[data-guid='\" + self.listDataDiscussion[iDiscussion].guid + \"']\", self.getContent()).addClass(tagsBySpace);\r\n        }\r\n    },\r\n\r\n    updateTemplateListDiscussion: function () {\r\n\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n        var templateListDiscussions = self.getTemplate(\"project-discussions-list\");\r\n        var user = self.getCurrentUserInfo();\r\n        var contentRenderListDiscussions = templateListDiscussions.render({\r\n            listDataDiscussions: self.listDataDiscussion,\r\n            user: user,\r\n            isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\r\n            returnServedCommentByParentId: function (parentId) {\r\n                return self.returnServedCommentByParentId(parentId);\r\n            }\r\n        });\r\n        for (var i = 0; i < this.listDataDiscussion.length; i++) {\r\n            this.mapTempComments($(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"),\r\n                contentRenderListDiscussions.find(\".ui-bizagi-wp-project-discussions-container-description-and-comments[data-guid=\" + this.listDataDiscussion[i].guid + \"]\"));\r\n        }\r\n        $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).empty().append(contentRenderListDiscussions);\r\n\r\n        self.plugins.attchComments = self.applyFileAttachments(\"COMMENTS\");\r\n    },\r\n\r\n    showFormAddDiscussion: function (resourceTitlePopup) {\r\n        var self = this;\r\n\r\n        if (self.plugins.attchComments) {\r\n            self.plugins.attchComments.close();\r\n        }\r\n        self.dialogBoxDiscussion.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"650px\",\r\n            modal: true,\r\n            zIndex: 1,\r\n            title: bizagi.localization.getResource(resourceTitlePopup),\r\n            maximize: true,\r\n            open:  $.proxy(self.onOpenPopupDiscussion, self),\r\n            close: function () {\r\n                self.resetDiscussionAttachments();\r\n                self.onClosePopupDiscussion();\r\n            }\r\n        });\r\n    },\r\n\r\n    resetFormDiscussion: function () {\r\n        var self = this;\r\n\r\n        self.form.buttonAddDiscussion.prop(\"disabled\", false);\r\n        self.form.subject.val(\"\");\r\n        self.form.description.val(\"\");\r\n\r\n        var $subjectDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-subject-input\", self.dialogBoxDiscussion.formContent);\r\n        var $descriptionDiscussion = $(\"#ui-bizagi-wp-project-discussions-popup-description-textarea\", self.dialogBoxDiscussion.formContent);\r\n        $subjectDiscussion.parent().find(\"span\").empty();\r\n        $descriptionDiscussion.parent().next().find(\"span\").empty();\r\n    },\r\n\r\n    renderUserProfile: function(){\r\n        var self = this;\r\n\r\n        var userPicture = $.grep(self.userPictures, function (userPicture) {\r\n            return userPicture.id === bizagi.currentUser.idUser;\r\n        })[0];\r\n\r\n        var base64Prefix = \"data:image/png;base64,\";\r\n        var $parent = $(\".ui-bizagi-wp-project-popupform-user\");\r\n        var $img = $parent.find(\".bz-wp-avatar-img\");\r\n        var $text = $parent.find(\".bz-wp-avatar-label\");\r\n\r\n        if (userPicture) {\r\n            if (userPicture.picture) {\r\n                $img.attr(\"src\", base64Prefix + userPicture.picture);\r\n            } else {\r\n                $img.hide();\r\n                $text.html(userPicture.name.getInitials()).show();\r\n            }\r\n        }  \r\n    },\r\n\r\n    renderUserProfilesAndImages: function () {\r\n        var self = this;\r\n\r\n        var userPicture = $.grep(self.userPictures, function (userPicture) {\r\n            return userPicture.id === bizagi.currentUser.idUser;\r\n        })[0];\r\n\r\n        var base64Prefix = \"data:image/png;base64,\";\r\n\r\n        if (userPicture) {\r\n            $(\".ui-bizagi-wp-project-discussions-create-comment .bz-wp-discussion-username\").html(userPicture.name);\r\n            if (userPicture.picture) {\r\n                $(\".ui-bizagi-wp-project-discussions-item-user img\").attr(\"src\", base64Prefix + userPicture.picture);\r\n                $(\".ui-bizagi-wp-project-popupform-image-current-user\").attr(\"src\", base64Prefix + userPicture.picture);\r\n            } else {\r\n                $(\".ui-bizagi-wp-project-discussions-item-user label.bz-wp-avatar-label\").html(userPicture.name.getInitials()).show();\r\n                $(\".ui-bizagi-wp-project-discussions-item-user img\").hide();\r\n            }\r\n        }\r\n\r\n        for (var iUser = 0; iUser < self.userPictures.length; iUser++) {\r\n            $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-discussion-username\").html(self.userPictures[iUser].name);\r\n            if (self.userPictures[iUser].picture) {\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").attr(\"src\", base64Prefix + self.userPictures[iUser].picture);\r\n            } else {\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] .bz-wp-avatar-img\").hide();\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"'] label.bz-wp-avatar-label\").html(self.userPictures[iUser].name.getInitials());\r\n            }\r\n        }\r\n    },\r\n\r\n    /*EVENTS*/\r\n    switchCommentsEvents: function (event) {\r\n\r\n        var self = this;\r\n        var $target = $(event.target);\r\n        var $parent = $target.parent();\r\n\r\n        if ($target.is(\"textarea\")) {\r\n            self.onShowButtonsPanel($target);\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-cancel\")) {\r\n\r\n            self.onCancelComment($target);\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-buttons-share\")) {\r\n\r\n            var $container = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\r\n            if (self.validateAddCommentForm($container)) {\r\n                var guid = Math.guid();\r\n                self.onCreateComment($target, guid);\r\n            }\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussions-comment-view\")) {\r\n            self.onViewComment($target);\r\n        } else if ($target.hasClass(\"ui-bizagi-wp-project-discussion-showmore-comments-button\")) {\r\n            self.onViewMoreComments($target);\r\n        } else if ($target.hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\r\n            self.onRemoveFiles($target);\r\n        } else if ($parent.hasClass(\"biz-wp-user-icon-admin\") && $parent.hasClass(\"biz-wp-action-edit-discussion\")) {\r\n            self.onEditDiscussion($target);\r\n        } else if ($parent.hasClass(\"ui-bizagi-wp-project-discussion-delete\")) {\r\n\r\n            $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-discussion-querydelete\"), \"\", \"info\")).done(function () {\r\n                self.onDeleteComment($parent);\r\n            });\r\n\r\n        } else if ($parent.hasClass(\"bz-bizagi-wp-project-discussions-attachment-itemwrapper\")) {\r\n            self.onDownloadAttachment($target.closest(\"li\"));\r\n        }\r\n\r\n        event.stopPropagation();\r\n    },\r\n\r\n    onEditDiscussion: function ($target) {\r\n\r\n        var self = this;\r\n        var $discussionCnt = $target.closest(\".ui-bizagi-wp-project-discussions-item\");\r\n        var guid = $discussionCnt.data(\"guid\");\r\n\r\n        self.setDiscussionsDataByGUID(guid);\r\n        self.showFormAddDiscussion(\"workportal-project-discussion-edit\");\r\n    },\r\n\r\n    setDiscussionsDataByGUID: function (guid) {\r\n\r\n        var self = this;\r\n\r\n        var discussion = self.getDiscussionDataByGUID(guid);\r\n        var $container = $(\".ui-bizagi-wp-project-attachments-list\", self.form.attachments);\r\n\r\n        self.form.edition = {\r\n            guid: guid\r\n        };\r\n\r\n        self.attchDiscussions = {\r\n            addition: discussion.attachments,\r\n            remove: []\r\n        };\r\n\r\n        self.form.title.text(bizagi.localization.getResource(\"workportal-project-discussion-edit\"));\r\n        self.form.subject.val(discussion.name);\r\n        self.form.description.val(discussion.description);\r\n\r\n        var guidTagsDiscussion = $.map(discussion.tags, function (itemTag) {\r\n            return itemTag.guid;\r\n        });\r\n        self.plugins.tagsMultiSelect.value(guidTagsDiscussion);\r\n        self.tempTagsBeforeDelete = [];\r\n        self.tempTagsBeforeDelete = self.tempTagsBeforeDelete.concat(self.plugins.tagsMultiSelect.value());\r\n\r\n        self.renderAttachments(discussion.attachments, \"DISCUSSIONS\", $container);\r\n\r\n    },\r\n\r\n    getDiscussionDataByGUID: function (guid) {\r\n\r\n        var self = this;\r\n        var discussion;\r\n\r\n        for (var i = self.listDataDiscussion.length - 1; i >= 0; i--) {\r\n            if (self.listDataDiscussion[i].guid === guid) {\r\n                discussion = self.listDataDiscussion[i];\r\n                i = 0;\r\n            }\r\n        }\r\n\r\n        return discussion;\r\n    },\r\n\r\n    onViewComment: function ($target) {\r\n        var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-comment-truncatewrapper\");\r\n        $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-shortcomment\");\r\n        $commentWrapper.toggleClass(\"ui-bizagi-wp-project-discussions-comment-longcomment\");\r\n    },\r\n\r\n    onViewMoreComments: function ($target) {\r\n        var self = this;\r\n        var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussion-showmore-comments\");\r\n        var $commentsContainer = $commentWrapper.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\r\n        var idParent = $commentsContainer.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\r\n\r\n        if (!self.commentsList[idParent].total) {\r\n            //only one time call service if total is null\r\n            self.dataService.getCommentsCountByParent(idParent).done(function (response) {\r\n                self.commentsList[idParent].total = response.count;\r\n                self.getMoreComments(idParent, $commentsContainer);\r\n            });\r\n        }\r\n        else {\r\n            self.getMoreComments(idParent, $commentsContainer);\r\n        }\r\n    },\r\n\r\n    getMoreComments: function (idParent, $commentsContainer) {\r\n        var self = this;\r\n\r\n        //validate total comments vs count comments\r\n        if (self.commentsList[idParent].total > self.commentsList[idParent].comments.length) {\r\n\r\n            self.setStateUIShowMoreComments($commentsContainer, \"LOADING_MORE_COMMENTS\");\r\n\r\n            var dateLastComment;\r\n            if (self.commentsList[idParent].comments.length === 0) {\r\n                dateLastComment = self.getDateServer();\r\n            }\r\n            else {\r\n                dateLastComment = self.commentsList[idParent].comments[self.commentsList[idParent].comments.length - 1].date;\r\n            }\r\n\r\n            //substract one millisecond\r\n            dateLastComment -= 1;\r\n\r\n            self.dataService.getCommentsData(\r\n                {\r\n                    dateTime: dateLastComment,\r\n                    idParent: idParent,\r\n                    count: 6\r\n                }\r\n            ).done(function (responseMoreComments) {\r\n\r\n                    if (responseMoreComments.length) {\r\n                        Array.prototype.push.apply(self.commentsList[idParent].comments, responseMoreComments);\r\n                        self.commentsList[idParent].count += responseMoreComments.length;\r\n\r\n                        self.renderCommentByDiscussion($commentsContainer, idParent, responseMoreComments);\r\n                        self.renderUserProfilesAndImages();\r\n\r\n                        if (responseMoreComments.length > 5) {\r\n                            self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\r\n                        } else {\r\n                            self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\r\n                        }\r\n\r\n                        //Get profiles of idUsers not download in this moment\r\n                        var idUsersLoaded = $.map(self.userPictures, function (element) {\r\n                            return element.id;\r\n                        });\r\n\r\n                        var idUsersNewComments = $.map(self.commentsList, function (property) {\r\n                            return $.map(property.comments, function (property) {\r\n                                return property.user;\r\n                            });\r\n                        });\r\n\r\n                        var arrayIdUsersMissingLoad = $(idUsersNewComments).not(idUsersLoaded).get();\r\n                        var csvIdUsersMissingLoad = arrayIdUsersMissingLoad.join(\",\");\r\n\r\n                        self.getDataUsers(csvIdUsersMissingLoad).then(function () {\r\n                            self.renderUserProfilesAndImages();\r\n                        });\r\n\r\n                    }\r\n                    else {\r\n                        self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\r\n                    }\r\n                }).fail(function () {\r\n                    self.setStateUIShowMoreComments($commentsContainer, \"ALLOW_MORE_COMMENTS\");\r\n                });\r\n        }\r\n        else {\r\n            self.setStateUIShowMoreComments($commentsContainer, \"NO_MORE_COMMENTS\");\r\n        }\r\n\r\n    },\r\n\r\n    renderCommentByDiscussion: function ($container, guidParent, moreComments) {\r\n\r\n        var self = this,\r\n            tmplComment = self.getTemplate(\"project-discussions-comments\"),\r\n            $commentsDOM,\r\n            renderObject = {\r\n                comments: [],\r\n                user: self.getCurrentUserInfo(),\r\n                isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers)\r\n            };\r\n\r\n        if (!moreComments.length) {\r\n            renderObject.comments = self.commentsList[guidParent].comments;\r\n            $commentsDOM = tmplComment.render(renderObject);\r\n            $container.html($commentsDOM);\r\n        } else {\r\n            renderObject.comments = moreComments;\r\n            $commentsDOM = tmplComment.render(renderObject);\r\n            $container.append($commentsDOM);\r\n        }\r\n    },\r\n\r\n    getCommentByGuid: function (parentGuid, commentGuid) {\r\n\r\n        var self = this;\r\n        var commentsList = self.commentsList[parentGuid].comments;\r\n\r\n        for (var i = 0, length = commentsList.length; i < length; i++) {\r\n\r\n            if (commentsList[i].guid === commentGuid) {\r\n                var attachments = [];\r\n\r\n                for (var x = 0, lengthx = commentsList[i].attachments.length; x < lengthx; x++) {\r\n                    attachments.push(commentsList[i].attachments[x].guid);\r\n                }\r\n\r\n                return {\r\n                    attachments: attachments,\r\n                    index: i\r\n                };\r\n            }\r\n        }\r\n\r\n        return {};\r\n    },\r\n\r\n    returnServedCommentByParentId: function (parentId) {\r\n        var self = this;\r\n\r\n        if (typeof self.commentsList[parentId] !== \"undefined\") {\r\n            return self.commentsList[parentId];\r\n        }\r\n    },\r\n\r\n    /*\r\n     *   Events\r\n     */\r\n    onShowButtonsPanel: function ($target) {\r\n        var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\").find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\r\n        $buttonsWrp.show();\r\n    },\r\n\r\n    onRemoveFiles: function ($target) {\r\n        var self = this;\r\n        var $container = $target.closest(\"li\"),\r\n            type = $container.closest(\".ui-bizagi-wp-project-attachments-list\").data(\"type\"),\r\n            fileGuid = $container.data(\"fileguid\");\r\n        var currentFiles, removeFiles, tmpSplice;\r\n\r\n        if (type === \"COMMENT\") {\r\n            var guid = $container.closest(\".ui-bizagi-wp-project-discussions-add-comment\").data(\"guid\");\r\n            currentFiles = self.attchComments[guid].addition;\r\n            removeFiles = self.attchComments[guid].remove;\r\n\r\n        } else {\r\n            currentFiles = self.attchDiscussions.addition;\r\n            removeFiles = self.attchDiscussions.remove;\r\n        }\r\n\r\n        for (var i = 0, length = currentFiles.length - 1; i <= length; i++) {\r\n\r\n            if (currentFiles[i].guid === fileGuid) {\r\n                tmpSplice = currentFiles.splice(i, 1);\r\n                removeFiles.push(tmpSplice[0].guid);\r\n                i = length;\r\n            }\r\n        }\r\n\r\n        $container.remove();\r\n    },\r\n\r\n    onDeleteComment: function ($target) {\r\n        var self = this;\r\n        var $commentWrapper = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\r\n        var commentGuid = $commentWrapper.data(\"cmmtguid\");\r\n        var parentGuid = $commentWrapper.closest(\".ui-bizagi-wp-project-discussions-container-description-and-comments\").data(\"guid\");\r\n        var comment = self.getCommentByGuid(parentGuid, commentGuid);\r\n\r\n        var params = {\r\n            content: {\r\n                guid: commentGuid\r\n            },\r\n            attachmentsToDelete: comment.attachments\r\n        };\r\n\r\n        $.when(self.dataService.deleteComment(params)).always(function (response) {\r\n            if (response.status === 200 || typeof (response.status) === \"undefined\") {\r\n                self.commentsList[parentGuid].comments.splice(comment.index, 1);\r\n                $commentWrapper.remove();\r\n            } else {\r\n                self.notifier.showErrorMessage(\r\n                    printf(bizagi.localization.getResource(\"workportal-project-discussion-errordelete\"), \"\"));\r\n            }\r\n        });\r\n    },\r\n\r\n    onSuccessFile: function (event, type) {\r\n        var self = this;\r\n        var files = event.files;\r\n        var status = (event.XMLHttpRequest.response) ? JSON.parse(event.XMLHttpRequest.response) : {};\r\n\r\n        if (!status.error) {\r\n            var $wrapper = $(event.sender.element).closest(\".ui-bizagi-wp-project-discussion-textwrapper\");\r\n            var $container = $wrapper.find(\".ui-bizagi-wp-project-attachments-list\");\r\n\r\n            if (type === \"DISCUSSIONS\") {\r\n                self.plugins.attchDiscussions.setStatus(\"SUCCESS\", files[0].guid);\r\n                Array.prototype.push.apply(self.attchDiscussions.addition, files);\r\n            } else {\r\n                self.plugins.attchComments.setStatus(\"SUCCESS\", files[0].guid);\r\n                var guid = $wrapper.data(\"guid\");\r\n\r\n                if (self.attchComments[guid]) {\r\n                    Array.prototype.push.apply(self.attchComments[guid].addition, files);\r\n                } else {\r\n                    self.attchComments[guid] = {\r\n                        addition: files,\r\n                        remove: []\r\n                    };\r\n                }\r\n\r\n                self.onShowButtonsPanel($container.parent());\r\n            }\r\n\r\n            self.renderAttachments(files, type, $container);\r\n        } else {\r\n\r\n            if (type === \"DISCUSSIONS\") {\r\n                self.plugins.attchDiscussions.onErrorFile(event);\r\n            } else {\r\n                self.plugins.attchComments.onErrorFile(event);\r\n            }\r\n        }\r\n    },\r\n\r\n    onDownloadAttachment: function ($liTarget) {\r\n        var self = this;\r\n        var guidAttachment = $liTarget.data(\"fileguid\");\r\n\r\n        if (guidAttachment !== \"\") {\r\n            var nameFile = $liTarget.find(\".bz-bizagi-wp-project-discussions-attachment-filename\").text();\r\n            self.dataService.getDownloadAttachment(guidAttachment, nameFile);\r\n        }\r\n    },\r\n\r\n    onCancelComment: function ($target) {\r\n        var self = this;\r\n        var $commentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\r\n        var $buttonsWrp = $commentContainer.find(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\r\n        var $textarea = $commentContainer.find(\"textarea\");\r\n        var $uploadForm = $commentContainer.find(\".ui-bizagi-wp-project-discussions-add-attachments form\");\r\n        var $vlTooltip = $commentContainer.find(\".k-tooltip-validation\");\r\n        var $fileList = $commentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\r\n        var guid = $commentContainer.data(\"guid\");\r\n\r\n        self.attchComments[guid] = {\r\n            addition: [],\r\n            remove: []\r\n        };\r\n\r\n        self.plugins.attchComments.cancelFilesUpload();\r\n\r\n        $uploadForm[0].reset();\r\n        $fileList.empty();\r\n        $textarea.val(\"\");\r\n        $vlTooltip.hide();\r\n        $buttonsWrp.hide();\r\n    },\r\n\r\n    onCreateComment: function ($target, guid) {\r\n        var self = this;\r\n        var $rplWrp = $target.closest(\".ui-bizagi-wp-project-discussions-item-comment\");\r\n        var $buttonsWrp = $target.closest(\".ui-bizagi-wp-project-discussions-comment-buttons-wrapper\");\r\n        var $addCommentContainer = $target.closest(\".ui-bizagi-wp-project-discussions-add-comment\");\r\n        var $textarea = $addCommentContainer.find(\"textarea\");\r\n        var $uploadList = $addCommentContainer.find(\".ui-bizagi-wp-project-attachments-list\");\r\n        var idParent = $addCommentContainer.data(\"guid\");\r\n        var filesObj = self.prepareFilesToSave(\"COMMENTS\", idParent);\r\n\r\n        var params = {\r\n            content: {\r\n                guid: guid,\r\n                attachments: filesObj.attachments,\r\n                text: $textarea.val(),\r\n                parent: idParent,\r\n                date: self.getDateServer(),\r\n                user: bizagi.currentUser.idUser\r\n            },\r\n            attachmentsToCreate: filesObj.attachmentsToCreate,\r\n            attachmentsToDelete: filesObj.attachmentsToDelete\r\n        };\r\n\r\n        $.when(self.dataService.postComment(params)).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                var $commentContainer = $rplWrp.siblings(\".ui-bizagi-wp-project-discussion-comment-list\");\r\n                var newComment = {\r\n                    user: params.content.user,\r\n                    attachments: params.content.attachments,\r\n                    text: params.content.text,\r\n                    guid: params.content.guid,\r\n                    parent: params.content.parent,\r\n                    date: params.content.date\r\n                };\r\n\r\n                //reset for a new comment\r\n                self.attchComments[params.content.parent] = {\r\n                    addition: [],\r\n                    remove: []\r\n                };\r\n\r\n                $textarea.val(\"\");\r\n                $uploadList.empty();\r\n                $buttonsWrp.hide();\r\n\r\n                //Add new comment to the list\r\n                self.commentsList[newComment.parent].comments.unshift(newComment);\r\n                self.renderCommentByDiscussion($commentContainer, newComment.parent, []);\r\n\r\n                self.plugins.attchComments.close();\r\n                self.renderUserProfilesAndImages();\r\n            }\r\n        });\r\n    },\r\n\r\n    renderAttachments: function (files, type, $container) {\r\n        var self = this;\r\n        var attachTemplate = self.getTemplate(\"project-discussions-attachments\");\r\n\r\n        var $fileList = attachTemplate.render({attachments: files, type: type});\r\n        $container.append($fileList);\r\n        if(bizagi.util.isIE()){//\"shake\" files container for IE error\r\n            $(\".ui-bizagi-wp-project-attachments-list li\").hide(10,function() {\r\n                $(this).show();\r\n            });\r\n        }\r\n    },\r\n\r\n    prepareFilesToSave: function (type, guid) {\r\n\r\n        var self = this;\r\n        var files = [],\r\n            fileList = (type === \"COMMENTS\") ? self.attchComments[guid] : self.attchDiscussions,\r\n            attachmentsToCreate = [];\r\n\r\n        fileList = fileList || {addition: [], remove: []};\r\n\r\n        for (var i = 0, length = fileList.addition.length - 1; i <= length; i++) {\r\n            files.push({\r\n                guid: fileList.addition[i].guid,\r\n                name: fileList.addition[i].name\r\n            });\r\n\r\n            attachmentsToCreate.push(fileList.addition[i].guid);\r\n        }\r\n\r\n        return {\r\n            attachments: files,\r\n            attachmentsToCreate: attachmentsToCreate,\r\n            attachmentsToDelete: fileList.remove\r\n        };\r\n    },\r\n\r\n    onClickCancel: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n\r\n        self.resetDiscussionAttachments();\r\n        self.onClosePopupDiscussion();\r\n\r\n        self.plugins.attchDiscussions.cancelFilesUpload();\r\n    },\r\n\r\n    onClosePopupDiscussion: function () {\r\n        var self = this;\r\n        self.resetFormDiscussion();\r\n        self.plugins.attchDiscussions.destroy();\r\n        self.dialogBoxDiscussion.formContent.dialog(\"destroy\");\r\n        self.dialogBoxDiscussion.formContent.detach();\r\n    },\r\n\r\n    onOpenPopupDiscussion: function () {\r\n        var self = this;\r\n\r\n        self.plugins.attchDiscussions = self.applyFileAttachments(\"DISCUSSIONS\");\r\n\r\n        //popup\r\n        self.dialogBoxDiscussion.formContent.parent().css(\"z-index\",10001);\r\n        //overlay\r\n        self.dialogBoxDiscussion.formContent.parent().parent().find(\".ui-widget-overlay\").css(\"z-index\",10001);\r\n\r\n        setTimeout(function () {\r\n            self.form.subject.focus();\r\n        }, 50);\r\n    },\r\n\r\n    onSubmitFormDiscussion: function (event) {\r\n        event.preventDefault();\r\n\r\n        var self = this;\r\n        var guid;\r\n        if (self.validateAddDiscussionForm(self.dialogBoxDiscussion.formContent)) {\r\n            if (self.form.edition.guid) {\r\n                guid = self.form.edition.guid;\r\n                $.proxy(self.sendDataUpdateDiscussion(guid), self);\r\n            } else {\r\n                guid = Math.guid();\r\n                $.proxy(self.sendDataInsertDiscussion(guid), self);\r\n            }\r\n        }\r\n    },\r\n\r\n    restrictedEventsHandler: function () {\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\",\".bz-bizagi-wp-project-discussions-attachment-itemwrapper\", $.proxy(self.switchCommentsEvents, self));\r\n    },\r\n\r\n    eventsHandler: function () {\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        //Add events\r\n        self.form.buttonShowFormNewDiscussion.on(\"click\", $.proxy(self.onNotifyOpenPopup, self));\r\n        self.form.buttonCancel.on(\"click\", $.proxy(self.onClickCancel, self));\r\n        self.form.buttonAddDiscussion.on(\"click\", $.proxy(self.onSubmitFormDiscussion, self));\r\n        self.form.attachments.on(\"click\", \".bz-bizagi-wp-project-discussions-attachment-delete, .bz-bizagi-wp-project-discussions-attachment-itemwrapper\", function (event) {\r\n\r\n            if ($(event.target).hasClass(\"bz-bizagi-wp-project-discussions-attachment-delete\")) {\r\n                self.onRemoveFiles($(event.target));\r\n            } else {\r\n                self.onDownloadAttachment($(event.target).closest(\"li\"));\r\n            }\r\n\r\n            event.stopPropagation();\r\n        });\r\n\r\n        $(\"#ui-bizagi-wp-project-discussions-list-wrapper\", $contentWidget).on(\"click\", \".ui-bizagi-wp-project-discussions-add-comment textarea\" +\r\n            \", .ui-bizagi-wp-project-discussions-comment-buttons-cancel\" +\r\n            \", .ui-bizagi-wp-project-discussions-comment-buttons-share\" +\r\n            \", .ui-bizagi-wp-project-discussion-showmore-comments button\" +\r\n            \", .bz-bizagi-wp-project-discussions-attachment-delete\" +\r\n            \", .ui-bizagi-wp-project-discussion-delete\" +\r\n            \", .bz-bizagi-wp-project-discussions-attachment-itemwrapper\" +\r\n            \", .ui-bizagi-wp-project-discussions-comment-view\" +\r\n            \", .ui-bizagi-wp-project-discussions-items-edition\" +\r\n            \", .biz-wp-action-edit-discussion\", $.proxy(self.switchCommentsEvents, self));\r\n\r\n        self.sub(\"changeProjectWidget\", function () {\r\n            self.resetWidget();\r\n        });\r\n        self.sub(\"OPEN_POPUP_DISCUSSION\", $.proxy(self.onNotifyOpenPopup, self));\r\n    },\r\n\r\n    resetWidget: function () {\r\n        var self = this;\r\n        self.userPictures = [];\r\n        if (self.plugins.attchComments) {\r\n            self.plugins.attchComments.close();\r\n        }\r\n    },\r\n\r\n    clean: function () {\r\n\r\n        var self = this;\r\n        self.resetWidget();\r\n\r\n        if(self.form && self.form.buttonShowFormNewDiscussion){\r\n            self.form.buttonShowFormNewDiscussion.off(\"click\", $.proxy(self.onNotifyOpenPopup, self));\r\n        }\r\n\r\n\r\n        for (var i in self.plugins) {\r\n            if (self.plugins[i] && self.plugins[i].hasOwnProperty(\"destroy\")) {\r\n                if (self.plugins[i].destroy) {\r\n                    self.plugins[i].destroy();\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    mapTempComments: function ($source, $target){\r\n            var $textareaSource = $source.find(\"textarea\");\r\n            var $textareaTarget = $target.find(\"textarea\");\r\n            var $uploadListSource = $source.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\r\n            var $uploadListTarget = $target.find(\".ui-bizagi-wp-project-attachments-list[data-type=COMMENT]\").first();\r\n            $textareaTarget.val($textareaSource.val());\r\n            $uploadListTarget.empty().append($uploadListSource.html());\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.discussions\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.discussions], true);","/*\r\n *   Name: Bizagi Workportal project Plan Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.sidebar\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, serviceloadDataPlan, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.serviceloadDataPlan = serviceloadDataPlan;\r\n      self.params = params || {};\r\n      params.supportNav = false;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-plan-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.plan.sidebar\").concat(\"#project-plan-sidebar\")\r\n      });\r\n\r\n   },\r\n\r\n    /*\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"project-plan-sidebar\");\r\n        self.content = template.render({});\r\n        $.when(self.areTemplatedLoaded())\r\n                .done(function () {\r\n                    var params = {idPlan: self.params.plan.id};\r\n                    if (self.params.planChild && self.params.planChild.id) {\r\n                        params.idPlan = self.params.planChild.id;\r\n                    }\r\n                    self.serviceloadDataPlan.loadData(params, self.getDateServer, self.params);\r\n                    self.serviceloadDataPlan.subscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n                    self.serviceloadDataPlan.subscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n                });\r\n        return self.content;\r\n    },\r\n\r\n    loadedWithDataActivities: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOADED_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"UPDATE_INFO_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PROGRESS_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    loadedWithDataFirstParent: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    clean: function(){\r\n        var self = this;\r\n        if(self.serviceloadDataPlan){\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n        }\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.sidebar\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.loadDataPlan\", bizagi.workportal.widgets.project.plan.sidebar], true);","/*\r\n *   Name: Bizagi Workportal project Discussion Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.discussion.sidebar\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      params = params || {};\r\n      params.supportNav = false;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-discussion-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.discussion.sidebar\").concat(\"#project-discussion-sidebar\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-discussion-sidebar\");\r\n      self.content = template.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers)});\r\n\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      var $contentWidget = self.getContent();\r\n      $(\".ui-bizagi-wp-project-discussions-sidebar-action-add > a\", $contentWidget).on(\"click\"\r\n         ,$.proxy(self.onShowPopupDiscussion, self));\r\n   },\r\n\r\n   /**\r\n    * Events elements\r\n    */\r\n   onShowPopupDiscussion: function () {\r\n      var self = this;\r\n      self.pub(\"notify\", {\r\n         type: \"OPEN_POPUP_DISCUSSION\",\r\n         args: {}\r\n      });\r\n   }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.discussion.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.discussion.sidebar], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Action\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.action\", {}, {\r\n\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, projectDashboard, notifier, planTemplateCreate, planPopupEdit, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.PENDING_PLAN = \"PENDING\";\r\n        self.EXECUTING_PLAN = \"EXECUTING\";\r\n        self.CLOSED_PLAN = \"CLOSED\";\r\n\r\n        self.CONTEXT_ACTIVITYPLAN = \"ACTIVITYPLAN\";\r\n        self.CONTEXT_ACTIVITYPLANOVERVIEW = \"ACTIVITYPLANOVERVIEW\";\r\n        self.CONTEXT_PLANCREATE = \"PLANCREATE\";\r\n        self.CONTEXT_ACTIVITYPLANCREATE = \"ACTIVITYPLANCREATE\";\r\n\r\n        self.showActionsPlan = false;\r\n        self.projectDashboard = projectDashboard;\r\n        self.notifier = notifier;\r\n        self.planTemplateCreate = planTemplateCreate;\r\n        self.planPopupEdit = planPopupEdit;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"plan-action-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.action\").concat(\"#project-plan-action\")\r\n        });\r\n    },\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"plan-action-main\");\r\n\r\n        self.showActionsPlan =  self.params.showContextByMenuDashboard !== self.CONTEXT_ACTIVITYPLAN &&\r\n            self.params.showContextByMenuDashboard !== self.CONTEXT_ACTIVITYPLANOVERVIEW;\r\n\r\n        self.plugins = {};\r\n        self.content = tmpl.render({\r\n            plan: self.params.plan.name,\r\n            stateClosedPlan: self.CLOSED_PLAN,\r\n            currentStatePlan: self.params.plan.currentState,\r\n            showActionsPlan: self.showActionsPlan\r\n        });\r\n\r\n        if (self.showActionsPlan) {\r\n            self.params.plan.contextualized = typeof(self.params.plan.contextualized) == \"undefined\" ? true : self.params.plan.contextualized;\r\n        }\r\n\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        if(self.showActionsPlan){\r\n            self.initilizeActionMenu();\r\n            $(\"a#to-close-plan\", $contentWidget).on(\"click\", $.proxy(self.onClosePlan, self));\r\n        }\r\n\r\n        self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n        self.clearAlertsOnFocus();\r\n\r\n        self.planTemplateCreate.sub('planTemplateCreatedSuccess', function () {\r\n            self.notifier.showSucessMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-create-template-success'), ''));\r\n        });\r\n        self.planTemplateCreate.sub('planTemplateCreatedFailed', function () {\r\n            self.notifier.showErrorMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-create-template-fail'), ''));\r\n        });\r\n\r\n        self.planPopupEdit.sub('planEditedSuccess', function () {\r\n            self.setNamePlan(self.params.plan.name);\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"UPDATE_INFO_PLAN\"\r\n            });\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n                args: self.params\r\n            });\r\n\r\n            self.notifier.showSucessMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-edit-success'), ''));\r\n        });\r\n\r\n        self.planPopupEdit.sub('planEditedFailed', function () {\r\n            self.notifier.showErrorMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-edit-fail'), ''));\r\n        });\r\n\r\n        self.sub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n    },\r\n\r\n    onNotifyExpandedRightSidebar: function(){\r\n        var self = this;\r\n        if(self.showActionsPlan){\r\n            self.initilizeActionMenu();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Notifies when an event is raised\r\n     */\r\n\r\n    onNotifyLoadInfoSummaryPlan: function () {\r\n        var self = this;\r\n        self.setStatePlan(self.params.plan.currentState);\r\n        self.setNamePlan(self.params.plan.name);\r\n    },\r\n\r\n    /**\r\n     * UI\r\n     */\r\n\r\n    setStatePlan: function (statePlan) {\r\n        var self = this;\r\n        if (statePlan) {\r\n            switch (statePlan.toUpperCase()) {\r\n                case \"PENDING\":\r\n                    $(\".state-pending-plan\", self.content).show().siblings().hide();\r\n                    break;\r\n                case \"EXECUTING\":\r\n                    $(\".state-executing-plan\", self.content).show().siblings().hide();\r\n                    break;\r\n                case \"CLOSED\":\r\n                    $(\".state-closed-plan\", self.content).show().siblings().hide();\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    setNamePlan: function(namePlan){\r\n        var self = this;\r\n        $(\".ui-bizagi-wp-project-plan-header .bz-wp-section\", self.content).text(bizagi.util.decodeHtmlEntities(namePlan));\r\n    },\r\n\r\n    /**\r\n     Events\r\n     */\r\n    onSelectMenu: function (event, ui) {\r\n        var self = this;\r\n        if($(event.currentTarget).find(\"i\").length === 0){\r\n            var item = $(ui.item).data(\"item\");\r\n\r\n            switch (item) {\r\n                case \"edit\":\r\n                    self.onClickMenuOpenEdition();\r\n                    break;\r\n                case \"delete\":\r\n                    self.onClickMenuDeletePlan();\r\n                    break;\r\n                case \"saveastmpl\":\r\n                    self.onClickMenuSaveAsTemplate();\r\n                    break;\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    onClickMenuOpenEdition: function () {\r\n        var self = this;\r\n        var planSelected = self.params.plan;\r\n        self.planPopupEdit.showPopup(self.params, self.dataService, planSelected);\r\n    },\r\n\r\n    onClickMenuSaveAsTemplate: function () {\r\n        var self = this;\r\n        self.planTemplateCreate.showPopupAddTemplatePlan(self.params,\r\n            self.dataService, self.params.plan.contextualized, self.params.plan.id);\r\n    },\r\n\r\n    onClickMenuDeletePlan: function(){\r\n        var self = this;\r\n\r\n        $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-plan-action-delete-confirmation\"), \"\", \"info\")).done(function () {\r\n            var params = { id: self.params.plan.id };\r\n\r\n            $.when(self.callDeletePlan(params)).always(function(response){\r\n                if (response.status === 200 || typeof (response.status) === \"undefined\") {\r\n                    $.extend(self.params.plan, params);\r\n                    self.notifier.showSucessMessage(\r\n                        printf(bizagi.localization.getResource(\"workportal-project-plan-delete-success\"), \"\"));\r\n\r\n                    //when a plan created from an activity is deleted, not created from a case\r\n                    var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\"});\r\n                    var currentLevelNavigator = parseInt(getLevelNavigator[0]);\r\n                    var params = self.projectDashboard.getParamsByBackFromPlan(self.params, currentLevelNavigator, true);\r\n\r\n                    self.pub(\"notify\", {\r\n                        type: params.typeContext,\r\n                        args: $.extend(self.params, params.paramsNotify)\r\n                    });\r\n                }\r\n                else{\r\n                    self.notifier.showErrorMessage(\r\n                        printf(bizagi.localization.getResource('workportal-project-plan-delete-fail'), ''));\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    onSubmitFormPlan: function (event) {\r\n        event.preventDefault();\r\n    },\r\n\r\n    initilizeActionMenu: function () {\r\n        var self = this;\r\n        $(\".ui-bizagi-wp-project-plan-action-menu\", self.content).menu({\r\n            select: $.proxy(self.onSelectMenu, self)\r\n        }).removeClass(\"ui-widget-content\");\r\n    },\r\n\r\n\r\n    /**\r\n     * Initialize edit plugin\r\n     */\r\n\r\n    clearAlertsOnFocus: function () {\r\n        $(\".ui-bizagi-wp-project-container-validator-relative input, .ui-bizagi-wp-project-container-validator-relative textarea\").focus(function () {\r\n            $(this).parent().find(\".k-invalid-msg\").hide();\r\n        }).focusout(function () {\r\n            if ($(this).val().length < 1) {\r\n                $(this).parent().find(\".k-invalid-msg\").show();\r\n            }\r\n        });\r\n    },\r\n\r\n    /*activitiesAreCompleted: function(activities){\r\n        var listActivities = activities || [];\r\n        var numActivitiesCompleted =  listActivities.filter(function(activity){\r\n            return activity.finishDate;\r\n        }).length;\r\n        return numActivitiesCompleted == activities.length;\r\n    },*/\r\n\r\n    /*getCopyObjectPlan: function(){\r\n        var self = this;\r\n        return {\r\n            id: self.params.plan.id,\r\n            name: self.params.plan.name,\r\n            description: self.params.plan.description,\r\n            dueDate: self.params.plan.dueDate,\r\n            waitForCompletion: self.params.plan.waitForCompletion,\r\n            currentState: self.params.plan.currentState,\r\n            parentWorkItem: self.params.plan.parentWorkItem,\r\n            creationDate: self.params.plan.creationDate,\r\n            startDate: self.params.plan.startDate,\r\n            idUserCreator: self.params.plan.idUserCreator,\r\n            contextualized: self.params.plan.contextualized,\r\n            activities: self.params.plan.activities\r\n        };\r\n    },*/\r\n\r\n    /**\r\n     * Call services\r\n     */\r\n    /*callUpdatePlan: function(params){\r\n        var self = this;\r\n        return $.when(self.dataService.updatePlan(params)).done(function () {\r\n            $.extend(self.params.plan, params);\r\n\r\n        });\r\n    },\r\n\r\n    callClosePlan: function(params){\r\n        var self = this;\r\n        return $.when(self.dataService.closePlan(params)).done(function () {\r\n            $.extend(self.params.plan, params);\r\n            self.notifier.showSucessMessage(\r\n                printf(bizagi.localization.getResource(\"workportal-project-plan-close-success\"), \"\"));\r\n        });\r\n    },*/\r\n\r\n    callDeletePlan: function(params){\r\n        var self = this;\r\n        return $.when(self.dataService.deletePlan(params));\r\n    },\r\n\r\n    clean: function(){\r\n        var self = this;\r\n        self.planTemplateCreate.unsub(\"planTemplateCreatedSuccess\");\r\n        self.planTemplateCreate.unsub(\"planTemplateCreatedFailed\");\r\n        self.planPopupEdit.unsub(\"planEditedSuccess\");\r\n        self.planPopupEdit.unsub(\"planEditedFailed\");\r\n\r\n        self.unsub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.action\", [\"workportalFacade\", \"dataService\",\r\n    \"bizagi.workportal.services.behaviors.projectDashboard\", \"notifier\",\r\n    \"bizagi.workportal.widgets.project.plan.template.create\",\r\n    \"bizagi.workportal.widgets.project.plan.edit\",\r\n    bizagi.workportal.widgets.project.plan.action], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan State\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.state\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-state-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.state\").concat(\"#project-plan-state\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n      var self = this;\r\n      var tmpl = self.getTemplate(\"plan-state-main\");\r\n      var renderWidget = tmpl.render({});\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n       var state = self.params.plan.currentState;\r\n\r\n       switch (state.toUpperCase()) {\r\n         case \"PENDING\":\r\n            $(\".state-pending\", renderWidget).show().siblings().hide();\r\n            break;\r\n         case \"EXECUTING\":\r\n            $(\".state-executing\", renderWidget).show().siblings().hide();\r\n            break;\r\n         case \"CLOSED\":\r\n            $(\".state-closed\", renderWidget).show().siblings().hide();\r\n            break;\r\n      }\r\n      self.content.empty().append(renderWidget);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.state\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.state], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Progress\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.progress\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-progress-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.progress\").concat(\"#project-plan-progress\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n\r\n      self.sub(\"LOAD_INFO_SUMMARY_PROGRESS_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      var $content = self.getContent().empty();\r\n\r\n      var valuePercentBarComplete = self.calculateProgress();\r\n\r\n      var argsTemplate = {};\r\n      argsTemplate.progress = valuePercentBarComplete;\r\n\r\n      if(argsTemplate.progress < 33){\r\n         argsTemplate.colorBar = \"Red\";\r\n      }\r\n      else if(argsTemplate.progress < 66){\r\n         argsTemplate.colorBar = \"Yellow\";\r\n      }\r\n      else{\r\n         argsTemplate.colorBar = \"Green\";\r\n      }\r\n\r\n      //Update widget\r\n      var contentTemplate = self.getTemplate(\"plan-progress-main\");\r\n      contentTemplate\r\n         .render(argsTemplate)\r\n         .appendTo($content);\r\n\r\n      //Begin Adjust status bar next to the number days\r\n      var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\r\n      var widthNumberDays = $(\".remaining-days .days\", $content).width();\r\n      $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\r\n      //End Adjust status bar next to the number days\r\n\r\n\r\n   },\r\n\r\n   calculateProgress: function(){\r\n      var self = this;\r\n\r\n      var completedActivities = 0;\r\n      var totalActivities = self.params.plan.activities.length;\r\n      var percentProgress = 0;\r\n      \r\n      if(totalActivities !== 0){\r\n         self.params.plan.activities.forEach(function(activity){\r\n             if (activity.workItemState === \"Completed\") {\r\n               completedActivities++;\r\n            }\r\n         });\r\n         percentProgress = Math.round((completedActivities / totalActivities) * 100);\r\n      }\r\n      return percentProgress;\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.progress\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.progress], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Time\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.time\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.PENDING_PLAN = \"PENDING\";\r\n      self.EXECUTING_PLAN = \"EXECUTING\";\r\n      self.CLOSED_PLAN = \"CLOSED\";\r\n\r\n      //Regional\r\n      self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-time-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.time\").concat(\"#project-plan-time\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n\r\n      self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      if(self.params.plan){\r\n         if(self.params.plan.dueDate){\r\n            if(self.params.plan.currentState === self.PENDING_PLAN || self.params.plan.currentState === self.EXECUTING_PLAN ){\r\n               self.updateWidget(event, params);\r\n            }\r\n            else{\r\n               self.sub(\"LOADED_ACTIVITIES_PLAN\", $.proxy(self.updateWidget, self));\r\n            }\r\n         }\r\n         else{\r\n            self.getContent().empty();\r\n         }\r\n      }\r\n\r\n   },\r\n   \r\n   /**\r\n    * change the time properties string to timestamp number\r\n    * @param {*} plan \r\n    */\r\n   planDatesToStamp:function (plan) {\r\n      if(plan.activities)\r\n         plan.activities.map(function(a) {\r\n            if(a.estimatedFinishDate)a.estimatedFinishDate=new Date(a.estimatedFinishDate).getTime();\r\n            if(a.startDate)a.startDate=new Date(a.startDate).getTime();\r\n            if(a.finishDate)a.finishDate=new Date(a.finishDate).getTime();\r\n         });\r\n      if(plan.dueDate)plan.dueDate=new Date(plan.dueDate).getTime();\r\n      if(plan.creationDate)plan.creationDate=new Date(plan.creationDate).getTime();\r\n      if(plan.startDate)plan.startDate=new Date(plan.startDate).getTime();\r\n      if(plan.closedDate)plan.closedDate=new Date(plan.closedDate).getTime();\r\n      if(plan.finishDate)plan.finishDate=new Date(plan.finishDate).getTime();\r\n   },\r\n   updateWidget: function(event, params){\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.planDatesToStamp(self.params.plan);\r\n      var $content = self.getContent().empty();\r\n      if(self.params.plan.currentState === self.CLOSED_PLAN){\r\n         self.getClosedDatePlan(self.params.plan);\r\n      }\r\n      $.when(self.getIntervalOnMinutes(self.params.plan)).done(function(response){\r\n         var relativeTime =  bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - (response.minutesToShowTime * 60 * 1000)), null, true);\r\n\r\n         var messageUnitTimeCalculated = relativeTime.replace(/\\d/g,\"\");\r\n         var keywordResourceDescriptionDifference = self.getKeywordDifferenceDates(self.params.plan);\r\n         var messageDescripionDifference = bizagi.localization.getResource(\"workportal-project-plan-state-\" + keywordResourceDescriptionDifference);\r\n         messageDescripionDifference = messageDescripionDifference.replace(\"%s\", messageUnitTimeCalculated);\r\n\r\n         var valueOfTimeCalculated = relativeTime.replace(/\\D/g,\"\");\r\n\r\n         var auxToDate = self.getSecondDate(self.params.plan);\r\n         var auxPercentBar = self.getWidthBar(self.params.plan, response);\r\n         var auxColorBar = self.getColorBarByPercent(auxPercentBar);\r\n         var argsTemplate = {\r\n            fromDate:  self.getFormattedDate(new Date(self.getFirstDate(self.params.plan))),\r\n            toDate: auxToDate ? self.getFormattedDate(new Date(auxToDate)) : null,\r\n            valueOfTimeCalculated: valueOfTimeCalculated,\r\n            messageDescripionDifference: messageDescripionDifference,\r\n            percentBar: auxPercentBar,\r\n            colorBar: auxColorBar\r\n         };\r\n\r\n         var contentTemplate = self.getTemplate(\"plan-time-main\");\r\n         contentTemplate\r\n            .render(argsTemplate)\r\n            .appendTo($content);\r\n\r\n      });\r\n   },\r\n   getFirstDate: function(plan){\r\n      var self = this;\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate){\r\n               return plan.dueDate;\r\n            }\r\n            else{\r\n               return plan.creationDate;\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n         case self.CLOSED_PLAN:\r\n            return plan.startDate;\r\n      }\r\n   },\r\n   getSecondDate: function(plan){\r\n      var self = this;\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            return null;\r\n         case self.EXECUTING_PLAN:\r\n            return plan.dueDate;\r\n         case self.CLOSED_PLAN:\r\n            return plan.closedDate;\r\n      }\r\n   },\r\n   getLastActivity: function(activities){\r\n      var copyActivities = JSON.parse(JSON.stringify(activities));\r\n      return copyActivities.sort(function(activityA, activityB){\r\n         return (activityA.finishDate < activityB.finishDate) ? 1 : -1;\r\n      })[0];\r\n   },\r\n\r\n   getClosedDatePlan: function(plan){\r\n      var self = this;\r\n      plan.closedDate =  self.getLastActivity(plan.activities).finishDate;\r\n      return plan.closedDate;\r\n   },\r\n\r\n   getDifferenceBetweenDates: function(firstDate, secondDate){\r\n      var self = this;\r\n      var defer = $.Deferred();\r\n      var params = {\r\n         idUser: bizagi.currentUser.idUser,\r\n         fromDate: firstDate,\r\n         toDate: secondDate\r\n\r\n      };\r\n      $.when(self.callGetEffectiveDuration(params)).done(function(difference){\r\n         defer.resolve(difference.minutes);\r\n      });\r\n      return defer.promise();\r\n   },\r\n\r\n   getIntervalOnMinutes: function(plan){\r\n      var self = this;\r\n      var defer = $.Deferred();\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate > Date.now()){\r\n               $.when(self.getDifferenceBetweenDates(Date.now(), plan.dueDate)).done(function(minutesNowToDueDate){\r\n                   $.when(self.getDifferenceBetweenDates(plan.creationDate, Date.now())).done(function(minutesCreateToNow){\r\n                       defer.resolve({minutesToShowTime: minutesNowToDueDate, minutesCreateToNow: minutesCreateToNow});\r\n                   });\r\n               });\r\n            }\r\n            else if(plan.dueDate < plan.creationDate){\r\n               $.when(self.getDifferenceBetweenDates(plan.dueDate,  plan.creationDate)).done(function(minutesDueDateToCreate){\r\n                   $.when(self.getDifferenceBetweenDates(plan.creationDate, Date.now())).done(function(minutesCreateToNow){\r\n                       defer.resolve({minutesToShowTime: minutesDueDateToCreate + minutesCreateToNow, minutesCreateToNow: minutesCreateToNow});\r\n                   });\r\n               });\r\n            }\r\n            else if(plan.dueDate > plan.creationDate){\r\n                $.when(self.getDifferenceBetweenDates(plan.creationDate, plan.dueDate)).done(function(minutesCreateToDueDate){\r\n                    $.when(self.getDifferenceBetweenDates(plan.dueDate, Date.now())).done(function(minutesCreateToNow){\r\n                        defer.resolve({minutesToShowTime: minutesCreateToDueDate + minutesCreateToNow, minutesCreateToNow: minutesCreateToNow});\r\n                    });\r\n                });\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n            if(plan.dueDate){\r\n               if(plan.dueDate > Date.now()){\r\n                  $.when(self.getDifferenceBetweenDates(Date.now(), plan.dueDate)).done(function(minutesNowToDueDate){\r\n                      $.when(self.getDifferenceBetweenDates(plan.startDate, Date.now())).done(function(minutesStartToNow){\r\n                          defer.resolve({minutesToShowTime: minutesNowToDueDate, minutesStartToNow: minutesStartToNow});\r\n                      });\r\n                  });\r\n               }\r\n               else{\r\n                  $.when(self.getDifferenceBetweenDates(plan.dueDate, Date.now())).done(function(minutesDueDateToNow){\r\n                      $.when(self.getDifferenceBetweenDates(plan.startDate, plan.dueDate)).done(function(minutesStartToDueDate){\r\n                          defer.resolve({minutesToShowTime: minutesDueDateToNow, minutesStartToDueDate: minutesStartToDueDate});\r\n                      });\r\n                  });\r\n               }\r\n\r\n            }\r\n            else{\r\n               $.when(self.getDifferenceBetweenDates(plan.startDate, Date.now())).done(function(minutes){\r\n                  defer.resolve({minutesToShowTime: minutes});\r\n               });\r\n            }\r\n            break;\r\n         case self.CLOSED_PLAN:\r\n            $.when(self.getDifferenceBetweenDates(plan.startDate, plan.closedDate)).done(function(minutes){\r\n               defer.resolve({minutesToShowTime: minutes});\r\n            });\r\n\r\n      }\r\n      return defer.promise();\r\n   },\r\n\r\n   getKeywordDifferenceDates: function(plan){\r\n      var self = this;\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate > Date.now()){\r\n               return \"remaining\";\r\n            }\r\n            else {\r\n               return \"exceeded\";\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n            if(plan.dueDate){\r\n               if(plan.dueDate > Date.now()){\r\n                  return \"remaining\";\r\n               }\r\n               else{\r\n                  return \"exceeded\";\r\n               }\r\n\r\n            }\r\n            else{\r\n               return \"opened\";\r\n            }\r\n            break;\r\n         case self.CLOSED_PLAN:\r\n            return \"executed\";\r\n      }\r\n   },\r\n\r\n   getRelativeTime: function(milliseconds){\r\n      return bizagi.util.dateFormatter.getRelativeTime(milliseconds, null, false);\r\n   },\r\n\r\n   getWidthBar: function(plan, intervalMinutes){\r\n      var self = this,\r\n         differenceStartDateToCurrentDate = {};\r\n      switch(plan.currentState) {\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate){\r\n               if(plan.dueDate < Date.now()){\r\n                  return 0;\r\n               }\r\n               else{\r\n                   var totalInterval = intervalMinutes.minutesCreateToNow + intervalMinutes.minutesToShowTime;\r\n                   valuePercentInterval = intervalMinutes.minutesToShowTime;\r\n                   return Math.ceil(valuePercentInterval * 100 / totalInterval);\r\n               }\r\n            }\r\n            else{\r\n               return 0;\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n            if(plan.dueDate) {\r\n               if (plan.dueDate > Date.now()) {\r\n                  var totalInterval = intervalMinutes.minutesStartToNow + intervalMinutes.minutesToShowTime;\r\n                  valuePercentInterval = intervalMinutes.minutesToShowTime;\r\n                  return Math.ceil(valuePercentInterval * 100 / totalInterval);\r\n               }\r\n               else{\r\n                  return 0;\r\n               }\r\n            }\r\n            else{\r\n               return 0;\r\n            }\r\n            break;\r\n         case self.CLOSED_PLAN:\r\n            if(plan.closedDate > Date.now()){\r\n               var differenceStartDateToClosedDate = plan.closedDate - plan.startDate;\r\n               differenceStartDateToCurrentDate = Date.now() - plan.startDate;\r\n               return Math.ceil(differenceStartDateToCurrentDate * 100 / differenceStartDateToClosedDate);\r\n            }\r\n            else{\r\n               return 100;\r\n            }\r\n      }\r\n\r\n\r\n   },\r\n\r\n   getColorBarByPercent: function(percent){\r\n      if(percent < 33){\r\n         return \"Red\";\r\n      }\r\n      else if(percent < 66){\r\n         return \"Yellow\";\r\n      }\r\n      else {\r\n         return \"Green\";\r\n      }\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n\r\n   callGetEffectiveDuration: function(params){\r\n      var self = this;\r\n      var d = $.Deferred();\r\n\r\n      $.when(\r\n         self.dataService.getEffectiveDuration(params)\r\n      ).done(function (data) {\r\n            d.resolve(data);\r\n         });\r\n      return d.promise();\r\n   },\r\n\r\n   getFormattedDate: function (dateObj) {\r\n      var self = this;\r\n      var monthsNames = self.datePickerRegional.monthNames;\r\n      var shortMonth = dateObj.getMonth();\r\n      return monthsNames[shortMonth] + \" \" + bizagi.util.dateFormatter.formatDate(dateObj, \"dd hh:mm tt\", bizagi.localization.getResource(\"datePickerRegional\"));\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.time\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.time], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Parent\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.parent\", {}, {\r\n\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"plan-parent-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.parent\").concat(\"#project-plan-parent\")\r\n        });\r\n    },\r\n\r\n    renderContent: function () {\r\n\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n    },\r\n\r\n    /**\r\n     * Notifies when an event is raised\r\n     */\r\n    onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n        var self = this,\r\n        $content = self.getContent().empty();\r\n        self.params = $.extend(self.params, params.args);\r\n        if (self.params.plan.parentWorkItem) {\r\n            $.when(self.dataService.getPlanParent({ idPlan: self.params.plan.id })).done(function(planParent) {\r\n                self.params.plan.parent = planParent;\r\n\r\n                  if (self.params.plan.parent) {\r\n                    var argsTemplate = {\r\n                        idParent: self.params.plan.parent.radNumber,\r\n                        nameParent: self.params.plan.parent.displayName,\r\n                        idCase: self.params.plan.parent.idCase,\r\n                        idWorkflow: self.params.plan.parent.idWorkflow,\r\n                        idWorkItem: self.params.plan.parent.idWorkItem,\r\n                        idTask: self.params.plan.parent.idTask,\r\n                        processName: self.params.process ? self.params.process : self.params.plan.parent.planName\r\n                    };\r\n\r\n                    if(bizagi.util.isEmpty(self.params.plan.parent.guidActivity)){\r\n                        self.goToParentCase($content, argsTemplate);\r\n                    }else{\r\n                        var paramsDetailActivity = {\r\n                            idPlan: self.params.plan.id,\r\n                            idActivity: self.params.plan.parent.guidActivity \r\n                        };\r\n                        $.when(self.dataService.getActivity(paramsDetailActivity)).done(function (response) {\r\n                            self.params.plan.parent.allowEdition = response.allowEdition;\r\n                            self.goToParentCase($content, argsTemplate);\r\n                         });\r\n                    }\r\n                    \r\n                }\r\n            \r\n            }).fail(function(msg) {\r\n\r\n            });\r\n        }\r\n    },\r\n    goToParentCase: function(content, argsTemplate){\r\n        var self = this\r\n        //TODO: double call because routing dont release memory and widgets\r\n        //Test with a breakpoint\r\n        content.empty();\r\n\r\n        //Update widget\r\n        var contentTemplate = self.getTemplate(\"plan-parent-main\");\r\n        contentTemplate\r\n            .render(argsTemplate)\r\n            .appendTo(content);\r\n        $(\"#go-to-parent-case\", content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\r\n    },\r\n    onClickGoToParentCase: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n        self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.parent\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.parent], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Users\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.users\", {}, {\r\n\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        self.usersMap = {};\r\n        self.plugins = {};\r\n        self.usersInformation=[];\r\n        self.globalHandlersService = bizagi.injector.get('globalHandlersService');\r\n        self.usersAssignees = [];\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"plan-users-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.users\").concat(\"#project-plan-users\")\r\n        });\r\n\r\n        self.auxNoRepeatTypesUser = {};\r\n        self.hashTypesUser = {\r\n            \"assigned\": bizagi.localization.getResource(\"workportal-project-user-assigned\"),\r\n            \"owner\": bizagi.localization.getResource(\"workportal-project-user-owner\")\r\n        };\r\n    },\r\n\r\n    renderContent: function () {\r\n\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.sub(\"LOAD_INFO_ACTIVITIES_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n    },\r\n\r\n    /**\r\n     * Notifies when an event is raised\r\n     */\r\n    onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n        var self = this,\r\n            args = params.args,\r\n            cvsGuidUsers = [],\r\n            activitiesUsers = [],\r\n            $content = self.getContent().empty();\r\n            var ownerUserGuid = params.args.plan.idUserCreator;\r\n            var ownerUserId = params.args.plan.idUserCreator;\r\n        self.params = $.extend(self.params, params.args);\r\n\r\n        activitiesUsers.push({ \"idUser\": ownerUserId, 'userGuid': ownerUserGuid, \"userType\": [\"owner\"]});\r\n        self.usersMap[\"-\" + ownerUserId + \"-\"] = {\r\n            picture: \"\",\r\n            id: ownerUserId,\r\n            guid: ownerUserGuid,\r\n            name: \"\",\r\n            userType: [\"owner\"]\r\n        };\r\n        cvsGuidUsers.push(ownerUserId);\r\n        $.each(self.params.plan.activities, function (index, activity) {\r\n            var userId = activity.userAssigned;\r\n            var userGuid = activity.userAssignedGuid;\r\n            if(activity.isRunning == true){\r\n                if (userId === ownerUserId) {\r\n                    if($.inArray(\"Assigned\", activitiesUsers[0].userType) === -1){\r\n                        activitiesUsers[0].userType.push(\"Assigned\");\r\n                        self.usersMap[\"-\" + ownerUserId + \"-\"].userType.push(\"Assigned\");\r\n                    }\r\n                }\r\n                else {\r\n                    self.usersMap[\"-\" + userId + \"-\"] = {\r\n                        picture: \"\",\r\n                        id: userId,\r\n                        guid: userGuid,\r\n                        name: \"\",\r\n                        userType: [\"Assigned\"]\r\n                    };\r\n                    if (activitiesUsers.filter(function(user) { return user.idUser == userId; }).length === 0) {\r\n                        activitiesUsers.push({\"idUser\": userId, \"guidUser\": userGuid, \"userType\": [\"Assigned\"]});\r\n                        cvsGuidUsers.push(userId);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        self.activitiesUsers = activitiesUsers;\r\n        self.params = args;\r\n        //Update widget\r\n        var contentTemplate = self.getTemplate(\"plan-users-main\");\r\n        contentTemplate\r\n            .render({\r\n                assignee: self.justAssignees(activitiesUsers),\r\n                label: bizagi.localization.getResource(\"workportal-project-plan-assignee\")\r\n            })\r\n            .appendTo($content);\r\n        self.initilizeTooltip();\r\n        self.addEventHandlersModal();\r\n        $.when(self.callGetDataUsers(cvsGuidUsers)).then(function () {\r\n            self.showCreatorInformation(ownerUserId);\r\n            self.renderUserProfilesAndImages();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * return standar userAdapter information with only assigned users when the plan has started\r\n     * @param {Array} allUsers \r\n     */\r\n    justAssignees: function (allUsers) {\r\n        var self = this;\r\n        var usersAssignee=[];\r\n        if ([\"CLOSED\", \"PENDING\"].indexOf(self.params.plan.currentState)==-1) {\r\n            allUsers.map(function(user) {\r\n                var isOwner=user.userType.indexOf(\"owner\")!==-1;\r\n                var isAssignee=user.userType.indexOf(\"Assigned\")!==-1;\r\n                usersAssignee.push(usersAdapter.createJsonUserInfo(user.idUser, \"\", \"\", \"\", \"\", \"\", isAssignee, isOwner, [], []));\r\n            });\r\n        }\r\n        return usersAdapter.justAssignees(usersAssignee);\r\n    },\r\n\r\n    /**\r\n     * show the information of the creator case\r\n     * @param {string} ownerUserId guid user creator\r\n     */\r\n    showCreatorInformation: function (ownerUserId) {\r\n        var self = this;\r\n        var userCreator=self.usersInformation.find(function(user) {\r\n            return user.id==ownerUserId\r\n        });\r\n        var userInfo = usersAdapter.createJsonUserInfo(\r\n            userCreator.id,\r\n            userCreator.name,\r\n            userCreator.username,\r\n            userCreator.picture?\"data:image/png;base64,\"+userCreator.picture:undefined,\r\n            userCreator.email,\r\n            userCreator.name.getInitials(),\r\n            false,\r\n            true,\r\n            [],\r\n            []\r\n        );\r\n        self.content.find(\".ui-bizagi-wp-project-plan-users .ui-bizagi-wp-project-users-creator-info\").userinformation(self, { user: userInfo });\r\n    },\r\n\r\n    /**\r\n     * UI\r\n     */\r\n    renderUserProfilesAndImages: function () {\r\n        var self = this;\r\n        $.each(self.usersMap, function (i, obj) {\r\n            var $li = $(\".ui-bizagi-wp-userlist li[data-iduser=\" + obj.id + \"]\", self.content);\r\n\r\n            if (obj.picture !== \"\") {\r\n                $li.find(\"img\").prop(\"src\", obj.picture);\r\n                $(\".bz-wp-avatar-label\", $li).hide();\r\n            }\r\n            else {\r\n                if(obj.name!==undefined){\r\n                    $(\".bz-wp-avatar-img\", $li).hide();\r\n                    $(\".bz-wp-avatar-label\", $li).html(obj.name.getInitials());\r\n                }\r\n                else{\r\n                    console.log(\"obj.name is undefined\");\r\n                }\r\n\r\n            }\r\n        });\r\n    },\r\n\r\n    /*\r\n     *  Get data for users\r\n     */\r\n    callGetDataUsers: function (csvguidUsers) {\r\n        var self = this,\r\n            params = {},\r\n            defer = $.Deferred();\r\n        params = {\r\n            usersGuids: csvguidUsers.join(),\r\n            width: 50,\r\n            height: 50\r\n        };\r\n        $.when(self.dataService.getUsersData(params)).always(function (response) {            \r\n            self.usersInformation = response;\r\n            for (var i = 0, length = response.length; i < length; i += 1) {\r\n                if (typeof (response[i].name) === \"undefined\") {\r\n                    bizagi.log(response[i] + \" Id Not Found\", response, \"error\");\r\n                } else {\r\n                    if(self.usersMap[\"-\" + response[i].id + \"-\"]){\r\n                        self.usersMap[\"-\" + response[i].id + \"-\"].picture += (response[i].picture) ? \"data:image/png;base64,\" + response[i].picture : \"\";\r\n                        self.usersMap[\"-\" + response[i].id + \"-\"].name = response[i].name || \"\";\r\n                    }\r\n                    else{\r\n                        console.log(\"self.usersMap['-' + response[i].id + '-'] is undefined\")\r\n                    }\r\n\r\n                }\r\n            }\r\n            self.getUsersAssignees();\r\n            defer.resolve();\r\n        });\r\n        return defer.promise();\r\n    },\r\n    \r\n    /*\r\n    * validate if the activity is running\r\n    */\r\n    activityRuning: function (activity) {\r\n        return activity.startDate !== null;\r\n    },\r\n\r\n    getUsersAssignees: function(){\r\n        var self = this;\r\n        for(var i=0; i<self.usersInformation.length; i++){\r\n            var res_user=self.getUserAssignee(self.usersInformation[i]);\r\n            if (res_user!==false) {\r\n                self.usersAssignees.push(res_user);\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    getUserAssignee: function(user){\r\n        var self =  this;\r\n        var tasks = [];\r\n        $.each(self.params.plan.activities, function (index, activity) {\r\n            var userId = activity.userAssigned;\r\n            if (userId === user.id && self.activityRuning(activity)) {\r\n                tasks.push({ \"name\": activity.name });\r\n            }\r\n        });\r\n        if(tasks.length==0)return false;\r\n        user.tasks = tasks;\r\n        var types = self.activitiesUsers.find(function(actUser) {\r\n            return actUser.idUser == user.id;\r\n        });\r\n        user.types = types===undefined?[]:types.userType;\r\n        \r\n        var userAssignees = usersAdapter.createJsonUserInfo(\r\n            user.id, \r\n            user.name, \r\n            user.username, \r\n            user.picture ? \"data:image/png;base64,\" + user.picture : undefined, \r\n            user.email, \r\n            user.name.getInitials(),\r\n            user.types.indexOf(\"Assigned\") > -1, \r\n            user.types.indexOf(\"owner\") > -1, \r\n            user.tasks, \r\n            []);\r\n\r\n            return userAssignees;\r\n       },\r\n\r\n    /*\r\n     *  Tooltips\r\n     */\r\n    initilizeTooltip: function () {\r\n        var self = this;\r\n\r\n        $(\".ui-bizagi-wp-userlist > li\", self.content).not(\".moreUsers\").on('mouseenter', '', function (ev) {\r\n            var $target = $(ev.target);\r\n            var id_userSelected=$target.closest(\"[data-iduser]\").attr('data-iduser');\r\n            var user=self.usersInformation.find(function(user) {\r\n                return user.id==id_userSelected;\r\n            });\r\n            var activities=[];\r\n\r\n            if(user.tasks)\r\n                user.tasks.map(function(task) {\r\n                    activities.push(task.name);\r\n                });\r\n\r\n            var types = self.activitiesUsers.find(function(actUser) {\r\n                return actUser.idUser == id_userSelected;\r\n            });\r\n            user.types = types.userType;\r\n           \r\n            user.owner = user.types.find(function(type){\r\n                return type == \"owner\";\r\n            });\r\n            user.isAssignee = user.types.find(function(type){\r\n                return type == \"Assigned\";\r\n            });\r\n                \r\n            var userParam= usersAdapter.createJsonUserInfo(user.id, user.name, user.username, user.picture?\"data:image/png;base64,\"+user.picture:undefined, user.email,  user.name.getInitials(), user.isAssignee, user.owner, activities, []);\r\n            $target.parent().usertooltip(self, { target: $target, user: userParam });\r\n        });\r\n    },\r\n    addEventHandlersModal: function () {\r\n        var self =  this;\r\n        $(\".moreUsers\").click(function(event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            var usersAssignees = self.usersAssignees || [];\r\n            self.globalHandlersService.publish(\"showDialogWidget\", {\r\n                widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL,\r\n                closeVisible: true,\r\n                data: usersAssignees,\r\n                maximize: true,\r\n                modalParameters: {\r\n                    title: bizagi.localization.getResource(\"workportal-project-users-title\")+ \" (\"+usersAssignees.length+\")\",\r\n                    width: 790,\r\n                    height: 526,\r\n                    refreshInbox: false\r\n                }\r\n            });\r\n         });\r\n       }\r\n});\r\n\r\n\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.users\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.users], true);"]}