{"version":3,"sources":["jquery/workportal/desktop/widget/project.dashboard.menu.plan/bizagi.workportal.desktop.widgets.project.dashboard.menu.plan.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.plan.activities/bizagi.workportal.desktop.project.plan.activities.js","jquery/workportal/desktop/widget/project.plan.sidebar/bizagi.workportal.desktop.widgets.project.plan.sidebar.js","jquery/workportal/desktop/widget/project.plan.action/bizagi.workportal.desktop.widgets.project.plan.action.js","jquery/workportal/desktop/widget/project.plan.state/bizagi.workportal.desktop.widgets.project.plan.state.js","jquery/workportal/desktop/widget/project.plan.progress/bizagi.workportal.desktop.widgets.project.plan.progress.js","jquery/workportal/desktop/widget/project.plan.time/bizagi.workportal.desktop.widgets.project.plan.time.js","jquery/workportal/desktop/widget/project.plan.parent/bizagi.workportal.desktop.widgets.project.plan.parent.js","jquery/workportal/desktop/widget/project.plan.users/bizagi.workportal.desktop.widgets.project.plan.users.js"],"names":["bizagi","workportal","widgets","widget","extend","init","workportalFacade","dataService","projectDashboard","params","self","this","_super","loadTemplates","project-dashboard-menu","getTemplate","concat","renderContent","content","$","postRender","contextsLeftSidebarCaseDashboard","forEach","context","sub","proxy","updateView","event","args","clean","$content","getContent","empty","template","menuPlanDashboard","menuDashboard","planState","getPlanState","plan","planChild","argsTemplate","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isVisibleShowTimeLine","render","appendTo","showContextByMenuDashboard","toUpperCase","addClass","siblings","removeClass","handlerEvents","currentState","extraValidationShowTimeLine","loadContentById","preventDefault","$item","target","closest","data","backParentPlan","hasClass","pub","type","subMenuHandler","$comments","$files","$timeline","on","toggle","getLevelNavigator","currentLevelNavigator","parseInt","getParamsByBackFromPlan","typeContext","paramsNotify","off","unsub","injector","register","project","dashboard","menu","project-content-dashboard","setTimeout","window","trigger","base","notifier","serviceOrderActivitiesByTransitions","PENDING_PLAN","EXECUTING_PLAN","CONTEXT_PLANACTIVITIES","CONTEXT_PLANOVERVIEW","CONTEXT_PLANCREATE","plugins","fromIndexEnabledSortingActivities","idActivityEditing","_statePlan","userPictures","refresh","refreshAllWidgets","plan-activities-main","plan-activities-item","onNotifySummaryProgressPlan","onNotifyUpdatePlan","renderWidgetByStatePlan","refreshActivityRow","collapseSidebars","state","isEnableEventsOnActivitiesByCurrentContext","enableEventsOnActivitiesByCurrentContext","auxCountActivitiesFinished","activities","filter","activity","finishDate","length","statePlan","statePendingPlan","stateExecutingPlan","contextPlanActivities","showFormAddActivityByNotFinishedAllActivities","currentUserGuid","currentUser","userGuid","sortablelist","initializeSortableList","addEventHandlers","setContentWrapper","onClickEditActivity","onClickDeleteActivity","onClickWorkonItActivity","onClickChangeParallel","onExecutePlan","onClosePlan","renderActivities","updateTransitions","getCopyObjectPlan","id","name","description","dueDate","waitForCompletion","parentWorkItem","creationDate","startDate","idUserCreator","contextualized","currentContext","text","kendoSortable","hint","element","$clone","clone","width","append","change","onChangePosition","disabled","end","e","newIndex","oldIndex","movePositionActivity","$liActivityGoDown","eq","canChangeToParallelActivity","parallel","defer","Deferred","idPlan","transitions","getActualTransitions","when","changeTransitions","always","response","responseText","xhr","status","showErrorMessage","localization","getResource","orderActivitiesByTransitions","resolve","promise","getActivitiesByTransitions","auxOrderTransitions","getActualTransitionsByActivities","transition","undefined","onCreateActivity","idUserAssigned","val","userAssigned","idUser","replace","progress","duration","allowEdition","estimatedFinishDate","parent","util","isEmpty","guidActivity","paramsDetailActivity","idActivity","getActivity","done","createPlanActivity","reset","responseActivity","activityNew","items","numTotalItems","numResolvedItems","push","$activityList","activityParallel","$wrapperArrow","currentTarget","$liActivitySelected","idActivitySelected","prop","changeActivityProperties","result","idLastParallelActivity","getLastParallelActivityIsRunningOrClose","prev","$target","activityToShow","isEditableFormActivity","workItemState","idActivityToShow","activityGuid","activityPropertiesToUpdate","iActivity","lengthActivities","focus","$list","tmpl","$element","show","hide","arrayActivities","currentUserId","classEnabledActionActivities","isRunning","runningActivity","map","decodeHtmlEntities","loadAndShowImagesUsers","listActivities","csvguidUsers","a","seen","out","len","j","i","item","removeDuplicateItemsFromArray","join","getDataUsers","then","renderUserProfilesAndImages","iUser","html","getInitials","picture","attr","usersGuids","height","getUsersData","array","splice","arrayUnique","onCancelActivityForm","closeSidebar","$contentWrapper","stopPropagation","css","showConfirmationBox","deleteActivityPlan","next","find","publish","action","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","idCase","idWorkItem","putExecutePlan","getDateServer","sendNotification","callUpdatePlan","radNumber","getCaseByPlan","printf","activitiesAreCompleted","closePlan","callClosePlan","fail","updatePlan","showSucessMessage","lastIndexParallelInExecution","parallelActivitiesInRunning","$selectedActivity","displayName","assignee","activityEdited","services","preferences","getPreferences","getPreference","serviceloadDataPlan","supportNav","project-plan-sidebar","areTemplatedLoaded","loadData","subscribe","loadedWithDataActivities","loadedWithDataFirstParent","unsubscribe","sidebar","planTemplateCreate","planPopupEdit","CLOSED_PLAN","CONTEXT_ACTIVITYPLAN","CONTEXT_ACTIVITYPLANOVERVIEW","CONTEXT_ACTIVITYPLANCREATE","showActionsPlan","plan-action-main","stateClosedPlan","currentStatePlan","$contentWidget","initilizeActionMenu","onNotifyLoadInfoSummaryPlan","clearAlertsOnFocus","setNamePlan","onNotifyExpandedRightSidebar","setStatePlan","namePlan","onSelectMenu","ui","onClickMenuOpenEdition","onClickMenuDeletePlan","onClickMenuSaveAsTemplate","planSelected","showPopup","showPopupAddTemplatePlan","callDeletePlan","onSubmitFormPlan","select","focusout","deletePlan","plan-state-main","renderWidget","plan-progress-main","valuePercentBarComplete","calculateProgress","colorBar","$barRemainingDate","widthNumberDays","toString","completedActivities","totalActivities","percentProgress","Math","round","datePickerRegional","plan-time-main","updateWidget","planDatesToStamp","Date","getTime","closedDate","getClosedDatePlan","getIntervalOnMinutes","relativeTime","dateFormatter","getRelativeTime","now","minutesToShowTime","messageUnitTimeCalculated","keywordResourceDescriptionDifference","getKeywordDifferenceDates","messageDescripionDifference","valueOfTimeCalculated","auxToDate","getSecondDate","auxPercentBar","getWidthBar","auxColorBar","getColorBarByPercent","fromDate","getFormattedDate","getFirstDate","toDate","percentBar","getLastActivity","JSON","parse","stringify","sort","activityA","activityB","getDifferenceBetweenDates","firstDate","secondDate","callGetEffectiveDuration","difference","minutes","minutesNowToDueDate","minutesCreateToNow","minutesDueDateToCreate","minutesCreateToDueDate","minutesStartToNow","minutesDueDateToNow","minutesStartToDueDate","milliseconds","intervalMinutes","differenceStartDateToCurrentDate","totalInterval","valuePercentInterval","ceil","differenceStartDateToClosedDate","percent","d","getEffectiveDuration","dateObj","monthNames","getMonth","formatDate","time","plan-parent-main","getPlanParent","planParent","idParent","nameParent","idWorkflow","idTask","processName","process","planName","goToParentCase","msg","onClickGoToParentCase","routingExecute","usersMap","usersInformation","globalHandlersService","get","usersAssignees","plan-users-main","auxNoRepeatTypesUser","hashTypesUser","assigned","owner","cvsGuidUsers","activitiesUsers","ownerUserGuid","ownerUserId","userType","guid","each","index","userId","userAssignedGuid","inArray","user","guidUser","justAssignees","label","initilizeTooltip","addEventHandlersModal","callGetDataUsers","showCreatorInformation","allUsers","usersAssignee","indexOf","isOwner","isAssignee","usersAdapter","createJsonUserInfo","userCreator","userInfo","username","email","userinformation","obj","$li","console","log","getUsersAssignees","activityRuning","res_user","getUserAssignee","tasks","types","actUser","not","ev","id_userSelected","task","userParam","usertooltip","click","widgetName","BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL","closeVisible","maximize","modalParameters","title","refreshInbox","users"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Plan\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.plan\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, projectDashboard, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n      self.projectDashboard = projectDashboard;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.plan\").concat(\"#project-dashboard-menu\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.sub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n   },\r\n\r\n\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      self.params.menuPlanDashboard = self.params.menuPlanDashboard || {};\r\n      $.extend(self.params.menuPlanDashboard, self.params.menuDashboard);\r\n\r\n      self.planState = self.getPlanState(self.params.plan, self.params.planChild);\r\n      var argsTemplate = {\r\n         planState: self.planState,\r\n         showCommentsOptionMenu: self.params.menuPlanDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuPlanDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuPlanDashboard.showTimeLineOptionMenu && self.isVisibleShowTimeLine(self.planState)\r\n      };\r\n      template.render(argsTemplate).appendTo($content);\r\n       \r\n      $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n\r\n      self.handlerEvents();\r\n   },\r\n\r\n    /**\r\n     * Return planState by plan or planChild\r\n     * @param plan\r\n     * @param planChild\r\n     * @returns {*}\r\n     */\r\n    getPlanState: function(plan, planChild){\r\n        var currentState;\r\n        if(planChild && planChild.currentState){\r\n            currentState = planChild.currentState;\r\n        }\r\n        else if(plan && plan.currentState){\r\n            currentState = plan.currentState;\r\n        }\r\n        return currentState;\r\n    },\r\n\r\n    /**\r\n     * Behavior visible timeline option\r\n     */\r\n    isVisibleShowTimeLine: function(planState){\r\n        var self = this;\r\n        var extraValidationShowTimeLine = true;\r\n        if(planState === \"PENDING\"){\r\n            extraValidationShowTimeLine = false;\r\n        }\r\n        return extraValidationShowTimeLine;\r\n    },\r\n\r\n   /*\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if ($item.data(\"context\") === \"PLANBACK\") {\r\n         self.backParentPlan();\r\n      }\r\n      else{\r\n         if (!$item.hasClass(\"active\")) {\r\n            var showContextByMenuDashboard = $item.data(\"context\");\r\n            if (showContextByMenuDashboard) {\r\n\r\n               self.pub(\"notify\", {\r\n                  type: showContextByMenuDashboard.toUpperCase(),\r\n                  args: $.extend(self.params,{showContextByMenuDashboard: showContextByMenuDashboard})\r\n               });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n            }\r\n         }\r\n      }\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n      var self = this;\r\n      var content = self.getContent();\r\n      var $comments = $(\"[data-context='PLANCOMMENTS']\", content);\r\n      var $files = $(\"[data-context='PLANFILES']\", content);\r\n      var $timeline = $(\"[data-context='PLANTIMELINE']\", content);\r\n\r\n      $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n         $comments.toggle();\r\n         $files.toggle();\r\n         if(self.isVisibleShowTimeLine(self.planState)){\r\n            $timeline.toggle();\r\n         }\r\n      });\r\n   },\r\n\r\n   backParentPlan: function(){\r\n      var self = this;\r\n      //when a plan created from an activity is deleted, not created from a case\r\n      var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\"});\r\n      var currentLevelNavigator = parseInt(getLevelNavigator[0]);\r\n      var params = self.projectDashboard.getParamsByBackFromPlan(self.params, currentLevelNavigator);\r\n\r\n      self.pub(\"notify\", {\r\n         type: params.typeContext,\r\n         args: $.extend(self.params, params.paramsNotify)\r\n      });\r\n\r\n   },\r\n\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      self.subMenuHandler();\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\",  $.proxy(self.loadContentById, self));\r\n   },\r\n\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.plan\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.projectDashboard\", bizagi.workportal.widgets.project.dashboard.menu.plan], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-content-dashboard\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n\r\n      setTimeout(function(){\r\n         $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\r\n      }, 1000);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","/*\r\n*   Name: Bizagi Workportal Desktop Project Plan Activities\r\n*   Author: David Romero Estrada\r\n*/\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activities\", {}, {\r\n\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, notifier, serviceOrderActivitiesByTransitions, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n        \r\n        self.serviceOrderActivitiesByTransitions = serviceOrderActivitiesByTransitions;\r\n\r\n        // Modes widget: designed plan or execution plan\r\n        self.PENDING_PLAN = \"PENDING_PLAN\";\r\n        self.EXECUTING_PLAN = \"EXECUTING_PLAN\";\r\n        self.CONTEXT_PLANACTIVITIES = \"PLANACTIVITIES\";\r\n        self.CONTEXT_PLANOVERVIEW = \"PLANOVERVIEW\";\r\n        self.CONTEXT_PLANCREATE = \"PLANCREATE\";\r\n\r\n        self.plugins = {};\r\n        self.fromIndexEnabledSortingActivities = 0;\r\n        self.idActivityEditing = \"\";\r\n        self.plugins.notifier = notifier;\r\n\r\n        //private fields\r\n        self._statePlan = self.PENDING_PLAN;\r\n\r\n        self.userPictures = [];\r\n        self.refresh = params.refreshAllWidgets;\r\n\r\n        // Load templates\r\n        self.loadTemplates({\r\n            \"plan-activities-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.plan.activities\").concat(\"#project-plan-activities\"),\r\n            \"plan-activities-item\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.plan.activities\").concat(\"#project-plan-activities-item\")\r\n        });\r\n    },\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.sub(\"LOAD_INFO_SUMMARY_PROGRESS_PLAN\", $.proxy(self.onNotifySummaryProgressPlan, self));\r\n        self.sub(\"UPDATE_INFO_PLAN\", $.proxy(self.onNotifyUpdatePlan, self));\r\n        self.sub(\"UPDATE_LIST_ACTIVITIES\", $.proxy(self.renderWidgetByStatePlan, self));\r\n        self.sub(\"UPDATE_ACTIVITY_INFO\", $.proxy(self.refreshActivityRow, self));\r\n        if(!self.refresh){\r\n            self.collapseSidebars();\r\n        }\r\n    },\r\n\r\n    onNotifySummaryProgressPlan: function(event, params) {\r\n        var self = this;\r\n        self.params = $.extend(self.params, params.args);\r\n\r\n        var state = self.params.plan.currentState;\r\n        self._statePlan = state + \"_PLAN\";\r\n        \r\n        self.renderWidgetByStatePlan(event.type);\r\n        \r\n    },\r\n\r\n    renderWidgetByStatePlan: function(event){\r\n        var self = this;\r\n        self.idActivityEditing = \"\";\r\n        var $content = self.getContent().empty();\r\n\r\n        var isEnableEventsOnActivitiesByCurrentContext = self.enableEventsOnActivitiesByCurrentContext(self.params.showContextByMenuDashboard);\r\n\r\n        var auxCountActivitiesFinished = self.params.plan.activities.filter(function(activity){\r\n            return activity.finishDate;\r\n        }).length;\r\n\r\n        var argsTemplate = {\r\n            showContextByMenuDashboard: self.params.showContextByMenuDashboard,\r\n            statePlan: self._statePlan,\r\n            statePendingPlan: self.PENDING_PLAN,\r\n            stateExecutingPlan: self.EXECUTING_PLAN,\r\n            contextPlanActivities: self.CONTEXT_PLANACTIVITIES,\r\n            plan: self.params.plan,\r\n            showFormAddActivityByNotFinishedAllActivities: (auxCountActivitiesFinished !== self.params.plan.activities.length),\r\n            currentUserGuid: bizagi.currentUser.userGuid\r\n        };\r\n\r\n        var contentTemplate = self.getTemplate(\"plan-activities-main\");\r\n        contentTemplate\r\n           .render($.extend(self.params, argsTemplate))\r\n           .appendTo($content);\r\n           \r\n        if((self._statePlan === self.PENDING_PLAN || self._statePlan === self.EXECUTING_PLAN) && isEnableEventsOnActivitiesByCurrentContext){\r\n            self.plugins.sortablelist = self.initializeSortableList();\r\n            self.addEventHandlers();\r\n        }\r\n        \r\n        self.setContentWrapper($content);\r\n\r\n        $(\".project-plan-activity-list\", $content).on(\"click\", \"li\", $.proxy(self.onClickEditActivity, self));\r\n\r\n        $(\".project-plan-activity-list\", $content).on(\"click\", \"li .activity-view\", $.proxy(self.onClickEditActivity, self));\r\n\r\n        $(\".project-plan-activity-list\", $content).on(\"click\", \"li .bz-icon-trash-outline\", $.proxy(self.onClickDeleteActivity, self));\r\n\r\n        $(\".project-plan-activity-list\", $content).on(\"click\", \"li .item-workonit-button\", $.proxy(self.onClickWorkonItActivity, self));\r\n\r\n        if(self.params.showContextByMenuDashboard === self.CONTEXT_PLANACTIVITIES){\r\n            $(\".project-plan-activity-list\", $content).on(\"click\", \"li .ui-bizagi-wrapper-parallel-icon\", $.proxy(self.onClickChangeParallel, self));\r\n        }\r\n\r\n        if (self._statePlan === self.PENDING_PLAN) {\r\n            $(\"a#to-execute-plan\", $content).on(\"click\", $.proxy(self.onExecutePlan, self));\r\n        } else if (self._statePlan !== \"CLOSED_PLAN\") {\r\n            $(\"a#to-close-plan\", $content).on(\"click\", $.proxy(self.onClosePlan, self));\r\n        }\r\n\r\n        self.renderActivities();\r\n        if(event){\r\n            if(event.type === \"UPDATE_LIST_ACTIVITIES\"){\r\n                self.updateTransitions();\r\n            }\r\n        }\r\n    },\r\n\r\n    getCopyObjectPlan: function () {\r\n        var self = this;\r\n        return {\r\n            id: self.params.plan.id,\r\n            name: self.params.plan.name,\r\n            description: self.params.plan.description,\r\n            dueDate: self.params.plan.dueDate,\r\n            waitForCompletion: self.params.plan.waitForCompletion,\r\n            currentState: self.params.plan.currentState,\r\n            parentWorkItem: self.params.plan.parentWorkItem,\r\n            creationDate: self.params.plan.creationDate,\r\n            startDate: self.params.plan.startDate,\r\n            idUserCreator: self.params.plan.idUserCreator,\r\n            contextualized: self.params.plan.contextualized,\r\n            activities: self.params.plan.activities\r\n        };\r\n    },\r\n\r\n    enableEventsOnActivitiesByCurrentContext: function(currentContext){\r\n        var self = this;\r\n        return currentContext === self.CONTEXT_PLANACTIVITIES;\r\n    },\r\n\r\n    onNotifyUpdatePlan: function(){\r\n        var self = this;\r\n        if(self.params.showContextByMenuDashboard === self.CONTEXT_PLANOVERVIEW){\r\n            $(\".ui-bizagi-wp-project-plan-activities-header h3\", self.content).text(self.params.plan.name);\r\n            $(\".ui-bizagi-wp-project-plan-activities-header p\", self.content).text(self.params.plan.description);\r\n        }\r\n\r\n    },\r\n\r\n    initializeSortableList: function () {\r\n       var self = this;\r\n       return $(\".project-plan-activity-list\", self.content).kendoSortable({\r\n            hint: function (element) {\r\n                var $clone = element.clone().width(element.width());\r\n                return $(\"<ol class='project-plan-activity-list ui-bizagi-wp-nolist'></ol>\").append($clone);\r\n            },\r\n            change: $.proxy(self.onChangePosition, self),\r\n            disabled: \".disabled\",\r\n            end: function(e) {\r\n               if(e.newIndex < self.fromIndexEnabledSortingActivities) {\r\n                   e.preventDefault();\r\n               }\r\n                else{\r\n                    if(e.oldIndex !== e.newIndex){\r\n                        self.serviceOrderActivitiesByTransitions.movePositionActivity(self.params.plan.activities, e.oldIndex, e.newIndex);\r\n\r\n                        var $liActivityGoDown = $(\".project-plan-activity-list li\", self.content).eq(e.newIndex);\r\n\r\n                        if(!self.canChangeToParallelActivity(self.params.plan.activities, $liActivityGoDown)){\r\n                            self.params.plan.activities[e.newIndex].parallel = false;\r\n\r\n                            function setSerieActivity(){\r\n                                setTimeout(function(){\r\n                                    //TODO: Update selector when show arrows in all activities\r\n                                    $(\".project-plan-activity-list li .wrapper-arrow-css i\", self.content).eq(0).\r\n                                        removeClass(\"bz-icon-arrow-right-outline\").addClass(\"bz-icon-arrow-down-outline\");\r\n                                }, 50);\r\n                            }\r\n                            setSerieActivity(e.newIndex);\r\n\r\n\r\n                        }\r\n\r\n\r\n                    }\r\n                }\r\n            }\r\n       }).data(\"kendoSortable\");\r\n    },\r\n\r\n    /*initializeNotifier: function(){\r\n        var self = this;\r\n        return $(\"#project-plan-notifier\", self.content).kendoNotification().data(\"kendoNotification\");\r\n    },*/\r\n\r\n    updateTransitions: function(){\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        var params = {\r\n            idPlan: self.params.plan.id,\r\n            transitions: self.getActualTransitions()\r\n        };\r\n\r\n        $.when(self.dataService.changeTransitions(params)).always(function (response, responseText, xhr) {\r\n            if (xhr.status === 500) {\r\n                self.plugins.notifier.showErrorMessage(bizagi.localization.getResource(\"workportal-project-plan-activities-sorterror\"), \"error\");\r\n            }\r\n            self.params.plan.activities = self.orderActivitiesByTransitions(self.params.plan.activities, params.transitions);\r\n            defer.resolve();\r\n        });\r\n        return defer.promise();\r\n    },\r\n\r\n    orderActivitiesByTransitions: function(activities, transitions){\r\n        var self = this;\r\n        return self.serviceOrderActivitiesByTransitions.\r\n            getActivitiesByTransitions(activities, transitions);\r\n    },\r\n\r\n    getActualTransitions: function(){\r\n        var self = this;\r\n        var auxOrderTransitions = self.serviceOrderActivitiesByTransitions.\r\n            getActualTransitionsByActivities(self.params.plan.activities);\r\n\r\n        auxOrderTransitions.forEach(function(transition){\r\n            transition.id = undefined;\r\n            transition.idPlan = self.params.plan.id;\r\n        });\r\n\r\n        return auxOrderTransitions;\r\n    },\r\n\r\n    onChangePosition: function(){\r\n        var self = this;\r\n        self.updateTransitions();\r\n    },\r\n\r\n    onCreateActivity: function(event) {\r\n        event.preventDefault();\r\n\r\n        var self = this;\r\n        var $input = $(\"#project-plan-activity-create\", $(event.target));\r\n        var name = $input.val();\r\n\r\n        var idUserAssigned;\r\n        if(self.params.plan.activities.length > 0){\r\n            idUserAssigned = self.params.plan.activities[self.params.plan.activities.length - 1].userAssigned;\r\n        }\r\n        else{\r\n            idUserAssigned = bizagi.currentUser.idUser;\r\n        }\r\n\r\n        if (name.replace(/\\s/g, \"\") !== \"\") {\r\n\r\n            var params = {\r\n                progress: 0,\r\n                id: \"\",\r\n                startDate: null,\r\n                duration: null,\r\n                userAssigned: idUserAssigned,\r\n                allowEdition: true,\r\n                description: null,\r\n                name: name,\r\n                idPlan: self.params.plan.id,\r\n                estimatedFinishDate: null,\r\n                finishDate: null\r\n            };\r\n\r\n            if(self.params.plan.parent && !bizagi.util.isEmpty(self.params.plan.parent.guidActivity)){\r\n                var paramsDetailActivity = {\r\n                    idPlan: self.params.plan.id,\r\n                    idActivity: self.params.plan.parent.guidActivity \r\n                };\r\n                $.when(self.dataService.getActivity(paramsDetailActivity)).done(function (response) {\r\n                    params.allowEdition = response.allowEdition;\r\n                    self.createPlanActivity(params);\r\n\r\n                 });\r\n            }else{\r\n                self.createPlanActivity(params);\r\n            }\r\n\r\n            \r\n        }\r\n\r\n        event.target.reset();\r\n\r\n        event.preventDefault();\r\n    },\r\n    createPlanActivity: function(params){\r\n        var self = this;\r\n        $.when(self.dataService.createPlanActivity(params)).always(function (response, responseText, xhr) {\r\n\r\n            if (xhr.status === 201) {\r\n                var paramsDetailActivity = {\r\n                    idPlan: params.idPlan,\r\n                    idActivity: response.id\r\n                };\r\n                $.when(self.dataService.getActivity(paramsDetailActivity)).always(function (responseActivity) {\r\n                    var activityNew = $.extend(responseActivity, {\r\n                    id: response.id,\r\n                    items: [],\r\n                    numTotalItems: 0,\r\n                    numResolvedItems: 0,\r\n                    parallel: false\r\n                });\r\n\r\n                self.renderActivities([activityNew]);\r\n                self.params.plan.activities.push(activityNew);\r\n\r\n                var $activityList = $(\".project-plan-activity-list\", self.content);\r\n                $(\"li:last .bz-icon-pencil-outline\", $activityList).trigger(\"click\");\r\n\r\n                self.updateTransitions();\r\n            });\r\n            } else if (response.status === 500) {\r\n                self.plugins.notifier.showErrorMessage(bizagi.localization.getResource(\"workportal-project-plan-activities-createarror\"), \"error\");\r\n            }\r\n        });\r\n    },\r\n    onClickChangeParallel: function(event){\r\n        event.preventDefault();\r\n        var self = this;\r\n        var $wrapperArrow = $(\".wrapper-arrow-css\", event.currentTarget);\r\n\r\n        var $liActivitySelected = $wrapperArrow.closest(\"li\");\r\n        var idActivitySelected = $liActivitySelected.data(\"id\");\r\n\r\n        if(self.canChangeToParallelActivity(self.params.plan.activities, $liActivitySelected)){\r\n            /**\r\n             * Changes UI\r\n             * */\r\n            var activityParallel;\r\n            if($(\"i\", $wrapperArrow).hasClass(\"bz-icon-arrow-down-outline\")){\r\n                activityParallel = true;\r\n                $(\"i\", $wrapperArrow).removeClass(\"bz-icon-arrow-down-outline\").addClass(\"bz-icon-arrow-right-outline\").\r\n                    prop(\"title\", bizagi.localization.getResource(\"workportal-project-plan-activity-parallel\"));\r\n            }\r\n            else{\r\n                activityParallel = false;\r\n                $(\"i\", $wrapperArrow).removeClass(\"bz-icon-arrow-right-outline\").addClass(\"bz-icon-arrow-down-outline\").\r\n                    prop(\"title\", bizagi.localization.getResource(\"workportal-project-plan-activity-sequential\"));\r\n            }\r\n\r\n            /**\r\n             * Change Activity Data\r\n             */\r\n            self.changeActivityProperties(idActivitySelected, { parallel: activityParallel });\r\n\r\n            self.updateTransitions();\r\n        }\r\n    },\r\n\r\n    canChangeToParallelActivity: function(activities, $liActivitySelected){\r\n        var self = this;\r\n        var result = true;\r\n        var idLastParallelActivity = self.getLastParallelActivityIsRunningOrClose(activities);\r\n        if(idLastParallelActivity){\r\n            var $liPreviusActivity = $liActivitySelected.prev();\r\n            var idPreviusActivity = $liPreviusActivity.data(\"id\");\r\n            if(idLastParallelActivity === idPreviusActivity){\r\n                result = false;\r\n            }\r\n        }\r\n        return result;\r\n    },\r\n\r\n    onClickEditActivity: function (event) {\r\n        var self = this;\r\n        var $target = $(event.currentTarget);\r\n\r\n        /*if(self._statePlan === self.PENDING_PLAN || (!$target.hasClass(\"disabled\") && self._statePlan === self.EXECUTING_PLAN)){\r\n            isEditableFormActivity = true;\r\n        }*/\r\n\r\n        var idActivitySelected = $target.data(\"id\");\r\n\r\n        var activityToShow = self.params.plan.activities.filter(function (activity) {\r\n            return activity.id === idActivitySelected;\r\n        })[0];\r\n\r\n        var isEditableFormActivity = self._statePlan !== \"CLOSED_PLAN\" && activityToShow.workItemState !== \"Completed\";\r\n\r\n        if (self.params.showContextByMenuDashboard === self.CONTEXT_PLANACTIVITIES) {\r\n            function showFormToEditActivity(idActivitySelected){\r\n                if(self.idActivityEditing !== idActivitySelected){\r\n                    self.params.plan.idActivitySelected = idActivitySelected;\r\n\r\n                    $target.closest(\"li\").addClass(\"selected\").siblings().removeClass(\"selected\");\r\n                    self.idActivityEditing = idActivitySelected;\r\n                    self.pub(\"notify\", {\r\n                        type: \"EDITACTIVITY\",\r\n                        args: $.extend(self.params, {\r\n                            isEditableFormActivity: isEditableFormActivity,\r\n                            idActivityToShow: idActivitySelected\r\n                        })\r\n                    });\r\n                    self.pub(\"notify\", {\r\n                        type: \"OPEN_RIGHT_SIDEBAR\"\r\n                    });\r\n                }\r\n            }\r\n\r\n            showFormToEditActivity(idActivitySelected);\r\n        }\r\n    },\r\n\r\n    changeActivityProperties: function(activityGuid, activityPropertiesToUpdate){\r\n        var self = this;\r\n        for(var iActivity = 0, lengthActivities = self.params.plan.activities.length; iActivity < lengthActivities; iActivity += 1){\r\n            if(self.params.plan.activities[iActivity].id === activityGuid){\r\n                $.extend(self.params.plan.activities[iActivity], activityPropertiesToUpdate);\r\n                break;\r\n            }\r\n        }\r\n    },\r\n\r\n    addEventHandlers: function () {\r\n        var self = this;\r\n\r\n        $(\"#project-plan-activity-createform\", self.content).on(\"submit\", $.proxy(self.onCreateActivity, self));\r\n        $(\"#project-plan-activity-create\", self.content).focus();\r\n    },\r\n\r\n    /**\r\n     * UI\r\n     */\r\n    renderActivities: function(activities){\r\n        var self = this;\r\n        var $list = $(\".project-plan-activity-list\", self.content);\r\n        var tmpl = self.getTemplate(\"plan-activities-item\");\r\n\r\n        if(self.params.showContextByMenuDashboard === self.CONTEXT_PLANACTIVITIES){\r\n            $list.addClass(\"enabled-actions\");\r\n        }\r\n\r\n        var $element = self.params.plan.currentState === \"PENDING\" ? $(\"a#to-execute-plan\", self.content) : $(\"a#to-close-plan\", self.content);\r\n        if (activities || self.params.plan.activities.length > 0) {\r\n            $element.show();\r\n        } else {\r\n            $element.hide();\r\n        }\r\n\r\n        var arrayActivities = activities || self.params.plan.activities;\r\n\r\n        var argsTemplate = {\r\n            statePlan: self._statePlan,\r\n            statePendingPlan: self.PENDING_PLAN,\r\n            stateExecutingPlan: self.EXECUTING_PLAN,\r\n            context: self.params.showContextByMenuDashboard,\r\n            activities: activities || self.params.plan.activities,\r\n            currentUserId: bizagi.currentUser.idUser\r\n        };\r\n\r\n        if(self._statePlan === self.EXECUTING_PLAN){\r\n            arrayActivities.forEach(function(activity){\r\n                if(activity.startDate){\r\n                    activity.classEnabledActionActivities = \"disabled\";\r\n                }\r\n                else{\r\n                    activity.classEnabledActionActivities = (self.params.showContextByMenuDashboard === self.CONTEXT_PLANACTIVITIES ? \"enabled\" : \"disabled\");\r\n                }\r\n\r\n                activity.isRunning = self.runningActivity(activity);\r\n\r\n            });\r\n        }\r\n\r\n        // XSS Fix Bug \r\n        argsTemplate.activities = argsTemplate.activities.map(function (activity) {\r\n            activity.name = bizagi.util.decodeHtmlEntities(activity.name);\r\n            activity.description = bizagi.util.decodeHtmlEntities(activity.description);\r\n            return activity;\r\n        });\r\n\r\n        var $item = tmpl.render(argsTemplate);\r\n        $list.append($item);\r\n\r\n        self.fromIndexEnabledSortingActivities = self.params.plan.activities.filter(function(activity){\r\n            return activity.classEnabledActionActivities === \"disabled\";\r\n        }).length;\r\n\r\n        self.loadAndShowImagesUsers(self.params.plan.activities);\r\n    },\r\n\r\n    /**\r\n     * Know if the activity is running\r\n     * @param activity\r\n     * @returns {boolean}\r\n     */\r\n    runningActivity: function(activity){\r\n        //Inactive represent created but user dont access yet\r\n        return activity.workItemState === 'Active' || activity.workItemState === 'Inactive';\r\n    },\r\n\r\n    loadAndShowImagesUsers: function(listActivities){\r\n        var self = this;\r\n\r\n        var guidUsers = $.map(listActivities, function (element) {\r\n            return element.userAssigned;\r\n        });\r\n\r\n        function removeDuplicateItemsFromArray(a) {\r\n            var seen = {};\r\n            var out = [];\r\n            var len = a.length;\r\n            var j = 0;\r\n            for (var i = 0; i < len; i++) {\r\n                var item = a[i];\r\n                if (seen[item] !== 1) {\r\n                    seen[item] = 1;\r\n                    out[j++] = item;\r\n                }\r\n            }\r\n            return out;\r\n        }\r\n\r\n        var csvguidUsers = removeDuplicateItemsFromArray(guidUsers.concat(bizagi.currentUser.userGuid)).join(\",\");\r\n\r\n        self.getDataUsers(csvguidUsers).then(function () {\r\n            self.renderUserProfilesAndImages();\r\n        });\r\n    },\r\n\r\n    renderUserProfilesAndImages: function () {\r\n        var self = this;\r\n\r\n        var base64Prefix = \"data:image/png;base64,\";\r\n\r\n        for (var iUser = 0; iUser < self.userPictures.length; iUser += 1) {\r\n            $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"']  span.ui-bizagi-user-initials\").html(self.userPictures[iUser].name.getInitials());\r\n            if (self.userPictures[iUser].picture) {\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"']  img\").show();\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"']  span.ui-bizagi-user-initials\").hide();\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"']  img\").attr(\"src\", base64Prefix + self.userPictures[iUser].picture);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Call services\r\n     */\r\n\r\n    /*\r\n     *  Get data for users\r\n     */\r\n    getDataUsers: function (csvguidUsers) {\r\n        var self = this,\r\n           defer = $.Deferred();\r\n\r\n        var params = {\r\n            usersGuids: csvguidUsers,\r\n            width: 50,\r\n            height: 50\r\n        };\r\n\r\n        self.dataService.getUsersData(params).always(function (response) {\r\n\r\n            function arrayUnique(array) {\r\n                var a = array.concat();\r\n                for (var i = 0; i < a.length; ++i) {\r\n                    for (var j = i + 1; j < a.length; ++j) {\r\n                        if (a[i] === a[j]){\r\n                            a.splice(j -= 1, 1);\r\n                        }\r\n\r\n                    }\r\n                }\r\n                return a;\r\n            }\r\n\r\n            self.userPictures = arrayUnique(self.userPictures.concat(response));\r\n            defer.resolve(response);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n     * When cancel form\r\n     */\r\n    onCancelActivityForm: function () {\r\n        var self = this;\r\n        self.closeSidebar();\r\n        self.pub(\"notify\", {\r\n            type: \"PLANSIDEBAR\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    setContentWrapper: function (content) {\r\n        var self = this;\r\n        var $contentWrapper = $(\".project-plan-content-wrapper\", content);\r\n        $contentWrapper.on(\"click\", $.proxy(self.onCancelActivityForm, self));\r\n        var activityArea = $(\"#project-plan-activities-wrapper\", content);\r\n        activityArea.on(\"click\", function(e) { e.stopPropagation(); });\r\n        var windowHeight = $(window).height();\r\n        var height = windowHeight - 156;\r\n        $contentWrapper.css(\"height\", height + \"px\");\r\n    },\r\n\r\n    onClickDeleteActivity: function (event) {\r\n        event.stopPropagation();        \r\n        var self = this;\r\n        var idActivitySelected = $(event.currentTarget).data(\"id\");\r\n        var params = {\r\n            idPlan: self.params.plan.id,\r\n            id: idActivitySelected\r\n        };\r\n        $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-plan-activity-delete-confirmation\"), \"\", \"info\")).done(function () {\r\n            $.when(self.dataService.deleteActivityPlan(params)).done(function () {\r\n                self.closeSidebar();\r\n                //The next activity of the deleted, if its parallel, have to set dont parallel\r\n                for(var iActivity = 0, lengthActivities = self.params.plan.activities.length; iActivity < lengthActivities; iActivity += 1){\r\n                    if(self.params.plan.activities[iActivity].id === idActivitySelected){\r\n                        //activity isn't the first or last activity\r\n                        if(lengthActivities > iActivity + 1 && iActivity > 0){\r\n                            if(self.params.plan.activities[iActivity + 1].parallel && self.params.plan.activities[iActivity - 1].parallel){\r\n                                self.params.plan.activities[iActivity + 1].parallel = false;\r\n                                $(\".project-plan-activity-list li[data-id='\" + self.params.plan.activities[iActivity].id + \"']\", self.content).\r\n                                    next().find(\".wrapper-arrow-css i\").removeClass(\"bz-icon-arrow-right-outline\").addClass(\"bz-icon-arrow-down-outline\");\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                //Delete activity\r\n                self.params.plan.activities = self.params.plan.activities.filter(function (activity) {\r\n                    return activity.id !== idActivitySelected;\r\n                });\r\n\r\n                $.when(self.updateTransitions()).done(function(){\r\n                    self.renderWidgetByStatePlan();\r\n\r\n                    self.pub(\"notify\", {\r\n                        type: \"PLANSIDEBAR\",\r\n                        args: self.params\r\n                    });\r\n                });\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Go to activity\r\n     */\r\n    onClickWorkonItActivity: function(event){\r\n        event.preventDefault();\r\n        var self = this;\r\n        var idActivitySelected = $(event.target).closest(\"li\").data(\"id\");\r\n        var activity = self.params.plan.activities.filter(function (activity) {\r\n            return activity.id === idActivitySelected;\r\n        })[0];\r\n\r\n        self.publish(\"executeAction\", {\r\n            action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n            idCase: activity.idCase,\r\n            idWorkItem: activity.idWorkItem\r\n        });\r\n    },\r\n\r\n    onExecutePlan: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n\r\n        var numberActivitiesCreated = self.params.plan.activities.length;\r\n\r\n        if (numberActivitiesCreated > 0) {\r\n            if (!$(event.target).closest(\"a\").hasClass(\"disabled\")) {\r\n                self.params.plan.currentState = \"EXECUTING\";\r\n                $(event.target).closest(\"a\").addClass(\"disabled\");\r\n                var params = {\r\n                    idPlan: self.params.plan.id\r\n                };\r\n\r\n                $.when(self.dataService.putExecutePlan(params)).done(function () {\r\n                    var params = $.extend(self.getCopyObjectPlan(), { startDate: self.getDateServer() });\r\n                    self.callUpdatePlan(params);\r\n\r\n                    $(event.target).closest(\"a\").removeClass(\"disabled\");\r\n\r\n                    function sendNotification(params){\r\n                        if(self.params.planChild){\r\n                            self.params.planChild.currentState = self.params.plan.currentState;\r\n                        }\r\n\r\n                        self.pub(\"notify\", {\r\n                            type: \"PLANACTIVITIES\",\r\n                            args: $.extend(params, { refreshAllWidgets: true })\r\n                        });\r\n                    }\r\n\r\n                    if(typeof self.radNumber === \"undefined\"){\r\n                        $.when(self.dataService.getCaseByPlan({ idPlan: self.params.plan.id })).done(function(response){\r\n                            self.params.idCase = response.id;\r\n                            sendNotification(self.params);\r\n                        });\r\n                    }\r\n                    else{\r\n                        sendNotification(self.params);\r\n                    }\r\n\r\n\r\n\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            self.plugins.notifier.showErrorMessage(printf(bizagi.localization.getResource(\"workportal-project-plan-action-execute-message-activities-required\"), \"\"));\r\n        }\r\n    },\r\n\r\n    onClosePlan: function (event) {\r\n        var self = this;\r\n        event.preventDefault();\r\n        if (self.activitiesAreCompleted(self.params.plan.activities)) {\r\n            self.closePlan();\r\n        } else {\r\n            $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-plan-action-close-message-activities-finished\"), \"\", \"info\")).done(function () {\r\n                self.closePlan();\r\n            });\r\n        }\r\n    },\r\n\r\n    closePlan: function() {\r\n        var self = this;\r\n        var params = $.extend(self.getCopyObjectPlan(), { currentState: \"CLOSED\" });\r\n        $.when(self.callUpdatePlan(params)).done(function(){\r\n            $.when(self.callClosePlan({ idPlan: params.id })).done(function(){\r\n                self.params.plan = params;\r\n                self.pub(\"notify\", {\r\n                    type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n                    args: self.params\r\n                });\r\n\r\n                self.pub(\"notify\", {\r\n                    type: \"LOAD_INFO_SUMMARY_PROGRESS_PLAN\",\r\n                    args: self.params\r\n                });\r\n            }).fail(function(){\r\n                self.notifier.showErrorMessage(printf(bizagi.localization.getResource('workportal-project-plan-close-fail'), ''));\r\n            });\r\n        }).fail(function(){\r\n            self.notifier.showErrorMessage(printf(bizagi.localization.getResource('workportal-project-plan-close-fail'), ''));\r\n        });\r\n    },\r\n\r\n    callUpdatePlan: function (params) {\r\n        var self = this;\r\n        return $.when(self.dataService.updatePlan(params)).done(function () {\r\n            $.extend(self.params.plan, params);\r\n        });\r\n    },\r\n\r\n    callClosePlan: function (params) {\r\n        var self = this;\r\n        return $.when(self.dataService.closePlan(params)).done(function () {\r\n            $.extend(self.params.plan, params);\r\n            self.plugins.notifier.showSucessMessage(printf(bizagi.localization.getResource(\"workportal-project-plan-close-success\"), \"\"));\r\n        });\r\n    },\r\n\r\n    activitiesAreCompleted: function (activities) {\r\n        var listActivities = activities || [];\r\n        var numActivitiesCompleted = listActivities.filter(function (activity) {\r\n            return activity.finishDate;\r\n        }).length;\r\n        return numActivitiesCompleted === activities.length;\r\n    },\r\n\r\n    getLastParallelActivityIsRunningOrClose: function(activities){\r\n        var lastIndexParallelInExecution = -1;\r\n        var parallelActivitiesInRunning = activities.filter(function(activity){\r\n            if(activity.startDate !== null && activity.parallel){\r\n                lastIndexParallelInExecution += 1;\r\n                return true;\r\n            }\r\n        });\r\n        if(lastIndexParallelInExecution >= 0 && lastIndexParallelInExecution + 1 !== activities.length){\r\n            return parallelActivitiesInRunning[parallelActivitiesInRunning.length - 1].id;\r\n        }\r\n        else{\r\n            return null;\r\n        }\r\n    },\r\n\r\n    refreshActivityRow: function (event, params) {\r\n        var self = this;\r\n        var $selectedActivity = $(\".project-plan-activity-list li.selected\");\r\n        if (params.args.displayName) $(\"p>span\", $selectedActivity).text(params.args.displayName);\r\n        if (params.args.assignee) {\r\n\r\n            var idActivitySelected = $($selectedActivity).data(\"id\");\r\n            var activityEdited = self.params.plan.activities.filter(function (activity) {\r\n                return activity.id === idActivitySelected;\r\n            })[0];\r\n\r\n            if(params.args.assignee === bizagi.currentUser.idUser && (activityEdited.workItemState === \"Active\" || activityEdited.workItemState === \"Inactive\")){\r\n                $(\".item-workonit-button\", $selectedActivity).show();\r\n            }\r\n            else{\r\n                $(\".item-workonit-button\", $selectedActivity).hide();\r\n            }\r\n\r\n            self.getDataUsers([params.args.assignee].join()).then(function (response) {\r\n                $(\".bz-wp-avatar span.ui-bizagi-user-initials\", $selectedActivity).html(response[0].name.getInitials());\r\n                $(\"div.ui-bizagi-wp-project-plan-activity-infobox[data-iduser]\", $selectedActivity).attr(\"data-iduser\", params.args.assignee);\r\n                if (response[0].picture) {\r\n                    var base64Prefix = \"data:image/png;base64,\";\r\n                    $(\".bz-wp-avatar img\", $selectedActivity).show();\r\n                    $(\".bz-wp-avatar  span.ui-bizagi-user-initials\", $selectedActivity).hide();\r\n                    $(\".bz-wp-avatar img\", $selectedActivity).attr(\"src\", base64Prefix + response[0].picture);\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    closeSidebar: function(){\r\n        var that = this;\r\n        var alwaysCollapse = bizagi.services.preferences().getPreferences()?bizagi.services.preferences().getPreference(\"collapseSidebars\"):\"\";\r\n        if(alwaysCollapse === 'yes' && $(\".ui-bizagi-wp-project-panel-rowicon-right i.bz-icon-left-outline\").css(\"display\") == \"none\" && $(\"li.clearfix.selected\").length > 0){\r\n            that.pub(\"notify\", {\r\n                type: \"CLOSE_RIGHT_SIDEBAR\"\r\n            });\r\n        }\r\n    },\r\n\r\n    collapseSidebars: function() {\r\n        var alwaysCollapse = bizagi.services.preferences().getPreferences()?bizagi.services.preferences().getPreference(\"collapseSidebars\"):\"\";\r\n        if(alwaysCollapse === 'yes'){\r\n            $(\"#ui-bizagi-wp-project-homeportal-main\").addClass(\"ui-bizagi-wp-project-collapse-rightpanel\");\r\n            $(\"#ui-bizagi-wp-project-homeportal-main\").removeClass(\"ui-bizagi-wp-project-open-rightpanel\");\r\n            $(\"#right-sidebar-wrapper\").addClass(\"always-collpase\");\r\n\r\n            $(\"#ui-bizagi-wp-project-homeportal-main\").addClass(\"ui-bizagi-wp-project-collapse-leftpanel\");\r\n            $(\"#ui-bizagi-wp-project-homeportal-main\").removeClass(\"ui-bizagi-wp-project-open-leftpanel\");\r\n            $(\"#left-sidebar-wrapper\").addClass(\"always-collpase\");\r\n        }\r\n    }\r\n    \r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activities\", [\"workportalFacade\", \"dataService\", \"notifier\", \"bizagi.workportal.services.behaviors.orderActivitiesByTransitions\", bizagi.workportal.widgets.project.plan.activities], true);\r\n","/*\r\n *   Name: Bizagi Workportal project Plan Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.sidebar\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, serviceloadDataPlan, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.serviceloadDataPlan = serviceloadDataPlan;\r\n      self.params = params || {};\r\n      params.supportNav = false;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-plan-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.plan.sidebar\").concat(\"#project-plan-sidebar\")\r\n      });\r\n\r\n   },\r\n\r\n    /*\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"project-plan-sidebar\");\r\n        self.content = template.render({});\r\n        $.when(self.areTemplatedLoaded())\r\n                .done(function () {\r\n                    var params = {idPlan: self.params.plan.id};\r\n                    if (self.params.planChild && self.params.planChild.id) {\r\n                        params.idPlan = self.params.planChild.id;\r\n                    }\r\n                    self.serviceloadDataPlan.loadData(params, self.getDateServer, self.params);\r\n                    self.serviceloadDataPlan.subscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n                    self.serviceloadDataPlan.subscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n                });\r\n        return self.content;\r\n    },\r\n\r\n    loadedWithDataActivities: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOADED_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"UPDATE_INFO_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PROGRESS_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    loadedWithDataFirstParent: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    clean: function(){\r\n        var self = this;\r\n        if(self.serviceloadDataPlan){\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n        }\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.sidebar\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.loadDataPlan\", bizagi.workportal.widgets.project.plan.sidebar], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Action\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.action\", {}, {\r\n\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, projectDashboard, notifier, planTemplateCreate, planPopupEdit, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.PENDING_PLAN = \"PENDING\";\r\n        self.EXECUTING_PLAN = \"EXECUTING\";\r\n        self.CLOSED_PLAN = \"CLOSED\";\r\n\r\n        self.CONTEXT_ACTIVITYPLAN = \"ACTIVITYPLAN\";\r\n        self.CONTEXT_ACTIVITYPLANOVERVIEW = \"ACTIVITYPLANOVERVIEW\";\r\n        self.CONTEXT_PLANCREATE = \"PLANCREATE\";\r\n        self.CONTEXT_ACTIVITYPLANCREATE = \"ACTIVITYPLANCREATE\";\r\n\r\n        self.showActionsPlan = false;\r\n        self.projectDashboard = projectDashboard;\r\n        self.notifier = notifier;\r\n        self.planTemplateCreate = planTemplateCreate;\r\n        self.planPopupEdit = planPopupEdit;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"plan-action-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.action\").concat(\"#project-plan-action\")\r\n        });\r\n    },\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"plan-action-main\");\r\n\r\n        self.showActionsPlan =  self.params.showContextByMenuDashboard !== self.CONTEXT_ACTIVITYPLAN &&\r\n            self.params.showContextByMenuDashboard !== self.CONTEXT_ACTIVITYPLANOVERVIEW;\r\n\r\n        self.plugins = {};\r\n        self.content = tmpl.render({\r\n            plan: self.params.plan.name,\r\n            stateClosedPlan: self.CLOSED_PLAN,\r\n            currentStatePlan: self.params.plan.currentState,\r\n            showActionsPlan: self.showActionsPlan\r\n        });\r\n\r\n        if (self.showActionsPlan) {\r\n            self.params.plan.contextualized = typeof(self.params.plan.contextualized) == \"undefined\" ? true : self.params.plan.contextualized;\r\n        }\r\n\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        if(self.showActionsPlan){\r\n            self.initilizeActionMenu();\r\n            $(\"a#to-close-plan\", $contentWidget).on(\"click\", $.proxy(self.onClosePlan, self));\r\n        }\r\n\r\n        self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n        self.clearAlertsOnFocus();\r\n\r\n        self.planTemplateCreate.sub('planTemplateCreatedSuccess', function () {\r\n            self.notifier.showSucessMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-create-template-success'), ''));\r\n        });\r\n        self.planTemplateCreate.sub('planTemplateCreatedFailed', function () {\r\n            self.notifier.showErrorMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-create-template-fail'), ''));\r\n        });\r\n\r\n        self.planPopupEdit.sub('planEditedSuccess', function () {\r\n            self.setNamePlan(self.params.plan.name);\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"UPDATE_INFO_PLAN\"\r\n            });\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n                args: self.params\r\n            });\r\n\r\n            self.notifier.showSucessMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-edit-success'), ''));\r\n        });\r\n\r\n        self.planPopupEdit.sub('planEditedFailed', function () {\r\n            self.notifier.showErrorMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-edit-fail'), ''));\r\n        });\r\n\r\n        self.sub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n    },\r\n\r\n    onNotifyExpandedRightSidebar: function(){\r\n        var self = this;\r\n        if(self.showActionsPlan){\r\n            self.initilizeActionMenu();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Notifies when an event is raised\r\n     */\r\n\r\n    onNotifyLoadInfoSummaryPlan: function () {\r\n        var self = this;\r\n        self.setStatePlan(self.params.plan.currentState);\r\n        self.setNamePlan(self.params.plan.name);\r\n    },\r\n\r\n    /**\r\n     * UI\r\n     */\r\n\r\n    setStatePlan: function (statePlan) {\r\n        var self = this;\r\n        if (statePlan) {\r\n            switch (statePlan.toUpperCase()) {\r\n                case \"PENDING\":\r\n                    $(\".state-pending-plan\", self.content).show().siblings().hide();\r\n                    break;\r\n                case \"EXECUTING\":\r\n                    $(\".state-executing-plan\", self.content).show().siblings().hide();\r\n                    break;\r\n                case \"CLOSED\":\r\n                    $(\".state-closed-plan\", self.content).show().siblings().hide();\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    setNamePlan: function(namePlan){\r\n        var self = this;\r\n        $(\".ui-bizagi-wp-project-plan-header .bz-wp-section\", self.content).text(bizagi.util.decodeHtmlEntities(namePlan));\r\n    },\r\n\r\n    /**\r\n     Events\r\n     */\r\n    onSelectMenu: function (event, ui) {\r\n        var self = this;\r\n        if($(event.currentTarget).find(\"i\").length === 0){\r\n            var item = $(ui.item).data(\"item\");\r\n\r\n            switch (item) {\r\n                case \"edit\":\r\n                    self.onClickMenuOpenEdition();\r\n                    break;\r\n                case \"delete\":\r\n                    self.onClickMenuDeletePlan();\r\n                    break;\r\n                case \"saveastmpl\":\r\n                    self.onClickMenuSaveAsTemplate();\r\n                    break;\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    onClickMenuOpenEdition: function () {\r\n        var self = this;\r\n        var planSelected = self.params.plan;\r\n        self.planPopupEdit.showPopup(self.params, self.dataService, planSelected);\r\n    },\r\n\r\n    onClickMenuSaveAsTemplate: function () {\r\n        var self = this;\r\n        self.planTemplateCreate.showPopupAddTemplatePlan(self.params,\r\n            self.dataService, self.params.plan.contextualized, self.params.plan.id);\r\n    },\r\n\r\n    onClickMenuDeletePlan: function(){\r\n        var self = this;\r\n\r\n        $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-plan-action-delete-confirmation\"), \"\", \"info\")).done(function () {\r\n            var params = { id: self.params.plan.id };\r\n\r\n            $.when(self.callDeletePlan(params)).always(function(response){\r\n                if (response.status === 200 || typeof (response.status) === \"undefined\") {\r\n                    $.extend(self.params.plan, params);\r\n                    self.notifier.showSucessMessage(\r\n                        printf(bizagi.localization.getResource(\"workportal-project-plan-delete-success\"), \"\"));\r\n\r\n                    //when a plan created from an activity is deleted, not created from a case\r\n                    var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\"});\r\n                    var currentLevelNavigator = parseInt(getLevelNavigator[0]);\r\n                    var params = self.projectDashboard.getParamsByBackFromPlan(self.params, currentLevelNavigator, true);\r\n\r\n                    self.pub(\"notify\", {\r\n                        type: params.typeContext,\r\n                        args: $.extend(self.params, params.paramsNotify)\r\n                    });\r\n                }\r\n                else{\r\n                    self.notifier.showErrorMessage(\r\n                        printf(bizagi.localization.getResource('workportal-project-plan-delete-fail'), ''));\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    onSubmitFormPlan: function (event) {\r\n        event.preventDefault();\r\n    },\r\n\r\n    initilizeActionMenu: function () {\r\n        var self = this;\r\n        $(\".ui-bizagi-wp-project-plan-action-menu\", self.content).menu({\r\n            select: $.proxy(self.onSelectMenu, self)\r\n        }).removeClass(\"ui-widget-content\");\r\n    },\r\n\r\n\r\n    /**\r\n     * Initialize edit plugin\r\n     */\r\n\r\n    clearAlertsOnFocus: function () {\r\n        $(\".ui-bizagi-wp-project-container-validator-relative input, .ui-bizagi-wp-project-container-validator-relative textarea\").focus(function () {\r\n            $(this).parent().find(\".k-invalid-msg\").hide();\r\n        }).focusout(function () {\r\n            if ($(this).val().length < 1) {\r\n                $(this).parent().find(\".k-invalid-msg\").show();\r\n            }\r\n        });\r\n    },\r\n\r\n    /*activitiesAreCompleted: function(activities){\r\n        var listActivities = activities || [];\r\n        var numActivitiesCompleted =  listActivities.filter(function(activity){\r\n            return activity.finishDate;\r\n        }).length;\r\n        return numActivitiesCompleted == activities.length;\r\n    },*/\r\n\r\n    /*getCopyObjectPlan: function(){\r\n        var self = this;\r\n        return {\r\n            id: self.params.plan.id,\r\n            name: self.params.plan.name,\r\n            description: self.params.plan.description,\r\n            dueDate: self.params.plan.dueDate,\r\n            waitForCompletion: self.params.plan.waitForCompletion,\r\n            currentState: self.params.plan.currentState,\r\n            parentWorkItem: self.params.plan.parentWorkItem,\r\n            creationDate: self.params.plan.creationDate,\r\n            startDate: self.params.plan.startDate,\r\n            idUserCreator: self.params.plan.idUserCreator,\r\n            contextualized: self.params.plan.contextualized,\r\n            activities: self.params.plan.activities\r\n        };\r\n    },*/\r\n\r\n    /**\r\n     * Call services\r\n     */\r\n    /*callUpdatePlan: function(params){\r\n        var self = this;\r\n        return $.when(self.dataService.updatePlan(params)).done(function () {\r\n            $.extend(self.params.plan, params);\r\n\r\n        });\r\n    },\r\n\r\n    callClosePlan: function(params){\r\n        var self = this;\r\n        return $.when(self.dataService.closePlan(params)).done(function () {\r\n            $.extend(self.params.plan, params);\r\n            self.notifier.showSucessMessage(\r\n                printf(bizagi.localization.getResource(\"workportal-project-plan-close-success\"), \"\"));\r\n        });\r\n    },*/\r\n\r\n    callDeletePlan: function(params){\r\n        var self = this;\r\n        return $.when(self.dataService.deletePlan(params));\r\n    },\r\n\r\n    clean: function(){\r\n        var self = this;\r\n        self.planTemplateCreate.unsub(\"planTemplateCreatedSuccess\");\r\n        self.planTemplateCreate.unsub(\"planTemplateCreatedFailed\");\r\n        self.planPopupEdit.unsub(\"planEditedSuccess\");\r\n        self.planPopupEdit.unsub(\"planEditedFailed\");\r\n\r\n        self.unsub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.action\", [\"workportalFacade\", \"dataService\",\r\n    \"bizagi.workportal.services.behaviors.projectDashboard\", \"notifier\",\r\n    \"bizagi.workportal.widgets.project.plan.template.create\",\r\n    \"bizagi.workportal.widgets.project.plan.edit\",\r\n    bizagi.workportal.widgets.project.plan.action], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan State\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.state\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-state-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.state\").concat(\"#project-plan-state\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n      var self = this;\r\n      var tmpl = self.getTemplate(\"plan-state-main\");\r\n      var renderWidget = tmpl.render({});\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n       var state = self.params.plan.currentState;\r\n\r\n       switch (state.toUpperCase()) {\r\n         case \"PENDING\":\r\n            $(\".state-pending\", renderWidget).show().siblings().hide();\r\n            break;\r\n         case \"EXECUTING\":\r\n            $(\".state-executing\", renderWidget).show().siblings().hide();\r\n            break;\r\n         case \"CLOSED\":\r\n            $(\".state-closed\", renderWidget).show().siblings().hide();\r\n            break;\r\n      }\r\n      self.content.empty().append(renderWidget);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.state\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.state], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Progress\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.progress\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-progress-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.progress\").concat(\"#project-plan-progress\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n\r\n      self.sub(\"LOAD_INFO_SUMMARY_PROGRESS_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      var $content = self.getContent().empty();\r\n\r\n      var valuePercentBarComplete = self.calculateProgress();\r\n\r\n      var argsTemplate = {};\r\n      argsTemplate.progress = valuePercentBarComplete;\r\n\r\n      if(argsTemplate.progress < 33){\r\n         argsTemplate.colorBar = \"Red\";\r\n      }\r\n      else if(argsTemplate.progress < 66){\r\n         argsTemplate.colorBar = \"Yellow\";\r\n      }\r\n      else{\r\n         argsTemplate.colorBar = \"Green\";\r\n      }\r\n\r\n      //Update widget\r\n      var contentTemplate = self.getTemplate(\"plan-progress-main\");\r\n      contentTemplate\r\n         .render(argsTemplate)\r\n         .appendTo($content);\r\n\r\n      //Begin Adjust status bar next to the number days\r\n      var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\r\n      var widthNumberDays = $(\".remaining-days .days\", $content).width();\r\n      $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\r\n      //End Adjust status bar next to the number days\r\n\r\n\r\n   },\r\n\r\n   calculateProgress: function(){\r\n      var self = this;\r\n\r\n      var completedActivities = 0;\r\n      var totalActivities = self.params.plan.activities.length;\r\n      var percentProgress = 0;\r\n      \r\n      if(totalActivities !== 0){\r\n         self.params.plan.activities.forEach(function(activity){\r\n             if (activity.workItemState === \"Completed\") {\r\n               completedActivities++;\r\n            }\r\n         });\r\n         percentProgress = Math.round((completedActivities / totalActivities) * 100);\r\n      }\r\n      return percentProgress;\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.progress\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.progress], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Time\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.time\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.PENDING_PLAN = \"PENDING\";\r\n      self.EXECUTING_PLAN = \"EXECUTING\";\r\n      self.CLOSED_PLAN = \"CLOSED\";\r\n\r\n      //Regional\r\n      self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-time-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.time\").concat(\"#project-plan-time\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n\r\n      self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      if(self.params.plan){\r\n         if(self.params.plan.dueDate){\r\n            if(self.params.plan.currentState === self.PENDING_PLAN || self.params.plan.currentState === self.EXECUTING_PLAN ){\r\n               self.updateWidget(event, params);\r\n            }\r\n            else{\r\n               self.sub(\"LOADED_ACTIVITIES_PLAN\", $.proxy(self.updateWidget, self));\r\n            }\r\n         }\r\n         else{\r\n            self.getContent().empty();\r\n         }\r\n      }\r\n\r\n   },\r\n   \r\n   /**\r\n    * change the time properties string to timestamp number\r\n    * @param {*} plan \r\n    */\r\n   planDatesToStamp:function (plan) {\r\n      if(plan.activities)\r\n         plan.activities.map(function(a) {\r\n            if(a.estimatedFinishDate)a.estimatedFinishDate=new Date(a.estimatedFinishDate).getTime();\r\n            if(a.startDate)a.startDate=new Date(a.startDate).getTime();\r\n            if(a.finishDate)a.finishDate=new Date(a.finishDate).getTime();\r\n         });\r\n      if(plan.dueDate)plan.dueDate=new Date(plan.dueDate).getTime();\r\n      if(plan.creationDate)plan.creationDate=new Date(plan.creationDate).getTime();\r\n      if(plan.startDate)plan.startDate=new Date(plan.startDate).getTime();\r\n      if(plan.closedDate)plan.closedDate=new Date(plan.closedDate).getTime();\r\n      if(plan.finishDate)plan.finishDate=new Date(plan.finishDate).getTime();\r\n   },\r\n   updateWidget: function(event, params){\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.planDatesToStamp(self.params.plan);\r\n      var $content = self.getContent().empty();\r\n      if(self.params.plan.currentState === self.CLOSED_PLAN){\r\n         self.getClosedDatePlan(self.params.plan);\r\n      }\r\n      $.when(self.getIntervalOnMinutes(self.params.plan)).done(function(response){\r\n         var relativeTime =  bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - (response.minutesToShowTime * 60 * 1000)), null, true);\r\n\r\n         var messageUnitTimeCalculated = relativeTime.replace(/\\d/g,\"\");\r\n         var keywordResourceDescriptionDifference = self.getKeywordDifferenceDates(self.params.plan);\r\n         var messageDescripionDifference = bizagi.localization.getResource(\"workportal-project-plan-state-\" + keywordResourceDescriptionDifference);\r\n         messageDescripionDifference = messageDescripionDifference.replace(\"%s\", messageUnitTimeCalculated);\r\n\r\n         var valueOfTimeCalculated = relativeTime.replace(/\\D/g,\"\");\r\n\r\n         var auxToDate = self.getSecondDate(self.params.plan);\r\n         var auxPercentBar = self.getWidthBar(self.params.plan, response);\r\n         var auxColorBar = self.getColorBarByPercent(auxPercentBar);\r\n         var argsTemplate = {\r\n            fromDate:  self.getFormattedDate(new Date(self.getFirstDate(self.params.plan))),\r\n            toDate: auxToDate ? self.getFormattedDate(new Date(auxToDate)) : null,\r\n            valueOfTimeCalculated: valueOfTimeCalculated,\r\n            messageDescripionDifference: messageDescripionDifference,\r\n            percentBar: auxPercentBar,\r\n            colorBar: auxColorBar\r\n         };\r\n\r\n         var contentTemplate = self.getTemplate(\"plan-time-main\");\r\n         contentTemplate\r\n            .render(argsTemplate)\r\n            .appendTo($content);\r\n\r\n      });\r\n   },\r\n   getFirstDate: function(plan){\r\n      var self = this;\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate){\r\n               return plan.dueDate;\r\n            }\r\n            else{\r\n               return plan.creationDate;\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n         case self.CLOSED_PLAN:\r\n            return plan.startDate;\r\n      }\r\n   },\r\n   getSecondDate: function(plan){\r\n      var self = this;\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            return null;\r\n         case self.EXECUTING_PLAN:\r\n            return plan.dueDate;\r\n         case self.CLOSED_PLAN:\r\n            return plan.closedDate;\r\n      }\r\n   },\r\n   getLastActivity: function(activities){\r\n      var copyActivities = JSON.parse(JSON.stringify(activities));\r\n      return copyActivities.sort(function(activityA, activityB){\r\n         return (activityA.finishDate < activityB.finishDate) ? 1 : -1;\r\n      })[0];\r\n   },\r\n\r\n   getClosedDatePlan: function(plan){\r\n      var self = this;\r\n      plan.closedDate =  self.getLastActivity(plan.activities).finishDate;\r\n      return plan.closedDate;\r\n   },\r\n\r\n   getDifferenceBetweenDates: function(firstDate, secondDate){\r\n      var self = this;\r\n      var defer = $.Deferred();\r\n      var params = {\r\n         idUser: bizagi.currentUser.idUser,\r\n         fromDate: firstDate,\r\n         toDate: secondDate\r\n\r\n      };\r\n      $.when(self.callGetEffectiveDuration(params)).done(function(difference){\r\n         defer.resolve(difference.minutes);\r\n      });\r\n      return defer.promise();\r\n   },\r\n\r\n   getIntervalOnMinutes: function(plan){\r\n      var self = this;\r\n      var defer = $.Deferred();\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate > Date.now()){\r\n               $.when(self.getDifferenceBetweenDates(Date.now(), plan.dueDate)).done(function(minutesNowToDueDate){\r\n                   $.when(self.getDifferenceBetweenDates(plan.creationDate, Date.now())).done(function(minutesCreateToNow){\r\n                       defer.resolve({minutesToShowTime: minutesNowToDueDate, minutesCreateToNow: minutesCreateToNow});\r\n                   });\r\n               });\r\n            }\r\n            else if(plan.dueDate < plan.creationDate){\r\n               $.when(self.getDifferenceBetweenDates(plan.dueDate,  plan.creationDate)).done(function(minutesDueDateToCreate){\r\n                   $.when(self.getDifferenceBetweenDates(plan.creationDate, Date.now())).done(function(minutesCreateToNow){\r\n                       defer.resolve({minutesToShowTime: minutesDueDateToCreate + minutesCreateToNow, minutesCreateToNow: minutesCreateToNow});\r\n                   });\r\n               });\r\n            }\r\n            else if(plan.dueDate > plan.creationDate){\r\n                $.when(self.getDifferenceBetweenDates(plan.creationDate, plan.dueDate)).done(function(minutesCreateToDueDate){\r\n                    $.when(self.getDifferenceBetweenDates(plan.dueDate, Date.now())).done(function(minutesCreateToNow){\r\n                        defer.resolve({minutesToShowTime: minutesCreateToDueDate + minutesCreateToNow, minutesCreateToNow: minutesCreateToNow});\r\n                    });\r\n                });\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n            if(plan.dueDate){\r\n               if(plan.dueDate > Date.now()){\r\n                  $.when(self.getDifferenceBetweenDates(Date.now(), plan.dueDate)).done(function(minutesNowToDueDate){\r\n                      $.when(self.getDifferenceBetweenDates(plan.startDate, Date.now())).done(function(minutesStartToNow){\r\n                          defer.resolve({minutesToShowTime: minutesNowToDueDate, minutesStartToNow: minutesStartToNow});\r\n                      });\r\n                  });\r\n               }\r\n               else{\r\n                  $.when(self.getDifferenceBetweenDates(plan.dueDate, Date.now())).done(function(minutesDueDateToNow){\r\n                      $.when(self.getDifferenceBetweenDates(plan.startDate, plan.dueDate)).done(function(minutesStartToDueDate){\r\n                          defer.resolve({minutesToShowTime: minutesDueDateToNow, minutesStartToDueDate: minutesStartToDueDate});\r\n                      });\r\n                  });\r\n               }\r\n\r\n            }\r\n            else{\r\n               $.when(self.getDifferenceBetweenDates(plan.startDate, Date.now())).done(function(minutes){\r\n                  defer.resolve({minutesToShowTime: minutes});\r\n               });\r\n            }\r\n            break;\r\n         case self.CLOSED_PLAN:\r\n            $.when(self.getDifferenceBetweenDates(plan.startDate, plan.closedDate)).done(function(minutes){\r\n               defer.resolve({minutesToShowTime: minutes});\r\n            });\r\n\r\n      }\r\n      return defer.promise();\r\n   },\r\n\r\n   getKeywordDifferenceDates: function(plan){\r\n      var self = this;\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate > Date.now()){\r\n               return \"remaining\";\r\n            }\r\n            else {\r\n               return \"exceeded\";\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n            if(plan.dueDate){\r\n               if(plan.dueDate > Date.now()){\r\n                  return \"remaining\";\r\n               }\r\n               else{\r\n                  return \"exceeded\";\r\n               }\r\n\r\n            }\r\n            else{\r\n               return \"opened\";\r\n            }\r\n            break;\r\n         case self.CLOSED_PLAN:\r\n            return \"executed\";\r\n      }\r\n   },\r\n\r\n   getRelativeTime: function(milliseconds){\r\n      return bizagi.util.dateFormatter.getRelativeTime(milliseconds, null, false);\r\n   },\r\n\r\n   getWidthBar: function(plan, intervalMinutes){\r\n      var self = this,\r\n         differenceStartDateToCurrentDate = {};\r\n      switch(plan.currentState) {\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate){\r\n               if(plan.dueDate < Date.now()){\r\n                  return 0;\r\n               }\r\n               else{\r\n                   var totalInterval = intervalMinutes.minutesCreateToNow + intervalMinutes.minutesToShowTime;\r\n                   valuePercentInterval = intervalMinutes.minutesToShowTime;\r\n                   return Math.ceil(valuePercentInterval * 100 / totalInterval);\r\n               }\r\n            }\r\n            else{\r\n               return 0;\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n            if(plan.dueDate) {\r\n               if (plan.dueDate > Date.now()) {\r\n                  var totalInterval = intervalMinutes.minutesStartToNow + intervalMinutes.minutesToShowTime;\r\n                  valuePercentInterval = intervalMinutes.minutesToShowTime;\r\n                  return Math.ceil(valuePercentInterval * 100 / totalInterval);\r\n               }\r\n               else{\r\n                  return 0;\r\n               }\r\n            }\r\n            else{\r\n               return 0;\r\n            }\r\n            break;\r\n         case self.CLOSED_PLAN:\r\n            if(plan.closedDate > Date.now()){\r\n               var differenceStartDateToClosedDate = plan.closedDate - plan.startDate;\r\n               differenceStartDateToCurrentDate = Date.now() - plan.startDate;\r\n               return Math.ceil(differenceStartDateToCurrentDate * 100 / differenceStartDateToClosedDate);\r\n            }\r\n            else{\r\n               return 100;\r\n            }\r\n      }\r\n\r\n\r\n   },\r\n\r\n   getColorBarByPercent: function(percent){\r\n      if(percent < 33){\r\n         return \"Red\";\r\n      }\r\n      else if(percent < 66){\r\n         return \"Yellow\";\r\n      }\r\n      else {\r\n         return \"Green\";\r\n      }\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n\r\n   callGetEffectiveDuration: function(params){\r\n      var self = this;\r\n      var d = $.Deferred();\r\n\r\n      $.when(\r\n         self.dataService.getEffectiveDuration(params)\r\n      ).done(function (data) {\r\n            d.resolve(data);\r\n         });\r\n      return d.promise();\r\n   },\r\n\r\n   getFormattedDate: function (dateObj) {\r\n      var self = this;\r\n      var monthsNames = self.datePickerRegional.monthNames;\r\n      var shortMonth = dateObj.getMonth();\r\n      return monthsNames[shortMonth] + \" \" + bizagi.util.dateFormatter.formatDate(dateObj, \"dd hh:mm tt\", bizagi.localization.getResource(\"datePickerRegional\"));\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.time\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.time], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Parent\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.parent\", {}, {\r\n\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"plan-parent-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.parent\").concat(\"#project-plan-parent\")\r\n        });\r\n    },\r\n\r\n    renderContent: function () {\r\n\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n    },\r\n\r\n    /**\r\n     * Notifies when an event is raised\r\n     */\r\n    onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n        var self = this,\r\n        $content = self.getContent().empty();\r\n        self.params = $.extend(self.params, params.args);\r\n        if (self.params.plan.parentWorkItem) {\r\n            $.when(self.dataService.getPlanParent({ idPlan: self.params.plan.id })).done(function(planParent) {\r\n                self.params.plan.parent = planParent;\r\n\r\n                  if (self.params.plan.parent) {\r\n                    var argsTemplate = {\r\n                        idParent: self.params.plan.parent.radNumber,\r\n                        nameParent: self.params.plan.parent.displayName,\r\n                        idCase: self.params.plan.parent.idCase,\r\n                        idWorkflow: self.params.plan.parent.idWorkflow,\r\n                        idWorkItem: self.params.plan.parent.idWorkItem,\r\n                        idTask: self.params.plan.parent.idTask,\r\n                        processName: self.params.process ? self.params.process : self.params.plan.parent.planName\r\n                    };\r\n\r\n                    if(bizagi.util.isEmpty(self.params.plan.parent.guidActivity)){\r\n                        self.goToParentCase($content, argsTemplate);\r\n                    }else{\r\n                        var paramsDetailActivity = {\r\n                            idPlan: self.params.plan.id,\r\n                            idActivity: self.params.plan.parent.guidActivity \r\n                        };\r\n                        $.when(self.dataService.getActivity(paramsDetailActivity)).done(function (response) {\r\n                            self.params.plan.parent.allowEdition = response.allowEdition;\r\n                            self.goToParentCase($content, argsTemplate);\r\n                         });\r\n                    }\r\n                    \r\n                }\r\n            \r\n            }).fail(function(msg) {\r\n\r\n            });\r\n        }\r\n    },\r\n    goToParentCase: function(content, argsTemplate){\r\n        var self = this\r\n        //TODO: double call because routing dont release memory and widgets\r\n        //Test with a breakpoint\r\n        content.empty();\r\n\r\n        //Update widget\r\n        var contentTemplate = self.getTemplate(\"plan-parent-main\");\r\n        contentTemplate\r\n            .render(argsTemplate)\r\n            .appendTo(content);\r\n        $(\"#go-to-parent-case\", content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\r\n    },\r\n    onClickGoToParentCase: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n        self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.parent\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.parent], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Users\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.users\", {}, {\r\n\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        self.usersMap = {};\r\n        self.plugins = {};\r\n        self.usersInformation=[];\r\n        self.globalHandlersService = bizagi.injector.get('globalHandlersService');\r\n        self.usersAssignees = [];\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"plan-users-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.users\").concat(\"#project-plan-users\")\r\n        });\r\n\r\n        self.auxNoRepeatTypesUser = {};\r\n        self.hashTypesUser = {\r\n            \"assigned\": bizagi.localization.getResource(\"workportal-project-user-assigned\"),\r\n            \"owner\": bizagi.localization.getResource(\"workportal-project-user-owner\")\r\n        };\r\n    },\r\n\r\n    renderContent: function () {\r\n\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.sub(\"LOAD_INFO_ACTIVITIES_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n    },\r\n\r\n    /**\r\n     * Notifies when an event is raised\r\n     */\r\n    onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n        var self = this,\r\n            args = params.args,\r\n            cvsGuidUsers = [],\r\n            activitiesUsers = [],\r\n            $content = self.getContent().empty();\r\n            var ownerUserGuid = params.args.plan.idUserCreator;\r\n            var ownerUserId = params.args.plan.idUserCreator;\r\n        self.params = $.extend(self.params, params.args);\r\n\r\n        activitiesUsers.push({ \"idUser\": ownerUserId, 'userGuid': ownerUserGuid, \"userType\": [\"owner\"]});\r\n        self.usersMap[\"-\" + ownerUserId + \"-\"] = {\r\n            picture: \"\",\r\n            id: ownerUserId,\r\n            guid: ownerUserGuid,\r\n            name: \"\",\r\n            userType: [\"owner\"]\r\n        };\r\n        cvsGuidUsers.push(ownerUserId);\r\n        $.each(self.params.plan.activities, function (index, activity) {\r\n            var userId = activity.userAssigned;\r\n            var userGuid = activity.userAssignedGuid;\r\n            if(activity.isRunning == true){\r\n                if (userId === ownerUserId) {\r\n                    if($.inArray(\"Assigned\", activitiesUsers[0].userType) === -1){\r\n                        activitiesUsers[0].userType.push(\"Assigned\");\r\n                        self.usersMap[\"-\" + ownerUserId + \"-\"].userType.push(\"Assigned\");\r\n                    }\r\n                }\r\n                else {\r\n                    self.usersMap[\"-\" + userId + \"-\"] = {\r\n                        picture: \"\",\r\n                        id: userId,\r\n                        guid: userGuid,\r\n                        name: \"\",\r\n                        userType: [\"Assigned\"]\r\n                    };\r\n                    if (activitiesUsers.filter(function(user) { return user.idUser == userId; }).length === 0) {\r\n                        activitiesUsers.push({\"idUser\": userId, \"guidUser\": userGuid, \"userType\": [\"Assigned\"]});\r\n                        cvsGuidUsers.push(userId);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        self.activitiesUsers = activitiesUsers;\r\n        self.params = args;\r\n        //Update widget\r\n        var contentTemplate = self.getTemplate(\"plan-users-main\");\r\n        contentTemplate\r\n            .render({\r\n                assignee: self.justAssignees(activitiesUsers),\r\n                label: bizagi.localization.getResource(\"workportal-project-plan-assignee\")\r\n            })\r\n            .appendTo($content);\r\n        self.initilizeTooltip();\r\n        self.addEventHandlersModal();\r\n        $.when(self.callGetDataUsers(cvsGuidUsers)).then(function () {\r\n            self.showCreatorInformation(ownerUserId);\r\n            self.renderUserProfilesAndImages();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * return standar userAdapter information with only assigned users when the plan has started\r\n     * @param {Array} allUsers \r\n     */\r\n    justAssignees: function (allUsers) {\r\n        var self = this;\r\n        var usersAssignee=[];\r\n        if ([\"CLOSED\", \"PENDING\"].indexOf(self.params.plan.currentState)==-1) {\r\n            allUsers.map(function(user) {\r\n                var isOwner=user.userType.indexOf(\"owner\")!==-1;\r\n                var isAssignee=user.userType.indexOf(\"Assigned\")!==-1;\r\n                usersAssignee.push(usersAdapter.createJsonUserInfo(user.idUser, \"\", \"\", \"\", \"\", \"\", isAssignee, isOwner, [], []));\r\n            });\r\n        }\r\n        return usersAdapter.justAssignees(usersAssignee);\r\n    },\r\n\r\n    /**\r\n     * show the information of the creator case\r\n     * @param {string} ownerUserId guid user creator\r\n     */\r\n    showCreatorInformation: function (ownerUserId) {\r\n        var self = this;\r\n        var userCreator=self.usersInformation.find(function(user) {\r\n            return user.id==ownerUserId\r\n        });\r\n        var userInfo = usersAdapter.createJsonUserInfo(\r\n            userCreator.id,\r\n            userCreator.name,\r\n            userCreator.username,\r\n            userCreator.picture?\"data:image/png;base64,\"+userCreator.picture:undefined,\r\n            userCreator.email,\r\n            userCreator.name.getInitials(),\r\n            false,\r\n            true,\r\n            [],\r\n            []\r\n        );\r\n        self.content.find(\".ui-bizagi-wp-project-plan-users .ui-bizagi-wp-project-users-creator-info\").userinformation(self, { user: userInfo });\r\n    },\r\n\r\n    /**\r\n     * UI\r\n     */\r\n    renderUserProfilesAndImages: function () {\r\n        var self = this;\r\n        $.each(self.usersMap, function (i, obj) {\r\n            var $li = $(\".ui-bizagi-wp-userlist li[data-iduser=\" + obj.id + \"]\", self.content);\r\n\r\n            if (obj.picture !== \"\") {\r\n                $li.find(\"img\").prop(\"src\", obj.picture);\r\n                $(\".bz-wp-avatar-label\", $li).hide();\r\n            }\r\n            else {\r\n                if(obj.name!==undefined){\r\n                    $(\".bz-wp-avatar-img\", $li).hide();\r\n                    $(\".bz-wp-avatar-label\", $li).html(obj.name.getInitials());\r\n                }\r\n                else{\r\n                    console.log(\"obj.name is undefined\");\r\n                }\r\n\r\n            }\r\n        });\r\n    },\r\n\r\n    /*\r\n     *  Get data for users\r\n     */\r\n    callGetDataUsers: function (csvguidUsers) {\r\n        var self = this,\r\n            params = {},\r\n            defer = $.Deferred();\r\n        params = {\r\n            usersGuids: csvguidUsers.join(),\r\n            width: 50,\r\n            height: 50\r\n        };\r\n        $.when(self.dataService.getUsersData(params)).always(function (response) {            \r\n            self.usersInformation = response;\r\n            for (var i = 0, length = response.length; i < length; i += 1) {\r\n                if (typeof (response[i].name) === \"undefined\") {\r\n                    bizagi.log(response[i] + \" Id Not Found\", response, \"error\");\r\n                } else {\r\n                    if(self.usersMap[\"-\" + response[i].id + \"-\"]){\r\n                        self.usersMap[\"-\" + response[i].id + \"-\"].picture += (response[i].picture) ? \"data:image/png;base64,\" + response[i].picture : \"\";\r\n                        self.usersMap[\"-\" + response[i].id + \"-\"].name = response[i].name || \"\";\r\n                    }\r\n                    else{\r\n                        console.log(\"self.usersMap['-' + response[i].id + '-'] is undefined\")\r\n                    }\r\n\r\n                }\r\n            }\r\n            self.getUsersAssignees();\r\n            defer.resolve();\r\n        });\r\n        return defer.promise();\r\n    },\r\n    \r\n    /*\r\n    * validate if the activity is running\r\n    */\r\n    activityRuning: function (activity) {\r\n        return activity.startDate !== null;\r\n    },\r\n\r\n    getUsersAssignees: function(){\r\n        var self = this;\r\n        for(var i=0; i<self.usersInformation.length; i++){\r\n            var res_user=self.getUserAssignee(self.usersInformation[i]);\r\n            if (res_user!==false) {\r\n                self.usersAssignees.push(res_user);\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    getUserAssignee: function(user){\r\n        var self =  this;\r\n        var tasks = [];\r\n        $.each(self.params.plan.activities, function (index, activity) {\r\n            var userId = activity.userAssigned;\r\n            if (userId === user.id && self.activityRuning(activity)) {\r\n                tasks.push({ \"name\": activity.name });\r\n            }\r\n        });\r\n        if(tasks.length==0)return false;\r\n        user.tasks = tasks;\r\n        var types = self.activitiesUsers.find(function(actUser) {\r\n            return actUser.idUser == user.id;\r\n        });\r\n        user.types = types===undefined?[]:types.userType;\r\n        \r\n        var userAssignees = usersAdapter.createJsonUserInfo(\r\n            user.id, \r\n            user.name, \r\n            user.username, \r\n            user.picture ? \"data:image/png;base64,\" + user.picture : undefined, \r\n            user.email, \r\n            user.name.getInitials(),\r\n            user.types.indexOf(\"Assigned\") > -1, \r\n            user.types.indexOf(\"owner\") > -1, \r\n            user.tasks, \r\n            []);\r\n\r\n            return userAssignees;\r\n       },\r\n\r\n    /*\r\n     *  Tooltips\r\n     */\r\n    initilizeTooltip: function () {\r\n        var self = this;\r\n\r\n        $(\".ui-bizagi-wp-userlist > li\", self.content).not(\".moreUsers\").on('mouseenter', '', function (ev) {\r\n            var $target = $(ev.target);\r\n            var id_userSelected=$target.closest(\"[data-iduser]\").attr('data-iduser');\r\n            var user=self.usersInformation.find(function(user) {\r\n                return user.id==id_userSelected;\r\n            });\r\n            var activities=[];\r\n\r\n            if(user.tasks)\r\n                user.tasks.map(function(task) {\r\n                    activities.push(task.name);\r\n                });\r\n\r\n            var types = self.activitiesUsers.find(function(actUser) {\r\n                return actUser.idUser == id_userSelected;\r\n            });\r\n            user.types = types.userType;\r\n           \r\n            user.owner = user.types.find(function(type){\r\n                return type == \"owner\";\r\n            });\r\n            user.isAssignee = user.types.find(function(type){\r\n                return type == \"Assigned\";\r\n            });\r\n                \r\n            var userParam= usersAdapter.createJsonUserInfo(user.id, user.name, user.username, user.picture?\"data:image/png;base64,\"+user.picture:undefined, user.email,  user.name.getInitials(), user.isAssignee, user.owner, activities, []);\r\n            $target.parent().usertooltip(self, { target: $target, user: userParam });\r\n        });\r\n    },\r\n    addEventHandlersModal: function () {\r\n        var self =  this;\r\n        $(\".moreUsers\").click(function(event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            var usersAssignees = self.usersAssignees || [];\r\n            self.globalHandlersService.publish(\"showDialogWidget\", {\r\n                widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL,\r\n                closeVisible: true,\r\n                data: usersAssignees,\r\n                maximize: true,\r\n                modalParameters: {\r\n                    title: bizagi.localization.getResource(\"workportal-project-users-title\")+ \" (\"+usersAssignees.length+\")\",\r\n                    width: 790,\r\n                    height: 526,\r\n                    refreshInbox: false\r\n                }\r\n            });\r\n         });\r\n       }\r\n});\r\n\r\n\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.users\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.users], true);"]}