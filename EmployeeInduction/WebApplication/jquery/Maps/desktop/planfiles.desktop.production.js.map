{"version":3,"sources":["jquery/workportal/desktop/widget/project.dashboard.menu.plan/bizagi.workportal.desktop.widgets.project.dashboard.menu.plan.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.attachments/bizagi.workportal.desktop.widgets.project.attachments.js","jquery/workportal/desktop/widget/project.files/bizagi.workportal.desktop.widgets.project.files.js","jquery/workportal/desktop/widget/project.filesPreview/bizagi.workportal.desktop.widgets.project.filesPreview.js","jquery/workportal/desktop/widget/project.file.sidebar/bizagi.workportal.desktop.widgets.project.file.sidebar.js"],"names":["bizagi","workportal","widgets","widget","extend","init","workportalFacade","dataService","projectDashboard","params","self","this","_super","loadTemplates","project-dashboard-menu","getTemplate","concat","renderContent","content","$","postRender","contextsLeftSidebarCaseDashboard","forEach","context","sub","proxy","updateView","event","args","clean","$content","getContent","empty","template","menuPlanDashboard","menuDashboard","planState","getPlanState","plan","planChild","argsTemplate","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isVisibleShowTimeLine","render","appendTo","showContextByMenuDashboard","toUpperCase","addClass","siblings","removeClass","handlerEvents","currentState","extraValidationShowTimeLine","loadContentById","preventDefault","$item","target","closest","data","backParentPlan","hasClass","pub","type","subMenuHandler","$comments","$files","$timeline","on","toggle","getLevelNavigator","currentLevelNavigator","parseInt","getParamsByBackFromPlan","typeContext","paramsNotify","off","unsub","injector","register","project","dashboard","menu","project-content-dashboard","setTimeout","window","trigger","ui","kendo","Widget","ProjectAttachments","element","options","that","fn","call","_maxFilesSize","maxSize","_fileList","_onlyValidateServerFileExtension","onlyValidateServerFileExtension","_supportFileExt","extensions","_uploadMaxFilesSize","upload","_initUpload","loadNotifier","_initLoadNotifier","notification","_initNotification","_eventsHandler","_initLocalization","localization","name","wrapper","multiple","dropZone","maxFilesSize","currentUser","uploadMaxFileSize","enabled","auxNumberFilesSuccess","kendoUpload","async","saveUrl","getXSRFToken","autoUpload","select","_filterMaxFilesSize","complete","interval","setInterval","find","length","_showNotificationCompleteUpload","clearInterval","progress","_onProgressFile","success","push","files","error","onErrorFile","selectFiles","dropFilesHere","showFileList","kendoNotification","position","pinned","kendoWindow","title","notifierTitle","actions","animation","open","duration","close","visible","resizable","draggable","maxHeight","minWidth","objectOptionsLocalization","optionsLocalizationByDefault","getResource","errorUpload","errorSecurity","errorSize","errorMaxFilesSize","replace","Math","round","cancel","retry","$file","_getFileItemByUID","uid","percent","percentComplete","css","width","text","hide","_onShowUploadNotifier","top","left","bottom","right","wrapperMessage","_autoHideMessage","fadeOut","_onCancelFile","$target","$fileWrapper","$uploadWrapper","guid","remove","_onRemoveFile","_onRetryFile","file","grep","i","validation","_isValidFile","message","setStatus","valid","size","undefined","inArray","extension","total","_notifySizeExceeded","show","_switchEvents","currentTarget","cancelFilesUpload","destroy","status","prop","errorUploadiis","plugin","jQuery","base","plugins","prefixBase64","usersData","currentFilesList","fileDateInterval","project-files","project-files-uploaditem","project-files-list","project-attachments","templateHomeFiles","isOpen","util","parseBoolean","isClosedForAllUsers","when","renderFilesList","done","initializeUploadFiles","eventsHandler","restrictedEventsHandler","defer","Deferred","filesLength","globalParent","encodeURIComponent","radNumber","dateTime","date","getDateServer","count","flowContext","id","getFilesListByRadNumber","renderFiles","resolve","promise","$showMoreWrapper","displayFileList","updateRelativeTime","setAdditionalData","notifyFilesNumber","renderNoFiles","noFilesTmpl","resources","$noFiles","tmpl","html","kendoProjectAttachments","serviceLocator","getUrl","onSuccessFile","addFileData","onSaveFileData","supportFileExt","uploadMaxFilesSize","thumbnails","users","guidsUsers","user","attachment","setUserData","join","setThumbnails","usersGuids","height","getUsersData","picture","getFileInfoByGuid","guids","getFilesThumbnails","thumbnail","$wrapper","$img","each","src","toLowerCase","setFilePreview","guidAttch","guidFile","img","userId","fileData","userData","XMLHttpRequest","JSON","parse","response","saveFileData","fail","onRetryFile","toString","description","idUser","attachmentsToCreate","unshift","createProjectFile","always","userName","Date","getTime","photo","reject","action","$filesList","equalizeHeights","deleteFile","filter","updateFileData","changeRelativeTime","item","relativeTime","dateFormatter","getRelativeTime","onSelectFiles","bannedFiles","isValidFile","bannedFile","splice","showFilesError","resetWidget","switchFilesEvents","stopPropagation","fileName","getDownloadAttachment","parent","mandatory","filesNumber","notifier","datePickerRegional","dialogBox","project-filespreview-wrapper","project-filespreview-preview","project-filespreview-popup","project-filespreview-thenumber","generalTmpl","setFilesNumber","fileEdition","initPluginPopupEdition","form","image","edit","parameters","isEmptyObject","currentFile","$filesNumber","formContent","showPreview","idCurrentUser","applyMenu","setEditionData","val","onResetFileForm","onSaveEdition","onSelectMenu","onOpenEdition","onDeleteFile","onDownloadFile","dialog","modal","maximize","focus","showConfirmationBox","attachmentsToDelete","validateAddFileDescriptionForm","updateProjectFile","showSucessMessage","printf","showErrorMessage","$description","result","$textAreadescription","trim","descriptionValidation","next","detach","filesPreview","supportNav","project-file-sidebar","getWidgetName","BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR","sidebar"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Plan\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.plan\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, projectDashboard, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n      self.projectDashboard = projectDashboard;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.plan\").concat(\"#project-dashboard-menu\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.sub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n   },\r\n\r\n\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      self.params.menuPlanDashboard = self.params.menuPlanDashboard || {};\r\n      $.extend(self.params.menuPlanDashboard, self.params.menuDashboard);\r\n\r\n      self.planState = self.getPlanState(self.params.plan, self.params.planChild);\r\n      var argsTemplate = {\r\n         planState: self.planState,\r\n         showCommentsOptionMenu: self.params.menuPlanDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuPlanDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuPlanDashboard.showTimeLineOptionMenu && self.isVisibleShowTimeLine(self.planState)\r\n      };\r\n      template.render(argsTemplate).appendTo($content);\r\n       \r\n      $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n\r\n      self.handlerEvents();\r\n   },\r\n\r\n    /**\r\n     * Return planState by plan or planChild\r\n     * @param plan\r\n     * @param planChild\r\n     * @returns {*}\r\n     */\r\n    getPlanState: function(plan, planChild){\r\n        var currentState;\r\n        if(planChild && planChild.currentState){\r\n            currentState = planChild.currentState;\r\n        }\r\n        else if(plan && plan.currentState){\r\n            currentState = plan.currentState;\r\n        }\r\n        return currentState;\r\n    },\r\n\r\n    /**\r\n     * Behavior visible timeline option\r\n     */\r\n    isVisibleShowTimeLine: function(planState){\r\n        var self = this;\r\n        var extraValidationShowTimeLine = true;\r\n        if(planState === \"PENDING\"){\r\n            extraValidationShowTimeLine = false;\r\n        }\r\n        return extraValidationShowTimeLine;\r\n    },\r\n\r\n   /*\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if ($item.data(\"context\") === \"PLANBACK\") {\r\n         self.backParentPlan();\r\n      }\r\n      else{\r\n         if (!$item.hasClass(\"active\")) {\r\n            var showContextByMenuDashboard = $item.data(\"context\");\r\n            if (showContextByMenuDashboard) {\r\n\r\n               self.pub(\"notify\", {\r\n                  type: showContextByMenuDashboard.toUpperCase(),\r\n                  args: $.extend(self.params,{showContextByMenuDashboard: showContextByMenuDashboard})\r\n               });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n            }\r\n         }\r\n      }\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n      var self = this;\r\n      var content = self.getContent();\r\n      var $comments = $(\"[data-context='PLANCOMMENTS']\", content);\r\n      var $files = $(\"[data-context='PLANFILES']\", content);\r\n      var $timeline = $(\"[data-context='PLANTIMELINE']\", content);\r\n\r\n      $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n         $comments.toggle();\r\n         $files.toggle();\r\n         if(self.isVisibleShowTimeLine(self.planState)){\r\n            $timeline.toggle();\r\n         }\r\n      });\r\n   },\r\n\r\n   backParentPlan: function(){\r\n      var self = this;\r\n      //when a plan created from an activity is deleted, not created from a case\r\n      var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\"});\r\n      var currentLevelNavigator = parseInt(getLevelNavigator[0]);\r\n      var params = self.projectDashboard.getParamsByBackFromPlan(self.params, currentLevelNavigator);\r\n\r\n      self.pub(\"notify\", {\r\n         type: params.typeContext,\r\n         args: $.extend(self.params, params.paramsNotify)\r\n      });\r\n\r\n   },\r\n\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      self.subMenuHandler();\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\",  $.proxy(self.loadContentById, self));\r\n   },\r\n\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.plan\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.projectDashboard\", bizagi.workportal.widgets.project.dashboard.menu.plan], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-content-dashboard\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n\r\n      setTimeout(function(){\r\n         $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\r\n      }, 1000);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","\r\n/*\r\n *   Name: BizAgi Workportal Widget Project Attachments\r\n *   Author: David Romero Estrada\r\n *   Comments:\r\n *   -   This script will define the framework API to manage attachments\r\n */\r\n\r\n (function ($) {\r\n\r\n     // shorten references to variables. this is better for uglification \r\n     var kendo = window.kendo,\r\n      ui = kendo.ui,\r\n      Widget = ui.Widget;\r\n\r\n     var ProjectAttachments = Widget.extend({\r\n\r\n         init: function (element, options) {\r\n\r\n             var that = this;\r\n\r\n             // base call to initialize widget\r\n             Widget.fn.init.call(that, element, options);\r\n\r\n             that._maxFilesSize = options.maxSize;\r\n             that._fileList = [];\r\n             that._onlyValidateServerFileExtension = options.onlyValidateServerFileExtension || true;\r\n             that._supportFileExt = options.extensions;\r\n             that._uploadMaxFilesSize = options.maxSize;\r\n             that.upload = that._initUpload();\r\n             that.loadNotifier = that._initLoadNotifier();\r\n             that.notification = that._initNotification();\r\n\r\n             that._eventsHandler();\r\n\r\n             that._initLocalization(that.options.localization);\r\n         },\r\n\r\n         options: {\r\n             name: \"ProjectAttachments\",\r\n             wrapper: $(\"<div class=\\\"project-attachments\\\"></div>\"),\r\n             multiple: true,\r\n             dropZone: true,\r\n             maxFilesSize: bizagi.currentUser ? bizagi.currentUser.uploadMaxFileSize : 25000,\r\n             enabled: true,\r\n             localization: {}\r\n         },\r\n\r\n         _initUpload: function () {\r\n\r\n             var that = this,\r\n              options = that.options,\r\n              localization = options.localization || {},\r\n              auxNumberFilesSuccess = 0;\r\n\r\n             that._initLocalization(localization);\r\n\r\n             return this.element.kendoUpload({\r\n                 async: {\r\n                     saveUrl: options.saveUrl + '?xsrf=' + bizagi.getXSRFToken(),\r\n                     autoUpload: true\r\n                 },\r\n                 select: function (event) {\r\n                     that._filterMaxFilesSize(event);\r\n                     auxNumberFilesSuccess = 0;\r\n                 },\r\n                 complete: function(){\r\n                     var interval = setInterval(function(){\r\n                        if( that.loadNotifier.wrapper.find(\"li.k-file-progress\").length === 0){\r\n                            that._showNotificationCompleteUpload(that.loadNotifier.wrapper, auxNumberFilesSuccess);\r\n                            clearInterval(interval);\r\n                        }\r\n                     }, 300);\r\n                 },\r\n                 upload: options.upload,\r\n                 progress: function (event) {\r\n                     that._onProgressFile(event);\r\n                 },\r\n                 success: function (event) {\r\n                     that._fileList.push(event.files[0]);\r\n                     auxNumberFilesSuccess += 1;\r\n                     options.success(event);\r\n                 },\r\n                 error: function (event) {\r\n                     that.onErrorFile(event);\r\n                 },\r\n                 localization: {\r\n                     select: localization.selectFiles,\r\n                     dropFilesHere: localization.dropFilesHere\r\n                 },\r\n                 multiple: options.multiple,\r\n                 enabled: options.enabled,\r\n                 dropZone: options.dropZone,\r\n                 showFileList: false\r\n             }).data(\"kendoUpload\");\r\n\r\n         },\r\n\r\n         _initNotification: function(){\r\n             return $(\"<div></div>\").kendoNotification({\r\n                 position: {\r\n                     pinned: true\r\n                 }\r\n             }).data(\"kendoNotification\");\r\n         },\r\n\r\n         _initLoadNotifier: function () {\r\n\r\n             var that = this,\r\n                    localization = that.options.localization,\r\n                    $wrapper = that.options.wrapper;\r\n\r\n             return $wrapper.kendoWindow({\r\n                 title: localization.notifierTitle,\r\n                 actions: [\"Close\"],\r\n                 animation: {\r\n                     open: {\r\n                         duration: 100\r\n                     },\r\n                     close: {\r\n                         duration: 100\r\n                     }\r\n                 },\r\n                 open: function() {\r\n                     this.wrapper.addClass(\"project-attachments-wrapper-window\");\r\n                 },\r\n                 visible: false,\r\n                 resizable: false,\r\n                 draggable: false,\r\n                 maxHeight: \"300px\",\r\n                 minWidth: \"430px\"\r\n             }).data(\"kendoWindow\");\r\n\r\n         },\r\n\r\n         _initLocalization: function(objectOptionsLocalization){\r\n             var that = this;\r\n             var optionsLocalizationByDefault = {\r\n                 selectFiles: bizagi.localization.getResource(\"workportal-project-attachments-addfiles\"),\r\n                 notifierTitle: bizagi.localization.getResource(\"workportal-project-attachments-notifiertitle\"),\r\n                 errorUpload: bizagi.localization.getResource(\"workportal-project-attachments-file-error-type\"),\r\n                 errorSecurity: bizagi.localization.getResource(\"workportal-project-attachments-blockedext\"),\r\n                 errorSize: bizagi.localization.getResource(\"workportal-project-attachments-blockedsize\"),\r\n                 errorMaxFilesSize: bizagi.localization.getResource(\"workportal-project-discussion-maxfilessize\").replace(\"%s\", (Math.round(that._maxFilesSize/1000000, -1))),\r\n                 dropFilesHere: bizagi.localization.getResource(\"workportal-project-attachments-drophere\"),\r\n                 cancel: bizagi.localization.getResource(\"workportal-widget-reports-confirm-cancel\"),\r\n                 retry: bizagi.localization.getResource(\"workportal-project-attachments-retry\"),\r\n                 close: bizagi.localization.getResource(\"workportal-widget-dialog-box-close\")\r\n             };\r\n\r\n             $.extend(objectOptionsLocalization, optionsLocalizationByDefault);\r\n         },\r\n\r\n         _onProgressFile: function (event) {\r\n\r\n             var that = this;\r\n             var $file = that._getFileItemByUID(event.files[0].uid);\r\n             var percent = event.percentComplete;\r\n\r\n             $(\".k-progress\", $file).css({\r\n                 width: percent + \"%\"\r\n             });\r\n\r\n             $(\".k-upload-pct\", $file).removeClass(\"k-icon k-loading\").text(percent + \"%\");\r\n\r\n             if (percent === 100){ $(\".k-upload-action .k-icon\", $file).hide(); }\r\n         },\r\n\r\n         _onShowUploadNotifier: function (event) {\r\n\r\n             var that = this,\r\n                files = event.files,\r\n                template = that.options.template;\r\n\r\n             that.loadNotifier.content(template.render({ files: files }));\r\n             that.loadNotifier.wrapper.css({\r\n                 top: \"auto\",\r\n                 left: \"auto\",\r\n                 bottom: \"1em\",\r\n                 right: \"1em\"\r\n             });\r\n\r\n             that.loadNotifier.open();\r\n         },\r\n\r\n        _showNotificationCompleteUpload: function(wrapperMessage, auxNumberFilesSuccess){\r\n            var that = this;\r\n            if( wrapperMessage.find(\"li.k-file-success\").length === auxNumberFilesSuccess && wrapperMessage.find(\"li.k-file-error\").length === 0)\r\n            {\r\n                that._autoHideMessage(wrapperMessage);\r\n            }\r\n        },\r\n\r\n         _autoHideMessage: function(wrapperMessage){\r\n             var that = this;\r\n             setTimeout(function(){\r\n                 wrapperMessage.fadeOut(function(){\r\n                     that.loadNotifier.close();\r\n                 });\r\n             }, 2000);\r\n         },\r\n\r\n         _onCancelFile: function ($target) {\r\n             var that = this,\r\n                 $fileWrapper = $target.closest(\"li\"),\r\n                 $uploadWrapper = that.upload.wrapper,\r\n                 guid = $fileWrapper.data(\"guid\");\r\n\r\n             $uploadWrapper.find(\"li[data-uid=\" + guid + \"] .k-upload-action\").trigger(\"click\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRemoveFile: function ($target) {\r\n             var $fileWrapper = $target.closest(\"li\");\r\n             $fileWrapper.remove();\r\n         },\r\n\r\n         _onRetryFile: function ($target) {\r\n             var that = this;\r\n             var $file = $target.closest(\"li\");\r\n             var guid = $file.data(\"guid\");\r\n             var file = $.grep(that._fileList, function (i) {\r\n                 return i.uid === guid;\r\n             });\r\n\r\n             that.options.retry(file[0]);\r\n         },\r\n\r\n         onErrorFile: function (event) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             file = event.files[0],\r\n             validation = that._isValidFile(file);\r\n             var message = (validation.message !== \"\") ? validation.message : localization.errorUpload;\r\n\r\n             that.setStatus(\"ERROR\", file.uid, message);\r\n         },\r\n\r\n         _isValidFile: function (file) {\r\n\r\n             var that = this,\r\n             localization = that.options.localization,\r\n             valid = true,\r\n             message = \"\";\r\n\r\n             if (file.size > that._uploadMaxFilesSize || file.size == undefined || file.size == 0 ) {\r\n                 message = localization.errorSize;\r\n                 valid = false;\r\n             }\r\n\r\n             if(!that._onlyValidateServerFileExtension){\r\n                 if ($.inArray(file.extension, that._supportFileExt) === -1) {\r\n                     message = localization.errorSecurity;\r\n                     valid = false;\r\n                 }\r\n             }\r\n\r\n             return {\r\n                 valid: valid,\r\n                 message: message\r\n             };\r\n         },\r\n\r\n         _filterMaxFilesSize: function (event) {\r\n            \r\n            var that = this;\r\n            var total = 0;\r\n\r\n            for (var i = 0, length = event.files.length; i < length; i++){\r\n                total += event.files[i].size;\r\n            }\r\n            if (total > that._maxFilesSize) {\r\n                that._notifySizeExceeded();\r\n                event.preventDefault();\r\n            } else {\r\n                that._onShowUploadNotifier(event);\r\n            }\r\n         },\r\n\r\n         _notifySizeExceeded: function(){\r\n         \r\n             var that = this;\r\n\r\n             that.notification.show(that.options.localization.errorMaxFilesSize, \"error\");\r\n         },\r\n\r\n         _getFileItemByUID: function (uid) {\r\n             var that = this;\r\n             return $(\"li[data-guid=\" + uid + \"]\", that.loadNotifier.element);\r\n         },\r\n\r\n         _switchEvents: function (event) {\r\n             var that = this;\r\n             var $target = $(\".k-icon\", event.currentTarget);\r\n             if ($target.hasClass(\"k-update\") || $target.hasClass(\"k-remove\")) {\r\n                 that._onRemoveFile($target);\r\n             } else if ($target.hasClass(\"k-retry\")) {\r\n                 that._onRetryFile($target);\r\n             } else if ($target.hasClass(\"k-cancel\")) {\r\n                 that._onCancelFile($target);\r\n             }\r\n         },\r\n\r\n         _eventsHandler: function () {\r\n             var that = this;\r\n\r\n             that.loadNotifier.element.on(\"click\", \"button.k-upload-action\", function (event) {\r\n                 that._switchEvents(event);\r\n             });\r\n         },\r\n\r\n         cancelFilesUpload: function(){\r\n             var that = this;\r\n             var $uploadWrapper = that.upload.wrapper;\r\n\r\n             $uploadWrapper.find(\"li .k-upload-action\").trigger(\"click\");\r\n             that.close();\r\n         },\r\n\r\n         close: function () {\r\n             this.loadNotifier.close();\r\n         },\r\n\r\n         destroy: function () {\r\n             this.loadNotifier.destroy();\r\n             this.upload.destroy();\r\n         },\r\n\r\n         setStatus: function (status, uid, message) {\r\n\r\n             var $file = this._getFileItemByUID(uid),\r\n                 localization = this.options.localization;\r\n\r\n             switch (status) {\r\n                 case \"SUCCESS\":\r\n                     $file.removeClass(\"k-file-progress k-file-error\").addClass(\"k-file-success\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-i-refresh k-retry\").addClass(\"k-update\").prop(\"title\", localization.close).show();\r\n                     $(\".k-errormsg\", $file).text(\"\");\r\n                     break;\r\n                 case \"ERROR\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-i-refresh k-retry\").addClass(\"k-remove\").show();\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-icon k-warning\");\r\n                     $(\".k-errormsg\", $file).text(message).prop(\"title\", message);\r\n                     break;\r\n                 case \"RETRY\":\r\n                     $file.removeClass(\"k-file-progress\").addClass(\"k-file-error\");\r\n                     $(\".k-upload-status .k-upload-pct\", $file).removeClass(\"k-upload-pct k-loading\").addClass(\"k-warning\").text(\"\");\r\n                     $(\".k-upload-action .k-icon\", $file).removeClass(\"k-cancel k-remove\").addClass(\"k-i-refresh k-retry\").prop(\"title\", localization.retry).show();\r\n                     $(\".k-errormsg\", $file).text(localization.errorUpload).prop(\"title\", localization.errorUploadiis);\r\n                     break;\r\n             }\r\n         }\r\n\r\n     });\r\n\r\n     ui.plugin(ProjectAttachments);\r\n })(jQuery);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Files Controller\r\n *   Author: David Romero Estrada\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.files\", {}, {\r\n    /**\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.plugins = {};\r\n        self.prefixBase64 = \"data:image/png;base64,\";\r\n        self.usersData = {};\r\n        self.currentFilesList = [];\r\n        self.fileDateInterval;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-files\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-wrapper\"),\r\n            \"project-files-uploaditem\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-uploaditem\"),\r\n            \"project-files-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.files\").concat(\"#project-files-list\"),\r\n            \"project-attachments\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.attachments\").concat(\"#project-attachments\")\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var templateHomeFiles = self.getTemplate(\"project-files\");\r\n        self.content = templateHomeFiles.render({ isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers) });\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n    * Post render and links events with handlers\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n        $.when(self.renderFilesList()).done(function () {\r\n            self.plugins[\"uploadFiles\"] = self.initializeUploadFiles();\r\n            self.eventsHandler();\r\n            self.restrictedEventsHandler();\r\n        });\r\n    },\r\n\r\n    /**\r\n    *   Render Files List\r\n    */\r\n    renderFilesList: function () {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        var filesLength = self.currentFilesList.length;\r\n        var params = {\r\n            globalParent: encodeURIComponent(self.radNumber),\r\n            dateTime: (!filesLength) ? self.getDateServer() : self.currentFilesList[filesLength - 1].date,\r\n            count: 12\r\n        };\r\n        if(self.params.flowContext ===\"FLOW-DECONTEXTUALIZED-PLANS\"){\r\n            params.globalParent = self.params.plan.id;\r\n        }\r\n        $.when(self.dataService.getFilesListByRadNumber(params)).done(function (files) {\r\n            self.currentFilesList = self.currentFilesList.concat(files);\r\n\r\n            self.renderFiles(files);\r\n\r\n            defer.resolve();\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n    * Render Files\r\n    */\r\n    renderFiles: function(files) {\r\n        \r\n        var self = this;\r\n\r\n        var $content = self.getContent();\r\n        var $showMoreWrapper = $(\"#project-files-showmore\", $content);\r\n        self.displayFileList(files, \"append\");\r\n        self.updateRelativeTime();\r\n\r\n        if (files.length) {\r\n            self.setAdditionalData(files);\r\n        }\r\n\r\n        if (self.currentFilesList.length >= 12) {\r\n            $showMoreWrapper.show();\r\n\r\n            if (files.length < 12) {\r\n                $(\"button\", $showMoreWrapper).remove();\r\n                $(\"#project-files-nomore\", $showMoreWrapper).show();\r\n            }\r\n        }\r\n\r\n        self.notifyFilesNumber(false);\r\n    },\r\n\r\n    /**\r\n    * Render no files\r\n    */\r\n    renderNoFiles: function(){\r\n        \r\n        var self = this;\r\n        var noFilesTmpl = self.workportalFacade.getTemplate(\"info-message\");\r\n        var message = self.resources.getResource(\"workportal-project-files-noavailable\");\r\n\r\n       /* self.disableSideBar();*/\r\n\r\n        var $noFiles = $.tmpl(noFilesTmpl, {\r\n            message: message\r\n        });\r\n\r\n        self.content.html($noFiles);\r\n    },\r\n\r\n    /**\r\n    * Initialize upload files\r\n    */\r\n    initializeUploadFiles: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        return $(\"#project-files-upload\", content).kendoProjectAttachments({\r\n            saveUrl: self.dataService.serviceLocator.getUrl(\"project-comments-uploadfiles\"),\r\n            template: self.getTemplate(\"project-attachments\"),\r\n            success: $.proxy(self.onSuccessFile, self),\r\n            upload: $.proxy(self.addFileData, self),\r\n            retry: $.proxy(self.onSaveFileData, self),\r\n            enabled: true,\r\n            extensions: self.supportFileExt,\r\n            maxSize: self.uploadMaxFilesSize\r\n        }).data(\"kendoProjectAttachments\");\r\n    },\r\n\r\n    /**\r\n    * Set Additional Data For Files\r\n    */\r\n    setAdditionalData: function (files) {\r\n\r\n        var self = this;\r\n        var thumbnails = [], users = [], guidsUsers = [];\r\n\r\n        for (var i = 0, length = files.length - 1; i <= length; i++) {\r\n            users.push(files[i].user);\r\n            guidsUsers.push(files[i].user);\r\n            thumbnails.push(files[i].attachment.guid);\r\n        }\r\n\r\n        self.setUserData(guidsUsers.join());\r\n        self.setThumbnails(thumbnails.join());\r\n    },\r\n\r\n    /**\r\n    * Set User Data\r\n    */\r\n    setUserData: function (users) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        var params = {\r\n            usersGuids: users,\r\n            width: 50,\r\n            height: 50\r\n        };\r\n\r\n        $.when(self.dataService.getUsersData(params)).done(function (users) {\r\n            for (var i = 0, length = users.length - 1; i <= length; i++) {\r\n                if(users[i].picture){\r\n                    users[i].picture = self.prefixBase64 + users[i].picture;\r\n                }\r\n                self.usersData[\"id\" + users[i].id] = users[i];\r\n                $(\"#project-files-list .ui-bizagi-wp-project-files-user[data-userId=\" + users[i].id + \"]\", $content).text(users[i].name);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Get file list \r\n    */\r\n    getFileInfoByGuid: function (guid) {\r\n        var self = this;\r\n        var file;\r\n        for (var i = 0, length = self.currentFilesList.length; i < length; i++) {\r\n\r\n            if (guid === self.currentFilesList[i].guid) {\r\n                file = self.currentFilesList[i];\r\n                i = length;\r\n            }\r\n        }\r\n        return file;\r\n    },\r\n\r\n    /**\r\n    * Set Thumbnails\r\n    */\r\n    setThumbnails: function (thumbnails) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        var params = {\r\n            guids: thumbnails,\r\n            width: 480,\r\n            height: 150\r\n        };\r\n\r\n        $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\r\n            var thumbnail, $wrapper, $img;\r\n\r\n            $.each(files, function (guid, src) {\r\n                guid = guid.toLowerCase();\r\n                thumbnail = self.prefixBase64 + src;\r\n                $wrapper = $(\"#project-files-list .ui-bizagi-wp-project-files-wrapitem[data-attchGuid=\" + guid + \"]\", $content);\r\n                $img = $(\".ui-bizagi-wp-project-files-thumbnail\", $wrapper);\r\n\r\n                $img.prop(\"src\", thumbnail);\r\n                $(\".ui-bizagi-wp-project-files-icon\", $wrapper).remove();\r\n                $img.css(\"display\", \"block\");\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Set Preview\r\n    */\r\n    setFilePreview: function ($target, guidAttch, guidFile) {\r\n\r\n        var self = this;\r\n        var img = \"\";\r\n        var params = {\r\n            guids: [guidAttch].join(),\r\n            width: 500,\r\n            height: 500\r\n        };\r\n\r\n        $.when(self.dataService.getFilesThumbnails(params)).done(function (files) {\r\n            var $userTag = $target.find(\".ui-bizagi-wp-project-files-user\");\r\n            var userId = $userTag.data(\"userid\");\r\n\r\n            $.each(files, function (guid, src) {\r\n                img = self.prefixBase64 + src;\r\n            });\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"FILEPREVIEW\",\r\n                args: {\r\n                    radNumber: encodeURIComponent(self.radNumber),\r\n                    fileData: self.getFileInfoByGuid(guidFile),\r\n                    userData: self.usersData[\"id\" + userId],\r\n                    isOpen: !bizagi.util.parseBoolean(self.params.isClosedForAllUsers),\r\n                    img: img\r\n                }\r\n            });\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"OPEN_RIGHT_SIDEBAR\"\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n    *  On Success File\r\n    */\r\n    onSuccessFile: function (event) {\r\n\r\n        var self = this;\r\n        var status = (event.XMLHttpRequest.response) ? JSON.parse(event.XMLHttpRequest.response) : {};\r\n\r\n        if (!status.error) {\r\n            self.onSaveFileData(event.files[0]);\r\n        } else {\r\n            self.plugins[\"uploadFiles\"].onErrorFile(event);\r\n        }\r\n    },\r\n\r\n    /**\r\n    * On Save File Data\r\n    */\r\n    onSaveFileData: function (file) {\r\n\r\n        var self = this;\r\n\r\n        $.when(self.saveFileData(file)).done(function () {\r\n            self.notifyFilesNumber();\r\n            self.plugins[\"uploadFiles\"].setStatus(\"SUCCESS\", file.uid);\r\n        }).fail(function () {\r\n            self.plugins[\"uploadFiles\"].setStatus(\"RETRY\", file.uid);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Retry file\r\n     * @param $target\r\n     */\r\n    onRetryFile: function ($target) {\r\n        var self = this;\r\n        var $file = $target.closest(\"li\");\r\n        var guid = $file.data(\"guid\");\r\n\r\n        var file = $.grep(self.currentFilesList, function (i) {\r\n            return i.uid === guid;\r\n        });\r\n\r\n        self.onSaveFileData($file, file[0]);\r\n    },\r\n\r\n    /**\r\n     * Add Guid to Files Data\r\n     * @param event\r\n     */\r\n    addFileData: function (event) {\r\n        var self = this;\r\n\r\n        //add guid to send\r\n        event.data = {\r\n            guid: event.files[0].uid\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Save Files\r\n     * @param file\r\n     * @return {*}\r\n     */\r\n    saveFileData: function (file) {\r\n\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n\r\n        var guid = Math.guid();\r\n        var globalParent = self.radNumber ? self.radNumber.toString() : \"\";\r\n        if (self.params.flowContext === \"FLOW-DECONTEXTUALIZED-PLANS\") {\r\n            globalParent = self.params.plan.id;\r\n        }\r\n\r\n        var params = {\r\n            \"content\": {\r\n                \"guid\": guid,\r\n                \"description\": \"\",\r\n                \"name\": file.name,\r\n                \"attachment\": {\r\n                    \"guid\": file.uid,\r\n                    \"name\": file.name\r\n                },\r\n                \"date\": self.getDateServer(),\r\n                \"user\": bizagi.currentUser.idUser,\r\n                \"globalParent\": globalParent\r\n            },\r\n            \"attachmentsToCreate\": [\r\n                file.uid\r\n            ]\r\n        };\r\n\r\n        self.currentFilesList.unshift(file);\r\n\r\n        $.when(self.dataService.createProjectFile(params)).always(function (response) {\r\n            if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n\r\n                //extend file data\r\n                $.extend(file, {\r\n                    user: bizagi.currentUser.idUser,\r\n                    userName: bizagi.currentUser.userName,\r\n                    date: new Date().getTime(),\r\n                    attachment: params.content.attachment,\r\n                    guid: params.content.guid,\r\n                    description: params.content.description\r\n                });\r\n\r\n                self.usersData[\"id\" + bizagi.currentUser.idUser] = {\r\n                    picture: bizagi.currentUser.photo,\r\n                    name: bizagi.currentUser.userName,\r\n                    id: bizagi.currentUser.idUser\r\n                };\r\n\r\n                self.displayFileList(file, \"prepend\");\r\n\r\n                self.updateRelativeTime();\r\n                self.setThumbnails(file.uid);\r\n\r\n                defer.resolve();\r\n            } else {\r\n\r\n                defer.reject();\r\n            }\r\n        });\r\n\r\n        return defer;\r\n    },\r\n\r\n    /**\r\n     * Display File List\r\n     * @param files\r\n     * @param action\r\n     */\r\n    displayFileList: function (files, action) {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"project-files-list\");\r\n        var files = files || self.currentFilesList;\r\n        var content = self.getContent();\r\n        var $filesList = tmpl.render({\r\n            files: files\r\n        });\r\n\r\n        $(\"#project-files-list\", content)[action]($filesList);\r\n        $.equalizeHeights(\".bz-card\");\r\n    },\r\n\r\n    /**\r\n     * Delete file\r\n     * @param event\r\n     * @param params\r\n     */\r\n    deleteFile: function(event, params){\r\n        var self = this;\r\n\r\n        var content = self.getContent();\r\n        $(\"div[data-fileguid='\" + params.args.guid + \"']\", content).remove();\r\n\r\n        self.currentFilesList = self.currentFilesList.filter(function( file ) {\r\n            return file.guid !== params.args.guid;\r\n        });\r\n\r\n        self.notifyFilesNumber(true);\r\n    },\r\n\r\n    /**\r\n     * Update File Data\r\n     * @param event\r\n     * @param params\r\n     */\r\n    updateFileData: function (event, params) {\r\n\r\n        var self = this;\r\n        var file = self.getFileInfoByGuid(params.args.guid);\r\n\r\n        file.description = params.args.description;\r\n    },\r\n\r\n    /**\r\n    * Update relative time\r\n    */\r\n    updateRelativeTime: function () {\r\n\r\n        var self = this;\r\n\r\n        if (self.fileDateInterval) clearInterval(self.fileDateInterval);\r\n\r\n        self.fileDateInterval = setInterval($.proxy(self.changeRelativeTime, self), \"7000\");\r\n    },\r\n\r\n    /**\r\n    * Change Relative Time\r\n    */\r\n    changeRelativeTime: function () {\r\n\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        $(\"#project-files-list .ui-bizagi-wp-project-files-date\", $content).each(function (i, item) {\r\n            var dateTime = $(item).data(\"date\");\r\n            var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(dateTime), null, false);\r\n\r\n            $(item).text(relativeTime);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Filter files by some criteria\r\n     * @param event\r\n     */\r\n    onSelectFiles: function (event) {\r\n\r\n        var self = this,\r\n            bannedFiles = [],\r\n            files = event.files;\r\n\r\n        for (var i = files.length - 1; i >= 0; i--) {\r\n\r\n            if (!self.isValidFile(files[i]).valid) {\r\n                var bannedFile = files.splice(i, i + 1);\r\n                bannedFiles.unshift(bannedFile[0]);\r\n            }\r\n        }\r\n\r\n        if (bannedFiles.length > 0) {\r\n            self.showFilesError(bannedFiles);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Reset widget\r\n     */\r\n    resetWidget: function () {\r\n\r\n        var self = this;\r\n        if(self.plugins[\"uploadFiles\"]){\r\n            self.plugins[\"uploadFiles\"].close();\r\n        }\r\n        self.currentFilesList = [];\r\n        clearInterval(self.fileDateInterval);\r\n    },\r\n\r\n    /**\r\n    * Switch Events\r\n    */\r\n    switchFilesEvents: function (event) {\r\n\r\n        event.stopPropagation();\r\n\r\n        var self = this;\r\n        \r\n        var $target = $(event.target),\r\n            $item = $target.closest(\".ui-bizagi-wp-project-files-wrapitem\");\r\n\r\n        if($item.length) {\r\n            \r\n            var guidAttch = $item.data(\"attchguid\"),\r\n                guidFile = $item.data(\"fileguid\");\r\n\r\n            if ($target.hasClass(\"ui-bizagi-wp-project-files-file\")) {\r\n                var fileName = $target.text();\r\n\r\n                self.dataService.getDownloadAttachment(guidAttch, fileName);\r\n            } else{\r\n                self.setFilePreview($item, guidAttch, guidFile);\r\n            }\r\n        \r\n        } else if ($target.parent().prop(\"id\") === \"project-files-showmore\") {\r\n            self.renderFilesList();\r\n        } else if ($target.prop(\"id\") !== \"project-files-upload\") {\r\n            self.notifyFilesNumber(true)\r\n        }\r\n         \r\n    },\r\n\r\n    /**\r\n     * Show number files to right sidebar\r\n     * @param mandatory\r\n     */\r\n    notifyFilesNumber: function(mandatory){\r\n        var self = this;\r\n\r\n        self.pub(\"notify\", {\r\n            type: \"SETFILESNUMBER\",\r\n            args: {\r\n                filesNumber: self.currentFilesList.length,\r\n                mandatory: mandatory\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Restricted Event Handler\r\n     */\r\n    restrictedEventsHandler: function(){\r\n        var self = this;\r\n        self.content.on(\"click\", $.proxy(self.switchFilesEvents, self));\r\n    },\r\n\r\n    /**\r\n    *  Events Handler\r\n    */\r\n    eventsHandler: function () {\r\n\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        self.sub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\r\n        self.sub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\r\n        self.sub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\r\n\r\n        $content.on(\"click\", $.proxy(self.switchFilesEvents, self));\r\n    },\r\n\r\n    /**\r\n    * Clean\r\n    */\r\n    clean: function(){\r\n        var self = this;\r\n        self.resetWidget();\r\n\r\n        self.unsub(\"changeProjectWidget\", $.proxy(self.resetWidget, self));\r\n        self.unsub(\"UPDATEFILE\", $.proxy(self.updateFileData, self));\r\n        self.unsub(\"DELETEFILE\", $.proxy(self.deleteFile, self));\r\n\r\n        for (var i in self.plugins) {\r\n            if (self.plugins[i])\r\n                self.plugins[i].destroy();\r\n        }\r\n\r\n        clearInterval(self.fileDateInterval);\r\n        self._super();\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.files\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.files], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project File Preview\r\n *   Author: David Romero Estrada\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.filesPreview\", {}, {\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, notifier, params) {\r\n        var self = this;\r\n\r\n        //Regional\r\n        self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n        self.dialogBox = {};\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n        self.notifier = notifier;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-filespreview-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-wrapper\"),\r\n            \"project-filespreview-preview\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-preview\"),\r\n            \"project-filespreview-popup\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-popup\"),\r\n            \"project-filespreview-thenumber\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.filesPreview\").concat(\"#project-filespreview-thenumber\")\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var generalTmpl = self.getTemplate(\"project-filespreview-wrapper\");\r\n\r\n        self.content = generalTmpl.render();\r\n\r\n        self.sub(\"SETFILESNUMBER\", $.proxy(self.setFilesNumber, self));\r\n\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n    * links events with handlers\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        self.plugins.fileEdition = self.initPluginPopupEdition();\r\n\r\n        self.form = {\r\n            description: $(\"#ui-bizagi-wp-project-filespreview-popup-description\", self.plugins.fileEdition),\r\n            image: $(\".ui-bizagi-wp-project-popupform-user-image\", self.plugins.fileEdition),\r\n            cancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", self.plugins.fileEdition),\r\n            edit: $(\"#ui-bizagi-wp-project-popupform-action-editfile\", self.plugins.fileEdition)\r\n        };\r\n\r\n        self.eventsHandler();\r\n    },\r\n\r\n    setFilesNumber: function (event, params) {\r\n        var self = this;\r\n        var parameters = params.args;\r\n\r\n        if ($.isEmptyObject(self.currentFile) || parameters.mandatory) {\r\n            var tmpl = self.getTemplate(\"project-filespreview-thenumber\");\r\n            var $filesNumber = tmpl.render({ filesNumber: parameters.filesNumber });\r\n            self.currentFile = {};\r\n            $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html($filesNumber);\r\n        }\r\n    },\r\n\r\n    initPluginPopupEdition: function () {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"project-filespreview-popup\");\r\n\r\n        self.dialogBox.formContent = tmpl.render();\r\n\r\n        return self.dialogBox.formContent;\r\n    },\r\n\r\n    showPreview: function (event, params) {\r\n        var self = this;\r\n        var template = self.getTemplate(\"project-filespreview-preview\");\r\n        self.currentFile = params.args;\r\n\r\n        var content = template.render($.extend(params.args,{idCurrentUser: bizagi.currentUser.idUser}));\r\n\r\n        $(\"#ui-bizagi-wp-project-filespreview-wrapper\", self.content).html(content);\r\n        self.applyMenu();\r\n    },\r\n\r\n    setEditionData: function () {\r\n        var self = this;\r\n        self.form.description.val(self.currentFile.fileData.description);\r\n        if(self.currentFile.userData.picture){\r\n            self.form.image.prop(\"src\", self.currentFile.userData.picture);\r\n        }\r\n    },\r\n\r\n    eventsHandler: function () {\r\n        var self = this;\r\n        self.form.cancel.on(\"click\", $.proxy(self.onResetFileForm, self));\r\n        self.form.edit.on(\"click\", $.proxy(self.onSaveEdition, self));\r\n        self.sub(\"FILEPREVIEW\", $.proxy(self.showPreview, self));\r\n    },\r\n\r\n    onSelectMenu: function (event, ui) {\r\n        var self = this;\r\n        if($(event.currentTarget).find(\"i\").length === 0){\r\n            var item = $(ui.item).data(\"item\");\r\n            switch (item) {\r\n                case \"edit\":\r\n                    self.onOpenEdition();\r\n                    break;\r\n                case \"delete\":\r\n                    self.onDeleteFile();\r\n                    break;\r\n                case \"download\":\r\n                    self.onDownloadFile();\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    onDownloadFile: function () {\r\n        var self = this;\r\n        self.dataService.getDownloadAttachment(self.currentFile.fileData.attachment.guid, self.currentFile.fileData.name);\r\n    },\r\n\r\n    onOpenEdition: function () {\r\n        var self = this;\r\n\r\n        self.dialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"650px\",\r\n            modal: true,\r\n            title: bizagi.localization.getResource(\"workportal-project-files-editfile\"),\r\n            maximize: true,\r\n            close: function () {\r\n                self.onResetFileForm();\r\n            }\r\n        });\r\n\r\n        self.setEditionData();\r\n        self.form.description.focus();\r\n    },\r\n\r\n    onDeleteFile: function(){\r\n        var self = this;\r\n        $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-file-querydelete\"), \"\", \"info\")).done(function () {\r\n            var params = {\r\n                content: {\r\n                    guid: self.currentFile.fileData.guid\r\n                },\r\n                attachmentsToDelete: [self.currentFile.fileData.attachment.guid]\r\n            };\r\n\r\n            $.when(self.dataService.deleteFile(params)).always(function (response) {\r\n                if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                    self.pub(\"notify\", {\r\n                        type: \"DELETEFILE\",\r\n                        args: {\r\n                            guid: params.content.guid\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    onSaveEdition: function () {\r\n        var self = this;\r\n        if (self.validateAddFileDescriptionForm(self.form.description)) {\r\n            self.currentFile.fileData.description = self.form.description.val();\r\n\r\n            var params = {\r\n                \"content\": {\r\n                    \"guid\": self.currentFile.fileData.guid,\r\n                    \"description\": self.currentFile.fileData.description,\r\n                    \"attachment\": self.currentFile.fileData.attachment,\r\n                    \"name\": self.currentFile.fileData.name,\r\n                    \"date\": self.currentFile.fileData.date,\r\n                    \"user\": bizagi.currentUser.idUser,\r\n                    \"globalParent\": self.currentFile.radNumber\r\n                }\r\n            };\r\n\r\n            $.when(self.dataService.updateProjectFile(params)).always(function (response) {\r\n                if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n                    $(\"#ui-bizagi-wp-project-filespreview-description\", self.content).text(params.content.description);\r\n\r\n                    self.onResetFileForm();\r\n                    self.notifier.showSucessMessage(\r\n                       printf(bizagi.localization.getResource(\"workportal-project-files-editionsuccess\"), \"\"));\r\n\r\n                    self.pub(\"notify\", {\r\n                        type: \"UPDATEFILE\",\r\n                        args: {\r\n                            description: params.content.description,\r\n                            guid: params.content.guid\r\n                        }\r\n                    });\r\n                } else {\r\n                    self.onResetFileForm();\r\n                    self.notifier.showErrorMessage(\r\n                       printf(bizagi.localization.getResource(\"workportal-general-error-generic\"), \"\"));\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    validateAddFileDescriptionForm: function($description){\r\n        var result = false,\r\n            $textAreadescription = $description ;\r\n        if($textAreadescription.val().trim() === \"\"){\r\n            var descriptionValidation = bizagi.localization.getResource(\"workportal-project-discussion-requireddescription\");\r\n            $textAreadescription.parent().next().find(\"span\").html(descriptionValidation);\r\n        }\r\n        else{\r\n            $textAreadescription.parent().next().find(\"span\").empty();\r\n            result = true;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    onResetFileForm: function () {\r\n        var self = this;\r\n        self.form.description.parent().next().find(\"span\").empty();\r\n        self.dialogBox.formContent.dialog(\"destroy\");\r\n        self.dialogBox.formContent.detach();\r\n    },\r\n\r\n    applyMenu: function () {\r\n        var self = this;\r\n\r\n        $(\".ui-bizagi-wp-project-filespreview-edit\", self.content).menu({\r\n            select: $.proxy(self.onSelectMenu, self)\r\n        }).removeClass(\"ui-widget-content\");\r\n    },\r\n\r\n    clean: function () {\r\n        var self = this;\r\n\r\n        self.plugins = {};\r\n        self.form = {};\r\n        self.currentFile = {};\r\n        self.filesNumber = 0;\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.filesPreview\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.filesPreview]);","/*\r\n *   Name: Bizagi Workportal project File Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.file.sidebar\", {}, {\r\n\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        params = params || {};\r\n        params.supportNav = false;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-file-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.file.sidebar\").concat(\"#project-file-sidebar\")\r\n        });\r\n\r\n    },\r\n\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_PROJECT_FILE_SIDEBAR;\r\n    },\r\n\r\n    /*\r\n    * Renders the template defined in the widget\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n\r\n        var template = self.getTemplate(\"project-file-sidebar\");\r\n        self.content = template.render({});\r\n\r\n        return self.content;\r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.file.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.file.sidebar], true);"]}