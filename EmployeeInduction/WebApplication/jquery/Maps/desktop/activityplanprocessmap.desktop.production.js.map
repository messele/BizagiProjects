{"version":3,"sources":["jquery/workportal/desktop/widget/project.plan.activity.sidebar/bizagi.workportal.desktop.widgets.project.plan.activity.sidebar.js","jquery/workportal/desktop/widget/project.plan.activity.action/bizagi.workportal.desktop.widgets.project.plan.activity.action.js","jquery/workportal/desktop/widget/project.plan.activity.time/bizagi.workportal.desktop.widgets.project.plan.activity.time.js","jquery/workportal/desktop/widget/project.plan.activity.progress/bizagi.workportal.desktop.widgets.project.plan.activity.progress.js","jquery/workportal/desktop/widget/project.plan.activity.subprocesses/bizagi.workportal.desktop.widgets.project.plan.activity.subprocesses.js","jquery/workportal/desktop/widget/project.plan.activity.parent/bizagi.workportal.desktop.widgets.project.plan.activity.parent.js","jquery/workportal/desktop/widget/project.plan.activity.users/bizagi.workportal.desktop.widgets.project.plan.activity.users.js","jquery/workportal/desktop/widget/project.dashboard.menu.activity.plan/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.plan.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.processMap/bizagi.workportal.desktop.widgets.project.processMap.js","jquery/workportal/desktop/widget/project.processMap/bizagi.workportal.desktop.widgets.project.processDiagram.helper.js","jquery/workportal/desktop/widget/project.activity.sidebar/bizagi.workportal.desktop.widgets.project.activity.sidebar.js","jquery/workportal/desktop/widget/project.activityMap/bizagi.workportal.desktop.widgets.project.activityMap.js","jquery/workportal/desktop/widget/project.processMap/bizagi.workportal.desktop.widgets.project.activityMap.tooltip.js"],"names":["bizagi","workportal","widgets","project","base","extend","init","workportalFacade","dataService","serviceloadDataPlan","params","self","this","_super","loadTemplates","project-plan-activity-sidebar","getTemplate","concat","renderContent","template","content","render","postRender","sub","$","proxy","onNotifyLoadInfoPlan","event","parans","plan","idActivitySelected","idPlan","id","loadData","getDateServer","subscribe","loadedWithDataActivities","loadedWithDataFirstParent","showContextByMenuDashboard","pub","type","args","clean","unsubscribe","injector","register","activity","sidebar","notifier","dateFormat","localization","getResource","timeFormat","estimatedFinishDateTime","beforeUserAssignedActivity","activity-action-main","activity-action-editionpopup","dialogBox","onNotifyLoadInfoActivityExecution","onNotifyExpandedRightSidebar","$content","getContent","empty","currentActivity","activities","filter","toUpperCase","idUserCreator","currentUser","idUser","userAssigned","argsTemplate","currentActivityName","name","showEditAction","tmpl","append","initilizeActionMenu","initializeTempleteAndEvents","plugins","activityEdition","initPluginPopupEdition","formEditActivity","assignee","date","duration","buttonCancel","buttonUpdate","on","onClickPopupButtonCancel","onClickPopupButtonUpdate","onDeleteDate","onTypeDuration","menu","select","onSelectMenu","removeClass","popupEditActivity","formContent","initializeAutoComplete","element","url","serviceLocator","getUrl","autocomplete","minLength","source","request","response","ajax","data","domain","userName","fullName","term","organization","pag","pagSize","orderField","success","map","users","item","label","user","value","ui","val","IdAssignee","focus","change","initializeDatePicker","datepicker","onSelect","getTime","undefined","util","dateFormatter","getDateFormatByDatePickerJqueryUI","initializeSpiner","desactivateDateByDuration","newValue","target","isNumeric","parseInt","spinner","min","max","placeHolder","spin","keyCode","fieldDurationActive","activateElement","form","currentTarget","find","length","onClickOpenPopupEdition","dialog","resizable","draggable","height","width","modal","title","maximize","open","onOpenPopupEdition","close","onClosePopupEdition","activityDate","isEmpty","estimatedFinishDate","isNaN","formatInvariant","Date","getDateFromInvariant","isMinimumDate","setUserAssignedById","removePopupWidgets","callGetDataUsers","then","responseUsers","preventDefault","next","html","remove","validateParamsOfFormEditActivity","idUserAssigned","updateActivity","progress","startDate","allowEdition","description","finishDate","items","when","editActivityPlan","done","refreshAllWidgets","showSucessMessage","onClickFavorite","favoriteOptions","hasClass","idObject","idCase","favoriteType","addFavorite","favoritesData","guidFavorite","idFavorites","addClass","delFavorite","unsub","messageValidationField","replace","toLowerCase","csvIdUsers","defer","Deferred","userIds","getUsersData","always","resolve","promise","action","widget","EXECUTING_ACTIVITY","FINISHED_ACTIVITY","datePickerRegional","plan-time-main","onNotifyLoadInfoActivitySummary","getStateActivity","time","fromDate","getFormattedDate","getFirstDate","dataProgressWidget","getDataByScenarios","unitTime","auxUnitTime","updateWidget","contentTemplate","relativeTime","getRelativeTime","now","minutes","messageDescripionDifference","keywordResource","messageTime","appendTo","$barRemainingDate","widthNumberDays","css","toString","percentBar","currentState","colorBar","getColorByCreatedAndEstimatedDate","toDate","callGetEffectiveDuration","getColorBar","getPercentBar","getKeywordResourceDescriptionBar","getUnitTime","getUTCDate","dateObj","monthNames","getMonth","formatDate","d","getEffectiveDuration","plan-progress-main","plan-progress-popup-edit","onNotifyUpdateItemFromRender","activityToShow","valuePercentBarComplete","canEdit","popupEditProgress","initPluginPopupEditProgress","formEditProgress","sliderProgress","slider","orientation","range","from","to","step","slide","onChangesliderProgress","each","vals","i","el","numericTextBoxPlugin","format","onChangeNumericTextBoxProgress","decimals","buttonChangeProgress","onShowPopupEditProgress","onClickCancel","onSubmitFormChangeProgress","updateProgressUI","listItems","activityWork","hide","show","text","newPercentProgress","templatePopupEditProgress","onOpenPopupPlan","detach","previusValueProgress","prop","project-subprocesses","project-subprocesses-tootip-custom-properties","subprocesses","plan-parent-main","getPlanParent","planParent","parent","idParent","radNumber","nameParent","displayName","idWorkflow","idWorkItem","idTask","onClickGoToParentCase","routingExecute","closest","usersMap","usersInformation","globalHandlersService","get","usersAssignees","plan-users-main","activityRuning","cvsGuidUsers","activitiesUsers","ownerUserId","ownerUserGuid","push","guidUser","userType","picture","guid","index","userId","userGuid","userAssignedGuid","inArray","justAssignees","addEventHandlersModal","showCreatorInformation","renderUserProfilesAndImages","allUsers","usersAssignee","isOwner","indexOf","isAssignee","usersAdapter","createJsonUserInfo","userCreator","userInfo","username","email","getInitials","userinformation","obj","$li","console","log","not","ev","userSelected","$target","usersActivities","userParam","getIsAssignee","getIsOwner","usertooltip","usersGuids","join","getUsersAssignees","getUserAssignee","tasks","types","actUser","click","stopPropagation","publish","widgetName","BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL","closeVisible","modalParameters","refreshInbox","project-dashboard-menu","contextsLeftSidebarCaseDashboard","forEach","context","updateView","showFormOverview","menuDashboard","showFormActivity","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","showPlanOptionMenu","contextPlanOptionMenu","contextFormActivityOptionMenu","contextualized","siblings","handlerEvents","paramsGetPlan","callGetPlan","responsePlan","loadContentById","$item","autoSave","document","getLevelNavigator","newLevelNavigator","refreshLastItemBreadcrumb","histName","level","getPlan","status","reject","subMenuHandler","$comments","$files","$timeline","toggle","off","dashboard","project-content-dashboard","setTimeout","window","trigger","instanceBizagiProcessMap","processMap","project-processmap","project-process-diagram","project-activity-map","project-subprocess","viewOptions","configureHandlers","onProcessDiagram","onActivityMap","onSupprocess","navigationManager","container","renderProcessDiagram","resize","renderActivityMap","renderSubProcessMap","appendActivityMapZoom","appendProcessMapZoom","appendSubprocessZoom","appendSubprocessDragScroll","bindTooltip","tooltipParams","graphicquery","getPVHeight","defaultHeight","canvasPst","$header","supportNav","project-activity-sidebar","project-activityMap","actualState","state","activityMap","project-tooltip","cache","gqData","onProcess","onIdCase","showGraphicQuery","idWorkitem","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","tooltipClass","$container","tooltip","callback","diagram","is","className","baseVal","getActivityMapTooltipContent","getSubprocessTooltipContent","effect","delay","position","my","hover","stop","fadeTo","fadeOut","$ui","def","guidWorkitem","isCached","buildContent","getActivitySummary","appendToCache","endDate","process","graphicQuery","menuSecurity","GraphicQuery","formatInvariantDate"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal Project Activity Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activity.sidebar\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, serviceloadDataPlan, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.serviceloadDataPlan = serviceloadDataPlan;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-plan-activity-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.sidebar\").concat(\"#project-plan-activity-sidebar\")\r\n      });\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-plan-activity-sidebar\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_PLAN\", $.proxy(self.onNotifyLoadInfoPlan, self));\r\n   },\r\n\r\n    onNotifyLoadInfoPlan: function (event, parans) {\r\n        var self = this;\r\n        if (self.params.plan.idActivitySelected) {\r\n\r\n            var params = {idPlan: self.params.plan.id};\r\n            self.serviceloadDataPlan.loadData(params, self.getDateServer, self.params);\r\n            self.serviceloadDataPlan.subscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n            self.serviceloadDataPlan.subscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n        }\r\n        else {\r\n            if (self.params.showContextByMenuDashboard === \"ACTIVITYPLANPROCESSMAP\" ||\r\n                    self.params.showContextByMenuDashboard === \"ACTIVITYPLANLOG\") {\r\n                self.pub(\"notify\", {\r\n                    type: \"DISABLED_RIGHT_SIDEBAR\"\r\n                });\r\n            }\r\n        }\r\n    },\r\n\r\n    loadedWithDataActivities: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOADED_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PROGRESS_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_ACTIVITY_SUMMARY\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    loadedWithDataFirstParent: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    clean: function(){\r\n        var self = this;\r\n        if(self.serviceloadDataPlan){\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n        }\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.sidebar\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.loadDataPlan\", bizagi.workportal.widgets.project.plan.activity.sidebar], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Action\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activity.action\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, notifier, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.dateFormat = bizagi.localization.getResource(\"dateFormat\");\r\n      self.timeFormat = bizagi.localization.getResource(\"timeFormat\");\r\n      self.estimatedFinishDateTime; //Save complete date and time, because datepicker dont save time\r\n\r\n      self.beforeUserAssignedActivity = \"\";\r\n       self.notifier = notifier;\r\n\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"activity-action-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.action\").concat(\"#project-plan-activity-action\"),\r\n         \"activity-action-editionpopup\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.action\").concat(\"#project-plan-activity-action-editionpopup\")\r\n      });\r\n\r\n      self.dialogBox = {};\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @returns {*|jQuery|HTMLElement}\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.sub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      var $content = self.getContent().empty();\r\n\r\n      var currentActivity = {};\r\n      if(self.params.plan.idActivitySelected){\r\n         currentActivity = self.params.plan.activities.filter(function(activity){\r\n            return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n         })[0];\r\n      }\r\n\r\n      if(self.params.plan.idUserCreator === bizagi.currentUser.idUser || currentActivity.userAssigned == bizagi.currentUser.idUser){\r\n\r\n         var argsTemplate = {};\r\n         argsTemplate.currentActivityName = currentActivity.name;\r\n         argsTemplate.showEditAction = true;\r\n         if(self.params.plan.idUserCreator !== bizagi.currentUser.idUser){\r\n             argsTemplate.showEditAction = false;\r\n         }\r\n\r\n         var tmpl = self.getTemplate(\"activity-action-main\");\r\n         $content.append(tmpl.render(argsTemplate));\r\n\r\n         if(argsTemplate.showEditAction){\r\n             self.initilizeActionMenu();\r\n             self.beforeUserAssignedActivity = currentActivity.userAssigned;\r\n             self.content.append($content);\r\n            self.initializeTempleteAndEvents();\r\n         }\r\n      }\r\n   },\r\n\r\n   initializeTempleteAndEvents: function (){\r\n        var self = this;\r\n        self.plugins = {}; \r\n        self.plugins.activityEdition = self.initPluginPopupEdition();\r\n\r\n        self.formEditActivity = {\r\n            assignee: $(\"#activity-form-assignee\", self.plugins.activityEdition),\r\n            date: $(\"#activity-form-date\", self.plugins.activityEdition),\r\n            duration:  $(\"#activity-form-duration\",self.plugins.activityEdition),\r\n            buttonCancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", self.plugins.activityEdition),\r\n            buttonUpdate: $(\"#ui-bizagi-wp-project-popupform-action-update\", self.plugins.activityEdition)\r\n        };\r\n\r\n        self.formEditActivity.buttonCancel.on(\"click\", $.proxy(self.onClickPopupButtonCancel, self));\r\n        self.formEditActivity.buttonUpdate.on(\"click\", $.proxy(self.onClickPopupButtonUpdate, self));\r\n\r\n        self.formEditActivity.date.on(\"keydown\", $.proxy(self.onDeleteDate, self));\r\n        self.formEditActivity.duration.on(\"keyup\", $.proxy(self.onTypeDuration, self));\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   onNotifyExpandedRightSidebar: function(){\r\n      var self = this;\r\n      self.initilizeActionMenu();\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   initilizeActionMenu: function () {\r\n      var self = this;\r\n      $(\"#ui-bizagi-wp-project-plan-activity-action .menu\", self.content).menu({\r\n         select: $.proxy(self.onSelectMenu, self)\r\n      }).removeClass(\"ui-widget-content\");\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @returns dialogBox.formContent\r\n    */\r\n   initPluginPopupEdition: function () {\r\n      var self = this;\r\n      var popupEditActivity = self.getTemplate(\"activity-action-editionpopup\");\r\n      self.dialogBox.formContent = popupEditActivity.render({});\r\n      return self.dialogBox.formContent;\r\n\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeAutoComplete: function (element) {\r\n        var self = this;\r\n        var url = self.dataService.serviceLocator.getUrl(\"admin-getUsersList\");\r\n\r\n        element.autocomplete({\r\n            minLength: 2,\r\n            source: function (request, response) {\r\n                $.ajax({\r\n                    url: url,\r\n                    data: {\r\n                        domain: \"\",\r\n                        userName: \"\",\r\n                        fullName: request.term,\r\n                        organization: \"\",\r\n                        pag: 1,\r\n                        pagSize: 100,\r\n                        orderField: \"fullName\"\r\n                    },\r\n                    success: function (data) {\r\n                        response($.map(data.users, function (item) {\r\n                            return {\r\n                                label: item.user,\r\n                                value: item.idUser\r\n                            };\r\n                        }));\r\n                    }\r\n                });\r\n            },\r\n            select: function (event, ui) {\r\n                var name = ui.item.label;\r\n                element.val(name);\r\n                self.formEditActivity.IdAssignee = ui.item.value;\r\n                return false;\r\n            },\r\n            focus: function () {\r\n                return false;\r\n            },\r\n            change: function (event, ui){\r\n                if(ui.item === null){\r\n                    self.formEditActivity.IdAssignee = null;\r\n                    self.formEditActivity.assignee.val(\"\");\r\n                }\r\n                return false;\r\n            }\r\n\r\n        });\r\n\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeDatePicker: function (element) {\r\n        var self = this;\r\n        element.datepicker({\r\n            onSelect: function () {\r\n                self.formEditActivity.duration.val(\"\");\r\n                self.estimatedFinishDateTime = self.formEditActivity.date.datepicker(\"getDate\") ? self.formEditActivity.date.datepicker(\"getDate\").getTime() : undefined;\r\n            }\r\n        });\r\n        element.datepicker(\"option\", \"dateFormat\", bizagi.util.dateFormatter.getDateFormatByDatePickerJqueryUI());\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeSpiner: function (element) {\r\n        var self = this;\r\n        function desactivateDateByDuration(event, newValue){\r\n            var value = newValue || $(event.target).val();\r\n            if (bizagi.util.isNumeric(value) && parseInt(value, 10) > 0) {\r\n               self.formEditActivity.date.val(\"\");\r\n               self.estimatedFinishDateTime = undefined;\r\n            } else {\r\n               $(event.target).val(\"\");\r\n            }\r\n        }\r\n\r\n        element.spinner({\r\n            min: 1,\r\n            max: 1000,\r\n            placeHolder: bizagi.localization.getResource(\"workportal-hours\"),\r\n            change: function (event) {\r\n                desactivateDateByDuration(event);\r\n            },\r\n            spin: function( event, ui ) {\r\n                desactivateDateByDuration(event, ui.value);\r\n            }\r\n        });\r\n    },\r\n\r\n   /***\r\n    * Events\r\n    * @param event\r\n    */\r\n\r\n   onDeleteDate: function (event) {\r\n      var self = this;\r\n      if (event.keyCode === 8) {\r\n          $(event.target).val(\"\");\r\n          self.fieldDurationActive(true);\r\n      }\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param event\r\n    */\r\n   onTypeDuration: function (event) {\r\n      var self = this;\r\n      var $target = $(event.target);\r\n      if ($target.val() !== \"\") {\r\n          self.estimatedFinishDateTime = undefined;\r\n      } else {\r\n          self.activateElement(self.form.date);\r\n      }\r\n   },\r\n\r\n    /**\r\n     * When select menu\r\n     * @param event\r\n     * @param ui\r\n     */\r\n   onSelectMenu: function (event, ui) {\r\n      var self = this;\r\n      if($(event.currentTarget).find(\"i\").length === 0){\r\n         var item = $(ui.item).data(\"item\");\r\n         switch (item) {\r\n            case \"edit\":\r\n               self.onClickOpenPopupEdition();\r\n               break;\r\n         }\r\n      }\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   onClickOpenPopupEdition: function () {\r\n        var self = this;\r\n        self.initializeTempleteAndEvents();\r\n        self.dialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"600px\",\r\n            modal: true,\r\n            title: bizagi.localization.getResource(\"workportal-project-plan-title-activity-properties\"),\r\n            maximize: true,\r\n            open: $.proxy(self.onOpenPopupEdition, self),\r\n            close: $.proxy(self.onClosePopupEdition, self)\r\n        });\r\n   },\r\n\r\n    /**\r\n    *\r\n    */\r\n    onOpenPopupEdition: function () {\r\n        var self = this;\r\n        var currentActivity = self.params.plan.activities.filter(function(activity){\r\n            return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n        })[0];\r\n\r\n        var activityDate =  (currentActivity && !bizagi.util.isEmpty(currentActivity.estimatedFinishDate)) ? currentActivity.estimatedFinishDate: \"\";\r\n        if(!isNaN(activityDate)){\r\n            activityDate=bizagi.util.dateFormatter.formatInvariant(new Date(activityDate));\r\n        }\r\n        var estimatedFinishDate = activityDate ? bizagi.util.dateFormatter.getDateFromInvariant(activityDate): \"\";\r\n        var isMinimumDate = estimatedFinishDate instanceof Date ? estimatedFinishDate.getTime() < self.getDateServer() : false;\r\n\r\n        self.initializeAutoComplete(self.formEditActivity.assignee);\r\n        self.initializeDatePicker(self.formEditActivity.date);\r\n        self.initializeSpiner(self.formEditActivity.duration);\r\n\r\n        if (currentActivity.userAssigned) {\r\n            self.setUserAssignedById(currentActivity.userAssigned);\r\n        }\r\n\r\n        self.formEditActivity.date.datepicker(\"option\", \"minDate\", new Date(self.getDateServer()));\r\n\r\n        if (currentActivity.estimatedFinishDate && isMinimumDate) {\r\n            self.formEditActivity.date.datepicker(\"option\", \"minDate\", estimatedFinishDate);//set minimum because, if date is past\r\n        }\r\n\r\n        if (currentActivity.estimatedFinishDate) {\r\n            if (estimatedFinishDate){\r\n                self.formEditActivity.date.datepicker(\"setDate\", estimatedFinishDate);\r\n            }\r\n            self.estimatedFinishDateTime = currentActivity.estimatedFinishDate;\r\n        }\r\n\r\n        if (currentActivity.duration) {\r\n            self.formEditActivity.duration.val(parseInt(currentActivity.duration, 10));\r\n        }\r\n   },\r\n\r\n   /**\r\n    * When close popup edition\r\n    */\r\n   onClosePopupEdition: function(){\r\n      var self = this;\r\n      self.removePopupWidgets();\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param idUser\r\n    */\r\n    setUserAssignedById: function (idUser) {\r\n        var self = this;\r\n        //Show images users\r\n        self.callGetDataUsers(idUser).then(function (responseUsers) {\r\n            self.formEditActivity.assignee.val(responseUsers[0].name);\r\n        });\r\n        self.formEditActivity.IdAssignee = idUser;\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param event\r\n    */\r\n    onClickPopupButtonCancel: function(event){\r\n        var self = this;\r\n        event.preventDefault();\r\n        self.removePopupWidgets();\r\n    },\r\n\r\n    /**\r\n    * Remove popup widgets\r\n    */\r\n    removePopupWidgets: function(){\r\n        var self = this;\r\n        self.formEditActivity.assignee.next().find(\"span\").html(\"\");\r\n        self.dialogBox.formContent.remove();\r\n        $(\"#ui-datepicker-div\").remove();\r\n    },\r\n\r\n   /**\r\n    *  Triggered when click update plan activity\r\n    */\r\n    onClickPopupButtonUpdate: function () {\r\n        var self = this;\r\n        if(self.validateParamsOfFormEditActivity()){\r\n            var currentActivity = self.params.plan.activities.filter(function (activity) {\r\n                return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n            })[0];\r\n            var idUserAssigned =  self.formEditActivity.IdAssignee || bizagi.currentUser.idUser;\r\n            if(self.formEditActivity.duration.val()!=\"\"){\r\n                self.params.plan.activities.filter(function (activity) {\r\n                    return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n                })[0].estimatedFinishDate=\"\";\r\n            }\r\n            var updateActivity = {\r\n                progress: currentActivity.progress,\r\n                id: currentActivity.id,\r\n                startDate: currentActivity.startDate,\r\n                duration: self.formEditActivity.duration.val(),\r\n                userAssigned: idUserAssigned,\r\n                allowEdition: currentActivity.allowEdition,\r\n                description: currentActivity.description,\r\n                name: currentActivity.name,\r\n                idPlan: currentActivity.idPlan,\r\n                estimatedFinishDate: self.estimatedFinishDateTime,\r\n                finishDate: currentActivity.finishDate,\r\n                items: currentActivity.items\r\n            };\r\n            $.when(self.dataService.editActivityPlan(updateActivity)).done(function () {\r\n                currentActivity = $.extend(currentActivity, updateActivity);\r\n                self.removePopupWidgets();\r\n\r\n                if (self.beforeUserAssignedActivity !== self.formEditActivity.IdAssignee) {\r\n                    self.pub(\"notify\", {\r\n                        type: \"ACTIVITYPLANCOMMENTS\",\r\n                        args: $.extend(self.params, {refreshAllWidgets: true})\r\n                    });\r\n                }\r\n                else {\r\n                    self.pub(\"notify\", {\r\n                        type: self.params.showContextByMenuDashboard,\r\n                        args: self.params\r\n                    });\r\n                }\r\n\r\n                self.removePopupWidgets();\r\n                self.notifier.showSucessMessage(bizagi.localization.getResource(\"workportal-project-plan-activity-update-message\"));\r\n            });\r\n        }\r\n    },\r\n\r\n   /***\r\n    * Events\r\n    */\r\n   onClickFavorite: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n      var favoriteOptions = {};\r\n      if ($(event.target).hasClass(\"bz-icon-star-outline\")) {\r\n         favoriteOptions = {\r\n            idObject: self.params.idCase,\r\n            favoriteType: \"CASES\"\r\n         };\r\n         $.when(self.dataService.addFavorite(favoriteOptions)).done(function (favoritesData) {\r\n            self.params.guidFavorite = favoritesData.idFavorites;\r\n            $(event.target).removeClass(\"bz-icon-star-outline\");\r\n            $(event.target).addClass(\"bz-icon-star\");\r\n         });\r\n      }\r\n      else {\r\n         favoriteOptions = {\r\n            idObject: self.params.guidFavorite,\r\n            favoriteType: \"CASES\"\r\n         };\r\n         $.when(self.dataService.delFavorite(favoriteOptions)).done(function () {\r\n            $(event.target).addClass(\"bz-icon-star-outline\");\r\n            $(event.target).removeClass(\"bz-icon-star\");\r\n         });\r\n      }\r\n   },\r\n\r\n   /**\r\n    * Clean events and plugins\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      self.unsub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.unsub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n   },\r\n\r\n   /**\r\n    * Validate form edit plan activity\r\n    * @returns {boolean}\r\n    */\r\n    validateParamsOfFormEditActivity: function(){\r\n        var self = this;\r\n        var userAssigned = self.formEditActivity.assignee;\r\n        if (userAssigned.val() && userAssigned.val() !== \"\" && self.formEditActivity.IdAssignee) {\r\n            return true;\r\n        } else {\r\n            var messageValidationField = bizagi.localization.getResource(\"workportal-general-error-field-required\");\r\n            messageValidationField = messageValidationField.replace(\"{0}\", bizagi.localization.getResource(\"workportal-project-plan-assignee\").toLowerCase());\r\n            userAssigned.next().find(\"span\").html(messageValidationField);\r\n            return false;\r\n        }\r\n    },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n   callGetDataUsers: function (csvIdUsers) {\r\n      var self = this,\r\n         defer = $.Deferred();\r\n      var params = {\r\n         userIds: csvIdUsers,\r\n         width: 50,\r\n         height: 50\r\n      };\r\n\r\n      self.dataService.getUsersData(params).always(function (response) {\r\n         defer.resolve(response);\r\n      });\r\n      return defer.promise();\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.action\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.plan.activity.action]);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Time\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n/***\r\n * TODO IMPORTANT: This widget is development with TDD, test this file when changes\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.time\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    *\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Constants\r\n      self.EXECUTING_ACTIVITY = \"EXECUTING\";\r\n      self.FINISHED_ACTIVITY = \"FINISHED\";\r\n\r\n      //Regional\r\n      self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-time-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.time\").concat(\"#project-plan-activity-time\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivitySummary, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivitySummary: function(event, params){\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.getContent().empty();\r\n\r\n      var currentActivity = self.params.plan.activities.filter(function (activity) {\r\n         return activity.id === self.params.plan.idActivitySelected;\r\n      })[0];\r\n\r\n      if(currentActivity.startDate){\r\n         self.getStateActivity(currentActivity);\r\n\r\n         var argsTemplate = {\r\n            time: {\r\n               fromDate: self.getFormattedDate(new Date(self.getFirstDate(currentActivity)))\r\n            }\r\n         };\r\n         var dataProgressWidget = self.getDataByScenarios(currentActivity, true);\r\n\r\n         $.when(dataProgressWidget.unitTime).done(function(auxUnitTime){\r\n            dataProgressWidget = $.extend(dataProgressWidget, {\r\n               unitTime: auxUnitTime\r\n            });\r\n            self.updateWidget($.extend(argsTemplate.time, dataProgressWidget));\r\n         });\r\n\r\n      }\r\n   },\r\n   updateWidget: function(argsTemplate){\r\n      var self = this;\r\n      var $content = self.getContent().empty();\r\n      var contentTemplate = self.getTemplate(\"plan-time-main\");\r\n\r\n      var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - (argsTemplate.unitTime.minutes * 60 * 1000)), null, false);\r\n\r\n      var messageDescripionDifference = bizagi.localization.getResource(\"workportal-project-activity-state-\" + argsTemplate.keywordResource);\r\n      argsTemplate.messageTime = messageDescripionDifference.replace(\"%s\", relativeTime);\r\n\r\n      contentTemplate\r\n         .render(argsTemplate)\r\n         .appendTo($content);\r\n\r\n      //Begin Adjust status bar next to the number days\r\n      var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\r\n      var widthNumberDays = $(\".remaining-days .days\", $content).width();\r\n      $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\r\n\r\n      var $barCompletedDate = $(\".remaining-days .bar-completed\", $content);\r\n\r\n      $barCompletedDate.css(\"width\", argsTemplate.percentBar + \"%\");\r\n      //End Adjust status bar next to the number days\r\n\r\n   },\r\n   getStateActivity: function(activity){\r\n      var self = this;\r\n      if(activity.finishDate){\r\n         activity.currentState = self.FINISHED_ACTIVITY;\r\n         return self.FINISHED_ACTIVITY;\r\n      }\r\n      else{\r\n         activity.currentState = self.EXECUTING_ACTIVITY;\r\n         return self.EXECUTING_ACTIVITY;\r\n      }\r\n   },\r\n   getFirstDate: function(activity){\r\n      var self = this;\r\n      if(activity.currentState === self.EXECUTING_ACTIVITY){\r\n         return activity.startDate;\r\n      } else{\r\n         return activity.finishDate;\r\n      }\r\n   },\r\n   getDataByScenarios: function(activity){\r\n      var self = this;\r\n      var response = {\r\n         colorBar: null,\r\n         percentBar: 100,\r\n         keywordResource: null,\r\n         unitTime: null\r\n      };\r\n      var params = {};\r\n      switch(activity.currentState){\r\n         case self.EXECUTING_ACTIVITY:\r\n            response.keywordResource = \"opened\";\r\n            response.colorBar = self.getColorByCreatedAndEstimatedDate(activity);\r\n\r\n            params = {\r\n               idUser: bizagi.currentUser.idUser,\r\n               fromDate: activity.startDate,\r\n               toDate: Date.now()\r\n            };\r\n            response.unitTime = self.callGetEffectiveDuration(params);\r\n\r\n            break;\r\n         case self.FINISHED_ACTIVITY:\r\n            response.colorBar = \"Gray\";\r\n            response.keywordResource = \"closed\";\r\n            params = {\r\n               idUser: bizagi.currentUser.idUser,\r\n               fromDate: activity.finishDate,\r\n               toDate: Date.now()\r\n            };\r\n            response.unitTime = self.callGetEffectiveDuration(params);\r\n            break;\r\n      }\r\n      return response;\r\n   },\r\n\r\n   getColorBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).colorBar;\r\n   },\r\n   getPercentBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).percentBar;\r\n   },\r\n   getKeywordResourceDescriptionBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).keywordResource;\r\n   },\r\n   getUnitTime: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).unitTime;\r\n   },\r\n\r\n   getColorByCreatedAndEstimatedDate: function(activity){\r\n      var self = this;\r\n      var response = \"Red\";\r\n      if(activity.estimatedFinishDate) {\r\n         if (Date.now() < activity.estimatedFinishDate) {\r\n            var theSameDay = (new Date()).getUTCDate() === (new Date(activity.estimatedFinishDate)).getUTCDate();\r\n            if(theSameDay){\r\n               response = \"Yellow\";\r\n            }\r\n            else{\r\n               response = \"Green\";\r\n            }\r\n         }\r\n      }\r\n      return response;\r\n   },\r\n\r\n   getFormattedDate: function (dateObj) {\r\n      var self = this;\r\n      var monthsNames = self.datePickerRegional.monthNames;\r\n      var shortMonth = dateObj.getMonth();\r\n\r\n      return monthsNames[shortMonth] + \" \" + bizagi.util.dateFormatter.formatDate(dateObj, \"dd hh:mm tt\", bizagi.localization.getResource(\"datePickerRegional\"));\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n   callGetEffectiveDuration: function(params){\r\n      var self = this;\r\n      var d = $.Deferred();\r\n      $.when(\r\n         self.dataService.getEffectiveDuration(params)\r\n      ).done(function (data) {\r\n            d.resolve(data);\r\n         });\r\n      return d.promise();\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.time\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.time], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Progress\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.progress\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.plugins = {};\r\n      self.dialogBox = {};\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-progress-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.progress\").concat(\"#project-plan-activity-progress\"),\r\n         \"plan-progress-popup-edit\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.progress\").concat(\"#project-plan-activity-edit-progress\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.sub(\"UPDATE_ITEMS_FROM_FORMRENDER\", $.proxy(self.onNotifyUpdateItemFromRender, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      var $content = self.getContent().empty();\r\n\r\n      var activityToShow = self.params.plan.activities.filter(function(activity){\r\n         return activity.id.toUpperCase() == self.params.plan.idActivitySelected.toUpperCase();\r\n      })[0];\r\n\r\n      var argsTemplate = {};\r\n      argsTemplate.valuePercentBarComplete = 0;\r\n      argsTemplate.progress = {\r\n         progress: activityToShow.progress,\r\n         canEdit: (activityToShow.items.length === 0)\r\n      };\r\n\r\n      if(argsTemplate.progress.progress){\r\n         argsTemplate.valuePercentBarComplete = argsTemplate.progress.progress;\r\n      }\r\n\r\n      //Update widget\r\n      var templateMain = self.getTemplate(\"plan-progress-main\");\r\n      templateMain.render(argsTemplate).appendTo($content);\r\n\r\n      self.plugins.popupEditProgress = self.initPluginPopupEditProgress();\r\n\r\n      var popupEditProgress = self.plugins.popupEditProgress;\r\n\r\n      self.formEditProgress = {\r\n         sliderProgress: $(\"#sliderProgress\", popupEditProgress).slider({\r\n            orientation: \"horizontal\",\r\n            range: \"min\",\r\n            max: 100,\r\n            width: 100,\r\n            from: 5,\r\n            to: 50,\r\n            step: 1,\r\n            value: argsTemplate.valuePercentBarComplete,\r\n            slide: $.proxy(self.onChangesliderProgress, self),\r\n            change: $.proxy(self.onChangesliderProgress, self)\r\n         }).each(function () {\r\n            var vals = $(this).slider(\"option\", \"max\") - $(this).slider(\"option\", \"min\");\r\n            for (var i = 0; i <= vals; i += 10) {\r\n               var el = $(\"<label class='step'>\" + (i) + \"</label>\").css(\"left\", (i / vals * 100) + \"%\");\r\n               $(this).append(el);\r\n            }\r\n         }),\r\n         numericTextBoxPlugin: $(\"#inputProgressNumericTextBox\", popupEditProgress).spinner({\r\n            format: \"n0\",\r\n            min: 0,\r\n            max: 100,\r\n            spin: $.proxy(self.onChangeNumericTextBoxProgress, self),\r\n            change: $.proxy(self.onChangeNumericTextBoxProgress, self),\r\n            value: argsTemplate.valuePercentBarComplete,\r\n            decimals: 0\r\n         }),\r\n         buttonChangeProgress: $(\"#button-accept-change-progress\", popupEditProgress),\r\n         buttonCancel: $(\"#button-cancel-change-progress\", popupEditProgress)\r\n      };\r\n\r\n      //Handlers\r\n      $(\".action-open-popup-edit-progress\", $content).on(\"click\", $.proxy(self.onShowPopupEditProgress, self));\r\n\r\n      self.formEditProgress.buttonCancel.on(\"click\", $.proxy(self.onClickCancel, self));\r\n      self.formEditProgress.buttonChangeProgress.on(\"click\", $.proxy(self.onSubmitFormChangeProgress, self));\r\n\r\n      self.updateProgressUI(argsTemplate.valuePercentBarComplete);\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", argsTemplate.valuePercentBarComplete);\r\n\r\n   },\r\n\r\n   onNotifyUpdateItemFromRender: function(event, params){\r\n      var self = this;\r\n      var listItems = params.args.items;\r\n      var activityWork = params.args.activityWork;\r\n\r\n      var progress;      \r\n      if(listItems.length > 0){\r\n         //Hide edit progress\r\n         $(\".action-open-popup-edit-progress\", self.content).hide();\r\n      }else{\r\n         $(\".action-open-popup-edit-progress\", self.content).show();\r\n      }\r\n      //set new progress\r\n      $(\".bz-wp-timestamp span\", self.content).text(activityWork);\r\n      $(\".bz-wp-progress-bar\", self.content).css(\"width\", activityWork + \"%\");\r\n\r\n   },\r\n\r\n   updateProgressUI: function(newPercentProgress){\r\n      var self = this,\r\n         $content = self.getContent();\r\n\r\n      $(\".bz-wp-timestamp span\", $content).text(newPercentProgress);\r\n\r\n      //Begin Adjust status bar next to the number days\r\n      var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\r\n      var widthNumberDays = $(\".remaining-days .days\", $content).width();\r\n      $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\r\n\r\n      var $barCompletedDate = $(\".remaining-days .bar-completed\", $content);\r\n\r\n      $barCompletedDate.css(\"width\", newPercentProgress.toString() + \"%\");\r\n      //End Adjust status bar next to the number days\r\n   },\r\n\r\n   initPluginPopupEditProgress: function () {\r\n      var self = this;\r\n      var templatePopupEditProgress = self.getTemplate(\"plan-progress-popup-edit\");\r\n      self.dialogBox.formContent = templatePopupEditProgress.render();\r\n      return self.dialogBox.formContent;\r\n\r\n   },\r\n   /*\r\n    * UI\r\n    */\r\n\r\n   onShowPopupEditProgress: function(){\r\n      var self = this;\r\n\r\n      self.dialogBox.formContent.dialog({\r\n         resizable: false,\r\n         draggable: false,\r\n         height: \"auto\",\r\n         width: \"600px\",\r\n         modal: true,\r\n         title: bizagi.localization.getResource(\"workportal-project-plan-progress-title\"),\r\n         maximize: true,\r\n         open:  $.proxy(self.onOpenPopupPlan, self),\r\n         close: function () {\r\n            self.dialogBox.formContent.dialog(\"destroy\");\r\n            self.dialogBox.formContent.detach();\r\n         }\r\n      });\r\n\r\n      self.previusValueProgress = self.formEditProgress.sliderProgress.slider(\"value\");\r\n\r\n   },\r\n\r\n   onChangeNumericTextBoxProgress: function (event) {\r\n      var self = this;\r\n      var newValue = self.formEditProgress.numericTextBoxPlugin.spinner(\"value\");\r\n      self.formEditProgress.sliderProgress.slider(\"value\", newValue);\r\n   },\r\n\r\n   onChangesliderProgress: function (event) {\r\n      var self = this;\r\n      var newValue = self.formEditProgress.sliderProgress.slider(\"value\");\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", newValue);\r\n   },\r\n\r\n   onClickCancel: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n\r\n      self.dialogBox.formContent.dialog(\"destroy\");\r\n      self.dialogBox.formContent.detach();\r\n      //return before value progress\r\n      self.formEditProgress.sliderProgress.slider(\"value\", self.previusValueProgress);\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", self.previusValueProgress);\r\n   },\r\n\r\n   onSubmitFormChangeProgress: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n\r\n      self.formEditProgress.buttonChangeProgress.prop(\"disabled\", true);\r\n\r\n      var activityToShow = self.params.plan.activities.filter(function(activity){\r\n         return activity.id == self.params.plan.idActivitySelected;\r\n      })[0];\r\n       var params = $.extend(activityToShow, {\r\n           progress:  self.formEditProgress.numericTextBoxPlugin.spinner(\"value\"),\r\n           idPlan: self.params.plan.id\r\n       });\r\n      $.when(self.dataService.editActivityPlan(params)).done(function () {\r\n         self.formEditProgress.buttonChangeProgress.prop(\"disabled\", false);\r\n         activityToShow.progress = self.formEditProgress.numericTextBoxPlugin.spinner(\"value\");\r\n         self.updateProgressUI(activityToShow.progress);\r\n          self.dialogBox.formContent.dialog(\"destroy\");\r\n          self.dialogBox.formContent.detach();\r\n      });\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.progress\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.progress], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Subprocesses Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.subprocesses\", {}, {\r\n      /*\r\n       *   Constructor\r\n       */\r\n      init: function (workportalFacade, dataService, params) {\r\n         var self = this;\r\n\r\n         // Call base\r\n         self._super(workportalFacade, dataService, params);\r\n\r\n         //Load templates\r\n         self.loadTemplates({\r\n            \"project-subprocesses\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.subprocesses\").concat(\"#project-plan-activity-plan-subprocesses-wrapper\"),\r\n            \"project-subprocesses-tootip-custom-properties\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.subprocesses\").concat(\"#project-activity-plan-subprocesses-tooltip-custom-properties-wrapper\")\r\n         });\r\n      },\r\n\r\n      /*\r\n       * Renders the template defined in the widget\r\n       */\r\n      renderContent: function () {\r\n         var self = this;\r\n         self.content = $(\"<div></div>\");\r\n         return self.content;\r\n      },\r\n\r\n      /*\r\n       * links events with handlers\r\n       */\r\n      postRender: function () {\r\n         var self = this;\r\n      }\r\n   }\r\n);\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.subprocesses\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.subprocesses]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Parent\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.parent\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-parent-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.parent\").concat(\"#project-plan-activity-parent\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      var $content = self.getContent().empty();\r\n\r\n         $.when(self.dataService.getPlanParent({idPlan: self.params.plan.id})).done(function (planParent) {\r\n            self.params.plan.parent = planParent;\r\n            if(self.params.plan.parent){\r\n               var argsTemplate = {};\r\n               argsTemplate.parent = {\r\n                  idParent: self.params.plan.parent.radNumber,\r\n                  nameParent: self.params.plan.parent.displayName,\r\n                  idCase: self.params.plan.parent.idCase,\r\n                  idWorkflow: self.params.plan.parent.idWorkflow,\r\n                  idWorkItem: self.params.plan.parent.idWorkItem,\r\n                  idTask: self.params.plan.parent.idTask\r\n               };\r\n\r\n               //Update widget\r\n               var contentTemplate = self.getTemplate(\"plan-parent-main\");\r\n               contentTemplate\r\n                  .render(argsTemplate)\r\n                  .appendTo($content);\r\n\r\n               $(\"#go-to-parent-case\", $content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\r\n            }\r\n         });\r\n\r\n\r\n   },\r\n\r\n   onClickGoToParentCase: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n      self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.parent\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.parent], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Users Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.users\", {}, {\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      self.usersMap = {};\r\n      self.plugins = {};\r\n      self.usersInformation=[];\r\n      self.globalHandlersService = bizagi.injector.get('globalHandlersService');\r\n      self.usersAssignees = [];\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      //The load template the users plan because they are the same\r\n      self.loadTemplates({\r\n         \"plan-users-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.users\").concat(\"#project-plan-users\")\r\n      });\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /*\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n   },\r\n\r\n   /*\r\n    * validate if the activity is running\r\n    */\r\n   activityRuning: function (activity) {\r\n      return activity.startDate !== null && activity.finishDate === null;\r\n   },\r\n\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this,\r\n      cvsGuidUsers = [],\r\n         activitiesUsers = [],\r\n         $content = self.getContent().empty();\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      var ownerUserId = self.params.plan.idUserCreator;\r\n      var ownerUserGuid = self.params.plan.idUserCreator;\r\n\r\n      activitiesUsers.push({ \"idUser\": ownerUserId, \"guidUser\": ownerUserGuid, \"userType\": [\"owner\"] });\r\n      self.usersMap[\"-\" + ownerUserId + \"-\"] = {\r\n         picture: \"\",\r\n         id: ownerUserId,\r\n         guid: ownerUserGuid,\r\n         name: \"\",\r\n         userType: [\"owner\"]\r\n      };\r\n      cvsGuidUsers.push(ownerUserGuid);\r\n      $.each(self.params.plan.activities, function (index, activity) {\r\n         if (self.activityRuning(activity)) {\r\n            var userId = activity.userAssigned;\r\n            var userGuid = activity.userAssignedGuid;\r\n            if (userId === ownerUserId) {\r\n               if($.inArray(\"Assigned\", activitiesUsers[0].userType) === -1){\r\n                  activitiesUsers[0].userType.push(\"Assigned\");\r\n                  self.usersMap[\"-\" + ownerUserId + \"-\"].userType.push(\"Assigned\");\r\n               }\r\n            }\r\n            else {\r\n               self.usersMap[\"-\" + userId + \"-\"] = {\r\n                  picture: \"\",\r\n                  id: userId,\r\n                  name: \"\",\r\n                  userType: [\"Assigned\"]\r\n               };\r\n               if (activitiesUsers.filter(function(user) { return user.idUser == userId; }).length === 0) {\r\n                  var id=userGuid?userGuid:userId;\r\n                  activitiesUsers.push({\"idUser\": id, \"userGuid\": id, \"userType\": [\"Assigned\"]});\r\n                  cvsGuidUsers.push(id);\r\n               }\r\n            }  \r\n         }\r\n      });\r\n      self.activitiesUsers = activitiesUsers;\r\n\r\n      //Update widget\r\n      var contentTemplate = self.getTemplate(\"plan-users-main\");\r\n      contentTemplate\r\n         .render({\r\n            assignee: self.justAssignees(activitiesUsers),\r\n            label: bizagi.localization.getResource(\"workportal-project-plan-assignee\")\r\n         })\r\n         .appendTo($content);\r\n        self.addEventHandlersModal();\r\n      $.when(self.callGetDataUsers(cvsGuidUsers)).then(function () {\r\n         self.showCreatorInformation(ownerUserId);\r\n         self.renderUserProfilesAndImages();\r\n      });\r\n   },\r\n\r\n   /**\r\n    * return standar userAdapter information with only assigned users\r\n    * @param {Array} allUsers \r\n    */\r\n   justAssignees: function (allUsers) {\r\n       var usersAssignee=[];\r\n       allUsers.map(function(user) {\r\n           var isOwner=user.userType.indexOf(\"owner\")!==-1;\r\n           var isAssignee=user.userType.indexOf(\"Assigned\")!==-1;\r\n           usersAssignee.push(usersAdapter.createJsonUserInfo(user.idUser, \"\", \"\", \"\", \"\", \"\", isAssignee, isOwner, [], []));\r\n       });\r\n       return usersAdapter.justAssignees(usersAssignee);\r\n   },\r\n   \r\n   /**\r\n    * show the information of the creator case\r\n    * @param {string} ownerUserId guid user creator\r\n    */\r\n   showCreatorInformation: function (ownerUserId) {\r\n       var self = this;\r\n       var userCreator=self.usersMap[\"-\"+ownerUserId+\"-\"];\r\n       var userInfo = usersAdapter.createJsonUserInfo(\r\n           userCreator.id,\r\n           userCreator.name,\r\n           userCreator.username,\r\n           userCreator.picture?userCreator.picture:undefined,\r\n           userCreator.email,\r\n           userCreator.name.getInitials(),\r\n           false,\r\n           true,\r\n           [],\r\n           []\r\n       );\r\n       self.content.find(\".ui-bizagi-wp-project-plan-users .ui-bizagi-wp-project-users-creator-info\").userinformation(self, { user: userInfo });\r\n   },\r\n\r\n   /**\r\n    * UI\r\n    */\r\n\r\n   renderUserProfilesAndImages: function () {\r\n       var self = this;\r\n       $.each(self.usersMap, function (i, obj) {\r\n           var $li = $(\".ui-bizagi-wp-userlist li[data-iduser=\" + obj.id + \"]\", self.content);\r\n           if (obj.picture !== \"\") {\r\n               $li.find(\"img\").prop(\"src\", obj.picture);\r\n           }\r\n           else {\r\n               $li.find(\"img\").hide();\r\n               if(obj.name!==undefined){\r\n                  $li.find(\"span\").html(obj.name.getInitials());\r\n               }\r\n               else{\r\n                  console.log(\"obj.name is undefined\");\r\n               }\r\n\r\n           }\r\n       });\r\n       $(\".ui-bizagi-wp-userlist li\", self.content).not(\".moreUsers\").on('mouseenter', function (ev) {\r\n         var $target = $(ev.target);  \r\n         var userId = $(this).data(\"iduser\");\r\n         var userSelected;\r\n         $.each(self.usersMap, function (i, obj) {\r\n            if(obj.id === userId)\r\n               userSelected=obj;\r\n        });\r\n         var usersActivities=self.usersAssignees.find(function(assignee) {\r\n            return assignee.userAssigned === userSelected.id;\r\n         });\r\n         var activities=[];\r\n         if(usersActivities)\r\n            usersActivities.activities.map(function(activity) {\r\n               activities.push(activity.name);\r\n            });\r\n         var userParam = usersAdapter.createJsonUserInfo(userSelected.id, userSelected.name, userSelected.username, userSelected.picture, userSelected.email, userSelected.name.getInitials(), self.getIsAssignee(userSelected), self.getIsOwner(userSelected), activities, undefined);\r\n                     \r\n         $target.parent().usertooltip(self,{target:$target,user:userParam});\r\n      });\r\n   },\r\n\r\n   getIsAssignee: function(userSelected){\r\n      if(userSelected.userType.indexOf(\"Assigned\") > -1){\r\n          return true;\r\n      }\r\n      return false;\r\n     },\r\n  \r\n     getIsOwner : function(userSelected){\r\n      if(userSelected.userType.indexOf(\"owner\") > -1){\r\n          return true;\r\n      }\r\n      return false;\r\n     },\r\n   /*\r\n    *  Get data for users\r\n    */\r\n   callGetDataUsers: function (cvsGuidUsers) {\r\n      var self = this,\r\n         params = {},\r\n         defer = $.Deferred();\r\n      params = {\r\n         usersGuids: cvsGuidUsers.join(),\r\n         width: 50,\r\n         height: 50\r\n      };\r\n      $.when(self.dataService.getUsersData(params)).always(function (response) {\r\n        self.usersInformation= response;\r\n         for (var i = 0, length = response.length; i < length; i += 1) {\r\n            if (typeof (response[i].name) === \"undefined\") {\r\n               bizagi.log(response[i] + \" Id Not Found\", response, \"error\");\r\n            } else {\r\n               if(self.usersMap[\"-\" + response[i].id + \"-\"]){\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].picture += (response[i].picture) ? \"data:image/png;base64,\" + response[i].picture : \"\";\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].name = response[i].name || \"\";\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].username = response[i].username || \"\";\r\n                  self.usersMap[\"-\" + response[i].id + \"-\"].email = response[i].email || \"\";\r\n               }\r\n               else{\r\n                  console.log(\"The object is undefined\");\r\n               }\r\n            }\r\n         }\r\n         self.getUsersAssignees();\r\n         defer.resolve();\r\n      });\r\n      return defer.promise();\r\n   },\r\n\r\ngetUsersAssignees: function(){\r\n    var self = this;\r\n    for(var i=0; i<self.usersInformation.length; i++){\r\n        self.usersAssignees.push(self.getUserAssignee(self.usersInformation[i]));\r\n    }\r\n\r\n},\r\n\r\ngetUserAssignee: function(user){\r\n    var self =  this;\r\n    var tasks = [];\r\n    $.each(self.params.plan.activities, function (index, activity) {\r\n        var userId = activity.userAssigned;\r\n        if (userId === user.id && self.activityRuning(activity)) {\r\n            tasks.push({ \"name\": activity.name });\r\n        }\r\n    });\r\n    user.tasks = tasks;\r\n    var types = self.activitiesUsers.find(function(actUser) {\r\n        return actUser.idUser == user.id;\r\n    });\r\n    user.userType = types.userType;\r\n\r\n    var userAssignees = usersAdapter.createJsonUserInfo(\r\n        user.id, \r\n        user.name, \r\n        user.username, \r\n        user.picture ? \"data:image/png;base64,\" + user.picture : undefined, \r\n        user.email, \r\n        user.name.getInitials(),\r\n        self.getIsAssignee(user), \r\n        self.getIsOwner(user), \r\n        user.tasks, \r\n        []);\r\n\r\n        return userAssignees;\r\n   },\r\n\r\n   addEventHandlersModal: function () {\r\n    var self =  this;\r\n    $(\".moreUsers\").click(function(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        var usersAssignees = self.usersAssignees || [];\r\n        self.globalHandlersService.publish(\"showDialogWidget\", {\r\n            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL,\r\n            closeVisible: true,\r\n            data: usersAssignees,\r\n            maximize: true,\r\n            modalParameters: {\r\n                title: bizagi.localization.getResource(\"workportal-project-users-title\")+ \" (\"+usersAssignees.length+\")\",\r\n                width: 790,\r\n                height: 526,\r\n                refreshInbox: false\r\n            }\r\n        });\r\n     });\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.users\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.users], true);","/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity Plan\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity.plan\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.plan\").concat(\"#project-dashboard-menu2\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n         self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n\r\n   },\r\n\r\n   /**\r\n    * Update view\r\n    * @param event\r\n    * @param params\r\n    */\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      var argsTemplate = {\r\n         showFormOverview: self.params.menuDashboard.showFormOverview,\r\n         showFormActivity: self.params.menuDashboard.showFormActivity,\r\n         showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu,\r\n         showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\r\n         contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\r\n         contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu,\r\n         contextualized: self.params.plan.contextualized\r\n      };\r\n\r\n      //Update widget\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      template.render(argsTemplate).appendTo($content);\r\n\r\n      if(self.params.showContextByMenuDashboard){\r\n         $(\"li[data-context='\" + event.type.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n      }\r\n\r\n      self.handlerEvents();\r\n\r\n      var paramsGetPlan = {idPlan: self.params.plan.id};\r\n      $.when(self.callGetPlan(paramsGetPlan)).then(function(responsePlan){\r\n         $.extend(self.params.plan, responsePlan);\r\n         self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_PLAN\",\r\n            args: self.params\r\n         });\r\n      });\r\n   },   \r\n\r\n   /**\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if (!$item.hasClass(\"active\")) {\r\n         $.when(bizagi.util.autoSave()).done(function () {\r\n            $(document).data('auto-save', '');\r\n\r\n            var showContextByMenuDashboard = $item.data(\"context\");\r\n            if (showContextByMenuDashboard) {\r\n               var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\"});\r\n               var currentLevelNavigator = parseInt(getLevelNavigator[0]);\r\n               var nameItemNavigator = \"\";\r\n               var newLevelNavigator = currentLevelNavigator;\r\n\r\n               self.params.refreshLastItemBreadcrumb = false;\r\n               self.pub(\"notify\", {\r\n                  type: showContextByMenuDashboard.toUpperCase(),\r\n                  args: $.extend(self.params,{showContextByMenuDashboard: showContextByMenuDashboard,\r\n                     histName: nameItemNavigator,\r\n                     level: newLevelNavigator})\r\n               });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n            }\r\n         });\r\n      }\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n\r\n   callGetPlan: function(params){\r\n      var self = this;\r\n      var defer = $.Deferred();\r\n      self.dataService.getPlan(params).always(function (response) {\r\n         if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n            defer.resolve(response);\r\n         }\r\n         else {\r\n            defer.reject();\r\n         }\r\n      });\r\n\r\n      return defer.promise();\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n       var self = this;\r\n       var content = self.getContent();\r\n       var $comments = $(\"[data-context='ACTIVITYPLANCOMMENTS']\", content);\r\n       var $files = $(\"[data-context='ACTIVITYPLANFILES']\", content);\r\n       var $timeline = $(\"[data-context='ACTIVITYPLANTIMELINE']\", content);\r\n\r\n       $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n           $comments.toggle();\r\n           $files.toggle();\r\n           $timeline.toggle();\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Handler events\r\n    */\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n      self.subMenuHandler();\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\",  $.proxy(self.loadContentById, self));\r\n   },\r\n\r\n   /**\r\n    * Clean widgets and events\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity.plan\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity.plan], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-content-dashboard\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n\r\n      setTimeout(function(){\r\n         $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\r\n      }, 1000);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","/**\r\n * This module manage all graphical diagrams of process map\r\n *\r\n * @author Edward J Morales\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.processMap\", {}, {\r\n\r\n\t/**\r\n\t * Constructor\r\n\t * @param workportalFacade instance of facade, mandatory\r\n\t * @param dataService instance of service tier, mandatory\r\n\t * @param params extra params, its not mandatory\r\n\t */\r\n\tinit: function(workportalFacade, dataService, params) {\r\n\t\tvar self = this;\r\n\r\n\t\t// Call parent instance\r\n\t\tself._super(workportalFacade, dataService, params);\r\n\t\tself.instanceBizagiProcessMap = new bizagi.processMap(this);\r\n\t\t\r\n\t\t//Load templates\r\n\t\tself.loadTemplates({\r\n\t\t\t\"project-processmap\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.processMap\").concat(\"#project-processmap-wrapper\"),\r\n\t\t\t\"project-process-diagram\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.processMap\").concat(\"#project-processmap-process-diagram\"),\r\n\t\t\t\"project-activity-map\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.processMap\").concat(\"#project-processmap-activity-map\"),\r\n\t\t\t\"project-subprocess\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.processMap\").concat(\"#project-processmap-subprocess\")\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Render a content of the module\r\n\t * @return {string} html\r\n\t */\r\n\trenderContent: function() {\r\n\t\tvar self = this;\r\n\t\tvar template= self.instanceBizagiProcessMap.renderContent();\r\n        self.content = template.render(self.viewOptions);\r\n\t\treturn self.content;\r\n\t},\r\n\r\n\t/**\r\n\t * Set binding and set data\r\n\t */\r\n\tpostRender: function() {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.postRender();\r\n\t},\r\n\r\n    /**\r\n\t *  Binds events to handlers\r\n\t */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.configureHandlers();\r\n    },\r\n\r\n\t/**\r\n\t * Process diagram handler\r\n\t */\r\n    onProcessDiagram: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.onProcessDiagram();\r\n    },\r\n\r\n\t/**\r\n\t * Activity map handler\r\n\t */\r\n    onActivityMap: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.onActivityMap();\r\n    },\r\n\r\n\t/**\r\n\t * Subprocess handler\r\n\t */\r\n    onSupprocess: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.onSupprocess();\r\n    },\r\n\r\n\t/**\r\n\t * Manage navigation between the 3 diagrams\r\n\t * @param template\r\n\t * @param params\r\n\t */\r\n    navigationManager: function (template) {\r\n        var self = this;\r\n\t\tvar response = self.instanceBizagiProcessMap.navigationManager(template);\r\n\t\tresponse.container.append(response.template.render(response.viewOptions));\r\n    },\r\n\r\n\t/**\r\n\t * Render the process diagram in the process diagram container\r\n\t */\r\n    renderProcessDiagram: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.renderProcessDiagram();\r\n    },\r\n\r\n    resize: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.resize();\r\n    },\r\n\t/**\r\n\t * Set plugin activity map, draw sequence map\r\n\t */\r\n    renderActivityMap: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.renderActivityMap();\r\n    },\r\n\r\n    renderSubProcessMap: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.renderSubProcessMap();\r\n    },\r\n\r\n\t/**\r\n\t * Append the activity map zoom\r\n\t */\r\n    appendActivityMapZoom: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.appendActivityMapZoom();\r\n    },\r\n\r\n\t/**\r\n\t * Append the process map zoom\r\n\t */\r\n    appendProcessMapZoom: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.appendProcessMapZoom();\r\n    },\r\n\r\n\t/**\r\n\t * Append the subprocess zoom\r\n\t */\r\n    appendSubprocessZoom: function () {\r\n        var self = this\r\n        self.instanceBizagiProcessMap.appendSubprocessZoom();\r\n    },\r\n\t/**\r\n\t * Append the subprocess drag and scroll\r\n\t */\r\n    appendSubprocessDragScroll: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.appendSubprocessDragScroll();\r\n\r\n    },\r\n\r\n\t/**\r\n\t * binds the tooltip to each activity in activity map\r\n\t */\r\n    bindTooltip: function (tooltipParams) {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.bindTooltip(tooltipParams);\r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.processMap', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.processMap]);","/**\r\n * This module manage graphical diagram of process diagram\r\n *\r\n * @author Andrés Fernando Muñoz\r\n */\r\nbizagi.workportal.widgets.graphicquery.extend(\"bizagi.workportal.widgets.project.processDiagram.helper\", {}, {\r\n\t/**\r\n\t * Set Height for process viewer\r\n\t * @Overriden\r\n\t */\r\n\tgetPVHeight: function () {\r\n\t\tvar self = this;\r\n\t\tvar defaultHeight = $(window).height() - 50;\r\n\t\tvar canvasPst = self.$header.height() + 180;\r\n\t\tvar cntHeight = $(\".ui-bizagi-wp-project-tab-content\").height();\r\n\t\tvar cntHeight = cntHeight || defaultHeight;\r\n\t\treturn cntHeight - canvasPst;\r\n\t}\r\n});\r\n","/*\r\n *   Name: Bizagi Workportal project Activity Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.activity.sidebar\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      params = params || {};\r\n      params.supportNav = false;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-activity-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.activity.sidebar\").concat(\"#project-activity-sidebar\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-activity-sidebar\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.activity.sidebar', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.activity.sidebar]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Activity Map Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.activityMap\", {}, {\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Set radNumber\r\n      self.radNumber = params.radNumber;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-activityMap\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.activityMap\").concat(\"#project-activityMap-wrapper\")\r\n      });\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      var template = self.getTemplate(\"project-activityMap\");\r\n\r\n      self.content = template.render({});\r\n      return self.content;\r\n   },\r\n\r\n   /*\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n\r\n      //Handlers\r\n      self.sub(\"HOME\", $.proxy(self.updateView, self));\r\n      self.sub(\"OVERVIEW\", $.proxy(self.updateView, self));\r\n      self.sub(\"COMMENTS\", $.proxy(self.updateView, self));\r\n      self.sub(\"PROCESSMAP\", $.proxy(self.updateView, self));\r\n      self.sub(\"LOG\", $.proxy(self.updateView, self));\r\n      self.sub(\"PLANCREATE\", $.proxy(self.updateView, self));\r\n      self.sub(\"PLANCOMMENTS\", $.proxy(self.updateView, self));\r\n   },\r\n\r\n   updateView: function (event, params) {\r\n      var self = this,\r\n         args = params.args,\r\n         $content = self.getContent().empty();\r\n\r\n      var argsTemplate = {};\r\n      argsTemplate[\"actualState\"] = \"\";\r\n      if(args.currentState[0]){\r\n         argsTemplate[\"actualState\"] = args.currentState[0].state;\r\n      }\r\n\r\n      //Update widget\r\n      var contentTemplate = self.getTemplate(\"project-activityMap\");\r\n      contentTemplate\r\n         .render($.extend(args, argsTemplate))\r\n         .appendTo($content);\r\n\r\n      self.params = args;\r\n   }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.activityMap', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.activityMap], true);\r\n\r\n","/**\r\n * This module manage the tooltip to show information in activity map and subprocess diagrams\r\n *\r\n * @author Andrés Fernando Muñoz\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.activityMap.tooltip\", {}, {\r\n\r\n\t/**\r\n\t * Constructor\r\n\t * @param workportalFacade instance of facade, mandatory\r\n\t * @param dataService instance of service tier, mandatory\r\n\t * @param params extra params, its not mandatory\r\n\t */\r\n\tinit: function(workportalFacade, dataService, params) {\r\n\t\tvar self = this;\r\n\t\t// Call parent instance\r\n\t\tself._super(workportalFacade, dataService, params);\r\n\t\t//Load templates\r\n\t\tself.loadTemplates({\r\n\t\t\t\"project-tooltip\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.activityMap.tooltip\").concat(\"#project-processmap-tooltip\")\r\n\t\t});\r\n\r\n\t\tself.cache = {};\r\n\t\tself.radNumber = params.radNumber;\r\n\t},\r\n\t/**\r\n\t * Render a content of the module\r\n\t * @return {string} html\r\n\t */\r\n\trenderContent: function(){},\r\n\t/**\r\n\t * Set binding and set data\r\n\t */\r\n\tpostRender: function() {\r\n\t\tvar self = this;\r\n\t\tself.dateFormat = self.getResource(\"dateFormat\") + \" \" + self.getResource(\"timeFormat\");\r\n\t},\r\n\t/**\r\n\t *  Binds events to handlers\r\n\t */\r\n\tconfigureHandlers: function (content, gqData) {\r\n\t\tvar self = this;\r\n\t\tcontent.find('.ui-bizagi-wp-project-processmap-process').on('click', $.proxy(self.onProcess, self, gqData));\r\n\t\tcontent.find('.ui-bizagi-wp-project-processmap-tooltip-title').on('click', $.proxy(self.onIdCase, self, gqData));\r\n\t},\r\n\t/**\r\n\t * Process handler\r\n\t * @param ev\r\n\t */\r\n\tonProcess: function(gqData, ev){\r\n\t\tvar self = this;\r\n\t\tself.showGraphicQuery(gqData);\r\n\t},\r\n\t/**\r\n\t * Id case handler\r\n\t * @param ev\r\n\t */\r\n\tonIdCase: function(gqData, ev){\r\n\t\tvar self = this;\r\n\t\tvar idCase = $(ev.currentTarget).data(\"idcase\");\r\n\t\tvar idWorkitem = $(ev.currentTarget).data(\"idworkitem\");\r\n\t\tvar idTask = $(ev.currentTarget).data(\"idtask\");\r\n\t\tvar idWorkflow = $(ev.currentTarget).data(\"idworkflow\");\r\n\r\n\t\tself.publish(\"executeAction\", {\r\n\t\t\taction: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n\t\t\tidCase: idCase,\r\n\t\t\tidWorkItem: idWorkitem,\r\n\t\t\tidTask: idTask,\r\n\t\t\tidWorkflow: idWorkflow\r\n\t\t});\r\n\t},\r\n\t/**\r\n\t * Binds the tooltip to activities\r\n\t * @param params\r\n\t */\r\n\tbindTooltip: function (tooltipParams){\r\n\t\tvar self = this;\r\n\t\tself.tooltipClass = tooltipParams.tooltipClass;\r\n\t\ttooltipParams.$container.tooltip({\r\n\t\t\titems: tooltipParams.items,\r\n\t\t\tcontent: function (callback) {\r\n\t\t\t\tvar isContanerClicked = tooltipParams.$container.data(\"clicked\") || false;\r\n\t\t\t\tif (isContanerClicked){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar diagram = tooltipParams.diagram;\r\n\t\t\t\tif(diagram == \"activityMap\"){\r\n                    if(!$(this).is(\"circle\")){\r\n                        return;\r\n                    } else if(this.className.baseVal.indexOf('activity-map-activity-highlight') < 0){\r\n                    \treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$.when(self.getActivityMapTooltipContent($(this))).done(function (content) {\r\n\t\t\t\t\t\tcallback(content);\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar content = self.getSubprocessTooltipContent($(this));\r\n\t\t\t\t\tcallback(content);\r\n\t\t\t\t}\r\n\t\t\t\treturn \"loading..\";\r\n\t\t\t},\r\n\t\t\topen: function (event, ui) {\r\n\t\t\t    for (var i = 0; i < $(\".ui-tooltip\").length - 1; i++) {\r\n\t\t\t        $('#' + $(\".ui-tooltip\")[i].id).remove();\r\n\t\t\t    }\r\n\t\t\t    \r\n\t\t\t},\r\n\t\t\tshow: { duration: 60, effect: 'none' },\r\n\t\t\ttooltipClass: self.tooltipClass,\r\n\t\t\thide: { delay: 60, duration: 60 },\r\n\t\t\tposition: { my: \"left+20 top+20\"},\r\n\t\t\tclose: function (event, ui) {\r\n\t\t\t\tui.tooltip.hover(\r\n\t\t\t\t\tfunction () {\r\n\t\t\t\t\t\t$(this).stop(true).fadeTo(120, 1);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction () {\r\n\t\t\t\t\t\t$(this).fadeOut(20, function () {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Returns the activity map tooltip content\r\n\t * @param $ui\r\n\t * @returns {*}\r\n\t */\r\n\tgetActivityMapTooltipContent: function ($ui) {\r\n\t\tvar self = this, def = new $.Deferred(),\r\n\t\t\tguidWorkitem = $ui.data(\"guidWorkitem\"),\r\n\t\t\tidCase = $ui.data(\"idCase\"),\r\n\t\t\tidWorkflow = $ui.data(\"idWorkflow\"),\r\n\t\t\tparams = {\r\n\t\t\t\tguidWorkitem: guidWorkitem,\r\n\t\t\t\tgqData: {idCase: idCase, idWorkflow: idWorkflow}\r\n\t\t\t};\r\n\t\tself.guidWorkitem = guidWorkitem;\r\n\r\n\t\tif (self.isCached(params.guidWorkitem)){\r\n\t\t\tvar data = self.cache[params.guidWorkitem];\r\n\t\t\tdef.resolve(self.buildContent(data, params.gqData));\r\n\t\t}else{\r\n\t\t\t$.when(self.dataService.getActivitySummary(params)).done(function (data) {\r\n\t\t\t\tdef.resolve(self.buildContent(data, params.gqData));\r\n\t\t\t\tself.appendToCache(params.guidWorkitem, data);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn def.promise();\r\n\t},\r\n\t/**\r\n\t * Returns the subprocess tooltip content\r\n\t * @param $ui\r\n\t * @returns {*}\r\n\t */\r\n\tgetSubprocessTooltipContent: function ($ui) {\r\n\t\tvar self = this,\r\n\t\t\tidCase = $ui.data(\"idcase\"),\r\n\t\t\tidWorkflow = $ui.data(\"idworkflow\"),\r\n\t\t\tparams = {\r\n\t\t\t\tgqData: {idCase: idCase, idWorkflow: idWorkflow}\r\n\t\t\t};\r\n\r\n\t\tvar data = {\r\n\t\t\t\"endDate\": $ui.data(\"enddate\"),\r\n\t\t\t\"startDate\": $ui.data(\"startdate\"),\r\n\t\t\t\"process\": $ui.data(\"process\"),\r\n\t\t\t\"idCase\": $ui.data(\"idcase\")\r\n\t\t};\r\n\t\treturn self.buildContent(data, params.gqData);\r\n\t},\r\n\t/**\r\n\t * Fill the cache object with data for respective guidWorkitem\r\n\t * @param guidWorkitem\r\n\t * @param data\r\n\t */\r\n\tappendToCache: function (guidWorkitem, data) {\r\n\t\tvar self = this;\r\n\t\tself.cache[guidWorkitem] = data;\r\n\t},\r\n\t/**\r\n\t * Returns true if the guidWorkitem is cached, false otherwise\r\n\t * @param guidWorkitem\r\n\t * @returns {boolean}\r\n\t */\r\n\tisCached: function (guidWorkitem) {\r\n\t\tvar self = this;\r\n\t\treturn (typeof (self.cache[guidWorkitem]) !== \"undefined\");\r\n\t},\r\n\t/**\r\n\t * Build the tooltip content\r\n\t * @param data\r\n\t * @param gqData\r\n\t * @returns {*|jQuery|HTMLElement}\r\n\t */\r\n\tbuildContent: function (data, gqData){\r\n\t\tvar self = this,\r\n\t\t\tcontent = $(\"<div></div>\"),\r\n\t\t\ttmpl = self.getTemplate(\"project-tooltip\"),\r\n\t\t\tassignee = (typeof (data.assigneeName) !== \"undefined\");\r\n\r\n\t\tdata.assignee = assignee;\r\n\t\tdata.radNumber = self.radNumber;\r\n\t\tdata.idWorkflow = gqData.idWorkflow\r\n\t\tdata.idTask = data.idTask || 0;\r\n\t\tdata.idWorkitem = data.idWorkItem || 0;\r\n\t\tdata.graphicQuery = bizagi.menuSecurity.GraphicQuery;\r\n\t\tcontent = tmpl.render(data);\r\n\t\t$(\".\"+self.tooltipClass).html(content);\r\n\t\tbizagi.util.formatInvariantDate(content, self.dateFormat);\r\n\t\tself.configureHandlers(content, gqData);\r\n\t\treturn content;\r\n\t}\r\n});"]}