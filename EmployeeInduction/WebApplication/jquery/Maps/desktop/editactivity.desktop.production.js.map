{"version":3,"sources":["jquery/workportal/desktop/widget/project.plan.activities.form/bizagi.workportal.desktop.widgets.project.plan.activities.form.js"],"names":["bizagi","workportal","widgets","project","base","extend","init","workportalFacade","dataService","notifier","params","self","this","_super","dateFormat","localization","getResource","timeFormat","estimatedFinishDateTime","MAX_HOURS","plugins","form","loadTemplates","plan-activities-main","getTemplate","concat","plan-activity-items","renderContent","tmpl","plan","contextualized","content","render","postRender","$content","getContent","sub","getDataActivityForm","name","$","description","assignee","date","duration","allowEdition","sendNotification","cancel","initializeAutoComplete","initializeDatePicker","initializeSpiner","on","proxy","addNewItem","eventsHandler","initializeItems","arrayItems","templateItems","argsTemplate","items","contentItem","listItems","empty","append","onSaveForm","element","url","serviceLocator","getUrl","autocomplete","minLength","source","request","response","ajax","data","domain","userName","fullName","term","organization","pag","pagSize","orderField","success","map","users","item","label","user","value","idUser","fitList","select","event","ui","val","IdAssignee","pub","type","args","focus","change","window","blur","setTimeout","ul","dif","height","position","top","css","max-height","overflow","datepicker","onSelect","getTime","undefined","onClose","fieldDurationActive","util","dateFormatter","getDateFormatByDatePickerJqueryUI","spinTimer","idActivitySelected","clone","desactivateDateByDuration","newValue","target","isNumeric","parseInt","spinner","min","max","placeHolder","spin","clearTimeout","onKeyPressInputItem","siblings","text","prop","code","keyCode","which","setFocusItemEditing","find","auxValuePlaceCursorEndText","setFocusNextItem","closest","removeClass","next","addClass","setFocusPrevItem","prev","toString","indexItemEdited","index","length","remove","onFocusInputItem","onFocusOutInputItem","trim","$item","animate","backgroundColor","onMouseLeaveItem","onClickDeleteItem","off","nameItem","indexAppend","children","eq","after","onDeleteDate","onTypeDuration","$target","getOnlyNumbersByString","validateMaxHoursDurationField","onCancelForm","preventDefault","dataFormActivity","when","editActivityPlan","always","responseText","xhr","status","showSucessMessage","printf","validateParams","idUserAssigned","currentUser","is","currentActivity","each","activities","arrayNamesItem","id","userAssigned","userAssignedGuid","estimatedFinishDate","push","resolved","numTotalItems","nameValidation","html","onChangeForm","idActivityToShow","activityToShow","filter","activity","setValuesFormFields","isEditableFormActivity","setEnabledFormFields","onChangeActivityName","displayName","show","activateElement","hide","deactivateElement","activityDate","isEmpty","getDateFromInvariant","isNaN","Date","isMinimumDate","getDateServer","reset","decodeHtmlEntities","setUserAssignedIDGuid","parent","$inputDuration","state","$el","enable","wrapper","guidUser","callGetDataUsers","then","responseUsers","donetyping","csvguidUsers","defer","Deferred","usersGuids","width","getUsersData","resolve","promise","clean","unsub","injector","register","desktop"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activities Form\r\n *   Author: David Romero Estrada\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.desktop.widgets.project.plan.activities.form\", {}, {\r\n\r\n    /**\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, notifier, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.dateFormat = bizagi.localization.getResource(\"dateFormat\");\r\n        self.timeFormat = bizagi.localization.getResource(\"timeFormat\");\r\n        self.estimatedFinishDateTime; //Save complete date and time, because datepicker dont save time\r\n\r\n        self.MAX_HOURS = 9999999;\r\n\r\n        self.plugins = {};\r\n        self.form = {};\r\n        self.notifier = notifier;\r\n        // Load templates\r\n        self.loadTemplates({\r\n            \"plan-activities-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activities.form\").concat(\"#project-plan-activities-form\"),\r\n            \"plan-activity-items\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activities.form\").concat(\"#project-activity-items\")\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Render content\r\n     * @returns {*}\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"plan-activities-main\");\r\n        self.params.plan.contextualized = typeof (self.params.plan.contextualized) === \"undefined\" ? true : self.params.plan.contextualized;\r\n        self.content = tmpl.render(self.params.plan);\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n     * Post render\r\n     */\r\n    postRender: function () {\r\n\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        self.sub(\"GETDATA_FORM_EDIT_ACTIVITIY\", function(){\r\n            return self.getDataActivityForm();\r\n        });\r\n\r\n        self.form = {\r\n            name: $(\"#activity-form-itemname\", self.content),\r\n            description: $(\"#activity-form-description\", self.content),\r\n            assignee: $(\"#activity-form-assignee\", self.content),\r\n            date: $(\"#activity-form-date\", self.content),\r\n            duration: $(\"#activity-form-duration\", self.content),\r\n            allowEdition: $(\"#activity-form-allowedition\", self.content),\r\n            sendNotification: $(\"#activity-form-send-notification\", self.content),\r\n            //save: $(\"#project-plan-activity-form-save\", self.content),\r\n            cancel: $(\"#project-plan-activity-form-cancel\", self.content)\r\n        };\r\n\r\n        self.initializeAutoComplete(self.form.assignee);\r\n\r\n        self.initializeDatePicker(self.form.date);\r\n        self.initializeSpiner(self.form.duration);\r\n\r\n        //self.initilizeActionMenu();\r\n\r\n        //Activity Items\r\n        $(\"#link-add-new-item\", $content).on(\"click\", $.proxy(self.addNewItem, self));\r\n\r\n        self.eventsHandler();\r\n    },\r\n\r\n    /**\r\n     * Initialize menu plugin\r\n     */\r\n    /*initilizeActionMenu: function () {\r\n        var self = this;\r\n        $(\".ui-bizagi-wp-project-plan-activity-action-menu\", self.content).menu({\r\n            select: $.proxy(self.onSelectMenu, self)\r\n        }).removeClass(\"ui-widget-content\");\r\n    },*/\r\n\r\n    /**\r\n     * Initialize items on activity\r\n     * @param arrayItems\r\n     */\r\n    initializeItems: function (arrayItems) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        var templateItems = self.getTemplate(\"plan-activity-items\");\r\n\r\n        var argsTemplate = {};\r\n        argsTemplate.items = arrayItems;\r\n\r\n        var contentItem = templateItems.render(argsTemplate);\r\n\r\n        var listItems = $(\".list-items\", $content);\r\n        listItems.empty().append(contentItem);\r\n        $(\".inputtext\", listItems).on(\"change\", $.proxy(self.onSaveForm, self));\r\n\r\n    },\r\n\r\n    /**\r\n     * Initialize autocomplete plugin for load users\r\n     * @param element\r\n     */\r\n    initializeAutoComplete: function (element) {\r\n        var self = this;\r\n        var url = self.dataService.serviceLocator.getUrl(\"admin-getUsersListForPlans\");\r\n        element.autocomplete({\r\n            minLength: 2,\r\n            source: function (request, response) {\r\n                $.ajax({\r\n                    url: url,\r\n                    data: {\r\n                        domain: \"\",\r\n                        userName: \"\",\r\n                        fullName: request.term,\r\n                        organization: \"\",\r\n                        pag: 1,\r\n                        pagSize: 100,\r\n                        orderField: \"fullName\"\r\n                    },\r\n                    success: function (data) {\r\n                        response($.map(data.users, function (item) {\r\n                            return {\r\n                                label: item.user,\r\n                                value: item.idUser\r\n                            };\r\n                        }));\r\n                        self.fitList();\r\n                    }\r\n                });\r\n            },\r\n            select: function (event, ui) {\r\n                var name = ui.item.label;\r\n                element.val(name);\r\n                self.form.IdAssignee = ui.item.value;\r\n                self.onSaveForm(event);                \r\n                self.pub(\"notify\", {\r\n                    type: \"UPDATE_ACTIVITY_INFO\",\r\n                    args: { assignee: self.form.IdAssignee }\r\n                });\r\n                return false;\r\n            },\r\n            focus: function () {\r\n                return false;\r\n            },\r\n            change: function (event, ui){\r\n                if(ui.item === null){\r\n                    self.form.IdAssignee = null;\r\n                    self.form.assignee.val(\"\");\r\n                }\r\n                return false;\r\n            }\r\n\r\n        });\r\n        // Attach Resize eventHandler for activityAssignee field\r\n        $( window ).on('resize.activityAssignee', function() {\r\n            $('#activity-form-assignee', self.content).blur();\r\n        });\r\n    },\r\n    //Fit the list to avoid an overflow with the window\r\n    fitList: function (){\r\n    \r\n        setTimeout(function(){\r\n            var ul = $('body > ul.ui-autocomplete');\r\n            var dif = $(window).height() - $(ul).position().top - 10;\r\n            $(ul).css({ \"max-height\": dif + 'px', \r\n                overflow: 'auto' });\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Initialize datepicker plugin\r\n     * @param element\r\n     */\r\n    initializeDatePicker: function (element) {\r\n        var self = this;\r\n        element.datepicker({\r\n            onSelect: function () {\r\n                self.form.duration.val(\"\");\r\n                var oneDayInterval = (24 * 60 * 60 * 1000) - 50;\r\n                self.estimatedFinishDateTime = self.form.date.datepicker(\"getDate\") ? self.form.date.datepicker(\"getDate\").getTime() + oneDayInterval : undefined;\r\n                self.onSaveForm();\r\n            },\r\n            onClose: function(){\r\n                if(element.val() === \"\"){\r\n                    self.fieldDurationActive(true);\r\n                }\r\n            }\r\n        });\r\n        element.datepicker(\"option\", \"dateFormat\", bizagi.util.dateFormatter.getDateFormatByDatePickerJqueryUI());\r\n    },\r\n\r\n    /**\r\n     * Initialize spiner plugin\r\n     * @param element\r\n     */\r\n    initializeSpiner: function (element) {\r\n        var self = this;\r\n        var spinTimer;                  //timer identifier\r\n        var doneTypingInterval = 500;  //time in ms, 5 second for example\r\n\r\n        //Save other reference of idActivitySelected, because this changes the first on other widget;\r\n        //more information: QAF-3986\r\n        var idActivitySelected = bizagi.clone(self.params.plan.idActivitySelected);\r\n\r\n        function desactivateDateByDuration(event, newValue){\r\n            var value = newValue || $(event.target).val();\r\n            if (bizagi.util.isNumeric(value) && parseInt(value, 10) > 0) {\r\n                self.form.date.val(\"\");\r\n                self.estimatedFinishDateTime = undefined;\r\n            } else {\r\n                $(event.target).val(\"\");\r\n            }\r\n        }\r\n\r\n        element.spinner({\r\n            min: 1,\r\n            max: self.MAX_HOURS,\r\n            placeHolder: bizagi.localization.getResource(\"workportal-hours\"),\r\n            change: function (event) {\r\n                desactivateDateByDuration(event);\r\n\r\n                //This event triggered when change select other activities\r\n                //Because, the implementation spinner validates previusValue (when focus) VS value on input\r\n                if(idActivitySelected === self.params.plan.idActivitySelected){\r\n                    self.onSaveForm();\r\n                }\r\n            },\r\n            spin: function( event, ui ) {\r\n                desactivateDateByDuration(event, ui.value);\r\n\r\n                clearTimeout(spinTimer);\r\n                if ($('#myInput').val) {\r\n                    spinTimer = setTimeout($.proxy(self.onSaveForm, self), doneTypingInterval);\r\n                }\r\n            }\r\n        });\r\n\r\n    },\r\n\r\n    /**\r\n     List items\r\n     */\r\n    onKeyPressInputItem: function (event) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        setTimeout(function () {\r\n            $(event.target).siblings(\".showtext\").text($(event.target).val());\r\n            $(event.target).prop(\"title\", $(event.target).val());\r\n        }, 51);\r\n\r\n        var code = event.keyCode || event.which;\r\n        $(\".container-items\").removeClass(\"editing-mouse\");\r\n\r\n        function setFocusItemEditing() {\r\n            setTimeout(function () {\r\n                $(\".list-items .item.edit\", $content).find(\".inputtext\").focus();\r\n\r\n                //next code fix cursor to end value text field, when focus\r\n                var auxValuePlaceCursorEndText = $(\".list-items .item.edit\", $content).find(\".inputtext\").val();\r\n                $(\".list-items .item.edit\", $content).find(\".inputtext\").val(auxValuePlaceCursorEndText);\r\n            }, 51);\r\n        }\r\n\r\n        function setFocusNextItem(event) {\r\n            $(event.target).closest(\".item\").removeClass(\"edit\");\r\n            $(event.target).closest(\".item\").next().addClass(\"edit\");\r\n            setFocusItemEditing();\r\n        }\r\n\r\n        function setFocusPrevItem(event) {\r\n            $(event.target).closest(\".item\").removeClass(\"edit\");\r\n            $(event.target).closest(\".item\").prev().addClass(\"edit\");\r\n            setFocusItemEditing();\r\n        }\r\n\r\n        switch (code.toString()) {\r\n            case \"13\"://Enter\r\n                if ($(event.target).val() !== \"\") {\r\n                    $(event.target).closest(\".item\").removeClass(\"edit\");\r\n                    var indexItemEdited = $(event.target).closest(\".item\").index();\r\n                    self.addNewItem(\"\", indexItemEdited);\r\n                }\r\n                break;\r\n            case \"27\"://escape\r\n                if ($(event.target).closest(\".item\").prev().length !== 0) {\r\n                    setFocusPrevItem(event);\r\n                }\r\n                else if ($(event.target).closest(\".item\").next().length !== 0) {\r\n                    setFocusNextItem(event);\r\n                }\r\n                $(event.target).closest(\".item\").remove();\r\n                self.onSaveForm(event);\r\n                break;\r\n            case \"38\"://up\r\n                if ($(event.target).closest(\".item\").prev().length !== 0) {\r\n                    setFocusPrevItem(event);\r\n                }\r\n                break;\r\n            case \"40\"://down\r\n                if ($(event.target).closest(\".item\").next().length !== 0) {\r\n                    setFocusNextItem(event);\r\n                }\r\n                break;\r\n        }\r\n\r\n    },\r\n\r\n    /**\r\n     * Add css class to input focus\r\n     * @param event\r\n     */\r\n    onFocusInputItem: function (event) {\r\n        $(event.target).closest(\".item\").addClass(\"edit\").siblings().removeClass(\"edit\");\r\n    },\r\n\r\n    /**\r\n     * Event trigger when focus out item\r\n     * @param event\r\n     */\r\n    onFocusOutInputItem: function (event) {\r\n        if ($.trim($(event.target).val()) === \"\") {\r\n            var $item = $(event.target).closest(\".item\");\r\n            $($item).css(\"display\", \"block\").empty().css(\"background\", \"#E7BA99\")\r\n                .animate(\r\n                    {\r\n                        backgroundColor: \"#FFF\",\r\n                        height: \"0px\"\r\n                    }, 300,\r\n                    \"linear\",\r\n                    function() {\r\n                        $(this).remove();\r\n                    }\r\n                );\r\n        } else {\r\n            $(event.target).closest(\".item\").removeClass(\"edit\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Event mouse leave on item\r\n     */\r\n    onMouseLeaveItem: function () {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n        $(\".container-items\", $content).addClass(\"editing-mouse\");\r\n    },\r\n\r\n    /**\r\n     * Event trigger when delete item\r\n     * @param event\r\n     */\r\n    onClickDeleteItem: function (event) {\r\n        var self = this;\r\n\r\n        $(event.target).closest(\".item\").off(\"keyup\", \".inputtext\", $.proxy(self.onKeyPressInputItem, self));\r\n        $(event.target).closest(\".item\").off(\"click\", \".item-button.delete\", $.proxy(self.onClickDeleteItem, self));\r\n\r\n        $(event.target).closest(\".item\").remove();\r\n\r\n        self.onSaveForm(event);\r\n    },\r\n\r\n    /**\r\n     * Add item on activity\r\n     * @param nameItem\r\n     * @param indexAppend\r\n     */\r\n    addNewItem: function (nameItem, indexAppend) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        if (indexAppend === undefined) {//If click link add Item\r\n            indexAppend = $(\".list-items .item\", $content).length - 1;\r\n            if (indexAppend === -1) {\r\n                indexAppend = 0;\r\n            }\r\n\r\n        }\r\n\r\n        var templateItems = self.getTemplate(\"plan-activity-items\");\r\n\r\n        var argsTemplate = {};\r\n        argsTemplate.items = [{}];\r\n\r\n        var contentItem = templateItems.render(argsTemplate);\r\n        $(contentItem).addClass(\"edit\");\r\n\r\n        if ($(\".list-items\", $content).children().length === 0) {\r\n            $(\".list-items\", $content).append(contentItem);\r\n        }\r\n        else {\r\n            $(\".list-items\", $content).children().eq(indexAppend).after(contentItem);\r\n        }\r\n\r\n        $(\".inputtext\", contentItem).on(\"change\", $.proxy(self.onSaveForm, self));        \r\n        \r\n        setTimeout(function () {\r\n            $(\".list-items .item.edit\", $content).find(\".inputtext\").focus();\r\n        }, 51);\r\n    },\r\n\r\n    /**\r\n     * Event trigger when delete date\r\n     * @param event\r\n     */\r\n    onDeleteDate: function (event) {\r\n        var self = this;\r\n        if (event.keyCode === 8) {\r\n            $(event.target).val(\"\");\r\n            self.fieldDurationActive(true);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Event trigger when keyup duration\r\n     * @param event\r\n     */\r\n    onTypeDuration: function (event) {\r\n        var self = this;\r\n        var $target = $(event.target);\r\n        if ($target.val() !== \"\") {\r\n            $target.val(bizagi.util.getOnlyNumbersByString($target.val()));\r\n            self.validateMaxHoursDurationField($target);\r\n            self.form.date.val(\"\");\r\n            self.estimatedFinishDateTime = undefined;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * When cancel form\r\n     */\r\n    onCancelForm: function () {\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"PLANSIDEBAR\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Save activity\r\n     * @param event\r\n     */\r\n    onSaveForm: function (event) {\r\n        if (event) event.preventDefault();\r\n        var self = this;\r\n        var dataFormActivity = self.getDataActivityForm();\r\n        if (dataFormActivity) {\r\n            $.when(self.dataService.editActivityPlan(dataFormActivity)).always(function (response, responseText, xhr) {\r\n                if (xhr.status === 200 && responseText !== \"success\") {\r\n                    self.notifier.showSucessMessage(printf(bizagi.localization.getResource(\"workportal-project-plan-activity-update-message\"), \"\"));\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get data current activity\r\n     * @returns {*}\r\n     */\r\n    getDataActivityForm: function(){\r\n        var self = this;\r\n\r\n        function getArrayItems() {\r\n            var arrayNamesItem = [];\r\n            $(\".list-items .inputtext\").each(function () {\r\n                if ($(this).val().trim() !== \"\") {\r\n                    arrayNamesItem.push({\r\n                        id: undefined,\r\n                        resolved: $(this).closest(\".item\").find(\"input[type='checkbox']\").is(\":checked\"),\r\n                        name: $(this).val()\r\n                    });\r\n                }\r\n            });\r\n            return arrayNamesItem;\r\n        }        \r\n\r\n        if (self.validateParams(self.form.name.val())) {\r\n            var idUserAssigned = self.form.IdAssignee || bizagi.currentUser.idUser;\r\n            var allowEdition = self.form.allowEdition.is(\":checked\") || false;\r\n            var sendNotification = self.form.sendNotification.is(\":checked\");\r\n\r\n            var currentActivity = {};\r\n\r\n            $.each(self.params.plan.activities, function () { \r\n                if (this.id === self.params.plan.idActivitySelected) {\r\n                    self.form.duration.val(bizagi.util.getOnlyNumbersByString(self.form.duration.val()));\r\n                    self.validateMaxHoursDurationField(self.form.duration);\r\n                    this.duration = self.form.duration.val();\r\n                    this.userAssigned = idUserAssigned;\r\n                    this.userAssignedGuid = idUserAssigned;\r\n                    this.allowEdition = allowEdition;\r\n                    this.sendNotification = sendNotification;\r\n                    this.description = self.form.description.val();\r\n                    this.name = self.form.name.val();\r\n                    this.estimatedFinishDate = self.estimatedFinishDateTime;\r\n                    this.items = getArrayItems();\r\n                    this.numTotalItems = this.items.length;\r\n                    currentActivity = this;\r\n                }\r\n            });\r\n\r\n            return currentActivity;\r\n        }\r\n        else{\r\n            return false;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Validate params before update activity\r\n     * @returns {boolean}\r\n     */\r\n    validateParams: function (name) {\r\n        var self = this;\r\n        if(name === \"\"){\r\n            var nameValidation = \"* \" + bizagi.localization.getResource(\"workportal-project-plan-popup-field-name-required\");\r\n            self.form.name.next().find(\"span\").html(nameValidation);\r\n            return false;\r\n        }\r\n        else{\r\n            self.form.name.next().find(\"span\").empty();\r\n            return true;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Event executed when load activity on form\r\n     * @param event\r\n     * @param params\r\n     */\r\n    onChangeForm: function (event, params) {\r\n        var self = this;\r\n        self.estimatedFinishDateTime = undefined;\r\n\r\n        var idActivityToShow = params.args.idActivityToShow || self.params.plan.idActivitySelected;\r\n        var activityToShow = self.params.plan.activities.filter(function (activity) {\r\n            return activity.id === idActivityToShow;\r\n        })[0];\r\n       \r\n        self.setValuesFormFields(params.args.isEditableFormActivity, activityToShow);\r\n        self.setEnabledFormFields(params.args.isEditableFormActivity, activityToShow);\r\n    },\r\n\r\n    onChangeActivityName: function (event) {\r\n        var self = this;\r\n        self.onSaveForm();\r\n        self.pub(\"notify\", {\r\n            type: \"UPDATE_ACTIVITY_INFO\",\r\n            args: { displayName: $(event.target).val() }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Enabled or disabled form fields\r\n     * @param isEditableFormActivity\r\n     * @param activityToShow\r\n     */\r\n    setEnabledFormFields: function(isEditableFormActivity, activityToShow){\r\n        var self = this;\r\n        $(self.form.date).blur();//remove focus\r\n        if(isEditableFormActivity){\r\n            $(\".ui-bizagi-wp-project-plan-activity-action-menu\", self.content).show();\r\n            $(\"#activity-form-itemname\", self.content).prop(\"disabled\", false);\r\n            $(\"#activity-form-itemname\", self.content).removeClass(\"ui-state-disabled\");\r\n            $(\"#activity-form-description\", self.content).prop(\"disabled\", false);\r\n            $(\"#activity-form-description\", self.content).removeClass(\"ui-state-disabled\");            \r\n\r\n            self.form.assignee.removeClass(\"ui-state-disabled\");\r\n            self.activateElement(self.form.assignee);\r\n\r\n            self.fieldDurationActive(true);\r\n            self.activateElement(self.form.date);\r\n            self.form.date.removeClass(\"ui-state-disabled\");\r\n\r\n            $(\"#activity-form-allowedition\", self.content).prop(\"disabled\", false);            \r\n            $(\"#activity-form-send-notification\", self.content).prop(\"disabled\", false);            \r\n            $(\".container-items\", self.content).addClass(\"is-editing\");\r\n            $(\"#link-add-new-item\", self.content).show();\r\n        }\r\n        else{\r\n            $(\".ui-bizagi-wp-project-plan-activity-action-menu\", self.content).hide();\r\n            $(\"#activity-form-itemname\", self.content).prop(\"disabled\", true);\r\n            $(\"#activity-form-itemname\", self.content).addClass(\"ui-state-disabled\");\r\n            $(\"#activity-form-description\", self.content).prop(\"disabled\", true);\r\n            $(\"#activity-form-description\", self.content).addClass(\"ui-state-disabled\");\r\n            self.form.assignee.addClass(\"ui-state-disabled\");\r\n            self.deactivateElement(self.form.assignee);\r\n            self.deactivateElement(self.form.date);\r\n            self.form.date.addClass(\"ui-state-disabled\");            \r\n            self.fieldDurationActive(false);\r\n            $(\"#activity-form-allowedition\", self.content).prop(\"disabled\", true);\r\n            $(\"#activity-form-send-notification\", self.content).prop(\"disabled\", true);\r\n            $(\".container-items\", self.content).removeClass(\"is-editing\");\r\n            $(\"#link-add-new-item\", self.content).hide();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Set values to form fields\r\n     * @param isEditableFormActivity\r\n     * @param activityToShow\r\n     */\r\n    setValuesFormFields: function(isEditableFormActivity, activityToShow){\r\n        var self = this;\r\n        var activityDate = activityToShow && !bizagi.util.isEmpty(activityToShow.estimatedFinishDate) ? activityToShow.estimatedFinishDate : \"\";\r\n        var estimatedFinishDate = activityDate ? bizagi.util.dateFormatter.getDateFromInvariant(activityDate): \"\";\r\n        if(!isNaN(activityToShow.estimatedFinishDate))\r\n            estimatedFinishDate=new Date(activityToShow.estimatedFinishDate);\r\n        var isMinimumDate = estimatedFinishDate instanceof Date ? estimatedFinishDate.getTime() < self.getDateServer() : false;\r\n\r\n        $(\"#project-plan-activity-form\", self.content)[0].reset();\r\n        $(\".list-items .item\", self.content).remove();\r\n\r\n        self.form.name.val(bizagi.util.decodeHtmlEntities(activityToShow.name));\r\n        self.form.description.val(bizagi.util.decodeHtmlEntities(activityToShow.description));\r\n\r\n        if (activityToShow.userAssigned) {\r\n            self.setUserAssignedIDGuid(activityToShow.userAssigned, activityToShow.userAssignedGuid);\r\n        }\r\n\r\n        self.form.date.datepicker(\"option\", \"minDate\", new Date(self.getDateServer()));\r\n\r\n        if (activityToShow.estimatedFinishDate && isMinimumDate) {\r\n            self.form.date.datepicker(\"option\", \"minDate\", estimatedFinishDate);//set minimum because, if date is past\r\n        }\r\n\r\n        if(activityToShow.estimatedFinishDate){\r\n            self.form.date.datepicker(\"setDate\", estimatedFinishDate);\r\n            self.estimatedFinishDateTime = activityToShow.estimatedFinishDate;\r\n        }\r\n\r\n        if (activityToShow.duration) {\r\n            self.form.duration.val(parseInt(activityToShow.duration, 10));\r\n        }\r\n\r\n        if(self.params.plan.parent && self.params.plan.parent.allowEdition === false){\r\n\r\n            activityToShow.allowEdition = false; //activityToShow.allowEdition change to false because with it it is not posible to edit the activity.\r\n            self.form.allowEdition.parent().hide();\r\n        }else{\r\n            //Here activityToShow.allowEdition don't change if the edition is enabled, it can have whatever value.\r\n            self.form.allowEdition.parent().show();\r\n        }\r\n\r\n        if (activityToShow.allowEdition === true) {\r\n            self.form.allowEdition.prop(\"checked\", true);\r\n        }\r\n        else {\r\n            self.form.allowEdition.prop(\"checked\", false);\r\n        }\r\n       \r\n\r\n        if (activityToShow.sendNotification === true) {\r\n            self.form.sendNotification.prop(\"checked\", true);\r\n        }\r\n        else {\r\n            self.form.sendNotification.prop(\"checked\", false);\r\n        }\r\n\r\n        if (activityToShow.numTotalItems > 0) {\r\n            $(\".container-items h4\", self.content).show();\r\n            $(\".container-items span\", self.content).hide();\r\n            self.initializeItems(activityToShow.items);\r\n        }\r\n        else if (!isEditableFormActivity) {\r\n            $(\".container-items span\", self.content).show();\r\n            //$(\".container-items h4\", self.content).hide();\r\n        } else {\r\n            $(\".container-items span\", self.content).hide();\r\n        }\r\n    },\r\n    validateMaxHoursDurationField: function($inputDuration){\r\n        var self = this;\r\n        if(bizagi.util.getOnlyNumbersByString($inputDuration.val()) !== ''){\r\n            if(parseInt($inputDuration.val()) > self.MAX_HOURS){\r\n                $inputDuration.val(self.MAX_HOURS);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Active or deactive duration field\r\n     * @param state\r\n     */\r\n    fieldDurationActive: function(state){\r\n        var self = this;\r\n        if(state){\r\n            self.form.duration.prop(\"disabled\", false);\r\n            self.form.duration.spinner(\"option\", \"disabled\", false);\r\n        }\r\n        else{\r\n            self.form.duration.prop(\"disabled\", true);\r\n            self.form.duration.spinner(\"option\", \"disabled\", true);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Deactive field\r\n     * @param $el\r\n     */\r\n    deactivateElement: function ($el) {\r\n        if($el.prop){\r\n            $el.prop(\"disabled\", true);\r\n            $el.closest(\"tr\").addClass(\"ui-bizagi-workportal-opacity\");\r\n        }\r\n        else{\r\n            $el.enable(false);\r\n            $el.wrapper.closest(\"tr\").addClass(\"ui-bizagi-workportal-opacity\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Active element\r\n     * @param $el\r\n     */\r\n    activateElement: function ($el) {\r\n        if($el.prop){\r\n            $el.prop(\"disabled\", false);\r\n            $el.closest(\"tr\").removeClass(\"ui-bizagi-workportal-opacity\");\r\n        }\r\n        else{\r\n            $el.enable(true);\r\n            $el.wrapper.closest(\"tr\").removeClass(\"ui-bizagi-workportal-opacity\");\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Set User Id to form\r\n     * @param idUser\r\n     */\r\n    setUserAssignedIDGuid: function (idUser, guidUser) {\r\n        var self = this;\r\n        //Show images users\r\n        self.callGetDataUsers(idUser).then(function (responseUsers) {\r\n            self.form.assignee.val(responseUsers[0].name);\r\n        });\r\n        self.form.IdAssignee = idUser;\r\n        //self.form.GuidAssignee = guidUser;\r\n    },\r\n\r\n\r\n    /**\r\n     * Set events to items and plugins\r\n     */\r\n    eventsHandler: function () {\r\n        var self = this;\r\n\r\n        self.form.date.on(\"keydown\", $.proxy(self.onDeleteDate, self));\r\n        self.form.duration.on(\"keyup\", $.proxy(self.onTypeDuration, self));\r\n        //self.form.save.on(\"click\", $.proxy(self.onSaveForm, self));\r\n        self.form.cancel.on(\"click\", $.proxy(self.onCancelForm, self));\r\n\r\n        //Autosave input, checkbox type fields\r\n\r\n        self.form.name.on(\"change\", $.proxy(self.onChangeActivityName, self));\r\n        self.form.description.on(\"change\", $.proxy(self.onSaveForm, self));        \r\n        self.form.allowEdition.on(\"change\", $.proxy(self.onSaveForm, self));\r\n        self.form.sendNotification.on(\"change\", $.proxy(self.onSaveForm, self));\r\n\r\n        self.form.name.donetyping(function(){\r\n            self.onSaveForm();\r\n        });\r\n\r\n        self.form.description.donetyping(function(){\r\n            self.onSaveForm();\r\n        });\r\n\r\n        self.form.duration.donetyping(function(){\r\n            self.onSaveForm();\r\n        });\r\n\r\n        //Events List items\r\n        $(\".list-items\", self.content).on(\"keyup\", \".inputtext\", $.proxy(self.onKeyPressInputItem, self));\r\n        $(\".list-items\", self.content).on(\"focusout\", \".inputtext\", $.proxy(self.onFocusOutInputItem, self));\r\n        $(\".list-items\", self.content).on(\"focus\", \".inputtext\", $.proxy(self.onFocusInputItem, self));\r\n        $(\".list-items\", self.content).on(\"click\", \".item-button.delete\", $.proxy(self.onClickDeleteItem, self));\r\n        $(\".list-items\", self.content).on(\"mouseleave\", \".item\", $.proxy(self.onMouseLeaveItem, self));\r\n\r\n        self.sub(\"EDITACTIVITY\", $.proxy(self.onChangeForm, self));\r\n    },\r\n\r\n    /***\r\n     * call services\r\n     */\r\n    /*\r\n     *  Get data for users\r\n     */\r\n    callGetDataUsers: function (csvguidUsers) {\r\n        var self = this,\r\n            defer = $.Deferred();\r\n        var params = {\r\n            usersGuids: csvguidUsers,\r\n            width: 50,\r\n            height: 50\r\n        };\r\n\r\n        self.dataService.getUsersData(params).always(function (response) {\r\n            defer.resolve(response);\r\n        });\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n     * Clean events\r\n     */\r\n    clean: function(){\r\n        var self = this;\r\n        self.unsub(\"EDITACTIVITY\", $.proxy(self.onChangeForm, self));\r\n        \r\n        // Clean Resize eventHandler for activityAssignee field\r\n        $( window ).off('resize.activityAssignee');\r\n    }\r\n\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.desktop.widgets.project.plan.activities.form\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.desktop.widgets.project.plan.activities.form], true);"]}