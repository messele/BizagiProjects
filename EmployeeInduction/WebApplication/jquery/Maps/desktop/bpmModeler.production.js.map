{"version":3,"sources":["jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.observable.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.model.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.aura.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.path.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.connector.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.drawing.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.toolbar.js","jquery/plugins/bizagi.bpm.modeler/js/bpmn.modeler.viewer.js"],"names":["$","Class","extend","subscribe","this","observableElement","bind","apply","arguments","unsubscribe","unbind","publish","triggerHandler","_observableElement","bizagi","bpmn","modeler","observable","init","tasks","canvas","setModel","model","triggerModelRedraw","getViewModel","task_list","val","durationInMinutes","type","formatDuration","push","isGateway","isEvent","isEmailTask","getPersistenceModel","that","result","jQuery","each","i","task","parseDuration","showAura","getTaskById","id","getConnectionRule","sourceTaskId","targetTaskId","source","rule","grep","rules","target","length","expression","successorConnectionsCanContainRule","setCanvasBounds","bounds","triggerModelChange","redraw","setExtendedProperty","property","value","extendedProperties","getExtendedProperty","addTask","taskType","position","predecessor","newGuid","displayName","getDefaultName","getDuration","predecessors","successors","connectors","successor","displayNamePosition","x","y","setAura","addConnection","isPresent","key","changeTaskName","newDisplayName","changeConnectorName","connectorName","changeConnectorPos","idSourceTask","idTargetTask","labelPosition","Math","round","changeDuration","duration","changeTaskType","newType","triggerChangeShape","moveTask","setConnectionRule","removeConnectorsInPredecessors","predecesor","splice","deleteTask","removeAll","deleteArrow","indexOf","replace","c","r","random","toString","displaySecuence","numbersOfNameTask","uniqueSecuence","numberPattern","manualTasks","viewer","featureLocalization","getKeyLocalization","secuence","match","parseInt","sort","a","b","inArray","String","trim","test","last_hour","last_minuts","resultMinuts","hour","substring","floor","split","pop","minuts","m","params","activeConfirmationPopup","item","isEditableName","element","externalOptions","form","assignee","notify","getClassForExternalOption","getTitleForType","toolBarTitles","views","converters","aura","toolbar","getOldLocalization","templates","bpm_modeler_aura","bpm_modeler_auraOption","bpm_modeler_auraChangeTo","bpm_modeler_auraExternalOption","previousElementId","isActiveConfirmDialog","isEndEvent","data","showForTask","taskId","attr","options","getOptions","changeTo","getChangeTo","getExternalOptions","showArrow","positioning","shown","show","specialOptions","find","typeItem","css","of","my","at","collision","option","on","showChangeToOptions","activePopupConfirmationDelete","actionConfirmDelete","manageExternalOption","draggable","helper","containment","grid","drag","ev","ui","dragArrow","showForArrow","arrow","showRuleOption","arrowId","addClass","addHandlersForExpressions","elementId","isSame","hide","render","after","moveTo","detach","changeToOptions","toggleClass","top","click","proxy","connector","getSourceTaskFromId","getTargetTaskFromId","deleteOptions","left","btn","className","offset","changeOption","currentTarget","externalOption","possibleChanges","removeOne","curve","arrowHeight","calculateAnchors","el1","el2","threshold_x","min","width","threshold_y","height","e1xh","e2xh","e1yh","e2yh","areElementsVeryCloseInXAxis","abs","getPath","box","anchors","coords","w","h","areVerticalAnchors","getPathTopToBottom","getPathBottomToTop","areHorizontalAnchors","getPathLeftToRight","getPathRightToLeft","getPathLeftToRightBottom","getPathLeftToRightTop","getPathRightToLeftBottom","getPathRightToLeftTop","getPathTopToBottomLeft","getPathBottomToTopLeft","getPathTopToBottomRight","getPathBottomToTopRight","getPathBottomToLeft","getPathBottomToRight","getPathTopToLeft","getPathTopToRight","getTransform","threshold","x1","x2","y1","y2","getArrowRight","getArrowLeft","getArrowDown","getArrowUp","xh","yh","ah","buildConnectorId","i1","i2","bpm_modeler_connector","path","stroke","connect","task1","task2","labelConnectorPos","getBounds","drawLine","modifyPositions","getTop","getLeft","getWidth","getHeight","transform","html","append","svg","labelConnectorName","refresh","line","drawTemporalConnector","sourceTask","removeTemporalConnector","outerWidth","outerHeight","adjustToAnchor","el","anchor","bpm_modeler_drawing","bpm_modeler_drawingItem","drawingWidth","drawingHeight","previusElement","isEditionActive","reviewMode","onElementDragging","onArrowDragging","editExpressionForArrow","triggerElseExpressionForArrow","clickOnTask","aux","setCanvas","readonly","initializeGeneralHandlers","viewModel","drawing","canvasWidth","canvasHeight","scrollTop","scrollLeft","setTimeout","addConnectors","readonlyLoaded","addHandlers","addGeneralHandlers","configureNamesOfItems","setGeneralEvents","activeReviewMode","document","off","e","keyUpEvent","selectedItem","returnSelectedItem","which","nodeName","editConnectorName","firstElementChild","editTaskName","parent","index","obj","text","setNameTask","itemSelected","empty","onTaskDragging","configureDroppable","editDuration","showAuraForArrow","clickCavnas","setConnectorPosition","label","idSourceConnector","idTargetConnector","removeClass","context","mergeElement","mergeTarget","droppable","hoverClass","drop","event","addArrow","hasClass","accept","pos","fixPosition","autoAdjustCanvasOn","input","showPopupEditor","succesorId","sourceId","taskName","stopPropagation","preventDefault","tasksAtPosition","getTasksAtPosition","setExpressionForArrow","moveCanvas","tag","prop","toLowerCase","redrawConnector","draggingOverTasks","predecessorId","successorId","j","addConnector","auraShown","innerHTML","slice","filter","callback","cancelAction","focus","select","closeEditor","remove","keypress","one","relative","bpmShapes","StartEvent","IntermediateEvent","EndEvent","TerminateEvent","ExclusiveGateway","ParallelGateway","InclusiveGateway","ComplexGateway","UserTask","EmailTask","toolBarTitlesOld","changeType","deleteShape","flowSecuence","deleteConfirmationMessage","confirmDeleteShape","cancelDeleteShape","addExpression","elseExpression","getClassForType","bpm_modeler_toolbar","bpm_modeler_toolbarItem","items","onItemDragging","getInstaceLocalizationService","window","localization","getResource","bpm_modeler_viewer_container","changed","selectedTask","canvasEvent","triggerLoadFinish","onToolbarItemDragging","readOnly","diagram","self","container","when","checkCSSLoaded","then","renderToolbar","renderDrawing","load","display","defer","Deferred","cssAppliedOnDrawing","resolve","counterCheckCSS","validateCSSLoaded","setInterval","clearInterval","promise","activeModeReview","localizationModeler","activelocalizationModeler","toolbarCanvas","state","drawingCanvas","setConnectionExpression","save","json","Array","prototype"],"mappings":"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","sourcesContent":["// Pub/Sub class declaration\r\n$.Class.extend(\"bizagi.bpmn.modeler.observable\", {}, {\r\n    subscribe: function () {\r\n        this.observableElement().bind.apply(this.observableElement(), arguments);\r\n    },\r\n    unsubscribe: function () {\r\n        this.observableElement().unbind.apply(this.observableElement(), arguments);\r\n    },\r\n    publish: function () {\r\n        return this.observableElement().triggerHandler.apply(this.observableElement(), arguments);\r\n    },\r\n    observableElement: function(){\r\n        return !this._observableElement ? this._observableElement = $({}) :this._observableElement;\r\n    }\r\n});","bizagi.bpmn.modeler.observable.extend(\"bizagi.bpmn.modeler.model\", {}, {\r\n\r\n    /* Constructor */\r\n    init: function() {\r\n        this.tasks = {};\r\n        this.canvas = {};\r\n        var that = this;\r\n    },\r\n\r\n    setModel: function(model) {\r\n        this.tasks = model.tasks;\r\n        this.canvas = model.canvas;\r\n        this.triggerModelRedraw();\r\n    },\r\n\r\n    /************************************************************************\r\n     GETTERS SECTION\r\n     ************************************************************************/\r\n\r\n    getViewModel: function() {\r\n        var task_list = [];\r\n        for (val in this.tasks) {\r\n            if (this.tasks[val].durationInMinutes != null && this.tasks[val].type === \"UserTask\") {\r\n                var formatDuration = this.formatDuration(this.tasks[val].durationInMinutes);\r\n                this.tasks[val].durationInMinutes = formatDuration;\r\n            }\r\n            task_list.push(this.tasks[val]);\r\n        }\r\n        return {\r\n            tasks: task_list,\r\n            canvas: this.canvas,\r\n            isGateway: this.isGateway,\r\n            isEvent: this.isEvent,\r\n            isEmailTask: this.isEmailTask\r\n        };\r\n    },\r\n    getPersistenceModel: function() {\r\n        var that = this;\r\n        var result = { tasks: jQuery.extend({}, this.tasks), canvas: jQuery.extend({}, this.canvas) };\r\n        $.each(result.tasks, function(i, task) {\r\n            if (task.durationInMinutes) {\r\n                task.durationInMinutes = that.parseDuration(task.durationInMinutes);\r\n            }\r\n            // Remove showAura\r\n            delete task.showAura;\r\n        });\r\n        return result;\r\n    },\r\n    getTaskById: function(id) {\r\n        return this.tasks[id];\r\n    },\r\n\r\n    getConnectionRule: function(sourceTaskId, targetTaskId) {\r\n        var source = this.tasks[sourceTaskId];\r\n        if (!this.isGateway(source.type)) return null;\r\n\r\n        // Connection rules only work for gateways\r\n        var rule = $.grep(source.rules, function(rule) {\r\n            return rule.target == targetTaskId;\r\n        });\r\n        //return rule.length > 0? rule[0].expression: \"missing\";\r\n        return rule.length > 0 ? rule[0].expression : null;\r\n    },\r\n\r\n    successorConnectionsCanContainRule: function(task) {\r\n        var task = this.tasks[task];\r\n        if (task.type === 'ParallelGateway') {\r\n            return false;\r\n        } else {\r\n            return this.isGateway(task.type);\r\n        }\r\n    },\r\n\r\n    /************************************************************************\r\n     CANVAS MANAGEMENT SECTION\r\n     ************************************************************************/\r\n    setCanvasBounds: function(bounds) {\r\n        this.canvas = bounds;\r\n        this.triggerModelChange({ redraw: false });\r\n    },\r\n\r\n    /************************************************************************\r\n     EXTENDED PROPERTIES SECTION\r\n     ************************************************************************/\r\n\r\n    setExtendedProperty: function(id, property, value) {\r\n        if (this.tasks[id]) {\r\n            // make sure we have extendedProperties\r\n            this.tasks[id].extendedProperties = this.tasks[id].extendedProperties || {};\r\n            this.tasks[id].extendedProperties[property] = value;\r\n\r\n            // Publish event but don't redraw'\r\n            this.triggerModelChange({ redraw: false });\r\n        }\r\n    },\r\n\r\n    getExtendedProperty: function(id, property) {\r\n        if (this.tasks[id]) {\r\n            return this.tasks[id].extendedProperties[property];\r\n        }\r\n        return null;\r\n    },\r\n\r\n    /************************************************************************\r\n     ADD SECTION\r\n     ************************************************************************/\r\n\r\n    addTask: function(taskType, position, predecessor) {\r\n        var task = {\r\n            id: this.newGuid(),\r\n            type: taskType,\r\n            displayName: this.getDefaultName(taskType),\r\n            durationInMinutes: this.getDuration(taskType),\r\n            position: position,\r\n            showAura: false,\r\n            predecessors: [],\r\n            successors: [],\r\n            connectors: [],\r\n            rules: [],\r\n            extendedProperties: {}\r\n        };\r\n        // Add predecessor\r\n        if (predecessor) task.predecessors.push(predecessor);\r\n\r\n        // Add the new task\r\n        this.tasks[task.id] = task;\r\n\r\n        // Add succesor to predecessor\r\n        if (this.tasks[predecessor]) {\r\n            this.tasks[predecessor].successors.push(task.id);\r\n            this.tasks[predecessor].connectors.push({\r\n                \"successor\": task.id,\r\n                \"displayName\": \"\",\r\n                \"displayNamePosition\": {\r\n                    \"x\": 20,\r\n                    \"y\": 20\r\n                }\r\n            });\r\n        }\r\n        // Set the new task, to use the aura\r\n        this.setAura(task.id, true);\r\n\r\n        // Publish event\r\n        this.triggerModelChange();\r\n    },\r\n\r\n    addConnection: function(sourceTaskId, targetTaskId) {\r\n        var source = this.tasks[sourceTaskId];\r\n        var target = this.tasks[targetTaskId];\r\n        var isPresent = false;\r\n        for (var key in source.successors) {\r\n            if (source.successors[key] === targetTaskId) isPresent = true;\r\n        }\r\n        if (!isPresent) {\r\n            source.successors.push(targetTaskId);\r\n            source.connectors.push({\r\n                \"successor\": targetTaskId,\r\n                \"displayName\": \"\",\r\n                \"displayNamePosition\": {\r\n                    \"x\": 20,\r\n                    \"y\": 20\r\n                }\r\n            });\r\n            target.predecessors.push(sourceTaskId);\r\n        }\r\n        // Publish event\r\n        this.triggerModelChange();\r\n    },\r\n\r\n    /************************************************************************\r\n     EDIT SECTION\r\n     ************************************************************************/\r\n\r\n    changeTaskName: function(id, newDisplayName) {\r\n        if (this.tasks[id]) {\r\n            if (this.tasks[id].displayName == newDisplayName) return;\r\n            this.tasks[id].displayName = newDisplayName;\r\n            // Publish event but don't redraw'\r\n            this.triggerModelChange({ redraw: false });\r\n        }\r\n    },\r\n    changeConnectorName: function(source, successor, connectorName) {\r\n        if (this.tasks[source]) {\r\n            for (var i = 0; i < this.tasks[source].connectors.length; i++) {\r\n                if (this.tasks[source].connectors[i].successor == successor) {\r\n                    this.tasks[source].connectors[i].displayName = connectorName;\r\n                }\r\n            }\r\n            this.triggerModelChange({ redraw: false });\r\n        }\r\n    },\r\n    changeConnectorPos: function(idSourceTask, idTargetTask, labelPosition) {\r\n        if (this.tasks[idSourceTask]) {\r\n            for (var i = 0; i < this.tasks[idSourceTask].connectors.length; i++) {\r\n                if (this.tasks[idSourceTask].connectors[i].successor == idTargetTask) {\r\n                    this.tasks[idSourceTask].connectors[i].displayNamePosition.x = Math.round(labelPosition.x);\r\n                    this.tasks[idSourceTask].connectors[i].displayNamePosition.y = Math.round(labelPosition.y);\r\n                }\r\n            }\r\n            this.triggerModelChange({ redraw: false });\r\n        }\r\n    },\r\n    changeDuration: function(id, duration) {\r\n        if (this.tasks[id]) {\r\n            if (this.tasks[id].durationInMinutes == duration) return;\r\n            this.tasks[id].durationInMinutes = duration;\r\n            // Publish event but don't redraw'\r\n            this.triggerModelChange({ redraw: false });\r\n        }\r\n    },\r\n\r\n    changeTaskType: function(id, newType) {\r\n        if (this.tasks[id]) {\r\n            if (this.tasks[id].type == newType) return;\r\n            this.tasks[id].type = newType;\r\n            // if (newType === \"EmailTask\") this.tasks[id].duration = this.getDuration(this.tasks[id].type);\r\n            //if (newType === \"UserTask\") this.tasks[id].duration = this.tasks[id].duration;\r\n            // Publish event\r\n            this.triggerModelChange();\r\n            this.triggerChangeShape();\r\n        }\r\n    },\r\n\r\n    moveTask: function(id, position) {\r\n        if (this.tasks[id]) {\r\n            this.tasks[id].position = position;\r\n\r\n            // Publish event\r\n            this.triggerModelChange();\r\n        }\r\n    },\r\n\r\n    setAura: function(id, showAura) {\r\n        $.each(this.tasks, function(key, task) {\r\n            task.showAura = false;\r\n        });\r\n        if (this.tasks[id]) {\r\n            this.tasks[id].showAura = showAura;\r\n        }\r\n    },\r\n\r\n    setConnectionRule: function(sourceTaskId, targetTaskId, expression) {\r\n        var source = this.tasks[sourceTaskId];\r\n\r\n        // Get / create rule\r\n        var rules = $.grep(source.rules, function(rule) {\r\n            return rule.target == targetTaskId;\r\n        });\r\n        var rule = rules.length > 0 ? rules[0] : { target: targetTaskId };\r\n        if (rules.length == 0) source.rules.push(rule);\r\n\r\n        // Change rule (possible values: boolean/else)\r\n        rule.expression = expression;\r\n\r\n        // Publish event\r\n        this.triggerModelChange();\r\n    },\r\n\r\n    /************************************************************************\r\n     DELETE SECTION\r\n     ************************************************************************/\r\n    removeConnectorsInPredecessors: function(task, predecesor) {\r\n        for (var i = 0; i < this.tasks[predecesor].connectors.length; i++) {\r\n            if (this.tasks[predecesor].connectors[i].successor == task) {\r\n                this.tasks[predecesor].connectors.splice(i, 1);\r\n            }\r\n        }\r\n    },\r\n    deleteTask: function(id) {\r\n        var that = this;\r\n        $.each(this.tasks, function(key, task) {\r\n            // Remove from predecessors\r\n            if (task.predecessors && task.predecessors.length > 0) {\r\n                task.predecessors.removeAll(id);\r\n                for (var i = 0; i < task.predecessors.length; i++) {\r\n                    that.removeConnectorsInPredecessors(id, task.predecessors[i]);\r\n                }\r\n            }\r\n            // Remove from successors\r\n            if (task.successors && task.successors.length > 0) task.successors.removeAll(id);\r\n\r\n\r\n        });\r\n\r\n        // Remove task\r\n        delete this.tasks[id];\r\n\r\n        // Publish event\r\n        this.triggerModelChange();\r\n    },\r\n\r\n    deleteArrow: function(sourceTaskId, targetTaskId) {\r\n        var that = this;\r\n        var source = this.tasks[sourceTaskId];\r\n        var target = this.tasks[targetTaskId];\r\n\r\n        if (source) source.successors.removeAll(targetTaskId);\r\n        if (target) target.predecessors.removeAll(sourceTaskId);\r\n\r\n        //Remove connectors\r\n        that.removeConnectorsInPredecessors(targetTaskId, sourceTaskId);\r\n\r\n        if (source.rules.length > 0) {\r\n            for (var i = 0; i < source.rules.length; i++) {\r\n                var rule = source.rules[i].target;\r\n                if (source.successors.indexOf(rule) == -1) {\r\n                    source.rules.splice(i, 1);\r\n                }\r\n            }\r\n        }\r\n        // Publish event\r\n        this.triggerModelChange();\r\n    },\r\n\r\n    /************************************************************************\r\n     MISC METHODS SECTION\r\n     ************************************************************************/\r\n\r\n    newGuid: function() {\r\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n            var r = Math.random() * 16 | 0,\r\n                v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n        });\r\n    },\r\n\r\n    getDefaultName: function(taskType) {\r\n        var displaySecuence = 0;\r\n        var numbersOfNameTask = [];\r\n        var uniqueSecuence = [];\r\n        var numberPattern = /\\d+/g;\r\n        var manualTasks = [];\r\n        var key = 'Task';\r\n        if(bizagi.bpmn.modeler.viewer.featureLocalization){\r\n            key = bizagi.bpmn.modeler.viewer.getKeyLocalization(\"workportal-process-modeler-task\");\r\n        }\r\n        if (taskType == \"UserTask\" || taskType == \"EmailTask\") {\r\n\r\n            /* var manualTasks = $.grep(Object.values(this.tasks), function( task ) {\r\n                 return task.type == \"UserTask\";\r\n             });*/\r\n            for (var task in this.tasks) {\r\n                if (this.tasks[task].type === \"UserTask\" || this.tasks[task].type === \"EmailTask\") {\r\n                    manualTasks.push(this.tasks[task])\r\n                }\r\n            }\r\n            if (manualTasks.length > 0) {\r\n                for (var i = 0; i < manualTasks.length; i++) {\r\n                    if (manualTasks[i].displayName.indexOf(key) == 0) {\r\n                        var secuence = manualTasks[i].displayName.match(numberPattern);\r\n                        numbersOfNameTask.push(parseInt(secuence));\r\n                    }\r\n                }\r\n\r\n                numbersOfNameTask = numbersOfNameTask.sort(function(a, b) {\r\n                    return a - b;\r\n                });\r\n\r\n                /*\r\n                $.each(numbersOfNameTask, function(i, el){\r\n                    if($.inArray(el, uniqueSecuence) === -1 && el !=0 ) uniqueSecuence.push(el);\r\n                });*/\r\n                for (var i = 0; i < numbersOfNameTask.length; i++) {\r\n                    if ($.inArray(numbersOfNameTask[i], uniqueSecuence) === -1 && numbersOfNameTask[i] != 0) uniqueSecuence.push(numbersOfNameTask[i]);\r\n                }\r\n            }\r\n\r\n            for (var i = 1; i <= uniqueSecuence.length; i++) {\r\n                displaySecuence = i;\r\n                if (uniqueSecuence[i - 1] > i) {\r\n                    displaySecuence = displaySecuence - 1;\r\n                    break;\r\n                }\r\n            }\r\n            return key + \" \" + (displaySecuence + 1);\r\n        }\r\n        return null;\r\n    },\r\n\r\n    //DR\r\n    getDuration: function(taskType) {\r\n        if (taskType == \"UserTask\") {\r\n            return \"1h\";\r\n        }\r\n        return null;\r\n    },\r\n    //DR\r\n    parseDuration: function(value) {\r\n        if (String(value).indexOf(\"h\") == -1 && String(value).indexOf(\"m\") == -1) {\r\n            value += \"m\";\r\n            value = value.trim();\r\n        }\r\n        var regex = /(?:^\\d+h[ ]+\\d+m$)|(?:^\\d+[hm]?$)/;\r\n        if (typeof value != \"string\") {\r\n            return value;\r\n        } else {\r\n            value = value.trim();\r\n        }\r\n        if (regex.test(String(value))) {\r\n            var last_hour = \"\";\r\n            var last_minuts = \"\";\r\n            var resultMinuts = 0;\r\n            var hour = value.indexOf(\"h\");\r\n            if (hour != -1) {\r\n                last_hour = value.substring(0, hour);\r\n                last_hour = Math.floor(last_hour * 60);\r\n                value = value.split(\"h\").pop();\r\n                resultMinuts = last_hour;\r\n            }\r\n            var minuts = value.indexOf(\"m\");\r\n            if (minuts != -1) {\r\n                last_minuts = value.substring(0, minuts);\r\n                resultMinuts += parseInt(last_minuts);\r\n            }\r\n            return resultMinuts;\r\n        } else {\r\n            return null;\r\n        }\r\n    },\r\n    formatDuration: function(value) {\r\n        if (value != 0) {\r\n            var m = value % 60;\r\n            var h = (value - m) / 60;\r\n            var hoursMinutes = h.toString() + \"h \" + m.toString() + \"m\";\r\n            var result = hoursMinutes.replace(\" 0m\", \"\");\r\n            result = result.replace(\"0h\", \"\");\r\n            return result;\r\n        } else {\r\n            return \"0m\";\r\n        }\r\n    },\r\n    triggerModelRedraw: function() {\r\n        this.publish(\"model.redraw\");\r\n    },\r\n\r\n    triggerModelChange: function(params) {\r\n        params = params || { redraw: true };\r\n        this.publish(\"model.change\");\r\n        if (params.redraw) this.triggerModelRedraw();\r\n    },\r\n    triggerChangeShape: function(params) {\r\n        this.publish(\"shape.change\", params);\r\n    },\r\n    activeConfirmationPopup: function(item) {\r\n        return ((item === \"UserTask\") || (item === \"EmailTask\") || (item === \"IntermediateEvent\") || (this.isGateway(item)))\r\n    },\r\n    //return if the element is editable name\r\n    isEditableName: function(element) {\r\n        return !((element.type === 'StartEvent') ||\r\n            (element.type === 'EndEvent') ||\r\n            (element.type === 'TerminateEvent')\r\n        );\r\n    },\r\n    isEmailTask: function(type) {\r\n        return type = \"EmailTask\";\r\n    },\r\n    isEvent: function(type) {\r\n        return type == \"ExclusiveGateway\" || type == \"IntermediateEvent\";\r\n    },\r\n    isGateway: function(type) {\r\n        return type == \"ExclusiveGateway\" || type == \"ParallelGateway\" || type == \"InclusiveGateway\" || type == \"ComplexGateway\";\r\n    }\r\n});","bizagi.bpmn.modeler.observable.extend(\"bizagi.bpmn.modeler.aura\", {\r\n    /* STATIC STUFF */\r\n    externalOptions: {\r\n        \"form\": \"bz-icon bz-icon-template-outline\",\r\n        \"assignee\": \"bz-icon bz-icon-cog-outline\",\r\n        \"notify\": \"bz-icon bz-icon-cog-outline\"\r\n    },\r\n    getClassForExternalOption: function(type) {\r\n        return this.externalOptions[type];\r\n    },\r\n    getTitleForType: function(type) {\r\n        return this.toolBarTitles[type];\r\n    }\r\n}, {\r\n\r\n    /* INSTANCE STUFF */\r\n    /* Constructor */\r\n    init: function(model) {\r\n        // Define converter for task type class        \r\n        $.views.converters(\"externaloption_class\", function(val) {\r\n            return bizagi.bpmn.modeler.aura.getClassForExternalOption(val);\r\n        });\r\n\r\n        $.views.converters(\"getResourceLocalization\", function(val) {\r\n            var key = '';\r\n            var result = '';\r\n            if(bizagi.bpmn.modeler.viewer.featureLocalization){\r\n                key = bizagi.bpmn.modeler.toolbar.getTitleForType(val);\r\n                result = bizagi.bpmn.modeler.viewer.getKeyLocalization(key);\r\n            }else{\r\n                result = bizagi.bpmn.modeler.toolbar.getOldLocalization(val);\r\n            }\r\n            return result;\r\n        });\r\n        $.templates({\r\n            bpm_modeler_aura: '\\\r\n                <aura class=\"bpm-aura-for-{{:type}}\"> \\\r\n                 \\ <div class=\"wrapper-options\">\\\r\n                        {{if changeTo && changeTo.length > 0}} \\\r\n                            <special-option class=\"tooltip bpm-option-change bz-icon bz-icon-asynchronous-outline\"><span class=\"tooltiptext tooltip-right\"><p>{{title: \"changeType\"}}</p></span></special-option> \\\r\n                                <aura-change> \\\r\n                                    {{for changeTo tmpl=\"bpm_modeler_auraChangeTo\"/}} \\\r\n                                </aura-change> \\\r\n                        {{/if}} \\\r\n                    {{if externalOptions && externalOptions.length > 0}} \\\r\n                        <external-options> \\\r\n                            {{for externalOptions tmpl=\"bpm_modeler_auraExternalOption\"/}} \\\r\n                        </external-options> \\\r\n                    {{/if}} \\\r\n                     \\<special-options {{if showRuleOption}} class=\"bpm-show-rule-option\" {{/if}}> \\\r\n                        {{if showRuleOption}} \\\r\n                            <special-option class=\"tooltip bpm-option-expression bpmn-icon-conditional-flow\"><span class=\"tooltiptext tooltip-right\"><p>{{title: \"addExpression\"}}</p></span></special-option> \\\r\n                            <special-option class=\"tooltip bpm-option-else bpmn-icon-default-flow\"><span class=\"tooltiptext tooltip-right\"><p>{{title:\"elseExpression\"}}</p></span></special-option> \\\r\n                        {{/if}} \\\r\n                        <special-option class=\"tooltip bpm-option-delete bpmn-icon-trash bpmn-icon-trash-{{:type}}\"><span class=\"tooltiptext tooltip-right\"><p>{{title: \"deleteShape\"}}</p></span></special-option> \\\r\n                        </special-options> \\\r\n                         \\ <aura-confirmation-delete class=\"popup__confirmationDelete\"> \\\r\n                                                    <div>\\\r\n                                                        <p>{{getResourceLocalization: \"deleteConfirmationMessage\"}}</p>\\\r\n                                                        <div class=\"contentButtons\">\\\r\n                                                            <div class=\"btn btn__confirmation btn__confirmation--yes\">{{getResourceLocalization: \"confirmDeleteShape\"}}</div>\\\r\n                                                            <div class=\"btn btn__confirmation btn__confirmation--no\">{{getResourceLocalization: \"cancelDeleteShape\"}}</div>\\\r\n                                                        </div>\\\r\n                                                        <span class=\"downArrow\"></span>\\\r\n                                                    </div>\\\r\n                                                </aura-cofirmation-delete>\\\r\n                        </div>\\\r\n                        \\<div class=\"wrapper-aura-options\">\\\r\n                            {{for options tmpl=\"bpm_modeler_auraOption\"/}} \\\r\n                             \\{{if showArrow}} \\\r\n                            <aura-option class=\"tooltip bpm-option-arrow bpmn-icon-connection\" data-predecessor=\"{{:~root.id}}\"><span class=\"tooltiptext tooltip-right\"><p>{{title: \"flowSecuence\"}}</p></span></aura-option> \\\r\n                        {{/if}} \\\r\n                        \\</div>\\\r\n                  </aura>',\r\n            bpm_modeler_auraOption: '<aura-option class=\"{{if ~#data==\"IntermediateEvent\"}}bpm-aura-intermediate-icon{{/if}} tooltip bpm-{{:#data}} {{tasktype_class: #data}} bpm-cloneable\" \\\r\n                                            data-type=\"{{:#data}}\" \\\r\n                                            data-predecessor=\"{{:~root.id}}\">\\\r\n                                            <span class=\"tooltiptext tooltip-right\"><p>{{title: #data}}</p></span>\\\r\n                                        </aura-option>',\r\n            bpm_modeler_auraChangeTo: '<aura-change-to class=\"tooltip bpm-{{:#data}} {{tasktype_class: #data}}\"  \\\r\n                                                data-type=\"{{:#data}}\" \\\r\n                                                data-task=\"{{:~root.id}}\">\\\r\n                                                <span class=\"tooltiptext tooltip-right\"><p>{{title: #data}}</p></span>\\\r\n                                        </aura-change-to>',\r\n            bpm_modeler_auraExternalOption: '{{if (~root.type ===\"EmailTask\" && #data ===\"notify\") || ((~root.type === \"UserTask\" || ~root.type==\"IntermediateEvent\") && (#data === \"form\" || #data ===\"assignee\") )}} \\\r\n                                            <external-option class=\"tooltip bpm-{{:#data}} {{externaloption_class: #data}}\" \\\r\n                                                        data-option=\"{{:#data}}\" \\\r\n                                                        data-task=\"{{:~root.id}}\">\\\r\n                                                        <span class=\"tooltiptext tooltip-right\"><p>{{title: #data}}</p></span>\\\r\n                                                </external-option>{{/if}}',\r\n        });\r\n\r\n        // Set class variables\r\n        this.model = model;\r\n        this.previousElementId = null;\r\n        this.aura = null;\r\n        this.isActiveConfirmDialog = false;\r\n    },\r\n    /*FUNCTION FOR VALIDATE IF THE ELEMNT ADD ARROW OPTION*/\r\n    isEndEvent: function(task) {\r\n        if (task.data(\"type\") === 'EndEvent' || task.data(\"type\") === 'TerminateEvent') {\r\n            return false;\r\n        } else {\r\n            return true;\r\n        }\r\n    },\r\n    /************************************************************************\r\n     SHOW METHODS SECTION\r\n     ************************************************************************/\r\n    showForTask: function(task) {\r\n        var that = this;\r\n        var taskId = task.attr(\"id\");\r\n        var typeShape = this.model.getTaskById(taskId);\r\n        var params = {\r\n            type: typeShape.type,\r\n            options: this.getOptions(task),\r\n            changeTo: this.getChangeTo(task),\r\n            externalOptions: this.getExternalOptions(task),\r\n            showArrow: this.isEndEvent(task),\r\n            positioning: \"right\"\r\n        };\r\n\r\n        // Show aura\r\n        var shown = this.show(task, params);\r\n\r\n        if (shown) {\r\n            // Put special options at bottom\r\n            var specialOptions = this.aura.find(\".wrapper-options\");\r\n            var typeItem = this.model.getTaskById(task.attr(\"id\"));\r\n            specialOptions.css('display', 'absolute');\r\n\r\n            switch (typeItem.type) {\r\n                case 'UserTask':\r\n                    specialOptions.position({ of: task, my: \"center-47 top-35\", at: \"center top\", collision: \"none\" });\r\n                    // Publish event\r\n                    this.publish(\"task.click\", { task: taskId, option: \"assignee\", type: typeItem.type }); //To detect click in the task and inform angular code to keep the properties right side bar if is is open \r\n                    break;\r\n                case 'EmailTask':\r\n                    specialOptions.position({ of: task, my: \"center-47 top-35\", at: \"center top\", collision: \"none\" });\r\n                    break;\r\n                case 'IntermediateEvent':\r\n                    specialOptions.position({ of: task, my: \"center-43 top-42\", at: \"center top\", collision: \"none\" });\r\n                    this.publish(\"task.click\", { task: taskId, option: \"assignee\", type: typeItem.type }); //To detect click in the task and inform angular code to keep the properties right side bar if is is open\r\n                    break;\r\n                case 'StartEvent':\r\n                    specialOptions.position({ of: task, my: \"center top-48\", at: \"center top\", collision: \"none\" });\r\n                    break;\r\n                case 'EndEvent':\r\n                case 'TerminateEvent':\r\n                case 'ParallelGateway':\r\n                case 'ExclusiveGateway':\r\n                    specialOptions.position({ of: task, my: \"center-18 top-48\", at: \"center top\", collision: \"none\" });\r\n                    break;\r\n                default:\r\n                    specialOptions.position({ of: task, my: \"center-8 top+25\", at: \"center bottom\", collision: \"none\" });\r\n                    break;\r\n            }\r\n\r\n\r\n\r\n            // Manage changeTo handler\r\n            this.aura.find(\"special-option.bpm-option-change\").on(\"click\", function() { that.showChangeToOptions(this, typeItem.type); });\r\n\r\n            // Manage delete handler\r\n            this.aura.find(\"special-option.bpm-option-delete\").on(\"click\", function() { that.activePopupConfirmationDelete(this, taskId); });\r\n\r\n            //new\r\n            this.aura.find(\"aura-confirmation-delete .contentButtons .btn\").on(\"click\", function() { that.actionConfirmDelete(this, taskId); });\r\n\r\n            // Manage external options handler\r\n            this.aura.find(\"external-option\").on(\"click\", function() {\r\n                that.manageExternalOption($(this), taskId);\r\n            });\r\n\r\n            // Make arrow dragabble\r\n            this.aura.find(\"aura-option.bpm-option-arrow\").draggable({\r\n                helper: \"clone\",\r\n                containment: \"#bpm-drawing\",\r\n                grid: [20, 20],\r\n                drag: function(ev, ui) { that.dragArrow(ui, taskId); }\r\n            });\r\n        }\r\n\r\n        return shown;\r\n    },\r\n\r\n    showForArrow: function(arrow, showRuleOption) {\r\n        var that = this;\r\n        var arrowId = arrow.attr(\"id\");\r\n        var params = {\r\n            type: \"arrow\",\r\n            positioning: \"center\",\r\n            showRuleOption: showRuleOption\r\n        }\r\n\r\n        // Show aura\r\n        var shown = this.show(arrow, params);\r\n\r\n        if (shown) {\r\n            // Put special options at bottom\r\n            var specialOptions = this.aura.find(\".wrapper-options\");\r\n            specialOptions.position({ of: arrow, my: \"center center\", at: \"center+20 center-20\", collision: \"none\" });\r\n\r\n            this.aura.find(\"special-option.bpm-option-delete\").addClass(\"bpmn-icon-trash--arrow\");\r\n            // Manage delete handler\r\n            this.aura.find(\"special-option.bpm-option-delete\").on(\"click\", function() { that.deleteArrow(arrowId); });\r\n\r\n            // Manage rule handler\r\n            this.addHandlersForExpressions(arrowId);\r\n        }\r\n\r\n        return shown;\r\n    },\r\n\r\n    show: function(element, params) {\r\n        var that = this;\r\n        var elementId = element.attr(\"id\");\r\n\r\n        // Check previous element to toggle on/off\r\n        if (this.previousElementId) {\r\n            var isSame = this.previousElementId == elementId;\r\n            this.hide(this.previousElementId);\r\n            if (isSame) return false;\r\n        }\r\n        this.previousElementId = elementId;\r\n\r\n        // Render template\r\n        var aura = $.templates.bpm_modeler_aura.render($.extend(params, { id: elementId }));\r\n        this.aura = $(aura);\r\n        element.after(this.aura);\r\n        this.moveTo(element, params.positioning);\r\n\r\n        // Put external options at top\r\n        if (params.externalOptions) {\r\n            var externalOptions = this.aura.find(\"external-options\");\r\n            //externalOptions.position({ of: element, my: \"center-42 bottom+16\", at: \"center top\", collision: \"none\" });\r\n        }\r\n\r\n        // Make items draggable\r\n        this.aura.find(\"aura-option\").draggable({\r\n            helper: \"clone\",\r\n            containment: \"#bpm-drawing\",\r\n            grid: [20, 20],\r\n            drag: function(ev, ui) { that.publish(\"item.drag\", ui); }\r\n        });\r\n\r\n        return true;\r\n    },\r\n\r\n    /************************************************************************\r\n     OTHER PUBLIC METHODS SECTION\r\n     ************************************************************************/\r\n\r\n    hide: function(elementId) {\r\n        elementId = elementId || this.previousElementId;\r\n        if (elementId == null) return;\r\n        if (this.aura) this.aura.detach();\r\n        this.previousElementId = null;\r\n    },\r\n\r\n    moveTo: function(element, positioning) {\r\n        var id = element.attr(\"id\");\r\n        if (id != this.previousElementId) {\r\n            this.hide();\r\n            return;\r\n        }\r\n        // Only perform the move when the aura is displayed for the given task\r\n        positioning = positioning || \"right\";\r\n        if (positioning == \"right\")\r\n            this.aura.position({ of: element, my: \"left+20 center\", at: \"right center\", collision: \"none\" });\r\n    },\r\n\r\n\r\n    /************************************************************************\r\n     HANDLER METHODS SECTION\r\n     ************************************************************************/\r\n    showChangeToOptions: function(element, type) {\r\n        var changeToOptions = this.aura.find(\"aura-change\");\r\n        changeToOptions.toggleClass(\"visible\");\r\n        changeToOptions.position({ of: element, my: \"center top-60\", at: \"center top\", collision: \"none\" });\r\n        //Change position of aura-change when the element is on top limit.\r\n        var auraTopPosition = this.aura.position().top;\r\n        var limitTopPosition = type === \"UserTask\" ? 57 : 120;\r\n        if (auraTopPosition < limitTopPosition) {\r\n            changeToOptions.css({'top':33});\r\n        }\r\n        // Add click handlers\r\n        changeToOptions.find(\"aura-change-to\").click($.proxy(this.changeTo, this));\r\n    },\r\n\r\n    addHandlersForExpressions: function(arrowId) {\r\n        var that = this;\r\n\r\n        // Add click handlers\r\n        this.aura.find(\".bpm-option-else\").click(function() {\r\n            var source = bizagi.bpmn.modeler.connector.getSourceTaskFromId(arrowId);\r\n            var target = bizagi.bpmn.modeler.connector.getTargetTaskFromId(arrowId);\r\n\r\n            // Publish event\r\n            that.publish(\"arrow.setElse\", arrowId);\r\n\r\n            // Change model\r\n            that.model.setConnectionRule(source, target, \"else\");\r\n        });\r\n        this.aura.find(\".bpm-option-expression\").click(function() {\r\n            // Publish event\r\n            that.publish(\"arrow.setExpression\", arrowId);\r\n        });\r\n    },\r\n    activePopupConfirmationDelete: function(element, taskId) {\r\n        var item = this.model.getTaskById(taskId);\r\n        var deleteOptions = this.aura.find(\".popup__confirmationDelete\");\r\n        var left = $(element).position().left;\r\n        var top = $(element).position().top;\r\n\r\n        if (this.model.activeConfirmationPopup(item.type)) {\r\n            this.isActiveConfirmDialog = true;\r\n            if (item.position.y < 170) {\r\n                $(deleteOptions).css({ \"top\": top + 38, \"left\": left - 90 });\r\n                $(deleteOptions).find(\".downArrow\").addClass(\"rotateArrow\");\r\n            } else {\r\n\r\n                $(deleteOptions).css({ \"top\": top - 115, \"left\": left - 90 })\r\n            }\r\n            $(deleteOptions).show();\r\n        } else {\r\n            this.deleteTask(taskId);\r\n        }\r\n\r\n    },\r\n    actionConfirmDelete: function(ev, taskId) {\r\n        var event = ev;\r\n        var btn = event.className;\r\n        var deleteOptions = this.aura.find(\".popup__confirmationDelete\");\r\n        if (btn.indexOf('--yes') > 0) {\r\n            this.deleteTask(taskId);\r\n        } else {\r\n            this.isActiveConfirmDialog = false;\r\n            $(deleteOptions).hide();\r\n        }\r\n    },\r\n    deleteTask: function(taskId) {\r\n        this.model.deleteTask(taskId);\r\n    },\r\n\r\n    deleteArrow: function(arrowId) {\r\n        var source = bizagi.bpmn.modeler.connector.getSourceTaskFromId(arrowId);\r\n        var target = bizagi.bpmn.modeler.connector.getTargetTaskFromId(arrowId);\r\n        this.model.deleteArrow(source, target);\r\n    },\r\n\r\n    dragArrow: function(ui, elementId) {\r\n        // Publish event\r\n        this.publish(\"arrow.drag\", { source: elementId, target: ui.offset });\r\n    },\r\n\r\n    changeTo: function(ev) {\r\n        var changeOption = $(ev.currentTarget);\r\n        var type = changeOption.data(\"type\");\r\n        var task = changeOption.data(\"task\");\r\n\r\n        // Publish event\r\n        this.model.changeTaskType(task, type);\r\n    },\r\n\r\n    manageExternalOption: function(externalOption, taskId) {\r\n        var option = externalOption.data(\"option\");\r\n        // Publish event\r\n        this.publish(\"task.externaloption\", { task: taskId, option: option });\r\n    },\r\n\r\n    /************************************************************************\r\n     MISC METHODS SECTION\r\n     ************************************************************************/\r\n    getOptions: function(task) {\r\n        var type = task.data(\"type\");\r\n        if (type == \"EndEvent\" || type == 'TerminateEvent') return [];\r\n\r\n        return [\r\n            \"UserTask\",\r\n            \"IntermediateEvent\",\r\n            \"ExclusiveGateway\",\r\n            \"EndEvent\"\r\n        ];\r\n    },\r\n\r\n    getChangeTo: function(task) {\r\n        var type = task.data(\"type\");\r\n        var possibleChanges = [];\r\n        if (type == \"ExclusiveGateway\" || type == \"ParallelGateway\" || type == \"InclusiveGateway\" || type == \"ComplexGateway\") {\r\n            //possibleChanges =  [ \"ParallelGateway\", \"ExclusiveGateway\"];\r\n            possibleChanges = [\"ParallelGateway\", \"InclusiveGateway\", \"ComplexGateway\", \"ExclusiveGateway\"];\r\n        } else if (type == \"EndEvent\" || type == \"TerminateEvent\") {\r\n            possibleChanges = [\"EndEvent\", \"TerminateEvent\"];\r\n        } else if (type === \"UserTask\" || type === \"EmailTask\") {\r\n            possibleChanges = [\"EmailTask\", \"UserTask\"];\r\n        }\r\n        if (possibleChanges.length > 0) {\r\n            possibleChanges.removeOne(type);\r\n            return possibleChanges\r\n        }\r\n        return null;\r\n    },\r\n\r\n    getExternalOptions: function(task) {\r\n        var type = task.data(\"type\");\r\n        if (type != \"UserTask\" && type != \"IntermediateEvent\" && type != \"EmailTask\") return [];\r\n\r\n        return [\"form\", \"assignee\", \"notify\"];\r\n    }\r\n});","$.Class.extend(\"bizagi.bpmn.modeler.path\", {}, {\r\n    curve: 8,\r\n    arrowHeight: 10,\r\n    calculateAnchors: function(el1, el2){\r\n        var threshold_x = Math.min(el1.width, el2.width);\r\n        var threshold_y = Math.min(el1.height, el2.height);\r\n        var e1xh = el1.x + el1.width /2;\r\n        var e2xh = el2.x + el2.width /2;\r\n        var e1yh = el1.y + el1.height /2;\r\n        var e2yh = el2.y + el2.height /2;\r\n\r\n        // FIRST CASES, THE ELEMENTS ARE FAR ENOUGH IN X-AXIS\r\n        // Task 1 is at x from Task 2\r\n        if (el1.x + el1.width + threshold_x < el2.x) return {el1: \"right\", el2: \"left\"};\r\n        // Task 1 is at right from Task 2\r\n        if (el1.x > el2.x + el2.width + threshold_x) return {el1: \"left\", el2: \"right\"};\r\n\r\n        /* SECOND CASES, THE ELEMENT'S CENTERS ARE VERY CLOSE IN X-AXIS*/\r\n        if(this.areElementsVeryCloseInXAxis(el1, el2, threshold_x)){\r\n            // Task 1 and Task 2 centers are almost in the same x-axis position, but task 1 is on y of task 2 \r\n            if (el1.y + el1.height < el2.y) return {el1: \"bottom\", el2: \"top\"};\r\n            // Task 1 and Task 2 centers are almost in the same x-axis position, but task 1 is on bottom of task 2\r\n            if (el1.y > el2.y + el2.height) return {el1: \"top\", el2: \"bottom\"};\r\n        }\r\n\r\n        // THIRD CASES, THE ELEMENTS ARE VERY CLOSE IN X-AXIS, AND VERY CLOSE IN Y-AXIS\r\n        if(Math.abs(e1yh - e2yh) < threshold_y){\r\n            // Task 1 is at x from Task 2\r\n            if (el1.x < el2.x) return {el1: \"right\", el2: \"left\"};\r\n            // Task 1 is at right from Task 2\r\n            if (el1.x >= el2.x) return {el1: \"left\", el2: \"right\"};\r\n        }\r\n\r\n        // FOURTH CASES, THE ELEMENTS ARE CLOSE BUT NOT SO CLOSE, SO WE NEED TO MOVE THE ANCHORS\r\n        if (e1xh < e2xh && e1yh < e2yh) return {el1: \"bottom\", el2: \"left\"};\r\n        if (e1xh > e2xh && e1yh < e2yh) return {el1: \"bottom\", el2: \"right\"};\r\n        if (e1xh < e2xh && e1yh > e2yh) return {el1: \"top\", el2: \"left\"};\r\n        if (e1xh > e2xh && e1yh > e2yh) return {el1: \"top\", el2: \"right\"};\r\n    },\r\n\r\n    getPath: function(box, anchors, el1, el2){\r\n        var threshold_x = Math.min(el1.width, el2.width);\r\n        var threshold_y = Math.min(el1.height, el2.height);\r\n        var coords = { x:this.arrowHeight, y: this.arrowHeight, w: box.width - this.arrowHeight, h: box.height - this.arrowHeight};\r\n\r\n        /* STRAIGHT LINE CASES */\r\n        if (this.areVerticalAnchors(anchors) && Math.abs(el1.x - el2.x) < 10){\r\n            // Task 1 is at y from task2, and the difference in x-axis is very small\r\n            if (el1.y < el2.y) return this.getPathTopToBottom(coords, el1, el2);\r\n            // Task 1 is at bottom from task2, and the difference in x-axis is very small\r\n            if (el1.y > el2.y) return this.getPathBottomToTop(coords, el1, el2);\r\n        }\r\n        if (this.areHorizontalAnchors(anchors) && Math.abs(el1.y - el2.y) < 10){\r\n            // Task 1 is at x from task2, and the difference in y-axis is very small\r\n            if (el1.x < el2.x) return this.getPathLeftToRight(coords);\r\n            // Task 1 is at right from task2, and the difference in y-axis is very small\r\n            if (el1.x > el2.x) return this.getPathRightToLeft(coords);\r\n        }\r\n\r\n        /* MUST DRAW TWO CURVE CASES */\r\n        if (this.areHorizontalAnchors(anchors)){\r\n            // Task 1 is at x-y from task2\r\n            if (el1.x < el2.x && el1.y < el2.y) return this.getPathLeftToRightBottom(coords);\r\n            // Task 1 is at x-bottom from task2\r\n            if (el1.x < el2.x && el1.y > el2.y) return this.getPathLeftToRightTop(coords);\r\n            // Task 1 is at right-y from task2\r\n            if (el1.x > el2.x && el1.y < el2.y) return this.getPathRightToLeftBottom(coords);\r\n            // Task 1 is at right-bottom from task2\r\n            if (el1.x > el2.x && el1.y > el2.y ) return this.getPathRightToLeftTop(coords);\r\n        }\r\n        if (this.areVerticalAnchors(anchors)){\r\n            // Task 1 is at x-y from task2\r\n            if (el1.x < el2.x && el1.y < el2.y) return this.getPathTopToBottomLeft(coords);\r\n            // Task 1 is at x-bottom from task2\r\n            if (el1.x < el2.x && el1.y > el2.y) return this.getPathBottomToTopLeft(coords);\r\n            // Task 1 is at right-y from task2\r\n            if (el1.x > el2.x && el1.y < el2.y) return this.getPathTopToBottomRight(coords);\r\n            // Task 1 is at right-bottom from task2\r\n            if (el1.x > el2.x && el1.y > el2.y ) return this.getPathBottomToTopRight(coords);\r\n        }\r\n\r\n        /* MUST DRAW ONE CURVE CASES*/\r\n        if (anchors.el1 == \"bottom\" && anchors.el2 == \"left\") return this.getPathBottomToLeft(coords);\r\n        if (anchors.el1 == \"bottom\" && anchors.el2 == \"right\") return this.getPathBottomToRight(coords);\r\n        if (anchors.el1 == \"top\" && anchors.el2 == \"left\") return this.getPathTopToLeft(coords);\r\n        if (anchors.el1 == \"top\" && anchors.el2 == \"right\") return this.getPathTopToRight(coords);\r\n    },\r\n\r\n    getTransform: function(anchors, el1, el2){\r\n        if (this.areVerticalAnchors(anchors)){\r\n            if (Math.abs(el1.x - el2.x) < this.arrowHeight) return \"translate(5, 0)\";\r\n        }\r\n        if (anchors.el1 == \"left\" || anchors.el1 == \"right\"){\r\n            if (Math.abs(el1.y - el2.y) < this.arrowHeight) return \"translate(0, 5)\";\r\n        }\r\n        return \"\";\r\n    },\r\n\r\n    areHorizontalAnchors: function(anchors){\r\n        return (anchors.el1 == \"left\" && anchors.el2 == \"right\") || (anchors.el1 == \"right\" && anchors.el2 == \"left\");\r\n    },\r\n\r\n    areVerticalAnchors: function(anchors){\r\n        return (anchors.el1 == \"top\" && anchors.el2 == \"bottom\") || (anchors.el1 == \"bottom\" && anchors.el2 == \"top\");\r\n    },\r\n\r\n    areElementsVeryCloseInXAxis: function(el1, el2, threshold){\r\n        var e1xh = el1.x + el1.width /2;\r\n        var e2xh = el2.x + el2.width /2;\r\n        // Centers are very close\r\n        if (Math.abs(e1xh - e2xh) < threshold) return true;\r\n        // Center of 1 is close to left edge of 2\r\n        if (Math.abs(e1xh - el2.x) < threshold) return true;\r\n        // Center of 1 is close to right  edge of 2\r\n        if (Math.abs(e1xh - el2.x + el2.width) < threshold) return true;\r\n        // Center of 2 is close to left edge of 1\r\n        if (Math.abs(e2xh - el1.x) < threshold) return true;\r\n        // Center of 2 is close to right  edge of 1\r\n        if (Math.abs(e2xh - el1.x + el1.width) < threshold) return true;\r\n        return false;\r\n    },\r\n\r\n    /* STRAIGHT LINES */\r\n    getPathLeftToRight: function(coords){\r\n        var x1 = coords.x, x2 = coords.w, y1 = coords.h/2, y2 = coords.h/2;\r\n        return  \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x2 + \",\" + y2 + \" \" +  // Go to the end\r\n            this.getArrowRight(x2, y2);\r\n    },\r\n\r\n    getPathRightToLeft: function(coords){\r\n        var x1 = coords.w, x2 = coords.x, y1 = coords.h/2, y2 = coords.h/2;\r\n        return  \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x2 + \",\" + y2 + \" \" +    // Go to the end\r\n            this.getArrowLeft(x2, y2);\r\n    },\r\n\r\n    getPathTopToBottom: function(coords, el1, el2){\r\n        var min = el1.x < el2.x ? this.arrowHeight : coords.w;\r\n        var x1 = min/2, x2 = min/2, y1 = coords.y, y2 = coords.h;\r\n        return  \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x2 + \",\" + y2 + \" \" +  // Go to the end\r\n            this.getArrowDown(x2, y2);\r\n    },\r\n\r\n    getPathBottomToTop: function(coords, el1, el2){\r\n        var min = el1.x < el2.x ? this.arrowHeight : coords.w;\r\n        var x1 = min/2, x2 = min/2, y1 = coords.h, y2 = coords.y;\r\n        return  \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x2 + \",\" + y2 + \" \" +  // Go to the end\r\n            this.getArrowUp(x2, y2);\r\n    },\r\n\r\n    /* TWO CURVES X-AXIS*/\r\n    getPathLeftToRightBottom: function(coords){\r\n        var x1 = coords.x, x2 = coords.w, y1 = coords.y, y2 = coords.h;\r\n        var xh = coords.w/2, yh = coords.h/2, c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + (xh - c) + \",\" + y1 + \" \" +  // Go half the way\r\n            \"S \" + xh + \",\" + y1 + \" \" + xh + \",\" + (y1 + c) + \" \" + // Create a corner\r\n            \"L \" + xh + \",\" + (y2 - c) + \" \" +  // Go down in y-axis\r\n            \"S \" + xh + \",\" + y2 + \" \" + (xh + c) + \",\" + y2 + \" \" + // Create a corner\r\n            \"L \" + x2 + \",\" + y2 + \" \" +  // Go another half-way\r\n            this.getArrowRight(x2, y2);\r\n\r\n    },\r\n\r\n    getPathLeftToRightTop: function(coords){\r\n        var x1 = coords.x, x2 = coords.w, y1 = coords.h, y2 = coords.y;\r\n        var xh = coords.w/2, yh = coords.h/2, c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + (xh - c) + \",\" + y1 + \" \" +  // Go half the way\r\n            \"S \" + xh + \",\" + y1 + \" \" + xh + \",\" + (y1 - c) + \" \" + // Create a corner\r\n            \"L \" + xh + \",\" + (y2 + c) + \" \" +  // Go up in y-axis\r\n            \"S \" + xh + \",\" + y2 + \" \" + (xh + c) + \",\" + y2 + \" \" + // Create a corner\r\n            \"L \" + x2  + \",\" + y2 + \" \" +  // Go another half-way\r\n            this.getArrowRight(x2, y2);\r\n    },\r\n\r\n    getPathRightToLeftBottom: function(coords){\r\n        var x1 = coords.w, x2 = coords.x, y1 = coords.y, y2 = coords.h;\r\n        var xh = coords.w/2, yh = coords.h/2, c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + (xh + c) + \",\" + y1 + \" \" +  // Go half the way in reverse\r\n            \"S \" + xh + \",\" + y1 + \" \" + xh + \",\" + (y1 + c) + \" \" + // Create a corner\r\n            \"L \" + xh + \",\" + (y2 - c) + \" \" +  // Go down in y-axis\r\n            \"S \" + xh + \",\" + y2 + \" \" + (xh - c) + \",\" + y2 + \" \" + // Create a corner\r\n            \"L \" + x2  + \",\" + y2 + \" \" +  // Go another half-way in reverse\r\n            this.getArrowLeft(x2, y2);\r\n    },\r\n\r\n    getPathRightToLeftTop: function(coords){\r\n        var x1 = coords.w, x2 = coords.x, y1 = coords.h, y2 = coords.y;\r\n        var xh = coords.w/2, yh = coords.h/2, c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + (xh + c) + \",\" + y1 + \" \" +  // Go half the way in reverse\r\n            \"S \" + xh + \",\" + y1 + \" \" + xh + \",\" + (y1 - c) + \" \" + // Create a corner\r\n            \"L \" + xh + \",\" + (y2 + c) + \" \" +  // Go up in y-axis\r\n            \"S \" + xh + \",\" + y2 + \" \" + (xh - c) + \",\" + y2 + \" \" + // Create a corner\r\n            \"L \" + x2  + \",\" + y2 + \" \" +  // Go another half-way in reverse\r\n            this.getArrowLeft(x2, y2);\r\n    },\r\n\r\n    /* TWO CURVES Y-AXIS*/\r\n    getPathTopToBottomLeft: function(coords){\r\n        var x1 = coords.x, x2 = coords.w, y1 = coords.y, y2 = coords.h;\r\n        var xh = coords.w/2, yh = coords.h/2, c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x1 + \",\" + (yh - c) + \" \" +  // Go half the way down\r\n            \"S \" + x1 + \",\" + yh + \" \" + (x1 + c) + \",\" + yh + \" \" + // Create a corner\r\n            \"L \" + (x2 - c) + \",\" + yh + \" \" +  // Go left in y-axis\r\n            \"S \" + x2 + \",\" + yh + \" \" + x2 + \",\" + (yh + c) + \" \" + // Create a corner\r\n            \"L \" + x2 + \",\" + y2 + \" \" +  // Go another half-way\r\n            this.getArrowDown(x2, y2);\r\n\r\n    },\r\n\r\n    getPathTopToBottomRight: function(coords){\r\n        var x1 = coords.w, x2 = coords.x, y1 = coords.y, y2 = coords.h;\r\n        var xh = coords.w/2, yh = coords.h/2, c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x1 + \",\" + (yh - c) + \" \" +  // Go half the way down\r\n            \"S \" + x1 + \",\" + yh + \" \" + (x1 - c) + \",\" + yh + \" \" + // Create a corner\r\n            \"L \" + (x2 + c) + \",\" + yh + \" \" +  // Go right in y-axis\r\n            \"S \" + x2 + \",\" + yh + \" \" + x2 + \",\" + (yh + c) + \" \" + // Create a corner\r\n            \"L \" + x2 + \",\" + y2 + \" \" +  // Go another half-way\r\n            this.getArrowDown(x2, y2);\r\n    },\r\n\r\n    getPathBottomToTopLeft: function(coords){\r\n        var x1 = coords.x, x2 = coords.w, y1 = coords.h, y2 = coords.y;\r\n        var xh = coords.w/2, yh = coords.h/2, c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x1 + \",\" + (yh + c) + \" \" +  // Go half the way up\r\n            \"S \" + x1 + \",\" + yh + \" \" + (x1 + c) + \",\" + yh + \" \" + // Create a corner\r\n            \"L \" + (x2 - c) + \",\" + yh + \" \" +  // Go left in y-axis\r\n            \"S \" + x2 + \",\" + yh + \" \" + x2 + \",\" + (yh - c) + \" \" + // Create a corner\r\n            \"L \" + x2 + \",\" + y2 + \" \" +  // Go another half-way\r\n            this.getArrowUp(x2, y2);\r\n\r\n    },\r\n\r\n    getPathBottomToTopRight: function(coords){\r\n        var x1 = coords.w, x2 = coords.x, y1 = coords.h, y2 = coords.y;\r\n        var xh = coords.w/2, yh = coords.h/2, c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x1 + \",\" + (yh + c) + \" \" +  // Go half the way up\r\n            \"S \" + x1 + \",\" + yh + \" \" + (x1 - c) + \",\" + yh + \" \" + // Create a corner\r\n            \"L \" + (x2 + c) + \",\" + yh + \" \" +  // Go right in y-axis\r\n            \"S \" + x2 + \",\" + yh + \" \" + x2 + \",\" + (yh - c) + \" \" + // Create a corner\r\n            \"L \" + x2 + \",\" + y2 + \" \" +  // Go another half-way\r\n            this.getArrowUp(x2, y2);\r\n\r\n    },\r\n\r\n    /* ONE CURVE */\r\n    getPathBottomToLeft: function(coords){\r\n        var x1 = coords.x, x2 = coords.w, y1 = coords.y, y2 = coords.h;\r\n        var c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x1 + \",\" + (y2 - c) + \" \" +  // Go down in y-axis\r\n            \"S \" + x1 + \",\" + y2 + \" \" + (x1 + c) + \",\" + y2 + \" \" + // Create a corner\r\n            \"L \" + x2 + \",\" + y2 + \" \" +  // Go to final position\r\n            this.getArrowRight(x2, y2);\r\n    },\r\n\r\n    getPathBottomToRight: function(coords){\r\n        var x1 = coords.w, x2 = coords.x, y1 = coords.y, y2 = coords.h;\r\n        var c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x1 + \",\" + (y2 - c) + \" \" +  // Go down in y-axis\r\n            \"S \" + x1 + \",\" + y2 + \" \" + (x1 - c) + \",\" + y2 + \" \" + // Create a corner\r\n            \"L \" + x2 + \",\" + y2 + \" \" + // Go to final position (reverse)\r\n            this.getArrowLeft(x2, y2);\r\n    },\r\n\r\n    getPathTopToLeft: function(coords){\r\n        var x1 = coords.x, x2 = coords.w, y1 = coords.h, y2 = coords.y;\r\n        var c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x1 + \",\" + (y2 + c) + \" \" +  // Go up in y-axis\r\n            \"S \" + x1 + \",\" + y2 + \" \" + (x1 + c) + \",\" + y2 + \" \" + // Create a corner\r\n            \"L \" + x2 + \",\" + y2 + \" \" +  // Go to final position\r\n            this.getArrowRight(x2, y2);\r\n    },\r\n\r\n    getPathTopToRight: function(coords){\r\n        var x1 = coords.w, x2 = coords.x, y1 = coords.h, y2 = coords.y;\r\n        var c = this.curve;\r\n        return      \"M \"  + x1 + \",\" + y1 + \" \" + // Start position\r\n            \"L \" + x1 + \",\" + (y2 + c) + \" \" +  // Go up in y-axis\r\n            \"S \" + x1 + \",\" + y2 + \" \" + (x1 - c) + \",\" + y2 + \" \" + // Create a corner\r\n            \"L \" + x2 + \",\" + y2 + \" \" + // Go to final position (reverse)\r\n            this.getArrowLeft(x2, y2);\r\n    },\r\n\r\n    /* ARROWS */\r\n    getArrowRight: function(x, y){\r\n        var ah = this.arrowHeight/2;\r\n        return  \"m -\" + ah + \",-\" + ah + \" \" +\r\n            \"l \" + ah + \",\" + ah + \" \" +\r\n            \"l -\" + ah + \",\" + ah;\r\n    },\r\n\r\n    getArrowLeft: function(x, y){\r\n        var ah = this.arrowHeight/2;\r\n        return  \"m \" + ah + \",-\" + ah + \" \" +\r\n            \"l -\" + ah + \",\" + ah + \" \" +\r\n            \"l \" + ah + \",\" + ah;\r\n    },\r\n\r\n    getArrowUp: function(x, y){\r\n        var ah = this.arrowHeight/2;\r\n        return  \"m -\" + ah + \",\" + ah + \" \" +\r\n            \"l \" + ah + \",-\" + ah + \" \" +\r\n            \"l \" + ah + \",\" + ah;\r\n    },\r\n\r\n    getArrowDown: function(x, y){\r\n        var ah = this.arrowHeight/2;\r\n        return  \"m -\" + ah + \",-\" + ah + \" \" +\r\n            \"l \" + ah + \",\" + ah + \" \" +\r\n            \"l \" + ah + \",-\" + ah;\r\n    }\r\n\r\n});","$.Class.extend(\"bizagi.bpmn.modeler.connector\", {\r\n\r\n    /* STATIC STUFF */\r\n    buildConnectorId: function(source, target){\r\n        return \"svgFrom_\" + source + \"_to_\" + target;\r\n    },\r\n\r\n    getSourceTaskFromId: function(id){\r\n        var i1 = id.indexOf(\"svgFrom_\");\r\n        var i2 = id.indexOf(\"_to_\");\r\n        return id.substring(i1 + 8, i2);\r\n    },\r\n\r\n    getTargetTaskFromId: function(id){\r\n        var i1 = id.indexOf(\"_to_\");\r\n        return id.substring(i1 + 4);\r\n    },\r\n\r\n\r\n}, {\r\n    /* INSTANCE STUFF */\r\n\r\n    /* Constructor */\r\n    init: function() {\r\n        $.templates({\r\n            bpm_modeler_connector: '<connector style=\"position:absolute;left:{{:left}}px;top:{{:top}}px\" \\\r\n                                                id=\"{{:id}}\" \\\r\n                                                class=\"bpm-{{:expression}}\" \\\r\n                                                data-expression=\"{{:expression}}\"> \\\r\n                                                <label class=\"label_connector_name\">{{:displayName}}</label> \\\r\n                                        <svg width=\"{{:width}}\" height=\"{{:height}}\"> \\\r\n                                            <path d=\"{{:path}}\" fill=\"none\" stroke=\"{{:stroke}}\" transform=\"{{:transform}}\"/> \\\r\n                                        </svg> \\\r\n                                        {{if expression == \"else\"}} <connector-label>else</connection-label> {{/if}} \\\r\n                                    </connector>'\r\n\r\n        });\r\n\r\n        // Create dependencies\r\n        this.path = new bizagi.bpmn.modeler.path();\r\n        this.stroke = \"#2C121C\";\r\n    },\r\n\r\n    connect: function(canvas, task1, task2, expression, displayName, labelConnectorPos){\r\n        var el1 = this.getBounds(task1);\r\n        var el2 = this.getBounds(task2);\r\n        var id = this.Class.buildConnectorId(task1.attr(\"id\"), task2.attr(\"id\"));\r\n        if(task1.attr(\"id\") != task2.attr(\"id\")) this.drawLine(canvas, id, el1, el2, expression, displayName, labelConnectorPos);\r\n    },\r\n\r\n    drawLine: function(canvas, id, el1, el2, expression, displayName,labelConnectorPos){\r\n        // Adjust positions for better fit\r\n        var anchors = this.modifyPositions(el1, el2);\r\n        var data = {\r\n            id: id,\r\n            top: this.getTop(el1, el2),\r\n            left: this.getLeft(el1, el2),\r\n            width: this.getWidth(el1, el2),\r\n            height: this.getHeight(el1, el2),\r\n            transform: this.path.getTransform(anchors, el1, el2),\r\n            expression: expression,\r\n            displayName: displayName,\r\n            stroke: this.stroke\r\n        };\r\n\r\n        // Create path\r\n        data.path =this.path.getPath(data, anchors, el1, el2);\r\n        var html = $.templates.bpm_modeler_connector.render(data);\r\n        connector = $(html);\r\n        canvas.append(connector);\r\n\r\n        // If ELSE\r\n        if (expression == \"else\"){\r\n            var svg = connector.find(\"svg\");\r\n            var elseLabel = connector.find(\"connector-label\");\r\n            elseLabel.position({ of: svg, my: \"center center\",  at: \"center center\", collision: \"none\"});\r\n        }\r\n        // attach event drag of label\r\n        $(\".label_connector_name\").draggable({\r\n            containment: \"#bpm-drawing\",\r\n            grid: [20, 20]\r\n        });\r\n\r\n        var labelConnectorName = $(connector).find(\".label_connector_name\");\r\n        if( labelConnectorPos ){\r\n            $(labelConnectorName).css({top: labelConnectorPos.y, left: labelConnectorPos.x});\r\n        }else{\r\n            labelConnectorPos = {\r\n                \"x\": Math.round($(connector).find(\".label_connector_name\").position.left),\r\n                \"y\": Math.round($(connector).find(\".label_connector_name\").position.top)\r\n            }\r\n            $(labelConnectorName).css({top: labelConnectorPos.y, left: labelConnectorPos.x});\r\n        }\r\n    },\r\n\r\n    refresh: function(canvas, task1, task2){\r\n        var id = this.Class.buildConnectorId(task1.attr(\"id\"), task2.attr(\"id\"));\r\n        var line = $(\"#\" + id);\r\n        var expression = line.data(\"expression\");\r\n        line.detach();\r\n        this.connect(canvas, task1, task2, expression);\r\n    },\r\n\r\n    drawTemporalConnector: function(canvas, sourceTask, target){\r\n        var id = \"svgTemporalConnector\";\r\n\r\n        // Remove previous line\r\n        canvas.find(\"#\" + id).detach();\r\n\r\n        // Draw a new line\r\n        var el1 = this.getBounds(sourceTask);\r\n        var el2 = {x: target.left, y: target.top, width: 0, height: 0};\r\n        this.drawLine(canvas, id, el1, el2);\r\n    },\r\n\r\n    removeTemporalConnector: function(canvas){\r\n        var id = \"svgTemporalConnector\";\r\n\r\n        // Remove \r\n        canvas.find(\"#\" + id).detach();\r\n    },\r\n\r\n    getBounds: function(element){\r\n        var position = element.position();\r\n        return {x: position.left, y: position.top, width: element.outerWidth(), height: element.outerHeight()};\r\n    },\r\n\r\n    getLeft: function(el1, el2){\r\n        return Math.min(el1.x, el2.x) - this.path.arrowHeight;\r\n    },\r\n\r\n    getTop: function(el1, el2){\r\n        return Math.min(el1.y, el2.y) - this.path.arrowHeight;\r\n    },\r\n\r\n    getWidth: function(el1, el2){\r\n        return Math.abs(el1.x - el2.x) + this.path.arrowHeight * 2;\r\n    },\r\n\r\n    getHeight: function(el1, el2){\r\n        return Math.abs(el1.y - el2.y) + this.path.arrowHeight * 2;\r\n    },\r\n\r\n    modifyPositions: function(el1, el2){\r\n        var anchors = this.path.calculateAnchors(el1, el2);\r\n        // Modify according anchors\r\n        this.adjustToAnchor(el1, anchors.el1);\r\n        this.adjustToAnchor(el2, anchors.el2);\r\n\r\n        return anchors;\r\n    },\r\n\r\n    adjustToAnchor: function(el, anchor){\r\n        if (anchor == \"top\" || anchor == \"bottom\") el.x = el.x + el.width / 2 // adjust to x-center\r\n        if (anchor == \"left\"  || anchor == \"right\") el.y = el.y + el.height / 2 // adjust to y-center\r\n        if (anchor == \"bottom\") el.y = el.y + el.height; // Put to bottom\r\n        if (anchor == \"right\") el.x = el.x + el.width; // Put to right\r\n    }\r\n});","bizagi.bpmn.modeler.observable.extend(\"bizagi.bpmn.modeler.drawing\", {}, {\r\n\r\n    /* Constructor */\r\n    init: function(model) {\r\n        var that = this;\r\n        this.canvas = null;\r\n        $.templates({\r\n            bpm_modeler_drawing: '<drawing> \\\r\n                                    {{for tasks tmpl=\"bpm_modeler_drawingItem\"/}} \\\r\n                                  </drawing>',\r\n            bpm_modeler_drawingItem: '<item id=\"{{: id}}\" class=\"bpm-{{:type}} bpm-moveable\" title=\"{{:displayName}}\" \\\r\n                                            style=\"left:{{:position.x}}px; top:{{:position.y}}px\" \\\r\n                                            data-type=\"{{: type}}\"\\\r\n                                            data-show-aura=\"{{:showAura}}\"> \\\r\n                                            <label class=\"labelNameTask label-{{:type}}\">{{:displayName}}</label>\\\r\n                                            {{if type==\"IntermediateEvent\"}}<svg id=\"Layer_1\" data-name=\"Layer 1\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><defs><style>.cls-1{fill:#fdffe7;}.cls-2{fill:#99a805;}</style></defs><title>event</title><circle class=\"cls-1\" cx=\"12\" cy=\"12\" r=\"12\"/><path class=\"cls-2\" d=\"M12,1A11,11,0,1,1,1,12,11,11,0,0,1,12,1m0-1A12,12,0,1,0,24,12,12,12,0,0,0,12,0Z\"/><path class=\"cls-2\" d=\"M12,2.85A9.15,9.15,0,1,1,2.85,12,9.15,9.15,0,0,1,12,2.85m0-1.1A10.25,10.25,0,1,0,22.25,12,10.25,10.25,0,0,0,12,1.75Z\"/></svg>{{/if}}\\\r\n                                            {{if type ===\"EmailTask\"}}<i class=\"ico_mail bpmn-icon-intermediate-event-throw-escalation\"></i>{{/if}}\\\r\n                                            {{if ~root.isGateway(type)}}<gateway-helper></gateway-helper>{{/if}} \\\r\n                                            {{if type !=\"EmailTask\" && durationInMinutes }}<duration>{{:durationInMinutes}}</duration>{{/if}} \\\r\n                                       </item>'\r\n        });\r\n\r\n        // Set model\r\n        this.drawingWidth = 0;\r\n        this.drawingHeight = 0;\r\n        this.model = model;\r\n        this.model.subscribe(\"model.redraw\", $.proxy(this.refresh, this));\r\n        this.previusElement = null;\r\n\r\n        this.isEditionActive = false;\r\n\r\n        this.reviewMode = false;\r\n\r\n        // Create dependencies\r\n        this.aura = new bizagi.bpmn.modeler.aura(this.model);\r\n        this.aura.subscribe(\"item.drag\", $.proxy(this.onElementDragging, this));\r\n        this.aura.subscribe(\"arrow.drag\", $.proxy(this.onArrowDragging, this));\r\n        this.aura.subscribe(\"arrow.setExpression\", $.proxy(this.editExpressionForArrow, this));\r\n        this.aura.subscribe(\"arrow.setElse\", $.proxy(this.triggerElseExpressionForArrow, this));\r\n        this.aura.subscribe(\"task.externaloption\", $.proxy(this.manageExternalOption, this));\r\n        this.aura.subscribe(\"task.click\", $.proxy(this.clickOnTask, this));\r\n        this.connector = new bizagi.bpmn.modeler.connector();\r\n        this.aux = \"\";\r\n    },\r\n    setCanvas: function(canvas) {\r\n        this.canvas = canvas;\r\n    },\r\n    render: function(canvas, readonly) {\r\n        var that = this;\r\n        var initializeGeneralHandlers = (this.canvas == null);\r\n        this.canvas = canvas;\r\n        // Render template\r\n        var viewModel = this.model.getViewModel();\r\n        var html = $.templates.bpm_modeler_drawing.render(viewModel);\r\n\r\n        canvas.append(html);\r\n        // Set drawing canvas\r\n        this.drawing = canvas.find(\"drawing\");\r\n        // Calculate size for drawing\r\n        this.canvasWidth = canvas.width();\r\n        this.canvasHeight = canvas.height();\r\n        this.scrollTop = viewModel.canvas.top || 0;\r\n        this.scrollLeft = viewModel.canvas.left || 0;\r\n        this.drawingWidth = this.drawingWidth || viewModel.canvas.width || this.canvasWidth;\r\n        this.drawingHeight = this.drawingHeight || viewModel.canvas.height || this.canvasHeight;\r\n        //this.drawing.css({ minWidth: this.canvasWidth, minHeight: this.canvasHeight, width: this.drawingWidth, height: this.drawingHeight});\r\n        this.drawing.width(this.drawingWidth);\r\n        this.drawing.height(this.drawingHeight);\r\n        this.canvas.scrollLeft(this.scrollLeft);\r\n        this.canvas.scrollTop(this.scrollTop);\r\n\r\n        // Add connectors\r\n        setTimeout(function() { that.addConnectors(viewModel); }, 0);\r\n\r\n        // Add event handlers\r\n        if (readonly !== true && that.readonlyLoaded!==true) {\r\n            this.addHandlers();\r\n        }else{\r\n            that.readonlyLoaded=true;\r\n        }\r\n\r\n        // Add general event handlers (ONLY ONCE)\r\n        if (initializeGeneralHandlers && readonly !== true) {\r\n            this.addGeneralHandlers();\r\n        }\r\n\r\n        // Show aura for item where data-show-aura = true\r\n        this.drawing.find(\"item[data-show-aura=true]\").click();\r\n\r\n        // Set Name of all items\r\n        this.configureNamesOfItems();\r\n\r\n        //Set events in the document\r\n        this.setGeneralEvents();\r\n    },\r\n    activeReviewMode: function() {\r\n        $(document).find('#bpm-toolbar').hide();\r\n        $(this.drawing).find('.bpm-moveable').draggable('disable');\r\n        $(this.drawing).find('aura').hide();\r\n        this.reviewMode = true;\r\n        $(\"body\").unbind('keyup');\r\n        $(\"body\").off();\r\n    },\r\n    setGeneralEvents: function() {\r\n        var that = this;\r\n        $(\"body\").off();\r\n        $(\"body\").on(\"keyup\", function(e) {\r\n            if (!this.reviewMode) that.keyUpEvent(e);\r\n        });\r\n    },\r\n\r\n    keyUpEvent: function(e) {\r\n        var that = this\r\n        var selectedItem = that.returnSelectedItem();\r\n        if (selectedItem) {\r\n            switch (e.which) {\r\n                case 113: //F2 Change name of items\r\n                    if (selectedItem.nodeName == \"CONNECTOR\") {\r\n                        if (!that.isEditionActive) that.editConnectorName($(selectedItem.firstElementChild), \"f2\");\r\n                    } else {\r\n\r\n                        if (!that.isEditionActive) {\r\n                            that.editTaskName($(selectedItem.firstElementChild), \"f2\");\r\n                        }\r\n                    }\r\n                    break;\r\n                case 46: //SUPR - Delete items\r\n                    if (!this.reviewMode) {\r\n                        if (selectedItem && selectedItem.nodeName == \"CONNECTOR\") {\r\n                            var source = selectedItem.id.split(\"_to_\")[0].split(\"svgFrom_\")[1];\r\n                            var target = selectedItem.id.split(\"_to_\")[1];\r\n                            that.model.deleteArrow(source, target);\r\n                        } else {\r\n                            var element = that.model.getTaskById(selectedItem.id);\r\n\r\n                            if (that.model.activeConfirmationPopup(element.type)) {\r\n                                var source = $(\"#\" + selectedItem.id).parent().find(\".bpm-option-delete\")\r\n                                that.aura.activePopupConfirmationDelete($(source), selectedItem.id);\r\n                            } else {\r\n                                that.model.deleteTask(element.id);\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    configureNamesOfItems: function() {\r\n        var that = this;\r\n        $(\"#bpm-drawing\").find(\".labelNameTask\").each(function(index, obj) {\r\n            var value = $(obj).text();\r\n            if (that.setNameTask(value, $(obj))) {\r\n                $(obj).attr(\"desc\", value);\r\n                $(obj).text(value.substring(0, 20) + '...');\r\n            } else {\r\n                $(obj).text(value);\r\n            }\r\n        });\r\n    },\r\n    returnSelectedItem: function() {\r\n        var itemSelected = null;\r\n        $(\"#bpm-drawing\").find(\".active\").each(function(i, el) {\r\n            itemSelected = el;\r\n        });\r\n        return itemSelected;\r\n    },\r\n    refresh: function() {\r\n        this.isEditionActive = false;\r\n        this.canvas.empty();\r\n        this.aura.hide();\r\n        this.render(this.canvas);\r\n    },\r\n    /************************************************************************\r\n     HANDLER CONFIGURATION SECTION\r\n     ************************************************************************/\r\n    addHandlers: function() {\r\n        // Add movement to items\r\n\r\n        if (!this.reviewMode) {\r\n            this.drawing.find(\"item\").draggable({\r\n                containment: \"#bpm-drawing\",\r\n                grid: [20, 20],\r\n                drag: $.proxy(this.onTaskDragging, this)\r\n            });\r\n\r\n            // Configure drop area\r\n            this.configureDroppable();\r\n        }\r\n    },\r\n\r\n    addGeneralHandlers: function() {\r\n        // Make items clickable\r\n        this.canvas.on(\"click\", \"item\", $.proxy(this.showAura, this));\r\n\r\n        // Edit items name\r\n        this.canvas.on(\"dblclick\", \"item\", $.proxy(this.editTaskName, this));\r\n\r\n        // Edit task duration\r\n        this.canvas.on(\"dblclick\", \"item duration\", $.proxy(this.editDuration, this));\r\n\r\n        // Make arrows clickable\r\n        this.canvas.on(\"click\", \"connector\", $.proxy(this.showAuraForArrow, this));\r\n\r\n        // Edit arrows name\r\n        this.canvas.on(\"dblclick\", \"connector\", $.proxy(this.editConnectorName, this));\r\n\r\n        // Make canvas click\r\n        this.canvas.on(\"click\", \"drawing\", $.proxy(this.clickCavnas, this))\r\n\r\n        //Set position of label connector\r\n        this.canvas.on(\"mouseup\", \"connector label\", $.proxy(this.setConnectorPosition, this));\r\n\r\n    },\r\n    setConnectorPosition: function(ev) {\r\n        var that = this;\r\n        var label = $(ev.currentTarget);\r\n        var idSourceConnector = $(label).parent().attr(\"id\").split(\"_to_\")[0].split(\"svgFrom_\")[1];\r\n        var idTargetConnector = $(label).parent().attr(\"id\").split(\"_to_\")[1];\r\n        var labelPosition = {\r\n            \"x\": label.position().left,\r\n            \"y\": label.position().top\r\n        }\r\n        that.model.changeConnectorPos(idSourceConnector, idTargetConnector, labelPosition);\r\n    },\r\n    clickCavnas: function(ev) {\r\n        var event = ev;\r\n        if (event.target.className === \"ui-droppable\") {\r\n            this.drawing.find(\"*\").removeClass(\"active\");\r\n            if (this.previusElement) {\r\n                if (this.previusElement.context.nodeName === \"CONNECTOR\") {\r\n                    var auraShown = this.aura.showForArrow(this.previusElement, false);\r\n                } else {\r\n                    var auraShown = this.aura.showForTask(this.previusElement);\r\n                }\r\n            }\r\n            this.previusElement = null;\r\n        }\r\n    },\r\n    configureDroppable: function() {\r\n        var that = this;\r\n        var mergeElement = false;\r\n        var mergeTarget = null;\r\n        this.drawing.find(\"item\").droppable({\r\n            hoverClass: \"dragging-arrow\",\r\n            drop: function(event, ui) {\r\n                setTimeout(function() {\r\n                    mergeElement = true;\r\n                    mergeTarget = ui;\r\n                });\r\n            }\r\n        });\r\n        this.drawing.droppable({\r\n            // We use a setTimeout to avoid some weird error from jquery ui\r\n            drop: function(event, ui) {\r\n                setTimeout(function() {\r\n                    if (!mergeElement) {\r\n                        if (ui.helper.hasClass(\"bpm-cloneable\")) that.addTask(ui);\r\n                        else if (ui.helper.hasClass(\"bpm-moveable\")) that.moveTask(ui);\r\n                        else if (ui.helper.hasClass(\"bpm-option-arrow\")) that.addArrow(ui);\r\n                    } else {\r\n                        that.addArrow(mergeTarget);\r\n                        if (mergeElement.successor) {\r\n                            //that.addArrow(mergeTarget);\r\n                        }\r\n                    }\r\n                    mergeElement = false;\r\n                }, 0);\r\n            },\r\n            accept: \".bpm-cloneable, .bpm-moveable, .bpm-option-arrow\"\r\n        });\r\n    },\r\n\r\n    /************************************************************************\r\n     MODEL MODIFIERS SECTION\r\n     ************************************************************************/\r\n    addTask: function(ui) {\r\n        var type = ui.draggable.data(\"type\");\r\n        var predecessor = ui.draggable.data(\"predecessor\");\r\n        var pos = this.fixPosition(ui.offset);\r\n        var x = pos.left;\r\n        var y = pos.top;\r\n        this.autoAdjustCanvasOn(x, y);\r\n        /* Align to the grid*/\r\n        x = x - (x % 20);\r\n        y = y - (y % 20);\r\n        if (x < 80) x = 80;\r\n        if (y < 60) y = 60;\r\n        this.model.addTask(type, { x: x, y: y }, predecessor);\r\n    },\r\n\r\n    /**\r\n     * this method move the canvas if the task or element is near to the right border and bottom border\r\n     * @param {Int} x of element\r\n     * @param {Int} y of element\r\n     */\r\n    autoAdjustCanvasOn: function(x, y) {\r\n        if (this.canvasWidth+this.scrollLeft-200<x) {\r\n            $(\"move-right\").click()\r\n        }\r\n        if (this.canvasHeight+this.scrollTop-100<y) {\r\n            $(\"move-bottom\").click();\r\n        }\r\n    },\r\n\r\n    moveTask: function(ui) {\r\n        var type = ui.draggable.data(\"type\");\r\n        var id = ui.draggable.attr(\"id\");\r\n        var x = ui.position.left;\r\n        var y = ui.position.top;\r\n\r\n        this.autoAdjustCanvasOn(x, y);\r\n        /* Align to the grid*/\r\n        x = x - (x % 20);\r\n        y = y - (y % 20);\r\n        if (x < 80) x = 80;\r\n        if (y < 60) y = 60;\r\n        this.model.moveTask(id, { x: x, y: y });\r\n    },\r\n\r\n    editTaskName: function(ev, params) {\r\n        this.isEditionActive = true;\r\n        if (params) {\r\n            var label = $(ev);\r\n        } else {\r\n            var label = $(\"label\", ev.currentTarget);\r\n        }\r\n        var taskId = label.parent().attr(\"id\");\r\n        var item = this.model.getTaskById(taskId);\r\n        var isEditableName = this.model.isEditableName(item);\r\n\r\n        if (isEditableName && !this.reviewMode) {\r\n            var that = this;\r\n            var input = $(\"<input class='input_name' type='text' />\");\r\n            if (label.attr(\"desc\")) {\r\n                input.val(label.attr(\"desc\"));\r\n            } else {\r\n                input.val(label.text());\r\n            }\r\n            if (this.isEditionActive) {\r\n                this.showPopupEditor(label, input, function(value) {\r\n                    that.model.changeTaskName(taskId, value);\r\n                    if (value === \"\") {\r\n                        value = \"\";\r\n                    }\r\n                    if (that.setNameTask(value, label)) {\r\n                        that.aux = value;\r\n                        label.attr(\"desc\", value);\r\n                        label.text(value.substring(0, 20) + '...');\r\n                    } else {\r\n                        label.text(value);\r\n                    }\r\n                });\r\n            }\r\n        } else {\r\n            this.isEditionActive = false;\r\n        }\r\n    },\r\n    editConnectorName: function(ev, params ) {\r\n        var that = this;\r\n        if (params) {\r\n            var label = $(ev);\r\n        } else {\r\n            var label = $(\"label\", ev.currentTarget);\r\n        }\r\n        var input = $(\"<input type='text' maxlength='20' class='input--ConnectorName input_name'/>\");\r\n        if (!that.reviewMode) {\r\n            that.isEditionActive = true;\r\n            input.val(label.text());\r\n            var succesorId = label.parent().attr(\"id\");\r\n            var sourceId = label.parent().attr(\"id\");\r\n            succesorId = succesorId.split(\"_to_\")[1]\r\n            sourceId = sourceId.split(\"_to_\")[0].split(\"svgFrom_\")[1]\r\n            this.showPopupEditor(label, input, function(value) {\r\n                that.model.changeConnectorName(sourceId, succesorId, value);\r\n                label.text(value);\r\n            });\r\n        }\r\n    },\r\n    manageExternalOption: function(ev, params) {\r\n        var taskName = this.model.getTaskById(params.task);\r\n        params[\"taskName\"] = taskName.displayName;\r\n        params[\"type\"] = taskName.type;\r\n        this.publish(\"drawing.externaloption\", params);\r\n    },\r\n    clickOnTask: function(ev, params){\r\n        var taskName = this.model.getTaskById(params.task);\r\n        params[\"taskName\"] = taskName.displayName;\r\n        this.publish(\"drawing.clickOnTask\", params);\r\n    },\r\n    editDuration: function(ev, params) {\r\n        ev.stopPropagation()\r\n        if (!this.reviewMode) {\r\n            var that = this;\r\n            that.isEditionActive = true;\r\n            var label = $(ev.currentTarget);\r\n            var taskId = label.parent().attr(\"id\");\r\n            var input = $('<input type=\"text\" maxlength=\"6\" class=\"input__duration\"/>');\r\n            input.bind(\"paste\", function(e) {\r\n                e.preventDefault();\r\n            });\r\n            input.val(label.text());\r\n            this.showPopupEditor(label, input, function(value) {\r\n                if (value === \"\") {\r\n                    value = \"1h\";\r\n                }\r\n                var duration = that.model.parseDuration(value);\r\n                if (duration != null) {\r\n                    that.model.changeDuration(taskId, duration);\r\n                    label.text(that.model.formatDuration(duration));\r\n                }\r\n                input.unbind(\"paste\");\r\n            });\r\n        }\r\n    },\r\n\r\n    addArrow: function(ui) {\r\n        var source = ui.draggable.data(\"predecessor\");\r\n        var position = this.fixPosition(ui.offset);\r\n        var tasksAtPosition = this.getTasksAtPosition(position);\r\n        if (tasksAtPosition.length == 1) {\r\n            // Add connection in model\r\n            var target = tasksAtPosition.attr(\"id\");\r\n            var classTarget = $(tasksAtPosition).attr(\"class\");\r\n            if (classTarget.indexOf(\"bpm-StartEvent\") != 0 && source !== target) {\r\n                this.model.addConnection(source, target);\r\n            } else {\r\n                this.connector.removeTemporalConnector(this.canvas);\r\n            }\r\n        } else {\r\n            //  Remove temporal arrow\r\n            this.connector.removeTemporalConnector(this.canvas);\r\n        }\r\n    },\r\n\r\n    editExpressionForArrow: function(ev, arrowId) {\r\n        var source = bizagi.bpmn.modeler.connector.getSourceTaskFromId(arrowId);\r\n        var target = bizagi.bpmn.modeler.connector.getTargetTaskFromId(arrowId);\r\n        var data = {\r\n            option: \"rule\",\r\n            source: source,\r\n            target: target\r\n        };\r\n        this.publish(\"drawing.externaloption\", data);\r\n    },\r\n\r\n    triggerElseExpressionForArrow: function(ev, arrowId) {\r\n        var source = bizagi.bpmn.modeler.connector.getSourceTaskFromId(arrowId);\r\n        var target = bizagi.bpmn.modeler.connector.getTargetTaskFromId(arrowId);\r\n        var data = {\r\n            option: \"else\",\r\n            source: source,\r\n            target: target\r\n        };\r\n        this.publish(\"drawing.externaloption\", data);\r\n    },\r\n\r\n    setExpressionForArrow: function(sourceTaskId, targetTaskId) {\r\n        this.model.setConnectionRule(sourceTaskId, targetTaskId, \"boolean\");\r\n    },\r\n\r\n    moveCanvas: function(ev, ui) {\r\n        var DISTANCE = 100;\r\n        var element = $(ev.target);\r\n        var tag = element.prop(\"tagName\").toLowerCase();\r\n        if (tag == \"move-right\") {\r\n            this.scrollLeft += DISTANCE;\r\n            if (this.canvasWidth + this.scrollLeft >= this.drawingWidth) this.drawingWidth += DISTANCE;\r\n        }\r\n        if (tag == \"move-left\") {\r\n            this.scrollLeft -= DISTANCE;\r\n        }\r\n        if (tag == \"move-top\") {\r\n            this.scrollTop -= DISTANCE;\r\n        }\r\n        if (tag == \"move-bottom\") {\r\n            this.scrollTop += DISTANCE;\r\n            if (this.canvasHeight + this.scrollTop >= this.drawingHeight) this.drawingHeight += DISTANCE;\r\n        }\r\n\r\n        // Validations\r\n        if (this.scrollTop < 0) this.scrollTop = 0;\r\n        if (this.scrollLeft < 0) this.scrollLeft = 0;\r\n\r\n        // Apply changes\r\n        this.drawing.width(this.drawingWidth);\r\n        this.drawing.height(this.drawingHeight);\r\n        this.canvas.scrollLeft(this.scrollLeft);\r\n        this.canvas.scrollTop(this.scrollTop);\r\n\r\n        // Update model\r\n        this.model.setCanvasBounds({\r\n            top: this.scrollTop,\r\n            left: this.scrollLeft,\r\n            width: this.drawingWidth,\r\n            height: this.drawingHeight\r\n        });\r\n    },\r\n\r\n    /************************************************************************\r\n     DRAGGING HANDLERS\r\n     ************************************************************************/\r\n    onTaskDragging: function(event, ui) {\r\n        this.redrawConnector(ui.helper.attr(\"id\"), ui.position);\r\n\r\n        // Move aura\r\n        this.aura.moveTo(ui.helper);\r\n        this.onElementDragging(event, ui);\r\n    },\r\n\r\n    onArrowDragging: function(ev, params) {\r\n        var drawing = this.drawing;\r\n\r\n        // Fixes position to make it relative to drawing container\r\n        var position = this.fixPosition(params.target);\r\n\r\n        // Draw temporal connector\r\n        this.connector.drawTemporalConnector(drawing, drawing.find(\"#\" + params.source), position);\r\n\r\n        // Find hovering task\r\n        var draggingOverTasks = this.getTasksAtPosition(position);\r\n\r\n        // Remove class to all elements\r\n        drawing.find(\"item\").removeClass(\"dragging-arrow\");\r\n\r\n        // Add class to tasks where the cursor is hovering when dragging\r\n        draggingOverTasks.addClass(\"dragging-arrow\");\r\n    },\r\n\r\n    onElementDragging: function(ev, ui) {\r\n        // TO BE IMPLEMENTED MAYBE, THE IDEA IS TO PERFORM SCROLL AUTOMATICALLY\r\n    },\r\n\r\n    /************************************************************************\r\n     CONNECTORS CONFIGURATION SECTION\r\n     ************************************************************************/\r\n    redrawConnector: function(taskId) {\r\n        var that = this;\r\n        var task = this.model.getTaskById(taskId);\r\n        var drawing = this.drawing;\r\n        $.each(task.predecessors, function(i, predecessorId) {\r\n            if (predecessorId) {\r\n                that.connector.refresh(drawing, drawing.find(\"#\" + predecessorId), drawing.find(\"#\" + taskId));\r\n            }\r\n        });\r\n        $.each(task.successors, function(i, successorId) {\r\n            if (successorId) {\r\n                var task = that.drawing.find(\"#\" + successorId);\r\n                var classD = $(task).attr(\"class\");\r\n                if (classD.indexOf(\"bpm-StartEvent\") != 0) {\r\n                    that.connector.refresh(drawing, drawing.find(\"#\" + taskId), drawing.find(\"#\" + successorId));\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    addConnectors: function(viewModel) {\r\n        var that = this;\r\n        var displayName = \"\";\r\n        var labelConnectorPos = {};\r\n        $.each(viewModel.tasks, function(i, task) {\r\n            $.each(task.successors, function(j, successorId) {\r\n                for (var i = 0; i < task.connectors.length; i++) {\r\n                    if (task.connectors[i].successor == successorId) {\r\n                        displayName = task.connectors[i].displayName;\r\n                        labelConnectorPos = {\r\n                            \"x\": Math.round(task.connectors[i].displayNamePosition.x),\r\n                            \"y\": Math.round(task.connectors[i].displayNamePosition.y)\r\n                        }\r\n                    }\r\n                }\r\n                that.addConnector(task.id, successorId, displayName, labelConnectorPos);\r\n            });\r\n        });\r\n    },\r\n\r\n    addConnector: function(task1, task2, displayName, labelConnectorPos) {\r\n        var expression = this.model.getConnectionRule(task1, task2);\r\n        var task = this.drawing.find(\"#\" + task2);\r\n        var classD = $(task).attr(\"class\");\r\n        if (classD.indexOf(\"bpm-StartEvent\") != 0) {\r\n            this.connector.connect(this.drawing, this.drawing.find(\"#\" + task1), this.drawing.find(\"#\" + task2), expression, displayName, labelConnectorPos);\r\n        }\r\n    },\r\n\r\n    /************************************************************************\r\n     AURA CONFIGURATION SECTION\r\n     ************************************************************************/\r\n    showAura: function(ev) {\r\n        var task = $(ev.currentTarget);\r\n        var auraShown = this.aura.showForTask(task);\r\n        this.model.setAura(task.id, auraShown);\r\n        this.previusElement = task;\r\n        var displayName = null;\r\n\r\n        if (task.attr(\"data-type\") === \"UserTask\") {\r\n            displayName = $(task[0].innerHTML).text().slice(0, -1);\r\n        } else {\r\n            displayName = $(task[0].innerHTML).text();\r\n        }\r\n\r\n        this.drawing.find(\"*\").removeClass(\"active\");\r\n        if (auraShown) {\r\n            // Remove active class from all items, and add it to this one\r\n            task.addClass(\"active\");\r\n        }\r\n        var data = {\r\n            task: task[0].id,\r\n            displayName: displayName,\r\n            type: task.attr(\"data-type\"),\r\n            option: 'selecTask'\r\n        };\r\n        this.publish(\"drawing.selectedTask\", data);\r\n        // ev.stopImmediatePropagation();\r\n\r\n        if (this.reviewMode) {\r\n            $(task).parent().find('aura .wrapper-aura-options, aura .wrapper-options .bpm-option-change, aura .wrapper-options .bpm-option-delete').hide();\r\n        }\r\n\r\n    },\r\n    showAuraForArrow: function(ev) {\r\n        var arrow = $(ev.currentTarget);\r\n        this.previusElement = arrow;\r\n        var id = arrow.attr(\"id\");\r\n        var sourceTask = bizagi.bpmn.modeler.connector.getSourceTaskFromId(id);\r\n        var showRuleOption = this.model.successorConnectionsCanContainRule(sourceTask);\r\n        var auraShown = this.aura.showForArrow(arrow, showRuleOption);\r\n        this.drawing.find(\"*\").removeClass(\"active\");\r\n        if (auraShown) {\r\n            arrow.addClass(\"active\");\r\n        }\r\n        if (this.reviewMode) {\r\n            $(arrow).parent().find('.bpm-aura-for-arrow .wrapper-options').css('width', '27px');\r\n            $(arrow).parent().find('.bpm-aura-for-arrow .wrapper-options special-options .bpm-option-else, .bpm-aura-for-arrow .wrapper-options special-options .bpm-option-delete').hide();\r\n        }\r\n        if (this.reviewMode && $(arrow).hasClass('bpm-else')) {\r\n            $(arrow).parent().find('.bpm-aura-for-arrow .wrapper-options').hide();\r\n        }\r\n    },\r\n    /************************************************************************\r\n     HELPERS SECTION\r\n     ************************************************************************/\r\n    getTasksAtPosition: function(position) {\r\n        return this.drawing.find(\"item\")\r\n            .filter(function() {\r\n                var el = $(this);\r\n                var pos = el.position();\r\n                var coords = {\r\n                    x: pos.left - 100,\r\n                    y: pos.top - 100,\r\n                    w: el.width() + 100,\r\n                    h: el.height() + 100\r\n                };\r\n                return (coords.x <= position.left && position.left <= (coords.x + coords.w)) &&\r\n                    (coords.y <= position.top && position.top <= (coords.y + coords.h));\r\n            });\r\n    },\r\n\r\n    showPopupEditor: function(label, input, callback) {\r\n        var that = this;\r\n        var cancelAction = false;\r\n        // Create input\r\n        label.hide();\r\n        label.after(input);\r\n        input.focus();\r\n        input.select();\r\n\r\n        $(\"#bpm-drawing\").find(\".ui-droppable\").bind(\"keydown\", function(e) {\r\n            switch (e.which) {\r\n                case 27:\r\n                    cancelAction = true;\r\n                    closeEditor();\r\n                    break;\r\n            }\r\n        });\r\n\r\n        $(label).parent().find(\".input_name\").each(function(index, el) {\r\n            if (index === 1) {\r\n                $(el).remove();\r\n            }\r\n        });\r\n        $(label).parent().find(\".input_name\").focus();\r\n\r\n\r\n        var closeEditor = function() {\r\n            if (cancelAction) {\r\n                callback(label.text());\r\n                label.show();\r\n                input.detach();\r\n                cancelAction = false;\r\n            } else {\r\n                var value = input.val();\r\n                callback(value);\r\n                label.show();\r\n                $(label).parent().attr(\"title\", value);\r\n                input.detach();\r\n            }\r\n            that.model.triggerModelChange(true);\r\n            that.isEditionActive = false;\r\n        };\r\n\r\n        // Change handler\r\n        input.keypress(function(ui) {\r\n            if (that.isEditionActive && ui.key == \"Enter\") {\r\n                closeEditor();\r\n            }\r\n\r\n        });\r\n\r\n        // Close up handler\r\n        input.click(function(e) { e.preventDefault(); return false; });\r\n\r\n        $(\"#canvas\").one(\"click\", function() {\r\n            if (that.isEditionActive) {\r\n                closeEditor();\r\n            }\r\n        });\r\n    },\r\n\r\n    fixPosition: function(position) {\r\n        // Fixes position to make it relative to drawing container\r\n        var relative = this.drawing.offset();\r\n        position.left -= relative.left;\r\n        position.top -= relative.top;\r\n        return position;\r\n    },\r\n    setNameTask: function(text, obj) {\r\n        if (text.length > 20 || obj.height() > 34) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n});","bizagi.bpmn.modeler.observable.extend(\"bizagi.bpmn.modeler.toolbar\", {\r\n\r\n    /* STATIC STUFF */\r\n    bpmShapes: {\r\n        \"StartEvent\": \"bpmn-icon-start-event-none\",\r\n        \"IntermediateEvent\": \"bpmn-icon-intermediate-event-none\",\r\n        \"EndEvent\": \"bpmn-icon-end-event-none\",\r\n        \"TerminateEvent\": \"bpmn-icon-end-event-terminate\",\r\n        \"ExclusiveGateway\": \"bpmn-icon-gateway-xor\",\r\n        \"ParallelGateway\": \"bpmn-icon-gateway-parallel\",\r\n        \"InclusiveGateway\": \"bpmn-icon-gateway-or\",\r\n        \"ComplexGateway\": \"bpmn-icon-gateway-complex\",\r\n        \"UserTask\": \"bpmn-icon-task\",\r\n        \"EmailTask\": \"ico_mail bpmn-icon-intermediate-event-throw-escalation\"\r\n    },\r\n    toolBarTitlesOld: {\r\n        \"StartEvent\": \"Start Event\",\r\n        \"IntermediateEvent\": \"Intermediate Event\",\r\n        \"EndEvent\": \"End Event\",\r\n        \"ExclusiveGateway\": \"Exclusive Gateway\",\r\n        \"UserTask\": \"Task\",\r\n        \"TerminateEvent\": \"Terminate Event\",\r\n        \"ParallelGateway\": \"Parallel Gateway\",\r\n        \"assignee\": \"Settings\",\r\n        \"form\": \"Form Designer\",\r\n        \"EmailTask\": \"Email Task\",\r\n        \"notify\": \"Email Settings\",\r\n        \"changeType\": \"Change type\",\r\n        \"deleteShape\": \"Delete\",\r\n        \"flowSecuence\": \"Sequence Flow\",\r\n        \"deleteConfirmationMessage\": \"Do you want to DELETE this element? By doing so you will delete all the configurations associated to it.\",\r\n        \"confirmDeleteShape\": \"Yes\",\r\n        \"cancelDeleteShape\": \"No\",\r\n        \"addExpression\": \"Define expressions\",\r\n        \"elseExpression\": \"Else\"\r\n    },\r\n    toolBarTitles: {\r\n        \"StartEvent\": \"workportal-process-modeler-startEvent\",\r\n        \"IntermediateEvent\": \"workportal-process-modeler-intermediateEvent\",\r\n        \"EndEvent\": \"workportal-process-modeler-endEvent\",\r\n        \"ExclusiveGateway\": \"workportal-process-modeler-exclusiveGateway\",\r\n        \"UserTask\": \"workportal-process-modeler-userTask\",\r\n        \"TerminateEvent\": \"workportal-process-modeler-terminateEvent\",\r\n        \"ParallelGateway\": \"workportal-process-modeler-parallelGateway\",\r\n        \"assignee\": \"workportal-process-modeler-settings\",\r\n        \"form\": \"workportal-process-modeler-formDesigner\",\r\n        \"EmailTask\": \"workportal-process-modeler-emailTask\",\r\n        \"notify\": \"workportal-process-modeler-emailSettings\",\r\n        \"changeType\": \"workportal-process-modeler-changeType\",\r\n        \"deleteShape\": \"workportal-process-modeler-deleteShape\",\r\n        \"flowSecuence\": \"workportal-process-modeler-flowSecuence\",\r\n        \"deleteConfirmationMessage\": \"workportal-process-modeler-deleteConfirmationMessage\",\r\n        \"confirmDeleteShape\": \"workportal-process-modeler-confirm-delete\",\r\n        \"cancelDeleteShape\": \"workportal-process-modeler-cancel-delete\",\r\n        \"addExpression\": \"workportal-process-modeler-rules-addExpression\",\r\n        \"elseExpression\": \"workportal-process-modeler-rules-elseExpression\"\r\n    },\r\n    getClassForType: function(type) {\r\n        return this.bpmShapes[type];\r\n    },\r\n    getTitleForType: function(type) {\r\n        return this.toolBarTitles[type];\r\n    },\r\n    getOldLocalization: function(type){\r\n        return this.toolBarTitlesOld[type];\r\n    },\r\n\r\n}, {\r\n\r\n    /* INSTANCE STUFF */\r\n\r\n    /* Constructor */\r\n    init: function() {\r\n        // Define converter for task type class\r\n        var that = this;\r\n        $.views.converters(\"tasktype_class\", function(val) {\r\n            return bizagi.bpmn.modeler.toolbar.getClassForType(val);\r\n        });\r\n\r\n        $.views.converters(\"title\", function(val) {\r\n            var result = '';\r\n            var key = '';\r\n            if(bizagi.bpmn.modeler.viewer.featureLocalization){\r\n                key = bizagi.bpmn.modeler.toolbar.getTitleForType(val);\r\n                result = bizagi.bpmn.modeler.viewer.getKeyLocalization(key);\r\n            }else{\r\n                result = bizagi.bpmn.modeler.toolbar.getOldLocalization(val);\r\n            }\r\n            return result;\r\n        });\r\n\r\n        $.templates({\r\n            bpm_modeler_toolbar: '<toolbar> {{for items tmpl=\"bpm_modeler_toolbarItem\"/}}</toolbar>',\r\n            bpm_modeler_toolbarItem: '<item class=\"tooltip bpm-{{:#data}} {{tasktype_class: #data}}  bpm-cloneable\" data-type=\"{{:#data}}\">{{if #data==\"IntermediateEvent\"}}<svg id=\"Layer_1\" data-name=\"Layer 1\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><defs><style>.cls-11{fill:#fff;}.cls-22{fill:#9ca613;}</style></defs><title>event 2</title><circle class=\"cls-11\" cx=\"12\" cy=\"12\" r=\"12\"/><path class=\"cls-22\" d=\"M12,1.12A10.88,10.88,0,1,1,1.12,12,10.89,10.89,0,0,1,12,1.12M12,0A12,12,0,1,0,24,12,12,12,0,0,0,12,0Z\"/><path class=\"cls-22\" d=\"M12,3.79A8.21,8.21,0,1,1,3.79,12,8.22,8.22,0,0,1,12,3.79m0-1.12A9.33,9.33,0,1,0,21.33,12,9.33,9.33,0,0,0,12,2.67Z\"/></svg>{{/if}}<span class=\"tooltiptext tooltip-right\"><p>{{title: #data}}</p></span></item>'\r\n        });\r\n        // Define items\r\n        this.items = [\r\n            \"StartEvent\",\r\n            \"UserTask\",\r\n            \"ExclusiveGateway\",\r\n            \"IntermediateEvent\",\r\n            \"EndEvent\"\r\n        ];\r\n    },\r\n\r\n    render: function(canvas) {\r\n        var that = this;\r\n        this.canvas = canvas;\r\n\r\n        // Render template\r\n        var html = $.templates.bpm_modeler_toolbar.render({ items: this.items });\r\n        this.canvas.append(html);\r\n\r\n        // Make items draggable\r\n        canvas.find(\"item\").draggable({\r\n            helper: \"clone\",\r\n            containment: \"#bpm-drawing\",\r\n            grid: [20, 20],\r\n            drag: $.proxy(this.onItemDragging, this)\r\n        });\r\n    },\r\n\r\n    onItemDragging: function(event, ui) {\r\n        this.publish(\"item.dragging\", ui);\r\n    }\r\n});","bizagi.bpmn.modeler.observable.extend(\"bizagi.bpmn.modeler.viewer\", {\r\n    // Static Values\r\n    featureLocalization: false,\r\n    // Static Functions\r\n    getInstaceLocalizationService: function() {\r\n        if (window.parent && window.parent.bizagi.localization) {\r\n            return window.parent.bizagi.localization;\r\n        } else {\r\n            return window.bizagi.localization;\r\n        }\r\n    },\r\n    getKeyLocalization: function(key) {\r\n        var localizator = this.getInstaceLocalizationService();\r\n        var result = localizator.getResource(key);\r\n        return result;\r\n    }\r\n}, {\r\n\r\n    /* Constructor */\r\n    init: function(params) {\r\n        $.templates({\r\n            bpm_modeler_viewer_container: '<bpm-modeler> \\\r\n                            <div id=\"bpm-toolbar\"></div> \\\r\n                            <div id=\"bpm-drawing\"></div> \\\r\n                            <move-helper> \\\r\n                                <move-top class=\"bpm-move\"></move-top> \\\r\n                                <move-left class=\"bpm-move\"></move-left> \\\r\n                                <move-bottom class=\"bpm-move\"></move-bottom> \\\r\n                                <move-right class=\"bpm-move\"></move-right> \\\r\n                            </move-helper> \\\r\n                        </bpm-modeler>'\r\n        });\r\n\r\n        // Create  model\r\n        this.model = new bizagi.bpmn.modeler.model();\r\n        this.model.subscribe(\"model.change\", $.proxy(this.changed, this));\r\n        this.model.subscribe(\"shape.change\", $.proxy(this.triggerChangeShape, this));\r\n        if (params && params.model) this.model.setModel(params.model);\r\n\r\n        // Declare dependencies\r\n        this.drawing = new bizagi.bpmn.modeler.drawing(this.model);\r\n        this.drawing.subscribe(\"drawing.externaloption\", $.proxy(this.manageExternalOption, this));\r\n        this.drawing.subscribe(\"drawing.selectedTask\", $.proxy(this.selectedTask, this));\r\n        this.drawing.subscribe(\"drawing.canvasEvent\", $.proxy(this.canvasEvent, this));\r\n        this.drawing.subscribe(\"load.finish\", $.proxy(this.triggerLoadFinish, this));\r\n        this.drawing.subscribe(\"drawing.clickOnTask\", $.proxy(this.clickOnTask, this));\r\n        this.toolbar = new bizagi.bpmn.modeler.toolbar();\r\n        this.toolbar.subscribe(\"item.dragging\", $.proxy(this.onToolbarItemDragging, this));\r\n        this.readOnly = false;\r\n        if (params === false || !params) {\r\n            this.readOnly = false;\r\n        } else {\r\n            this.readOnly = true;\r\n        }\r\n    },\r\n\r\n    render: function(canvas, diagram) {\r\n        var self = this;\r\n        \r\n        self.canvas = canvas;\r\n\r\n        // Render container\r\n        var container = $.templates.bpm_modeler_viewer_container.render();\r\n        self.canvas.html(container);\r\n\r\n        $.when(self.checkCSSLoaded()).then(function(){\r\n            // Render dependencies\r\n            self.renderToolbar();\r\n            self.renderDrawing(self.readOnly);\r\n    \r\n            if (diagram) self.load(diagram);\r\n            if (self.readOnly) {\r\n                $(\"#bpm-toolbar\").css({ \"display\": \"none\" });\r\n                $(\"#bpm-drawing\").addClass(\"bpm-modeler-readOnly\");\r\n                $(\"#bpm-drawing\").bind(\"over\");\r\n            }\r\n            // Assign move handlers\r\n            self.canvas.on(\"click\", \".bpm-move\", $.proxy(self.moveCanvas, self))\r\n        });\r\n    },\r\n\r\n    checkCSSLoaded: function(){\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        if(self.cssAppliedOnDrawing()){\r\n            defer.resolve();\r\n        }\r\n        else{\r\n            var MAX_COUNTER_CHECK_CSS = 10;\r\n            var counterCheckCSS = 0;\r\n            var validateCSSLoaded = setInterval(function(){\r\n                counterCheckCSS++;\r\n                if(self.cssAppliedOnDrawing() > 0 || MAX_COUNTER_CHECK_CSS <= counterCheckCSS){\r\n                    defer.resolve();\r\n                    clearInterval(validateCSSLoaded);\r\n                }\r\n            }, 1000);\r\n        }\r\n        \r\n        return defer.promise();\r\n    },\r\n\r\n    cssAppliedOnDrawing: function(){\r\n        return $(\"bpm-modeler #bpm-drawing\").height() > 0;\r\n    },\r\n\r\n    reviewMode: function(activeModeReview) {\r\n        if (activeModeReview) this.drawing.activeReviewMode();\r\n    },\r\n\r\n    localizationModeler: function( activelocalizationModeler ){\r\n        bizagi.bpmn.modeler.viewer.featureLocalization = activelocalizationModeler;\r\n    },\r\n    renderToolbar: function() {\r\n        var toolbarCanvas = this.canvas.find(\"#bpm-toolbar\");\r\n        this.toolbar.render(toolbarCanvas);\r\n    },\r\n\r\n    renderDrawing: function(state) {\r\n        var drawingCanvas = this.canvas.find(\"#bpm-drawing\");\r\n        this.drawing.render(drawingCanvas, state);\r\n    },\r\n\r\n    moveCanvas: function(ev, ui) {\r\n        this.drawing.moveCanvas(ev, ui);\r\n    },\r\n\r\n    onToolbarItemDragging: function(event, ui) {\r\n        this.drawing.onElementDragging(event, ui);\r\n    },\r\n\r\n    manageExternalOption: function(ev, params) {\r\n        this.publish(\"bpm.modeler.externalOption\", params);\r\n    },\r\n    selectedTask: function(ev, params) {\r\n        this.publish(\"bpm.modeler.selectedTask\", params);\r\n    },\r\n    canvasEvent: function(ev, params) {\r\n        this.publish(\"bpm.modeler.canvasEvent\", params);\r\n    },\r\n    triggerLoadFinish: function() {\r\n        this.publish(\"bpm.modeler.loadFinish\");\r\n    },\r\n    clickOnTask: function(ev, params){\r\n        this.publish(\"bpm.modeler.clickOnTask\", params);\r\n    },\r\n    setConnectionExpression: function(source, target) {\r\n        this.drawing.setExpressionForArrow(source, target);\r\n    },\r\n\r\n    save: function() {\r\n        return this.model.getPersistenceModel();\r\n    },\r\n\r\n    load: function(json) {\r\n        this.model.setModel(json);\r\n    },\r\n\r\n    changed: function(params) {\r\n        this.publish(\"bpm.modeler.changed\");\r\n    },\r\n    triggerChangeShape: function() {\r\n        this.publish(\"bpm.modeler.changeShape\");\r\n    },\r\n    setExtendedProperty: function(taskId, property, value) {\r\n        this.model.setExtendedProperty(taskId, property, value);\r\n    },\r\n\r\n    getExtendedProperty: function(taskId, property) {\r\n        return this.model.getExtendedProperty(taskId, property);\r\n    }\r\n});\r\n\r\n// Utility functions -> Move to bizagi.js\r\nif (!Array.prototype.removeOne) {\r\n    Array.prototype.removeOne = function(item) {\r\n        for (var i = this.length; i--;) {\r\n            if (this[i] === item) {\r\n                this.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    };\r\n}\r\nif (!Array.prototype.removeAll) {\r\n    Array.prototype.removeAll = function(item) {\r\n        for (var i = this.length; i--;) {\r\n            if (this[i] === item) {\r\n                this.splice(i, 1);\r\n            }\r\n        }\r\n    };\r\n}"]}