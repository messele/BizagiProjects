{"version":3,"sources":["jquery/workportal/desktop/widget/project.dashboard.menu.activity/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.processMap/bizagi.workportal.desktop.widgets.project.processMap.js","jquery/workportal/desktop/widget/project.processMap/bizagi.workportal.desktop.widgets.project.processDiagram.helper.js","jquery/workportal/desktop/widget/project.caseState/bizagi.workportal.desktop.widgets.project.caseState.js","jquery/workportal/desktop/widget/project.activityState/bizagi.workportal.desktop.widgets.project.activityState.js","jquery/workportal/desktop/widget/project.processState/bizagi.workportal.desktop.widgets.project.processState.js","jquery/workportal/desktop/widget/project.users/bizagi.workportal.desktop.widgets.project.users.js","jquery/workportal/desktop/widget/project.subprocesses.data/bizagi.workportal.desktop.widgets.project.subprocesses.data.js","jquery/workportal/desktop/widget/project.events/bizagi.workportal.desktop.widgets.project.events.js","jquery/workportal/desktop/widget/project.subprocesses/bizagi.workportal.desktop.widgets.project.subprocesses.js","jquery/workportal/desktop/widget/project.activityMap/bizagi.workportal.desktop.widgets.project.activityMap.js","jquery/workportal/desktop/widget/project.processMap/bizagi.workportal.desktop.widgets.project.activityMap.tooltip.js","jquery/workportal/desktop/widget/project.activity.description/bizagi.workportal.project.activity.description.js"],"names":["bizagi","workportal","widgets","widget","extend","init","workportalFacade","dataService","params","self","this","_super","loadTemplates","project-dashboard-menu","getTemplate","concat","renderContent","content","$","postRender","contextsLeftSidebarCaseDashboard","forEach","context","sub","proxy","updateView","event","args","plan","idActivitySelected","undefined","clean","$content","getContent","empty","type","showContextByMenuDashboard","argsTemplate","showFormOverview","menuDashboard","showFormActivity","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isAdhocProcess","util","isEnableFeature","showPlanOptionMenu","contextPlanOptionMenu","contextFormActivityOptionMenu","render","appendTo","toUpperCase","addClass","siblings","removeClass","handlerEvents","loadContentById","preventDefault","$item","target","closest","hasClass","data","when","autoSave","done","document","getLevelNavigator","pub","currentLevelNavigator","parseInt","nameItemNavigator","newLevelNavigator","localization","getResource","refreshLastItemBreadcrumb","histName","level","subMenuHandler","$comments","$files","$timeline","on","toggle","options","action","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","idCase","idTask","idWorkflow","idWorkItem","idWorkitem","referrer","publish","unsub","off","injector","register","project","dashboard","menu","activity","project-content-dashboard","template","setTimeout","window","trigger","instanceBizagiProcessMap","processMap","project-processmap","project-process-diagram","project-activity-map","project-subprocess","viewOptions","configureHandlers","onProcessDiagram","onActivityMap","onSupprocess","navigationManager","response","container","append","renderProcessDiagram","resize","renderActivityMap","renderSubProcessMap","appendActivityMapZoom","appendProcessMapZoom","appendSubprocessZoom","appendSubprocessDragScroll","bindTooltip","tooltipParams","graphicquery","getPVHeight","defaultHeight","height","canvasPst","$header","contextsSidebarActivity","datePickerRegional","project-caseState","project-caseState-popup-release","project-caseState-remaining","releaseDialogBox","formContent","plugins","popupRelease","form","buttonAccept","buttonCancel","onClickAcceptRelease","onClickCancelRelease","isFavoriteCase","isFavorite","JSON","parse","showCaseNumber","creationDate","INVARIANT_FORMAT","creationDateObject","dateFormatter","getDateFromFormat","creationDateFormat","getFormattedDate","solutionDateObject","solutionDate","solutionDateFormat","currentDate","Date","calculateDataForTemplate","showGraphicQuery","idCaseForGraphicQuery","idWorkFlow","isAdhoc","idProcess","idAdhocProcess","showHelpUrl","helpUrl","paramsEffectiveDuration","idUser","currentUser","parseBoolean","isOpen","fromDate","getTime","toDate","differenceCreationToCurrent","relativeTime","getRelativeTime","now","relativeTimeState","replace","colorStateCase","percentCompleteBar","contentTemplate","validateUrlWellFormed","security","menuSecurity","urlHelp","isEmpty","onClickFavorite","goToCase","showBackNextNavigation","dateObj","monthsNames","monthNames","shortMonth","getMonth","bizagiLanguage","BIZAGI_LANGUAGE","length","substring","datepicker","formatDate","favoriteOptions","idObject","favoriteType","addFavorite","favoritesData","guidFavorite","idFavorites","delFavorite","open","onSelectMenu","ui","currentTarget","find","item","onClickMenuReasign","onClickMenuRelease","loader","startAndThen","then","widgetName","BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE","closeVisible","maximize","modalParameters","title","width","id","dialog","resizable","draggable","modal","close","detach","releaseActivity","message","status","currentInboxView","showMessageBox","fail","callGetEffectiveDuration","d","Deferred","getEffectiveDuration","resolve","promise","cntxtSidebarActivity","getBackCase","getNextCase","getListKey","lstIdCases","i","key","nextCase","backCase","hide","show","caseState","project-activityState-wrapper","currentState","currentWorkitem","filter","objectWorkItem","activityName","state","activityIsEvent","isEvent","initDateObject","entryDateWorkItem","initDateFormat","estimatedSolutionDateObject","estimatedSolutionDate","estimatedSolutionDateFormat","updateTemplateWidget","initilizeActionMenu","allowsReassign","j","btReassing","btShareActivity","onClickShareActivity","button","attr","getShareActivity","notifier","parent","get","value","unbind","showSucessMessage","showErrorMessage","always","diffMillisecondsCurrentToEstimated","diffMillisecondsCreationToSolution","paramsEffectiveDurationOpened","currentDateExceededEstimatedDate","paramsEffectiveDurationInitialToEstimated","differenceCreatedToCurrent","differenceCurrentToEstimated","differenceInitialToEstimated","colorState","showEstimatedSolutionDate","percentBar","getPercentBar","percent","canShareActivity","isShared","totalMinutes","sectionMinutes","Math","round","override","enableShareActivity","shareActivityTooltip","activityButton","texto","tooltip","tooltipClass","position","my","at","of","collision","activityState","project-process-state","displayName","onClickGoToParentCase","routingExecute","processState","relatedusers","users","loadedUsers","project-users","onRenderFinish","showCreatorInformation","typesAssignUser","createdBy","userId","typeName","userIds","getUsersData","user","userInfo","usersAdapter","createJsonUserInfo","name","username","picture","email","getInitials","userinformation","responseSubprocessState","responseSubprocess","newValue","auxArrayListSubprocessesState","auxArrayListSubprocesses","newItem","jQuery","isArray","push","Class","project-subprocesses-tootip-custom-properties","initializeTooltip","selectorTooltip","indexSubprocess","idCustData","text","val","itemsFinded","getContentTooltip","$id","not","remove","hover","stop","fadeTo","fadeOut","textLI","templateTooltip","rowCustomProperty","nameProperty","valueProperty","arrayCustomsProperties","auxValueProperty","subprocessData","getSubprocessData","custData","custDataTypes","custFields","formatMonetaryCell","formatBoolean","formatDecimalCell","objectTemplate","nameSubprocess","contentTableCustomProperties","html","subProcessData","subProcess","subProcesses","subProcPersonalized","customFields","CustFields","Object","keys","subprocesses","project-events","getArgsTemplate","responseArgsTemplate","onClickGoEvent","def","callSummaryCaseEvents","responseEvents","elementEvent","summaryCaseEvents","events","project-subprocesses","summarySubProcess","organizeDataForSubprocesses","showSubProcess","each","tempSubprocesses","radNumber","renderWidget","onClickGoSubprocess","pluginTooltip","project-activityMap","actualState","activityMap","project-tooltip","cache","dateFormat","gqData","onProcess","onIdCase","ev","$container","items","callback","diagram","is","className","baseVal","indexOf","getActivityMapTooltipContent","getSubprocessTooltipContent","duration","effect","delay","$ui","guidWorkitem","isCached","buildContent","getActivitySummary","appendToCache","endDate","startDate","process","tmpl","assignee","graphicQuery","GraphicQuery","formatInvariantDate","project-activity-description","description","getWorkitemDescription","tskDescription"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity\").concat(\"#project-dashboard-menu1\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n         self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Update view\r\n    * @param event\r\n    * @param params\r\n    */\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.params.plan.idActivitySelected = undefined;\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      if(typeof event.type !== \"undefined\"){\r\n         self.params.showContextByMenuDashboard = event.type;\r\n      }\r\n\r\n      var argsTemplate = {\r\n         showFormOverview: self.params.menuDashboard.showFormOverview,\r\n         showFormActivity: self.params.menuDashboard.showFormActivity,\r\n         showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu &&\r\n            (!self.params.isAdhocProcess ||\r\n            (self.params.isAdhocProcess && bizagi.util.isEnableFeature(\"enableTimelineOnLiveProcesses\"))),\r\n         showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\r\n         contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\r\n         contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu\r\n      };\r\n\r\n      //Update widget\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      template.render(argsTemplate).appendTo($content);\r\n\r\n      if(self.params.showContextByMenuDashboard){\r\n         $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n      }\r\n\r\n      self.handlerEvents();\r\n   },\r\n\r\n   /**\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if (!$item.hasClass(\"active\")) {\r\n\r\n         var showContextByMenuDashboard = $item.data(\"context\");\r\n\r\n         if (showContextByMenuDashboard) {\r\n            $.when(bizagi.util.autoSave()).done(function () {\r\n               $(document).data('auto-save', '');\r\n\r\n               var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\" });\r\n               var currentLevelNavigator = parseInt(getLevelNavigator[0], 10);\r\n               var nameItemNavigator = \"\";\r\n               var newLevelNavigator = currentLevelNavigator;\r\n\r\n               if(showContextByMenuDashboard == \"PLANACTIVITIES\"){\r\n                  newLevelNavigator = currentLevelNavigator + 1;\r\n                  nameItemNavigator = bizagi.localization.getResource(\"workportal-project-casedashboard-plan\");\r\n               }\r\n\r\n               self.params.refreshLastItemBreadcrumb = false;\r\n               self.pub(\"notify\", {\r\n                  type: showContextByMenuDashboard.toUpperCase(),\r\n                  args: $.extend(self.params, { showContextByMenuDashboard: showContextByMenuDashboard,\r\n                     histName: nameItemNavigator,\r\n                     level: newLevelNavigator })\r\n               });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n            });\r\n         }\r\n      }\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n       var self = this;\r\n       var content = self.getContent();\r\n       var $comments = $(\"[data-context='COMMENTS']\", content);\r\n       var $files = $(\"[data-context='FILES']\", content);\r\n       var $timeline = $(\"[data-context='TIMELINE']\", content);\r\n\r\n       $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n           $comments.toggle();\r\n           $files.toggle();\r\n           $timeline.toggle();\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Handler events\r\n    */\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      self.subMenuHandler();\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\", $.proxy(self.loadContentById, self));\r\n\r\n       // Bind for click event on refresh botton\r\n       $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).on(\"click\", function () {\r\n           var options = {\r\n               action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n               idCase: self.params.idCase,\r\n               idTask: self.params.idTask,\r\n               idWorkflow: self.params.idWorkflow,\r\n               idWorkItem: self.params.idWorkitem,\r\n               referrer: self.params.referrer || \"inboxGrid\"\r\n           };\r\n           self.publish(\"executeAction\", options);\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Clean widgets and events\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n      $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).off();\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-content-dashboard\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n\r\n      setTimeout(function(){\r\n         $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\r\n      }, 1000);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","/**\r\n * This module manage all graphical diagrams of process map\r\n *\r\n * @author Edward J Morales\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.processMap\", {}, {\r\n\r\n\t/**\r\n\t * Constructor\r\n\t * @param workportalFacade instance of facade, mandatory\r\n\t * @param dataService instance of service tier, mandatory\r\n\t * @param params extra params, its not mandatory\r\n\t */\r\n\tinit: function(workportalFacade, dataService, params) {\r\n\t\tvar self = this;\r\n\r\n\t\t// Call parent instance\r\n\t\tself._super(workportalFacade, dataService, params);\r\n\t\tself.instanceBizagiProcessMap = new bizagi.processMap(this);\r\n\t\t\r\n\t\t//Load templates\r\n\t\tself.loadTemplates({\r\n\t\t\t\"project-processmap\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.processMap\").concat(\"#project-processmap-wrapper\"),\r\n\t\t\t\"project-process-diagram\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.processMap\").concat(\"#project-processmap-process-diagram\"),\r\n\t\t\t\"project-activity-map\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.processMap\").concat(\"#project-processmap-activity-map\"),\r\n\t\t\t\"project-subprocess\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.processMap\").concat(\"#project-processmap-subprocess\")\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Render a content of the module\r\n\t * @return {string} html\r\n\t */\r\n\trenderContent: function() {\r\n\t\tvar self = this;\r\n\t\tvar template= self.instanceBizagiProcessMap.renderContent();\r\n        self.content = template.render(self.viewOptions);\r\n\t\treturn self.content;\r\n\t},\r\n\r\n\t/**\r\n\t * Set binding and set data\r\n\t */\r\n\tpostRender: function() {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.postRender();\r\n\t},\r\n\r\n    /**\r\n\t *  Binds events to handlers\r\n\t */\r\n    configureHandlers: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.configureHandlers();\r\n    },\r\n\r\n\t/**\r\n\t * Process diagram handler\r\n\t */\r\n    onProcessDiagram: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.onProcessDiagram();\r\n    },\r\n\r\n\t/**\r\n\t * Activity map handler\r\n\t */\r\n    onActivityMap: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.onActivityMap();\r\n    },\r\n\r\n\t/**\r\n\t * Subprocess handler\r\n\t */\r\n    onSupprocess: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.onSupprocess();\r\n    },\r\n\r\n\t/**\r\n\t * Manage navigation between the 3 diagrams\r\n\t * @param template\r\n\t * @param params\r\n\t */\r\n    navigationManager: function (template) {\r\n        var self = this;\r\n\t\tvar response = self.instanceBizagiProcessMap.navigationManager(template);\r\n\t\tresponse.container.append(response.template.render(response.viewOptions));\r\n    },\r\n\r\n\t/**\r\n\t * Render the process diagram in the process diagram container\r\n\t */\r\n    renderProcessDiagram: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.renderProcessDiagram();\r\n    },\r\n\r\n    resize: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.resize();\r\n    },\r\n\t/**\r\n\t * Set plugin activity map, draw sequence map\r\n\t */\r\n    renderActivityMap: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.renderActivityMap();\r\n    },\r\n\r\n    renderSubProcessMap: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.renderSubProcessMap();\r\n    },\r\n\r\n\t/**\r\n\t * Append the activity map zoom\r\n\t */\r\n    appendActivityMapZoom: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.appendActivityMapZoom();\r\n    },\r\n\r\n\t/**\r\n\t * Append the process map zoom\r\n\t */\r\n    appendProcessMapZoom: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.appendProcessMapZoom();\r\n    },\r\n\r\n\t/**\r\n\t * Append the subprocess zoom\r\n\t */\r\n    appendSubprocessZoom: function () {\r\n        var self = this\r\n        self.instanceBizagiProcessMap.appendSubprocessZoom();\r\n    },\r\n\t/**\r\n\t * Append the subprocess drag and scroll\r\n\t */\r\n    appendSubprocessDragScroll: function () {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.appendSubprocessDragScroll();\r\n\r\n    },\r\n\r\n\t/**\r\n\t * binds the tooltip to each activity in activity map\r\n\t */\r\n    bindTooltip: function (tooltipParams) {\r\n        var self = this;\r\n        self.instanceBizagiProcessMap.bindTooltip(tooltipParams);\r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.processMap', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.processMap]);","/**\r\n * This module manage graphical diagram of process diagram\r\n *\r\n * @author Andrs Fernando Muoz\r\n */\r\nbizagi.workportal.widgets.graphicquery.extend(\"bizagi.workportal.widgets.project.processDiagram.helper\", {}, {\r\n\t/**\r\n\t * Set Height for process viewer\r\n\t * @Overriden\r\n\t */\r\n\tgetPVHeight: function () {\r\n\t\tvar self = this;\r\n\t\tvar defaultHeight = $(window).height() - 50;\r\n\t\tvar canvasPst = self.$header.height() + 180;\r\n\t\tvar cntHeight = $(\".ui-bizagi-wp-project-tab-content\").height();\r\n\t\tvar cntHeight = cntHeight || defaultHeight;\r\n\t\treturn cntHeight - canvasPst;\r\n\t}\r\n});\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Case State Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.caseState\", {}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n        //Regional\r\n        self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-caseState\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.caseState\").concat(\"#project-caseState-wrapper\"),\r\n            \"project-caseState-popup-release\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.caseState\").concat(\"#project-caseState-popup-release\"),\r\n            \"project-caseState-remaining\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.caseState\").concat(\"#project-caseState-remaining\")\r\n        });\r\n\r\n        self.releaseDialogBox = {};\r\n    },\r\n\r\n    /**\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n\r\n        self.releaseDialogBox.formContent = self.getTemplate(\"project-caseState-popup-release\").render({});\r\n\r\n        return self.content;\r\n    },\r\n\r\n    /*\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n        var cntxtSidebarActivity = self.contextsSidebarActivity || [];\r\n        //Handlers\r\n        cntxtSidebarActivity.forEach(function (context) {\r\n            self.sub(context, $.proxy(self.updateView, self));\r\n        });\r\n\r\n        self.plugins = {};\r\n        self.plugins.popupRelease = {\r\n            form: {\r\n                buttonAccept: $(\"#button-accept-release\", self.releaseDialogBox.formContent),\r\n                buttonCancel: $(\"#button-cancel-release\", self.releaseDialogBox.formContent)\r\n            }\r\n        };\r\n\r\n        self.plugins.popupRelease.form.buttonAccept.on(\"click\", $.proxy(self.onClickAcceptRelease, self));\r\n        self.plugins.popupRelease.form.buttonCancel.on(\"click\", $.proxy(self.onClickCancelRelease, self));\r\n\r\n    },\r\n\r\n    /**\r\n     * Update view when load case\r\n     * @param event\r\n     * @param params\r\n     */\r\n    updateView: function (event, params) {\r\n        var self = this;\r\n        $.extend(self.params, params.args);\r\n        var args = params.args;\r\n        self.getContent().empty();\r\n\r\n        var argsTemplate = {};\r\n\r\n        //is Favorite Case\r\n        argsTemplate.isFavoriteCase = \"off\";\r\n        if (args.isFavorite && JSON.parse(args.isFavorite)) {\r\n            argsTemplate.isFavoriteCase = \"bz-icon-star\";\r\n        }\r\n        else {\r\n            argsTemplate.isFavoriteCase = \"bz-icon-star-outline\";\r\n        }\r\n\r\n        self.showCaseNumber(args, argsTemplate);\r\n\r\n        //Begin Calculated Remaining Date\r\n        if (args.creationDate) {\r\n            var INVARIANT_FORMAT = \"MM/dd/yyyy H:mm\";\r\n            var creationDate = args.creationDate;\r\n            var creationDateObject = bizagi.util.dateFormatter.getDateFromFormat(creationDate, INVARIANT_FORMAT);\r\n            argsTemplate.creationDateFormat = self.getFormattedDate(creationDateObject);\r\n\r\n            var solutionDateObject = bizagi.util.dateFormatter.getDateFromFormat(args.solutionDate, INVARIANT_FORMAT);\r\n            argsTemplate.solutionDateFormat = self.getFormattedDate(solutionDateObject);\r\n\r\n            var currentDate = new Date();\r\n            self.calculateDataForTemplate(argsTemplate, creationDateObject, currentDate, solutionDateObject, args);\r\n        }\r\n        $(self.getContent()).on(\"click\", \".show-diagram-case\", function () {\r\n            var isAdhoc = false;\r\n            if (!self.params.isAdhocProcess || typeof self.params.isAdhocProcess === 'undefined') {\r\n                isAdhoc = false;\r\n            } else {\r\n                isAdhoc = true;\r\n            }\r\n            if (isAdhoc) {\r\n                self.showGraphicQuery({ idCase: self.params.idCaseForGraphicQuery || self.params.idCase, idWorkflow: self.params.idWorkFlow, isAdhoc: true, idProcess: self.params.idAdhocProcess });\r\n            } else {\r\n                self.showGraphicQuery({ idCase: self.params.idCaseForGraphicQuery || self.params.idCase, idWorkflow: self.params.idWorkFlow });\r\n            }\r\n\r\n        });\r\n\r\n        $(self.getContent()).on(\"click\", \".show-process-help\", function () {\r\n            self.showHelpUrl(self.params.helpUrl);\r\n        });\r\n\r\n    },\r\n\r\n    /**\r\n     * Calculate percent bar\r\n     * @param argsTemplate\r\n     * @param creationDateObject\r\n     * @param currentDate\r\n     * @param solutionDateObject\r\n     * @param args\r\n     */\r\n    calculateDataForTemplate: function (argsTemplate, creationDateObject, currentDate, solutionDateObject, args) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        var paramsEffectiveDuration = {};\r\n        paramsEffectiveDuration.idUser = bizagi.currentUser.idUser;\r\n        if (bizagi.util.parseBoolean(args.isOpen)) {\r\n            paramsEffectiveDuration.fromDate = creationDateObject.getTime();\r\n            paramsEffectiveDuration.toDate = currentDate.getTime();\r\n        }\r\n        else {\r\n            paramsEffectiveDuration.fromDate = solutionDateObject.getTime();\r\n            paramsEffectiveDuration.toDate = currentDate.getTime();\r\n        }\r\n\r\n        var differenceCreationToCurrent = paramsEffectiveDuration.toDate - paramsEffectiveDuration.fromDate;\r\n        var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - differenceCreationToCurrent), null, false);\r\n        if (bizagi.util.parseBoolean(args.isOpen)) {\r\n            argsTemplate.relativeTimeState = bizagi.localization.getResource(\"workportal-project-case-state-opened\").replace(\"%s\", relativeTime);\r\n            argsTemplate.colorStateCase = \"Opened\";\r\n        }\r\n        else {\r\n            argsTemplate.relativeTimeState = bizagi.localization.getResource(\"workportal-project-case-state-closed\").replace(\"%s\", relativeTime);\r\n            argsTemplate.colorStateCase = \"Closed\";\r\n        }\r\n\r\n        argsTemplate.percentCompleteBar = 100;\r\n        argsTemplate.isOpen = bizagi.util.parseBoolean(args.isOpen);\r\n        //Update widget\r\n        var contentTemplate = self.getTemplate(\"project-caseState-remaining\");\r\n        contentTemplate\r\n            .render($.extend(args, argsTemplate))\r\n            .appendTo($(\"#ui-bizagi-remaining\", $content));\r\n    },\r\n\r\n    /**\r\n     * Show case number\r\n     * @param args\r\n     * @param argsTemplate\r\n     */\r\n    showCaseNumber: function (args, argsTemplate) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n        var contentTemplate = self.getTemplate(\"project-caseState\");\r\n        var isAdhoc = false;\r\n        if (!this.params.isAdhocProcess || typeof this.params.isAdhocProcess === 'undefined') {\r\n            isAdhoc = false;\r\n        }\r\n        else {\r\n            isAdhoc = this.params.isAdhocProcess;\r\n        }\r\n\r\n        self.params.helpUrl = bizagi.util.validateUrlWellFormed(self.params.helpUrl);\r\n\r\n        contentTemplate\r\n            .render(\r\n                $.extend(\r\n                    args,\r\n                    argsTemplate,\r\n                    {\r\n                        security: bizagi.menuSecurity,\r\n                        isAdhocProcess: isAdhoc,\r\n                        urlHelp: !bizagi.util.isEmpty(self.params.helpUrl)\r\n                    }\r\n                )\r\n            )\r\n            .appendTo($content);\r\n        //Handle events\r\n        $(\".case-summary-favorite\", $content).on(\"click\", $.proxy(self.onClickFavorite, self));\r\n        // Set back and next case navigation\r\n        $(\".case-summary-back\", self.content).on(\"click\", $.proxy(self.goToCase, self, 'back'));\r\n        $(\".case-summary-next\", self.content).on(\"click\", $.proxy(self.goToCase, self, 'next'));\r\n\r\n        self.showBackNextNavigation();\r\n    },\r\n\r\n    /**\r\n     * Get Format date\r\n     * @param dateObj\r\n     * @returns {string}\r\n     */\r\n    getFormattedDate: function (dateObj) {\r\n        var self = this;\r\n        var monthsNames = self.datePickerRegional.monthNames;\r\n        var shortMonth = dateObj.getMonth();\r\n        var bizagiLanguage = BIZAGI_LANGUAGE;\r\n        if (bizagiLanguage != null && bizagiLanguage != undefined && bizagiLanguage.length > 0 && bizagiLanguage.substring(0, 2) == \"fr\")\r\n            return $.datepicker.formatDate(\"dd\", dateObj) + \" \" + monthsNames[shortMonth];\r\n        else\r\n            return monthsNames[shortMonth] + \" \" + $.datepicker.formatDate(\"dd\", dateObj);\r\n    },\r\n\r\n    /***\r\n     * Events\r\n     */\r\n    onClickFavorite: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n        var favoriteOptions = {};\r\n        if ($(event.target).hasClass(\"bz-icon-star-outline\")) {\r\n            favoriteOptions = {\r\n                idObject: self.params.idCase,\r\n                favoriteType: \"CASES\"\r\n            };\r\n            $.when(self.dataService.addFavorite(favoriteOptions)).done(function (favoritesData) {\r\n                self.params.guidFavorite = favoritesData.idFavorites;\r\n                $(event.target).removeClass(\"bz-icon-star-outline\");\r\n                $(event.target).addClass(\"bz-icon-star\");\r\n            });\r\n        }\r\n        else {\r\n            favoriteOptions = {\r\n                idObject: self.params.guidFavorite,\r\n                favoriteType: \"CASES\"\r\n            };\r\n            $.when(self.dataService.delFavorite(favoriteOptions)).done(function () {\r\n                $(event.target).addClass(\"bz-icon-star-outline\");\r\n                $(event.target).removeClass(\"bz-icon-star\");\r\n            });\r\n        }\r\n    },\r\n\r\n    showHelpUrl: function (urlHelp) {\r\n        window.open(urlHelp);\r\n    },\r\n\r\n    /**\r\n     Events\r\n     */\r\n    onSelectMenu: function (event, ui) {\r\n        var self = this;\r\n        if ($(event.currentTarget).find(\"i\").length === 0) {\r\n            var item = $(ui.item).data(\"item\");\r\n            switch (item) {\r\n                case \"reassing\":\r\n                    self.onClickMenuReasign();\r\n                    break;\r\n                case \"release\":\r\n                    self.onClickMenuRelease();\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Executed when user reasign case\r\n     */\r\n    onClickMenuReasign: function () {\r\n        var self = this;\r\n        var idCase = self.params.idCase;\r\n        var idWorkItem = self.params.idWorkitem;\r\n        bizagi.loader.startAndThen(\"admin\").then(function () {\r\n            $.when(self.publish(\"showDialogWidget\", {\r\n                widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,\r\n                data: {\r\n                    \"idCase\": idCase,\r\n                    \"idWorkItem\": idWorkItem\r\n                },\r\n                closeVisible: false,\r\n                maximize: true,\r\n                modalParameters: {\r\n                    title: bizagi.localization.getResource(\"render-actions-reassign\"),\r\n                    width: \"910px\",\r\n                    id: \"CaseAdmin\"\r\n                }\r\n            }));\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Triggered when select option from contextual menu\r\n     */\r\n    onClickMenuRelease: function () {\r\n        var self = this;\r\n        self.releaseDialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"660px\",\r\n            modal: true,\r\n            title: bizagi.localization.getResource(\"workportal-widget-dialog-box-release-ok\"),\r\n            maximize: true,\r\n            close: function () {\r\n                self.releaseDialogBox.formContent.dialog(\"destroy\");\r\n                self.releaseDialogBox.formContent.detach();\r\n            }\r\n        });\r\n    },\r\n\r\n\r\n    /**\r\n     * Triggered when user click over accept button\r\n     */\r\n    onClickAcceptRelease: function () {\r\n        var self = this;\r\n        var params = {\r\n            idCase: self.params.idCase,\r\n            idWorkItem: self.params.idWorkitem\r\n        };\r\n        $.when(self.dataService.releaseActivity(params)).done(function (data) {\r\n            var status = data.status ? data.status : \"\";\r\n            var message;\r\n            switch (status) {\r\n                case \"Success\":\r\n                    //go to inbox\r\n                    self.publish(\"changeWidget\", {\r\n                        widgetName: bizagi.workportal.currentInboxView\r\n                    });\r\n                    break;\r\n\r\n                case \"ConfigurationError\":\r\n                    message = self.getResource(\"workportal-widget-dialog-box-release-configuration-error-message\").replace(\"{0}\", params.idWorkItem);\r\n                    bizagi.showMessageBox(message, self.getResource(\"workportal-widget-dialog-box-release-error\"), \"error\", false);\r\n                    break;\r\n\r\n                default:\r\n                    message = self.getResource(\"workportal-widget-dialog-box-release-error-message\").replace(\"{0}\", params.idWorkItem);\r\n                    bizagi.showMessageBox(message, self.getResource(\"workportal-widget-dialog-box-release-error\"), \"error\", false);\r\n                    break;\r\n            }\r\n        }).fail(function () {\r\n            var message = self.getResource(\"workportal-widget-dialog-box-release-error-message\").replace(\"{0}\", params.idWorkItem);\r\n            bizagi.showMessageBox(message, self.getResource(\"workportal-widget-dialog-box-release-error\"), \"error\", false);\r\n        });\r\n        self.releaseDialogBox.formContent.dialog(\"destroy\");\r\n        self.releaseDialogBox.formContent.detach();\r\n    },\r\n\r\n    /**\r\n     * Close dialog release case\r\n     */\r\n    onClickCancelRelease: function () {\r\n        var self = this;\r\n        self.releaseDialogBox.formContent.dialog(\"destroy\");\r\n        self.releaseDialogBox.formContent.detach();\r\n    },\r\n\r\n    /**\r\n     * Call service effective duration by schedule work\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    callGetEffectiveDuration: function (params) {\r\n        var self = this;\r\n        var d = $.Deferred();\r\n\r\n        if (params.fromDate) {\r\n            $.when(\r\n                self.dataService.getEffectiveDuration(params)\r\n            ).done(function (data) {\r\n                d.resolve(data);\r\n            });\r\n        }\r\n        else {\r\n            d.resolve(null);\r\n        }\r\n\r\n        return d.promise();\r\n    },\r\n\r\n    /**\r\n     * Clean plugins and events\r\n     */\r\n    clean: function () {\r\n        var self = this;\r\n        $(\".show-diagram-case\", self.getContent()).off();\r\n        var cntxtSidebarActivity = self.contextsSidebarActivity || [];\r\n        this.params = {};\r\n        cntxtSidebarActivity.forEach(function (context) {\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n        });\r\n    },\r\n\r\n    goToCase: function (action) {\r\n        var self = this;\r\n        var idCase = (action == 'back' ? self.getBackCase() : self.getNextCase());\r\n        if (idCase > 0) {\r\n            self.publish(\"executeAction\", {\r\n                action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                idCase: idCase\r\n            });\r\n        }\r\n    },\r\n\r\n    getListKey: function () {\r\n        var self = this;\r\n        bizagi.lstIdCases = bizagi.lstIdCases || {};\r\n        if (bizagi.lstIdCases.length > 1) {\r\n            for (var i = 0; i < bizagi.lstIdCases.length; i++) {\r\n                if (self.params.idCase == bizagi.lstIdCases[i]) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n        return -1;\r\n    },\r\n\r\n    getNextCase: function () {\r\n        var self = this;\r\n        var nextIdCase = 0;\r\n        var key = self.getListKey();\r\n\r\n        // Check if last element\r\n        if (bizagi.lstIdCases.length == (key + 1) || bizagi.lstIdCases.length == 1) {\r\n            nextIdCase = -1;\r\n        } else {\r\n            nextIdCase = bizagi.lstIdCases[key + 1];\r\n        }\r\n\r\n        return nextIdCase;\r\n    },\r\n\r\n    getBackCase: function () {\r\n        var self = this;\r\n        var prevIdCase = 0;\r\n        var key = self.getListKey();\r\n\r\n        // Check if first element\r\n        if (key == 0) {\r\n            prevIdCase = -1;\r\n        } else {\r\n            prevIdCase = bizagi.lstIdCases[key - 1] || -1;\r\n        }\r\n\r\n        return prevIdCase;\r\n    },\r\n\r\n    showBackNextNavigation: function () {\r\n        var self = this;\r\n        var nextCase = self.getNextCase();\r\n        var backCase = self.getBackCase();\r\n        nextCase <= 0 ? $(\".case-summary-next\", self.content).hide() : $(\".case-summary-next\", self.content).show();\r\n        backCase <= 0 ? $(\".case-summary-back\", self.content).hide() : $(\".case-summary-back\", self.content).show();\r\n\r\n        if (nextCase <= 0 && backCase <= 0) {\r\n            $(\".content-right-sidebar\").removeClass(\"bz-state-number--active-case\");\r\n            $(\".bz-case-navigation\").hide();\r\n        }\r\n        else {\r\n            $(\".content-right-sidebar\").addClass(\"bz-state-number--active-case\");\r\n            $(\".bz-case-navigation\").show();\r\n        }\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.caseState\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.caseState]);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Activity State Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.activityState\", {}, {\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n      //Regional\r\n      self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-activityState-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.activityState\").concat(\"#project-activityState-wrapper\")\r\n      });\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /*\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      self.contextsSidebarActivity.forEach(function (context) {\r\n         self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n\r\n   },\r\n\r\n   updateView: function (event, params) {\r\n      var self = this,\r\n         args = params.args;\r\n      self.params = args;\r\n      self.getContent();\r\n\r\n      var argsTemplate = {};\r\n      var currentState = args.currentState || [];\r\n\r\n      var currentWorkitem = currentState.filter(function (objectWorkItem) { return objectWorkItem.idWorkItem == args.idWorkitem; })[0];\r\n      \r\n\r\n      if (currentWorkitem) {\r\n         argsTemplate.activityName = currentWorkitem.state;\r\n         argsTemplate.activityIsEvent = bizagi.util.parseBoolean(currentWorkitem.isEvent);\r\n\r\n\r\n         var INVARIANT_FORMAT = \"MM/dd/yyyy H:mm\";\r\n         var initDateObject = bizagi.util.dateFormatter.getDateFromFormat(currentWorkitem.entryDateWorkItem, INVARIANT_FORMAT);\r\n         if (initDateObject.getTime) {\r\n            argsTemplate.initDateFormat = self.getFormattedDate(initDateObject);\r\n         }\r\n\r\n         var currentDate = new Date();\r\n         var estimatedSolutionDateObject = bizagi.util.dateFormatter.getDateFromFormat(currentWorkitem.estimatedSolutionDate, INVARIANT_FORMAT);\r\n         argsTemplate.estimatedSolutionDateFormat = \"\";\r\n\r\n         if (initDateObject.getTime && estimatedSolutionDateObject.getTime && currentWorkitem) {\r\n            self.calculateDataForTemplate(currentWorkitem, argsTemplate, initDateObject, currentDate, estimatedSolutionDateObject,currentState);\r\n         }\r\n         else {\r\n            //Update widget\r\n            self.updateTemplateWidget(argsTemplate,currentState);\r\n         }\r\n      }\r\n   },\r\n\r\n   initilizeActionMenu: function (currentState) {\r\n      var self = this;\r\n      var allowsReassign = false;\r\n\r\n      if (currentState && currentState.length > 0) {\r\n         for (j = 0; j < currentState.length; ++j) {\r\n            if (currentState[j] && self.params && currentState[j].idWorkItem == self.params.idWorkitem) {\r\n               allowsReassign = bizagi.util.parseBoolean(currentState[j].allowsReassign) || false;\r\n            }\r\n         }\r\n      }\r\n      var btReassing = $(\"#bt-case-action-reassing\", self.content);\r\n      var btShareActivity= $(\"#ui-bizagi-wp-project-activity-button:not(.ui-bizagi-wp-project-activity-shared)\", self.content);\r\n\r\n      if (allowsReassign) {\r\n         btReassing.show();\r\n      }\r\n      btReassing.on(\"click\", function(){\r\n         self.onClickMenuReasign();\r\n      });\r\n      btShareActivity.on(\"click\", function(){\r\n         self.onClickShareActivity();\r\n      });\r\n   },\r\n   /**\r\n     * Executed when user reasign case\r\n     */\r\n    onClickMenuReasign: function () {\r\n      var self = this;\r\n      var idCase = self.params.idCase;\r\n      var idWorkItem = self.params.idWorkitem;\r\n      bizagi.loader.startAndThen(\"admin\").then(function () {\r\n         $.when(self.publish(\"showDialogWidget\", {\r\n            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,\r\n            data: {\r\n               \"idCase\": idCase,\r\n               \"idWorkItem\": idWorkItem\r\n            },\r\n            closeVisible: false,\r\n            maximize: true,\r\n            modalParameters: {\r\n               title: bizagi.localization.getResource(\"render-actions-reassign\"),\r\n               width: \"910px\",\r\n               id: \"CaseAdmin\"\r\n            }\r\n         }));\r\n      });\r\n  },\r\n\r\n   /**\r\n    * let share the activity\r\n    */\r\n   onClickShareActivity: function () {\r\n         var self = this;\r\n         var params= {\r\n            \"idWorkItem\": self.params.idWorkitem\r\n         };\r\n         var button=$(\"#ui-bizagi-wp-project-activity-button\", self.content);\r\n         button.attr(\"disabled\", true);\r\n         $.when(self.dataService.getShareActivity(params)).done(function (data) {\r\n            var notifier = window.parent.bizagi.injector.get('notifier');\r\n            if (data.value===true) {\r\n               button.addClass(\"ui-bizagi-wp-project-activity-shared\")\r\n                  .unbind(\"click\");\r\n               notifier.showSucessMessage(bizagi.localization.getResource(\"workportal-project-activity-success-message\"), '');\r\n            } else {\r\n               notifier.showErrorMessage(bizagi.localization.getResource(\"workportal-project-activity-error-message\"), '');\r\n            }\r\n         }).always(function () {\r\n            button.attr(\"disabled\", false);\r\n         });\r\n   },\r\n\r\n   calculateDataForTemplate: function (currentWorkitem, argsTemplate, creationDateObject, currentDate, estimatedSolutionDateObject, currentState) {\r\n      var self = this;\r\n\r\n      var diffMillisecondsOpened = new Date(Date.now() - creationDateObject.getTime());\r\n      var diffMillisecondsCurrentToEstimated = (currentDate.getTime() - estimatedSolutionDateObject.getTime());\r\n      var diffMillisecondsCreationToSolution = (creationDateObject.getTime() - estimatedSolutionDateObject.getTime());\r\n\r\n      var paramsEffectiveDurationOpened = {\r\n         idUser: bizagi.currentUser.idUser,\r\n         fromDate: creationDateObject.getTime(),\r\n         toDate: Date.now()\r\n      };\r\n\r\n      var currentDateExceededEstimatedDate = false;\r\n      var paramsEffectiveDuration = {\r\n         idUser: bizagi.currentUser.idUser,\r\n         fromDate: currentDate.getTime(),\r\n         toDate: estimatedSolutionDateObject.getTime()\r\n      };\r\n      var paramsEffectiveDurationInitialToEstimated = {};\r\n      if (diffMillisecondsCurrentToEstimated > 0) {//Exceeded limit estimatedSolution\r\n         paramsEffectiveDuration.fromDate = estimatedSolutionDateObject.getTime();\r\n         paramsEffectiveDuration.toDate = currentDate.getTime();\r\n         currentDateExceededEstimatedDate = true;\r\n      }\r\n      else {\r\n         paramsEffectiveDurationInitialToEstimated.idUser = bizagi.currentUser.idUser;\r\n         paramsEffectiveDurationInitialToEstimated.fromDate = creationDateObject.getTime();\r\n         paramsEffectiveDurationInitialToEstimated.toDate = estimatedSolutionDateObject.getTime();\r\n      }\r\n\r\n      var differenceCreatedToCurrent = paramsEffectiveDurationOpened.toDate - paramsEffectiveDurationOpened.fromDate;\r\n      var differenceCurrentToEstimated = paramsEffectiveDuration.toDate - paramsEffectiveDuration.fromDate;\r\n      var differenceInitialToEstimated = diffMillisecondsCurrentToEstimated > 0 ? 0 : paramsEffectiveDurationInitialToEstimated.toDate - paramsEffectiveDurationInitialToEstimated.fromDate;\r\n\r\n      var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - differenceCreatedToCurrent), null, false);\r\n      argsTemplate.colorState = currentWorkitem.colorState;\r\n      argsTemplate.relativeTimeState = bizagi.localization.getResource(\"workportal-project-activity-state-opened\").replace(\"%s\", relativeTime);\r\n      argsTemplate.percentCompleteBar = 100;\r\n\r\n      if (diffMillisecondsCreationToSolution === 0) {\r\n         argsTemplate.showEstimatedSolutionDate = false;\r\n      }\r\n      else {\r\n         argsTemplate.showEstimatedSolutionDate = true;\r\n         if (currentDateExceededEstimatedDate === false) {\r\n            var percentBar = self.getPercentBar((differenceInitialToEstimated / 1000 / 60), (differenceCurrentToEstimated / 1000 / 60));\r\n            argsTemplate.percentCompleteBar = percentBar.percent;\r\n         }\r\n      }\r\n\r\n      if (currentWorkitem) {\r\n         argsTemplate.isEvent = bizagi.util.parseBoolean(currentWorkitem.isEvent);\r\n         argsTemplate.canShareActivity = currentWorkitem.canShareActivity;\r\n         argsTemplate.isShared = currentWorkitem.isShared;\r\n      }\r\n\r\n      argsTemplate.estimatedSolutionDateFormat = self.getFormattedDate(estimatedSolutionDateObject);\r\n\r\n      //Update widget\r\n      self.updateTemplateWidget(argsTemplate, currentState);\r\n   },\r\n\r\n   getPercentBar: function (totalMinutes, sectionMinutes) {\r\n      var response = {};\r\n      response.percent = Math.round((1 - (sectionMinutes / totalMinutes)) * 100);\r\n      return response;\r\n   },\r\n\r\n\r\n   updateTemplateWidget: function (argsTemplate, currentState) {\r\n      var self = this,\r\n         $content = self.getContent().empty();\r\n      if (bizagi.override.enableShareActivity===false) {\r\n         argsTemplate.canShareActivity=false;\r\n         argsTemplate.isShared=false;\r\n      }\r\n      //Update widget\r\n      var contentTemplate = self.getTemplate(\"project-activityState-wrapper\");\r\n      contentTemplate\r\n         .render(argsTemplate).appendTo($content);\r\n\r\n      if (currentState.length > 0) {\r\n         self.initilizeActionMenu(currentState);\r\n      }\r\n      self.shareActivityTooltip();\r\n   },\r\n\r\n   /**\r\n    * show tooltip when the activity is shared or can be\r\n    */\r\n   shareActivityTooltip: function(){\r\n      var self = this;\r\n      var activityButton=$(\"#ui-bizagi-wp-project-activity-button\", self.content);\r\n      activityButton.on('mouseenter', function () {\r\n         var texto=activityButton.hasClass(\"ui-bizagi-wp-project-activity-shared\")?\"workportal-project-activity-shared\":\"workportal-project-activity-share\";\r\n         activityButton.attr(\"title\", bizagi.localization.getResource(texto));\r\n      });\r\n      activityButton.tooltip({\r\n         tooltipClass: \"custom-tooltip-styling-bottom-bar\", \r\n         position: {\r\n            my: 'right top',\r\n            at: 'left top',\r\n            of: activityButton,\r\n            collision: 'flip'\r\n         }\r\n      });\r\n   },\r\n\r\n   getFormattedDate: function (dateObj) {\r\n      var self = this;\r\n      var monthsNames = self.datePickerRegional.monthNames;\r\n      var shortMonth = dateObj.getMonth();\r\n      var bizagiLanguage = BIZAGI_LANGUAGE;\r\n      if (bizagiLanguage != null && bizagiLanguage != undefined && bizagiLanguage.length > 0 && bizagiLanguage.substring(0, 2) == \"fr\")\r\n         return $.datepicker.formatDate(\"dd\", dateObj) + \" \" + monthsNames[shortMonth];\r\n      else\r\n         return monthsNames[shortMonth] + \" \" + $.datepicker.formatDate(\"dd\", dateObj);\r\n   },\r\n\r\n   clean: function () {\r\n      var self = this;\r\n      var cntxtSidebarActivity = self.contextsSidebarActivity || [];\r\n      this.params = {};\r\n      cntxtSidebarActivity.forEach(function (context) {\r\n         self.unsub(context, $.proxy(self.updateView, self));\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n   callGetEffectiveDuration: function (params) {\r\n      var self = this;\r\n      var d = $.Deferred();\r\n\r\n      //Fix .NET, multiple call service with same data in a few milliseconds\r\n      setTimeout(function () {\r\n         if (params.fromDate) {\r\n            $.when(\r\n               self.dataService.getEffectiveDuration(params)\r\n            ).done(function (data) {\r\n               d.resolve(data);\r\n            });\r\n         }\r\n         else {\r\n            d.resolve(null);\r\n         }\r\n      }, 200);\r\n\r\n\r\n      return d.promise();\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.activityState\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.activityState]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Process State Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.processState\", {}, {\r\n      /*\r\n       *   Constructor\r\n       */\r\n      init: function (workportalFacade, dataService, params) {\r\n         var self = this;\r\n\r\n         // Call base\r\n         self._super(workportalFacade, dataService, params);\r\n\r\n         self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n         //Load templates\r\n         self.loadTemplates({\r\n            \"project-process-state\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.processState\").concat(\"#project-process-state\")\r\n         });\r\n      },\r\n\r\n      /*\r\n       * Renders the template defined in the widget\r\n       */\r\n      renderContent: function () {\r\n         var self = this;\r\n         var template = self.getTemplate(\"project-process-state\");\r\n         self.content = template.render({});\r\n         return self.content;\r\n      },\r\n\r\n      /*\r\n       * links events with handlers\r\n       */\r\n      postRender: function () {\r\n         var self = this;\r\n\r\n         //Handlers\r\n         self.contextsSidebarActivity.forEach(function(context){\r\n            self.sub(context, $.proxy(self.updateView, self));\r\n         });\r\n      },\r\n\r\n      updateView: function (event, params) {\r\n         var self = this,\r\n            args = params.args,\r\n            $content = self.getContent().empty();\r\n         self.params = args;\r\n\r\n         var argsTemplate = {};\r\n         argsTemplate[\"showParentProcess\"] = (args[\"idParentCase\"] >= 1) ? true : false;\r\n         argsTemplate[\"parentProcess\"] = {\r\n            \"displayName\": args[\"parentDisplayName\"],\r\n            \"idCase\": args[\"idParentCase\"],\r\n            \"idWorkItem\": args[\"idWorkItem\"],\r\n            \"idTask\": args[\"idTask\"] == \"0\" ? \"\" : args[\"idTask\"],\r\n            \"idWorkflow\": args[\"idWorkflowParentCase\"]\r\n         };\r\n\r\n         //Update widget\r\n         var contentTemplate = self.getTemplate(\"project-process-state\");\r\n         contentTemplate\r\n            .render($.extend(args, argsTemplate))\r\n            .appendTo($content);\r\n\r\n         //handle click\r\n\r\n         $(\"#go-to-parent-case\", $content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\r\n\r\n      },\r\n\r\n      onClickGoToParentCase: function (event) {\r\n         event.preventDefault();\r\n         var self = this;\r\n\r\n         self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\r\n      },\r\n\r\n      clean: function () {\r\n         var self = this;\r\n         self.params = {};\r\n         self.contextsSidebarActivity.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n   }\r\n);\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.processState', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.processState]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Users Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.users\", {}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, relatedusers, params) {\r\n        var self = this;\r\n        self.relatedusers = relatedusers;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n        self.plugins = {};\r\n        self.users = [];\r\n        self.loadedUsers = false;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-users\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.users\").concat(\"#project-users-main\")\r\n        });\r\n    },\r\n\r\n    /*\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    /*\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        //Handlers\r\n        self.contextsSidebarActivity.forEach(function(context){\r\n            self.sub(context, $.proxy(self.updateView, self));\r\n        });\r\n        self.sub('ON_RENDER_FINISH', $.proxy(self.onRenderFinish, self));\r\n    },\r\n\r\n    updateView: function (event, params) {\r\n        var self = this;\r\n        self.params = params;\r\n        setTimeout(function(){\r\n            if(self.loadedUsers === false){\r\n                self.onRenderFinish();\r\n            }\r\n        }, 500);\r\n    },\r\n\r\n    onRenderFinish: function(){\r\n        var self = this;\r\n        var args = self.params.args;\r\n        var $content = self.getContent().empty();\r\n        self.loadedUsers = true;\r\n\r\n        var contentTemplate = self.getTemplate(\"project-users\");\r\n        contentTemplate.render().appendTo($content);\r\n        self.showCreatorInformation($content);\r\n\r\n        var typesAssignUser = [{\r\n            id: args.createdBy.userId,\r\n            typeName: \"owner\"\r\n        }];\r\n\r\n        if (args.idCase > 0) {\r\n            self.relatedusers.render(self.content, \".relatedusers-wrapper\", args.idCase, typesAssignUser);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * show the information of the creator case\r\n     * @param {string} $content html conteiner\r\n     */\r\n    showCreatorInformation: function ($content) {\r\n        var self = this;\r\n        var params = {\r\n           userIds: self.params.args.createdBy.userId,\r\n           width: 50,\r\n           height: 50\r\n        };\r\n  \r\n        self.dataService.getUsersData(params).done(function (user) {\r\n            var userInfo = usersAdapter.createJsonUserInfo(\r\n                user[0].id,\r\n                user[0].name,\r\n                user[0].username,\r\n                user[0].picture?\"data:image/png;base64,\"+user[0].picture:undefined,\r\n                user[0].email,\r\n                user[0].name.getInitials(),\r\n                false,\r\n                true,\r\n                [],\r\n                []\r\n                );\r\n            $content.find(\"#ui-bizagi-wp-project-users-wrapper .ui-bizagi-wp-project-users-creator-info\").userinformation(self, { user: userInfo });\r\n        });\r\n    },\r\n\r\n    clean: function () {\r\n        var self = this;\r\n        self.loadedUsers = false;\r\n        self.contextsSidebarActivity.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n        });\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.users\", [\"workportalFacade\", \"dataService\", \"relatedusers\", bizagi.workportal.widgets.project.users]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Subprocesses Data Tooltip\r\n *   Author: Bizagi Latam\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.subprocesses.data\", {\r\n    \r\n    responseSubprocessState: {},\r\n    responseSubprocess: function(newValue){\r\n        if(newValue){\r\n            responseSubprocessState = newValue;\r\n        }\r\n        return responseSubprocessState;\r\n    },\r\n\r\n    auxArrayListSubprocessesState: [],\r\n    auxArrayListSubprocesses: function(newItem){\r\n        if(newItem){\r\n            if(jQuery.isArray(newItem) && newItem.length === 0){\r\n                this.auxArrayListSubprocessesState.length = 0; //clean array if change reference\r\n            }\r\n            else{\r\n                return this.auxArrayListSubprocessesState.push(newItem);\r\n            }\r\n        }\r\n        else{\r\n            return this.auxArrayListSubprocessesState;\r\n        }\r\n    }\r\n}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        // Init static properties\r\n        self.Class.auxArrayListSubprocesses([]);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-subprocesses-tootip-custom-properties\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.subprocesses.data\").concat(\"#project-subprocesses-tooltip-custom-properties-wrapper\")\r\n        });\r\n    },\r\n\r\n\r\n    initializeTooltip: function (selectorTooltip) {\r\n        var self = this;\r\n        var $content = self.getContent();\r\n\r\n        $(selectorTooltip, $content).tooltip({\r\n            position: {\r\n                collision: \"flipfit\",\r\n                my: \"right center\", at: \"left-10 center\"\r\n            },\r\n            show: null, // show immediately\r\n            content: function () {\r\n\r\n                var idCase = $(this).closest(\"li\").find(\"#idCase\").val();\r\n                var itemsFinded = self.Class.auxArrayListSubprocesses().filter(function(item){\r\n                    return item.idCase == idCase;\r\n                });\r\n\r\n                var indexSubprocess, idCustData, text;\r\n                if(itemsFinded.length > 0){\r\n                    indexSubprocess = itemsFinded[0].indexSubprocess;\r\n                    idCustData = itemsFinded[0].idCustData;\r\n                    text = $(this).text();\r\n\r\n                    return self.getContentTooltip(indexSubprocess, idCustData, text,\r\n                        self.getTemplate(\"project-subprocesses-tootip-custom-properties\"));\r\n                }\r\n\r\n                \r\n            },\r\n            open: function (event, ui) {\r\n                if (typeof (event.originalEvent) === 'undefined') {\r\n                    return false;\r\n                }\r\n                var $id = $(ui.tooltip).attr('id');\r\n                // close any lingering tooltips\r\n                $('div.ui-tooltip').not('#' + $id).remove();\r\n            },\r\n            close: function (event, ui) {\r\n                ui.tooltip.hover(function () {\r\n                    $(this).stop(true).fadeTo(400, 1);\r\n                },\r\n                    function () {\r\n                        $(this).fadeOut('400', function () {\r\n                            $(this).remove();\r\n                        });\r\n                    });\r\n            }\r\n        });\r\n    },\r\n\r\n    getContentTooltip: function (indexSubprocess, idCustData, textLI, templateTooltip) {\r\n        var self = this;\r\n\r\n        //when not show custom columns\r\n        if (idCustData == \"-1\") {\r\n            idCustData = \"0\";//So show only basic data subprocess\r\n        }\r\n\r\n        var rowCustomProperty = function (nameProperty, valueProperty) {\r\n            return {\r\n                nameProperty: nameProperty,\r\n                valueProperty: valueProperty\r\n            };\r\n        };\r\n\r\n        var arrayCustomsProperties = [];\r\n        var auxValueProperty = \"\";\r\n        var subprocessData = self.getSubprocessData(indexSubprocess, idCustData);\r\n        var custData = subprocessData.custData;\r\n        var custDataTypes = subprocessData.custDataTypes;\r\n        var custFields = subprocessData.custFields;\r\n        var displayName = subprocessData.displayName;\r\n\r\n        //subproceso\r\n        arrayCustomsProperties.push(new rowCustomProperty(bizagi.localization.getResource(\"workportal-widget-inboxcommon-subprocess\"), displayName));\r\n\r\n        //Others custom properties\r\n        if (custData.length) {\r\n            for (var i = 0; i < custData.length; i += 1) {\r\n                auxValueProperty = custData[i];\r\n                if (custDataTypes) {\r\n                    if (custDataTypes[i] == \"Money\") {\r\n                        auxValueProperty = bizagi.util.formatMonetaryCell(auxValueProperty);\r\n                    } else {\r\n                        if (custDataTypes[i] == \"Boolean\") {\r\n                            auxValueProperty = bizagi.util.formatBoolean(auxValueProperty);\r\n                        } else {\r\n                            if (custDataTypes[i] == \"Float\" || custDataTypes[i] == \"Real\") {\r\n                                auxValueProperty = bizagi.util.formatDecimalCell(auxValueProperty);\r\n                            }\r\n                            else {\r\n                                if (typeof auxValueProperty === \"function\") {\r\n                                    auxValueProperty = \"\";\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                arrayCustomsProperties.push(new rowCustomProperty(custFields[i], auxValueProperty));\r\n            }\r\n        }\r\n\r\n        //Render properties\r\n        var objectTemplate = {};\r\n        objectTemplate.arrayCustomsProperties = arrayCustomsProperties;\r\n        objectTemplate.nameSubprocess = textLI;\r\n        var contentTemplate = templateTooltip;\r\n        var contentTableCustomProperties = $('<div class=\"bizagi-custom-tooltip-subprocesses\"></div>');\r\n        contentTemplate.render(objectTemplate).appendTo(contentTableCustomProperties);\r\n\r\n        return contentTableCustomProperties.html();\r\n    },\r\n\r\n    getSubprocessData: function (indexSubprocess, idCustData) {\r\n        var self = this;\r\n        var subProcessData = {};\r\n        var subProcess = self.Class.responseSubprocess().subProcesses;\r\n        var subProcPersonalized = self.Class.responseSubprocess().subProcPersonalized;\r\n\r\n        if (subProcess && subProcess.length > 0) {\r\n            subProcessData.custData = subProcess[indexSubprocess].custData;\r\n            subProcessData.custDataTypes = subProcess[indexSubprocess].custDataTypes;\r\n            var customFields = self.Class.responseSubprocess().CustFields[idCustData];\r\n            subProcessData.custFields = customFields[Object.keys(customFields)[0]];\r\n            subProcessData.displayName = subProcess[indexSubprocess].displayName;\r\n        } else if (subProcPersonalized && Object.keys(subProcPersonalized).length > 0) {\r\n            subProcessData.custData = subProcPersonalized[0].subProcesses[indexSubprocess].custData;\r\n            subProcessData.custDataTypes = subProcPersonalized[0].subProcesses[indexSubprocess].custDataTypes;\r\n            subProcessData.custFields = subProcPersonalized[0].CustFields[0];\r\n            subProcessData.displayName = subProcPersonalized[0].subProcesses[indexSubprocess].displayName;\r\n        }\r\n        return subProcessData;\r\n    },\r\n\r\n\r\n    clean: function () {\r\n\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.subprocesses.data\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.subprocesses.data]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Events Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.subprocesses.data.extend(\"bizagi.workportal.widgets.project.events\", { }, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n        \"project-events\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.events\").concat(\"#project-events-wrapper\")\r\n      });\r\n    },\r\n\r\n    /*\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n      var self = this;\r\n      var template = self.getTemplate(\"project-events\");\r\n      self.content = template.render({});\r\n      return self.content;\r\n    },\r\n\r\n    /*\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n      var self = this;\r\n\r\n      //Handlers\r\n      self.contextsSidebarActivity.forEach(function (context) {\r\n        self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n    },\r\n\r\n    updateView: function (event, params) {\r\n      var self = this,\r\n        args = params.args,\r\n        $content = self.getContent().empty();\r\n      self.params = args;\r\n\r\n      $.when(self.getArgsTemplate(args)).done(function (responseArgsTemplate) {\r\n        //Update widget\r\n        var contentTemplate = self.getTemplate(\"project-events\");\r\n        contentTemplate\r\n          .render($.extend(args, responseArgsTemplate))\r\n          .appendTo($content);\r\n\r\n        $(\".list-events li.event a\", $content).on(\"click\", $.proxy(self.onClickGoEvent, self));\r\n\r\n        self.initializeTooltip(\".list-events li\");\r\n      });\r\n    },\r\n\r\n    getArgsTemplate: function (args) {\r\n      var def = $.Deferred(),\r\n        argsTemplate = {},\r\n        self = this;\r\n\r\n      //check if show event tab or not\r\n      if (args[\"countEvents\"] >= 1) {\r\n        for (var i = 0; i < args[\"currentState\"].length; i++) {\r\n          if (args[\"currentState\"][i][\"isEvent\"] == \"true\" && args[\"currentState\"][i][\"idWorkItem\"] == args.idWorkitem) {\r\n            args[\"countEvents\"] = args[\"countEvents\"] - 1;\r\n          }\r\n        }\r\n      }\r\n      argsTemplate[\"showEvents\"] = (args[\"countEvents\"] >= 1) ? true : false;\r\n\r\n      if (argsTemplate[\"showEvents\"]) {\r\n        $.when(self.callSummaryCaseEvents(args.idCase)).done(function (responseEvents) {\r\n          args[\"showEvents\"] = (responseEvents[\"events\"].length >= 1) ? true : false;\r\n\r\n          if (args[\"showEvents\"]) {\r\n            argsTemplate[\"events\"] = [];\r\n            responseEvents[\"events\"].forEach(function (elementEvent) {\r\n              argsTemplate[\"events\"].push($.extend(elementEvent[Object.keys(elementEvent)[0]],\r\n                { idWorkFlow: responseEvents[\"idWorkFlow\"] }));\r\n            });\r\n          }\r\n          def.resolve(argsTemplate);\r\n        });\r\n      }\r\n      else {\r\n        def.resolve(argsTemplate);\r\n      }\r\n      return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Events UI\r\n     */\r\n\r\n    onClickGoEvent: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n      $.when(bizagi.util.autoSave()).done(function () {\r\n        self.routingExecute($(event.target).closest(\"li\"));\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Call services\r\n     */\r\n\r\n    /*\r\n     *  Get data for users\r\n     */\r\n    callSummaryCaseEvents: function (idCase) {\r\n      var self = this,\r\n        def = $.Deferred();\r\n\r\n      $.when(\r\n        self.dataService.summaryCaseEvents({\r\n          idCase: idCase\r\n        })\r\n      ).done(function (events) {\r\n        def.resolve(events);\r\n      });\r\n\r\n      return def.promise();\r\n    },\r\n\r\n    clean: function () {\r\n      var self = this;\r\n      this.params = {};\r\n      self.contextsSidebarActivity.forEach(function (context) {\r\n        self.unsub(context, $.proxy(self.updateView, self));\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.events', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.events], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Subprocesses Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.subprocesses.data.extend(\"bizagi.workportal.widgets.project.subprocesses\", {\r\n\r\n    responseSubprocess: function (newValue) {\r\n        return this._super(newValue);\r\n    },\r\n\r\n    auxArrayListSubprocesses: function (newValue) {\r\n        return this._super(newValue);\r\n    }\r\n\r\n}, {\r\n        /*\r\n         *   Constructor\r\n         */\r\n        init: function (workportalFacade, dataService, params) {\r\n            var self = this;\r\n\r\n            // Call base\r\n            self._super(workportalFacade, dataService, params);\r\n\r\n            self.contextsSidebarActivity = params.contextsSidebarActivity;\r\n\r\n            //Load templates\r\n            self.loadTemplates({\r\n                \"project-subprocesses\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.subprocesses\").concat(\"#project-subprocesses-wrapper\")\r\n            });\r\n        },\r\n\r\n        /*\r\n         * Renders the template defined in the widget\r\n         */\r\n        renderContent: function () {\r\n            var self = this;\r\n            self.content = $(\"<div></div>\");\r\n            return self.content;\r\n        },\r\n\r\n        /*\r\n         * links events with handlers\r\n         */\r\n        postRender: function () {\r\n            var self = this;\r\n\r\n            //Handlers\r\n            self.contextsSidebarActivity.forEach(function (context) {\r\n                self.sub(context, $.proxy(self.updateView, self));\r\n            });\r\n        },\r\n\r\n        updateView: function (event, params) {\r\n            var self = this,\r\n                args = params.args,\r\n                $content = self.getContent().empty();\r\n            self.params = args;\r\n\r\n            if (self.params.idCase > 0) {\r\n                $.when(\r\n                    self.dataService.summarySubProcess({\r\n                        idCase: self.params.idCase\r\n                    })\r\n                ).done(function (responseSubprocess) {\r\n                    self.Class.responseSubprocess(responseSubprocess);\r\n\r\n                    self.organizeDataForSubprocesses(self.params);\r\n                });\r\n            }\r\n        },\r\n\r\n        organizeDataForSubprocesses: function (args) {\r\n            var self = this;\r\n            if (self.Class.responseSubprocess().showSubProcess) {\r\n                $.each(self.Class.responseSubprocess().subProcesses, function (key) {\r\n                    var custData = self.Class.responseSubprocess().subProcesses[key].custData;\r\n                    if (custData && custData.length) {\r\n                        for (var i = 0; i < custData.length; i += 1) {\r\n                            if (custData[i] === null) {\r\n                                custData[i] = \"\";\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                });\r\n\r\n                var subProcess = self.Class.responseSubprocess().subProcesses || self.Class.responseSubprocess().subProcPersonalized;\r\n\r\n                //prepare array with subprocess\r\n                self.Class.auxArrayListSubprocesses([]);\r\n                for (var i = 0; i < Object.keys(subProcess).length; i += 1) {\r\n                    var tempSubprocesses = subProcess[i];\r\n\r\n                    self.Class.auxArrayListSubprocesses({\r\n                        isOpen: tempSubprocesses.isOpen,\r\n                        radNumber: tempSubprocesses.radNumber,\r\n                        displayName: tempSubprocesses.displayName,\r\n                        idCase: tempSubprocesses.idCase,\r\n                        indexSubprocess: i,\r\n                        idCustData: tempSubprocesses.idCustData\r\n                    });\r\n                    if (tempSubprocesses.subProcesses) {\r\n                        Object.keys(tempSubprocesses).forEach(function (key) {//only one iteration\r\n                            self.Class.auxArrayListSubprocesses({\r\n                                isOpen: tempSubprocesses[key].isOpen,\r\n                                radNumber: tempSubprocesses[key].radNumber,\r\n                                displayName: tempSubprocesses[key].displayName,\r\n                                idCase: tempSubprocesses[key].idCase,\r\n                                indexSubprocess: i,\r\n                                idCustData: tempSubprocesses[key].idCustData\r\n                            });\r\n                        });\r\n                    }\r\n                }\r\n\r\n                self.renderWidget();\r\n            }\r\n        },\r\n\r\n        renderWidget: function () {\r\n            var self = this;\r\n            var $content = self.getContent();\r\n\r\n            //Update widget\r\n            var contentTemplate = self.getTemplate(\"project-subprocesses\");\r\n            contentTemplate\r\n                .render({ auxArrayListSubprocesses: self.Class.auxArrayListSubprocesses() })\r\n                .appendTo($content);\r\n\r\n            $(\".list-subprocesses a\", $content).on(\"click\", $.proxy(self.onClickGoSubprocess, self));\r\n\r\n            self.initializeTooltip(\".list-subprocesses li\");\r\n        },\r\n\r\n\r\n        /**\r\n         * Events UI\r\n         */\r\n\r\n        onClickGoSubprocess: function (event) {\r\n            event.preventDefault();\r\n            var self = this;\r\n\r\n            self.routingExecute($(event.target).closest(\"li\"));\r\n        },\r\n\r\n        clean: function () {\r\n            var self = this;\r\n\r\n            self.params = {};\r\n            self.pluginTooltip = null;\r\n\r\n            self.contextsSidebarActivity.forEach(function (context) {\r\n                self.unsub(context, $.proxy(self.updateView, self));\r\n            });\r\n        }\r\n    }\r\n);\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.subprocesses\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.subprocesses]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Activity Map Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.activityMap\", {}, {\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Set radNumber\r\n      self.radNumber = params.radNumber;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-activityMap\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.activityMap\").concat(\"#project-activityMap-wrapper\")\r\n      });\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      var template = self.getTemplate(\"project-activityMap\");\r\n\r\n      self.content = template.render({});\r\n      return self.content;\r\n   },\r\n\r\n   /*\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n\r\n      //Handlers\r\n      self.sub(\"HOME\", $.proxy(self.updateView, self));\r\n      self.sub(\"OVERVIEW\", $.proxy(self.updateView, self));\r\n      self.sub(\"COMMENTS\", $.proxy(self.updateView, self));\r\n      self.sub(\"PROCESSMAP\", $.proxy(self.updateView, self));\r\n      self.sub(\"LOG\", $.proxy(self.updateView, self));\r\n      self.sub(\"PLANCREATE\", $.proxy(self.updateView, self));\r\n      self.sub(\"PLANCOMMENTS\", $.proxy(self.updateView, self));\r\n   },\r\n\r\n   updateView: function (event, params) {\r\n      var self = this,\r\n         args = params.args,\r\n         $content = self.getContent().empty();\r\n\r\n      var argsTemplate = {};\r\n      argsTemplate[\"actualState\"] = \"\";\r\n      if(args.currentState[0]){\r\n         argsTemplate[\"actualState\"] = args.currentState[0].state;\r\n      }\r\n\r\n      //Update widget\r\n      var contentTemplate = self.getTemplate(\"project-activityMap\");\r\n      contentTemplate\r\n         .render($.extend(args, argsTemplate))\r\n         .appendTo($content);\r\n\r\n      self.params = args;\r\n   }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.activityMap', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.activityMap], true);\r\n\r\n","/**\r\n * This module manage the tooltip to show information in activity map and subprocess diagrams\r\n *\r\n * @author Andrs Fernando Muoz\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.activityMap.tooltip\", {}, {\r\n\r\n\t/**\r\n\t * Constructor\r\n\t * @param workportalFacade instance of facade, mandatory\r\n\t * @param dataService instance of service tier, mandatory\r\n\t * @param params extra params, its not mandatory\r\n\t */\r\n\tinit: function(workportalFacade, dataService, params) {\r\n\t\tvar self = this;\r\n\t\t// Call parent instance\r\n\t\tself._super(workportalFacade, dataService, params);\r\n\t\t//Load templates\r\n\t\tself.loadTemplates({\r\n\t\t\t\"project-tooltip\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.activityMap.tooltip\").concat(\"#project-processmap-tooltip\")\r\n\t\t});\r\n\r\n\t\tself.cache = {};\r\n\t\tself.radNumber = params.radNumber;\r\n\t},\r\n\t/**\r\n\t * Render a content of the module\r\n\t * @return {string} html\r\n\t */\r\n\trenderContent: function(){},\r\n\t/**\r\n\t * Set binding and set data\r\n\t */\r\n\tpostRender: function() {\r\n\t\tvar self = this;\r\n\t\tself.dateFormat = self.getResource(\"dateFormat\") + \" \" + self.getResource(\"timeFormat\");\r\n\t},\r\n\t/**\r\n\t *  Binds events to handlers\r\n\t */\r\n\tconfigureHandlers: function (content, gqData) {\r\n\t\tvar self = this;\r\n\t\tcontent.find('.ui-bizagi-wp-project-processmap-process').on('click', $.proxy(self.onProcess, self, gqData));\r\n\t\tcontent.find('.ui-bizagi-wp-project-processmap-tooltip-title').on('click', $.proxy(self.onIdCase, self, gqData));\r\n\t},\r\n\t/**\r\n\t * Process handler\r\n\t * @param ev\r\n\t */\r\n\tonProcess: function(gqData, ev){\r\n\t\tvar self = this;\r\n\t\tself.showGraphicQuery(gqData);\r\n\t},\r\n\t/**\r\n\t * Id case handler\r\n\t * @param ev\r\n\t */\r\n\tonIdCase: function(gqData, ev){\r\n\t\tvar self = this;\r\n\t\tvar idCase = $(ev.currentTarget).data(\"idcase\");\r\n\t\tvar idWorkitem = $(ev.currentTarget).data(\"idworkitem\");\r\n\t\tvar idTask = $(ev.currentTarget).data(\"idtask\");\r\n\t\tvar idWorkflow = $(ev.currentTarget).data(\"idworkflow\");\r\n\r\n\t\tself.publish(\"executeAction\", {\r\n\t\t\taction: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n\t\t\tidCase: idCase,\r\n\t\t\tidWorkItem: idWorkitem,\r\n\t\t\tidTask: idTask,\r\n\t\t\tidWorkflow: idWorkflow\r\n\t\t});\r\n\t},\r\n\t/**\r\n\t * Binds the tooltip to activities\r\n\t * @param params\r\n\t */\r\n\tbindTooltip: function (tooltipParams){\r\n\t\tvar self = this;\r\n\t\tself.tooltipClass = tooltipParams.tooltipClass;\r\n\t\ttooltipParams.$container.tooltip({\r\n\t\t\titems: tooltipParams.items,\r\n\t\t\tcontent: function (callback) {\r\n\t\t\t\tvar isContanerClicked = tooltipParams.$container.data(\"clicked\") || false;\r\n\t\t\t\tif (isContanerClicked){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar diagram = tooltipParams.diagram;\r\n\t\t\t\tif(diagram == \"activityMap\"){\r\n                    if(!$(this).is(\"circle\")){\r\n                        return;\r\n                    } else if(this.className.baseVal.indexOf('activity-map-activity-highlight') < 0){\r\n                    \treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$.when(self.getActivityMapTooltipContent($(this))).done(function (content) {\r\n\t\t\t\t\t\tcallback(content);\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar content = self.getSubprocessTooltipContent($(this));\r\n\t\t\t\t\tcallback(content);\r\n\t\t\t\t}\r\n\t\t\t\treturn \"loading..\";\r\n\t\t\t},\r\n\t\t\topen: function (event, ui) {\r\n\t\t\t    for (var i = 0; i < $(\".ui-tooltip\").length - 1; i++) {\r\n\t\t\t        $('#' + $(\".ui-tooltip\")[i].id).remove();\r\n\t\t\t    }\r\n\t\t\t    \r\n\t\t\t},\r\n\t\t\tshow: { duration: 60, effect: 'none' },\r\n\t\t\ttooltipClass: self.tooltipClass,\r\n\t\t\thide: { delay: 60, duration: 60 },\r\n\t\t\tposition: { my: \"left+20 top+20\"},\r\n\t\t\tclose: function (event, ui) {\r\n\t\t\t\tui.tooltip.hover(\r\n\t\t\t\t\tfunction () {\r\n\t\t\t\t\t\t$(this).stop(true).fadeTo(120, 1);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction () {\r\n\t\t\t\t\t\t$(this).fadeOut(20, function () {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Returns the activity map tooltip content\r\n\t * @param $ui\r\n\t * @returns {*}\r\n\t */\r\n\tgetActivityMapTooltipContent: function ($ui) {\r\n\t\tvar self = this, def = new $.Deferred(),\r\n\t\t\tguidWorkitem = $ui.data(\"guidWorkitem\"),\r\n\t\t\tidCase = $ui.data(\"idCase\"),\r\n\t\t\tidWorkflow = $ui.data(\"idWorkflow\"),\r\n\t\t\tparams = {\r\n\t\t\t\tguidWorkitem: guidWorkitem,\r\n\t\t\t\tgqData: {idCase: idCase, idWorkflow: idWorkflow}\r\n\t\t\t};\r\n\t\tself.guidWorkitem = guidWorkitem;\r\n\r\n\t\tif (self.isCached(params.guidWorkitem)){\r\n\t\t\tvar data = self.cache[params.guidWorkitem];\r\n\t\t\tdef.resolve(self.buildContent(data, params.gqData));\r\n\t\t}else{\r\n\t\t\t$.when(self.dataService.getActivitySummary(params)).done(function (data) {\r\n\t\t\t\tdef.resolve(self.buildContent(data, params.gqData));\r\n\t\t\t\tself.appendToCache(params.guidWorkitem, data);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn def.promise();\r\n\t},\r\n\t/**\r\n\t * Returns the subprocess tooltip content\r\n\t * @param $ui\r\n\t * @returns {*}\r\n\t */\r\n\tgetSubprocessTooltipContent: function ($ui) {\r\n\t\tvar self = this,\r\n\t\t\tidCase = $ui.data(\"idcase\"),\r\n\t\t\tidWorkflow = $ui.data(\"idworkflow\"),\r\n\t\t\tparams = {\r\n\t\t\t\tgqData: {idCase: idCase, idWorkflow: idWorkflow}\r\n\t\t\t};\r\n\r\n\t\tvar data = {\r\n\t\t\t\"endDate\": $ui.data(\"enddate\"),\r\n\t\t\t\"startDate\": $ui.data(\"startdate\"),\r\n\t\t\t\"process\": $ui.data(\"process\"),\r\n\t\t\t\"idCase\": $ui.data(\"idcase\")\r\n\t\t};\r\n\t\treturn self.buildContent(data, params.gqData);\r\n\t},\r\n\t/**\r\n\t * Fill the cache object with data for respective guidWorkitem\r\n\t * @param guidWorkitem\r\n\t * @param data\r\n\t */\r\n\tappendToCache: function (guidWorkitem, data) {\r\n\t\tvar self = this;\r\n\t\tself.cache[guidWorkitem] = data;\r\n\t},\r\n\t/**\r\n\t * Returns true if the guidWorkitem is cached, false otherwise\r\n\t * @param guidWorkitem\r\n\t * @returns {boolean}\r\n\t */\r\n\tisCached: function (guidWorkitem) {\r\n\t\tvar self = this;\r\n\t\treturn (typeof (self.cache[guidWorkitem]) !== \"undefined\");\r\n\t},\r\n\t/**\r\n\t * Build the tooltip content\r\n\t * @param data\r\n\t * @param gqData\r\n\t * @returns {*|jQuery|HTMLElement}\r\n\t */\r\n\tbuildContent: function (data, gqData){\r\n\t\tvar self = this,\r\n\t\t\tcontent = $(\"<div></div>\"),\r\n\t\t\ttmpl = self.getTemplate(\"project-tooltip\"),\r\n\t\t\tassignee = (typeof (data.assigneeName) !== \"undefined\");\r\n\r\n\t\tdata.assignee = assignee;\r\n\t\tdata.radNumber = self.radNumber;\r\n\t\tdata.idWorkflow = gqData.idWorkflow\r\n\t\tdata.idTask = data.idTask || 0;\r\n\t\tdata.idWorkitem = data.idWorkItem || 0;\r\n\t\tdata.graphicQuery = bizagi.menuSecurity.GraphicQuery;\r\n\t\tcontent = tmpl.render(data);\r\n\t\t$(\".\"+self.tooltipClass).html(content);\r\n\t\tbizagi.util.formatInvariantDate(content, self.dateFormat);\r\n\t\tself.configureHandlers(content, gqData);\r\n\t\treturn content;\r\n\t}\r\n});","/*\r\n    Name   : Bizagi Workportal Project Activity Description\r\n    Created on : Jun 27, 2017\r\n    Author     : Diana Mogollon\r\n*/\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.activity.description\", {}, {\r\n\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        params = params || {};\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"project-activity-description\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.activity.description\").concat(\"#project-activity-description\")\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"project-activity-description\");\r\n        var description = self.getWorkitemDescription();\r\n\r\n        if (description) {\r\n            self.content = template.render({ description: description });\r\n        } else {\r\n            self.content = $('<div />');\r\n        }\r\n\r\n        return self.content;\r\n    },\r\n\r\n    /**\r\n     * links events with handlers\r\n     */\r\n    postRender: function () {\r\n        \r\n    },\r\n\r\n    getWorkitemDescription: function () {\r\n        var self = this;\r\n        var params = self.params || {};\r\n        var idWorkitem = params.idWorkitem || 0;\r\n        var currentState = params.currentState || [];\r\n        var description = \"\";\r\n\r\n        for (var i = 0; i < currentState.length; i++) {\r\n            if (idWorkitem == currentState[i].idWorkItem) {\r\n                description = currentState[i].tskDescription;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return description;\r\n    },\r\n    \r\n    /**\r\n     * Clean widget\r\n     */\r\n    clean: function () {\r\n        \r\n    }\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.project.activity.description', ['workportalFacade', 'dataService', bizagi.workportal.widgets.project.activity.description], true);\r\n"]}