{"version":3,"sources":["jquery/workportal/desktop/widget/project.plan.activity.sidebar/bizagi.workportal.desktop.widgets.project.plan.activity.sidebar.js","jquery/workportal/desktop/widget/project.plan.activity.action/bizagi.workportal.desktop.widgets.project.plan.activity.action.js","jquery/workportal/desktop/widget/project.plan.activity.time/bizagi.workportal.desktop.widgets.project.plan.activity.time.js","jquery/workportal/desktop/widget/project.plan.activity.progress/bizagi.workportal.desktop.widgets.project.plan.activity.progress.js","jquery/workportal/desktop/widget/project.plan.activity.subprocesses/bizagi.workportal.desktop.widgets.project.plan.activity.subprocesses.js","jquery/workportal/desktop/widget/project.plan.activity.parent/bizagi.workportal.desktop.widgets.project.plan.activity.parent.js","jquery/workportal/desktop/widget/project.dashboard.menu.activity/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.js","jquery/workportal/desktop/widget/project.dashboard.menu.activity.plan/bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.plan.js","jquery/workportal/desktop/widget/project.content.dashboard/bizagi.workportal.desktop.widgets.project.content.dashboard.js","jquery/workportal/desktop/widget/project.plan.activities/bizagi.workportal.desktop.project.plan.activities.js","jquery/workportal/desktop/widget/project.plan.sidebar/bizagi.workportal.desktop.widgets.project.plan.sidebar.js","jquery/workportal/desktop/widget/project.plan.action/bizagi.workportal.desktop.widgets.project.plan.action.js","jquery/workportal/desktop/widget/project.plan.state/bizagi.workportal.desktop.widgets.project.plan.state.js","jquery/workportal/desktop/widget/project.plan.progress/bizagi.workportal.desktop.widgets.project.plan.progress.js","jquery/workportal/desktop/widget/project.plan.time/bizagi.workportal.desktop.widgets.project.plan.time.js","jquery/workportal/desktop/widget/project.plan.parent/bizagi.workportal.desktop.widgets.project.plan.parent.js","jquery/workportal/desktop/widget/project.plan.users/bizagi.workportal.desktop.widgets.project.plan.users.js"],"names":["bizagi","workportal","widgets","project","base","extend","init","workportalFacade","dataService","serviceloadDataPlan","params","self","this","_super","loadTemplates","project-plan-activity-sidebar","getTemplate","concat","renderContent","template","content","render","postRender","sub","$","proxy","onNotifyLoadInfoPlan","event","parans","plan","idActivitySelected","idPlan","id","loadData","getDateServer","subscribe","loadedWithDataActivities","loadedWithDataFirstParent","showContextByMenuDashboard","pub","type","args","clean","unsubscribe","injector","register","activity","sidebar","notifier","dateFormat","localization","getResource","timeFormat","estimatedFinishDateTime","beforeUserAssignedActivity","activity-action-main","activity-action-editionpopup","dialogBox","onNotifyLoadInfoActivityExecution","onNotifyExpandedRightSidebar","$content","getContent","empty","currentActivity","activities","filter","toUpperCase","idUserCreator","currentUser","idUser","userAssigned","argsTemplate","currentActivityName","name","showEditAction","tmpl","append","initilizeActionMenu","initializeTempleteAndEvents","plugins","activityEdition","initPluginPopupEdition","formEditActivity","assignee","date","duration","buttonCancel","buttonUpdate","on","onClickPopupButtonCancel","onClickPopupButtonUpdate","onDeleteDate","onTypeDuration","menu","select","onSelectMenu","removeClass","popupEditActivity","formContent","initializeAutoComplete","element","url","serviceLocator","getUrl","autocomplete","minLength","source","request","response","ajax","data","domain","userName","fullName","term","organization","pag","pagSize","orderField","success","map","users","item","label","user","value","ui","val","IdAssignee","focus","change","initializeDatePicker","datepicker","onSelect","getTime","undefined","util","dateFormatter","getDateFormatByDatePickerJqueryUI","initializeSpiner","desactivateDateByDuration","newValue","target","isNumeric","parseInt","spinner","min","max","placeHolder","spin","keyCode","fieldDurationActive","activateElement","form","currentTarget","find","length","onClickOpenPopupEdition","dialog","resizable","draggable","height","width","modal","title","maximize","open","onOpenPopupEdition","close","onClosePopupEdition","activityDate","isEmpty","estimatedFinishDate","isNaN","formatInvariant","Date","getDateFromInvariant","isMinimumDate","setUserAssignedById","removePopupWidgets","callGetDataUsers","then","responseUsers","preventDefault","next","html","remove","validateParamsOfFormEditActivity","idUserAssigned","updateActivity","progress","startDate","allowEdition","description","finishDate","items","when","editActivityPlan","done","refreshAllWidgets","showSucessMessage","onClickFavorite","favoriteOptions","hasClass","idObject","idCase","favoriteType","addFavorite","favoritesData","guidFavorite","idFavorites","addClass","delFavorite","unsub","messageValidationField","replace","toLowerCase","csvIdUsers","defer","Deferred","userIds","getUsersData","always","resolve","promise","action","widget","EXECUTING_ACTIVITY","FINISHED_ACTIVITY","datePickerRegional","plan-time-main","onNotifyLoadInfoActivitySummary","getStateActivity","time","fromDate","getFormattedDate","getFirstDate","dataProgressWidget","getDataByScenarios","unitTime","auxUnitTime","updateWidget","contentTemplate","relativeTime","getRelativeTime","now","minutes","messageDescripionDifference","keywordResource","messageTime","appendTo","$barRemainingDate","widthNumberDays","css","toString","percentBar","currentState","colorBar","getColorByCreatedAndEstimatedDate","toDate","callGetEffectiveDuration","getColorBar","getPercentBar","getKeywordResourceDescriptionBar","getUnitTime","getUTCDate","dateObj","monthNames","getMonth","formatDate","d","getEffectiveDuration","plan-progress-main","plan-progress-popup-edit","onNotifyUpdateItemFromRender","activityToShow","valuePercentBarComplete","canEdit","popupEditProgress","initPluginPopupEditProgress","formEditProgress","sliderProgress","slider","orientation","range","from","to","step","slide","onChangesliderProgress","each","vals","i","el","numericTextBoxPlugin","format","onChangeNumericTextBoxProgress","decimals","buttonChangeProgress","onShowPopupEditProgress","onClickCancel","onSubmitFormChangeProgress","updateProgressUI","listItems","activityWork","hide","show","text","newPercentProgress","templatePopupEditProgress","onOpenPopupPlan","detach","previusValueProgress","prop","project-subprocesses","project-subprocesses-tootip-custom-properties","subprocesses","plan-parent-main","getPlanParent","planParent","parent","idParent","radNumber","nameParent","displayName","idWorkflow","idWorkItem","idTask","onClickGoToParentCase","routingExecute","closest","project-dashboard-menu","contextsLeftSidebarCaseDashboard","forEach","context","updateView","showFormOverview","menuDashboard","showFormActivity","showCommentsOptionMenu","showFilesOptionMenu","showTimeLineOptionMenu","isAdhocProcess","isEnableFeature","showPlanOptionMenu","contextPlanOptionMenu","contextFormActivityOptionMenu","siblings","handlerEvents","loadContentById","$item","autoSave","document","getLevelNavigator","currentLevelNavigator","nameItemNavigator","newLevelNavigator","refreshLastItemBreadcrumb","histName","level","subMenuHandler","$comments","$files","$timeline","toggle","options","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","idWorkitem","referrer","publish","off","dashboard","contextualized","paramsGetPlan","callGetPlan","responsePlan","getPlan","status","reject","project-content-dashboard","setTimeout","window","trigger","serviceOrderActivitiesByTransitions","PENDING_PLAN","EXECUTING_PLAN","CONTEXT_PLANACTIVITIES","CONTEXT_PLANOVERVIEW","CONTEXT_PLANCREATE","fromIndexEnabledSortingActivities","idActivityEditing","_statePlan","userPictures","refresh","plan-activities-main","plan-activities-item","onNotifySummaryProgressPlan","onNotifyUpdatePlan","renderWidgetByStatePlan","refreshActivityRow","collapseSidebars","state","isEnableEventsOnActivitiesByCurrentContext","enableEventsOnActivitiesByCurrentContext","auxCountActivitiesFinished","statePlan","statePendingPlan","stateExecutingPlan","contextPlanActivities","showFormAddActivityByNotFinishedAllActivities","currentUserGuid","userGuid","sortablelist","initializeSortableList","addEventHandlers","setContentWrapper","onClickEditActivity","onClickDeleteActivity","onClickWorkonItActivity","onClickChangeParallel","onExecutePlan","onClosePlan","renderActivities","updateTransitions","getCopyObjectPlan","dueDate","waitForCompletion","parentWorkItem","creationDate","currentContext","kendoSortable","hint","$clone","clone","onChangePosition","disabled","end","e","newIndex","oldIndex","movePositionActivity","$liActivityGoDown","eq","canChangeToParallelActivity","parallel","transitions","getActualTransitions","changeTransitions","responseText","xhr","showErrorMessage","orderActivitiesByTransitions","getActivitiesByTransitions","auxOrderTransitions","getActualTransitionsByActivities","transition","onCreateActivity","guidActivity","paramsDetailActivity","idActivity","getActivity","createPlanActivity","reset","responseActivity","activityNew","numTotalItems","numResolvedItems","push","$activityList","activityParallel","$wrapperArrow","$liActivitySelected","changeActivityProperties","result","idLastParallelActivity","getLastParallelActivityIsRunningOrClose","prev","$target","isEditableFormActivity","workItemState","idActivityToShow","activityGuid","activityPropertiesToUpdate","iActivity","lengthActivities","$list","$element","arrayActivities","currentUserId","classEnabledActionActivities","isRunning","runningActivity","decodeHtmlEntities","loadAndShowImagesUsers","listActivities","csvguidUsers","a","seen","out","len","j","removeDuplicateItemsFromArray","join","getDataUsers","renderUserProfilesAndImages","iUser","getInitials","picture","attr","usersGuids","array","splice","arrayUnique","onCancelActivityForm","closeSidebar","$contentWrapper","stopPropagation","showConfirmationBox","deleteActivityPlan","putExecutePlan","sendNotification","planChild","callUpdatePlan","getCaseByPlan","printf","activitiesAreCompleted","closePlan","callClosePlan","fail","updatePlan","lastIndexParallelInExecution","parallelActivitiesInRunning","$selectedActivity","activityEdited","services","preferences","getPreferences","getPreference","supportNav","project-plan-sidebar","areTemplatedLoaded","projectDashboard","planTemplateCreate","planPopupEdit","CLOSED_PLAN","CONTEXT_ACTIVITYPLAN","CONTEXT_ACTIVITYPLANOVERVIEW","CONTEXT_ACTIVITYPLANCREATE","showActionsPlan","plan-action-main","stateClosedPlan","currentStatePlan","$contentWidget","onNotifyLoadInfoSummaryPlan","clearAlertsOnFocus","setNamePlan","setStatePlan","namePlan","onClickMenuOpenEdition","onClickMenuDeletePlan","onClickMenuSaveAsTemplate","planSelected","showPopup","showPopupAddTemplatePlan","callDeletePlan","getParamsByBackFromPlan","typeContext","paramsNotify","onSubmitFormPlan","focusout","deletePlan","plan-state-main","renderWidget","calculateProgress","completedActivities","totalActivities","percentProgress","Math","round","planDatesToStamp","closedDate","getClosedDatePlan","getIntervalOnMinutes","minutesToShowTime","messageUnitTimeCalculated","keywordResourceDescriptionDifference","getKeywordDifferenceDates","valueOfTimeCalculated","auxToDate","getSecondDate","auxPercentBar","getWidthBar","auxColorBar","getColorBarByPercent","getLastActivity","JSON","parse","stringify","sort","activityA","activityB","getDifferenceBetweenDates","firstDate","secondDate","difference","minutesNowToDueDate","minutesCreateToNow","minutesDueDateToCreate","minutesCreateToDueDate","minutesStartToNow","minutesDueDateToNow","minutesStartToDueDate","milliseconds","intervalMinutes","differenceStartDateToCurrentDate","totalInterval","valuePercentInterval","ceil","differenceStartDateToClosedDate","percent","processName","process","planName","goToParentCase","msg","usersMap","usersInformation","globalHandlersService","get","usersAssignees","plan-users-main","auxNoRepeatTypesUser","hashTypesUser","assigned","owner","cvsGuidUsers","activitiesUsers","ownerUserGuid","ownerUserId","userType","guid","index","userId","userAssignedGuid","inArray","guidUser","justAssignees","initilizeTooltip","addEventHandlersModal","showCreatorInformation","allUsers","usersAssignee","indexOf","isOwner","isAssignee","usersAdapter","createJsonUserInfo","userCreator","userInfo","username","email","userinformation","obj","$li","console","log","getUsersAssignees","activityRuning","res_user","getUserAssignee","tasks","types","actUser","not","ev","id_userSelected","task","userParam","usertooltip","click","widgetName","BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL","closeVisible","modalParameters","refreshInbox"],"mappings":"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","sourcesContent":["/*\r\n *   Name: Bizagi Workportal Project Activity Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activity.sidebar\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, serviceloadDataPlan, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.serviceloadDataPlan = serviceloadDataPlan;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-plan-activity-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.sidebar\").concat(\"#project-plan-activity-sidebar\")\r\n      });\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-plan-activity-sidebar\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_PLAN\", $.proxy(self.onNotifyLoadInfoPlan, self));\r\n   },\r\n\r\n    onNotifyLoadInfoPlan: function (event, parans) {\r\n        var self = this;\r\n        if (self.params.plan.idActivitySelected) {\r\n\r\n            var params = {idPlan: self.params.plan.id};\r\n            self.serviceloadDataPlan.loadData(params, self.getDateServer, self.params);\r\n            self.serviceloadDataPlan.subscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n            self.serviceloadDataPlan.subscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n        }\r\n        else {\r\n            if (self.params.showContextByMenuDashboard === \"ACTIVITYPLANPROCESSMAP\" ||\r\n                    self.params.showContextByMenuDashboard === \"ACTIVITYPLANLOG\") {\r\n                self.pub(\"notify\", {\r\n                    type: \"DISABLED_RIGHT_SIDEBAR\"\r\n                });\r\n            }\r\n        }\r\n    },\r\n\r\n    loadedWithDataActivities: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOADED_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PROGRESS_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_ACTIVITY_SUMMARY\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    loadedWithDataFirstParent: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    clean: function(){\r\n        var self = this;\r\n        if(self.serviceloadDataPlan){\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n        }\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.sidebar\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.loadDataPlan\", bizagi.workportal.widgets.project.plan.activity.sidebar], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Action\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activity.action\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, notifier, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.dateFormat = bizagi.localization.getResource(\"dateFormat\");\r\n      self.timeFormat = bizagi.localization.getResource(\"timeFormat\");\r\n      self.estimatedFinishDateTime; //Save complete date and time, because datepicker dont save time\r\n\r\n      self.beforeUserAssignedActivity = \"\";\r\n       self.notifier = notifier;\r\n\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"activity-action-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.action\").concat(\"#project-plan-activity-action\"),\r\n         \"activity-action-editionpopup\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.action\").concat(\"#project-plan-activity-action-editionpopup\")\r\n      });\r\n\r\n      self.dialogBox = {};\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @returns {*|jQuery|HTMLElement}\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.sub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      var $content = self.getContent().empty();\r\n\r\n      var currentActivity = {};\r\n      if(self.params.plan.idActivitySelected){\r\n         currentActivity = self.params.plan.activities.filter(function(activity){\r\n            return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n         })[0];\r\n      }\r\n\r\n      if(self.params.plan.idUserCreator === bizagi.currentUser.idUser || currentActivity.userAssigned == bizagi.currentUser.idUser){\r\n\r\n         var argsTemplate = {};\r\n         argsTemplate.currentActivityName = currentActivity.name;\r\n         argsTemplate.showEditAction = true;\r\n         if(self.params.plan.idUserCreator !== bizagi.currentUser.idUser){\r\n             argsTemplate.showEditAction = false;\r\n         }\r\n\r\n         var tmpl = self.getTemplate(\"activity-action-main\");\r\n         $content.append(tmpl.render(argsTemplate));\r\n\r\n         if(argsTemplate.showEditAction){\r\n             self.initilizeActionMenu();\r\n             self.beforeUserAssignedActivity = currentActivity.userAssigned;\r\n             self.content.append($content);\r\n            self.initializeTempleteAndEvents();\r\n         }\r\n      }\r\n   },\r\n\r\n   initializeTempleteAndEvents: function (){\r\n        var self = this;\r\n        self.plugins = {}; \r\n        self.plugins.activityEdition = self.initPluginPopupEdition();\r\n\r\n        self.formEditActivity = {\r\n            assignee: $(\"#activity-form-assignee\", self.plugins.activityEdition),\r\n            date: $(\"#activity-form-date\", self.plugins.activityEdition),\r\n            duration:  $(\"#activity-form-duration\",self.plugins.activityEdition),\r\n            buttonCancel: $(\"#ui-bizagi-wp-project-popupform-action-cancel\", self.plugins.activityEdition),\r\n            buttonUpdate: $(\"#ui-bizagi-wp-project-popupform-action-update\", self.plugins.activityEdition)\r\n        };\r\n\r\n        self.formEditActivity.buttonCancel.on(\"click\", $.proxy(self.onClickPopupButtonCancel, self));\r\n        self.formEditActivity.buttonUpdate.on(\"click\", $.proxy(self.onClickPopupButtonUpdate, self));\r\n\r\n        self.formEditActivity.date.on(\"keydown\", $.proxy(self.onDeleteDate, self));\r\n        self.formEditActivity.duration.on(\"keyup\", $.proxy(self.onTypeDuration, self));\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   onNotifyExpandedRightSidebar: function(){\r\n      var self = this;\r\n      self.initilizeActionMenu();\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   initilizeActionMenu: function () {\r\n      var self = this;\r\n      $(\"#ui-bizagi-wp-project-plan-activity-action .menu\", self.content).menu({\r\n         select: $.proxy(self.onSelectMenu, self)\r\n      }).removeClass(\"ui-widget-content\");\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @returns dialogBox.formContent\r\n    */\r\n   initPluginPopupEdition: function () {\r\n      var self = this;\r\n      var popupEditActivity = self.getTemplate(\"activity-action-editionpopup\");\r\n      self.dialogBox.formContent = popupEditActivity.render({});\r\n      return self.dialogBox.formContent;\r\n\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeAutoComplete: function (element) {\r\n        var self = this;\r\n        var url = self.dataService.serviceLocator.getUrl(\"admin-getUsersList\");\r\n\r\n        element.autocomplete({\r\n            minLength: 2,\r\n            source: function (request, response) {\r\n                $.ajax({\r\n                    url: url,\r\n                    data: {\r\n                        domain: \"\",\r\n                        userName: \"\",\r\n                        fullName: request.term,\r\n                        organization: \"\",\r\n                        pag: 1,\r\n                        pagSize: 100,\r\n                        orderField: \"fullName\"\r\n                    },\r\n                    success: function (data) {\r\n                        response($.map(data.users, function (item) {\r\n                            return {\r\n                                label: item.user,\r\n                                value: item.idUser\r\n                            };\r\n                        }));\r\n                    }\r\n                });\r\n            },\r\n            select: function (event, ui) {\r\n                var name = ui.item.label;\r\n                element.val(name);\r\n                self.formEditActivity.IdAssignee = ui.item.value;\r\n                return false;\r\n            },\r\n            focus: function () {\r\n                return false;\r\n            },\r\n            change: function (event, ui){\r\n                if(ui.item === null){\r\n                    self.formEditActivity.IdAssignee = null;\r\n                    self.formEditActivity.assignee.val(\"\");\r\n                }\r\n                return false;\r\n            }\r\n\r\n        });\r\n\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeDatePicker: function (element) {\r\n        var self = this;\r\n        element.datepicker({\r\n            onSelect: function () {\r\n                self.formEditActivity.duration.val(\"\");\r\n                self.estimatedFinishDateTime = self.formEditActivity.date.datepicker(\"getDate\") ? self.formEditActivity.date.datepicker(\"getDate\").getTime() : undefined;\r\n            }\r\n        });\r\n        element.datepicker(\"option\", \"dateFormat\", bizagi.util.dateFormatter.getDateFormatByDatePickerJqueryUI());\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param element\r\n    */\r\n    initializeSpiner: function (element) {\r\n        var self = this;\r\n        function desactivateDateByDuration(event, newValue){\r\n            var value = newValue || $(event.target).val();\r\n            if (bizagi.util.isNumeric(value) && parseInt(value, 10) > 0) {\r\n               self.formEditActivity.date.val(\"\");\r\n               self.estimatedFinishDateTime = undefined;\r\n            } else {\r\n               $(event.target).val(\"\");\r\n            }\r\n        }\r\n\r\n        element.spinner({\r\n            min: 1,\r\n            max: 1000,\r\n            placeHolder: bizagi.localization.getResource(\"workportal-hours\"),\r\n            change: function (event) {\r\n                desactivateDateByDuration(event);\r\n            },\r\n            spin: function( event, ui ) {\r\n                desactivateDateByDuration(event, ui.value);\r\n            }\r\n        });\r\n    },\r\n\r\n   /***\r\n    * Events\r\n    * @param event\r\n    */\r\n\r\n   onDeleteDate: function (event) {\r\n      var self = this;\r\n      if (event.keyCode === 8) {\r\n          $(event.target).val(\"\");\r\n          self.fieldDurationActive(true);\r\n      }\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param event\r\n    */\r\n   onTypeDuration: function (event) {\r\n      var self = this;\r\n      var $target = $(event.target);\r\n      if ($target.val() !== \"\") {\r\n          self.estimatedFinishDateTime = undefined;\r\n      } else {\r\n          self.activateElement(self.form.date);\r\n      }\r\n   },\r\n\r\n    /**\r\n     * When select menu\r\n     * @param event\r\n     * @param ui\r\n     */\r\n   onSelectMenu: function (event, ui) {\r\n      var self = this;\r\n      if($(event.currentTarget).find(\"i\").length === 0){\r\n         var item = $(ui.item).data(\"item\");\r\n         switch (item) {\r\n            case \"edit\":\r\n               self.onClickOpenPopupEdition();\r\n               break;\r\n         }\r\n      }\r\n   },\r\n\r\n   /**\r\n    *\r\n    */\r\n   onClickOpenPopupEdition: function () {\r\n        var self = this;\r\n        self.initializeTempleteAndEvents();\r\n        self.dialogBox.formContent.dialog({\r\n            resizable: false,\r\n            draggable: false,\r\n            height: \"auto\",\r\n            width: \"600px\",\r\n            modal: true,\r\n            title: bizagi.localization.getResource(\"workportal-project-plan-title-activity-properties\"),\r\n            maximize: true,\r\n            open: $.proxy(self.onOpenPopupEdition, self),\r\n            close: $.proxy(self.onClosePopupEdition, self)\r\n        });\r\n   },\r\n\r\n    /**\r\n    *\r\n    */\r\n    onOpenPopupEdition: function () {\r\n        var self = this;\r\n        var currentActivity = self.params.plan.activities.filter(function(activity){\r\n            return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n        })[0];\r\n\r\n        var activityDate =  (currentActivity && !bizagi.util.isEmpty(currentActivity.estimatedFinishDate)) ? currentActivity.estimatedFinishDate: \"\";\r\n        if(!isNaN(activityDate)){\r\n            activityDate=bizagi.util.dateFormatter.formatInvariant(new Date(activityDate));\r\n        }\r\n        var estimatedFinishDate = activityDate ? bizagi.util.dateFormatter.getDateFromInvariant(activityDate): \"\";\r\n        var isMinimumDate = estimatedFinishDate instanceof Date ? estimatedFinishDate.getTime() < self.getDateServer() : false;\r\n\r\n        self.initializeAutoComplete(self.formEditActivity.assignee);\r\n        self.initializeDatePicker(self.formEditActivity.date);\r\n        self.initializeSpiner(self.formEditActivity.duration);\r\n\r\n        if (currentActivity.userAssigned) {\r\n            self.setUserAssignedById(currentActivity.userAssigned);\r\n        }\r\n\r\n        self.formEditActivity.date.datepicker(\"option\", \"minDate\", new Date(self.getDateServer()));\r\n\r\n        if (currentActivity.estimatedFinishDate && isMinimumDate) {\r\n            self.formEditActivity.date.datepicker(\"option\", \"minDate\", estimatedFinishDate);//set minimum because, if date is past\r\n        }\r\n\r\n        if (currentActivity.estimatedFinishDate) {\r\n            if (estimatedFinishDate){\r\n                self.formEditActivity.date.datepicker(\"setDate\", estimatedFinishDate);\r\n            }\r\n            self.estimatedFinishDateTime = currentActivity.estimatedFinishDate;\r\n        }\r\n\r\n        if (currentActivity.duration) {\r\n            self.formEditActivity.duration.val(parseInt(currentActivity.duration, 10));\r\n        }\r\n   },\r\n\r\n   /**\r\n    * When close popup edition\r\n    */\r\n   onClosePopupEdition: function(){\r\n      var self = this;\r\n      self.removePopupWidgets();\r\n   },\r\n\r\n   /**\r\n    *\r\n    * @param idUser\r\n    */\r\n    setUserAssignedById: function (idUser) {\r\n        var self = this;\r\n        //Show images users\r\n        self.callGetDataUsers(idUser).then(function (responseUsers) {\r\n            self.formEditActivity.assignee.val(responseUsers[0].name);\r\n        });\r\n        self.formEditActivity.IdAssignee = idUser;\r\n    },\r\n\r\n   /**\r\n    *\r\n    * @param event\r\n    */\r\n    onClickPopupButtonCancel: function(event){\r\n        var self = this;\r\n        event.preventDefault();\r\n        self.removePopupWidgets();\r\n    },\r\n\r\n    /**\r\n    * Remove popup widgets\r\n    */\r\n    removePopupWidgets: function(){\r\n        var self = this;\r\n        self.formEditActivity.assignee.next().find(\"span\").html(\"\");\r\n        self.dialogBox.formContent.remove();\r\n        $(\"#ui-datepicker-div\").remove();\r\n    },\r\n\r\n   /**\r\n    *  Triggered when click update plan activity\r\n    */\r\n    onClickPopupButtonUpdate: function () {\r\n        var self = this;\r\n        if(self.validateParamsOfFormEditActivity()){\r\n            var currentActivity = self.params.plan.activities.filter(function (activity) {\r\n                return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n            })[0];\r\n            var idUserAssigned =  self.formEditActivity.IdAssignee || bizagi.currentUser.idUser;\r\n            if(self.formEditActivity.duration.val()!=\"\"){\r\n                self.params.plan.activities.filter(function (activity) {\r\n                    return activity.id.toUpperCase() === self.params.plan.idActivitySelected.toUpperCase();\r\n                })[0].estimatedFinishDate=\"\";\r\n            }\r\n            var updateActivity = {\r\n                progress: currentActivity.progress,\r\n                id: currentActivity.id,\r\n                startDate: currentActivity.startDate,\r\n                duration: self.formEditActivity.duration.val(),\r\n                userAssigned: idUserAssigned,\r\n                allowEdition: currentActivity.allowEdition,\r\n                description: currentActivity.description,\r\n                name: currentActivity.name,\r\n                idPlan: currentActivity.idPlan,\r\n                estimatedFinishDate: self.estimatedFinishDateTime,\r\n                finishDate: currentActivity.finishDate,\r\n                items: currentActivity.items\r\n            };\r\n            $.when(self.dataService.editActivityPlan(updateActivity)).done(function () {\r\n                currentActivity = $.extend(currentActivity, updateActivity);\r\n                self.removePopupWidgets();\r\n\r\n                if (self.beforeUserAssignedActivity !== self.formEditActivity.IdAssignee) {\r\n                    self.pub(\"notify\", {\r\n                        type: \"ACTIVITYPLANCOMMENTS\",\r\n                        args: $.extend(self.params, {refreshAllWidgets: true})\r\n                    });\r\n                }\r\n                else {\r\n                    self.pub(\"notify\", {\r\n                        type: self.params.showContextByMenuDashboard,\r\n                        args: self.params\r\n                    });\r\n                }\r\n\r\n                self.removePopupWidgets();\r\n                self.notifier.showSucessMessage(bizagi.localization.getResource(\"workportal-project-plan-activity-update-message\"));\r\n            });\r\n        }\r\n    },\r\n\r\n   /***\r\n    * Events\r\n    */\r\n   onClickFavorite: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n      var favoriteOptions = {};\r\n      if ($(event.target).hasClass(\"bz-icon-star-outline\")) {\r\n         favoriteOptions = {\r\n            idObject: self.params.idCase,\r\n            favoriteType: \"CASES\"\r\n         };\r\n         $.when(self.dataService.addFavorite(favoriteOptions)).done(function (favoritesData) {\r\n            self.params.guidFavorite = favoritesData.idFavorites;\r\n            $(event.target).removeClass(\"bz-icon-star-outline\");\r\n            $(event.target).addClass(\"bz-icon-star\");\r\n         });\r\n      }\r\n      else {\r\n         favoriteOptions = {\r\n            idObject: self.params.guidFavorite,\r\n            favoriteType: \"CASES\"\r\n         };\r\n         $.when(self.dataService.delFavorite(favoriteOptions)).done(function () {\r\n            $(event.target).addClass(\"bz-icon-star-outline\");\r\n            $(event.target).removeClass(\"bz-icon-star\");\r\n         });\r\n      }\r\n   },\r\n\r\n   /**\r\n    * Clean events and plugins\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      self.unsub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.unsub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n   },\r\n\r\n   /**\r\n    * Validate form edit plan activity\r\n    * @returns {boolean}\r\n    */\r\n    validateParamsOfFormEditActivity: function(){\r\n        var self = this;\r\n        var userAssigned = self.formEditActivity.assignee;\r\n        if (userAssigned.val() && userAssigned.val() !== \"\" && self.formEditActivity.IdAssignee) {\r\n            return true;\r\n        } else {\r\n            var messageValidationField = bizagi.localization.getResource(\"workportal-general-error-field-required\");\r\n            messageValidationField = messageValidationField.replace(\"{0}\", bizagi.localization.getResource(\"workportal-project-plan-assignee\").toLowerCase());\r\n            userAssigned.next().find(\"span\").html(messageValidationField);\r\n            return false;\r\n        }\r\n    },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n   callGetDataUsers: function (csvIdUsers) {\r\n      var self = this,\r\n         defer = $.Deferred();\r\n      var params = {\r\n         userIds: csvIdUsers,\r\n         width: 50,\r\n         height: 50\r\n      };\r\n\r\n      self.dataService.getUsersData(params).always(function (response) {\r\n         defer.resolve(response);\r\n      });\r\n      return defer.promise();\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.action\", [\"workportalFacade\", \"dataService\", \"notifier\", bizagi.workportal.widgets.project.plan.activity.action]);\r\n","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Time\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n/***\r\n * TODO IMPORTANT: This widget is development with TDD, test this file when changes\r\n */\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.time\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    *\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Constants\r\n      self.EXECUTING_ACTIVITY = \"EXECUTING\";\r\n      self.FINISHED_ACTIVITY = \"FINISHED\";\r\n\r\n      //Regional\r\n      self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-time-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.time\").concat(\"#project-plan-activity-time\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivitySummary, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivitySummary: function(event, params){\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.getContent().empty();\r\n\r\n      var currentActivity = self.params.plan.activities.filter(function (activity) {\r\n         return activity.id === self.params.plan.idActivitySelected;\r\n      })[0];\r\n\r\n      if(currentActivity.startDate){\r\n         self.getStateActivity(currentActivity);\r\n\r\n         var argsTemplate = {\r\n            time: {\r\n               fromDate: self.getFormattedDate(new Date(self.getFirstDate(currentActivity)))\r\n            }\r\n         };\r\n         var dataProgressWidget = self.getDataByScenarios(currentActivity, true);\r\n\r\n         $.when(dataProgressWidget.unitTime).done(function(auxUnitTime){\r\n            dataProgressWidget = $.extend(dataProgressWidget, {\r\n               unitTime: auxUnitTime\r\n            });\r\n            self.updateWidget($.extend(argsTemplate.time, dataProgressWidget));\r\n         });\r\n\r\n      }\r\n   },\r\n   updateWidget: function(argsTemplate){\r\n      var self = this;\r\n      var $content = self.getContent().empty();\r\n      var contentTemplate = self.getTemplate(\"plan-time-main\");\r\n\r\n      var relativeTime = bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - (argsTemplate.unitTime.minutes * 60 * 1000)), null, false);\r\n\r\n      var messageDescripionDifference = bizagi.localization.getResource(\"workportal-project-activity-state-\" + argsTemplate.keywordResource);\r\n      argsTemplate.messageTime = messageDescripionDifference.replace(\"%s\", relativeTime);\r\n\r\n      contentTemplate\r\n         .render(argsTemplate)\r\n         .appendTo($content);\r\n\r\n      //Begin Adjust status bar next to the number days\r\n      var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\r\n      var widthNumberDays = $(\".remaining-days .days\", $content).width();\r\n      $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\r\n\r\n      var $barCompletedDate = $(\".remaining-days .bar-completed\", $content);\r\n\r\n      $barCompletedDate.css(\"width\", argsTemplate.percentBar + \"%\");\r\n      //End Adjust status bar next to the number days\r\n\r\n   },\r\n   getStateActivity: function(activity){\r\n      var self = this;\r\n      if(activity.finishDate){\r\n         activity.currentState = self.FINISHED_ACTIVITY;\r\n         return self.FINISHED_ACTIVITY;\r\n      }\r\n      else{\r\n         activity.currentState = self.EXECUTING_ACTIVITY;\r\n         return self.EXECUTING_ACTIVITY;\r\n      }\r\n   },\r\n   getFirstDate: function(activity){\r\n      var self = this;\r\n      if(activity.currentState === self.EXECUTING_ACTIVITY){\r\n         return activity.startDate;\r\n      } else{\r\n         return activity.finishDate;\r\n      }\r\n   },\r\n   getDataByScenarios: function(activity){\r\n      var self = this;\r\n      var response = {\r\n         colorBar: null,\r\n         percentBar: 100,\r\n         keywordResource: null,\r\n         unitTime: null\r\n      };\r\n      var params = {};\r\n      switch(activity.currentState){\r\n         case self.EXECUTING_ACTIVITY:\r\n            response.keywordResource = \"opened\";\r\n            response.colorBar = self.getColorByCreatedAndEstimatedDate(activity);\r\n\r\n            params = {\r\n               idUser: bizagi.currentUser.idUser,\r\n               fromDate: activity.startDate,\r\n               toDate: Date.now()\r\n            };\r\n            response.unitTime = self.callGetEffectiveDuration(params);\r\n\r\n            break;\r\n         case self.FINISHED_ACTIVITY:\r\n            response.colorBar = \"Gray\";\r\n            response.keywordResource = \"closed\";\r\n            params = {\r\n               idUser: bizagi.currentUser.idUser,\r\n               fromDate: activity.finishDate,\r\n               toDate: Date.now()\r\n            };\r\n            response.unitTime = self.callGetEffectiveDuration(params);\r\n            break;\r\n      }\r\n      return response;\r\n   },\r\n\r\n   getColorBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).colorBar;\r\n   },\r\n   getPercentBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).percentBar;\r\n   },\r\n   getKeywordResourceDescriptionBar: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).keywordResource;\r\n   },\r\n   getUnitTime: function(activity){\r\n      var self = this;\r\n      return self.getDataByScenarios(activity).unitTime;\r\n   },\r\n\r\n   getColorByCreatedAndEstimatedDate: function(activity){\r\n      var self = this;\r\n      var response = \"Red\";\r\n      if(activity.estimatedFinishDate) {\r\n         if (Date.now() < activity.estimatedFinishDate) {\r\n            var theSameDay = (new Date()).getUTCDate() === (new Date(activity.estimatedFinishDate)).getUTCDate();\r\n            if(theSameDay){\r\n               response = \"Yellow\";\r\n            }\r\n            else{\r\n               response = \"Green\";\r\n            }\r\n         }\r\n      }\r\n      return response;\r\n   },\r\n\r\n   getFormattedDate: function (dateObj) {\r\n      var self = this;\r\n      var monthsNames = self.datePickerRegional.monthNames;\r\n      var shortMonth = dateObj.getMonth();\r\n\r\n      return monthsNames[shortMonth] + \" \" + bizagi.util.dateFormatter.formatDate(dateObj, \"dd hh:mm tt\", bizagi.localization.getResource(\"datePickerRegional\"));\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n   callGetEffectiveDuration: function(params){\r\n      var self = this;\r\n      var d = $.Deferred();\r\n      $.when(\r\n         self.dataService.getEffectiveDuration(params)\r\n      ).done(function (data) {\r\n            d.resolve(data);\r\n         });\r\n      return d.promise();\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.time\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.time], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Progress\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.progress\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.plugins = {};\r\n      self.dialogBox = {};\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-progress-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.progress\").concat(\"#project-plan-activity-progress\"),\r\n         \"plan-progress-popup-edit\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.progress\").concat(\"#project-plan-activity-edit-progress\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n      self.sub(\"UPDATE_ITEMS_FROM_FORMRENDER\", $.proxy(self.onNotifyUpdateItemFromRender, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      var $content = self.getContent().empty();\r\n\r\n      var activityToShow = self.params.plan.activities.filter(function(activity){\r\n         return activity.id.toUpperCase() == self.params.plan.idActivitySelected.toUpperCase();\r\n      })[0];\r\n\r\n      var argsTemplate = {};\r\n      argsTemplate.valuePercentBarComplete = 0;\r\n      argsTemplate.progress = {\r\n         progress: activityToShow.progress,\r\n         canEdit: (activityToShow.items.length === 0)\r\n      };\r\n\r\n      if(argsTemplate.progress.progress){\r\n         argsTemplate.valuePercentBarComplete = argsTemplate.progress.progress;\r\n      }\r\n\r\n      //Update widget\r\n      var templateMain = self.getTemplate(\"plan-progress-main\");\r\n      templateMain.render(argsTemplate).appendTo($content);\r\n\r\n      self.plugins.popupEditProgress = self.initPluginPopupEditProgress();\r\n\r\n      var popupEditProgress = self.plugins.popupEditProgress;\r\n\r\n      self.formEditProgress = {\r\n         sliderProgress: $(\"#sliderProgress\", popupEditProgress).slider({\r\n            orientation: \"horizontal\",\r\n            range: \"min\",\r\n            max: 100,\r\n            width: 100,\r\n            from: 5,\r\n            to: 50,\r\n            step: 1,\r\n            value: argsTemplate.valuePercentBarComplete,\r\n            slide: $.proxy(self.onChangesliderProgress, self),\r\n            change: $.proxy(self.onChangesliderProgress, self)\r\n         }).each(function () {\r\n            var vals = $(this).slider(\"option\", \"max\") - $(this).slider(\"option\", \"min\");\r\n            for (var i = 0; i <= vals; i += 10) {\r\n               var el = $(\"<label class='step'>\" + (i) + \"</label>\").css(\"left\", (i / vals * 100) + \"%\");\r\n               $(this).append(el);\r\n            }\r\n         }),\r\n         numericTextBoxPlugin: $(\"#inputProgressNumericTextBox\", popupEditProgress).spinner({\r\n            format: \"n0\",\r\n            min: 0,\r\n            max: 100,\r\n            spin: $.proxy(self.onChangeNumericTextBoxProgress, self),\r\n            change: $.proxy(self.onChangeNumericTextBoxProgress, self),\r\n            value: argsTemplate.valuePercentBarComplete,\r\n            decimals: 0\r\n         }),\r\n         buttonChangeProgress: $(\"#button-accept-change-progress\", popupEditProgress),\r\n         buttonCancel: $(\"#button-cancel-change-progress\", popupEditProgress)\r\n      };\r\n\r\n      //Handlers\r\n      $(\".action-open-popup-edit-progress\", $content).on(\"click\", $.proxy(self.onShowPopupEditProgress, self));\r\n\r\n      self.formEditProgress.buttonCancel.on(\"click\", $.proxy(self.onClickCancel, self));\r\n      self.formEditProgress.buttonChangeProgress.on(\"click\", $.proxy(self.onSubmitFormChangeProgress, self));\r\n\r\n      self.updateProgressUI(argsTemplate.valuePercentBarComplete);\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", argsTemplate.valuePercentBarComplete);\r\n\r\n   },\r\n\r\n   onNotifyUpdateItemFromRender: function(event, params){\r\n      var self = this;\r\n      var listItems = params.args.items;\r\n      var activityWork = params.args.activityWork;\r\n\r\n      var progress;      \r\n      if(listItems.length > 0){\r\n         //Hide edit progress\r\n         $(\".action-open-popup-edit-progress\", self.content).hide();\r\n      }else{\r\n         $(\".action-open-popup-edit-progress\", self.content).show();\r\n      }\r\n      //set new progress\r\n      $(\".bz-wp-timestamp span\", self.content).text(activityWork);\r\n      $(\".bz-wp-progress-bar\", self.content).css(\"width\", activityWork + \"%\");\r\n\r\n   },\r\n\r\n   updateProgressUI: function(newPercentProgress){\r\n      var self = this,\r\n         $content = self.getContent();\r\n\r\n      $(\".bz-wp-timestamp span\", $content).text(newPercentProgress);\r\n\r\n      //Begin Adjust status bar next to the number days\r\n      var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\r\n      var widthNumberDays = $(\".remaining-days .days\", $content).width();\r\n      $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\r\n\r\n      var $barCompletedDate = $(\".remaining-days .bar-completed\", $content);\r\n\r\n      $barCompletedDate.css(\"width\", newPercentProgress.toString() + \"%\");\r\n      //End Adjust status bar next to the number days\r\n   },\r\n\r\n   initPluginPopupEditProgress: function () {\r\n      var self = this;\r\n      var templatePopupEditProgress = self.getTemplate(\"plan-progress-popup-edit\");\r\n      self.dialogBox.formContent = templatePopupEditProgress.render();\r\n      return self.dialogBox.formContent;\r\n\r\n   },\r\n   /*\r\n    * UI\r\n    */\r\n\r\n   onShowPopupEditProgress: function(){\r\n      var self = this;\r\n\r\n      self.dialogBox.formContent.dialog({\r\n         resizable: false,\r\n         draggable: false,\r\n         height: \"auto\",\r\n         width: \"600px\",\r\n         modal: true,\r\n         title: bizagi.localization.getResource(\"workportal-project-plan-progress-title\"),\r\n         maximize: true,\r\n         open:  $.proxy(self.onOpenPopupPlan, self),\r\n         close: function () {\r\n            self.dialogBox.formContent.dialog(\"destroy\");\r\n            self.dialogBox.formContent.detach();\r\n         }\r\n      });\r\n\r\n      self.previusValueProgress = self.formEditProgress.sliderProgress.slider(\"value\");\r\n\r\n   },\r\n\r\n   onChangeNumericTextBoxProgress: function (event) {\r\n      var self = this;\r\n      var newValue = self.formEditProgress.numericTextBoxPlugin.spinner(\"value\");\r\n      self.formEditProgress.sliderProgress.slider(\"value\", newValue);\r\n   },\r\n\r\n   onChangesliderProgress: function (event) {\r\n      var self = this;\r\n      var newValue = self.formEditProgress.sliderProgress.slider(\"value\");\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", newValue);\r\n   },\r\n\r\n   onClickCancel: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n\r\n      self.dialogBox.formContent.dialog(\"destroy\");\r\n      self.dialogBox.formContent.detach();\r\n      //return before value progress\r\n      self.formEditProgress.sliderProgress.slider(\"value\", self.previusValueProgress);\r\n      self.formEditProgress.numericTextBoxPlugin.spinner(\"value\", self.previusValueProgress);\r\n   },\r\n\r\n   onSubmitFormChangeProgress: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n\r\n      self.formEditProgress.buttonChangeProgress.prop(\"disabled\", true);\r\n\r\n      var activityToShow = self.params.plan.activities.filter(function(activity){\r\n         return activity.id == self.params.plan.idActivitySelected;\r\n      })[0];\r\n       var params = $.extend(activityToShow, {\r\n           progress:  self.formEditProgress.numericTextBoxPlugin.spinner(\"value\"),\r\n           idPlan: self.params.plan.id\r\n       });\r\n      $.when(self.dataService.editActivityPlan(params)).done(function () {\r\n         self.formEditProgress.buttonChangeProgress.prop(\"disabled\", false);\r\n         activityToShow.progress = self.formEditProgress.numericTextBoxPlugin.spinner(\"value\");\r\n         self.updateProgressUI(activityToShow.progress);\r\n          self.dialogBox.formContent.dialog(\"destroy\");\r\n          self.dialogBox.formContent.detach();\r\n      });\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.progress\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.progress], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Subprocesses Controller\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.subprocesses\", {}, {\r\n      /*\r\n       *   Constructor\r\n       */\r\n      init: function (workportalFacade, dataService, params) {\r\n         var self = this;\r\n\r\n         // Call base\r\n         self._super(workportalFacade, dataService, params);\r\n\r\n         //Load templates\r\n         self.loadTemplates({\r\n            \"project-subprocesses\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.subprocesses\").concat(\"#project-plan-activity-plan-subprocesses-wrapper\"),\r\n            \"project-subprocesses-tootip-custom-properties\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.subprocesses\").concat(\"#project-activity-plan-subprocesses-tooltip-custom-properties-wrapper\")\r\n         });\r\n      },\r\n\r\n      /*\r\n       * Renders the template defined in the widget\r\n       */\r\n      renderContent: function () {\r\n         var self = this;\r\n         self.content = $(\"<div></div>\");\r\n         return self.content;\r\n      },\r\n\r\n      /*\r\n       * links events with handlers\r\n       */\r\n      postRender: function () {\r\n         var self = this;\r\n      }\r\n   }\r\n);\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.subprocesses\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.subprocesses]);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Activity Parent\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.activity.parent\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-parent-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.activity.parent\").concat(\"#project-plan-activity-parent\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_ACTIVITY_SUMMARY\", $.proxy(self.onNotifyLoadInfoActivityExecution, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoActivityExecution: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      var $content = self.getContent().empty();\r\n\r\n         $.when(self.dataService.getPlanParent({idPlan: self.params.plan.id})).done(function (planParent) {\r\n            self.params.plan.parent = planParent;\r\n            if(self.params.plan.parent){\r\n               var argsTemplate = {};\r\n               argsTemplate.parent = {\r\n                  idParent: self.params.plan.parent.radNumber,\r\n                  nameParent: self.params.plan.parent.displayName,\r\n                  idCase: self.params.plan.parent.idCase,\r\n                  idWorkflow: self.params.plan.parent.idWorkflow,\r\n                  idWorkItem: self.params.plan.parent.idWorkItem,\r\n                  idTask: self.params.plan.parent.idTask\r\n               };\r\n\r\n               //Update widget\r\n               var contentTemplate = self.getTemplate(\"plan-parent-main\");\r\n               contentTemplate\r\n                  .render(argsTemplate)\r\n                  .appendTo($content);\r\n\r\n               $(\"#go-to-parent-case\", $content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\r\n            }\r\n         });\r\n\r\n\r\n   },\r\n\r\n   onClickGoToParentCase: function (event) {\r\n      event.preventDefault();\r\n      var self = this;\r\n      self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activity.parent\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.activity.parent], true);","/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity\").concat(\"#project-dashboard-menu1\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n         self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Update view\r\n    * @param event\r\n    * @param params\r\n    */\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.params.plan.idActivitySelected = undefined;\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      if(typeof event.type !== \"undefined\"){\r\n         self.params.showContextByMenuDashboard = event.type;\r\n      }\r\n\r\n      var argsTemplate = {\r\n         showFormOverview: self.params.menuDashboard.showFormOverview,\r\n         showFormActivity: self.params.menuDashboard.showFormActivity,\r\n         showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu &&\r\n            (!self.params.isAdhocProcess ||\r\n            (self.params.isAdhocProcess && bizagi.util.isEnableFeature(\"enableTimelineOnLiveProcesses\"))),\r\n         showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\r\n         contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\r\n         contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu\r\n      };\r\n\r\n      //Update widget\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      template.render(argsTemplate).appendTo($content);\r\n\r\n      if(self.params.showContextByMenuDashboard){\r\n         $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n      }\r\n\r\n      self.handlerEvents();\r\n   },\r\n\r\n   /**\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if (!$item.hasClass(\"active\")) {\r\n\r\n         var showContextByMenuDashboard = $item.data(\"context\");\r\n\r\n         if (showContextByMenuDashboard) {\r\n            $.when(bizagi.util.autoSave()).done(function () {\r\n               $(document).data('auto-save', '');\r\n\r\n               var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\" });\r\n               var currentLevelNavigator = parseInt(getLevelNavigator[0], 10);\r\n               var nameItemNavigator = \"\";\r\n               var newLevelNavigator = currentLevelNavigator;\r\n\r\n               if(showContextByMenuDashboard == \"PLANACTIVITIES\"){\r\n                  newLevelNavigator = currentLevelNavigator + 1;\r\n                  nameItemNavigator = bizagi.localization.getResource(\"workportal-project-casedashboard-plan\");\r\n               }\r\n\r\n               self.params.refreshLastItemBreadcrumb = false;\r\n               self.pub(\"notify\", {\r\n                  type: showContextByMenuDashboard.toUpperCase(),\r\n                  args: $.extend(self.params, { showContextByMenuDashboard: showContextByMenuDashboard,\r\n                     histName: nameItemNavigator,\r\n                     level: newLevelNavigator })\r\n               });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n            });\r\n         }\r\n      }\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n       var self = this;\r\n       var content = self.getContent();\r\n       var $comments = $(\"[data-context='COMMENTS']\", content);\r\n       var $files = $(\"[data-context='FILES']\", content);\r\n       var $timeline = $(\"[data-context='TIMELINE']\", content);\r\n\r\n       $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n           $comments.toggle();\r\n           $files.toggle();\r\n           $timeline.toggle();\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Handler events\r\n    */\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      self.subMenuHandler();\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\", $.proxy(self.loadContentById, self));\r\n\r\n       // Bind for click event on refresh botton\r\n       $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).on(\"click\", function () {\r\n           var options = {\r\n               action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n               idCase: self.params.idCase,\r\n               idTask: self.params.idTask,\r\n               idWorkflow: self.params.idWorkflow,\r\n               idWorkItem: self.params.idWorkitem,\r\n               referrer: self.params.referrer || \"inboxGrid\"\r\n           };\r\n           self.publish(\"executeAction\", options);\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Clean widgets and events\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n      $(\".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form\", content).off();\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity], true);","/*\r\n *   Name: Bizagi Workportal project Dashboard Menu Activity Plan\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.dashboard.menu.activity.plan\", {}, {\r\n\r\n   /**\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n      self.params = params || {};\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-dashboard-menu\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.dashboard.menu.activity.plan\").concat(\"#project-dashboard-menu2\")\r\n      });\r\n   },\r\n\r\n   /**\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   /**\r\n    * links events with handlers\r\n    */\r\n   postRender: function () {\r\n      var self = this;\r\n      //Handlers\r\n      self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n         self.sub(context, $.proxy(self.updateView, self));\r\n      });\r\n\r\n   },\r\n\r\n   /**\r\n    * Update view\r\n    * @param event\r\n    * @param params\r\n    */\r\n   updateView: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.clean();\r\n      var $content = self.getContent().empty();\r\n\r\n      var argsTemplate = {\r\n         showFormOverview: self.params.menuDashboard.showFormOverview,\r\n         showFormActivity: self.params.menuDashboard.showFormActivity,\r\n         showCommentsOptionMenu: self.params.menuDashboard.showCommentsOptionMenu,\r\n         showFilesOptionMenu: self.params.menuDashboard.showFilesOptionMenu,\r\n         showTimeLineOptionMenu: self.params.menuDashboard.showTimeLineOptionMenu,\r\n         showPlanOptionMenu: self.params.menuDashboard.showPlanOptionMenu,\r\n         contextPlanOptionMenu: self.params.menuDashboard.contextPlanOptionMenu,\r\n         contextFormActivityOptionMenu: self.params.menuDashboard.contextFormActivityOptionMenu,\r\n         contextualized: self.params.plan.contextualized\r\n      };\r\n\r\n      //Update widget\r\n      var template = self.getTemplate(\"project-dashboard-menu\");\r\n      template.render(argsTemplate).appendTo($content);\r\n\r\n      if(self.params.showContextByMenuDashboard){\r\n         $(\"li[data-context='\" + event.type.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n      }\r\n\r\n      self.handlerEvents();\r\n\r\n      var paramsGetPlan = {idPlan: self.params.plan.id};\r\n      $.when(self.callGetPlan(paramsGetPlan)).then(function(responsePlan){\r\n         $.extend(self.params.plan, responsePlan);\r\n         self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_PLAN\",\r\n            args: self.params\r\n         });\r\n      });\r\n   },   \r\n\r\n   /**\r\n    *   Load Content By Id\r\n    */\r\n   loadContentById: function (event) {\r\n      var self = this;\r\n      event.preventDefault();\r\n      var $item = $(event.target).closest(\"li\");\r\n\r\n      if (!$item.hasClass(\"active\")) {\r\n         $.when(bizagi.util.autoSave()).done(function () {\r\n            $(document).data('auto-save', '');\r\n\r\n            var showContextByMenuDashboard = $item.data(\"context\");\r\n            if (showContextByMenuDashboard) {\r\n               var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\"});\r\n               var currentLevelNavigator = parseInt(getLevelNavigator[0]);\r\n               var nameItemNavigator = \"\";\r\n               var newLevelNavigator = currentLevelNavigator;\r\n\r\n               self.params.refreshLastItemBreadcrumb = false;\r\n               self.pub(\"notify\", {\r\n                  type: showContextByMenuDashboard.toUpperCase(),\r\n                  args: $.extend(self.params,{showContextByMenuDashboard: showContextByMenuDashboard,\r\n                     histName: nameItemNavigator,\r\n                     level: newLevelNavigator})\r\n               });\r\n               $(\"li[data-context='\" + self.params.showContextByMenuDashboard.toUpperCase() + \"']\", self.content).addClass(\"active\").siblings().removeClass(\"active\");\r\n            }\r\n         });\r\n      }\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n\r\n   callGetPlan: function(params){\r\n      var self = this;\r\n      var defer = $.Deferred();\r\n      self.dataService.getPlan(params).always(function (response) {\r\n         if (response.status === 200 || response.status === 201 || response.status === undefined) {\r\n            defer.resolve(response);\r\n         }\r\n         else {\r\n            defer.reject();\r\n         }\r\n      });\r\n\r\n      return defer.promise();\r\n   },\r\n\r\n   subMenuHandler: function () {\r\n       var self = this;\r\n       var content = self.getContent();\r\n       var $comments = $(\"[data-context='ACTIVITYPLANCOMMENTS']\", content);\r\n       var $files = $(\"[data-context='ACTIVITYPLANFILES']\", content);\r\n       var $timeline = $(\"[data-context='ACTIVITYPLANTIMELINE']\", content);\r\n\r\n       $(\".ui-bizagi-wp-project-tab-submenu a\", content).on(\"click\", function () {\r\n           $comments.toggle();\r\n           $files.toggle();\r\n           $timeline.toggle();\r\n       });\r\n   },\r\n\r\n   /**\r\n    * Handler events\r\n    */\r\n   handlerEvents: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n      self.subMenuHandler();\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).on(\"click\",  $.proxy(self.loadContentById, self));\r\n   },\r\n\r\n   /**\r\n    * Clean widgets and events\r\n    */\r\n   clean: function(){\r\n      var self = this;\r\n      var content = self.getContent();\r\n\r\n      if(self.params && self.params.contextsLeftSidebarCaseDashboard){\r\n         self.params.contextsLeftSidebarCaseDashboard.forEach(function(context){\r\n            self.unsub(context, $.proxy(self.updateView, self));\r\n         });\r\n      }\r\n\r\n      $(\".ui-bizagi-wp-project-tab-links a\", content).off();\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.dashboard.menu.activity.plan\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.dashboard.menu.activity.plan], true);","/*\r\n *   Name: Bizagi Workportal Project Content Dashboard\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.content.dashboard\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-content-dashboard\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.content.dashboard\").concat(\"#project-plan-content-dashboard\")\r\n      });\r\n\r\n   },\r\n\r\n   /*\r\n    * Renders the template defined in the widget\r\n    */\r\n   renderContent: function () {\r\n      var self = this;\r\n\r\n      var template = self.getTemplate(\"project-content-dashboard\");\r\n      self.content = template.render({});\r\n\r\n      return self.content;\r\n   },\r\n   postRender: function(){\r\n      var self = this;\r\n\r\n      setTimeout(function(){\r\n         $(window).trigger(\"resize\"); //Simulate resize for fix when load first time.\r\n      }, 1000);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.content.dashboard\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.content.dashboard], true);","/*\r\n*   Name: Bizagi Workportal Desktop Project Plan Activities\r\n*   Author: David Romero Estrada\r\n*/\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.activities\", {}, {\r\n\r\n    /*\r\n    *   Constructor\r\n    */\r\n    init: function (workportalFacade, dataService, notifier, serviceOrderActivitiesByTransitions, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n        \r\n        self.serviceOrderActivitiesByTransitions = serviceOrderActivitiesByTransitions;\r\n\r\n        // Modes widget: designed plan or execution plan\r\n        self.PENDING_PLAN = \"PENDING_PLAN\";\r\n        self.EXECUTING_PLAN = \"EXECUTING_PLAN\";\r\n        self.CONTEXT_PLANACTIVITIES = \"PLANACTIVITIES\";\r\n        self.CONTEXT_PLANOVERVIEW = \"PLANOVERVIEW\";\r\n        self.CONTEXT_PLANCREATE = \"PLANCREATE\";\r\n\r\n        self.plugins = {};\r\n        self.fromIndexEnabledSortingActivities = 0;\r\n        self.idActivityEditing = \"\";\r\n        self.plugins.notifier = notifier;\r\n\r\n        //private fields\r\n        self._statePlan = self.PENDING_PLAN;\r\n\r\n        self.userPictures = [];\r\n        self.refresh = params.refreshAllWidgets;\r\n\r\n        // Load templates\r\n        self.loadTemplates({\r\n            \"plan-activities-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.plan.activities\").concat(\"#project-plan-activities\"),\r\n            \"plan-activities-item\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.project.plan.activities\").concat(\"#project-plan-activities-item\")\r\n        });\r\n    },\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.sub(\"LOAD_INFO_SUMMARY_PROGRESS_PLAN\", $.proxy(self.onNotifySummaryProgressPlan, self));\r\n        self.sub(\"UPDATE_INFO_PLAN\", $.proxy(self.onNotifyUpdatePlan, self));\r\n        self.sub(\"UPDATE_LIST_ACTIVITIES\", $.proxy(self.renderWidgetByStatePlan, self));\r\n        self.sub(\"UPDATE_ACTIVITY_INFO\", $.proxy(self.refreshActivityRow, self));\r\n        if(!self.refresh){\r\n            self.collapseSidebars();\r\n        }\r\n    },\r\n\r\n    onNotifySummaryProgressPlan: function(event, params) {\r\n        var self = this;\r\n        self.params = $.extend(self.params, params.args);\r\n\r\n        var state = self.params.plan.currentState;\r\n        self._statePlan = state + \"_PLAN\";\r\n        \r\n        self.renderWidgetByStatePlan(event.type);\r\n        \r\n    },\r\n\r\n    renderWidgetByStatePlan: function(event){\r\n        var self = this;\r\n        self.idActivityEditing = \"\";\r\n        var $content = self.getContent().empty();\r\n\r\n        var isEnableEventsOnActivitiesByCurrentContext = self.enableEventsOnActivitiesByCurrentContext(self.params.showContextByMenuDashboard);\r\n\r\n        var auxCountActivitiesFinished = self.params.plan.activities.filter(function(activity){\r\n            return activity.finishDate;\r\n        }).length;\r\n\r\n        var argsTemplate = {\r\n            showContextByMenuDashboard: self.params.showContextByMenuDashboard,\r\n            statePlan: self._statePlan,\r\n            statePendingPlan: self.PENDING_PLAN,\r\n            stateExecutingPlan: self.EXECUTING_PLAN,\r\n            contextPlanActivities: self.CONTEXT_PLANACTIVITIES,\r\n            plan: self.params.plan,\r\n            showFormAddActivityByNotFinishedAllActivities: (auxCountActivitiesFinished !== self.params.plan.activities.length),\r\n            currentUserGuid: bizagi.currentUser.userGuid\r\n        };\r\n\r\n        var contentTemplate = self.getTemplate(\"plan-activities-main\");\r\n        contentTemplate\r\n           .render($.extend(self.params, argsTemplate))\r\n           .appendTo($content);\r\n           \r\n        if((self._statePlan === self.PENDING_PLAN || self._statePlan === self.EXECUTING_PLAN) && isEnableEventsOnActivitiesByCurrentContext){\r\n            self.plugins.sortablelist = self.initializeSortableList();\r\n            self.addEventHandlers();\r\n        }\r\n        \r\n        self.setContentWrapper($content);\r\n\r\n        $(\".project-plan-activity-list\", $content).on(\"click\", \"li\", $.proxy(self.onClickEditActivity, self));\r\n\r\n        $(\".project-plan-activity-list\", $content).on(\"click\", \"li .activity-view\", $.proxy(self.onClickEditActivity, self));\r\n\r\n        $(\".project-plan-activity-list\", $content).on(\"click\", \"li .bz-icon-trash-outline\", $.proxy(self.onClickDeleteActivity, self));\r\n\r\n        $(\".project-plan-activity-list\", $content).on(\"click\", \"li .item-workonit-button\", $.proxy(self.onClickWorkonItActivity, self));\r\n\r\n        if(self.params.showContextByMenuDashboard === self.CONTEXT_PLANACTIVITIES){\r\n            $(\".project-plan-activity-list\", $content).on(\"click\", \"li .ui-bizagi-wrapper-parallel-icon\", $.proxy(self.onClickChangeParallel, self));\r\n        }\r\n\r\n        if (self._statePlan === self.PENDING_PLAN) {\r\n            $(\"a#to-execute-plan\", $content).on(\"click\", $.proxy(self.onExecutePlan, self));\r\n        } else if (self._statePlan !== \"CLOSED_PLAN\") {\r\n            $(\"a#to-close-plan\", $content).on(\"click\", $.proxy(self.onClosePlan, self));\r\n        }\r\n\r\n        self.renderActivities();\r\n        if(event){\r\n            if(event.type === \"UPDATE_LIST_ACTIVITIES\"){\r\n                self.updateTransitions();\r\n            }\r\n        }\r\n    },\r\n\r\n    getCopyObjectPlan: function () {\r\n        var self = this;\r\n        return {\r\n            id: self.params.plan.id,\r\n            name: self.params.plan.name,\r\n            description: self.params.plan.description,\r\n            dueDate: self.params.plan.dueDate,\r\n            waitForCompletion: self.params.plan.waitForCompletion,\r\n            currentState: self.params.plan.currentState,\r\n            parentWorkItem: self.params.plan.parentWorkItem,\r\n            creationDate: self.params.plan.creationDate,\r\n            startDate: self.params.plan.startDate,\r\n            idUserCreator: self.params.plan.idUserCreator,\r\n            contextualized: self.params.plan.contextualized,\r\n            activities: self.params.plan.activities\r\n        };\r\n    },\r\n\r\n    enableEventsOnActivitiesByCurrentContext: function(currentContext){\r\n        var self = this;\r\n        return currentContext === self.CONTEXT_PLANACTIVITIES;\r\n    },\r\n\r\n    onNotifyUpdatePlan: function(){\r\n        var self = this;\r\n        if(self.params.showContextByMenuDashboard === self.CONTEXT_PLANOVERVIEW){\r\n            $(\".ui-bizagi-wp-project-plan-activities-header h3\", self.content).text(self.params.plan.name);\r\n            $(\".ui-bizagi-wp-project-plan-activities-header p\", self.content).text(self.params.plan.description);\r\n        }\r\n\r\n    },\r\n\r\n    initializeSortableList: function () {\r\n       var self = this;\r\n       return $(\".project-plan-activity-list\", self.content).kendoSortable({\r\n            hint: function (element) {\r\n                var $clone = element.clone().width(element.width());\r\n                return $(\"<ol class='project-plan-activity-list ui-bizagi-wp-nolist'></ol>\").append($clone);\r\n            },\r\n            change: $.proxy(self.onChangePosition, self),\r\n            disabled: \".disabled\",\r\n            end: function(e) {\r\n               if(e.newIndex < self.fromIndexEnabledSortingActivities) {\r\n                   e.preventDefault();\r\n               }\r\n                else{\r\n                    if(e.oldIndex !== e.newIndex){\r\n                        self.serviceOrderActivitiesByTransitions.movePositionActivity(self.params.plan.activities, e.oldIndex, e.newIndex);\r\n\r\n                        var $liActivityGoDown = $(\".project-plan-activity-list li\", self.content).eq(e.newIndex);\r\n\r\n                        if(!self.canChangeToParallelActivity(self.params.plan.activities, $liActivityGoDown)){\r\n                            self.params.plan.activities[e.newIndex].parallel = false;\r\n\r\n                            function setSerieActivity(){\r\n                                setTimeout(function(){\r\n                                    //TODO: Update selector when show arrows in all activities\r\n                                    $(\".project-plan-activity-list li .wrapper-arrow-css i\", self.content).eq(0).\r\n                                        removeClass(\"bz-icon-arrow-right-outline\").addClass(\"bz-icon-arrow-down-outline\");\r\n                                }, 50);\r\n                            }\r\n                            setSerieActivity(e.newIndex);\r\n\r\n\r\n                        }\r\n\r\n\r\n                    }\r\n                }\r\n            }\r\n       }).data(\"kendoSortable\");\r\n    },\r\n\r\n    /*initializeNotifier: function(){\r\n        var self = this;\r\n        return $(\"#project-plan-notifier\", self.content).kendoNotification().data(\"kendoNotification\");\r\n    },*/\r\n\r\n    updateTransitions: function(){\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        var params = {\r\n            idPlan: self.params.plan.id,\r\n            transitions: self.getActualTransitions()\r\n        };\r\n\r\n        $.when(self.dataService.changeTransitions(params)).always(function (response, responseText, xhr) {\r\n            if (xhr.status === 500) {\r\n                self.plugins.notifier.showErrorMessage(bizagi.localization.getResource(\"workportal-project-plan-activities-sorterror\"), \"error\");\r\n            }\r\n            self.params.plan.activities = self.orderActivitiesByTransitions(self.params.plan.activities, params.transitions);\r\n            defer.resolve();\r\n        });\r\n        return defer.promise();\r\n    },\r\n\r\n    orderActivitiesByTransitions: function(activities, transitions){\r\n        var self = this;\r\n        return self.serviceOrderActivitiesByTransitions.\r\n            getActivitiesByTransitions(activities, transitions);\r\n    },\r\n\r\n    getActualTransitions: function(){\r\n        var self = this;\r\n        var auxOrderTransitions = self.serviceOrderActivitiesByTransitions.\r\n            getActualTransitionsByActivities(self.params.plan.activities);\r\n\r\n        auxOrderTransitions.forEach(function(transition){\r\n            transition.id = undefined;\r\n            transition.idPlan = self.params.plan.id;\r\n        });\r\n\r\n        return auxOrderTransitions;\r\n    },\r\n\r\n    onChangePosition: function(){\r\n        var self = this;\r\n        self.updateTransitions();\r\n    },\r\n\r\n    onCreateActivity: function(event) {\r\n        event.preventDefault();\r\n\r\n        var self = this;\r\n        var $input = $(\"#project-plan-activity-create\", $(event.target));\r\n        var name = $input.val();\r\n\r\n        var idUserAssigned;\r\n        if(self.params.plan.activities.length > 0){\r\n            idUserAssigned = self.params.plan.activities[self.params.plan.activities.length - 1].userAssigned;\r\n        }\r\n        else{\r\n            idUserAssigned = bizagi.currentUser.idUser;\r\n        }\r\n\r\n        if (name.replace(/\\s/g, \"\") !== \"\") {\r\n\r\n            var params = {\r\n                progress: 0,\r\n                id: \"\",\r\n                startDate: null,\r\n                duration: null,\r\n                userAssigned: idUserAssigned,\r\n                allowEdition: true,\r\n                description: null,\r\n                name: name,\r\n                idPlan: self.params.plan.id,\r\n                estimatedFinishDate: null,\r\n                finishDate: null\r\n            };\r\n\r\n            if(self.params.plan.parent && !bizagi.util.isEmpty(self.params.plan.parent.guidActivity)){\r\n                var paramsDetailActivity = {\r\n                    idPlan: self.params.plan.id,\r\n                    idActivity: self.params.plan.parent.guidActivity \r\n                };\r\n                $.when(self.dataService.getActivity(paramsDetailActivity)).done(function (response) {\r\n                    params.allowEdition = response.allowEdition;\r\n                    self.createPlanActivity(params);\r\n\r\n                 });\r\n            }else{\r\n                self.createPlanActivity(params);\r\n            }\r\n\r\n            \r\n        }\r\n\r\n        event.target.reset();\r\n\r\n        event.preventDefault();\r\n    },\r\n    createPlanActivity: function(params){\r\n        var self = this;\r\n        $.when(self.dataService.createPlanActivity(params)).always(function (response, responseText, xhr) {\r\n\r\n            if (xhr.status === 201) {\r\n                var paramsDetailActivity = {\r\n                    idPlan: params.idPlan,\r\n                    idActivity: response.id\r\n                };\r\n                $.when(self.dataService.getActivity(paramsDetailActivity)).always(function (responseActivity) {\r\n                    var activityNew = $.extend(responseActivity, {\r\n                    id: response.id,\r\n                    items: [],\r\n                    numTotalItems: 0,\r\n                    numResolvedItems: 0,\r\n                    parallel: false\r\n                });\r\n\r\n                self.renderActivities([activityNew]);\r\n                self.params.plan.activities.push(activityNew);\r\n\r\n                var $activityList = $(\".project-plan-activity-list\", self.content);\r\n                $(\"li:last .bz-icon-pencil-outline\", $activityList).trigger(\"click\");\r\n\r\n                self.updateTransitions();\r\n            });\r\n            } else if (response.status === 500) {\r\n                self.plugins.notifier.showErrorMessage(bizagi.localization.getResource(\"workportal-project-plan-activities-createarror\"), \"error\");\r\n            }\r\n        });\r\n    },\r\n    onClickChangeParallel: function(event){\r\n        event.preventDefault();\r\n        var self = this;\r\n        var $wrapperArrow = $(\".wrapper-arrow-css\", event.currentTarget);\r\n\r\n        var $liActivitySelected = $wrapperArrow.closest(\"li\");\r\n        var idActivitySelected = $liActivitySelected.data(\"id\");\r\n\r\n        if(self.canChangeToParallelActivity(self.params.plan.activities, $liActivitySelected)){\r\n            /**\r\n             * Changes UI\r\n             * */\r\n            var activityParallel;\r\n            if($(\"i\", $wrapperArrow).hasClass(\"bz-icon-arrow-down-outline\")){\r\n                activityParallel = true;\r\n                $(\"i\", $wrapperArrow).removeClass(\"bz-icon-arrow-down-outline\").addClass(\"bz-icon-arrow-right-outline\").\r\n                    prop(\"title\", bizagi.localization.getResource(\"workportal-project-plan-activity-parallel\"));\r\n            }\r\n            else{\r\n                activityParallel = false;\r\n                $(\"i\", $wrapperArrow).removeClass(\"bz-icon-arrow-right-outline\").addClass(\"bz-icon-arrow-down-outline\").\r\n                    prop(\"title\", bizagi.localization.getResource(\"workportal-project-plan-activity-sequential\"));\r\n            }\r\n\r\n            /**\r\n             * Change Activity Data\r\n             */\r\n            self.changeActivityProperties(idActivitySelected, { parallel: activityParallel });\r\n\r\n            self.updateTransitions();\r\n        }\r\n    },\r\n\r\n    canChangeToParallelActivity: function(activities, $liActivitySelected){\r\n        var self = this;\r\n        var result = true;\r\n        var idLastParallelActivity = self.getLastParallelActivityIsRunningOrClose(activities);\r\n        if(idLastParallelActivity){\r\n            var $liPreviusActivity = $liActivitySelected.prev();\r\n            var idPreviusActivity = $liPreviusActivity.data(\"id\");\r\n            if(idLastParallelActivity === idPreviusActivity){\r\n                result = false;\r\n            }\r\n        }\r\n        return result;\r\n    },\r\n\r\n    onClickEditActivity: function (event) {\r\n        var self = this;\r\n        var $target = $(event.currentTarget);\r\n\r\n        /*if(self._statePlan === self.PENDING_PLAN || (!$target.hasClass(\"disabled\") && self._statePlan === self.EXECUTING_PLAN)){\r\n            isEditableFormActivity = true;\r\n        }*/\r\n\r\n        var idActivitySelected = $target.data(\"id\");\r\n\r\n        var activityToShow = self.params.plan.activities.filter(function (activity) {\r\n            return activity.id === idActivitySelected;\r\n        })[0];\r\n\r\n        var isEditableFormActivity = self._statePlan !== \"CLOSED_PLAN\" && activityToShow.workItemState !== \"Completed\";\r\n\r\n        if (self.params.showContextByMenuDashboard === self.CONTEXT_PLANACTIVITIES) {\r\n            function showFormToEditActivity(idActivitySelected){\r\n                if(self.idActivityEditing !== idActivitySelected){\r\n                    self.params.plan.idActivitySelected = idActivitySelected;\r\n\r\n                    $target.closest(\"li\").addClass(\"selected\").siblings().removeClass(\"selected\");\r\n                    self.idActivityEditing = idActivitySelected;\r\n                    self.pub(\"notify\", {\r\n                        type: \"EDITACTIVITY\",\r\n                        args: $.extend(self.params, {\r\n                            isEditableFormActivity: isEditableFormActivity,\r\n                            idActivityToShow: idActivitySelected\r\n                        })\r\n                    });\r\n                    self.pub(\"notify\", {\r\n                        type: \"OPEN_RIGHT_SIDEBAR\"\r\n                    });\r\n                }\r\n            }\r\n\r\n            showFormToEditActivity(idActivitySelected);\r\n        }\r\n    },\r\n\r\n    changeActivityProperties: function(activityGuid, activityPropertiesToUpdate){\r\n        var self = this;\r\n        for(var iActivity = 0, lengthActivities = self.params.plan.activities.length; iActivity < lengthActivities; iActivity += 1){\r\n            if(self.params.plan.activities[iActivity].id === activityGuid){\r\n                $.extend(self.params.plan.activities[iActivity], activityPropertiesToUpdate);\r\n                break;\r\n            }\r\n        }\r\n    },\r\n\r\n    addEventHandlers: function () {\r\n        var self = this;\r\n\r\n        $(\"#project-plan-activity-createform\", self.content).on(\"submit\", $.proxy(self.onCreateActivity, self));\r\n        $(\"#project-plan-activity-create\", self.content).focus();\r\n    },\r\n\r\n    /**\r\n     * UI\r\n     */\r\n    renderActivities: function(activities){\r\n        var self = this;\r\n        var $list = $(\".project-plan-activity-list\", self.content);\r\n        var tmpl = self.getTemplate(\"plan-activities-item\");\r\n\r\n        if(self.params.showContextByMenuDashboard === self.CONTEXT_PLANACTIVITIES){\r\n            $list.addClass(\"enabled-actions\");\r\n        }\r\n\r\n        var $element = self.params.plan.currentState === \"PENDING\" ? $(\"a#to-execute-plan\", self.content) : $(\"a#to-close-plan\", self.content);\r\n        if (activities || self.params.plan.activities.length > 0) {\r\n            $element.show();\r\n        } else {\r\n            $element.hide();\r\n        }\r\n\r\n        var arrayActivities = activities || self.params.plan.activities;\r\n\r\n        var argsTemplate = {\r\n            statePlan: self._statePlan,\r\n            statePendingPlan: self.PENDING_PLAN,\r\n            stateExecutingPlan: self.EXECUTING_PLAN,\r\n            context: self.params.showContextByMenuDashboard,\r\n            activities: activities || self.params.plan.activities,\r\n            currentUserId: bizagi.currentUser.idUser\r\n        };\r\n\r\n        if(self._statePlan === self.EXECUTING_PLAN){\r\n            arrayActivities.forEach(function(activity){\r\n                if(activity.startDate){\r\n                    activity.classEnabledActionActivities = \"disabled\";\r\n                }\r\n                else{\r\n                    activity.classEnabledActionActivities = (self.params.showContextByMenuDashboard === self.CONTEXT_PLANACTIVITIES ? \"enabled\" : \"disabled\");\r\n                }\r\n\r\n                activity.isRunning = self.runningActivity(activity);\r\n\r\n            });\r\n        }\r\n\r\n        // XSS Fix Bug \r\n        argsTemplate.activities = argsTemplate.activities.map(function (activity) {\r\n            activity.name = bizagi.util.decodeHtmlEntities(activity.name);\r\n            activity.description = bizagi.util.decodeHtmlEntities(activity.description);\r\n            return activity;\r\n        });\r\n\r\n        var $item = tmpl.render(argsTemplate);\r\n        $list.append($item);\r\n\r\n        self.fromIndexEnabledSortingActivities = self.params.plan.activities.filter(function(activity){\r\n            return activity.classEnabledActionActivities === \"disabled\";\r\n        }).length;\r\n\r\n        self.loadAndShowImagesUsers(self.params.plan.activities);\r\n    },\r\n\r\n    /**\r\n     * Know if the activity is running\r\n     * @param activity\r\n     * @returns {boolean}\r\n     */\r\n    runningActivity: function(activity){\r\n        //Inactive represent created but user dont access yet\r\n        return activity.workItemState === 'Active' || activity.workItemState === 'Inactive';\r\n    },\r\n\r\n    loadAndShowImagesUsers: function(listActivities){\r\n        var self = this;\r\n\r\n        var guidUsers = $.map(listActivities, function (element) {\r\n            return element.userAssigned;\r\n        });\r\n\r\n        function removeDuplicateItemsFromArray(a) {\r\n            var seen = {};\r\n            var out = [];\r\n            var len = a.length;\r\n            var j = 0;\r\n            for (var i = 0; i < len; i++) {\r\n                var item = a[i];\r\n                if (seen[item] !== 1) {\r\n                    seen[item] = 1;\r\n                    out[j++] = item;\r\n                }\r\n            }\r\n            return out;\r\n        }\r\n\r\n        var csvguidUsers = removeDuplicateItemsFromArray(guidUsers.concat(bizagi.currentUser.userGuid)).join(\",\");\r\n\r\n        self.getDataUsers(csvguidUsers).then(function () {\r\n            self.renderUserProfilesAndImages();\r\n        });\r\n    },\r\n\r\n    renderUserProfilesAndImages: function () {\r\n        var self = this;\r\n\r\n        var base64Prefix = \"data:image/png;base64,\";\r\n\r\n        for (var iUser = 0; iUser < self.userPictures.length; iUser += 1) {\r\n            $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"']  span.ui-bizagi-user-initials\").html(self.userPictures[iUser].name.getInitials());\r\n            if (self.userPictures[iUser].picture) {\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"']  img\").show();\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"']  span.ui-bizagi-user-initials\").hide();\r\n                $(\"div[data-iduser='\" + self.userPictures[iUser].id + \"']  img\").attr(\"src\", base64Prefix + self.userPictures[iUser].picture);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Call services\r\n     */\r\n\r\n    /*\r\n     *  Get data for users\r\n     */\r\n    getDataUsers: function (csvguidUsers) {\r\n        var self = this,\r\n           defer = $.Deferred();\r\n\r\n        var params = {\r\n            usersGuids: csvguidUsers,\r\n            width: 50,\r\n            height: 50\r\n        };\r\n\r\n        self.dataService.getUsersData(params).always(function (response) {\r\n\r\n            function arrayUnique(array) {\r\n                var a = array.concat();\r\n                for (var i = 0; i < a.length; ++i) {\r\n                    for (var j = i + 1; j < a.length; ++j) {\r\n                        if (a[i] === a[j]){\r\n                            a.splice(j -= 1, 1);\r\n                        }\r\n\r\n                    }\r\n                }\r\n                return a;\r\n            }\r\n\r\n            self.userPictures = arrayUnique(self.userPictures.concat(response));\r\n            defer.resolve(response);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /**\r\n     * When cancel form\r\n     */\r\n    onCancelActivityForm: function () {\r\n        var self = this;\r\n        self.closeSidebar();\r\n        self.pub(\"notify\", {\r\n            type: \"PLANSIDEBAR\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    setContentWrapper: function (content) {\r\n        var self = this;\r\n        var $contentWrapper = $(\".project-plan-content-wrapper\", content);\r\n        $contentWrapper.on(\"click\", $.proxy(self.onCancelActivityForm, self));\r\n        var activityArea = $(\"#project-plan-activities-wrapper\", content);\r\n        activityArea.on(\"click\", function(e) { e.stopPropagation(); });\r\n        var windowHeight = $(window).height();\r\n        var height = windowHeight - 156;\r\n        $contentWrapper.css(\"height\", height + \"px\");\r\n    },\r\n\r\n    onClickDeleteActivity: function (event) {\r\n        event.stopPropagation();        \r\n        var self = this;\r\n        var idActivitySelected = $(event.currentTarget).data(\"id\");\r\n        var params = {\r\n            idPlan: self.params.plan.id,\r\n            id: idActivitySelected\r\n        };\r\n        $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-plan-activity-delete-confirmation\"), \"\", \"info\")).done(function () {\r\n            $.when(self.dataService.deleteActivityPlan(params)).done(function () {\r\n                self.closeSidebar();\r\n                //The next activity of the deleted, if its parallel, have to set dont parallel\r\n                for(var iActivity = 0, lengthActivities = self.params.plan.activities.length; iActivity < lengthActivities; iActivity += 1){\r\n                    if(self.params.plan.activities[iActivity].id === idActivitySelected){\r\n                        //activity isn't the first or last activity\r\n                        if(lengthActivities > iActivity + 1 && iActivity > 0){\r\n                            if(self.params.plan.activities[iActivity + 1].parallel && self.params.plan.activities[iActivity - 1].parallel){\r\n                                self.params.plan.activities[iActivity + 1].parallel = false;\r\n                                $(\".project-plan-activity-list li[data-id='\" + self.params.plan.activities[iActivity].id + \"']\", self.content).\r\n                                    next().find(\".wrapper-arrow-css i\").removeClass(\"bz-icon-arrow-right-outline\").addClass(\"bz-icon-arrow-down-outline\");\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                //Delete activity\r\n                self.params.plan.activities = self.params.plan.activities.filter(function (activity) {\r\n                    return activity.id !== idActivitySelected;\r\n                });\r\n\r\n                $.when(self.updateTransitions()).done(function(){\r\n                    self.renderWidgetByStatePlan();\r\n\r\n                    self.pub(\"notify\", {\r\n                        type: \"PLANSIDEBAR\",\r\n                        args: self.params\r\n                    });\r\n                });\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Go to activity\r\n     */\r\n    onClickWorkonItActivity: function(event){\r\n        event.preventDefault();\r\n        var self = this;\r\n        var idActivitySelected = $(event.target).closest(\"li\").data(\"id\");\r\n        var activity = self.params.plan.activities.filter(function (activity) {\r\n            return activity.id === idActivitySelected;\r\n        })[0];\r\n\r\n        self.publish(\"executeAction\", {\r\n            action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n            idCase: activity.idCase,\r\n            idWorkItem: activity.idWorkItem\r\n        });\r\n    },\r\n\r\n    onExecutePlan: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n\r\n        var numberActivitiesCreated = self.params.plan.activities.length;\r\n\r\n        if (numberActivitiesCreated > 0) {\r\n            if (!$(event.target).closest(\"a\").hasClass(\"disabled\")) {\r\n                self.params.plan.currentState = \"EXECUTING\";\r\n                $(event.target).closest(\"a\").addClass(\"disabled\");\r\n                var params = {\r\n                    idPlan: self.params.plan.id\r\n                };\r\n\r\n                $.when(self.dataService.putExecutePlan(params)).done(function () {\r\n                    var params = $.extend(self.getCopyObjectPlan(), { startDate: self.getDateServer() });\r\n                    self.callUpdatePlan(params);\r\n\r\n                    $(event.target).closest(\"a\").removeClass(\"disabled\");\r\n\r\n                    function sendNotification(params){\r\n                        if(self.params.planChild){\r\n                            self.params.planChild.currentState = self.params.plan.currentState;\r\n                        }\r\n\r\n                        self.pub(\"notify\", {\r\n                            type: \"PLANACTIVITIES\",\r\n                            args: $.extend(params, { refreshAllWidgets: true })\r\n                        });\r\n                    }\r\n\r\n                    if(typeof self.radNumber === \"undefined\"){\r\n                        $.when(self.dataService.getCaseByPlan({ idPlan: self.params.plan.id })).done(function(response){\r\n                            self.params.idCase = response.id;\r\n                            sendNotification(self.params);\r\n                        });\r\n                    }\r\n                    else{\r\n                        sendNotification(self.params);\r\n                    }\r\n\r\n\r\n\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            self.plugins.notifier.showErrorMessage(printf(bizagi.localization.getResource(\"workportal-project-plan-action-execute-message-activities-required\"), \"\"));\r\n        }\r\n    },\r\n\r\n    onClosePlan: function (event) {\r\n        var self = this;\r\n        event.preventDefault();\r\n        if (self.activitiesAreCompleted(self.params.plan.activities)) {\r\n            self.closePlan();\r\n        } else {\r\n            $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-plan-action-close-message-activities-finished\"), \"\", \"info\")).done(function () {\r\n                self.closePlan();\r\n            });\r\n        }\r\n    },\r\n\r\n    closePlan: function() {\r\n        var self = this;\r\n        var params = $.extend(self.getCopyObjectPlan(), { currentState: \"CLOSED\" });\r\n        $.when(self.callUpdatePlan(params)).done(function(){\r\n            $.when(self.callClosePlan({ idPlan: params.id })).done(function(){\r\n                self.params.plan = params;\r\n                self.pub(\"notify\", {\r\n                    type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n                    args: self.params\r\n                });\r\n\r\n                self.pub(\"notify\", {\r\n                    type: \"LOAD_INFO_SUMMARY_PROGRESS_PLAN\",\r\n                    args: self.params\r\n                });\r\n            }).fail(function(){\r\n                self.notifier.showErrorMessage(printf(bizagi.localization.getResource('workportal-project-plan-close-fail'), ''));\r\n            });\r\n        }).fail(function(){\r\n            self.notifier.showErrorMessage(printf(bizagi.localization.getResource('workportal-project-plan-close-fail'), ''));\r\n        });\r\n    },\r\n\r\n    callUpdatePlan: function (params) {\r\n        var self = this;\r\n        return $.when(self.dataService.updatePlan(params)).done(function () {\r\n            $.extend(self.params.plan, params);\r\n        });\r\n    },\r\n\r\n    callClosePlan: function (params) {\r\n        var self = this;\r\n        return $.when(self.dataService.closePlan(params)).done(function () {\r\n            $.extend(self.params.plan, params);\r\n            self.plugins.notifier.showSucessMessage(printf(bizagi.localization.getResource(\"workportal-project-plan-close-success\"), \"\"));\r\n        });\r\n    },\r\n\r\n    activitiesAreCompleted: function (activities) {\r\n        var listActivities = activities || [];\r\n        var numActivitiesCompleted = listActivities.filter(function (activity) {\r\n            return activity.finishDate;\r\n        }).length;\r\n        return numActivitiesCompleted === activities.length;\r\n    },\r\n\r\n    getLastParallelActivityIsRunningOrClose: function(activities){\r\n        var lastIndexParallelInExecution = -1;\r\n        var parallelActivitiesInRunning = activities.filter(function(activity){\r\n            if(activity.startDate !== null && activity.parallel){\r\n                lastIndexParallelInExecution += 1;\r\n                return true;\r\n            }\r\n        });\r\n        if(lastIndexParallelInExecution >= 0 && lastIndexParallelInExecution + 1 !== activities.length){\r\n            return parallelActivitiesInRunning[parallelActivitiesInRunning.length - 1].id;\r\n        }\r\n        else{\r\n            return null;\r\n        }\r\n    },\r\n\r\n    refreshActivityRow: function (event, params) {\r\n        var self = this;\r\n        var $selectedActivity = $(\".project-plan-activity-list li.selected\");\r\n        if (params.args.displayName) $(\"p>span\", $selectedActivity).text(params.args.displayName);\r\n        if (params.args.assignee) {\r\n\r\n            var idActivitySelected = $($selectedActivity).data(\"id\");\r\n            var activityEdited = self.params.plan.activities.filter(function (activity) {\r\n                return activity.id === idActivitySelected;\r\n            })[0];\r\n\r\n            if(params.args.assignee === bizagi.currentUser.idUser && (activityEdited.workItemState === \"Active\" || activityEdited.workItemState === \"Inactive\")){\r\n                $(\".item-workonit-button\", $selectedActivity).show();\r\n            }\r\n            else{\r\n                $(\".item-workonit-button\", $selectedActivity).hide();\r\n            }\r\n\r\n            self.getDataUsers([params.args.assignee].join()).then(function (response) {\r\n                $(\".bz-wp-avatar span.ui-bizagi-user-initials\", $selectedActivity).html(response[0].name.getInitials());\r\n                $(\"div.ui-bizagi-wp-project-plan-activity-infobox[data-iduser]\", $selectedActivity).attr(\"data-iduser\", params.args.assignee);\r\n                if (response[0].picture) {\r\n                    var base64Prefix = \"data:image/png;base64,\";\r\n                    $(\".bz-wp-avatar img\", $selectedActivity).show();\r\n                    $(\".bz-wp-avatar  span.ui-bizagi-user-initials\", $selectedActivity).hide();\r\n                    $(\".bz-wp-avatar img\", $selectedActivity).attr(\"src\", base64Prefix + response[0].picture);\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    closeSidebar: function(){\r\n        var that = this;\r\n        var alwaysCollapse = bizagi.services.preferences().getPreferences()?bizagi.services.preferences().getPreference(\"collapseSidebars\"):\"\";\r\n        if(alwaysCollapse === 'yes' && $(\".ui-bizagi-wp-project-panel-rowicon-right i.bz-icon-left-outline\").css(\"display\") == \"none\" && $(\"li.clearfix.selected\").length > 0){\r\n            that.pub(\"notify\", {\r\n                type: \"CLOSE_RIGHT_SIDEBAR\"\r\n            });\r\n        }\r\n    },\r\n\r\n    collapseSidebars: function() {\r\n        var alwaysCollapse = bizagi.services.preferences().getPreferences()?bizagi.services.preferences().getPreference(\"collapseSidebars\"):\"\";\r\n        if(alwaysCollapse === 'yes'){\r\n            $(\"#ui-bizagi-wp-project-homeportal-main\").addClass(\"ui-bizagi-wp-project-collapse-rightpanel\");\r\n            $(\"#ui-bizagi-wp-project-homeportal-main\").removeClass(\"ui-bizagi-wp-project-open-rightpanel\");\r\n            $(\"#right-sidebar-wrapper\").addClass(\"always-collpase\");\r\n\r\n            $(\"#ui-bizagi-wp-project-homeportal-main\").addClass(\"ui-bizagi-wp-project-collapse-leftpanel\");\r\n            $(\"#ui-bizagi-wp-project-homeportal-main\").removeClass(\"ui-bizagi-wp-project-open-leftpanel\");\r\n            $(\"#left-sidebar-wrapper\").addClass(\"always-collpase\");\r\n        }\r\n    }\r\n    \r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.activities\", [\"workportalFacade\", \"dataService\", \"notifier\", \"bizagi.workportal.services.behaviors.orderActivitiesByTransitions\", bizagi.workportal.widgets.project.plan.activities], true);\r\n","/*\r\n *   Name: Bizagi Workportal project Plan Sidebar\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.sidebar\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, serviceloadDataPlan, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.serviceloadDataPlan = serviceloadDataPlan;\r\n      self.params = params || {};\r\n      params.supportNav = false;\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"project-plan-sidebar\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.project.plan.sidebar\").concat(\"#project-plan-sidebar\")\r\n      });\r\n\r\n   },\r\n\r\n    /*\r\n     * Renders the template defined in the widget\r\n     */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"project-plan-sidebar\");\r\n        self.content = template.render({});\r\n        $.when(self.areTemplatedLoaded())\r\n                .done(function () {\r\n                    var params = {idPlan: self.params.plan.id};\r\n                    if (self.params.planChild && self.params.planChild.id) {\r\n                        params.idPlan = self.params.planChild.id;\r\n                    }\r\n                    self.serviceloadDataPlan.loadData(params, self.getDateServer, self.params);\r\n                    self.serviceloadDataPlan.subscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n                    self.serviceloadDataPlan.subscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n                });\r\n        return self.content;\r\n    },\r\n\r\n    loadedWithDataActivities: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOADED_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"UPDATE_INFO_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PROGRESS_PLAN\",\r\n            args: self.params\r\n        });\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_ACTIVITIES_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    loadedWithDataFirstParent: function(){\r\n        var self = this;\r\n        self.pub(\"notify\", {\r\n            type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n            args: self.params\r\n        });\r\n    },\r\n\r\n    clean: function(){\r\n        var self = this;\r\n        if(self.serviceloadDataPlan){\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataActivities\", $.proxy(self.loadedWithDataActivities, self));\r\n            self.serviceloadDataPlan.unsubscribe(\"loadedWithDataFirstParent\", $.proxy(self.loadedWithDataFirstParent, self));\r\n        }\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.sidebar\", [\"workportalFacade\", \"dataService\", \"bizagi.workportal.services.behaviors.loadDataPlan\", bizagi.workportal.widgets.project.plan.sidebar], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Action\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.project.base.extend(\"bizagi.workportal.widgets.project.plan.action\", {}, {\r\n\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, projectDashboard, notifier, planTemplateCreate, planPopupEdit, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        self.PENDING_PLAN = \"PENDING\";\r\n        self.EXECUTING_PLAN = \"EXECUTING\";\r\n        self.CLOSED_PLAN = \"CLOSED\";\r\n\r\n        self.CONTEXT_ACTIVITYPLAN = \"ACTIVITYPLAN\";\r\n        self.CONTEXT_ACTIVITYPLANOVERVIEW = \"ACTIVITYPLANOVERVIEW\";\r\n        self.CONTEXT_PLANCREATE = \"PLANCREATE\";\r\n        self.CONTEXT_ACTIVITYPLANCREATE = \"ACTIVITYPLANCREATE\";\r\n\r\n        self.showActionsPlan = false;\r\n        self.projectDashboard = projectDashboard;\r\n        self.notifier = notifier;\r\n        self.planTemplateCreate = planTemplateCreate;\r\n        self.planPopupEdit = planPopupEdit;\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"plan-action-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.action\").concat(\"#project-plan-action\")\r\n        });\r\n    },\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        var tmpl = self.getTemplate(\"plan-action-main\");\r\n\r\n        self.showActionsPlan =  self.params.showContextByMenuDashboard !== self.CONTEXT_ACTIVITYPLAN &&\r\n            self.params.showContextByMenuDashboard !== self.CONTEXT_ACTIVITYPLANOVERVIEW;\r\n\r\n        self.plugins = {};\r\n        self.content = tmpl.render({\r\n            plan: self.params.plan.name,\r\n            stateClosedPlan: self.CLOSED_PLAN,\r\n            currentStatePlan: self.params.plan.currentState,\r\n            showActionsPlan: self.showActionsPlan\r\n        });\r\n\r\n        if (self.showActionsPlan) {\r\n            self.params.plan.contextualized = typeof(self.params.plan.contextualized) == \"undefined\" ? true : self.params.plan.contextualized;\r\n        }\r\n\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n\r\n        var self = this;\r\n        var $contentWidget = self.getContent();\r\n\r\n        if(self.showActionsPlan){\r\n            self.initilizeActionMenu();\r\n            $(\"a#to-close-plan\", $contentWidget).on(\"click\", $.proxy(self.onClosePlan, self));\r\n        }\r\n\r\n        self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n        self.clearAlertsOnFocus();\r\n\r\n        self.planTemplateCreate.sub('planTemplateCreatedSuccess', function () {\r\n            self.notifier.showSucessMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-create-template-success'), ''));\r\n        });\r\n        self.planTemplateCreate.sub('planTemplateCreatedFailed', function () {\r\n            self.notifier.showErrorMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-create-template-fail'), ''));\r\n        });\r\n\r\n        self.planPopupEdit.sub('planEditedSuccess', function () {\r\n            self.setNamePlan(self.params.plan.name);\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"UPDATE_INFO_PLAN\"\r\n            });\r\n\r\n            self.pub(\"notify\", {\r\n                type: \"LOAD_INFO_SUMMARY_PLAN\",\r\n                args: self.params\r\n            });\r\n\r\n            self.notifier.showSucessMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-edit-success'), ''));\r\n        });\r\n\r\n        self.planPopupEdit.sub('planEditedFailed', function () {\r\n            self.notifier.showErrorMessage(\r\n                printf(bizagi.localization.getResource('workportal-project-plan-edit-fail'), ''));\r\n        });\r\n\r\n        self.sub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n    },\r\n\r\n    onNotifyExpandedRightSidebar: function(){\r\n        var self = this;\r\n        if(self.showActionsPlan){\r\n            self.initilizeActionMenu();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Notifies when an event is raised\r\n     */\r\n\r\n    onNotifyLoadInfoSummaryPlan: function () {\r\n        var self = this;\r\n        self.setStatePlan(self.params.plan.currentState);\r\n        self.setNamePlan(self.params.plan.name);\r\n    },\r\n\r\n    /**\r\n     * UI\r\n     */\r\n\r\n    setStatePlan: function (statePlan) {\r\n        var self = this;\r\n        if (statePlan) {\r\n            switch (statePlan.toUpperCase()) {\r\n                case \"PENDING\":\r\n                    $(\".state-pending-plan\", self.content).show().siblings().hide();\r\n                    break;\r\n                case \"EXECUTING\":\r\n                    $(\".state-executing-plan\", self.content).show().siblings().hide();\r\n                    break;\r\n                case \"CLOSED\":\r\n                    $(\".state-closed-plan\", self.content).show().siblings().hide();\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n\r\n    setNamePlan: function(namePlan){\r\n        var self = this;\r\n        $(\".ui-bizagi-wp-project-plan-header .bz-wp-section\", self.content).text(bizagi.util.decodeHtmlEntities(namePlan));\r\n    },\r\n\r\n    /**\r\n     Events\r\n     */\r\n    onSelectMenu: function (event, ui) {\r\n        var self = this;\r\n        if($(event.currentTarget).find(\"i\").length === 0){\r\n            var item = $(ui.item).data(\"item\");\r\n\r\n            switch (item) {\r\n                case \"edit\":\r\n                    self.onClickMenuOpenEdition();\r\n                    break;\r\n                case \"delete\":\r\n                    self.onClickMenuDeletePlan();\r\n                    break;\r\n                case \"saveastmpl\":\r\n                    self.onClickMenuSaveAsTemplate();\r\n                    break;\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    onClickMenuOpenEdition: function () {\r\n        var self = this;\r\n        var planSelected = self.params.plan;\r\n        self.planPopupEdit.showPopup(self.params, self.dataService, planSelected);\r\n    },\r\n\r\n    onClickMenuSaveAsTemplate: function () {\r\n        var self = this;\r\n        self.planTemplateCreate.showPopupAddTemplatePlan(self.params,\r\n            self.dataService, self.params.plan.contextualized, self.params.plan.id);\r\n    },\r\n\r\n    onClickMenuDeletePlan: function(){\r\n        var self = this;\r\n\r\n        $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-project-plan-action-delete-confirmation\"), \"\", \"info\")).done(function () {\r\n            var params = { id: self.params.plan.id };\r\n\r\n            $.when(self.callDeletePlan(params)).always(function(response){\r\n                if (response.status === 200 || typeof (response.status) === \"undefined\") {\r\n                    $.extend(self.params.plan, params);\r\n                    self.notifier.showSucessMessage(\r\n                        printf(bizagi.localization.getResource(\"workportal-project-plan-delete-success\"), \"\"));\r\n\r\n                    //when a plan created from an activity is deleted, not created from a case\r\n                    var getLevelNavigator = self.pub(\"notify\", { type: \"NAVIGATOR_GETLEVEL\"});\r\n                    var currentLevelNavigator = parseInt(getLevelNavigator[0]);\r\n                    var params = self.projectDashboard.getParamsByBackFromPlan(self.params, currentLevelNavigator, true);\r\n\r\n                    self.pub(\"notify\", {\r\n                        type: params.typeContext,\r\n                        args: $.extend(self.params, params.paramsNotify)\r\n                    });\r\n                }\r\n                else{\r\n                    self.notifier.showErrorMessage(\r\n                        printf(bizagi.localization.getResource('workportal-project-plan-delete-fail'), ''));\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    onSubmitFormPlan: function (event) {\r\n        event.preventDefault();\r\n    },\r\n\r\n    initilizeActionMenu: function () {\r\n        var self = this;\r\n        $(\".ui-bizagi-wp-project-plan-action-menu\", self.content).menu({\r\n            select: $.proxy(self.onSelectMenu, self)\r\n        }).removeClass(\"ui-widget-content\");\r\n    },\r\n\r\n\r\n    /**\r\n     * Initialize edit plugin\r\n     */\r\n\r\n    clearAlertsOnFocus: function () {\r\n        $(\".ui-bizagi-wp-project-container-validator-relative input, .ui-bizagi-wp-project-container-validator-relative textarea\").focus(function () {\r\n            $(this).parent().find(\".k-invalid-msg\").hide();\r\n        }).focusout(function () {\r\n            if ($(this).val().length < 1) {\r\n                $(this).parent().find(\".k-invalid-msg\").show();\r\n            }\r\n        });\r\n    },\r\n\r\n    /*activitiesAreCompleted: function(activities){\r\n        var listActivities = activities || [];\r\n        var numActivitiesCompleted =  listActivities.filter(function(activity){\r\n            return activity.finishDate;\r\n        }).length;\r\n        return numActivitiesCompleted == activities.length;\r\n    },*/\r\n\r\n    /*getCopyObjectPlan: function(){\r\n        var self = this;\r\n        return {\r\n            id: self.params.plan.id,\r\n            name: self.params.plan.name,\r\n            description: self.params.plan.description,\r\n            dueDate: self.params.plan.dueDate,\r\n            waitForCompletion: self.params.plan.waitForCompletion,\r\n            currentState: self.params.plan.currentState,\r\n            parentWorkItem: self.params.plan.parentWorkItem,\r\n            creationDate: self.params.plan.creationDate,\r\n            startDate: self.params.plan.startDate,\r\n            idUserCreator: self.params.plan.idUserCreator,\r\n            contextualized: self.params.plan.contextualized,\r\n            activities: self.params.plan.activities\r\n        };\r\n    },*/\r\n\r\n    /**\r\n     * Call services\r\n     */\r\n    /*callUpdatePlan: function(params){\r\n        var self = this;\r\n        return $.when(self.dataService.updatePlan(params)).done(function () {\r\n            $.extend(self.params.plan, params);\r\n\r\n        });\r\n    },\r\n\r\n    callClosePlan: function(params){\r\n        var self = this;\r\n        return $.when(self.dataService.closePlan(params)).done(function () {\r\n            $.extend(self.params.plan, params);\r\n            self.notifier.showSucessMessage(\r\n                printf(bizagi.localization.getResource(\"workportal-project-plan-close-success\"), \"\"));\r\n        });\r\n    },*/\r\n\r\n    callDeletePlan: function(params){\r\n        var self = this;\r\n        return $.when(self.dataService.deletePlan(params));\r\n    },\r\n\r\n    clean: function(){\r\n        var self = this;\r\n        self.planTemplateCreate.unsub(\"planTemplateCreatedSuccess\");\r\n        self.planTemplateCreate.unsub(\"planTemplateCreatedFailed\");\r\n        self.planPopupEdit.unsub(\"planEditedSuccess\");\r\n        self.planPopupEdit.unsub(\"planEditedFailed\");\r\n\r\n        self.unsub(\"EXPANDED_RIGHT_SIDEBAR\", $.proxy(self.onNotifyExpandedRightSidebar, self));\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.action\", [\"workportalFacade\", \"dataService\",\r\n    \"bizagi.workportal.services.behaviors.projectDashboard\", \"notifier\",\r\n    \"bizagi.workportal.widgets.project.plan.template.create\",\r\n    \"bizagi.workportal.widgets.project.plan.edit\",\r\n    bizagi.workportal.widgets.project.plan.action], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan State\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.state\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-state-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.state\").concat(\"#project-plan-state\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n      self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n      var self = this;\r\n      var tmpl = self.getTemplate(\"plan-state-main\");\r\n      var renderWidget = tmpl.render({});\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n       var state = self.params.plan.currentState;\r\n\r\n       switch (state.toUpperCase()) {\r\n         case \"PENDING\":\r\n            $(\".state-pending\", renderWidget).show().siblings().hide();\r\n            break;\r\n         case \"EXECUTING\":\r\n            $(\".state-executing\", renderWidget).show().siblings().hide();\r\n            break;\r\n         case \"CLOSED\":\r\n            $(\".state-closed\", renderWidget).show().siblings().hide();\r\n            break;\r\n      }\r\n      self.content.empty().append(renderWidget);\r\n\r\n   }\r\n\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.state\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.state], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Progress\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.progress\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-progress-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.progress\").concat(\"#project-plan-progress\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n\r\n      self.sub(\"LOAD_INFO_SUMMARY_PROGRESS_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      var $content = self.getContent().empty();\r\n\r\n      var valuePercentBarComplete = self.calculateProgress();\r\n\r\n      var argsTemplate = {};\r\n      argsTemplate.progress = valuePercentBarComplete;\r\n\r\n      if(argsTemplate.progress < 33){\r\n         argsTemplate.colorBar = \"Red\";\r\n      }\r\n      else if(argsTemplate.progress < 66){\r\n         argsTemplate.colorBar = \"Yellow\";\r\n      }\r\n      else{\r\n         argsTemplate.colorBar = \"Green\";\r\n      }\r\n\r\n      //Update widget\r\n      var contentTemplate = self.getTemplate(\"plan-progress-main\");\r\n      contentTemplate\r\n         .render(argsTemplate)\r\n         .appendTo($content);\r\n\r\n      //Begin Adjust status bar next to the number days\r\n      var $barRemainingDate = $(\".remaining-days .time-remaining\", $content);\r\n      var widthNumberDays = $(\".remaining-days .days\", $content).width();\r\n      $barRemainingDate.css(\"padding-left\", (widthNumberDays + 7).toString() + \"px\");\r\n      //End Adjust status bar next to the number days\r\n\r\n\r\n   },\r\n\r\n   calculateProgress: function(){\r\n      var self = this;\r\n\r\n      var completedActivities = 0;\r\n      var totalActivities = self.params.plan.activities.length;\r\n      var percentProgress = 0;\r\n      \r\n      if(totalActivities !== 0){\r\n         self.params.plan.activities.forEach(function(activity){\r\n             if (activity.workItemState === \"Completed\") {\r\n               completedActivities++;\r\n            }\r\n         });\r\n         percentProgress = Math.round((completedActivities / totalActivities) * 100);\r\n      }\r\n      return percentProgress;\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.progress\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.progress], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Time\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.time\", {}, {\r\n\r\n   /*\r\n    *   Constructor\r\n    */\r\n   init: function (workportalFacade, dataService, params) {\r\n      var self = this;\r\n\r\n      // Call base\r\n      self._super(workportalFacade, dataService, params);\r\n\r\n      self.PENDING_PLAN = \"PENDING\";\r\n      self.EXECUTING_PLAN = \"EXECUTING\";\r\n      self.CLOSED_PLAN = \"CLOSED\";\r\n\r\n      //Regional\r\n      self.datePickerRegional = bizagi.localization.getResource(\"datePickerRegional\");\r\n\r\n      //Load templates\r\n      self.loadTemplates({\r\n         \"plan-time-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.time\").concat(\"#project-plan-time\")\r\n      });\r\n   },\r\n\r\n   renderContent: function () {\r\n      var self = this;\r\n      self.content = $(\"<div></div>\");\r\n      return self.content;\r\n   },\r\n\r\n   postRender: function () {\r\n      var self = this;\r\n\r\n      self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n   },\r\n\r\n   /**\r\n    * Notifies when an event is raised\r\n    */\r\n\r\n   onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n\r\n      if(self.params.plan){\r\n         if(self.params.plan.dueDate){\r\n            if(self.params.plan.currentState === self.PENDING_PLAN || self.params.plan.currentState === self.EXECUTING_PLAN ){\r\n               self.updateWidget(event, params);\r\n            }\r\n            else{\r\n               self.sub(\"LOADED_ACTIVITIES_PLAN\", $.proxy(self.updateWidget, self));\r\n            }\r\n         }\r\n         else{\r\n            self.getContent().empty();\r\n         }\r\n      }\r\n\r\n   },\r\n   \r\n   /**\r\n    * change the time properties string to timestamp number\r\n    * @param {*} plan \r\n    */\r\n   planDatesToStamp:function (plan) {\r\n      if(plan.activities)\r\n         plan.activities.map(function(a) {\r\n            if(a.estimatedFinishDate)a.estimatedFinishDate=new Date(a.estimatedFinishDate).getTime();\r\n            if(a.startDate)a.startDate=new Date(a.startDate).getTime();\r\n            if(a.finishDate)a.finishDate=new Date(a.finishDate).getTime();\r\n         });\r\n      if(plan.dueDate)plan.dueDate=new Date(plan.dueDate).getTime();\r\n      if(plan.creationDate)plan.creationDate=new Date(plan.creationDate).getTime();\r\n      if(plan.startDate)plan.startDate=new Date(plan.startDate).getTime();\r\n      if(plan.closedDate)plan.closedDate=new Date(plan.closedDate).getTime();\r\n      if(plan.finishDate)plan.finishDate=new Date(plan.finishDate).getTime();\r\n   },\r\n   updateWidget: function(event, params){\r\n      var self = this;\r\n      self.params = $.extend(self.params, params.args);\r\n      self.planDatesToStamp(self.params.plan);\r\n      var $content = self.getContent().empty();\r\n      if(self.params.plan.currentState === self.CLOSED_PLAN){\r\n         self.getClosedDatePlan(self.params.plan);\r\n      }\r\n      $.when(self.getIntervalOnMinutes(self.params.plan)).done(function(response){\r\n         var relativeTime =  bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now() - (response.minutesToShowTime * 60 * 1000)), null, true);\r\n\r\n         var messageUnitTimeCalculated = relativeTime.replace(/\\d/g,\"\");\r\n         var keywordResourceDescriptionDifference = self.getKeywordDifferenceDates(self.params.plan);\r\n         var messageDescripionDifference = bizagi.localization.getResource(\"workportal-project-plan-state-\" + keywordResourceDescriptionDifference);\r\n         messageDescripionDifference = messageDescripionDifference.replace(\"%s\", messageUnitTimeCalculated);\r\n\r\n         var valueOfTimeCalculated = relativeTime.replace(/\\D/g,\"\");\r\n\r\n         var auxToDate = self.getSecondDate(self.params.plan);\r\n         var auxPercentBar = self.getWidthBar(self.params.plan, response);\r\n         var auxColorBar = self.getColorBarByPercent(auxPercentBar);\r\n         var argsTemplate = {\r\n            fromDate:  self.getFormattedDate(new Date(self.getFirstDate(self.params.plan))),\r\n            toDate: auxToDate ? self.getFormattedDate(new Date(auxToDate)) : null,\r\n            valueOfTimeCalculated: valueOfTimeCalculated,\r\n            messageDescripionDifference: messageDescripionDifference,\r\n            percentBar: auxPercentBar,\r\n            colorBar: auxColorBar\r\n         };\r\n\r\n         var contentTemplate = self.getTemplate(\"plan-time-main\");\r\n         contentTemplate\r\n            .render(argsTemplate)\r\n            .appendTo($content);\r\n\r\n      });\r\n   },\r\n   getFirstDate: function(plan){\r\n      var self = this;\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate){\r\n               return plan.dueDate;\r\n            }\r\n            else{\r\n               return plan.creationDate;\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n         case self.CLOSED_PLAN:\r\n            return plan.startDate;\r\n      }\r\n   },\r\n   getSecondDate: function(plan){\r\n      var self = this;\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            return null;\r\n         case self.EXECUTING_PLAN:\r\n            return plan.dueDate;\r\n         case self.CLOSED_PLAN:\r\n            return plan.closedDate;\r\n      }\r\n   },\r\n   getLastActivity: function(activities){\r\n      var copyActivities = JSON.parse(JSON.stringify(activities));\r\n      return copyActivities.sort(function(activityA, activityB){\r\n         return (activityA.finishDate < activityB.finishDate) ? 1 : -1;\r\n      })[0];\r\n   },\r\n\r\n   getClosedDatePlan: function(plan){\r\n      var self = this;\r\n      plan.closedDate =  self.getLastActivity(plan.activities).finishDate;\r\n      return plan.closedDate;\r\n   },\r\n\r\n   getDifferenceBetweenDates: function(firstDate, secondDate){\r\n      var self = this;\r\n      var defer = $.Deferred();\r\n      var params = {\r\n         idUser: bizagi.currentUser.idUser,\r\n         fromDate: firstDate,\r\n         toDate: secondDate\r\n\r\n      };\r\n      $.when(self.callGetEffectiveDuration(params)).done(function(difference){\r\n         defer.resolve(difference.minutes);\r\n      });\r\n      return defer.promise();\r\n   },\r\n\r\n   getIntervalOnMinutes: function(plan){\r\n      var self = this;\r\n      var defer = $.Deferred();\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate > Date.now()){\r\n               $.when(self.getDifferenceBetweenDates(Date.now(), plan.dueDate)).done(function(minutesNowToDueDate){\r\n                   $.when(self.getDifferenceBetweenDates(plan.creationDate, Date.now())).done(function(minutesCreateToNow){\r\n                       defer.resolve({minutesToShowTime: minutesNowToDueDate, minutesCreateToNow: minutesCreateToNow});\r\n                   });\r\n               });\r\n            }\r\n            else if(plan.dueDate < plan.creationDate){\r\n               $.when(self.getDifferenceBetweenDates(plan.dueDate,  plan.creationDate)).done(function(minutesDueDateToCreate){\r\n                   $.when(self.getDifferenceBetweenDates(plan.creationDate, Date.now())).done(function(minutesCreateToNow){\r\n                       defer.resolve({minutesToShowTime: minutesDueDateToCreate + minutesCreateToNow, minutesCreateToNow: minutesCreateToNow});\r\n                   });\r\n               });\r\n            }\r\n            else if(plan.dueDate > plan.creationDate){\r\n                $.when(self.getDifferenceBetweenDates(plan.creationDate, plan.dueDate)).done(function(minutesCreateToDueDate){\r\n                    $.when(self.getDifferenceBetweenDates(plan.dueDate, Date.now())).done(function(minutesCreateToNow){\r\n                        defer.resolve({minutesToShowTime: minutesCreateToDueDate + minutesCreateToNow, minutesCreateToNow: minutesCreateToNow});\r\n                    });\r\n                });\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n            if(plan.dueDate){\r\n               if(plan.dueDate > Date.now()){\r\n                  $.when(self.getDifferenceBetweenDates(Date.now(), plan.dueDate)).done(function(minutesNowToDueDate){\r\n                      $.when(self.getDifferenceBetweenDates(plan.startDate, Date.now())).done(function(minutesStartToNow){\r\n                          defer.resolve({minutesToShowTime: minutesNowToDueDate, minutesStartToNow: minutesStartToNow});\r\n                      });\r\n                  });\r\n               }\r\n               else{\r\n                  $.when(self.getDifferenceBetweenDates(plan.dueDate, Date.now())).done(function(minutesDueDateToNow){\r\n                      $.when(self.getDifferenceBetweenDates(plan.startDate, plan.dueDate)).done(function(minutesStartToDueDate){\r\n                          defer.resolve({minutesToShowTime: minutesDueDateToNow, minutesStartToDueDate: minutesStartToDueDate});\r\n                      });\r\n                  });\r\n               }\r\n\r\n            }\r\n            else{\r\n               $.when(self.getDifferenceBetweenDates(plan.startDate, Date.now())).done(function(minutes){\r\n                  defer.resolve({minutesToShowTime: minutes});\r\n               });\r\n            }\r\n            break;\r\n         case self.CLOSED_PLAN:\r\n            $.when(self.getDifferenceBetweenDates(plan.startDate, plan.closedDate)).done(function(minutes){\r\n               defer.resolve({minutesToShowTime: minutes});\r\n            });\r\n\r\n      }\r\n      return defer.promise();\r\n   },\r\n\r\n   getKeywordDifferenceDates: function(plan){\r\n      var self = this;\r\n      switch(plan.currentState){\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate > Date.now()){\r\n               return \"remaining\";\r\n            }\r\n            else {\r\n               return \"exceeded\";\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n            if(plan.dueDate){\r\n               if(plan.dueDate > Date.now()){\r\n                  return \"remaining\";\r\n               }\r\n               else{\r\n                  return \"exceeded\";\r\n               }\r\n\r\n            }\r\n            else{\r\n               return \"opened\";\r\n            }\r\n            break;\r\n         case self.CLOSED_PLAN:\r\n            return \"executed\";\r\n      }\r\n   },\r\n\r\n   getRelativeTime: function(milliseconds){\r\n      return bizagi.util.dateFormatter.getRelativeTime(milliseconds, null, false);\r\n   },\r\n\r\n   getWidthBar: function(plan, intervalMinutes){\r\n      var self = this,\r\n         differenceStartDateToCurrentDate = {};\r\n      switch(plan.currentState) {\r\n         case self.PENDING_PLAN:\r\n            if(plan.dueDate){\r\n               if(plan.dueDate < Date.now()){\r\n                  return 0;\r\n               }\r\n               else{\r\n                   var totalInterval = intervalMinutes.minutesCreateToNow + intervalMinutes.minutesToShowTime;\r\n                   valuePercentInterval = intervalMinutes.minutesToShowTime;\r\n                   return Math.ceil(valuePercentInterval * 100 / totalInterval);\r\n               }\r\n            }\r\n            else{\r\n               return 0;\r\n            }\r\n            break;\r\n         case self.EXECUTING_PLAN:\r\n            if(plan.dueDate) {\r\n               if (plan.dueDate > Date.now()) {\r\n                  var totalInterval = intervalMinutes.minutesStartToNow + intervalMinutes.minutesToShowTime;\r\n                  valuePercentInterval = intervalMinutes.minutesToShowTime;\r\n                  return Math.ceil(valuePercentInterval * 100 / totalInterval);\r\n               }\r\n               else{\r\n                  return 0;\r\n               }\r\n            }\r\n            else{\r\n               return 0;\r\n            }\r\n            break;\r\n         case self.CLOSED_PLAN:\r\n            if(plan.closedDate > Date.now()){\r\n               var differenceStartDateToClosedDate = plan.closedDate - plan.startDate;\r\n               differenceStartDateToCurrentDate = Date.now() - plan.startDate;\r\n               return Math.ceil(differenceStartDateToCurrentDate * 100 / differenceStartDateToClosedDate);\r\n            }\r\n            else{\r\n               return 100;\r\n            }\r\n      }\r\n\r\n\r\n   },\r\n\r\n   getColorBarByPercent: function(percent){\r\n      if(percent < 33){\r\n         return \"Red\";\r\n      }\r\n      else if(percent < 66){\r\n         return \"Yellow\";\r\n      }\r\n      else {\r\n         return \"Green\";\r\n      }\r\n   },\r\n\r\n   /**\r\n    * Call services\r\n    */\r\n\r\n   callGetEffectiveDuration: function(params){\r\n      var self = this;\r\n      var d = $.Deferred();\r\n\r\n      $.when(\r\n         self.dataService.getEffectiveDuration(params)\r\n      ).done(function (data) {\r\n            d.resolve(data);\r\n         });\r\n      return d.promise();\r\n   },\r\n\r\n   getFormattedDate: function (dateObj) {\r\n      var self = this;\r\n      var monthsNames = self.datePickerRegional.monthNames;\r\n      var shortMonth = dateObj.getMonth();\r\n      return monthsNames[shortMonth] + \" \" + bizagi.util.dateFormatter.formatDate(dateObj, \"dd hh:mm tt\", bizagi.localization.getResource(\"datePickerRegional\"));\r\n   }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.time\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.time], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Parent\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.parent\", {}, {\r\n\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"plan-parent-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.parent\").concat(\"#project-plan-parent\")\r\n        });\r\n    },\r\n\r\n    renderContent: function () {\r\n\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.sub(\"LOAD_INFO_SUMMARY_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n    },\r\n\r\n    /**\r\n     * Notifies when an event is raised\r\n     */\r\n    onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n        var self = this,\r\n        $content = self.getContent().empty();\r\n        self.params = $.extend(self.params, params.args);\r\n        if (self.params.plan.parentWorkItem) {\r\n            $.when(self.dataService.getPlanParent({ idPlan: self.params.plan.id })).done(function(planParent) {\r\n                self.params.plan.parent = planParent;\r\n\r\n                  if (self.params.plan.parent) {\r\n                    var argsTemplate = {\r\n                        idParent: self.params.plan.parent.radNumber,\r\n                        nameParent: self.params.plan.parent.displayName,\r\n                        idCase: self.params.plan.parent.idCase,\r\n                        idWorkflow: self.params.plan.parent.idWorkflow,\r\n                        idWorkItem: self.params.plan.parent.idWorkItem,\r\n                        idTask: self.params.plan.parent.idTask,\r\n                        processName: self.params.process ? self.params.process : self.params.plan.parent.planName\r\n                    };\r\n\r\n                    if(bizagi.util.isEmpty(self.params.plan.parent.guidActivity)){\r\n                        self.goToParentCase($content, argsTemplate);\r\n                    }else{\r\n                        var paramsDetailActivity = {\r\n                            idPlan: self.params.plan.id,\r\n                            idActivity: self.params.plan.parent.guidActivity \r\n                        };\r\n                        $.when(self.dataService.getActivity(paramsDetailActivity)).done(function (response) {\r\n                            self.params.plan.parent.allowEdition = response.allowEdition;\r\n                            self.goToParentCase($content, argsTemplate);\r\n                         });\r\n                    }\r\n                    \r\n                }\r\n            \r\n            }).fail(function(msg) {\r\n\r\n            });\r\n        }\r\n    },\r\n    goToParentCase: function(content, argsTemplate){\r\n        var self = this\r\n        //TODO: double call because routing dont release memory and widgets\r\n        //Test with a breakpoint\r\n        content.empty();\r\n\r\n        //Update widget\r\n        var contentTemplate = self.getTemplate(\"plan-parent-main\");\r\n        contentTemplate\r\n            .render(argsTemplate)\r\n            .appendTo(content);\r\n        $(\"#go-to-parent-case\", content).on(\"click\", $.proxy(self.onClickGoToParentCase, self));\r\n    },\r\n    onClickGoToParentCase: function (event) {\r\n        event.preventDefault();\r\n        var self = this;\r\n        self.routingExecute($(event.target).closest(\"#go-to-parent-case\"));\r\n    }\r\n});\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.parent\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.parent], true);","/*\r\n *   Name: Bizagi Workportal Desktop Project Plan Users\r\n *   Author: Elkin Fernando Siabato Cruz\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.project.plan.users\", {}, {\r\n\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        self.usersMap = {};\r\n        self.plugins = {};\r\n        self.usersInformation=[];\r\n        self.globalHandlersService = bizagi.injector.get('globalHandlersService');\r\n        self.usersAssignees = [];\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"plan-users-main\": bizagi.getTemplate(\"bizagi.workportal.desktop.project.plan.users\").concat(\"#project-plan-users\")\r\n        });\r\n\r\n        self.auxNoRepeatTypesUser = {};\r\n        self.hashTypesUser = {\r\n            \"assigned\": bizagi.localization.getResource(\"workportal-project-user-assigned\"),\r\n            \"owner\": bizagi.localization.getResource(\"workportal-project-user-owner\")\r\n        };\r\n    },\r\n\r\n    renderContent: function () {\r\n\r\n        var self = this;\r\n        self.content = $(\"<div></div>\");\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.sub(\"LOAD_INFO_ACTIVITIES_PLAN\", $.proxy(self.onNotifyLoadInfoSummaryPlan, self));\r\n    },\r\n\r\n    /**\r\n     * Notifies when an event is raised\r\n     */\r\n    onNotifyLoadInfoSummaryPlan: function (event, params) {\r\n        var self = this,\r\n            args = params.args,\r\n            cvsGuidUsers = [],\r\n            activitiesUsers = [],\r\n            $content = self.getContent().empty();\r\n            var ownerUserGuid = params.args.plan.idUserCreator;\r\n            var ownerUserId = params.args.plan.idUserCreator;\r\n        self.params = $.extend(self.params, params.args);\r\n\r\n        activitiesUsers.push({ \"idUser\": ownerUserId, 'userGuid': ownerUserGuid, \"userType\": [\"owner\"]});\r\n        self.usersMap[\"-\" + ownerUserId + \"-\"] = {\r\n            picture: \"\",\r\n            id: ownerUserId,\r\n            guid: ownerUserGuid,\r\n            name: \"\",\r\n            userType: [\"owner\"]\r\n        };\r\n        cvsGuidUsers.push(ownerUserId);\r\n        $.each(self.params.plan.activities, function (index, activity) {\r\n            var userId = activity.userAssigned;\r\n            var userGuid = activity.userAssignedGuid;\r\n            if(activity.isRunning == true){\r\n                if (userId === ownerUserId) {\r\n                    if($.inArray(\"Assigned\", activitiesUsers[0].userType) === -1){\r\n                        activitiesUsers[0].userType.push(\"Assigned\");\r\n                        self.usersMap[\"-\" + ownerUserId + \"-\"].userType.push(\"Assigned\");\r\n                    }\r\n                }\r\n                else {\r\n                    self.usersMap[\"-\" + userId + \"-\"] = {\r\n                        picture: \"\",\r\n                        id: userId,\r\n                        guid: userGuid,\r\n                        name: \"\",\r\n                        userType: [\"Assigned\"]\r\n                    };\r\n                    if (activitiesUsers.filter(function(user) { return user.idUser == userId; }).length === 0) {\r\n                        activitiesUsers.push({\"idUser\": userId, \"guidUser\": userGuid, \"userType\": [\"Assigned\"]});\r\n                        cvsGuidUsers.push(userId);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        self.activitiesUsers = activitiesUsers;\r\n        self.params = args;\r\n        //Update widget\r\n        var contentTemplate = self.getTemplate(\"plan-users-main\");\r\n        contentTemplate\r\n            .render({\r\n                assignee: self.justAssignees(activitiesUsers),\r\n                label: bizagi.localization.getResource(\"workportal-project-plan-assignee\")\r\n            })\r\n            .appendTo($content);\r\n        self.initilizeTooltip();\r\n        self.addEventHandlersModal();\r\n        $.when(self.callGetDataUsers(cvsGuidUsers)).then(function () {\r\n            self.showCreatorInformation(ownerUserId);\r\n            self.renderUserProfilesAndImages();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * return standar userAdapter information with only assigned users when the plan has started\r\n     * @param {Array} allUsers \r\n     */\r\n    justAssignees: function (allUsers) {\r\n        var self = this;\r\n        var usersAssignee=[];\r\n        if ([\"CLOSED\", \"PENDING\"].indexOf(self.params.plan.currentState)==-1) {\r\n            allUsers.map(function(user) {\r\n                var isOwner=user.userType.indexOf(\"owner\")!==-1;\r\n                var isAssignee=user.userType.indexOf(\"Assigned\")!==-1;\r\n                usersAssignee.push(usersAdapter.createJsonUserInfo(user.idUser, \"\", \"\", \"\", \"\", \"\", isAssignee, isOwner, [], []));\r\n            });\r\n        }\r\n        return usersAdapter.justAssignees(usersAssignee);\r\n    },\r\n\r\n    /**\r\n     * show the information of the creator case\r\n     * @param {string} ownerUserId guid user creator\r\n     */\r\n    showCreatorInformation: function (ownerUserId) {\r\n        var self = this;\r\n        var userCreator=self.usersInformation.find(function(user) {\r\n            return user.id==ownerUserId\r\n        });\r\n        var userInfo = usersAdapter.createJsonUserInfo(\r\n            userCreator.id,\r\n            userCreator.name,\r\n            userCreator.username,\r\n            userCreator.picture?\"data:image/png;base64,\"+userCreator.picture:undefined,\r\n            userCreator.email,\r\n            userCreator.name.getInitials(),\r\n            false,\r\n            true,\r\n            [],\r\n            []\r\n        );\r\n        self.content.find(\".ui-bizagi-wp-project-plan-users .ui-bizagi-wp-project-users-creator-info\").userinformation(self, { user: userInfo });\r\n    },\r\n\r\n    /**\r\n     * UI\r\n     */\r\n    renderUserProfilesAndImages: function () {\r\n        var self = this;\r\n        $.each(self.usersMap, function (i, obj) {\r\n            var $li = $(\".ui-bizagi-wp-userlist li[data-iduser=\" + obj.id + \"]\", self.content);\r\n\r\n            if (obj.picture !== \"\") {\r\n                $li.find(\"img\").prop(\"src\", obj.picture);\r\n                $(\".bz-wp-avatar-label\", $li).hide();\r\n            }\r\n            else {\r\n                if(obj.name!==undefined){\r\n                    $(\".bz-wp-avatar-img\", $li).hide();\r\n                    $(\".bz-wp-avatar-label\", $li).html(obj.name.getInitials());\r\n                }\r\n                else{\r\n                    console.log(\"obj.name is undefined\");\r\n                }\r\n\r\n            }\r\n        });\r\n    },\r\n\r\n    /*\r\n     *  Get data for users\r\n     */\r\n    callGetDataUsers: function (csvguidUsers) {\r\n        var self = this,\r\n            params = {},\r\n            defer = $.Deferred();\r\n        params = {\r\n            usersGuids: csvguidUsers.join(),\r\n            width: 50,\r\n            height: 50\r\n        };\r\n        $.when(self.dataService.getUsersData(params)).always(function (response) {            \r\n            self.usersInformation = response;\r\n            for (var i = 0, length = response.length; i < length; i += 1) {\r\n                if (typeof (response[i].name) === \"undefined\") {\r\n                    bizagi.log(response[i] + \" Id Not Found\", response, \"error\");\r\n                } else {\r\n                    if(self.usersMap[\"-\" + response[i].id + \"-\"]){\r\n                        self.usersMap[\"-\" + response[i].id + \"-\"].picture += (response[i].picture) ? \"data:image/png;base64,\" + response[i].picture : \"\";\r\n                        self.usersMap[\"-\" + response[i].id + \"-\"].name = response[i].name || \"\";\r\n                    }\r\n                    else{\r\n                        console.log(\"self.usersMap['-' + response[i].id + '-'] is undefined\")\r\n                    }\r\n\r\n                }\r\n            }\r\n            self.getUsersAssignees();\r\n            defer.resolve();\r\n        });\r\n        return defer.promise();\r\n    },\r\n    \r\n    /*\r\n    * validate if the activity is running\r\n    */\r\n    activityRuning: function (activity) {\r\n        return activity.startDate !== null;\r\n    },\r\n\r\n    getUsersAssignees: function(){\r\n        var self = this;\r\n        for(var i=0; i<self.usersInformation.length; i++){\r\n            var res_user=self.getUserAssignee(self.usersInformation[i]);\r\n            if (res_user!==false) {\r\n                self.usersAssignees.push(res_user);\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    getUserAssignee: function(user){\r\n        var self =  this;\r\n        var tasks = [];\r\n        $.each(self.params.plan.activities, function (index, activity) {\r\n            var userId = activity.userAssigned;\r\n            if (userId === user.id && self.activityRuning(activity)) {\r\n                tasks.push({ \"name\": activity.name });\r\n            }\r\n        });\r\n        if(tasks.length==0)return false;\r\n        user.tasks = tasks;\r\n        var types = self.activitiesUsers.find(function(actUser) {\r\n            return actUser.idUser == user.id;\r\n        });\r\n        user.types = types===undefined?[]:types.userType;\r\n        \r\n        var userAssignees = usersAdapter.createJsonUserInfo(\r\n            user.id, \r\n            user.name, \r\n            user.username, \r\n            user.picture ? \"data:image/png;base64,\" + user.picture : undefined, \r\n            user.email, \r\n            user.name.getInitials(),\r\n            user.types.indexOf(\"Assigned\") > -1, \r\n            user.types.indexOf(\"owner\") > -1, \r\n            user.tasks, \r\n            []);\r\n\r\n            return userAssignees;\r\n       },\r\n\r\n    /*\r\n     *  Tooltips\r\n     */\r\n    initilizeTooltip: function () {\r\n        var self = this;\r\n\r\n        $(\".ui-bizagi-wp-userlist > li\", self.content).not(\".moreUsers\").on('mouseenter', '', function (ev) {\r\n            var $target = $(ev.target);\r\n            var id_userSelected=$target.closest(\"[data-iduser]\").attr('data-iduser');\r\n            var user=self.usersInformation.find(function(user) {\r\n                return user.id==id_userSelected;\r\n            });\r\n            var activities=[];\r\n\r\n            if(user.tasks)\r\n                user.tasks.map(function(task) {\r\n                    activities.push(task.name);\r\n                });\r\n\r\n            var types = self.activitiesUsers.find(function(actUser) {\r\n                return actUser.idUser == id_userSelected;\r\n            });\r\n            user.types = types.userType;\r\n           \r\n            user.owner = user.types.find(function(type){\r\n                return type == \"owner\";\r\n            });\r\n            user.isAssignee = user.types.find(function(type){\r\n                return type == \"Assigned\";\r\n            });\r\n                \r\n            var userParam= usersAdapter.createJsonUserInfo(user.id, user.name, user.username, user.picture?\"data:image/png;base64,\"+user.picture:undefined, user.email,  user.name.getInitials(), user.isAssignee, user.owner, activities, []);\r\n            $target.parent().usertooltip(self, { target: $target, user: userParam });\r\n        });\r\n    },\r\n    addEventHandlersModal: function () {\r\n        var self =  this;\r\n        $(\".moreUsers\").click(function(event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            var usersAssignees = self.usersAssignees || [];\r\n            self.globalHandlersService.publish(\"showDialogWidget\", {\r\n                widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_USERS_MODAL,\r\n                closeVisible: true,\r\n                data: usersAssignees,\r\n                maximize: true,\r\n                modalParameters: {\r\n                    title: bizagi.localization.getResource(\"workportal-project-users-title\")+ \" (\"+usersAssignees.length+\")\",\r\n                    width: 790,\r\n                    height: 526,\r\n                    refreshInbox: false\r\n                }\r\n            });\r\n         });\r\n       }\r\n});\r\n\r\n\r\n\r\nbizagi.injector.register(\"bizagi.workportal.widgets.project.plan.users\", [\"workportalFacade\", \"dataService\", bizagi.workportal.widgets.project.plan.users], true);"]}