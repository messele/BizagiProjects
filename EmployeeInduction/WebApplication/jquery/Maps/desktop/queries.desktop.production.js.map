{"version":3,"sources":["jquery/workportal/js/base/widget/bizagi.workportal.widgets.queries.js","jquery/workportal/js/base/widget/bizagi.workportal.widgets.listCases.js","jquery/workportal/js/base/widget/bizagi.workportal.widgets.queryform.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.queries.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.queries.definition.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.queries.shortcut.js","jquery/workportal/js/desktop/widget/bizagi.workportal.desktop.widgets.queryform.js","jquery/workportal/desktop/widget/queries.management/bizagi.workportal.desktop.widgets.queries.management.js"],"names":["bizagi","workportal","widgets","widget","extend","getWidgetName","BIZAGI_WORKPORTAL_WIDGET_QUERIES","renderContent","self","this","template","getTemplate","content","$","tmpl","loadtemplates","BIZAGI_WORKPORTAL_WIDGET_LISTCASES","setTableHeadFixed","params","TableElement","floatThead","floatOptions","groupByCaseNumber","util","isIE","find","hide","listCases","BIZAGI_WORKPORTAL_WIDGET_QUERYFORM","parseBoolean","override","disableFrankensteinQueryForms","notMigratedUrl","modifiedRender","frankensteinRenderContent","url","idQueryForm","idStoredQuery","idCube","queryFormAction","dataService","getUrl","endPoint","lastQueryFullKey","queryFormURL","queries","init","workportalFacade","_super","loadTemplates","concat","queries-elements","queries-empty-elements","queries-query-tree","queries-query-confirm","useNewEngine","postRender","configureTreeNavigation","configureBackButton","renderQueries","scrollVertical","autohide","idParentQuery","appendElement","queryContent","mergeData","getContent","emptyTemplate","queriesContainer","when","getQueries","idElement","done","data","empty","length","undefined","merge","checkChildNode","appendTo","configureNavTree","confirm","click","children","val","queryId","prefix","nodesLength","id","queryDisplayName","headerTemplate","categoryTree","idParent","nodes","categoryWithLink","desktop","popup","closePopupInstance","title","showQueryFormPopup","idQuery","e","stopPropagation","parent","dialog","resizable","modal","getResource","buttons","text","ajax","destroy","btnBack","remove","nextAll","bizagiScrollbar","arg","currentPopup","publish","widgetName","modalParameters","queries-definition-elements","queries-definition-manage-elements","queries-flat-list","queries-query-message-error","mainTemplate","mainTemplateManage","flatListTemplate","confirmTemplate","messageErrorTemplate","showManageQueries","templateManage","isManageQueries","menuSecurity","QueriesPermissionManager","isEnableFeature","manageContent","addEventToMangeQueries","BIZAGI_WORKPORTAL_WIDGET_QUERIES_MANAGEMENT","maximize","closeVisible","localization","width","height","refreshInbox","validateMenu","getQueriesDefinitions","idNode","manage","tmplRendered","append","getStoredQueryFormList","storedQueryForm","storedQueryForms","stored","queryType","guidForm","renderStoredQueries","guidContext","guidEntity","confirmContent","confirmContentParams","notMigratedUrlDelete","container","paramsStoredQuery","guid","result","grep","definition","name","execute","edit","messageErrorForm","replace","loader","productBuildToAbout","cookie","messageError","get","deleteStoredQueryForm","idStoredQueryForm","maximizeOnly","editQueryForm","showPopUpEditQueryForm","executeQueryForm","showPopUpResultsQueryForm","response","getParamsStoredQuery","queries-shortcut","queries-shortcut-flat-list","queries-shortcut-query-confirm","queries-shortcut-query-message-error","handleEvents","shortcut","instance","show","queryFormShortcut","arrow","is","removeClass","addClass","closest","queryform","queryform-wrapper","queryform-container","queryform-buttons","queryform-graphic-analysis","queryform-result-set","queryform-search-result","queryform-pagination","queryform-admin-result","queryform-share-selection","queryform-select-user","queryform-select-group","queryform-save-as","queryform-message-error","referrerParams","referrer","Boolean","modifiedPostRender","frankensteinPostRender","graphicalAnalysisContainer","resultSet","searchResult","paginationTmpl","adminResult","selectUser","selectGroup","shareSelection","dialogSaveAs","maxElemShow","maxPageToShow","atLeastOneChecked","selectedItemsToShare","users","groups","readyToSave","includeAllUsers","saveAs","sortedField","storedQueryFormParameters","orderType","ASC","DESC","NONE","queryFormContextTypes","CASES","ENTITY","queryFormTypes","htmlMessage","html","entityGuid","queryFormType","type","renderQueryForm","showSaveResultsForm","previousValues","queryParams","parameters","JSON","parse","initialSearchParams","pageToShow","contextType","queryForm","findResults","actionSubmitQueryForm","actionForm","searchParams","numberOfRows","pageNumber","queryFormGuid","ownerQuery","owner","stringify","queryFormParams","h_action","h_contexttype","h_idForm","getQueryForm","queryFormElements","form","elements","actionExecute","values","h_idqueryform","renderContainer","renderingParams","canvas","startAndThen","then","rendering","facade","properties","validateRequireField","keyup","css","setXpathValuesToQueryForm","parentName","parentQueryForm","control","searchParameters","each","key","parameter","getRender","xpath","setValue","value","setDisplayValue","console","log","pageResultsData","I_PROCESSSTATE","h_idEnt","h_idQueryForm","enableButton","dialogContent","originalHeight","recalculateQueryForm","request","getSearchParams","submitQueryForm","onlyLocalResults","disableButton","tooltip","createStoredQueryForm","updateStoredQueryForm","fromExec","paramsStored","description","displayName","htmlGraphicalAnalysis","h_guidQueryForm","h_idStoredQuery","h_definition","delay","submit","iframe","dialogHeight","calculateHeight","on","sortParameter","sorted","newParameters","i","item","push","included","searchType","requestForSearch","refactorParameters","p_sessionId","getQueryFormExportExcel","button","size","attr","removeAttr","showMessageBox","loadingGetQueryForm","bizagiConfig","group","security","command","getQueryFormResponse","checkSecurityPerm","resultList","graphicQuery","timeline","enabledIcons","validateSecurityOptionIcons","totalRecords","records","totalPages","total","rows","showSearchResultFrame","fail","error","tmpTL","enableFeatureShowTimelineButton","radNumerIndex","findIndex","el","radNumber","forEach","row","header","dataType","splice","checkDisplayedNames","foundDisplayName","getRenderElementDisplayByXpath","searchParameter","storedQueryFormParameter","fullParameterXpath","displayXpath","storedDefinition","displayHeader","l","element","includePreference","render","elementXpath","fullEelementXpath","_formatValue","enableFormatMoneyColumnQueryResult","indexOf","formatValueByDataType","paginationHtml","resultTemplate","headers","securityGraphicQuery","GraphicQuery","getRadNumberColumnIndex","index","fieldName","showColumn","columnIndex","createGroupedHeader","rowIndex","getRadNumber","formatValue","isIEAndFirstRowAndGroupCases","pageToshow","summaryWrapper","pagerData","pagination","page","pages","permissions","canExportData","canAnalizeData","bizagiPagination","actualPage","listElement","clickCallBack","options","target","first","paramXpath","findSortedResults","currentTarget","action","actions","BIZAGI_WORKPORTAL_ACTION_ROUTING","idCase","getAttribute","idWorkItem","idTask","idWorkflow","bind","showGraphicQuery","caseNumber","showTimeLine","position","scrollContainer","applyFomatNumbers","elementsDataType","userLocalization","numberHeaders","formatInvariantNumber","clonedParams","buildStoredQueryFormParams","saveStoredQueryForm","has","getWidget","pipe","closeQueryForm","unique","alert","nameSaveAs","nameSave","trim","validateForm","next","initShareSelection","change","searchGroupToShare","shareSlection","tabs","test","prop","searchUserToShare","removeItem","addItem","searchSavedUser","filterData","userName","domain","fullName","searchUsers","filteredUsers","inArray","idUser","showDataToShare","shareType","searchUsersByID","addPrevious","searchProfiles","profileType","filteredGroups","groupsSelected","items","itemSelected","selectData","elementList","replaceWith","Option","auxUsers","toArray","arrayUserValues","userId","HTMLEncodeText","strText","strNew","cssList","injectCss","getStyle","load","iframeContent","contents","siblings","callBack","openBACase","sHref","workitem","workflow","substring","controller","routingAction","document","getElementById","lstCasesElement","bizagireference","lstIdCases","split","dialogStack","ShowCaseSumary","getCaseFormsRenderVersion","version","formsRenderVersion","BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME","widgetURL","serviceLocator","resources","afterLoad","afterLoadParams","genericIframe","callInside","jQuery","selectedUsers","queries-management","queries-management-loader","queries-management-table","setupSearchusersButton","loaderTmpl","fixedHeadTable","fixedHeadTableElement","zIndex","onResizeModalEvent","clean","parents","trigger","setupUsersSearchForm","input","user","def","Deferred","usersTable","userstable","userLinkLabel","parentDef","showBackButton","getApplicationCategoriesList","applicationList","allProcess","haveProcess","showHideClearIcon","showNotifier","message","window","injector","showSucessMessage","showLoading","endLoading","clearInput","display","guidUser","getManagementQueries","dataTable","map","renderTable","contentTable","validateUsers","resp","transferQueries","label","showConfirmationBox","dialogClass","minWidth","guidUserSource","guidUserTarget","register","management"],"mappings":"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","sourcesContent":["/*\r\n*   Name: BizAgi Workportal New Case Widget Controller\r\n*   Author: Edward Morales\r\n*   Comments:\r\n*   -   This script will define a base class to to define the new case widget\r\n*/\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.queries\", {}, {\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function(){  \r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERIES;\r\n    },\r\n    \r\n    /*\r\n    *   Renders the content for the current controller\r\n    *   Returns a deferred because it has to load the current user\r\n    */\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"queries\");\r\n        var content = self.content = $.tmpl(template);\r\n        self.loadtemplates();\r\n        return content;\r\n    },\r\n    /*\r\n     * this will be implemented on each device\r\n     */\r\n    loadtemplates: function () { }\r\n});\r\n","/*\r\n*   Name: BizAgi Desktop List Cases implementation\r\n*   Author: Kevin Alvarado\r\n*/\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.listCases\", {}, {\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_LISTCASES;\r\n    },\r\n    \r\n    /**\r\n    * Set the table with the fixed thead\r\n    * @param {Json} params TableElement,groupByCaseNumber,floatOptions\r\n    */\r\n    setTableHeadFixed:function(params) {\r\n        params.TableElement.floatThead(params.floatOptions);\r\n        \r\n        if(params.groupByCaseNumber && bizagi.util.isIE()){\r\n            params.TableElement.find(\"tbody > tr.ui-bizagi-wp-app-inbox-grouped-trtag-hide\").hide();\r\n        }\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Desktop Queries Dialog implementation\r\n*   Author: Juan Pablo Crossley\r\n*   Comments:\r\n*   -   ???\r\n*/\r\n\r\n// Extends itself\r\nbizagi.workportal.widgets.listCases.extend(\"bizagi.workportal.widgets.queryform\", {}, {\r\n    /*\r\n    *   Returns the widget name\r\n    */\r\n    getWidgetName: function () {\r\n        return bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM;\r\n    },\r\n\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        if (bizagi.util.parseBoolean(bizagi.override.disableFrankensteinQueryForms) && !self.params.notMigratedUrl) {\r\n            self.modifiedRender();\r\n        }\r\n        else {\r\n            self.frankensteinRenderContent();\r\n        }\r\n    },\r\n\r\n    modifiedRender: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"queryform-wrapper\");\r\n        var content;\r\n        content = self.content = $.tmpl(template, {});\r\n        self.loadtemplates();\r\n        return content;\r\n    },\r\n\r\n    /*\r\n    * this will be implemented on each device\r\n    */\r\n    loadtemplates: function () { },\r\n\r\n    /*\r\n    *   Renders the content for the current controller\r\n    *   Returns a deferred because it has to load the current user\r\n    */\r\n    frankensteinRenderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"queryform\");\r\n        var url = \"\";\r\n\r\n        var idQueryForm = self.params.idQueryForm || \"\";\r\n        var idStoredQuery = self.params.idStoredQuery || \"\";\r\n        var idCube = self.params.idCube || \"\";\r\n\r\n        // Define actions of queryform\r\n        switch (self.params.queryFormAction) {\r\n            case \"edit\":\r\n                url = self.dataService.getUrl({\r\n                    endPoint: \"query-form-edit\"\r\n                }) + \"?idStoredQuery=\" + idStoredQuery + \"&idQueryForm=\" + idQueryForm;\r\n                break;\r\n\r\n            case \"loadPrevious\":\r\n                url = \"App/ListaDetalle/listaitems.aspx?\" + self.dataService.lastQueryFullKey; //bizagi.referrerParams; //\r\n                break;\r\n            default:\r\n                url = self.dataService.getUrl({\r\n                    endPoint: \"query-form\"\r\n                }) + \"?idQueryForm=\" + idQueryForm;\r\n                // check children query\r\n                url = (idStoredQuery != \"\") ? url + \"&idStoredQuery=\" + idStoredQuery : url;\r\n                url = (idCube != \"\") ? url + \"&idCube=\" + idCube : url;\r\n                break;\r\n        }\r\n        if (self.params.notMigratedUrl) {\r\n            //url returned by the service with the operations and actions to execute\r\n            url = 'App/' + self.params.notMigratedUrl;\r\n        }\r\n\r\n        //gets the content template adapted to use an iframe\r\n        var content = self.content = $.tmpl(template,\r\n        {\r\n            queryFormURL: url\r\n        });\r\n\r\n        // Return content\r\n        return content;\r\n    }\r\n});\r\n","/*\r\n *   Name: BizAgi Workportal Desktop New Case Widget Controller\r\n *   Author: Juan Pablo Crossley\r\n *   Comments:\r\n *   -   This script will provide desktop overrides to implement the new case widget\r\n */\r\n\r\n// Auto extend\r\nbizagi.workportal.widgets.queries.extend(\"bizagi.workportal.widgets.queries\", {}, {\r\n\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"queries\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries\"),\r\n            \"queries-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-elements\"),\r\n            \"queries-empty-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-empty-elements\"),\r\n            \"queries-query-tree\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-query-tree\"),\r\n            \"queries-query-confirm\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-confirm\"),\r\n            useNewEngine: false\r\n        });\r\n    },\r\n\r\n    /**\r\n    *   To be overriden in each device to apply layouts\r\n    */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        // Set bind event for last element\r\n        self.configureTreeNavigation();\r\n\r\n        // Bind back button\r\n        self.configureBackButton();\r\n\r\n        // Render base categories\r\n        self.renderQueries();\r\n\r\n        // set vertical scroll\r\n        self.scrollVertical({\r\n            \"autohide\": false\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Render List categories for each idCategory\r\n    */\r\n    renderQueries: function (idParentQuery, appendElement) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var template = self.getTemplate(\"queries-elements\");\r\n        var emptyTemplate = self.getTemplate(\"queries-empty-elements\");\r\n        var queriesContainer = $(\"#queries\", content);\r\n        var queryContent;\r\n        var mergeData;\r\n\r\n        $.when(self.dataService.getQueries({\r\n            idElement: idParentQuery\r\n        })).done(function (data) {\r\n\r\n            queriesContainer.empty();\r\n\r\n            // check if service have nodes\r\n            data = data || {};\r\n\r\n            if (data.length >= 1) {\r\n                // Check if have appendElement\r\n                if (appendElement != undefined) {\r\n                    mergeData = $.merge(appendElement, data);\r\n                } else {\r\n                    mergeData = data;\r\n                }\r\n\r\n                queryContent = $.tmpl(template, mergeData, {\r\n                    checkChildNode: self.checkChildNode\r\n                });\r\n            } else {\r\n                queryContent = $.tmpl(emptyTemplate, mergeData);\r\n            }\r\n            queryContent.appendTo(queriesContainer);\r\n\r\n            // set actions to rendered html \r\n            self.configureNavTree(queriesContainer);\r\n        });\r\n    },\r\n\r\n\r\n    configureNavTree: function (queriesContainer) {\r\n        var self = this;\r\n        var confirm = self.getTemplate(\"queries-query-confirm\");\r\n\r\n        // Bind for list elements\r\n        $(\"li\", \"#queries\").click(function () {\r\n            var idCube = $(this).children(\"#idCube\").val();\r\n            var queryId = $(this).children(\"#queryId\").val();\r\n            var prefix = $(this).children(\"#prefix\").val();\r\n            var nodesLength = $(this).children(\"#nodesLength\").val();\r\n            var idStoredQuery = $(this).children(\"#idStoredQuery\").val();\r\n            var id = $(this).children(\"#id\").val();\r\n            var queryDisplayName = $(this).children(\"#queryDisplayName\").val();\r\n            var headerTemplate = self.getTemplate(\"queries-query-tree\");\r\n            var categoryTree = $(\"#categoryTree\");\r\n\r\n            // If the node is not a query node then render the children            \r\n            if (queryId == \"-1\") {\r\n                // Is category\r\n                // Append query header\r\n\r\n                $.tmpl(headerTemplate, {\r\n                    idParentQuery: id,\r\n                    queryDisplayName: queryDisplayName\r\n                }).appendTo(categoryTree);\r\n\r\n                // Set bind event for last element\r\n                self.configureTreeNavigation();\r\n\r\n                // Render sub-categories\r\n                self.renderQueries(id);\r\n            } else if (nodesLength > 0) {\r\n                // Is category with link\r\n\r\n                // Add element for tree navigation\r\n                $.tmpl(headerTemplate, {\r\n                    idParentQuery: id,\r\n                    queryDisplayName: queryDisplayName\r\n                }).appendTo(categoryTree);\r\n\r\n                // Set bind event for last element\r\n                self.configureTreeNavigation();\r\n\r\n                // Append this object to children\r\n                self.renderQueries(id,\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t    \"queryDisplayName\": queryDisplayName,\r\n\t\t\t\t\t    \"idStoredQuery\": idStoredQuery,\r\n\t\t\t\t\t    \"id\": id,\r\n\t\t\t\t\t    \"idParent\": '',\r\n\t\t\t\t\t    \"queryId\": queryId,\r\n\t\t\t\t\t    \"prefix\": prefix,\r\n\t\t\t\t\t    \"nodes\": [],\r\n\t\t\t\t\t    \"idCube\": $(this).data(\"idcube\"),\r\n\t\t\t\t\t    \"categoryWithLink\": \"true\"\r\n\t\t\t\t\t}]\r\n\t\t\t\t\t);\r\n            } else {\r\n                // Is Process\r\n                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                var title = this.data(\"queryDisplayName\");\r\n                self.showQueryFormPopup({\r\n                    \"idQuery\": queryId,\r\n                    \"idStoredQuery\": (idStoredQuery == \"-1\") ? \"\" : idStoredQuery,\r\n                    \"title\": title,\r\n                    \"idCube\": idCube\r\n                });\r\n            }\r\n        });\r\n\r\n\r\n        // Bind for action elements (Edit and delete buttons)\r\n        $(\".editButton\", \"#queries\").click(function (e) {\r\n            e.stopPropagation();\r\n\r\n            var queryId = \"-1\";\r\n            var idStoredQuery = $(this).parent().find(\"#idStoredQuery\").val();\r\n\r\n            self.showQueryFormPopup({\r\n                \"queryFormAction\": \"edit\",\r\n                \"idQuery\": queryId,\r\n                \"idStoredQuery\": (idStoredQuery == \"-1\") ? \"\" : idStoredQuery,\r\n                \"title\": $(\"#queryDisplayName\", $(this).parent()).val()\r\n            });\r\n            bizagi.workportal.desktop.popup.closePopupInstance();\r\n        });\r\n\r\n        $(\".deleteButton\", \"#queries\").click(function (e) {\r\n            e.stopPropagation();\r\n\r\n            var queryId = \"-1\";\r\n            var idStoredQuery = $(this).parent().find(\"#idStoredQuery\").val();\r\n            var prefix = $(this).parent().find(\"#prefix\").val();\r\n            var idCube = $(this).parent().find(\"#idCube\").val();\r\n            var content = $.tmpl(confirm);\r\n            var url;\r\n\r\n            if (prefix == \"prefix_MyStoredQuery\") {\r\n                url = self.dataService.getUrl({\r\n                    endPoint: \"query-form-delete\"\r\n                }) + \"?idStoredQueryDel=\" + idStoredQuery + \"&idQueryForm=\" + queryId;\r\n            } else if (prefix == \"prefix_Cube\") {\r\n                url = self.dataService.getUrl({\r\n                    endPoint: \"query-form-delete-cube\"\r\n                });\r\n            }\r\n\r\n            // Open dialog with confirm message\r\n            $(content).dialog({\r\n                resizable: true,\r\n                modal: true,\r\n                title: self.getResource(\"workportal-widget-queries-confirm-title\"),\r\n                buttons: [\r\n\t\t\t\t{\r\n\t\t\t\t    text: self.getResource(\"workportal-widget-queries-confirm-delete\"),\r\n\t\t\t\t    click: function () {\r\n\t\t\t\t        if (prefix == \"prefix_MyStoredQuery\") {\r\n\t\t\t\t            $.ajax({\r\n\t\t\t\t                url: url\r\n\t\t\t\t            });\r\n\t\t\t\t        } else if (prefix == \"prefix_Cube\") {\r\n\t\t\t\t            $.destroy(\r\n\t\t\t\t                url,\r\n\t\t\t\t                { idCube: idCube }\r\n                            );\r\n\t\t\t\t        }\r\n\r\n\t\t\t\t        $(this).dialog(\"close\");\r\n\t\t\t\t        bizagi.workportal.desktop.popup.closePopupInstance();\r\n\t\t\t\t    }\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t    text: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n\t\t\t\t    click: function () {\r\n\t\t\t\t        $(this).dialog(\"close\");\r\n\t\t\t\t    }\r\n\t\t\t\t}\r\n\t\t\t\t]\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n    *   Binds the back buttons so we can navigate back\r\n    */\r\n    configureBackButton: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var btnBack = $(\"#bt-back\", content);\r\n        var categoryTree = $(\"#categoryTree\", content);\r\n\r\n        // Bind click\r\n        btnBack.click(function () {\r\n            if ($(\"li\", categoryTree).length > 1) {\r\n                // Removes last child                    \r\n                $(\"li:last-child\", categoryTree).remove();\r\n                var idParentQuery = $(\"li:last-child\").children(\"#idParent\").val();\r\n\r\n                // Render Querie again\r\n                self.renderQueries(idParentQuery);\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Bind tree navigation\r\n    */\r\n    configureTreeNavigation: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var categoryTree = $(\"#categoryTree\", content);\r\n\r\n        // Bind header events\r\n        $(\"li:last-child\", categoryTree).click(function () {\r\n            // Remove all elements\r\n            $(this).nextAll().remove();\r\n            var idParent = $(this).children(\"#idParent\").val();\r\n            // Render query tree again\r\n            self.renderQueries(idParent);\r\n        });\r\n    },\r\n\r\n    scrollVertical: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        $(\"#queries\", content).bizagiScrollbar({\r\n            \"autohide\": false\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Show new case popup to create a case\r\n    */\r\n    showQueryFormPopup: function (arg) {\r\n        var self = this;\r\n\r\n        var idQuery = arg.idQuery || \"\";\r\n        var idStoredQuery = arg.idStoredQuery || \"\";\r\n        var queryFormAction = arg.queryFormAction || \"\";\r\n        var title = arg.title || \"\";\r\n        var idCube = arg.idCube || \"\";\r\n\r\n        // If the same popup is opened close it\r\n        if (self.currentPopup == \"queryform\") {\r\n            bizagi.workportal.desktop.popup.closePopupInstance();\r\n            return;\r\n        }\r\n\r\n        // Shows a popup widget\r\n        self.currentPopup = \"queryform\";\r\n        self.publish(\"showDialogWidget\", {\r\n            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,\r\n            idQueryForm: idQuery,\r\n            idStoredQuery: idStoredQuery,\r\n            queryFormAction: queryFormAction,\r\n            idCube: idCube,\r\n            modalParameters: {\r\n                title: title,\r\n                id: \"Queries\"\r\n            }\r\n        });\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Workportal Desktop New Case Widget Controller\r\n*   Author: Juan Pablo Crossley\r\n*   Comments:\r\n*   -   This script will provide desktop overrides to implement the new case widget\r\n*/\r\n\r\n// Auto extend\r\nbizagi.workportal.widgets.queries.extend(\"bizagi.workportal.widgets.queries.definition\", {}, {\r\n\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"queries\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries\"),\r\n            \"queries-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-elements\"),\r\n            \"queries-empty-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-empty-elements\"),\r\n            \"queries-query-tree\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-query-tree\"),\r\n            \"queries-query-confirm\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-confirm\"),\r\n\r\n            \"queries-definition-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-definition-elements\"),\r\n            \"queries-definition-manage-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-definition-manage-menu\"),\r\n            \"queries-flat-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-flat-list\"),\r\n            \"queries-query-message-error\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-message-error\"),\r\n\r\n            useNewEngine: false\r\n        });\r\n    },\r\n\r\n    /**\r\n    *   To be overriden in each device to apply layouts\r\n    */\r\n    loadtemplates: function () {\r\n        var self = this;\r\n        self.mainTemplate = self.getTemplate(\"queries-definition-elements\");\r\n        self.mainTemplateManage = self.getTemplate(\"queries-definition-manage-elements\");\r\n        self.emptyTemplate = self.getTemplate(\"queries-empty-elements\");\r\n        self.flatListTemplate = self.getTemplate(\"queries-flat-list\");\r\n        self.confirmTemplate = self.getTemplate(\"queries-query-confirm\");\r\n        self.messageErrorTemplate = self.getTemplate(\"queries-query-message-error\");\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        // Set bind event for last element\r\n        self.configureTreeNavigation(\"#queries\");\r\n        // Render base categories\r\n        self.renderQueries();\r\n        // set vertical scroll\r\n        self.scrollVertical({\r\n            \"autohide\": false\r\n        });\r\n    },\r\n\r\n    /**\r\n     * return the new button for manageQueries if the user has permission\r\n     */\r\n    showManageQueries: function () {\r\n        var self = this;\r\n        var templateManage = self.mainTemplateManage;\r\n        var content;\r\n        var isManageQueries = bizagi.menuSecurity.QueriesPermissionManager && bizagi.util.isEnableFeature(\"enableTransferQueryOwnership\");\r\n        if (isManageQueries) {\r\n            content = $.tmpl(templateManage, {});\r\n        }\r\n        return {\r\n            manageContent: content,\r\n            isManageQueries: isManageQueries\r\n        };\r\n    },\r\n\r\n    /**\r\n     * return the new button for manageQueries if the user has permission\r\n     */\r\n    addEventToMangeQueries: function (self) {\r\n        self.publish(\"showDialogWidget\", {\r\n            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERIES_MANAGEMENT,\r\n            data: {},\r\n            maximize: true,\r\n            closeVisible: false,\r\n            modalParameters: {\r\n                title: bizagi.localization.getResource(\"workportal-widget-queries-management-title\"),\r\n                width: 790,\r\n                height: 540,\r\n                refreshInbox: false\r\n            }\r\n        });\r\n    },\r\n    validateMenu: function (queryContent, idParentQuery) {\r\n        var enterToFolder = (queryContent == undefined || idParentQuery !== undefined) && idParentQuery !== \"-1\";\r\n        var leaveFolder = queryContent == undefined && idParentQuery === \"-1\";\r\n        return enterToFolder || leaveFolder;\r\n    },\r\n\r\n    /**\r\n    * Render List categories for each idCategory\r\n    */\r\n    renderQueries: function (idParentQuery, appendElement) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var template = self.mainTemplate;\r\n        var emptyTemplate = self.emptyTemplate;\r\n        var queriesContainer = $(\"#queries\", content);\r\n        var queryContent;\r\n        var mergeData;\r\n\r\n        $.when(self.dataService.getQueriesDefinitions({\r\n            idNode: idParentQuery\r\n        })).done(function (data) {\r\n\r\n            queriesContainer.empty();\r\n\r\n            // check if service have nodes\r\n            data = data || [];\r\n            var manage = self.showManageQueries();\r\n            queryContent = manage.manageContent;\r\n            if (data.length >= 1) {\r\n                // Check if have appendElement\r\n                if (appendElement !== undefined) {\r\n                    mergeData = $.merge(appendElement, data);\r\n                } else {\r\n                    mergeData = data;\r\n                }\r\n                var tmplRendered = $.tmpl(template, mergeData, {\r\n                    checkChildNode: self.checkChildNode\r\n                });\r\n                if (self.validateMenu(queryContent, idParentQuery)) {\r\n                    queryContent = tmplRendered;\r\n                } else {\r\n                    queryContent.append(tmplRendered);\r\n                }\r\n            }\r\n            if (!manage.isManageQueries && data.length == 0) {\r\n                queryContent = $.tmpl(emptyTemplate, mergeData);\r\n            }\r\n            //if ((typeof idParentQuery === \"undefined\" || idParentQuery === \"-1\") && bizagi.util.parseBoolean(bizagi.override.disableFrankensteinQueryForms)) {\r\n            if ((typeof idParentQuery === \"undefined\" || idParentQuery === \"-1\")) {\r\n                $.when(self.dataService.getStoredQueryFormList()).done(function (storedQueryForm) {\r\n                    queryContent.appendTo(queriesContainer);\r\n                    if (storedQueryForm.storedQueryForms.length > 0) {\r\n                        var stored = $.tmpl(template, {\r\n                            queryType: \"-2\",\r\n                            queryDisplayName: self.getResource(\"workportal-widget-queries-stored-query-forms\"),\r\n                            nodes: [],\r\n                            guidForm: \"stored\"\r\n                        });\r\n                        var allQueries = $.merge(queryContent, stored);\r\n\r\n                        allQueries.appendTo(queriesContainer);\r\n                        self.storedQueryForm = storedQueryForm.storedQueryForms;\r\n\r\n                    }\r\n                    self.configureNavTree(queriesContainer);\r\n                });\r\n            }\r\n\r\n            else {\r\n                queryContent.appendTo(queriesContainer);\r\n            }\r\n\r\n            // set actions to rendered html \r\n            self.configureNavTree(queriesContainer);\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Render List stored query Form\r\n    */\r\n    renderStoredQueries: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var flatListTemplate = self.flatListTemplate;\r\n        var queriesContainer = $(\"#queries\", content);\r\n        var storedQueryFormContent;\r\n        storedQueryFormContent = $.tmpl(flatListTemplate, { storedQueryForm: self.storedQueryForm });\r\n        storedQueryFormContent.appendTo(queriesContainer);\r\n    },\r\n\r\n    configureNavTree: function (queriesContainer) {\r\n        var self = this;\r\n        var confirm = self.getTemplate(\"queries-query-confirm\");\r\n\r\n        //Bind for manage queries\r\n        $(\"li#manageQueries\", \"#queries\").click(function () {\r\n            self.addEventToMangeQueries(self);\r\n        });\r\n\r\n        // Bind for list elements\r\n        $(\"li:not(#manageQueries)\", \"#queries\").click(function () {\r\n            var idNode = $(this).children(\"#idNode\").val();\r\n            var guidQueryForm = $(this).children(\"#guidQueryForm\").val();\r\n            var guidForm = $(this).children(\"#guidForm\").val();\r\n            var guidContext = $(this).children(\"#guidContext\").val();\r\n            var queryType = $(this).children(\"#queryType\").val();\r\n            var nodesLength = $(this).children(\"#nodesLength\").val();\r\n            var queryDisplayName = $(this).children(\"#queryDisplayName\").val();\r\n            var headerTemplate = self.getTemplate(\"queries-query-tree\");\r\n            var categoryTree = $(\"#categoryTree\");\r\n            var notMigratedUrl = $(this).children(\"#notMigratedUrl\").val();\r\n\r\n            if (queryType == \"-2\") {\r\n                self.renderStoredQueries();\r\n                $.tmpl(headerTemplate, {\r\n                    idParentQuery: \"-2\",\r\n                    queryDisplayName: queryDisplayName\r\n                }).appendTo(categoryTree);\r\n                self.configureTreeNavigation(\"#queries\");\r\n            }\r\n            else if (nodesLength > 0) {\r\n                // Is category with link\r\n                // Add element for tree navigation\r\n                $.tmpl(headerTemplate, {\r\n                    idParentQuery: idNode,\r\n                    queryDisplayName: queryDisplayName\r\n                }).appendTo(categoryTree);\r\n                // Set bind event for last element\r\n                self.configureTreeNavigation(\"#queries\");\r\n                self.renderQueries(idNode);\r\n            } else {\r\n                // Is Process\r\n                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                var title = $(\"#queryDisplayName\", this).val();\r\n                self.showQueryFormPopup({\r\n                    \"guidForm\": guidForm,\r\n                    \"guidEntity\": guidContext,\r\n                    \"title\": title,\r\n                    \"queryFormAction\": \"renderQueryForm\",\r\n                    \"queryType\": queryType,\r\n                    \"notMigratedUrl\": notMigratedUrl\r\n                });\r\n            }\r\n        });\r\n\r\n        $(\".deleteGAButton\").click(function (e) {\r\n            e.stopPropagation();\r\n            var confirmContent = $.tmpl(self.confirmTemplate);\r\n            var confirmContentParams = {\r\n                resizable: true,\r\n                modal: true,\r\n                title: self.getResource(\"workportal-widget-queries-confirm-title\"),\r\n                buttons: []\r\n            };\r\n            var notMigratedUrlDelete = $(\"#notMigratedUrlDelete\", $(this).parent()).val();\r\n\r\n            confirmContentParams.buttons = [\r\n                {\r\n                    text: self.getResource(\"workportal-widget-queries-confirm-delete\"),\r\n                    click: function () {\r\n                        $(this).dialog(\"close\");\r\n                        //checks if it should use the url based method to delete the query\r\n                        if (notMigratedUrlDelete) {\r\n                            $.destroy(notMigratedUrlDelete);\r\n                        }\r\n                        bizagi.workportal.desktop.popup.closePopupInstance();\r\n                    }\r\n                },\r\n                {\r\n                    text: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n                    click: function () {\r\n                        $(this).dialog(\"close\");\r\n                    }\r\n                }\r\n            ];\r\n            $(confirmContent).dialog(confirmContentParams);\r\n\r\n        });\r\n    },\r\n\r\n    /**\r\n    * Bind tree navigation\r\n    */\r\n    configureTreeNavigation: function (container) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var categoryTree = $(\"#categoryTree\", content);\r\n        var queriesContainer = $(container, content);\r\n        // Bind header events\r\n        $(\"li:last-child\", categoryTree).click(function () {\r\n            // Remove all elements\r\n            $(this).nextAll().remove();\r\n            var idParent = $(this).children(\"#idParent\").val();\r\n            // Render query tree again\r\n            if (idParent == \"-2\") {\r\n                self.renderStoredQueries();\r\n            } else {\r\n                self.renderQueries(idParent);\r\n            }\r\n        });\r\n\r\n        $(\"li.storedQuery\", queriesContainer).click(function () {\r\n            var guid = $(this).data(\"guid\");\r\n            var id = $(this).data(\"id\");\r\n            var idNode = $(this).data(\"idnode\");\r\n            var paramsStoredQuery;\r\n            var result = $.grep(self.storedQueryForm, function (e) {\r\n                return e.idNode == idNode;\r\n            });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery = result[0];\r\n\r\n                self.showQueryFormPopup({\r\n                    \"idStoredQuery\": guid,\r\n                    \"idQuery\": 1,\r\n                    \"title\": paramsStoredQuery.definition.name,\r\n                    \"paramsStoredQuery\": paramsStoredQuery,\r\n                    \"queryFormAction\": \"execute\",\r\n                    \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.execute : \"\"\r\n                });\r\n            }\r\n        });\r\n\r\n        // Bind for action elements (Edit and delete buttons)\r\n        $(\".editButton\", container).click(function (e) {\r\n            e.stopPropagation();\r\n            var queryId = \"-1\";\r\n            var guid = $(this).parent().data(\"guid\");\r\n            var idStoredQuery = $(this).parent().data(\"id\");\r\n            var idNode = $(this).parent().data(\"idnode\");\r\n            var paramsStoredQuery;\r\n            var result = $.grep(self.storedQueryForm, function (e) {\r\n                return e.idNode == idNode;\r\n            });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery = result[0];\r\n                self.showQueryFormPopup({\r\n                    \"queryFormAction\": \"edit\",\r\n                    \"idStoredQuery\": (idStoredQuery == \"-1\") ? \"\" : idStoredQuery,\r\n                    \"paramsStoredQuery\": paramsStoredQuery,\r\n                    \"title\": paramsStoredQuery.definition.name,\r\n                    \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.edit : \"\"\r\n                });\r\n                bizagi.workportal.desktop.popup.closePopupInstance();\r\n            }\r\n        });\r\n        $(\".deleteButton\", container).click(function (e) {\r\n            e.stopPropagation();\r\n            var queryId = \"-1\";\r\n            var guid = $(this).parent().data(\"guid\");\r\n            var idStoredQuery = $(this).parent().data(\"id\");\r\n            var idNode = $(this).parent().data(\"idnode\");\r\n            var confirmContent, paramsStoredQuery, confirmContentParams;\r\n\r\n            var messageErrorForm = self.getResource(\"workportal-widget-admin-entities-message-migrate\");\r\n            messageErrorForm = messageErrorForm.replace(\"{build}\", bizagi.loader.productBuildToAbout);\r\n\r\n            var result = $.grep(self.storedQueryForm, function (e) {\r\n                return e.idNode == idNode;\r\n            });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery = result[0];\r\n\r\n                confirmContentParams = {\r\n                    resizable: true,\r\n                    modal: true,\r\n                    title: self.getResource(\"workportal-widget-queries-confirm-title\"),\r\n                    buttons: []\r\n                };\r\n                var p_sessionId = bizagi.cookie(\"JSESSIONID\");\r\n                if (p_sessionId !== null && paramsStoredQuery.notMigratedUrl) {\r\n                    confirmContent = $.tmpl(self.messageErrorTemplate, { messageError: messageErrorForm });\r\n                }\r\n                else {\r\n                    confirmContent = $.tmpl(self.confirmTemplate);\r\n\r\n                    confirmContentParams.buttons = [\r\n                        {\r\n                            text: self.getResource(\"workportal-widget-queries-confirm-delete\"),\r\n                            click: function () {\r\n                                $(this).dialog(\"close\");\r\n                                //checks if it should use the url based method to delete the query\r\n                                if (paramsStoredQuery.notMigratedUrl && paramsStoredQuery.notMigratedUrl[\"delete\"]) {\r\n                                    $.get(\"App/\" + paramsStoredQuery.notMigratedUrl[\"delete\"]);\r\n                                } else {\r\n                                    self.dataService.deleteStoredQueryForm({ idStoredQueryForm: idStoredQuery });\r\n                                }\r\n                                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                                self.publish(\"refreshQueryFormShortCut\");\r\n                            }\r\n                        },\r\n                        {\r\n                            text: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n                            click: function () {\r\n                                $(this).dialog(\"close\");\r\n                            }\r\n                        }\r\n                    ];\r\n                }\r\n\r\n                // Open dialog with confirm message\r\n                $(confirmContent).dialog(confirmContentParams);\r\n            }\r\n        });\r\n    },\r\n\r\n    scrollVertical: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        $(\"#queries\", content).bizagiScrollbar({\r\n            \"autohide\": false\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Show new case popup to create a case\r\n    */\r\n    showQueryFormPopup: function (arg) {\r\n        var self = this;\r\n        var queryFormAction = arg.queryFormAction || \"\";\r\n        var title = arg.title || \"\";\r\n        var queryType = arg.queryType || \"\";\r\n        var guidForm = arg.guidForm || \"\";\r\n        var guidEntity = arg.guidEntity || \"\";\r\n        var paramsStoredQuery = arg.paramsStoredQuery || {};\r\n        // If the same popup is opened close it\r\n        if (self.currentPopup == \"queryform\") {\r\n            bizagi.workportal.desktop.popup.closePopupInstance();\r\n            return;\r\n        }\r\n        // Shows a popup widget\r\n        self.currentPopup = \"queryform\";\r\n        self.publish(\"showDialogWidget\", {\r\n            widgetName: bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM,\r\n            queryFormAction: queryFormAction,\r\n            queryType: queryType,\r\n            paramsStoredQuery: paramsStoredQuery,\r\n            modalParameters: {\r\n                title: title,\r\n                id: \"Queries\"\r\n            },\r\n            closeVisible: false,\r\n            guidForm: guidForm,\r\n            guidEntity: guidEntity,\r\n            notMigratedUrl: arg.notMigratedUrl || \"\",\r\n            maximizeOnly: true,\r\n            editQueryForm: function (params) {\r\n                self.currentPopup = undefined;\r\n                self.showPopUpEditQueryForm(params);\r\n\r\n            },\r\n            executeQueryForm: function (params) {\r\n                self.currentPopup = undefined;\r\n                self.showPopUpResultsQueryForm(params);\r\n            }\r\n        });\r\n    },\r\n\r\n    showPopUpEditQueryForm: function (params) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        $.when(self.dataService.getStoredQueryFormList()).done(function (storedQueryForm) {\r\n            self.storedQueryForm = storedQueryForm.storedQueryForms;\r\n            self.publish(\"refreshQueryFormShortCut\");\r\n            if (params && params.response) {\r\n                var idQueryForm = params.response;\r\n                self.editQueryForm(idQueryForm);\r\n            }\r\n        });\r\n    },\r\n\r\n    showPopUpResultsQueryForm: function (params) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n\r\n        $.when(self.dataService.getStoredQueryFormList()).done(function (storedQueryForm) {\r\n            self.storedQueryForm = storedQueryForm.storedQueryForms;\r\n            self.publish(\"refreshQueryFormShortCut\");\r\n            if (params && params.response) {\r\n                var idQueryForm = params.response;\r\n                self.executeQueryForm(idQueryForm);\r\n            }\r\n        });\r\n    },\r\n\r\n    editQueryForm: function (idQueryForm) {\r\n        var self = this;\r\n        var paramsStoredQuery = self.getParamsStoredQuery(idQueryForm);\r\n        if (paramsStoredQuery.length == 1) {\r\n            paramsStoredQuery = paramsStoredQuery[0];\r\n            self.showQueryFormPopup({\r\n                \"queryFormAction\": \"edit\",\r\n                \"idStoredQuery\": (idQueryForm == \"-1\") ? \"\" : idQueryForm,\r\n                \"paramsStoredQuery\": paramsStoredQuery,\r\n                \"title\": paramsStoredQuery.definition.name,\r\n                \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.edit : \"\"\r\n            });\r\n        }\r\n    },\r\n    executeQueryForm: function (idQueryForm) {\r\n        var self = this;\r\n        var paramsStoredQuery = self.getParamsStoredQuery(idQueryForm);\r\n        if (paramsStoredQuery.length == 1) {\r\n            paramsStoredQuery = paramsStoredQuery[0];\r\n            self.showQueryFormPopup({\r\n                \"idStoredQuery\": paramsStoredQuery.guid,\r\n                \"idQuery\": 1,\r\n                \"title\": paramsStoredQuery.definition.name,\r\n                \"paramsStoredQuery\": paramsStoredQuery,\r\n                \"queryFormAction\": \"execute\",\r\n                \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.execute : \"\"\r\n            });\r\n        }\r\n    },\r\n\r\n    getParamsStoredQuery: function (idQueryForm) {\r\n        var self = this;\r\n        return $.grep(self.storedQueryForm, function (e) {\r\n            return e.id == idQueryForm;\r\n        });\r\n    }\r\n});\r\n","/*\r\n *   Name: BizAgi Workportal Desktop stored queries shortcut\r\n *   Author: Iván Ricardo Taimal Narváez\r\n *   Comments:\r\n *   -   This script will provide behavior to stored queries shortcut\r\n */\r\n\r\n// Auto extend\r\nbizagi.workportal.widgets.queries.definition.extend(\"bizagi.workportal.widgets.queries.shortcut\", {}, {\r\n\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"queries\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries\"),\r\n            \"queries-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-elements\"),\r\n            \"queries-empty-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-empty-elements\"),\r\n            \"queries-query-tree\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-query-tree\"),\r\n            \"queries-query-confirm\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-confirm\"),\r\n\r\n            \"queries-definition-elements\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-definition-elements\"),\r\n            \"queries-flat-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-flat-list\"),\r\n            \"queries-query-message-error\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries\").concat(\"#ui-bizagi-workportal-widget-queries-message-error\"),\r\n\r\n            \"queries-shortcut\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries.shortcut\").concat(\"#ui-bizagi-workportal-widget-queries-shortcut\"),\r\n            \"queries-shortcut-flat-list\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries.shortcut\").concat(\"#ui-bizagi-workportal-widget-queries-flat-list-shortcut\"),\r\n            \"queries-shortcut-query-confirm\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries.shortcut\").concat(\"#ui-bizagi-workportal-widget-queries-confirm-shortcut\"),\r\n            \"queries-shortcut-query-message-error\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queries.shortcut\").concat(\"#ui-bizagi-workportal-widget-queries-message-error-shortcut\"),\r\n            useNewEngine: false\r\n        });\r\n    },\r\n\r\n    /**\r\n     *   To be overriden in each device to apply layouts\r\n     */\r\n    loadtemplates: function () {\r\n        var self = this;\r\n        self.flatListTemplate = self.getTemplate(\"queries-shortcut-flat-list\");\r\n        self.confirmTemplate = self.getTemplate(\"queries-shortcut-query-confirm\");\r\n        self.messageErrorTemplate = self.getTemplate(\"queries-shortcut-query-message-error\");\r\n    },\r\n    postRender: function () {\r\n        var self = this;\r\n        var template = self.getTemplate(\"queries-shortcut\");\r\n        var content = self.content = $.tmpl(template);\r\n        self.handleEvents();\r\n        bizagi.workportal.widgets.queries.shortcut.instance = this;\r\n    },\r\n\r\n    handleEvents: function() {\r\n        var self = this;\r\n        $(\"#queryFormShortcutContainer\").show();\r\n        $(\"#queryFormShortcutContainer\").click(function () {\r\n            var queryFormShortcut =  $(\"#queryFormShortcut\");\r\n            var arrow = $(this).find(\"span\");\r\n            var isHidden = (queryFormShortcut.is(\":hidden\")) ? true : false;\r\n            if (isHidden) {\r\n                queryFormShortcut.show();\r\n                arrow.removeClass(\"Right\");\r\n                arrow.addClass(\"Down\");\r\n                self.renderStoredQueries();\r\n            } else {\r\n                queryFormShortcut.hide();\r\n                arrow.removeClass(\"Down\");\r\n                arrow.addClass(\"Right\");\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Bind tree navigation\r\n     */\r\n    configureTreeNavigation: function () {\r\n        var self = this;\r\n        var categoryTree = $(\"#categoryTree\", self.content);\r\n        var queriesContainer = $(\"#queries-shortcut\", self.content);\r\n        $(\"li.storedQuery\",queriesContainer).click(function () {\r\n            var guid    =   $(this).data(\"guid\");\r\n            var id      =   $(this).data(\"id\");\r\n            var idNode =    $(this).data(\"idnode\");\r\n            var paramsStoredQuery;\r\n            var result  =  $.grep(self.storedQueryForm, function(e){ return e.idNode == idNode; });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery =   result[0];\r\n                self.showQueryFormPopup({\r\n                    \"idStoredQuery\": guid,\r\n                    \"idQuery\":1,\r\n                    \"title\": paramsStoredQuery.definition.name,\r\n                    \"paramsStoredQuery\":paramsStoredQuery,\r\n                    \"queryFormAction\":\"execute\",\r\n                    \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.execute : \"\"\r\n                });\r\n            }\r\n            self.currentPopup=undefined;\r\n           // self.renderQueries();\r\n        });\r\n\r\n        // Bind for action elements (Edit and delete buttons)\r\n        $(\".bz-icon-pencil-outline\", \"#queries-shortcut\").click(function (e) {\r\n            var queryId = \"-1\";\r\n            var guid = $(this).closest(\".storedQuery\").data(\"guid\");\r\n            var idStoredQuery = $(this).closest(\".storedQuery\").data(\"id\");\r\n            var idNode = $(this).closest(\".storedQuery\").data(\"idnode\");\r\n            var paramsStoredQuery;\r\n            var result = $.grep(self.storedQueryForm, function (e) {\r\n                return e.idNode == idNode;\r\n            });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery = result[0];\r\n                self.showQueryFormPopup({\r\n                    \"queryFormAction\": \"edit\",\r\n                    \"idStoredQuery\": (idStoredQuery == \"-1\") ? \"\" : idStoredQuery,\r\n                    \"paramsStoredQuery\": paramsStoredQuery,\r\n                    \"title\": paramsStoredQuery.definition.name,\r\n                    \"notMigratedUrl\": paramsStoredQuery.notMigratedUrl ? paramsStoredQuery.notMigratedUrl.edit : \"\"\r\n                });\r\n                bizagi.workportal.desktop.popup.closePopupInstance();\r\n            }\r\n        });\r\n\r\n        $(\".bz-icon-close\", \"#queries-shortcut .bz-shorcut__icons\").click(function (e) {\r\n            e.stopPropagation();\r\n            var queryId = \"-1\";\r\n            var guid = $(this).closest(\".storedQuery\").data(\"guid\");\r\n            var idStoredQuery = $(this).closest(\".storedQuery\").data(\"id\");\r\n            var idNode =   $(this).closest(\".storedQuery\").data(\"idnode\");\r\n            var confirmContent, paramsStoredQuery, confirmContentParams;\r\n\r\n            var messageErrorForm    = self.getResource(\"workportal-widget-admin-entities-message-migrate\");\r\n            messageErrorForm        = messageErrorForm.replace(\"{build}\", bizagi.loader.productBuildToAbout);\r\n\r\n            var result = $.grep(self.storedQueryForm, function (e) {\r\n                return e.idNode == idNode;\r\n            });\r\n            if (result.length == 1) {\r\n                paramsStoredQuery = result[0];\r\n\r\n                confirmContentParams ={\r\n                    resizable: true,\r\n                    modal: true,\r\n                    title: self.getResource(\"workportal-widget-queries-confirm-title\"),\r\n                    buttons: []\r\n                };\r\n\r\n                var p_sessionId = bizagi.cookie(\"JSESSIONID\");\r\n                if(p_sessionId!==null && paramsStoredQuery.notMigratedUrl){\r\n                    confirmContent = $.tmpl(self.messageErrorTemplate, { messageError: messageErrorForm });\r\n                }\r\n                else{\r\n                    confirmContent = $.tmpl(self.confirmTemplate);\r\n\r\n                    confirmContentParams.buttons = [\r\n                        {\r\n                            text: self.getResource(\"workportal-widget-queries-confirm-delete\"),\r\n                            click: function () {\r\n                                $(this).dialog(\"close\");\r\n                                if (paramsStoredQuery.notMigratedUrl && paramsStoredQuery.notMigratedUrl[\"delete\"]) {\r\n                                    $.get(\"App/\" + paramsStoredQuery.notMigratedUrl[\"delete\"]);\r\n                                }else{\r\n                                    $.when(self.dataService.deleteStoredQueryForm({idStoredQueryForm: idStoredQuery})).done(function () {\r\n                                        bizagi.workportal.desktop.popup.closePopupInstance();\r\n                                        self.renderStoredQueries();\r\n                                    });\r\n                                }\r\n                                self.renderStoredQueries();\r\n                                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                            }\r\n                        },\r\n                        {\r\n                            text: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n                            click: function () {\r\n                                $(this).dialog(\"close\");\r\n                            }\r\n                        }\r\n                    ];\r\n                }\r\n\r\n                // Open dialog with confirm message\r\n                $(confirmContent).dialog(confirmContentParams);\r\n            }\r\n        });\r\n    },\r\n    renderStoredQueries: function(params) {\r\n        var self = this;\r\n        var flatListTemplate = self.flatListTemplate;\r\n        var queriesContainer = $(\"#queries-shortcut\", self.content);\r\n        var storedQueryFormContent;\r\n        $.when(self.dataService.getStoredQueryFormList()).done(function (storedQueryForm) {\r\n            self.storedQueryForm = storedQueryForm.storedQueryForms;\r\n            storedQueryFormContent = $.tmpl(flatListTemplate, {storedQueryForm: self.storedQueryForm});\r\n            storedQueryFormContent.appendTo(queriesContainer);\r\n            self.configureTreeNavigation();\r\n            if(self.storedQueryForm.length <= 0){\r\n                $(\"#queryFormShortcutContainer\").hide()\r\n            }else{\r\n                $(\"#queryFormShortcutContainer\").show()\r\n            }\r\n        });\r\n    }\r\n\r\n});","/*\r\n*   Name: BizAgi Desktop Queries Dialog implementation\r\n*   Author: Juan Pablo Crossley\r\n*   Modifications:\r\n*   modifiedPostRender\r\n*   -    Paola Herrera\r\n*   -    Andres Fernando Muñoz\r\n*   -    Iván Ricardo Taimal\r\n*\r\n*  added checkDisplayedNames, getRenderElementDisplayByXpath\r\n*  -    Carlos I Mercado\r\n*/\r\n\r\n// Extends itself\r\nbizagi.workportal.widgets.queryform.extend(\"bizagi.workportal.widgets.queryform\", {}, {\r\n\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load templates\r\n        self.loadTemplates({\r\n            \"queryform\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-frankenstein-queryform-wrapper\"),\r\n            \"queryform-wrapper\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-wrapper\"),\r\n            \"queryform-container\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-container\"),\r\n            \"queryform-buttons\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-buttons\"),\r\n            \"queryform-graphic-analysis\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-graphic-analysis\"),\r\n            \"queryform-result-set\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-result-set\"),\r\n            \"queryform-search-result\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-search-result\"),\r\n            \"queryform-pagination\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-pagination\"),\r\n            \"queryform-admin-result\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-admin-result\"),\r\n            \"queryform-share-selection\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-share-selection\"),\r\n            \"queryform-select-user\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-select-user\"),\r\n            \"queryform-select-group\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-select-group\"),\r\n            \"queryform-save-as\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform-save-as\"),\r\n            \"queryform-message-error\": bizagi.getTemplate(\"bizagi.workportal.desktop.widget.queryform\").concat(\"#ui-bizagi-workportal-widget-queryform--message-error\"),\r\n            useNewEngine: false\r\n        });\r\n\r\n        if(!bizagi.referrerParams)\r\n            bizagi.referrerParams = {};\r\n        bizagi.referrerParams.referrer = bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_QUERYFORM;\r\n    },\r\n    /*\r\n     *   To be overriden in each device to apply layouts\r\n     */\r\n    postRender: function () {\r\n        var self = this;\r\n\r\n        if (self.params.notMigratedUrl == \"true\") {\r\n            self.params.notMigratedUrl = Boolean(self.params.notMigratedUrl);\r\n        }\r\n\r\n        //if (bizagi.util.parseBoolean(bizagi.override.disableFrankensteinQueryForms) == true && (self.params.notMigratedUrl == \"\" || self.params.notMigratedUrl == true)) {\r\n        if ((self.params.notMigratedUrl == \"\" || self.params.notMigratedUrl == true)) {\r\n            self.modifiedPostRender();\r\n        }\r\n        else {\r\n            self.frankensteinPostRender();\r\n        }\r\n    },\r\n\r\n    loadtemplates: function () {\r\n        var self = this;\r\n        self.container = self.getTemplate(\"queryform-container\");\r\n        self.buttons = self.getTemplate(\"queryform-buttons\");\r\n        self.graphicalAnalysisContainer = self.getTemplate(\"queryform-graphic-analysis\");\r\n        self.resultSet = self.getTemplate(\"queryform-result-set\");\r\n        self.searchResult = self.getTemplate(\"queryform-search-result\");\r\n        self.paginationTmpl = self.getTemplate(\"queryform-pagination\");\r\n        self.adminResult = self.getTemplate(\"queryform-admin-result\");\r\n        self.selectUser = self.getTemplate(\"queryform-select-user\");\r\n        self.selectGroup = self.getTemplate(\"queryform-select-group\");\r\n        self.shareSelection = self.getTemplate(\"queryform-share-selection\");\r\n        self.dialogSaveAs = self.getTemplate(\"queryform-save-as\");\r\n    },\r\n\r\n    /*\r\n     *  New Query Forms implementation\r\n     */\r\n    modifiedPostRender: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        self.maxElemShow = 10;\r\n        self.maxPageToShow = 5;\r\n        self.atLeastOneChecked = false;\r\n        self.selectedItemsToShare = {\r\n            users: [],\r\n            groups: []\r\n        };\r\n        self.readyToSave = false;\r\n        self.includeAllUsers = false;\r\n        self.saveAs = false;\r\n        self.sortedField = {};\r\n        self.storedQueryFormParameters = {};\r\n        self.dialogSaveAs = $.tmpl(self.dialogSaveAs);\r\n        self.orderType = {\r\n            ASC: \"ASC\",\r\n            DESC: \"DESC\",\r\n            NONE: \"NONE\"\r\n        };\r\n        self.queryFormContextTypes = {\r\n            CASES: \"metadata\",\r\n            ENTITY: \"entity\"\r\n        };\r\n        self.queryFormTypes = {\r\n            CASES: \"CASES\",\r\n            ENTITY: \"ENTITIES\"\r\n        };\r\n\r\n        if (self.params.notMigratedUrl == true || self.params.paramsStoredQuery.notMigratedUrl == true) {\r\n            var messageErrorForm = self.getResource(\"workportal-widget-admin-entities-message-migrate\");\r\n            messageErrorForm = messageErrorForm.replace(\"{build}\", bizagi.loader.productBuildToAbout);\r\n            var htmlMessage = $.tmpl(self.getTemplate(\"queryform-message-error\"), { messageError: messageErrorForm });\r\n            $(content).html(htmlMessage);\r\n            return false;\r\n        }\r\n\r\n        var actionEdit = function () {\r\n            self.guidEntity = self.params.paramsStoredQuery.definition.entityGuid;\r\n            self.guidForm = self.params.paramsStoredQuery.guid;\r\n            self.queryFormType = self.params.paramsStoredQuery.definition.type;\r\n            self.idQueryForm = self.params.paramsStoredQuery.id;\r\n            self.renderQueryForm();\r\n            self.showSaveResultsForm();\r\n            self.previousValues(self.params.paramsStoredQuery);\r\n        }\r\n\r\n        var actionRenderQueryForm = function () {\r\n            self.guidForm = self.params.guidForm;\r\n            self.guidEntity = self.params.guidEntity;\r\n            if (self.params.queryType == 1) {\r\n                self.queryFormType = self.queryFormTypes.CASES;\r\n            } else if (self.params.queryType == 2) {\r\n                self.queryFormType = self.queryFormTypes.ENTITY;\r\n            }\r\n            self.renderQueryForm();\r\n        }\r\n\r\n        var actionSubmitQueryForm = function () {\r\n            if (typeof (self.params.queryParams.parameters) == \"string\") {\r\n                self.params.queryParams.parameters = JSON.parse(self.params.queryParams.parameters);\r\n            }\r\n            self.initialSearchParams = self.params.queryParams;\r\n            var pageToShow = self.params.pageToShow || 1;\r\n            //builds the params\r\n\r\n            self.contextType = self.params.widget.contextType;\r\n            self.guidForm = self.params.widget.guidForm;\r\n            self.guidEntity = self.params.widget.guidEntity;\r\n            self.queryForm = self.params.queryForm;\r\n\r\n            if (self.params.queryType == 1) {\r\n                self.queryFormType = self.queryFormTypes.CASES;\r\n            } else if (self.params.queryType == 2) {\r\n                self.queryFormType = self.queryFormTypes.ENTITY;\r\n            }\r\n\r\n            self.handleEvents();\r\n            self.findResults(self.getContent(), self.params.queryParams, pageToShow);\r\n\r\n            $(\"#copy-as-new-stored-queryform\", content).hide();\r\n            $(\"#update-stored-queryform\", content).hide();\r\n            $('#edit-stored-queryform', content).hide();\r\n        }\r\n\r\n        var actionExecute = function () {\r\n            //Store data in order to initialize a query form from a render widget            \r\n            bizagi.referrerParams.queryForm = {\r\n                actionForm: \"execute\",\r\n                data: self.params\r\n            };\r\n\r\n            self.guidEntity = self.params.paramsStoredQuery.definition.entityGuid;\r\n            self.guidForm = self.params.paramsStoredQuery.guid;\r\n            self.queryFormType = self.params.paramsStoredQuery.definition.type;\r\n            self.includeAllUsers = self.params.paramsStoredQuery.definition.includeAllUsers;\r\n            self.idQueryForm = self.params.paramsStoredQuery.id\r\n            var searchParams = {\r\n                \"numberOfRows\": 10,\r\n                \"pageNumber\": 1,\r\n                \"queryFormGuid\": self.params.paramsStoredQuery.guid,\r\n                \"entityGuid\": self.params.paramsStoredQuery.definition.entityGuid,\r\n                \"type\": self.params.paramsStoredQuery.definition.type,\r\n                \"parameters\": self.params.paramsStoredQuery.definition.parameters,\r\n                \"ownerQuery\": self.params.paramsStoredQuery.owner,\r\n                \"includeAllUsers\": self.params.paramsStoredQuery.definition.includeAllUsers\r\n            };\r\n            self.handleEvents();\r\n            self.initialSearchParams = JSON.parse(JSON.stringify(searchParams));\r\n\r\n            //parses the type\r\n            if (self.queryFormType == self.queryFormTypes.CASES) {\r\n                self.contextType = self.queryFormContextTypes.CASES;\r\n            } else if (self.queryFormType == self.queryFormTypes.ENTITY) {\r\n                self.contextType = self.queryFormContextTypes.ENTITY;\r\n            }\r\n            //builds the params\r\n            var queryFormParams = {\r\n                h_action: \"QUERYFORM\",\r\n                h_contexttype: self.contextType,\r\n                h_idForm: self.guidForm\r\n            };\r\n            $(\"#query-form-buttons\", content).hide();\r\n\r\n            //request to queryForm definition service\r\n            self.dataService.getQueryForm(queryFormParams).done(function (data) {\r\n\r\n                //stores the elements to check their values later\r\n                self.queryFormElements = data.form.elements;\r\n\r\n                //find the results directly, no need to enter any value\r\n                self.findResults(content, searchParams);\r\n            });\r\n\r\n            $(\"#copy-as-new-stored-queryform\", content).hide();\r\n            $(\"#update-stored-queryform\", content).hide();\r\n            $('#edit-stored-queryform', content).show();\r\n        }\r\n\r\n        switch (self.params.queryFormAction) {\r\n            case \"edit\":\r\n                actionEdit();\r\n                break;\r\n\r\n            case \"renderQueryForm\":\r\n                actionRenderQueryForm();\r\n                break;\r\n\r\n            case \"submitQueryForm\":\r\n            case \"graphicalAnalysis\":\r\n                actionSubmitQueryForm();\r\n                break;\r\n\r\n            case \"execute\":\r\n                actionExecute();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    },\r\n\r\n\r\n    /*\r\n    *  Render queryForm\r\n    * */\r\n    renderQueryForm: function (values) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        if (self.queryFormType == self.queryFormTypes.CASES) {\r\n            self.contextType = self.queryFormContextTypes.CASES;\r\n        } else if (self.queryFormType == self.queryFormTypes.ENTITY) {\r\n            self.contextType = self.queryFormContextTypes.ENTITY;\r\n        }\r\n        var queryFormParams = {\r\n            h_action: \"QUERYFORM\",\r\n            h_contexttype: self.contextType,\r\n            h_idForm: self.guidForm\r\n        };\r\n        if (self.idQueryForm && self.idQueryForm != \"\") {\r\n            queryFormParams.h_idqueryform = self.idQueryForm;\r\n        }\r\n\r\n        var renderContainer = $.tmpl(self.container);\r\n        //request to queryForm definition service\r\n        self.dataService.getQueryForm(queryFormParams).done(function (data) {\r\n            var renderingParams = { canvas: renderContainer,\r\n                data: data,\r\n                type: \"queryForm\" };\r\n\r\n            //stores the elements to validate them later\r\n            self.queryFormElements = data.form.elements;\r\n\r\n            bizagi.loader.startAndThen(\"rendering\").then(function () {\r\n                var rendering = new bizagi.rendering.facade();\r\n                rendering.execute(renderingParams).done(function () {\r\n                    self.queryForm = rendering.form;\r\n                    // bizagi.referrerParams.queryform.queryform = rendering.form;\r\n\r\n\r\n                    if (self.queryForm.properties && typeof (self.queryForm.properties.includeAllUsers) != \"undefined\") {\r\n                        self.includeAllUsers = self.queryForm.properties.includeAllUsers;\r\n                    }\r\n                    $(\"#query-form\", content).html(renderContainer);\r\n                    //To validate if the input contains a value and depends on that show or hide the div that indicates the required field\r\n                    self.validateRequireField();\r\n                    $(\"#queryFormName\", content).keyup(function () {\r\n                        self.validateRequireField();\r\n                    });\r\n\r\n                    self.handleEvents();\r\n                    $(\"#query-form\", content).show();\r\n                    $(\"#query-form-result\", content).hide();\r\n                    $(\"#mainButtons\", content).css(\"width\", \"100%\");\r\n                    $(\"#exportExcel\", content).hide();\r\n                    $(\"#graphicalAnalysis\", content).hide();\r\n                    $(\"#back-to-queryform\", content).hide();\r\n                    $(\"#save-queryform\", content).hide();\r\n\r\n                    if (values) {\r\n                        self.setXpathValuesToQueryForm(self.queryForm, values);\r\n                        $(\"#query-form-admin-result\", content).hide();\r\n                        $(\"#copy-as-new-stored-queryform\", content).hide();\r\n                        $(\"#update-stored-queryform\", content).hide();\r\n                        $('#edit-stored-queryform', content).hide();\r\n                    }\r\n\r\n                    if (self.params.queryFormAction == 'renderQueryForm') {\r\n\r\n                        $(\"#query-form-admin-result\", content).hide();\r\n                        $(\"#copy-as-new-stored-queryform\", content).hide();\r\n                        $(\"#update-stored-queryform\", content).hide();\r\n                        $('#edit-stored-queryform', content).hide();\r\n                    }\r\n                    else if (self.params.queryFormAction == 'edit') {\r\n                        var parentName = self.params.paramsStoredQuery.definition.parentQueryForm || self.params.paramsStoredQuery.definition.name;\r\n                        $(\"#queryFormFieldsContainerName span\", content).html(parentName);\r\n                        $(\"#queryFormFieldsContainer\", content).html(renderContainer);\r\n                        $(\"#submit-for-search\", content).hide();\r\n                        $(\"#clear-queryform\", content).hide();\r\n                        $(\"#copy-as-new-stored-queryform\", content).show();\r\n                        $(\"#update-stored-queryform\", content).show();\r\n                        $('#edit-stored-queryform', content).hide();\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    },\r\n\r\n    setXpathValuesToQueryForm: function (form, values) {\r\n        values = values || {};\r\n        var control;\r\n        //decode parameters\r\n\r\n        try {\r\n            var searchParameters = (typeof values.parameters == \"string\") ? JSON.parse(values.parameters) : values.parameters;\r\n            $.each(searchParameters, function (key, parameter) {\r\n                control = form.getRender(parameter.xpath);\r\n                control.setValue(parameter.value);\r\n                control.setDisplayValue(parameter.value);\r\n            });\r\n        } catch (e) {\r\n            console.log(\"Error:\", e);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *  Buttons for query Form actions\r\n    */\r\n    handleEvents: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var pageResultsData = {};\r\n\r\n        // PARAMS TO EXPORT EXCEL\r\n        pageResultsData.I_PROCESSSTATE = \"ALL\";\r\n        pageResultsData.h_idEnt = 10001;\r\n        pageResultsData.h_idQueryForm = self.idQueryForm;\r\n\r\n        $(\"#query-form-buttons\", content).html($.tmpl(self.buttons, pageResultsData));\r\n        $(\"#back-to-queryform\", content).click(function () {\r\n            if (self.params.queryFormAction == 'execute') {\r\n                self.renderQueryForm();\r\n            } else {\r\n                $(\"#iframeGraphicalAnalysis\", content).hide();\r\n                $(\"#query-form-admin-result\", content).hide();\r\n                if (self.params.queryFormAction == 'saveQueryForm') {\r\n                    self.params.queryFormAction = 'renderQueryForm';\r\n                    $(\"#query-form-result\", content).show();\r\n                    $(\"#back-to-queryform\", content).show();\r\n                    $(\"#save-queryform\", content).show();\r\n                    $(\"#exportExcel\", content).show();\r\n                    $(\"#graphicalAnalysis\", content).show();\r\n                } else {\r\n                    self.sortedField = {};\r\n                    $(\"#query-form-result\", content).hide();\r\n                    $(\"#query-form\", content).show();\r\n                    self.enableButton($(\"#submit-for-search\", self.getContent()));\r\n\r\n                    var dialog = $(this).closest(\".ui-dialog\");\r\n                    var dialogContent = dialog.length ? dialog.find(\".ui-dialog-content\") : [];\r\n\r\n                    if (dialog.height() === dialogContent.height()) {\r\n                        dialogContent.height(440);\r\n                    }\r\n\r\n                    if (self.originalHeight) {\r\n                        content.parent().height(self.originalHeight);\r\n                    }\r\n\r\n                    $(\"#back-to-queryform\", content).hide();\r\n                    $(\"#submit-for-search\", content).show();\r\n                    $(\"#clear-queryform\", content).show();\r\n                    $(\"#save-queryform\", content).hide();\r\n                    $(\"#exportExcel\", content).hide();\r\n                    $(\"#graphicalAnalysis\", content).hide();\r\n\r\n                    if (self.params.queryFormAction == 'submitQueryForm' && self.params.widget && self.params.recalculateQueryForm) {\r\n                        // get query form and show\r\n                        self.params.widget.searchParams = self.params.widget.searchParams || {};\r\n                        self.renderQueryForm(self.params.widget.searchParams);\r\n                    } else if (self.params.queryFormAction == 'graphicalAnalysis') {\r\n                        self.params.queryFormAction = 'submitQueryForm';\r\n                        var request = {\r\n                            \"queryFormGuid\": self.guidForm,\r\n                            \"numberOfRows\": 10,\r\n                            \"pageNumber\": 1,\r\n                            \"entityGuid\": self.guidEntity,\r\n                            \"type\": self.queryFormType,\r\n                            \"includeAllUsers\": self.includeAllUsers,\r\n                            \"parameters\": []\r\n                        };\r\n                        var searchParams = self.queryForm.getSearchParams(request);\r\n                        self.submitQueryForm(searchParams);\r\n                    }\r\n                }\r\n            }\r\n            self.readyToSave = false;\r\n        });\r\n        $(\"#clear-queryform\", content).click(function () {\r\n            self.params.queryFormAction = 'renderQueryForm';\r\n            self.renderQueryForm();\r\n        });\r\n        $(\"#submit-for-search\", content).click(function () {\r\n            //collects data in a structure to search Cases Data or Entity Data\r\n            self.params.queryFormAction = 'submitQueryForm';\r\n            var request = {\r\n                \"queryFormGuid\": self.guidForm,\r\n                \"numberOfRows\": 10,\r\n                \"pageNumber\": 1,\r\n                \"entityGuid\": self.guidEntity,\r\n                \"type\": self.queryFormType,\r\n                \"includeAllUsers\": self.includeAllUsers,\r\n                \"parameters\": [],\r\n                \"onlyLocalResults\": true\r\n            };\r\n            var searchParams = self.queryForm.getSearchParams(request);\r\n            if (searchParams !== null) {\r\n                self.disableButton($(this));\r\n                self.submitQueryForm(searchParams);\r\n            }\r\n        });\r\n        $(\".ui-bizagi-render-control-included\", content).tooltip({ content: bizagi.localization.getResource(\"workportal-widget-query-form-included-tooltip\") });\r\n\r\n        $(\"#save-queryform\", content).click(function () {\r\n            if (self.readyToSave) {\r\n                self.createStoredQueryForm();\r\n            } else {\r\n                self.showSaveResultsForm();\r\n            }\r\n            self.params.queryFormAction = 'saveQueryForm';\r\n            $(\"#exportExcel\", content).hide();\r\n            $(\"#graphicalAnalysis\", content).hide();\r\n            $(\"#mainButtons\", content).css(\"width\", \"100%\");\r\n        });\r\n\r\n        $(\"#copy-as-new-stored-queryform\", content).click(function () {\r\n            // Open dialog with confirm message\r\n            self.saveAs = true;\r\n            $(self.dialogSaveAs).dialog({\r\n                resizable: true,\r\n                modal: true,\r\n                title: self.getResource(\"workportal-widget-query-form-copy-as-new\"),\r\n                buttons: [\r\n                    {\r\n                        text: self.getResource(\"workportal-general-button-label-ok\"),\r\n                        click: function () {\r\n                            if (self.createStoredQueryForm()) {\r\n                                $(this).dialog(\"destroy\");\r\n                                bizagi.workportal.desktop.popup.closePopupInstance();\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        text: self.getResource(\"workportal-widget-queries-confirm-cancel\"),\r\n                        click: function () {\r\n                            self.saveAs = false;\r\n                            $(this).dialog(\"destroy\");\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n        });\r\n\r\n        $(\"#update-stored-queryform\", content).click(function () {\r\n            self.updateStoredQueryForm();\r\n        });\r\n\r\n        $(\"#edit-stored-queryform\", content).click(function () {\r\n            self.publish(\"closeCurrentDialog\");\r\n            self.params.editQueryForm({ response: self.params.paramsStoredQuery.id,\r\n                fromExec: true });\r\n        });\r\n\r\n        $(\".biz-wp-form-queryForm-graphicalAnalysisLink\", content).click(function () {\r\n            self.params.queryFormAction = \"graphicalAnalysis\";\r\n            if (typeof (self.searchParams.parameters) == \"string\") {\r\n                self.searchParams.parameters = JSON.parse(self.searchParams.parameters);\r\n            }\r\n            var paramsStored;\r\n            if (self.params.paramsStoredQuery.definition) {\r\n                paramsStored = JSON.stringify(self.params.paramsStoredQuery.definition);\r\n            } else {\r\n                paramsStored = JSON.stringify({\r\n                    name: \"name\",\r\n                    description: \"desc\",\r\n                    parameters: self.searchParams.parameters,\r\n                    type: self.queryFormType,\r\n                    entityGuid: self.guidEntity,\r\n                    includeAllUsers: self.includeAllUsers,\r\n                    parentQueryForm: self.queryForm.properties.displayName\r\n                });\r\n            }\r\n            var guidForm = self.params.paramsStoredQuery.id ? self.params.paramsStoredQuery.guid : self.params.guidForm;\r\n            var htmlGraphicalAnalysis = $.tmpl(self.graphicalAnalysisContainer, { h_guidQueryForm: guidForm,\r\n                h_idStoredQuery: self.params.paramsStoredQuery.id,\r\n                h_definition: paramsStored });\r\n            $(\"#query-form-result\", content).html(htmlGraphicalAnalysis);\r\n            $(\"#exportExcel\", content).hide();\r\n            $(\"#graphicalAnalysis\", content).hide();\r\n            $(\"#mainButtons\", content).show();\r\n            $(\"#mainButtons\", content).css(\"width\", \"99%\");\r\n            $(\"#save-queryform\", content).hide();\r\n            self.originalHeight = content.parent().height();\r\n            content.parent().height(\"auto\");\r\n            $(\"#formGraphicalAnalysis\").delay(800).submit();\r\n\r\n            // adjust iframe height\r\n            var iframe = $(\"#iframeGraphicalAnalysis\");\r\n            var dialog = iframe.length ? iframe.closest(\".ui-dialog\") : [];\r\n            var dialogHeight = dialog.length ? dialog.height() : 0;\r\n            if (dialogHeight > 550) {\r\n                iframe.height(dialogHeight - 100);\r\n            }\r\n\r\n            dialog.on(\"dialogmaximize\", calculateHeight);\r\n            dialog.on(\"dialogunmaximize\", calculateHeight);\r\n\r\n            function calculateHeight() {\r\n                var iframe = $(\"#iframeGraphicalAnalysis\");\r\n                var dialog = $(this);\r\n                var dialogHeight = dialog.length ? dialog.height() : 0;\r\n                if (dialogHeight > 550) {\r\n                    iframe.height(dialogHeight - 100);\r\n                } else {\r\n                    iframe.height(400);\r\n                    dialog.find(\".ui-dialog-content\").height(\"auto\");\r\n                }\r\n            }\r\n        });\r\n\r\n        $(\".biz-wp-form-queryForm-exportExcelLink\", content).click(function () {\r\n            var request = {\r\n                \"entityGuid\": self.guidEntity,\r\n                \"type\": self.queryFormType,\r\n                \"includeAllUsers\": self.includeAllUsers,\r\n                \"parameters\": []\r\n            };\r\n\r\n            var sortParameter = self.sortedField.xpath;\r\n            var orderType = self.sortedField.orderType;\r\n            var sorted = false;\r\n\r\n            var newParameters = JSON.parse(JSON.stringify(self.initialSearchParams.parameters));\r\n            newParameters = $.type(newParameters) === \"array\" ? newParameters : JSON.parse(newParameters);\r\n            if (newParameters.length > 0 && typeof sortParameter != \"undefined\") {\r\n                $.each(newParameters, function (i, item) {\r\n                    var itemXpath = item.xpath;\r\n                    if (itemXpath == sortParameter) {\r\n                        item.orderType = orderType;\r\n                        sorted = true;\r\n                    }\r\n                });\r\n            }\r\n            if (!sorted && sortParameter != \"\" && typeof sortParameter != \"undefined\") {\r\n                newParameters.push({\r\n                    \"value\": null,\r\n                    \"included\": true,\r\n                    \"xpath\": sortParameter,\r\n                    \"searchType\": \"NONE\",\r\n                    \"orderType\": orderType\r\n                });\r\n            }\r\n            request.parameters = newParameters;\r\n\r\n            var requestForSearch = self.refactorParameters(request);\r\n            var p_sessionId = bizagi.cookie(\"JSESSIONID\");\r\n            if (p_sessionId != null) {\r\n                requestForSearch.p_sessionId = p_sessionId;\r\n            }\r\n            self.dataService.getQueryFormExportExcel(requestForSearch).done(function () { });\r\n        });\r\n    },\r\n\r\n    disableButton: function (button) {\r\n        var self = this, content = self.getContent();\r\n        var included = $(\".ui-bizagi-render-control-included:checked\", content).size();\r\n        var atLeastOneChecked = (included > 0);\r\n        if ((self.queryFormType == self.queryFormTypes.ENTITY && self.atLeastOneChecked) || self.queryFormType == self.queryFormTypes.CASES) {\r\n            button.attr(\"disabled\", true).addClass(\"ui-button-disabled\");\r\n        }\r\n    },\r\n\r\n    enableButton: function (button) {\r\n        button.removeAttr(\"disabled\").removeClass(\"ui-button-disabled\");\r\n    },\r\n\r\n    /*\r\n     * Validation before submit\r\n     */\r\n    submitQueryForm: function (searchParams) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var included = $(\".ui-bizagi-render-control-included:checked\", content).size();\r\n        self.atLeastOneChecked = (included > 0);\r\n        if (searchParams !== null) {\r\n            if ((self.queryFormType == self.queryFormTypes.ENTITY && self.atLeastOneChecked) || self.queryFormType == self.queryFormTypes.CASES) {\r\n                self.initialSearchParams = JSON.parse(JSON.stringify(searchParams));\r\n                self.findResults(content, searchParams);\r\n            }\r\n            else {\r\n                bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-query-form-at-least-one-checked\"), \"Bizagi\", \"warning\");\r\n                self.enableButton($(\"#submit-for-search\", self.getContent()));\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n     * Find cases for App query Form\r\n     */\r\n    findResults: function (content, params, pageToShow) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var loadingGetQueryForm = $(\".js-mini-loading\", content);\r\n\r\n        //Store data in order to initialize a query form from a render widget\r\n        if (pageToShow) {\r\n            self.params.pageToShow = pageToShow;\r\n        }\r\n        // Override the query params\r\n        self.params.queryParams = params;\r\n\r\n        bizagi.referrerParams.queryForm = {\r\n            actionForm: self.params.queryFormAction,\r\n            data: self.params,\r\n            queryParams: params,\r\n            pageToShow: pageToShow,\r\n            queryForm: self.queryForm\r\n        };\r\n\r\n\r\n        self.searchParams = JSON.parse(JSON.stringify(params));\r\n        params = self.refactorParameters(params);\r\n        params.pageNumber = pageToShow ? pageToShow : 1;\r\n        if (bizagiConfig.groupByCaseNumber) {\r\n            params.group = \"T_RADNUMBER\";\r\n        }\r\n\r\n        loadingGetQueryForm.show();\r\n        var security = new bizagi.workportal.command.security(self.dataService);\r\n        $.when(\r\n            self.dataService.getQueryFormResponse(params),\r\n            security.checkSecurityPerm(\"GraphicQuery\"),\r\n            security.checkSecurityPerm(\"TimeLine\")\r\n        ).done(function (resultList, graphicQuery, timeline) {\r\n            // Mapping Response into result object\r\n            resultList = resultList[0];\r\n\r\n            loadingGetQueryForm.hide();\r\n\r\n            var enabledIcons = self.validateSecurityOptionIcons(resultList, graphicQuery, timeline);\r\n\r\n            //clean old results\r\n            $(\".biz-wp-table\").remove();\r\n            $(\"#biz-wp-table-summary-wrapper\").remove();\r\n\r\n            //Keep in track the total Records\r\n            self.totalRecords = resultList.records;\r\n\r\n            //keep in track the total pages\r\n            self.totalPages = resultList.total;\r\n\r\n            if (resultList.rows.length > 0) {\r\n                self.showSearchResultFrame(content, resultList, params, enabledIcons);\r\n                $(\"#query-form-buttons\", content).show();\r\n            } else {\r\n                bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-query-form-no-records-found\"), \"Bizagi\", \"warning\");\r\n                self.enableButton($(\"#submit-for-search\", self.getContent()));\r\n                if (self.params.queryFormAction === \"execute\") {\r\n                    self.params.queryFormAction = \"edit\";\r\n                    self.modifiedPostRender();\r\n                }\r\n            }\r\n        }).fail(function (error) {\r\n            loadingGetQueryForm.hide();\r\n            bizagi.log(error);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Validate if show or not graphic query icon.\r\n     * @param resultList\r\n     */\r\n    // validateSecurityGraphicQuery: function (resultList){\r\n    validateSecurityOptionIcons: function (resultList, graphicQuery, timeline) {\r\n        var tmpTL = bizagi.override.enableFeatureShowTimelineButton && timeline;\r\n        var radNumerIndex = -1;\r\n\r\n        if (!graphicQuery && !tmpTL) {\r\n            if (resultList.header && resultList.header.length && resultList.header[resultList.header.length - 1].dataType === 0) {\r\n                resultList.header.splice(-1, 1); //Remove last item\r\n                resultList.rows.forEach(function (row) {\r\n                    row.splice(-1, 1);\r\n                });\r\n            }\r\n        } else {\r\n            if (tmpTL && resultList.rows.length > 0) {\r\n                radNumerIndex = resultList.rows[0].findIndex(function (el) {\r\n                    if (el && typeof el === \"object\" && el.radNumber) {\r\n                        return true;\r\n                    }\r\n                    return false\r\n                });\r\n                if (radNumerIndex > -1) {\r\n                    resultList.rows.forEach(function (row) {\r\n                        if (row[row.length - 1] != null)\r\n                            row[row.length - 1]['radNumber'] = row[radNumerIndex]['radNumber']\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            graphicQuery: graphicQuery,\r\n            timeline: tmpTL\r\n        };\r\n    },\r\n\r\n    /*\r\n    * Checks that all the header displayed names are the same shown in the form\r\n    */\r\n    checkDisplayedNames: function (resultList) {\r\n        var self = this;\r\n        if (typeof (self.initialSearchParams.parameters) == \"string\") {\r\n            self.initialSearchParams.parameters = JSON.parse(self.initialSearchParams.parameters);\r\n        }\r\n        if (typeof (self.searchParams.parameters) == \"string\") {\r\n            self.searchParams.parameters = JSON.parse(self.searchParams.parameters);\r\n        }\r\n        //goes for each item and checks them one by one\r\n        $.each(resultList.header, function (i, header) {\r\n\r\n            //cheks if display name, it should get the display name from the form values\r\n            if (header.xpath) {\r\n                var foundDisplayName = self.getRenderElementDisplayByXpath(header.xpath, self.queryFormElements);\r\n                //if it founds it, it sets the displayName\r\n                if (foundDisplayName) {\r\n                    if (self.initialSearchParams && self.initialSearchParams.parameters) {\r\n                        for (var i = 0; i < self.initialSearchParams.parameters.length; i++) {\r\n                            var searchParameter = self.initialSearchParams.parameters[i];\r\n                            var storedQueryFormParameter = self.searchParams.parameters[i];\r\n                            var fullParameterXpath = searchParameter.xpath + \".\" + searchParameter.displayXpath;\r\n                            var storedDefinition = {};\r\n                            if (self.params.paramsStoredQuery.definition) {\r\n                                storedDefinition = self.params.paramsStoredQuery.definition.parameters[i];\r\n                            }\r\n\r\n                            if (searchParameter.xpath === header.xpath || fullParameterXpath === header.xpath) {\r\n                                storedQueryFormParameter.displayHeader = foundDisplayName;\r\n                                searchParameter.displayHeader = foundDisplayName;\r\n                                storedDefinition.displayHeader = foundDisplayName;\r\n                                self.searchParams.parameters[i].displayName = foundDisplayName;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    header.displayName = foundDisplayName;\r\n                }\r\n            }\r\n        });\r\n\r\n        return resultList;\r\n    },\r\n    /*\r\n     *Gets the display name that the xpath provided should show in the results\r\n     */\r\n    getRenderElementDisplayByXpath: function (xpath, elements) {\r\n        var self = this;\r\n        if (elements && elements.length > 0) {\r\n            for (var i = 0, l = elements.length; i < l; i++) {\r\n                var element = elements[i];\r\n                if (typeof (element.render) !== 'undefined') {\r\n                    var includePreference = typeof (element.render.properties.included) === 'undefined' || element.render.properties.included;\r\n                    var elementXpath = element.render.properties.xpath;\r\n                    var fullEelementXpath = element.render.properties.xpath + \".\" + element.render.properties.displayXpath;\r\n\r\n                    if (includePreference && (elementXpath === xpath || fullEelementXpath === xpath)) {\r\n                        return element.render.properties.displayName\r\n                    }\r\n                } else if (typeof (element.container) !== 'undefined') {\r\n                    var result = self.getRenderElementDisplayByXpath(xpath, element.container.elements);\r\n                    if (result != undefined)\r\n                        return result;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    refactorParameters: function (params) {\r\n        var parameters = [];\r\n        if (typeof (params.parameters) == \"string\") {\r\n            params.parameters = JSON.parse(params.parameters);\r\n        }\r\n        $.each(params.parameters, function (i, item) {\r\n            if (item.value != null && typeof (item.value) == \"object\" && item.value[0] && typeof (item.value[0].id) != \"undefined\") {\r\n                item.value = item.value[0].id;\r\n            }\r\n            parameters.push(item);\r\n        });\r\n        params.parameters = JSON.stringify(parameters);\r\n        return params;\r\n    },\r\n\r\n    /**\r\n     * format value depend of the type\r\n     * @param {string} value \r\n     * @param {number | string} dataType \r\n     */\r\n    _formatValue: function (value, dataType) {\r\n        if(bizagi.override.enableFormatMoneyColumnQueryResult === true || [8, \"Money\"].indexOf(dataType) === -1  || value === null)\r\n            value = bizagi.util.formatValueByDataType(value, dataType);\r\n        return value;\r\n    },\r\n    /*\r\n    * Show search result frames\r\n    */\r\n    showSearchResultFrame: function (content, resultList, params, enabledIcons) {\r\n        var self = this;\r\n        self.queryFormElements = self.queryFormElements ? self.queryFormElements : bizagi.referrerParams.queryForm.queryForm.params.data.elements;\r\n\r\n        if(bizagi.referrerParams && bizagi.referrerParams.queryForm && bizagi.referrerParams.queryForm.queryForm\r\n            && bizagi.referrerParams.queryForm.queryForm.params && bizagi.referrerParams.queryForm.queryForm.params.data){\r\n            bizagi.referrerParams.queryForm.queryForm.params.data.elements = self.queryFormElements;\r\n        }\r\n\r\n        //goes for the result list and checks that the displayed names in the grid match with the rendered form\r\n        resultList = self.checkDisplayedNames(resultList);\r\n        var resultTemplate = $.tmpl(\r\n            self.searchResult,\r\n            {\r\n                headers: resultList.header,\r\n                rows: resultList.rows,\r\n                sortedField: self.sortedField.xpath ? self.sortedField : null,\r\n                records: resultList.records,\r\n                groupByCaseNumber: bizagiConfig.groupByCaseNumber,\r\n                securityGraphicQuery: bizagi.menuSecurity.GraphicQuery,\r\n                resultList: resultList,\r\n                enabledIcons: enabledIcons\r\n            },\r\n            {\r\n                getRadNumberColumnIndex: function () {\r\n                    var data = this.data;\r\n                    var index = -1;\r\n                    for (var i = 0, l = data.headers.length; i < l; i++) {\r\n                        if (data.headers[i].fieldName == \"radnumber\") {\r\n                            index = i;\r\n                        }\r\n                    }\r\n                    return index;\r\n                },\r\n                showColumn: function (columnIndex) {\r\n                    var index = this.getRadNumberColumnIndex();\r\n                    return (this.data.groupByCaseNumber && index == columnIndex) ? ' hidden ' : \"\";\r\n                },\r\n                createGroupedHeader: function (rowIndex) {\r\n                    var data = this.data.resultList;\r\n                    var result = false;\r\n                    var radNumber = this.getRadNumber(data.rows[rowIndex]);\r\n                    if (this.data.groupByCaseNumber) {\r\n                        if (rowIndex == 0 && radNumber != \"\") {\r\n                            result = true;\r\n                        } else {\r\n                            var previousRadNumber = this.getRadNumber(data.rows[rowIndex - 1]);\r\n                            if (radNumber != previousRadNumber && radNumber != \"\") {\r\n                                result = true;\r\n                            }\r\n                        }\r\n                    }\r\n                    return result;\r\n                },\r\n                getRadNumber: function (row) {\r\n                    var index = this.getRadNumberColumnIndex();\r\n                    return (index >= 0) ? row[index].radNumber : \"\";\r\n                },\r\n                formatValue: self._formatValue,\r\n                /**\r\n                 * validate if in the first row and group by cases and if is IE necesary for bug QAF-1883 fixed head table\r\n                 * @param {Int} rowIndex row index item of case\r\n                 */\r\n                isIEAndFirstRowAndGroupCases: function (rowIndex) {\r\n                    return rowIndex == 0 && this.data.groupByCaseNumber && bizagi.util.isIE();\r\n                }\r\n            }\r\n        );\r\n\r\n        var pageToshow = (self.maxPageToShow > self.totalPages) ? self.totalPages : self.maxPageToShow;\r\n        var summaryWrapper = $(\"#biz-wp-table-pager-wrapper\", resultTemplate);\r\n        var pagerData = {};\r\n        var paginationHtml;\r\n\r\n        // show or hide \"load more\" button\r\n        pagerData.pagination = (self.totalPages > 1) ? true : false;\r\n        pagerData.page = resultList.page;\r\n        pagerData.pages = {};\r\n\r\n        for (var i = 1; i <= pageToshow; i++) {\r\n            pagerData.pages[i] = {\r\n                \"pageNumber\": i\r\n            };\r\n        }\r\n\r\n        //load and append the paginator to the result table\r\n        paginationHtml = $.tmpl(self.paginationTmpl, pagerData).html();\r\n        summaryWrapper.append(paginationHtml);\r\n\r\n        $(\"#submit-for-search\", content).hide();\r\n        $(\"#clear-queryform\", content).hide();\r\n        $(\"#save-queryform\", content).show();\r\n\r\n        //checks if user has permissions to see the export button\r\n        if (resultList.permissions && resultList.permissions.canExportData) {\r\n            $(\"#exportExcel\", content).show();\r\n        }\r\n\r\n        $(\"#mainButtons\", content).css(\"width\", \"100%\");\r\n        $(\"#query-form\", content).hide();\r\n        $(\"#query-form-result\", content).show();\r\n        $(\"#query-form-result\", content).html(resultTemplate);\r\n        $(\"#back-to-queryform\", content).show();\r\n\r\n        //checks if user has permissions to see the graphical button\r\n        if (resultList.permissions && resultList.permissions.canAnalizeData) {\r\n            $(\"#graphicalAnalysis\", content).show();\r\n        }\r\n        else {\r\n            $(\"#graphicalAnalysis\", content).remove();\r\n        }\r\n\r\n        if (self.params.queryFormAction == \"execute\") {\r\n            $(\"#back-to-queryform\", content).hide();\r\n            $(\"#save-queryform\", content).hide();\r\n        }\r\n\r\n        if (params.ownerQuery == false) {\r\n            $(\"#edit-stored-queryform\", content).hide();\r\n        }\r\n\r\n        //add data and behaviour to pager\r\n        $(\"ul\").bizagiPagination({\r\n            maxElemShow: self.maxElemShow,\r\n            totalPages: self.totalPages,\r\n            actualPage: resultList.page,\r\n            listElement: $(\"#biz-wp-table-pager-wrapper\"),\r\n            clickCallBack: function (options) {\r\n                var target = $('.sortColumnsDataUpIcon, .sortColumnsDataDownIcon').closest(\"th\").first();\r\n\r\n                if (target.length == 0) {\r\n                    self.findResults(content, self.initialSearchParams, options.page);\r\n                }\r\n\r\n                else {\r\n                    var paramXpath = target.data(\"xpath\");\r\n                    var orderType = null;\r\n                    if (typeof self.sortedField.xpath != undefined && self.sortedField.xpath == paramXpath) {\r\n                        orderType = self.sortedField.orderType\r\n                    }\r\n                    if (orderType == null || orderType == self.orderType.DESC) {\r\n                        self.findSortedResults(content, paramXpath, self.orderType.DESC, options.page);\r\n                    } else {\r\n                        self.findSortedResults(content, paramXpath, self.orderType.ASC, options.page);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        $(\".cases-column-header\", content).click(function (e) {\r\n            var target = $(e.currentTarget);\r\n            var paramXpath = target.data(\"xpath\");\r\n            var orderType = null;\r\n            if (typeof self.sortedField.xpath != undefined && self.sortedField.xpath == paramXpath) {\r\n                orderType = self.sortedField.orderType\r\n            }\r\n            if (orderType == null || orderType == self.orderType.DESC) {\r\n                self.findSortedResults(content, paramXpath, self.orderType.ASC, params.pageNumber);\r\n            } else {\r\n                self.findSortedResults(content, paramXpath, self.orderType.DESC, params.pageNumber);\r\n            }\r\n\r\n        });\r\n\r\n        // Add click event to case link\r\n        $(\".caseClicked\", content).click(function () {\r\n            self.publish(\"executeAction\", {\r\n                action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                idCase: $(this)[0].getAttribute(\"data-idcase\"),\r\n                idWorkItem: $(this)[0].getAttribute(\"data-idworkitem\"),\r\n                idTask: $(this)[0].getAttribute(\"data-idtask\"),\r\n                idWorkflow: $(this)[0].getAttribute(\"data-idworkflow\")\r\n            });\r\n            self.publish(\"closeCurrentDialog\");\r\n        });\r\n\r\n\r\n        $(\".ui-bizagi-wp-app-inbox-grouped\", content).bind(\"click\", function () {\r\n            var idCase = $(this).find(\"#idCase\").val();\r\n\r\n            self.publish(\"executeAction\", {\r\n                action: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                idCase: idCase\r\n            });\r\n            self.publish(\"closeCurrentDialog\");\r\n        });\r\n\r\n\r\n        // Add click event to view workflow\r\n        $(\".js-show-graphic-query\", content).click(function () {\r\n            var idCase = $(this).data(\"idcase\");\r\n            var idWorkflow = $(this).data('idworkflow');\r\n            self.showGraphicQuery({ idCase: idCase,\r\n                idWorkflow: idWorkflow });\r\n        });\r\n\r\n        // Add click to timeline icon\r\n        $(\".js-show-timeline\", content).click(function () {\r\n            var idCase = $(this).data(\"idcase\");\r\n            var caseNumber = $(this).data('radnumber');\r\n            self.showTimeLine({ radNumber: caseNumber,\r\n                idCase: idCase });\r\n        });\r\n\r\n        self.setTableHeadFixed({\r\n            TableElement: $(\"table\", resultTemplate),\r\n            groupByCaseNumber: bizagiConfig.groupByCaseNumber,\r\n            floatOptions: {\r\n                position: 'fixed',\r\n                scrollContainer: function () {\r\n                    return $(\"#result-set-queryForm\");\r\n                }\r\n            }\r\n        });\r\n    },\r\n    /**\r\n     * Add class to format the number\r\n     * */\r\n    applyFomatNumbers: function (elementsDataType, resultTemplate, userLocalization) {\r\n        var numberHeaders = $(\"th[data-type='\" + elementsDataType + \"']\", resultTemplate);\r\n        $.each(numberHeaders, function (i, item) {\r\n            var index = item.getAttribute('data-index');\r\n            $(\".biz-wp-table tr\", resultTemplate).find(\"td:eq(\" + index + \")\").find(\"span\").addClass(\"formatMoney\");\r\n        });\r\n        bizagi.util.formatInvariantNumber(resultTemplate, userLocalization);\r\n    },\r\n\r\n    /*\r\n     * order by\r\n     */\r\n    findSortedResults: function (content, sortParameter, orderType, pageToShow) {\r\n        var self = this;\r\n        var sorted = false;\r\n        var clonedParams = JSON.parse(JSON.stringify(self.initialSearchParams));\r\n        if (clonedParams) {\r\n            var newParameters = clonedParams.parameters;\r\n            newParameters = $.type(newParameters) === \"array\" ? newParameters : JSON.parse(newParameters);\r\n            if (newParameters.length > 0) {\r\n                $.each(newParameters, function (i, item) {\r\n                    var itemXpath = item.xpath;\r\n                    if (itemXpath == sortParameter) {\r\n                        item.orderType = orderType;\r\n                        sorted = true;\r\n                    }\r\n                });\r\n            }\r\n            if (!sorted && sortParameter != \"\" && typeof sortParameter != \"undefined\") {\r\n                newParameters.push({\r\n                    \"value\": null,\r\n                    \"included\": true,\r\n                    \"xpath\": sortParameter,\r\n                    \"searchType\": \"NONE\",\r\n                    \"orderType\": orderType\r\n                });\r\n            }\r\n            self.sortedField = { \"xpath\": sortParameter,\r\n                \"orderType\": orderType };\r\n            clonedParams.parameters = newParameters;\r\n            self.findResults(content, clonedParams, pageToShow);\r\n        }\r\n    },\r\n\r\n    previousValues: function (previousValues) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        $(\"#queryFormName\", content).val(previousValues.definition.name);\r\n        $(\"#queryFormDescription\", content).val(previousValues.definition.description);\r\n        self.selectedItemsToShare.users = (previousValues && previousValues.users) ? previousValues.users : [];\r\n        self.selectedItemsToShare.groups = (previousValues && previousValues.groups) ? previousValues.groups : [];\r\n    },\r\n\r\n    /*\r\n     *Collect parameters and save query form results\r\n     */\r\n    createStoredQueryForm: function () {\r\n        var self = this;\r\n        var params = self.buildStoredQueryFormParams();\r\n        if (params != null) {\r\n            $.when(self.dataService.saveStoredQueryForm(params)).done(function (response) {\r\n                self.publish(\"closeCurrentDialog\");\r\n                self.readyToSave = false;\r\n                self.params.queryFormAction = 'renderQueryForm';\r\n\r\n                if ($(\"#queryFormShortcut\").has(\"#modalMenuBtList\").length == 0) {\r\n                    $.when(self.workportalFacade.getWidget(\"queriesShortcut\", {}))\r\n                        .pipe(function (result) {\r\n                            widget = result;\r\n                            return widget.render();\r\n                        }).done(function () {\r\n                        try{\r\n                            var content = widget.getContent();\r\n                            $(\"#queryFormShortcut\").html(content);\r\n                            self.params.executeQueryForm(response);\r\n                        } catch (e) {\r\n                            // error\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    self.params.executeQueryForm(response);\r\n                }\r\n\r\n            }).fail(function (error) {\r\n                bizagi.log(error);\r\n            });\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    closeQueryForm: function () {\r\n        //$($('.ui-dialog .ui-dialog-titlebar-close')[0]).click();\r\n    },\r\n\r\n    /*\r\n    *Collect parameters and save query form results\r\n    */\r\n    updateStoredQueryForm: function () {\r\n        var self = this;\r\n        var params = self.buildStoredQueryFormParams();\r\n        if (params != null) {\r\n            params.id = self.idQueryForm;\r\n            $.when(self.dataService.updateStoredQueryForm(params)).done(function () {\r\n                self.readyToSave = false;\r\n                self.params.queryFormAction = 'renderQueryForm';\r\n                self.renderQueryForm();\r\n                self.publish(\"refreshQueryFormShortCut\");\r\n            }).fail(function (error) {\r\n                bizagi.log(error);\r\n            });\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    buildStoredQueryFormParams: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var storedQueryFormParameters = {};\r\n        storedQueryFormParameters.users = JSON.stringify($.unique(self.selectedItemsToShare.users));\r\n        storedQueryFormParameters.groups = JSON.stringify($.unique(self.selectedItemsToShare.groups));\r\n        if (self.params.queryFormAction == 'edit') {\r\n            var request = {\r\n                \"parameters\": []\r\n            };\r\n            self.searchParams = self.queryForm.getSearchParams(request);\r\n        }\r\n        storedQueryFormParameters.guid = self.guidForm;\r\n        var nameSaveAs = $(\"#queryFormNameSaveAs\", self.dialogSaveAs).val();\r\n        var nameSave = $(\"#queryFormName\", content).val().trim();\r\n        var alert;\r\n        if (self.saveAs && (nameSaveAs == null || nameSaveAs == \"\")) {\r\n            alert = $(\"#queryFormNameSaveAs\").next(\".ui-bizagi-input-icon-error\");\r\n            alert.show();\r\n            alert.tooltip({ content: bizagi.localization.getResource(\"workportal-general-error-required\") });\r\n            return null;\r\n        }\r\n\r\n        // If the text is not set show an error\r\n        if (!self.saveAs && (nameSave == null || nameSave == \"\")) {\r\n            alert = $(\"#queryFormName\", content).next(\".ui-bizagi-input-icon-error\");\r\n            alert.show();\r\n            alert.tooltip({ content: bizagi.localization.getResource(\"workportal-general-error-required\") });\r\n            return null;\r\n        }\r\n\r\n        if (self.queryForm.validateForm()) {\r\n            if (typeof (self.searchParams.parameters) == \"string\") {\r\n                self.searchParams.parameters = JSON.parse(self.searchParams.parameters);\r\n            }\r\n            storedQueryFormParameters.definition = JSON.stringify({\r\n                name: nameSaveAs ? nameSaveAs : nameSave,\r\n                description: ($(\"#queryFormDescriptionSaveAs\", self.dialogSaveAs).val()) ? $(\"#queryFormDescriptionSaveAs\", self.dialogSaveAs).val() : $(\"#queryFormDescription\", content).val(),\r\n                parameters: self.searchParams.parameters,\r\n                type: self.queryFormType,\r\n                entityGuid: self.guidEntity,\r\n                includeAllUsers: self.includeAllUsers,\r\n                parentQueryForm: self.queryForm.properties.displayName\r\n            });\r\n            return storedQueryFormParameters;\r\n        }\r\n    },\r\n\r\n    /*\r\n    * saveResults,  show the form to save the current query result\r\n    */\r\n    showSaveResultsForm: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        self.readyToSave = true;\r\n        var adminResult = $.tmpl(self.adminResult, {});\r\n\r\n        $(\"#tab_share\", adminResult).click(function () {\r\n            self.initShareSelection();\r\n            $(\"#query-form\").hide();\r\n        });\r\n        $(\"#tab_definition\", adminResult).click(function () {\r\n            if (self.params.queryFormAction === \"edit\") {\r\n                $(\"#query-form\").show();\r\n            }\r\n        });\r\n        $(\"input[type=radio][name=shareType]\", adminResult).change(function () {\r\n            if (this.value == 'users') {\r\n                self.initShareSelection();\r\n            }\r\n            else if (this.value == 'groups') {\r\n                $.when(self.searchGroupToShare())\r\n                    .done(function () {\r\n                        $(\"#userShare\", self.shareSlection).hide();\r\n                    })\r\n            }\r\n        });\r\n        $(\"#query-form\", content).hide();\r\n        $(\"#query-form-result\", content).hide();\r\n        $(\"#query-form-admin-result\", content).show();\r\n        $(\"#query-form-admin-result\", content).html(adminResult);\r\n        $(\"#admin-stored-query-form-wrapper\", content).tabs();\r\n\r\n        //To validate if the input contains a value and depends on that show or hide the div that indicates the required field\r\n        $(\"#queryFormName\", content).keyup(function () {\r\n            self.validateRequireField();\r\n        });\r\n\r\n    },\r\n\r\n    validateRequireField: function () {\r\n\r\n        var name = $(\"#queryFormName\").val();\r\n        if (/([^\\s])/.test(name)) {\r\n            $(\"#input-name-ui-bizagi-input-required\").hide();\r\n        } else {\r\n            $(\"#input-name-ui-bizagi-input-required\").show();\r\n        }\r\n\r\n    },\r\n\r\n    initShareSelection: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var shareSelection = $.tmpl(self.shareSelection, {});\r\n        var users = self.selectedItemsToShare.users;\r\n        $(\"#shareUsers\", content).prop('checked', true);\r\n        $(\"#search_user\", shareSelection).click(function () {\r\n            self.searchUserToShare();\r\n        });\r\n        $(\"#shareSelectionPanel\", content).html(shareSelection);\r\n        $(\"#move_left\", content).click(function () {\r\n            self.removeItem();\r\n        });\r\n        $(\"#move_right\", content).click(function () {\r\n            self.addItem();\r\n        });\r\n        if (users.length > 0) {\r\n            self.searchSavedUser();\r\n        }\r\n    },\r\n\r\n    searchUserToShare: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var filterData = {\r\n            userName: $(\"#userName\", content).val(),\r\n            domain: $(\"#domain\", content).val(),\r\n            fullName: $(\"#fullName\", content).val()\r\n        };\r\n        $.when(self.dataService.searchUsers(filterData)).done(function (response) {\r\n            var filteredUsers = [];\r\n            $.each(response.users, function (index, item) {\r\n                var dupIndex;\r\n                if (item) {\r\n                    dupIndex = $.inArray(item.idUser, self.selectedItemsToShare.users);\r\n                    if (dupIndex < 0) {\r\n                        filteredUsers.push(item);\r\n                    }\r\n                }\r\n            });\r\n            self.showDataToShare(filteredUsers, []);\r\n        }).fail(function (error) {\r\n            bizagi.log(error);\r\n        });\r\n    },\r\n\r\n    searchSavedUser: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var shareType = $(\"input[type=radio][name=shareType]:checked\", content).val();\r\n        $.when(self.dataService.searchUsersByID(self.selectedItemsToShare.users)).done(function (response) {\r\n            $(\"#ListBoxResult\", content).empty();\r\n            self.addPrevious(response, shareType);\r\n        }).fail(function (error) {\r\n            bizagi.log(error);\r\n        });\r\n    },\r\n\r\n    searchGroupToShare: function () {\r\n        var self = this;\r\n        var params = { profileType: 11 };\r\n        return self.dataService.searchProfiles(params)\r\n            .pipe(function (groups) {\r\n                var filteredGroups = [], groupsSelected = [];\r\n                $.each(groups.response, function (index, item) {\r\n                    var dupIndex;\r\n                    if (item) {\r\n                        dupIndex = $.inArray(item.id, self.selectedItemsToShare.groups);\r\n                        if (dupIndex < 0) {\r\n                            filteredGroups.push(item);\r\n                        }\r\n                        else {\r\n                            groupsSelected.push(item);\r\n                        }\r\n                    }\r\n                });\r\n                self.showDataToShare(filteredGroups, groupsSelected);\r\n            });\r\n    },\r\n\r\n    showDataToShare: function (items, itemSelected) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var shareType = $(\"input[type=radio][name=shareType]:checked\", content).val();\r\n        var selectData;\r\n        if (shareType == \"users\") {\r\n            selectData = $.tmpl(self.selectUser, { elementList: items });\r\n        }\r\n        else {\r\n            selectData = $.tmpl(self.selectGroup, { elementList: items });\r\n\r\n            $(\"#ListBoxResult\", content).empty();\r\n            if (itemSelected.length > 0) {\r\n                self.addPrevious(itemSelected, shareType);\r\n            }\r\n        }\r\n\r\n        $(\"#ListBoxSource\", content).replaceWith(selectData);\r\n    },\r\n\r\n    addPrevious: function (items, shareType) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        if (shareType == \"users\") {\r\n            $.each(items.users, function (i, item) {\r\n                $(\"#ListBoxResult\", content).append(new Option(item.userName, item.idUser));\r\n            });\r\n        }\r\n        else {\r\n            $.each(items, function (i, item) {\r\n                $(\"#ListBoxResult\", content).append(new Option(item.displayName, item.id));\r\n            });\r\n        }\r\n    },\r\n\r\n    addItem: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var shareType = $(\"input[type=radio][name=shareType]:checked\", content).val();\r\n        var users = $(\"#ListBoxSource option:selected\", content);\r\n\r\n        $.each(users, function (i, item) {\r\n            if ($.inArray(item.value, self.selectedItemsToShare) == -1) {\r\n                //Persist user information\r\n                self.selectedItemsToShare[shareType].push(item.value);\r\n                $(\"#ListBoxSource option[value='\" + item.value + \"']\", content).appendTo(\"#ListBoxResult\"); //visual behavior\r\n            } else {\r\n                //remove only selected users\r\n                $(\"#ListBoxSource option[value='\" + item.value + \"']\", content).remove(); //visual behavior\r\n            }\r\n        });\r\n        $(\"#ListBoxResult option:selected\").prop(\"selected\", false);\r\n    },\r\n\r\n    removeItem: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var shareType = $(\"input[type=radio][name=shareType]:checked\", content).val();\r\n        var users = $(\"#ListBoxResult option:selected\", content);\r\n        var auxUsers = $(\"#ListBoxSource option\").toArray();\r\n        var arrayUserValues = [];\r\n        $.each(auxUsers, function (i, item) {\r\n            arrayUserValues.push(item.value);\r\n        });\r\n\r\n        $.each(users, function (i, item) {\r\n            var userId = item.value;\r\n            if ($.inArray(userId, arrayUserValues) == -1) {\r\n                $(\"#ListBoxResult option[value='\" + userId + \"']\", content).appendTo(\"#ListBoxSource\"); //visual behavior\r\n            }\r\n            else {\r\n                $(\"#ListBoxResult option[value='\" + userId + \"']\", content).remove(); //visual behavior\r\n            }\r\n            self.selectedItemsToShare[shareType].splice($.inArray(userId, self.selectedItemsToShare[shareType]), 1);\r\n        });\r\n        $(\"#ListBoxSource option:selected\").prop(\"selected\", false);\r\n    },\r\n\r\n    HTMLEncodeText: function (strText) {\r\n        var strNew = strText;\r\n\r\n        strNew = strNew.replace(\"á\", \"&aacute;\");\r\n        strNew = strNew.replace(\"é\", \"&eacute;\");\r\n        strNew = strNew.replace(\"í\", \"&iacute;\");\r\n        strNew = strNew.replace(\"ó\", \"&oacute;\");\r\n        strNew = strNew.replace(\"ú\", \"&uacute;\");\r\n        strNew = strNew.replace(\"ñ\", \"&ntilde;\");\r\n\r\n        strNew = strNew.replace(\"Á\", \"&Aacute;\");\r\n        strNew = strNew.replace(\"É\", \"&Eacute;\");\r\n        strNew = strNew.replace(\"Í\", \"&Iacute;\");\r\n        strNew = strNew.replace(\"Ó\", \"&Oacute;\");\r\n        strNew = strNew.replace(\"Ú\", \"&Uacute;\");\r\n        strNew = strNew.replace(\"Ñ\", \"&Ntilde;\");\r\n\r\n        return strNew;\r\n    },\r\n\r\n\r\n    /*\r\n    * *********************\r\n    * aspx query forms\r\n    * ********************\r\n    */\r\n    frankensteinPostRender: function () {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var iframe = $(\"#queryFormIFrame\", content);\r\n        var css = \"\";\r\n        var cssList = \"\";\r\n        var injectCss = [\".ui-bizagi-old-render*\", \"@font-face\"];\r\n\r\n\r\n        iframe.attr('frameborder', 0);\r\n\r\n        if (typeof injectCss == \"object\") {\r\n            $.each(injectCss, function (key, value) {\r\n                css += bizagi.getStyle(value);\r\n                cssList += value.replace(\".\", \"\") + \" \";\r\n            });\r\n        } else {\r\n            css += bizagi.getStyle(injectCss);\r\n            cssList += injectCss.replace(\".\", \"\");\r\n        }\r\n        // Wait until the iframe has been loadedpip\r\n        iframe.load(function () {\r\n            // inject css\r\n            var iframeContent = $(this).contents();\r\n            var resetCSS = 'body, .ui-bizagi-old-render { overflow-y: visible;};';\r\n            iframeContent.find('input[name=\"btnReturn\"]').css('display', 'none');\r\n            // Append css\r\n            $('head', iframeContent).append(\"<style type='text/css'>\" + css + resetCSS + \"</style>\");\r\n            $('body', iframeContent).addClass(cssList.replace(\"*\", \"\"));\r\n            // Remove borders buttons\r\n            $('body a.WPButton', iframeContent).parent().siblings().remove();\r\n            var callBack = function (params) {\r\n                // This script will execute inside the iframe context\r\n                this.openBACase = function (idCase, sHref) {\r\n                    var workitem = null, workflow = null;\r\n                    if (sHref.indexOf(\"idWorkitem=\") > -1) {\r\n                        workitem = sHref.substring(sHref.indexOf(\"idWorkitem=\") + 11);\r\n                        workitem = workitem.substring(0, workitem.indexOf(\"&\"));\r\n                    }\r\n                    if (sHref.indexOf(\"idWorkflow=\") > -1) {\r\n                        workflow = sHref.substring(sHref.indexOf(\"idWorkflow=\") + 11);\r\n                    }\r\n                    // Executes thepw act on\r\n                    params.controller.publish(\"executeAction\", {\r\n                        action: params.routingAction,\r\n                        idCase: idCase,\r\n                        idWorkItem: workitem,\r\n                        idWorkflow: workflow,\r\n                        referrer: 'queryform'\r\n                    });\r\n\r\n                    var lastQueryFullKey = document.getElementById('h_lastFullKey');\r\n                    var lstCasesElement = document.getElementById('h_lstCases');\r\n                    //bizagi.referrerParams = lastQueryFullKey.value;\r\n                    // Lista de casos bizagi.lstIdCases\r\n                    try {\r\n                        params.controller.dataService.lastQueryFullKey = lastQueryFullKey.value;\r\n                        params.bizagireference.referrerParams.referrer = 'queryform';\r\n                        params.bizagireference.lstIdCases = lstCasesElement.value.split(',');\r\n                        // close dialog\r\n                    } catch (e) {\r\n                        // se produjo un error\r\n                    }\r\n                    for (var i = 0; i < params.bizagireference.workportal.desktop.dialogStack.length; i++) {\r\n                        params.controller.publish(\"closeCurrentDialog\");\r\n                    }\r\n                };\r\n\r\n                this.ShowCaseSumary = function (idCase) {\r\n                    // Verify render version\r\n                    var $ = params.$;\r\n                    $.when(params.controller.dataService.getCaseFormsRenderVersion({ idCase: idCase })).done(function (version) {\r\n                        if (version.formsRenderVersion == 1) {\r\n                            params.controller.publish(\"showDialogWidget\", {\r\n                                widgetName: params.bizagireference.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,\r\n                                widgetURL: params.controller.dataService.serviceLocator.getUrl(\"old-render\") + \"?idCase=\" + idCase + \"&isSummary=1\",\r\n                                modalParameters: {\r\n                                    title: params.controller.resources.getResource(\"workportal-widget-navigation-summary-case\")\r\n                                },\r\n                                afterLoad: params.callBack,\r\n                                afterLoadParams: {\r\n                                    routingAction: params.bizagireference.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                                    genericIframe: params.bizagireference.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_GENERICIFRAME,\r\n                                    bizagi: params.bizagireference\r\n                                }\r\n                            });\r\n                        } else {\r\n                            // new version\r\n                            /*var summary = params.bizagireference.workportal.widgets.search.prototype;\r\n                            summary.caseSummaryTemplate = params.controller.workportalFacade.getTemplate(\"inbox-common-case-summary\");\r\n                            summary.dataService = params.controller.dataService;\r\n                            try{\r\n                            summary.showCase.apply(summary,[idCase]);\r\n                            }catch(e){\r\n                            }*/\r\n                        }\r\n                    });\r\n                };\r\n            };\r\n\r\n            iframe.callInside(callBack, {\r\n                controller: self,\r\n                routingAction: bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,\r\n                bizagireference: bizagi,\r\n                callBack: callBack,\r\n                $: jQuery\r\n            });\r\n        });\r\n\r\n    }\r\n});\r\n","/**\r\n * Name: Bizagi Workportal Users Modal\r\n */\r\n\r\nbizagi.workportal.widgets.widget.extend(\"bizagi.workportal.widgets.queries.management\", {}, {\r\n    /**\r\n     * Constructor\r\n     */\r\n    init: function (workportalFacade, dataService, params) {\r\n        var self = this;\r\n        self.selectedUsers = [\"\", \"\"];\r\n\r\n        // Call base\r\n        self._super(workportalFacade, dataService, params);\r\n\r\n        //Load template\r\n        self.loadTemplates({\r\n            \"queries-management\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.queries.management\").concat(\"#queries-management\"),\r\n            \"queries-management-loader\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.queries.management\").concat(\"#ui-bizagi-workportal-widget-queries-management-loader\"),\r\n            \"queries-management-table\": bizagi.getTemplate(\"bizagi.workportal.desktop.widgets.queries.management\").concat(\"#ui-bizagi-workportal-widget-queries-management-table\"),\r\n        });\r\n\r\n    },\r\n\r\n    renderContent: function () {\r\n        var self = this;\r\n        var template = self.getTemplate('queries-management');\r\n        self.content = template.render();\r\n        return self.content;\r\n    },\r\n\r\n    postRender: function () {\r\n        var self = this;\r\n        self.setupSearchusersButton();\r\n        self.loaderTmpl = self.getTemplate(\"queries-management-loader\");\r\n        self.loader = self.loaderTmpl.render();\r\n    },\r\n\r\n    /**\r\n     * Set the fixed head table of the reporting details\r\n     */\r\n    fixedHeadTable: function () {\r\n        var self = this;\r\n        var fixedHeadTableElement = $(\".ui-bizagi-wp-queries-management-content-parent-tableHeadFixed > .ui-bizagi-wp-queries-management-content-tableHeadFixed\", self.content);\r\n        fixedHeadTableElement.find(\"table:first\").floatThead({\r\n            position: 'fixed',\r\n            zIndex: 1,\r\n            scrollContainer: function () {\r\n                return fixedHeadTableElement;\r\n            }\r\n        });\r\n\r\n        self.onResizeModalEvent();\r\n    },\r\n\r\n    clean: function () {\r\n        var self = this;\r\n    },\r\n\r\n    /**\r\n     * find the maximize button and when the user clicks it the body trigger resize, this is necesary for fixedHeadTable, and recall again\r\n     */\r\n    onResizeModalEvent: function () {\r\n        var self = this;\r\n        self.getContent().parents(\".ui-dialog\").find(\".ui-dialog-titlebar-maximize\").click(function () {\r\n            $(\"body\").trigger(\"resize\");\r\n            self.onResizeModalEvent();\r\n        });\r\n    },\r\n\r\n    /*\r\n    * initialize the users search form widget\r\n    */\r\n    setupUsersSearchForm: function (input, user) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        var def = $.Deferred();\r\n        $(\".queries-management-content\", content).hide();\r\n\r\n\r\n        self.usersTable = new bizagi.workportal.widgets.userstable(self.workportalFacade, self.dataService, $.extend(self.params, {\r\n            canvas: $(\"#dinamicContent\", content),\r\n            userLinkLabel: [bizagi.localization.getResource(\"workportal-widget-admin-defaults-assignation-select-link\")],\r\n            parentDef: def,\r\n            showBackButton: true\r\n        }));\r\n        self.usersTable.render();\r\n\r\n        $.when(def).done(function (userId, userName, guid) {\r\n            var params = {\r\n                action: \"Applications\",\r\n                userId: userId\r\n            }\r\n            if (user == 0) {\r\n                self.dataService.getApplicationCategoriesList(params)\r\n                    .done(function (applicationList) {\r\n                        if (applicationList.items.length > 0) {\r\n                            self.allProcess = true;\r\n                            self.haveProcess = true;\r\n                            if (guid !== undefined) {\r\n                                self.getQueries(guid);\r\n                            }\r\n                        }\r\n\r\n                    }).fail(function () {\r\n                    });\r\n            }\r\n            $(\"#dinamicContent\", content).html(\"\");\r\n            $(\".queries-management-content\", content).show();\r\n            if (userName) {\r\n                $(input, content).val(userName);\r\n                self.showHideClearIcon(input, 'block')\r\n            }\r\n            if (guid) {\r\n                self.selectedUsers[user] = guid;\r\n            }\r\n        });\r\n    },\r\n    showNotifier: function (message) {\r\n        var self = this;\r\n        var notifier = window.parent.bizagi.injector.get('notifier');\r\n        notifier.showSucessMessage(message, '');\r\n        //bizagi.util.hideOrShowXToCloseDialog(self.getContent().parents(\".ui-dialog\"), true);\r\n    },\r\n    showLoading: function () {\r\n        var self = this;\r\n        $(\".queries-management-container\").append(self.loader);\r\n    },\r\n    endLoading: function () {\r\n        var self = this;\r\n        $(self.loader).remove();\r\n    },\r\n    clearInput: function (input, content) {\r\n        var self = this;\r\n        var position = (input == \"#txtTextUserSource\") ? 0 : 1;\r\n        self.showHideClearIcon(input, 'none');\r\n        $(input, content).val(\"\");\r\n        self.selectedUsers[position] = \"\";\r\n    },\r\n    showHideClearIcon: function (id, display) {\r\n        var self = this;\r\n        var content = self.getContent();\r\n        $(id + \" ~ span\", content).css(\"display\", display);\r\n    },\r\n    getQueries: function (guid) {\r\n        var self = this;\r\n        var params = {};\r\n        params.guidUser = guid;\r\n        self.showLoading();\r\n        self.dataService.getManagementQueries(params)\r\n            .done(function (response) {\r\n                self.queries = response.storedQueryForms;\r\n                self.endLoading();\r\n                if (self.queries.length > 0) {\r\n                    var dataTable = $.map(response.storedQueryForms, function (value) {\r\n                        var name = value.definition.name;\r\n                        var description = value.definition.description;\r\n                        return {\r\n                            name: name,\r\n                            description: description\r\n                        };\r\n                    });\r\n                    $(\".emptyQueries\", self.content).hide();\r\n                    $(\".queries-content\", self.content).show();\r\n                    self.renderTable(dataTable);\r\n                }\r\n                else {\r\n                    $(\".emptyQueriesText\").text(bizagi.localization.getResource(\"workportal-widget-queries-management-list-empty-no-queries\"));\r\n                }\r\n            })\r\n            .fail(function (error) {\r\n                self.endLoading();\r\n                bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-admin-transfers-case-security-permissions-assign-fail\"), bizagi.localization.getResource(\"workportal-general-word-information\"), \"warning\");\r\n                bizagi.log(error);\r\n            });\r\n    },\r\n    renderTable: function (dataTable) {\r\n\r\n        var self = this;\r\n        var template = self.getTemplate('queries-management-table');\r\n        var data = {\r\n            data: dataTable\r\n        };\r\n        var contentTable = template.render(data);\r\n        $(\".queries-content.ui-bizagi-wp-queries-management-content-tableHeadFixed\").html(contentTable);\r\n        self.fixedHeadTable();\r\n    },\r\n    validateUsers: function () {\r\n        var self = this;\r\n        var resp = true\r\n        if (self.selectedUsers[0] == \"\" || self.selectedUsers[1] == \"\") {\r\n            bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-admin-transfers-case-security-permissions-fail-you-must-select-both-users-to-continue\"), bizagi.localization.getResource(\"workportal-general-word-information\"), \"warning\");\r\n            resp = false\r\n        } else if (self.selectedUsers[0] == self.selectedUsers[1]) {\r\n            bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-admin-transfers-case-security-permissions-fail-users-must-be-different\"), bizagi.localization.getResource(\"workportal-general-word-information\"), \"warning\");\r\n            resp = false\r\n        }\r\n        else if (self.queries.length == 0) {\r\n            bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-queries-management-list-empty-no-queries\"), bizagi.localization.getResource(\"workportal-general-word-information\"), \"warning\");\r\n            resp = false\r\n        }\r\n        return resp;\r\n    },\r\n\r\n    transferQueries: function () {\r\n        var self = this;\r\n        if (self.validateUsers()) {\r\n            var buttons = [\r\n                {\r\n                    label: bizagi.localization.getResource(\"workportal-widget-queries-management-transfer-confirmation-modal-no-button\"),\r\n                    action: \"reject\"\r\n                },\r\n                {\r\n                    label: bizagi.localization.getResource(\"workportal-widget-queries-management-transfer-confirmation-modal-button\"),\r\n                    action: \"resolve\"\r\n                }\r\n            ];\r\n            var customOptions = {\r\n                dialogClass: \"widget-queries-management-transfer-confirm\",\r\n                width: 400,\r\n                minWidth: 400\r\n            };\r\n            \r\n            $.when(bizagi.showConfirmationBox(bizagi.localization.getResource(\"workportal-widget-queries-management-transfer-confirmation-modal-description\"), bizagi.localization.getResource(\"workportal-general-word-message\"), false, buttons, customOptions))\r\n                .done(function () {\r\n                    self.showLoading();\r\n                    var params = {\r\n                        guidUserSource: self.selectedUsers[0],\r\n                        guidUserTarget: self.selectedUsers[1]\r\n                    }\r\n                    self.dataService.transferQueries(params)\r\n                        .done(function () {\r\n                            self.endLoading();\r\n                            $(\".emptyQueriesText\").text(bizagi.localization.getResource(\"workportal-widget-queries-management-list-empty-no-queries\"));\r\n                            $(\".queries-content\", self.content).hide();\r\n                            $(\".emptyQueries\", self.content).show();\r\n                            self.showNotifier(bizagi.localization.getResource(\"workportal-widget-queries-management-queries-transferred-successfully\"));\r\n                        })\r\n                        .fail(function (error) {\r\n                            self.endLoading();\r\n                            bizagi.showMessageBox(bizagi.localization.getResource(\"workportal-widget-queries-management-queries-transferred-fail\"), bizagi.localization.getResource(\"workportal-general-word-information\"), \"warning\");\r\n                            bizagi.log(error);\r\n                        });\r\n\r\n                });\r\n        }\r\n    },\r\n\r\n    /****************** EVENTS ***********************/\r\n\r\n\r\n    setupSearchusersButton: function () {\r\n        var self = this,\r\n            content = self.getContent();\r\n\r\n        $(\"#btn-searchUserSource\", content).click(function () {\r\n            self.setupUsersSearchForm(\"#txtTextUserSource\", 0);\r\n        });\r\n        $(\"#btn-searchUserTarget\", content).click(function () {\r\n            self.setupUsersSearchForm(\"#txtTextUserTarget\", 1);\r\n        });\r\n\r\n        $(\"#btn-clearUserSource\", content).click(function () {\r\n            self.clearInput(\"#txtTextUserSource\", content);\r\n            $(\".emptyQueriesText\").text(bizagi.localization.getResource(\"workportal-widget-queries-management-list-empty-no-selected-user\"));\r\n            $(\".queries-content\", self.content).hide();\r\n            $(\".emptyQueries\", self.content).show();\r\n        });\r\n        $(\"#btn-clearUserTarget\", content).click(function () {\r\n            self.clearInput(\"#txtTextUserTarget\", content);\r\n        });\r\n\r\n        $(\"#btn-transferQueries\", content).click(function () {\r\n            self.transferQueries();\r\n        });\r\n    }\r\n\r\n});\r\n\r\nbizagi.injector.register('bizagi.workportal.widgets.queries.management', ['workportalFacade', 'dataService', bizagi.workportal.widgets.queries.management]); "]}