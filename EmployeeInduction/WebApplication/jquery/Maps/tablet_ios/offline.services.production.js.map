{"version":3,"sources":["jquery/rendering/js/services/bizagi.render.services.endPoints.js","jquery/rendering/js/services/bizagi.render.services.context.js","jquery/rendering/js/services/bizagi.render.services.service.js","jquery/offline/js/services/bizagi.render.services.service.offline.js","jquery/rendering/js/services/bizagi.render.services.multiactionservice.js","jquery/rendering/js/services/bizagi.render.services.metadataMultiactionservice.js","jquery/offline/js/services/database/bizagi.clientdb.js","jquery/offline/js/services/database/bizagi.clientdb.cases.js","jquery/offline/js/services/database/bizagi.clientdb.forms.js","jquery/offline/js/services/database/bizagi.clientdb.pullWorker.js","jquery/offline/js/services/database/bizagi.clientdb.fetchWorker.js","jquery/offline.old/js/services/database/bizagi.clientdb.js","jquery/offline.old/js/services/database/bizagi.clientdb.cases.js","jquery/offline.old/js/services/database/bizagi.clientdb.forms.js","jquery/offline.old/js/services/database/bizagi.clientdb.pullWorker.js","jquery/offline.old/js/services/database/bizagi.clientdb.fetchWorker.js","jquery/workportalflat/common/services/bizagi.workportal.services.context.js","jquery/workportalflat/common/services/bizagi.workportal.services.endPoints.js","jquery/workportalflat/common/services/bizagi.workportal.services.service.js","jquery/offline/js/services/bizagi.workportal.services.service.offline.js","jquery/offline.old/js/services/bizagi.workportal.services.service.offline.js"],"names":["bizagi","render","services","endPoints","getEndPoints","params","renderHandlerPathRest","renderUploadHandlerPathRest","renderFileHandlerPathRest","letterHandlerPathRest","multiActionHandlerPathRest","metadataHandlerPathRest","context","form-get-data","proxyPrefix","form-submit-data","form-submit-data-upload","render-property-refresh","render-multiaction","render-upload-cancel-image","render-upload-data-url","render-upload-add-url","render-upload-delete-url","render-ecm-upload-url","render-multiaction-metadata","render-grid-edit-url","render-grid-save-url","render-grid-add-url","render-grid-rollback-url","render-grid-commit-url","render-grid-checkpoint-url","render-save-entity","render-stakeholder-associated","render-search-default-image","render-search-form-get-data","render-search-advanced-url","render-letter-notEditable-url","render-letter-content-url","render-letter-save-url","render-letter-content-icons","render-userfield-definition","render-document-generate","render-document-generateAllDocuments","render-processes-startform","render-processes-getstartform","render-entity-layout-image64","render-entity-layout-imageByteArray","getXSRFToken","render-entity-layout-upload-files","case-handler-getCaseSummary","case-handler-getCaseSummaryByGuid","case-handler-getCaseAssignees","case-handler-getWorkItems","case-handler-getWorkItemsByGuid","admin-getUsersList","admin-getUsersList-FromPreferences","admin-getUsersList-ForStakeholders","admin-getUsersForAssignation","admin-users-config","admin-usersform","admin-GenerateDataToSendByEmail","admin-sendUserEmail","alert","sharepointProxyPrefix","$","Class","extend","init","this","util","isEmpty","getUrl","service","setProxyPrefix","BA_ACTION_PARAMETER_PREFIX","BA_CONTEXT_PARAMETER_PREFIX","BA_PAGE_CACHE","serviceLocator","multiactionService","multiactionservice","guid","Math","override","enableECMMetadataMultiaction","multiactionMetadataService","metadatamultiactionservice","userfieldRequests","deviceType","isSmartphoneDevice","deviceEnum","smartphone","isTabletDevice","tablet","desktop","deviceCode","getDeviceCode","multiaction","metadataECMMultiaction","getFormData","self","data","action","idProcess","idForm","idEntity","surrogateKey","idRender","xpathContext","requestedForm","recordXPath","summaryForm","idCase","idWorkitem","idTask","idPageCache","contextType","guidEntity","isRefresh","isActionStartForm","additionalXpaths","idStartScope","readOnlyForm","printversion","recordXpath","downloadOfflineForm","editable","BA_ALL_PARAMETER_PREFIX","prepare","chrono","initAndStart","ajax","url","type","dataType","serviceType","pipe","response","stopAndLog","form","properties","transformGridDataToReadOnly","_data","hasOwnProperty","id","allowAdd","allowDelete","allowEdit","allowGrouping","allowMore","allowSearch","each","key","value","e","getSearchFormData","xpath","idSearchForm","processDataValues","o","submitData","resolveData","contexttype","transitions","surrogatekey","forcePlanCompletion","actionType","toString","toUpperCase","debug","name","newName","isEmptyObject","search","substr","getPropertyData","extra","property","sessionId","guidentity","pxpath","prows","ppage","undefined","pfilter","psort","porder","pcaseId","pguidEntity","psurrogatedKey","pactionXpath","ptemplateGuid","pparameters","beforeSend","xhr","status","multiactionConnection","push","getData","getSearchData","term","getCollapseData","collapseState","getGridData","sort","order","page","rows","searchFilter","getGridDataExclusivesSelected","xpathfilter","getUploadCancelImage","pathToBase","getUploadFileUrl","fileId","verifyPathToBase","jQuery","param","getUploadFileEntityUrl","isContextContainerWidgetRender","xpathActions","getUploadAddUrl","getUploadAddFileUrl","isUserPreferences","deleteImage","deleteUploadFile","getECMMetadata","idFileUpload","xPath","idAttrib","interceptor","intercept","source","checkOutFile","cancelCheckOut","deleteECMFile","updateECMFileContent","metaValues","updateECMMetadata","getFileProperties","uploadECMFile","fileUpload","fileName","getECMFileUrl","p_sessionId","isFileOnECM","idUpload","read","editGridRecord","addGridRecord","addGridRecordData","saveGridRecord","disableServerGridValidations","deleteGridRecord","getFlipAssociation","flipstate","parseJSON","rollbackGridAction","getSearchDefaultImage","processDataCriteria","criteria","submitSearch","JSON","encode","allowFullSearch","maxRecords","associateStakeholder","associatedUser","refreshAssociateStakeholder","getLetterNotEditableUrl","getLetterContent","getCanGenerateLetter","saveLetterContent","content","fullUrl","getLetterEditorIconsPath","executeButton","getFilePrintUrl","disposition","editLinkForm","saveLinkForm","rollbackLinkForm","commitLinkForm","commitGridAction","sendCheckpoint","sendCheckpointAction","getUserfieldDefinition","userfield","guidUserfield","device","refreshControl","refreshGridCell","column","typeRender","executeRule","rule","create","executeInterface","interface","executeSAPConnector","guidsap","executeConnector","guidConnector","generateDocumentTemplate","append","h_pageCacheId","contextXpath","xpathcontext","groupMappingId","groupMapping","xpathAttribute","controlId","getAllDocumentsDownloadUrl","idWorkItem","getCaseNumber","replace","isMobile","getCaseAssignees","getWorkitems","onlyUserWorkItems","getGridExportUrl","exportType","sendEmail","to","subject","message","selected","invalidatePageCache","getUsersList","getUsersListFromPreferences","getUsersListForStakeholders","getUsersForAssignation","getUsersForm","generateDataToSendByEmail","idUser","password","sendUserEmail","eMailTo","body","getConfiguration","indexOf","getTemplate","forcePersonalizedColumns","templateType","templateGuid","isDefaultTemplate","detectDevice","hasStartForm","guidWFClass","getStartForm","guidprocess","surrogatedKey","mappingstakeholders","cache","editActionForm","getActions","extendParams","ptags","pmaxitems","executeActions","pguidConstructor","pguidAction","getPolymorphicActions","serializePolymorphicActions","values","actions","getParents","node","parents","fillTree","list","children","child","displayName","hasConstructor","guidObject","guidConstructor","length","getEntityImage64","width","height","entity","getFilesDataForLayoutUploadControl","processUploadFile","verifyMobilePathToBase","formData","contentType","processData","isSharepointContext","replaceAll","_super","database","isOfflineForm","isNativePluginSupported","bizagiapp","getFormDataFromNative","then","result","mergeForm","offlineType","isEdited","isOpen","def","Deferred","when","getTaskData","formPromise","getTaskForm","mergeDataDocument","done","complexData","object","mergedForm","resolve","promise","getCase","idWfClass","trim","getOfflineImage","fileType","getActivityImage","getStartDataImage","getOfflineActivityDataImage","fileFormat","getActivityDataImage","saveOfflineImage","image","operationType","saveActivityFormImage","saveActivityDataImage","saveStartDataImage","saveOfflineFile","file","mimeType","saveActivityFormFile","saveActivityDataFile","saveStartDataFile","getOfflineFile","getActivityFile","getStartDataFile","getOfflineActivityDataFile","getActivityDataFile","getNativeFormData","caseInfo","parse","error","reject","saveNativeFormInfo","saveTaskData","saveStartData","nativesaveStartData","doc","saveFormData","batch","batchTimer","circularDependencies","replicateServiceMethods","getService","prototype","eval","proxyMethod","method","arguments","apply","add","makeCircularDependenciesError","messageTmpl","localization","getResource","printf","dependencyFrom","dependencyTo","deferred","h_action","detectCircularDependencies","addNode","clearTimeout","batchTimeout","tag","singleAction","setTimeout","resolveDependencies","i","multiactionError","fire","item","execute","rejectDeferreds","responses","fail","errorMessage","finalResponse","responseText","queryString","readQueryString","disabledb","globalId","BIZAGI_USER","BIZAGI_PROXY_PREFIX","BIZAGI_DOMAIN","toLowerCase","createDatabases","_destroy","callback","deleteDatabases","globalIdHash","hashCode","dbRecentProcesses","PouchDB","auto_compaction","dbProcessesHierarchy","dbStartForms","dbStartData","dbActivities","dbActivityForms","dbActivityData","databases","databasesDeleted","err","info","forEach","destroy","restartDatabases","getHierarchyObjects","obj","val","objects","concat","lastIndexOf","getAllOpenCases","query","map","closed","createdBy","userName","emit","reduce","STOREOBJECTNAME","workportal","db","createNewCase","Date","toISOString","offlineCase","_id","idWorkFlow","isFavorite","Name","creationDate","process","categoryName","radNumber","formsRenderVersion","workItems","uniqueID","colorState","State","TaskName","put","deleteCase","get","log","remove","fromWorkItemId","getCategories","enableOfflineForm","getDocument","processesHierarchyDoc","categories","idApp","idCategory","groupCategory","getGroup","category","totalApps","tempCategories","subCategories","appId","len","cat","getCustomizedColumnsData","cases","totalPages","lstIdCases","inputtray","radnumber","idcase","allDocs","include_docs","resp","total_rows","localCase","idWFClass","taskState","guidFavorite","syncStatus","fields","Value","DisplayName","DataType","isRadNumber","stringify","getAllProcesses","workflows","taskstate","workflow","queryFun","idWf","idworkflow","count","getOutboxCases","getOutboxTaskCases","getOutboxTaskCasesFilteredBySyncStatus","pSyncStatus","includeDocs","queryMap","emitValue","filterParameters","existantCase","syncronized","getCasesList","elements","formatDateTime","getCustomizedColumnsNewData","isAborted","workitems","getRecentProcesses","recentProcesses","processes","saveOfflineTasks","tasksMap","currentTask","endDate","group","icon","state","shortEndDate","atRiskTime","wfClassDisplayName","saveDocument","cleanOfflineTasks","getOfflineCases","updateCaseSyncStatus","docId","updateSyncAttribute","saveResp","wasActivityWorkedOffline","internalId","activityData","errorType","prop","buttons","Object","keys","fillForm","element","container","setRenderGridValues","setRenderValues","cause","columns","setDataType","records","total","lengthColumns","tmpEditAndVisible","lengthRows","row","details","idRow","randomNumber","tmpElement","tempRow","col","changes","mergedRow","merge","isNew","visible","j","lengthData","getSummary","activityCaseId","processPath","currentState","countAssigness","countEvents","countSubProcesses","attachmentId","documentId","saveAttachment","getAttachment","attachment","dataResult","formResult","saveTaskForm","dataChangeset","deleteTaskForm","deleteDocument","updateTaskForm","saveStartForm","mergeTaskAction","oldAction","newAction","performSaveTaskData","dataToSave","saveResult","markTaskPromise","closeOfflineTask","markTaskEdited","markResponse","markError","saveError","document","separateComplexControls","mergePromise","mergeRes","images","uploads","grids","renderId","updateResponse","updateErr","getErr","deleteTaskData","getResp","console","mergeData","filterXpathsByType","xpaths","extractXpathFromRenderProperties","renderProperties","extractRenderElements","isContainer","defer","datafill","assigned","nativeSaveFormInfo","deleteNextButton","filter","button","caption","querydisable","pull","syncOfflineCases","argument","synchronizing","pushInProgressPromise","syncCasesQueue","bizagiQueue","syncStarts","syncOfflineStartCases","syncTasks","syncOfflineTaskCases","startRes","taskRes","queueErr","startErr","taskErr","syncSingleOfflineStartCase","newCase","syncCaseParams","generateSyncCasePromise","syncResponse","synchCasesQueue","Start","caseData","itemId","split","Tasks","syncDeferred","syncOfflineStartCase","syncOfflineTaskCase","successMsg","maxOfflineCases","secondsBeforeAllowFetchAgain","tasksSyncDelda","startSyncDelta","fetchInProgress","fetch","timeBeforeFetch","executeFetch","fetchInProgressPromise","fetchStartForms","fetchTaskForms","fetchTasks","lastFetch","now","getRecentOfflineProcesses","recentProcceses","saveRecentProcesses","performStartFormsFetch","offlineProcessTree","processesHierarchy","dataCategory","lastSynchronization","saveProcessesHierarchy","processTreeToFetchStartForms","isSyncNeeded","lastSync","currentTime","downloadFormsQueue","processCategory","isProcess","hasOfflineForm","downloadProm","downloadOfflineStartForm","k","urlMobile","processTasksToFetchForms","processTasksResponse","tasksResponse","tasksToDownload","serverTasks","elementsMap","actualDate","statusFunction","advanceSearch","defineActivityStateByTaskState","defineActivityStateByDate","queueReadyToProcess","processOfflineFormsQueue","field","tempElement","el","headers","fieldName","serializeActivity","parseInt","tmpEndDate","getTime","idworkitem","idwfclass","validateFeatureSupport","syncDelda","localActivitiesProm","localActivities","localActivityInternalId","deleteLocalDataIfActivityWasNotWorked","saveResponse","processFormProm","downloadOfflineTaskForm","wasWorked","hierarchy","docHierarchy","dbProcessRecent","dbProcessHierarchy","dbForms","dbCases","old","gId","index","saveFormInfo","tempDataColumn","lengthCols","array_cases","objToSend","domain","user","rta","decodeURIComponent","pivot","rowPos","cellPos","cell","dataRecents","processesHierarchyTofetchForms","data1","data2","data3","changeset","getItemLocalStorage","callSyncForms","changeSet","prom","changeSetType","saveProcessesHierarchyTofetchForms","saveProcessInHierarchy","setItemLocalStorage","wfClass","globalid","workFlow","_rev","docRecent","user-handler","process-handler","query-handler","case-handler","query-form","query-form-edit","query-form-delete","query-form-delete-cube","favorites-handler","file-handler","login-handler","login-handlerv10","logoff-handler","logoff-handlerv1","authorization-handler-getMenuAuthorization","authorization-handler-isCaseCreationAuthorized","case-handler-releaseActivity","case-handler-getCasesList","case-handler-getActivityList","offline-getProcessTree","offline-tasks","offline-getForms","offline-sendForm","case-handler-getCaseTasks","case-handler-getCaseEvents","case-handler-getCaseSubprocesses","case-handler-getTaskAssignees","case-handler-getAsynchExecutionState","case-handler-addNewCase","case-handler-startProcess","handler-execute-action-start","case-handler-supportedLogTypes","case-handler-getActivityLog","case-handler-getActivityDetailLog","case-handler-getEntityLog","case-handler-getEntityDetailLog","case-handler-getUserLog","case-handler-getUserDetailLog","case-handler-getAdminLog","case-handler-getCaseFormsRenderVersion","case-handler-validateHasStartForm","favorites-handler-saveFavorite","favorites-handler-deleteFavorite","process-getIcon","collections-getIcon","bamAnalytics-handler-getAnalisysQueries","bamAnalytics-handler-updateQuery","inbox-handler-getInboxSummary","MessageHandler-NewComment","MessageHandler-GetComments","MessageHandler-SetCategoryToComment","MessageHandler-RemoveComment","MessageHandler-ReplyComment","MessageHandler-RemoveReply","MessageHandler-GetCategoryColors","MessageHandler-RenameCategoryColor","MessageHandler-CountNewComments","process-handler-getAllProcesses","process-handler-getFavourites","process-handler-getFavouriteCases","process-handler-getCustomizedColumnsData","process-handler-getCategory","process-handler-getRecentProcesses","process-handler-getCustomizedColumnsDataInfo","process-handler-getOrganizations","process-handler-getMyStuff","process-handler-getIdCasesOfProcessEntities","templates-handler-getCollectionData","data-navigation-handler-collection","data-navigation-handler-entity","data-navigation-handler-entity-filters","action-handler-getProcessAddAction","my-search-getSearchLists","my-search-getFilters","my-search-getFiltersData","my-search-getData","templates-handler-getVirtualCollectionData","templates-handler-getMultipleActions","process-handler-getMapping","process-handler-getForm","process-handler-startform","process-handler-rule","process-action-execute","process-handler-getActivitiesData","process-handler-getPendingsData","entities-handler-getActions","entities-handler-getUsersAndEvents","entities-handler-getUsers","entities-handler-getEvents","entities-handler-getUsersImages","entities-handler-getShotCuts","query-handler-getqueries","query-handler-getQueryForm","user-handler-getCurrentUser","old-render","Reports","reports-handler-deleteQueries","folders-handler-getUserQueries","folders-associate-deleteSmartFolder","folders-handler","folders-associate","smartfolders-integration","AlarmAdmin","AnalyticsProcess","AnalyticsSensor","AnalyticsTask","AsynchronousWorkitemRetries","AuthenticationLogQuery","BAMProcess","BAMTask","BusinessPolicies","CaseAdmin","adminReassignCases","asyncECMUpload","CasesMonitor","Closed","CurrentUser","EncryptionAdmin","MobileUpdatesAdmin","EntityAdmin","LocationResources","NewCase","Pending","Profiles","Search","UserAdmin","UserDefaultAssignation","UserPendingRequests","ListPreferences","UserPreferencesUrl","GRDimensionAdmin","Licenses","AnalysisQueries","DocumentTemplates","ProcessAdmin","ResourceBAM","WorkPortalVersion","entities-administration","theme-handler-getLogoImagePath","logout","logoutDotNet","authenticationConfig","logout-oauth2","FederateLogoffUrl","oauth2AuthenticationConfig","massive-activity-assignments-getOrganizationInfo","massive-activity-assignments-getCasesByOrganization","massive-activity-assignments-reassignCases","massive-activity-assignments-searchUsers","async-ecm-upload-baseService","domains","getCurrentTheme","admin-getAuthenticationLog","admin-getAuthenticationDomains","admin-getAuthenticationEventsTypes","admin-getAuthenticationEventSubTypes","admin-EncryptString","admin-UserPendingRequests","admin-UserAuthenticationInfo","admin-updateUserAuthenticationInfo","admin-generateRandomPassword","admin-sendEmail","admin-getApplicationList","admin-getApplicationProcesses","admin-getProcessVersion","admin-getProcessTasks","admin-getTaskAlarms","admin-getLapseMode","admin-getRecurrMode","admin-getScheduleType","admin-getBossList","admin-addAlarm","admin-editAlarm","admin-deleteAlarm","admin-alarmRecipients","admin-deleteAlarmRecipients","admin-recipientToAlarm","admin-enableAlarm","admin-getCategoriesList","admin-getCasesList","admin-abortItems","admin-reassignItems","admin-getDefaultAssignationUserToAllProcess","admin-getDefaultAssignationUserToProcess","admin-setDefaultAssignationUserToProcess","admin-getProfilesTypes","admin-searchProfiles","admin-getUsersByProfile","admin-removeUserFromProfile","admin-addUserToProfile","admin-async-activities-get-activities","admin-async-activities-get-retry-now","admin-async-activities-get-activities-by-task","admin-async-activities-enable-execution","admin-async-activities-enable-multiple","admin-async-activities-async-execution","admin-async-activities-async-execution-log","admin-Licenses","admin-GetDimensions","admin-EditDimension","admin-CreateAdministrableDimension","admin-DeleteDimension","admin-EntityPathChildNodesAction","admin-GetActiveWFClasses","admin-document-templates-storeDocumentTemplates","admin-document-templates-restoreDocumentTemplates","admin-document-templates-uploadDocumentTemplate","admin-processes-workflowClasses","admin-processes-tasksByWorkflow","admin-processes-modifyProcessDuration","admin-processes-modifyTaskDuration","admin-language-resource","admin-language-languages","bam-resourcemonitor-myteam","reports-analysisquery","reports-analysisquery-update","reports-analysisquery-delete","processviewer-processdefinition","processviewer-processgraphicinfo","mobile-getLastUpdate","discussion-case","discussion-case-v1","get-users","new-discussion","count-comments","comment-case","new-comment","new-comment-attach","get-list-files","get-list-files-v1","project-resource-action","thumbnail-file","get-attachment","get-mobile-attachment","project-files-upload","count-files","count-files-v1","remove-comment","time-schemas-effectiveduration","project-users-get","project-plan-get","project-plan-activities","project-plan-workitems","project-plan-transitions-get","project-plan-activity-edit","project-plan-get-by-parent","project-plan-parent","project-plan-update","project-plan-execute","project-plan-close","project-plan-delete","project-plan-first-parent-plan","getFeatureObject","ENTITIES_QUERY_PAGE_SIZE","normalizeUrl","RPproxyPrefix","pageSize","BIZAGI_INBOX_ROWS_PER_PAGE","isNumeric","endPoint","getOverrides","overrides","valueUppercase","parseBoolean","authenticatedUser","urlSend","BIZAGI_PASSWORD","logoutUser","logOffUser","getCurrentUser","getInboxSummary","onlyFavorites","myActivities","myPendings","smartfoldersParameters","skipAggrupate","responseData","allProcesses","allCases","path","Number","getFavourites","getMyStuff","getFavouriteCases","numberOfFields","elementToHtml","overdue","today","tomorrow","upcoming","actualMonth","getMonth","actualDay","getDate","actualYear","getYear","counter","tmpdate","tmpDay","tmpMonth","tmpYear","dateFormatter","formatDate","getCasesListBeta","getMobileCasesList","groupedData","currentPage","activityDate","getFullYear","isEvent","getCurrentActivities","processActivitiesResponse","highlight","process_filter","highlightedNumber","highlightsString","find","processname","active","string","expresion","RegExp","match","offset","getDiscussionCase","globalParent","editDiscussion","update","getUsersDiscussion","getEffectiveDuration","getUsersData","createNewDiscussion","createNewComment","updateProjectFile","createProjectFile","getFilesCount","getCommentCase","getCommentsByParent","getFilesList","deleteFile","getFilesThumbnail","guidAttachment","idAttachment","getMobileAttachment","getAllAdministrableEntities","kind","entities","getEntitiesList","getCasesByWorkflow","idWorkflow","v","keyvalue","newFieldsValue","fieldsKey","fieldsValue","getOrganizationsList","orderFieldName","orderType","getCustomizedColumnsDataBeta","columnTitle","noResults","groupByApp","getCaseSummary","eventAsTasks","mobileDevice","getCaseTasks","getCaseEvents","getCaseSubprocesses","getCaseFormsRenderVersion","getCaseFormsRenderVersionDataContent","options","getTaskAssignees","fromTask","getQueries","hashQueries","idElement","processQueries","queries","idParent","nodes","idOrganization","validateHasStartForm","processId","batchRequest","startProcess","entityMapping","mapping","idParentCase","isVersionSupported","oldParams","oldVersion","actionCreateCase","guidProcess","parentCaseId","getFirstParentPlan","searchCases","onlyUserCases","queryCases","outputxpath","queryEntities","getMenuAuthorization","isCaseCreationAuthorized","getAsynchExecutionState","idAsynchWorkitem","supportedLogTypes","getActivityLog","orden","idActualPage","getActivityDetailLog","idWorkItemFrom","getEntityLog","getEntityDetailLog","userFullName","attribDisplayName","getUserLog","getUserDetailLog","entDisplayName","getAdminLog","addFavorite","idObject","favoriteType","delFavorite","summaryAssigness","baseAssignees","assignees","assigneesLength","assigneesFix","showAssignees","events","activities","assigneesEvents","assigneesActivities","assigneesEventsList","assigneesActivitiesList","substring","summarySubProcess","subprocess","n","summaryCaseEvents","summaryCaseDetails","getCaseSummaryDataContent","dataCurrentStateLength","showEvents","showParentProcess","parentProcess","parentDisplayName","isClosedForAllUsers","isClosed","showSubProcess","showForm","hasGlobalForm","allowsReassign","currentStateTypes","m","assignToCurrentUser","showActivities","releaseActivity","summaryActivities","icoTaskState","createdByName","createdByUserName","caseDescription","showWorkOnIt","getSmartFolders","idFolder","searchFolders","deleteSmartFolder","idSmartFolder","getFolders","folders","childs","getCasesByFolder","makeFolder","folderName","idParentFolder","updateFolder","associateCaseToFolder","idCustomFolder","dissasociateCaseFromFolder","deleteFolder","getFile","uploadId","entityId","entityKey","getComments","encodeURI","idColorCategory","pag","pagSize","picture","comments","users","Id","Picture","makeNewComment","comment","makeNewReply","idComment","Replies","removeMobileComment","removeComment","removeReply","idReply","renameCommentCategory","colorName","setCommentCategory","getCommentsCategories","getNewComments","getAnalisysQueries","updateQueries","idQuery","queryName","queryDescription","deleteQueries","queryId","QueryId","sessionStorage","removeItem","javaLogout","location","reload","logoutMobile","logoutData","sourceLogout","isCordovaSupported","redirectErrorPage","window","href","authenticationType","logOffURL","federationLogoutBindingProtocol","authenticationSubType","always","res","federateLogoffUrl","open","write","close","loader","nativeAjax","getPathUrl","jsonResponse","samlUrlRedirect","decodeURI","iframe","createElement","getElementsByTagName","appendChild","on","isIE8","contentWindow","text","src","logoutUrl","callbackUrl","homeUrl","loginPage","getOrganizationInfo","getCasesByOrganization","roles","skills","locations","reassignCases","searchUsers","fullName","getDomainList","getEcmAllScheduledJobs","retryECMPendingScheduledJob","getWorkPortalVersion","version","productBuild","getAuthenticationLogData","getAuthenticationLogResult","dtFrom","dtTo","eventSubType","eventType","encryptString","entry","userPendingRequests","userAuthenticationInfo","updateUserAuthenticationInfo","enable","expired","locked","generateRandomPassword","emailTo","getApplicationCategoriesList","filterStartEvent","getAdminCasesList","getApplicationProcesses","getProcessVersion","getProcessTasks","getTaskAlarms","getLapseMode","getRecurrMode","getScheduleType","getBossList","addAlarm","editAlarm","deleteAlarm","getAlarmRecipients","addRecipientToAlarm","deleteRecipientsFromAlarm","enableAlarm","abortReassignItems","asyncActivitiesServices","getDefaultAssignationUserToAllProcess","serviceAction","getDefaultAssignationUserToProcess","setDefaultAssignationUserToProcess","getProcessIcon","getCollectionIcon","collectionId","getProfilesTypes","searchProfiles","getUsersByProfile","removeUserFromProfile","addUserToProfile","licenses","getDimensions","editDimension","entityPath","description","createAdministrableDimension","deleteDimension","administrable","entityPathChildNodesAction","nodeType","idNode","nodeDisplayPath","nodePath","getActiveWFClasses","storeDocumentTemplates","restoreDocumentTemplates","Guid","getWorkFlowClasses","getTaskByWorkFlow","modifyProcessDuration","duration","modifyTaskDuration","getDataForMyTeam","getReporstAnalysisQuery","updateReportData","deleteReportData","getStoreLanguageTemplates","justActives","getLanguageTemplate","cultureName","processDefinition","graphicInfo","getLastUpdateByMobile","getCollectionData","idFact","filters","Array","isArray","getVirtualCollectionData","guidVirtualCollection","guidSearch","calculateFilters","serializeEntityData","getCollectionEntityData","referenceType","defaultFilterApplied","reference","guidEntityCurrent","getFiltersEntityData","getProcessAddAction","getMultipleActions","getMapping","getForm","executeAction","ruleId","actionRule","getActivitiesData","pagsize","getPendingsData","getActionsData","getUsersAndEvents","idCases","getUsers","caseId","getEvents","getUsersImages","userIds","square","getShortCuts","getSearchLists","getIdCasesOfProcessEntities","ids","server","lessThanOrEqualsTo","getQueryForm","defineFilterObject","filterObject","rangeQuery","searchType","min","max","typeSearch","setValues","clone","isDefaultFilter","defaultFilter","isNaN","getPlan","getActivities","updatePlan","putExecutePlan","deletePlan","closePlan","getWorkitemsPlan","getTransitionsByPlan","editActivityPlan","activity","items","idPlan","getPlanByParent","getItemsByActivity","getPlanParent","serializedData","_buildNewObject","header","newObject","timestamp","rowData","kRow","iCell","cells","kReturnObject","shouldSynchronize","isiOSSmartphoneDevice","module","isOfflineFormsV2Supported","oldOfflineServicesAlreadyEnabled","enableOfflineEvents","renderDataService","getNativeComponent","offlineModuleReady","fetchWorker","pullWorker","configureOfflineHandlers","fetchOfflineData","setOfflineCategories","setOfflineRecentProcesses","openCreatedStartForm","inboxType","setOfflineInboxCases","offlineCaseDeleted","off","online","pushOfflineData","event","responsePromise","syncError","webpart","publish","updateDataList","trigger","isMobileDevice","navigator","connection","Connection","NONE","queryoffline","returnOnlineStatus","openSyncDialog","pushStatus","isPushSuccess","showSyncMessage","success","isValidResource","synchronizationFinished","showNotification","delegateUserName","idDelegateUser","groupSeparator","language","decimalSeparator","decimalDigits","symbol","ShortDateFormat","TimeFormat","LongDateFormat","twoDigitYearMax","twoDigitYearMaxDelta","uploadMaxFileSize","isMultiOrganization","associatedStakeholders","sUserProperties","getCustomizedColumnsDataTasks","tasks","currTask","wfclsdisplayname","permissions","Cases","AnalysisReports","Admin","CurrentUserAdministration","LogOut","SmartFolders","CustomFolders","BizagiQueries","StateLog","PrintableVersion","enableDefaultMethod","getNativeWorkItems","subProcesses","bind","fetchPromise","fetchResponse","superResponse","superError","taskFeedData","getTaskFeedData","originalEndDate","recentProcess","isObjectEmpty","downloadImage","imageRenderControl","getPropertyDataParams","pageCacheId","base64Image","saveParams","downloadBinaryFile","uploadControl","getFileUrlParams","fileUrl","binary_file","reader","FileReader","onloadend","readAsText","getResponseHeader","byteArrayToBlob","stringToByteArray","downloadFilesInUploadControl","promisesArray","singleFileValue","downloadSingleFile","downloadPromise","binaryFile","downloadError","convertUploadOnlineValueInOfflineValue","offlineValue","fileExtension","media","getFileExtension","getMIMETypeByExtension","loadFormParams","serverResponse","separatedCaseData","performSyncOfflineCase","getFormErr","sData","imageValues","uploadValues","gridValues","uploadParams","uploadPromises","uploadControlValue","generateUploadPromisesAndDeleteActionsForFilesInUploadControl","imageControlValue","generateUploadPromiseForImageControl","gridPromises","generateGridPromises","bizAdditions","bizDeletions","syncAction","multiActionData","dataValue","performActionProm","multiactionResponse","deleteCasePromise","syncActionTagResponse","deleteResponse","deleteError","delFormResponse","processMultiAction","serverFormProm","getFormError","deleteActions","files","fileMimeType","uploadPromise","generateFileUploadPromise","deleteParams","deleteAction","generateFileDeleteAction","getFilePromise","uploadDeferred","getFileParams","AttachmentType","Blob","blobFile","uploadFileParams","uploadFile","FormData","BIZAGI_SESSION_NAME","imageControl","getImagePromise","uploadImageDeferred","blobImage","uploadImage","blob","addParams","queueID","encodeXpath","fileKey","uploadKey","addUrl","vFD","removeOnlineItems","gridsData","promisesResponse","currentGridData","isTaskForm","savedFormPromise","retrieveAndSaveForm","getServerTaskForm","lastFullSync","savedForm","timeBeforeNextHardRedownload","resolvedForm","downloadPromises","upload","downloadImagesPromise","downloadFormImages","mergedFormPromise","imageControls","downloadImagesPromises","currentImageControl","v2Param","hasOfflineFormsEnabled","synObject","pullObject","awCaseCreationContext"],"mappings":"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","sourcesContent":["/*\r\n*   Name: BizAgi Services Rendering End Points\r\n*   Author: Diego Parra\r\n*   Comments:\r\n*   -   This script defines all the end-points used to retrieve ajax stuff\r\n*   -   All urls must be relative to the base application\r\n*/\r\n\r\n// Create or define namespace\r\nbizagi.render = (typeof (bizagi.render) !== \"undefined\") ? bizagi.render : {};\r\nbizagi.render.services = (typeof (bizagi.render.services) !== \"undefined\") ? bizagi.render.services : {};\r\nbizagi.render.services.endPoints = [];\r\n\r\n// Creates a endpoint hash factory to resolve custom requirements\r\nbizagi.render.services.getEndPoints = function (params) {\r\n\r\n    var renderHandlerPathRest = \"Rest/Handlers/Render\";\r\n    var renderUploadHandlerPathRest = \"Rest/Handlers/Render/Upload\";\r\n    var renderFileHandlerPathRest = \"Rest/Handlers/RenderFile\";\r\n    var letterHandlerPathRest = \"Rest/Handlers/Letter\";\r\n    var multiActionHandlerPathRest = \"Rest/Handlers/MultiAction\";\r\n    var metadataHandlerPathRest = \"Rest/Handlers/Metadata\";\r\n    var metadataMultiactionHandlerPathRest = \"Rest/Handlers/MetadataMultiAction\";\r\n    // Default workportal end-points\r\n    if (params.context == \"workflow\") {\r\n        return {\r\n            \"form-get-data\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"form-submit-data\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"form-submit-data-upload\": params.proxyPrefix + renderUploadHandlerPathRest,\r\n            \"render-property-refresh\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-multiaction\": params.proxyPrefix + multiActionHandlerPathRest,\r\n            \"render-upload-cancel-image\": params.proxyPrefix + \"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png\",\r\n            \"render-upload-data-url\": params.proxyPrefix + renderFileHandlerPathRest,\r\n            \"render-upload-add-url\": params.proxyPrefix + renderUploadHandlerPathRest,\r\n            \"render-upload-delete-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-ecm-upload-url\": params.proxyPrefix + metadataHandlerPathRest,\r\n            \"render-multiaction-metadata\": params.proxyPrefix + metadataMultiactionHandlerPathRest,\r\n            \"render-grid-edit-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-save-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-add-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-rollback-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-commit-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-checkpoint-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-save-entity\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-stakeholder-associated\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-search-default-image\": params.proxyPrefix + \"jquery/rendering/css/desktop/images/bizagi_xpress.png\",\r\n            \"render-search-form-get-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-search-advanced-url\": params.proxyPrefix + \"Rest/Handlers/Query\",\r\n            \"render-letter-notEditable-url\": params.proxyPrefix + letterHandlerPathRest,\r\n            \"render-letter-content-url\": params.proxyPrefix + letterHandlerPathRest,\r\n            \"render-letter-save-url\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-letter-content-icons\": params.proxyPrefix + \"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif\",\r\n            \"render-userfield-definition\": params.proxyPrefix + \"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}\",\r\n            \"render-document-generate\": params.proxyPrefix + \"Rest/DocumentTemplates/CaseTemplates\",\r\n            \"render-document-generateAllDocuments\": params.proxyPrefix + \"Rest/DocumentTemplates/TemplatesConcatFilesToPDF\",\r\n            \"render-processes-startform\": params.proxyPrefix + \"Rest/Processes/HasStartForm\",\r\n            \"render-processes-getstartform\": params.proxyPrefix + \"Rest/Processes/HasStartForm\",\r\n            \"render-entity-layout-image64\": params.proxyPrefix + \"Api/Entities/{entity}/Picture/{surrogateKey}/Base64\",\r\n            \"render-entity-layout-imageByteArray\": params.proxyPrefix + \"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}\" + \"&xsrf=\" + bizagi.getXSRFToken(),\r\n            \"render-entity-layout-upload-files\": params.proxyPrefix + \"Api/Entities/{entity}/Files/{surrogateKey}/Array?xpath={xpath}\",\r\n            \"case-handler-getCaseSummary\": params.proxyPrefix + \"Rest/Cases/{idCase}/SummaryGuid\",\r\n            \"case-handler-getCaseSummaryByGuid\": params.proxyPrefix + \"Rest/Cases/{guid}/SummaryByGuid\",\r\n            \"case-handler-getCaseAssignees\": params.proxyPrefix + \"Rest/Cases/{idCase}/AssigneesGuid\",\r\n            \"case-handler-getWorkItems\": params.proxyPrefix + \"Rest/Cases/{idCase}/WorkItems\",\r\n            \"case-handler-getWorkItemsByGuid\": params.proxyPrefix + \"Rest/Cases/{guid}/WorkItemsByGuid\",\r\n            \"admin-getUsersList\": params.proxyPrefix + \"Rest/Users/SearchUsers\",\r\n            \"admin-getUsersList-FromPreferences\": params.proxyPrefix + \"Rest/Users/SearchUsersFromPreferences\",\r\n            \"admin-getUsersList-ForStakeholders\": params.proxyPrefix + \"Rest/Users/SearchUsersForStakeholders\",\r\n            \"admin-getUsersForAssignation\": params.proxyPrefix + \"Rest/Users/UsersForAssignation\",\r\n            \"admin-users-config\": params.proxyPrefix + \"Api/Authentication/BizagiConfig\",\r\n            //users administration\r\n            \"admin-usersform\": params.proxyPrefix + \"Rest/Handlers/Render\",\r\n            \"admin-GenerateDataToSendByEmail\": params.proxyPrefix + \"Rest/Users/GenerateDataToSendByEmail\",\r\n            \"admin-sendUserEmail\": params.proxyPrefix + \"Rest/Users/SendUserEmail\"\r\n        };\r\n    }\r\n    // Sharepoint end-points (must be customized for each project)\r\n    if (params.context == \"sharepoint\" || params.context == \"portal\") {\r\n        if (typeof (params.sharepointProxyPrefix) === \"undefined\") alert(\"sharepointProxyPrefix param is requiered to build endpoints when context is 'sharepoint'\");\r\n        return {\r\n            \"form-get-data\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"form-submit-data\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"form-submit-data-upload\": params.sharepointProxyPrefix + renderUploadHandlerPathRest,\r\n            \"render-property-refresh\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-multiaction\": params.sharepointProxyPrefix + multiActionHandlerPathRest,\r\n            \"render-upload-cancel-image\": \"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png\",\r\n            \"render-upload-data-url\": params.sharepointProxyPrefix + renderFileHandlerPathRest,\r\n            \"render-upload-add-url\": params.sharepointProxyPrefix + renderUploadHandlerPathRest,\r\n            \"render-upload-delete-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-ecm-upload-url\": params.sharepointProxyPrefix + metadataHandlerPathRest,\r\n            \"render-grid-edit-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-save-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-add-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-rollback-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-commit-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-grid-checkpoint-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-save-entity\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-stakeholder-associated\": params.proxyPrefix + renderHandlerPathRest,\r\n            \"render-search-default-image\": \"jquery/css/bizagi/desktop/images/bizagi_xpress.png\",\r\n            \"render-search-form-get-data\": params.sharepointProxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-search-advanced-url\": params.sharepointProxyPrefix + \"Rest/Handlers/Query\",\r\n            \"render-letter-notEditable-url\": params.sharepointProxyPrefix + letterHandlerPathRest,\r\n            \"render-letter-content-url\": params.sharepointProxyPrefix + letterHandlerPathRest,\r\n            \"render-letter-save-url\": params.sharepointProxyPrefix + renderHandlerPathRest,\r\n            \"render-letter-content-icons\": \"jquery/css/plugins/other/images/nicEditorIcons.gif\",\r\n            \"render-userfield-definition\": params.sharepointProxyPrefix + \"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}\",\r\n            \"render-document-generate\": params.sharepointProxyPrefix + \"Rest/DocumentTemplates/CaseTemplates\",\r\n            \"render-document-generateAllDocuments\": params.sharepointProxyPrefix + \"Rest/DocumentTemplates/TemplatesConcatFilesToPDF\",\r\n            \"render-processes-startform\": params.proxyPrefix + \"Rest/Processes/HasStartForm\",\r\n            \"render-processes-getstartform\": params.proxyPrefix + \"Rest/Processes/HasStartForm\",\r\n            \"render-entity-layout-image64\": params.proxyPrefix + \"Api/Entities/{entity}/Picture/{surrogateKey}/Base64\",\r\n            \"render-entity-layout-imageByteArray\": params.proxyPrefix + \"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}\" + \"&xsrf=\" + bizagi.getXSRFToken(),\r\n            \"case-handler-getCaseSummary\": params.sharepointProxyPrefix + \"Rest/Cases/{idCase}/Summary\",\r\n            \"case-handler-getCaseSummaryByGuid\": params.sharepointProxyPrefix + \"Rest/Cases/{guid}/SummaryByGuid\",\r\n            \"case-handler-getWorkItems\": params.sharepointProxyPrefix + \"Rest/Cases/{idCase}/WorkItems\",\r\n            \"case-handler-getWorkItemsByGuid\": params.proxyPrefix + \"Rest/Cases/{guid}/WorkItemsByGuid\"\r\n        };\r\n    }\r\n\r\n    if (params.context == \"entitymanagement\") {\r\n        return {\r\n            \"form-get-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"form-submit-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"form-submit-data-upload\": params.proxyPrefix + renderUploadHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-property-refresh\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-upload-cancel-image\": \"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png\",\r\n            \"render-upload-data-url\": params.proxyPrefix + renderFileHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-upload-add-url\": params.proxyPrefix + renderUploadHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-upload-delete-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-edit-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-save-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-add-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-rollback-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-commit-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-grid-checkpoint-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-search-default-image\": \"jquery/rendering/css/desktop/images/bizagi_xpress.png\",\r\n            \"render-search-form-get-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-search-advanced-url\": params.proxyPrefix + \"Rest/Handlers/Query\" + \"?h_contexttype=entity\",\r\n            \"render-letter-notEditable-url\": params.proxyPrefix + letterHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-letter-content-url\": params.proxyPrefix + letterHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-letter-save-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=entity\",\r\n            \"render-letter-content-icons\": \"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif\"\r\n        };\r\n    }\r\n\r\n    if (params.context == \"search\") {\r\n        return {\r\n            \"form-get-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"form-submit-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"form-submit-data-upload\": params.proxyPrefix + renderUploadHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-property-refresh\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-upload-cancel-image\": \"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png\",\r\n            \"render-upload-data-url\": params.proxyPrefix + renderFileHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-upload-add-url\": params.proxyPrefix + renderUploadHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-upload-delete-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-edit-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-save-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-add-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-rollback-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-commit-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-grid-checkpoint-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-search-default-image\": \"jquery/rendering/css/desktop/images/bizagi_xpress.png\",\r\n            \"render-search-form-get-data\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-search-advanced-url\": params.proxyPrefix + \"Rest/Handlers/Query\" + \"?h_contexttype=metadata\",\r\n            \"render-letter-notEditable-url\": params.proxyPrefix + letterHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-letter-content-url\": params.proxyPrefix + letterHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-letter-save-url\": params.proxyPrefix + renderHandlerPathRest + \"?h_contexttype=metadata\",\r\n            \"render-letter-content-icons\": \"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif\"\r\n        };\r\n    }\r\n\r\n    return {};\r\n};\r\n","/*\r\n*   Name: BizAgi Rendering Service Context Factory\r\n*   Author: Diego Parra\r\n*   Comments:\r\n*   -   This script will define the endpoints to be used based on the given context\r\n*/\r\n\r\n$.Class.extend(\"bizagi.render.services.context\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function (params) {\r\n        this.context = params.context;\r\n        this.endPoints = bizagi.render.services.getEndPoints(params);\r\n        this.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n    },\r\n\r\n    /*\r\n    *   Returns the given url for a specified service\r\n    */\r\n    getUrl: function (service) {\r\n        if (this.endPoints[service] == null) {\r\n            alert(\"No endpoint defined for: \" + service);\r\n        }\r\n        return this.endPoints[service];\r\n    },\r\n\r\n    setProxyPrefix: function(params){\r\n        this.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n        this.endPoints = bizagi.render.services.getEndPoints(params);\r\n    }\r\n});","/*\r\n *   Name: BizAgi Rendering Services\r\n *   Author: Diego Parra\r\n *   Comments:\r\n *   -   This class will provide a facade to access to rendering REST services\r\n */\r\n\r\n$.Class.extend(\"bizagi.render.services.service\",\r\n    {\r\n        // Statics\r\n        BA_ACTION_PARAMETER_PREFIX: \"p_\",\r\n        BA_CONTEXT_PARAMETER_PREFIX: \"h_\",\r\n        BA_PAGE_CACHE: \"pageCacheId\"\r\n    },\r\n    {\r\n        /*\r\n         *   Constructor\r\n         */\r\n        init: function(params) {\r\n            params = params || {};\r\n            params.context = params.context || \"workflow\";\r\n            params.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n            this.serviceLocator = new bizagi.render.services.context(params);\r\n            this.multiactionService = new bizagi.render.services.multiactionservice(this);\r\n            this.guid = Math.guid();\r\n\r\n            if (bizagi.override.enableECMMetadataMultiaction) {\r\n                this.multiactionMetadataService = new bizagi.render.services.metadatamultiactionservice(this);\r\n            }\r\n\r\n            // Userfield definitions mini-cache\r\n            this.userfieldRequests = {};\r\n\r\n            this.deviceType = params.deviceType || (bizagi.util.isSmartphoneDevice() ? bizagi.deviceEnum.smartphone: (bizagi.util.isTabletDevice() ? bizagi.deviceEnum.tablet: bizagi.deviceEnum.desktop));\r\n            this.deviceCode = bizagi.util.getDeviceCode();\r\n        },\r\n        /*\r\n         *   Return the multiaction-service\r\n         */\r\n        multiaction: function() {\r\n            return this.multiactionService;\r\n        },\r\n\r\n        metadataECMMultiaction: function () {\r\n            return bizagi.override.enableECMMetadataMultiaction ? this.multiactionMetadataService: this;\r\n        },\r\n        /*\r\n         *   SINGLE SERVICES METHODS\r\n         */\r\n\r\n        /*\r\n         *   Gets form data\r\n         *   Returns a promise of the data being retrieved\r\n         */\r\n        getFormData: function(params) {\r\n            var self = this;\r\n\r\n            // Check if the params contains mocked data\r\n            if (params && params.data) {\r\n                return params.data;\r\n            }\r\n\r\n            // Define data\r\n            params = params || {};\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = params.action || \"LOADFORM\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicetype\"] = self.deviceType;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicecode\"] = self.deviceCode;\r\n\r\n            if (params.idProcess)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idProcess\"] = params.idProcess;\r\n            if (params.idForm)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idForm\"] = params.idForm;\r\n            if (params.idEntity)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idEntity\"] = params.idEntity;\r\n            if (params.surrogateKey)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"surrogateKey\"] = params.surrogateKey;\r\n            if (params.idRender)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            if (params.xpathContext)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            if (params.requestedForm)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"requestedForm\"] = params.requestedForm;\r\n            if (params.recordXPath)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"recordXPath\"] = params.recordXPath;\r\n            if (params.summaryForm)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"summaryForm\"] = params.summaryForm;\r\n            if (params.idCase)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idCase\"] = params.idCase;\r\n            if (params.idWorkitem)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idWorkitem\"] = params.idWorkitem;\r\n            if (params.idTask)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idTask\"] = params.idTask;\r\n            if (params.idPageCache)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            if (params.contextType)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contextType;\r\n            if (params.guidEntity)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guidEntity;\r\n            if (!bizagi.util.isEmpty(params.isRefresh))\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isRefresh\"] = params.isRefresh;\r\n            if (params.isActionStartForm)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isActionStartForm\"] = params.isActionStartForm;\r\n            if (params.additionalXpaths)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"additionalXpaths\"] = params.additionalXpaths;\r\n            if (params.idStartScope)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idStartScope\"] = params.idStartScope;\r\n            if (typeof params.readOnlyForm !== \"undefined\")\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"readonlyform\"] = params.readOnlyForm;\r\n            if (typeof params.printversion !== \"undefined\")\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"printForm\"] = params.printversion;\r\n            if (typeof params.recordXpath !== \"undefined\")\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"recordlauncherxpath\"] = params.recordXpath;\r\n            if (params.guid)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guid\"] = params.guid;\r\n            if (params.downloadOfflineForm)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"downloadofflineform\"] = 1;\r\n\r\n            if (params.editable === false) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"DisplayFormAsReadOnly\"] = true;\r\n            }\r\n\r\n            // Support parameter from ui\r\n            // Parameters that affects all the same attributes of render\r\n            if (params.printversion) {\r\n                //Print limit grid rows\r\n                var BA_ALL_PARAMETER_PREFIX = \"all_\";\r\n\r\n                if (params[self.Class.BA_ACTION_PARAMETER_PREFIX + BA_ALL_PARAMETER_PREFIX + \"rows\"]) {\r\n                    data[self.Class.BA_ACTION_PARAMETER_PREFIX + BA_ALL_PARAMETER_PREFIX + \"rows\"] = params[self.Class.BA_ACTION_PARAMETER_PREFIX + BA_ALL_PARAMETER_PREFIX + \"rows\"];\r\n                }\r\n            }\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n\r\n            // Call ajax and returns promise\r\n            bizagi.chrono.initAndStart(\"data\");\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"form-get-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: params.action || \"LOAD\"\r\n            })\r\n                .pipe(function(response) {\r\n                    bizagi.chrono.stopAndLog(\"data\");\r\n\r\n                    // Transform data for read only version\r\n                    if (params.printversion) {\r\n                        try {\r\n                            response.form.properties.editable = \"False\";\r\n\r\n                            var transformGridDataToReadOnly = function(_data) {\r\n                                if (_data == null) {\r\n                                    return _data;\r\n                                }\r\n                                if (_data.hasOwnProperty('type') && _data.type == 'grid') {\r\n                                    _data.id = data.id + \"-print\";\r\n                                    _data.allowAdd = \"False\";\r\n                                    _data.allowDelete = \"False\";\r\n                                    _data.allowEdit = \"False\";\r\n                                    _data.allowGrouping = \"False\";\r\n                                    _data.allowMore = \"False\";\r\n                                    _data.allowSearch = \"False\";\r\n                                } else {\r\n                                    $.each(data, function(key, value) {\r\n                                        if (typeof (value) == 'object') {\r\n                                            _data[key] = transformGridDataToReadOnly(_data[key]);\r\n                                        }\r\n                                    });\r\n                                }\r\n                                return _data;\r\n                            };\r\n                            response = transformGridDataToReadOnly(response);\r\n                        } catch (e) {\r\n                        }\r\n                    }\r\n\r\n                    return response;\r\n                });\r\n        },\r\n        /*\r\n         *   Gets a search form data\r\n         *   Returns a promise of the data being retrieved\r\n         */\r\n        getSearchFormData: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            params = params || {};\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"SEARCHFORM\";\r\n            if (params.xpath)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            if (params.idRender)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            if (params.xpathContext)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            if (params.idSearchForm)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"searchForm\"] = params.idSearchForm;\r\n            if (params.idPageCache)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-search-form-get-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"SEARCHFORM\"\r\n            });\r\n        },\r\n\r\n        processDataValues: function(data) {\r\n            var o;\r\n            data = $.extend(true, {}, data);\r\n            for (o in data) {\r\n                if (data.hasOwnProperty(o) && $.type(data[o]) == \"object\") {\r\n                    // for search\r\n                    if (data[o].hasOwnProperty(\"id\")) {\r\n                        data[o] = data[o].id;\r\n                    }\r\n                }\r\n            }\r\n            return data;\r\n        },\r\n        /*\r\n         *   Sends a form action to the server\r\n         */\r\n        submitData: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            data = self.resolveData(params.data || {}, params.xpathContext);\r\n            data = self.processDataValues(data);\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = params.action;\r\n\r\n            // Fill optional parameters\r\n            params = params || {};\r\n            if (params.xpath)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            if (params.idRender)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            if (params.xpathContext)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            if (params.idPageCache)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            if (params.guidEntity)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guidEntity;\r\n            if (params.contexttype)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            if (params.transitions)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"transitions\"] = params.transitions;\r\n            if (params.surrogatekey)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"surrogateKey\"] = params.surrogatekey;\r\n            if (params.forcePlanCompletion)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"forcePlanCompletion\"] = params.forcePlanCompletion;\r\n\r\n            /* if (params.isActionStartForm)\r\n             data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isActionStartForm\"] = params.isActionStartForm;\r\n             */\r\n            var actionType = params.action.toString().toUpperCase();\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Data sent\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"form-submit-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: actionType\r\n            });\r\n        },\r\n        /*\r\n         * Get data processing xpathcontext\r\n         */\r\n        resolveData: function(data, xpathContext) {\r\n            var name, newName, value;\r\n            if (!$.isEmptyObject(data) && xpathContext) {\r\n                if (xpathContext.search(/\\[id=\\d+\\]/) !== -1) {\r\n                    for (name in data) {\r\n                        if (name.search(/\\[id=\\d+\\]/) !== -1 && xpathContext == name.substr(0, name.search(/\\]/) + 1)) {\r\n                            newName = name.substr(name.search(/\\]/) + 2);\r\n                            value = data[name];\r\n                            data[newName] = value;\r\n                            delete data[name];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return data;\r\n        },\r\n        /*\r\n         *   Fetch a property from the server\r\n         *   Params:\r\n         *   -   xpath\r\n         *   -   idRender\r\n         *   -   xpathContext\r\n         *   -   property\r\n         */\r\n        getPropertyData: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = params.property;\r\n\r\n            if (params.sessionId)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            if (params.contexttype)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            if (params.guidentity)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guidentity;\r\n            if (params.surrogatekey)\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"surrogateKey\"] = params.surrogatekey;\r\n            if (params.pxpath)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"xpath\"] = params.pxpath;\r\n            if (params.prows)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"rows\"] = params.prows;\r\n            if (params.ppage)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"page\"] = params.ppage;\r\n            if (params.pfilter != undefined && params.pfilter != null)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"filter\"] = params.pfilter;\r\n            /*else\r\n             data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"filter\"] = \"\";*/\r\n            if (params.psort != undefined && params.psort != null)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sort\"] = params.psort;\r\n            if (params.porder)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"order\"] = params.porder;\r\n            if (params.pcaseId)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"caseId\"] = params.pcaseId;\r\n            if (params.pguidEntity)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"guidEntity\"] = params.pguidEntity;\r\n            if (params.psurrogatedKey) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"surrogatedKey\"] = params.psurrogatedKey;\r\n            }\r\n            if (params.pactionXpath) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"actionXpath\"] = params.pactionXpath;\r\n            }\r\n            if (params.ptemplateGuid) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"templateGuid\"] = params.ptemplateGuid;\r\n            }\r\n            if (params.pparameters) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"parameters\"] = params.pparameters;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Property refresh for '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            // TODO: change REST library in order to support extra HTTP parameters\r\n            // Please be careful with dataType parameter\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-property-refresh\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\",\r\n                serviceType: \"PROCESSPROPERTYVALUE\",\r\n                beforeSend: function(xhr, status) {\r\n                    bizagi.multiactionConnection = bizagi.multiactionConnection || [];\r\n                    bizagi.multiactionConnection.push(xhr);\r\n                }\r\n            });\r\n\r\n        },\r\n        /*\r\n         *   Refresh the data property from the server\r\n         *   Params:\r\n         *   -   xpath\r\n         *   -   idRender\r\n         *   -   xpathContext\r\n         */\r\n        getData: function(params) {\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"data\"\r\n            }));\r\n        },\r\n        /*\r\n         *   Refresh the data property from the server\r\n         *   This version is to fetch search data\r\n         *   Params:\r\n         *   -   xpath\r\n         *   -   idRender\r\n         *   -   xpathContext\r\n         *   -   term\r\n         */\r\n        getSearchData: function(params) {\r\n            var self = this;\r\n            params.extra = params.extra || {};\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"term\"] = params.term;\r\n\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"data\"\r\n            }));\r\n        },\r\n\r\n        /*\r\n         * Refresh tha data property from the server\r\n         * Params:\r\n         *   -   collapsestate\r\n         */\r\n        getCollapseData: function(params) {\r\n            var self = this;\r\n            params.extra = params.extra || {};\r\n\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"collapseState\"] = params.collapseState;\r\n\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"collapseState\"\r\n            }));\r\n        },\r\n\r\n        /*\r\n         *   Refresh the data property from the server\r\n         *   This version is to fetch grid data\r\n         *   Params:\r\n         *   -   xpath\r\n         *   -   idRender\r\n         *   -   xpathContext\r\n         *   -   sort\r\n         *   -   page\r\n         *   -   rows\r\n         */\r\n        getGridData: function(params) {\r\n            var self = this;\r\n            params.extra = params.extra || {};\r\n\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sort\"] = params.sort;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"order\"] = params.order;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"page\"] = params.page;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"rows\"] = params.rows;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"searchFilter\"] = params.searchFilter;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"value\"] = params.value;\r\n\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"data\"\r\n            }));\r\n        },\r\n\r\n        getGridDataExclusivesSelected: function(params) {\r\n            var self = this;\r\n            params.extra = params.extra || {};\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"rows\"] = params.rows;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"value\"] = params.value;\r\n            params.extra[self.Class.BA_ACTION_PARAMETER_PREFIX + \"xpathfilter\"] = params.xpathfilter;\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"exclusivesSelected\"\r\n            }));\r\n        },\r\n\r\n        /*\r\n         *   Returns the upload plugin cancel image\r\n         */\r\n        getUploadCancelImage: function() {\r\n            return bizagi.services.ajax.pathToBase + this.serviceLocator.getUrl(\"render-upload-cancel-image\");\r\n        },\r\n        /*\r\n         *   Returns the upload file url for each file\r\n         */\r\n        getUploadFileUrl: function(params) {\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"render-upload-data-url\");\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = \"fileContent\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"fileId\"] = params.fileId;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data) + \"&xsrf=\" + bizagi.getXSRFToken();\r\n        },\r\n\r\n        getUploadFileEntityUrl: function(params) {\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"render-upload-data-url\");\r\n            var data = {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUETEMPLATE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = \"fileContent\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"fileId\"] = params.fileId;\r\n            if (params.isContextContainerWidgetRender) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"xpathactions\"] = params.xpathActions;\r\n            } else {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"surrogateKey\"] = params.surrogatekey;\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guidentity;\r\n            }\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data) + \"&xsrf=\" + bizagi.getXSRFToken();\r\n        },\r\n\r\n        /*\r\n         *   Returns the upload add url\r\n         */\r\n        getUploadAddUrl: function() {\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"render-upload-add-url\");\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"ADDFILE\";\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data);\r\n        },\r\n        /*\r\n         *   Returns the upload add url\r\n         */\r\n        getUploadAddFileUrl: function(isUserPreferences) {\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"form-submit-data-upload\");\r\n            var data = {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = (isUserPreferences === true) ? \"SAVEUSERIMAGE\" : \"savefile\";\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data);\r\n        },\r\n\r\n        deleteImage: function(params) {\r\n            var self = this;\r\n\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"DELETEUSERIMAGE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Removing image '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-upload-delete-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         *   Returns the upload add url\r\n         */\r\n        deleteUploadFile: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"REMOVERELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Removing file in upload '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-upload-delete-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n\r\n            });\r\n        },\r\n        /*\r\n         * Return file meta data\r\n         */\r\n        getECMMetadata: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"getECMMetadata\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n            if (params.sessionId) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            }\r\n            // Log submit data\r\n            bizagi.debug(\"Get file metadata '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                interceptor: {\r\n                    intercept: true,\r\n                    source: \"rendering_\" + self.guid,\r\n                }\r\n            });\r\n\r\n        },\r\n        /*\r\n         * Checkout a file\r\n         **/\r\n        checkOutFile: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"checkOutFile\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"file checkout '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /*\r\n         * cancelCheckOut\r\n         **/\r\n        cancelCheckOut: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"cancelCheckOut\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"file checkout '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /*\r\n         * Checkout a file\r\n         **/\r\n        deleteECMFile: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"delete\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"delete file'\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /*\r\n         *  Update ECM file content\r\n         **/\r\n        updateECMFileContent: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"updateECMFileContent\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n\r\n            data.metaValues = params.metaValues;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Update file content '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /*\r\n         *  Update file content\r\n         **/\r\n        updateECMMetadata: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"updateECMMetadata\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n\r\n            data.metaValues = params.metaValues;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Update file meta data '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        getFileProperties: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"getFileProperties\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Get file properties '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                interceptor: {\r\n                    intercept: true,\r\n                    source: \"rendering_\" + self.guid,\r\n                }\r\n            });\r\n        },\r\n        uploadECMFile: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data.action = \"uploadECMFile\";\r\n            data.fileUpload = params.fileUpload; // Content of file\r\n            data.xPath = params.xPath;\r\n\r\n            data.idAttrib = params.idAttrib;\r\n            data.fileName = params.fileName;\r\n            data.metaValues = params.metaValues;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Upload ECM file '\" + params.xPath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        getECMFileUrl: function(params) {\r\n            var self = this;\r\n            var url = params.url || self.serviceLocator.getUrl(\"render-ecm-upload-url\") + \"File\";\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data.action = \"viewECMFile\";\r\n            data.idFileUpload = params.idFileUpload;\r\n            data.xPath = params.xPath;\r\n            data.idAttrib = params.idAttrib;\r\n\r\n            data.fileName = params.fileName;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data.xpathContext = params.xpathContext;\r\n            if (params.sessionId) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            }\r\n            if (params.p_sessionId) {\r\n                data.p_sessionId = params.p_sessionId;\r\n            }\r\n\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"View uploaded file '\" + params.xPath + \"'\", data);\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data) + \"&xsrf=\" + bizagi.getXSRFToken();\r\n        },\r\n        /*\r\n         *\r\n         */\r\n        isFileOnECM: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = {};\r\n            data[\"action\"] = \"isFileOnECM\";\r\n            data[\"idUpload\"] = params.idUpload;\r\n\r\n            // Call ajax and returns promise\r\n            return $.read(self.serviceLocator.getUrl(\"render-ecm-upload-url\"), data);\r\n        },\r\n        /*\r\n         *   Start a grid record edition\r\n         */\r\n        editGridRecord: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"EDITRELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending edit request for relation '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-edit-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"EDITRELATION\"\r\n            });\r\n        },\r\n        /*\r\n         *   Sends a grid request to add a new row\r\n         *   The server returns the new row in json\r\n         */\r\n        addGridRecord: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"ADDRELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending add request for grid '\" + params.xpath + \"'\", data);\r\n\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-add-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"ADDRELATION\"\r\n            });\r\n        },\r\n        /*\r\n         *   Sends a grid request to add a new row, and sending the data at the same time\r\n         *   The server returns the new row in json\r\n         */\r\n        addGridRecordData: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"ADDRELATIONWITHDATA\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Build data to submit\r\n            var submitData = params.submitData || {};\r\n            for (key in submitData) {\r\n                data[key] = submitData[key];\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending add request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-add-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"ADDRELATIONWITHDATA\"\r\n            });\r\n        },\r\n        /*\r\n         *   Submits the grid record data to the server\r\n         */\r\n        saveGridRecord: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"SAVERELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"disableServerGridValidations\"] = params.disableServerGridValidations || false;\r\n\r\n            // Send the submitted data page cache because it cointains the grid's form page cache\r\n            if (params.submitData.idPageCache) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.submitData.idPageCache;\r\n                delete params.submitData.idPageCache;\r\n            }\r\n\r\n            var submitData = params.submitData || {};\r\n\r\n            // Build data to submit\r\n            submitData = self.processDataValues(submitData);\r\n\r\n            for (key in submitData) {\r\n                data[key] = submitData[key];\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending save request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-save-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"SAVERELATION\"\r\n            });\r\n        },\r\n        /*\r\n         *   Deletes a grid record in the server\r\n         */\r\n        deleteGridRecord: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"REMOVERELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending delete request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-save-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"REMOVERELATION\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         * Get association flipped status\r\n         */\r\n        getFlipAssociation: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.id;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = \"flipped\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"flipstate\"] = params.flipstate;\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log request data\r\n            bizagi.debug(\"Sending request for flip association control '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-property-refresh\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"text\"\r\n            }).pipe(function(response) {\r\n                try {\r\n                    // Try to attempt to parse JSON\r\n                    return bizagi.services.ajax.parseJSON(response);\r\n                } catch (e) {\r\n                    // If JSON is not valid we need to return the original text response\r\n                    return response;\r\n                }\r\n            });\r\n        },\r\n        /*\r\n         *   Cancels an add or edit request for a grid\r\n         */\r\n        rollbackGridAction: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"ROLLBACK\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending rollback request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-rollback-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"ROLLBACK\"\r\n            });\r\n        },\r\n        /*\r\n         *   Returns the search render default image\r\n         */\r\n        getSearchDefaultImage: function() {\r\n            return bizagi.services.ajax.pathToBase + this.serviceLocator.getUrl(\"render-search-default-image\");\r\n        },\r\n\r\n        processDataCriteria: function(criteria) {\r\n            var o;\r\n            criteria = $.extend(true, [], criteria);\r\n            for (o in criteria) {\r\n                if (criteria.hasOwnProperty(o) && criteria[o].hasOwnProperty(\"value\") && $.type(criteria[o].value) == \"object\") {\r\n                    // for search\r\n                    if (criteria[o].value.hasOwnProperty(\"id\") && criteria[o].value.hasOwnProperty(\"label\")) {\r\n                        criteria[o].value = criteria[o].value.id;\r\n                    }\r\n                }\r\n            }\r\n            return criteria;\r\n        },\r\n\r\n        /*\r\n         *   Perform entity search in the server\r\n         */\r\n        submitSearch: function(params) {\r\n            var self = this, criteria;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            var sort = params.sort && params.sort !== \"\" ? params.sort : \"\";\r\n\r\n            if (params.order && params.order !== \"\" && sort !== \"\")\r\n                sort += \" \" + params.order;\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"SEARCHENTITYFORRENDER\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"searchForm\"] = params.idSearchForm;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sort\"] = sort;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"page\"] = params.page;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"pageSize\"] = params.rows;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"searchFilter\"] = params.searchFilter;\r\n\r\n            criteria = self.processDataCriteria(params.criteria);\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"searchCriteria\"] = JSON.encode(criteria);\r\n\r\n            // Optional search params\r\n            if (params.allowFullSearch)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"allowFullSearch\"] = params.allowFullSearch;\r\n            if (params.maxRecords)\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"maxRowsAllowed\"] = params.maxRecords;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Performing advanced search\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-search-advanced-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"SEARCHENTITYFORRENDER\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         *   Submits the stakeholder associated\r\n         */\r\n        associateStakeholder: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"SAVE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"surrogateKey\"] = params.surrogateKey;\r\n            data[\"associatedUser\"] = params.associatedUser;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guidentity;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Property refresh for '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            // TODO: change REST library in order to support extra HTTP parameters\r\n            // Please be careful with dataType parameter\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-stakeholder-associated\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         *   Refresh the stakeholder associated list\r\n         */\r\n        refreshAssociateStakeholder: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = params.property;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Property refresh for '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            // TODO: change REST library in order to support extra HTTP parameters\r\n            // Please be careful with dataType parameter\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-stakeholder-associated\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\",\r\n                serviceType: \"PROCESSPROPERTYVALUE\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         *   Gets the link to the letter\r\n         */\r\n        getLetterNotEditableUrl: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"GETLETTER\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // Call ajax and returns promise\r\n            var url = params.url || self.serviceLocator.getUrl(\"render-letter-notEditable-url\");\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data);\r\n        },\r\n        /*\r\n         *   Gets the content for editable letters\r\n         */\r\n        getLetterContent: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"GETLETTER\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-letter-content-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"html\"\r\n            }).pipe(function(response) {\r\n                try {\r\n                    return bizagi.services.ajax.parseJSON(response);\r\n                } catch (e) {\r\n                    return response;\r\n                }\r\n            });\r\n        },\r\n        /*\r\n         *   Get the can generate letter flag\r\n         */\r\n        getCanGenerateLetter: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"CANGENERATELETTER\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"render-letter-content-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /*\r\n         *   Saves the content for editable letters\r\n         */\r\n        saveLetterContent: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"UPDATELETTER\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // Define content\r\n            var content = params.content || \"\";\r\n\r\n            // Define url\r\n            var url = params.url || (self.serviceLocator.getUrl(\"render-letter-save-url\"));\r\n            var fullUrl = url + \"?\" + jQuery.param(data);\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Save request for letter sent to: \" + fullUrl, content);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: fullUrl,\r\n                data: content,\r\n                type: \"POST\",\r\n                dataType: \"html\"\r\n            });\r\n        },\r\n        /*\r\n         *   Returns the icons path for the letter plugin\r\n         */\r\n        getLetterEditorIconsPath: function() {\r\n            return bizagi.services.ajax.pathToBase + this.serviceLocator.getUrl(\"render-letter-content-icons\");\r\n        },\r\n        /*\r\n         *   Executes a button action in the server\r\n         */\r\n        executeButton: function(params) {\r\n            return this.getPropertyData($.extend(params, {\r\n                property: \"buttonRule\"\r\n            }));\r\n        },\r\n        /*\r\n         *   Executes a fileprint action in the server\r\n         */\r\n        getFilePrintUrl: function(params) {\r\n\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"render-upload-data-url\");\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = \"data\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"disposition\"] = params.disposition;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data);\r\n\r\n        },\r\n        /*\r\n         *   Start a link form edition\r\n         */\r\n        editLinkForm: function(params) {\r\n            // Actually it does the same than edit grid records\r\n            return this.editGridRecord(params);\r\n        },\r\n        /*\r\n         *   Saves the content of the link form\r\n         */\r\n        saveLinkForm: function(params) {\r\n            // Actually it does the same than edit grid records\r\n            //return this.saveGridRecord(params);\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"SAVEFORMLINKRELATION\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Send the submitted data page cache because it cointains the grid's form page cache\r\n            if (params.submitData.idPageCache) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.submitData.idPageCache;\r\n                delete params.submitData.idPageCache;\r\n            }\r\n\r\n            var submitData = params.submitData || {};\r\n\r\n            // Build data to submit\r\n            submitData = self.processDataValues(submitData);\r\n\r\n            for (key in submitData) {\r\n                data[key] = submitData[key];\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending save request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-save-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"SAVEFORMLINKRELATION\"\r\n            });\r\n        },\r\n        /*\r\n         *   Rollbacks the link form edition\r\n         */\r\n        rollbackLinkForm: function(params) {\r\n            // Actually it does the same than rollback grid records\r\n            return this.rollbackGridAction(params);\r\n        },\r\n        /*   Commit the link form edition\r\n         */\r\n        commitLinkForm: function(params) {\r\n            // Actually it does the same than rollback grid records\r\n            return this.commitGridAction(params);\r\n        },\r\n        /*   Sends schekpoint action\r\n         */\r\n        sendCheckpoint: function(params) {\r\n            // Actually it does the same than rollback grid records\r\n            return this.sendCheckpointAction(params);\r\n        },\r\n        /*\r\n         *   Loads the userfield definition\r\n         */\r\n        getUserfieldDefinition: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            // Check in deferreds cache\r\n            if (self.userfieldRequests[params.userfield])\r\n                return self.userfieldRequests[params.userfield];\r\n\r\n            // Required params: idCase\r\n            self.userfieldRequests[params.userfield] = $.read(self.serviceLocator.getUrl(\"render-userfield-definition\"),\r\n                {\r\n                    guidUserfield: params.userfield,\r\n                    device: (params.device || \"desktop\")\r\n                }\r\n            );\r\n\r\n            // Return deferred\r\n            return self.userfieldRequests[params.userfield];\r\n        },\r\n        /**\r\n         *  Get render json for one render o container\r\n         *  @param {object} params object with idRender,idPageCache\r\n         */\r\n        refreshControl: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"REFRESH\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            (params.xpathContext) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext : \"\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n            (params.idForm) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idForm\"] = params.idForm : \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"form-get-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"PARTIALREFRESH\"\r\n            });\r\n        },\r\n        /**\r\n         *  Get render json for one render o container\r\n         *  @param {object} params object with idRender,idPageCache\r\n         */\r\n        refreshGridCell: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"REFRESHGRIDCELL\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidcolumn\"] = params.column;\r\n            (params.xpathContext) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext : \"\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.idForm) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idForm\"] = params.idForm : \"\";\r\n            (params.typeRender) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"typeRender\"] = params.typeRender : \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"form-get-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /**\r\n         * Request to execute rule on server\r\n         * @param {object} params h_pageCacheId, guidrule\r\n         */\r\n        executeRule: function(params) {\r\n            var self = this;\r\n\r\n\r\n            var data = {};\r\n            params = params || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"EXECUTERULE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidrule\"] = params.rule || \"\";\r\n            (params.xpathContext) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext : \"\";\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.create(self.serviceLocator.getUrl(\"form-submit-data\"), data);\r\n        },\r\n        /**\r\n         * Request to execute interface on server\r\n         * @param {object} params h_pageCacheId, guidinterface\r\n         */\r\n        executeInterface: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n            params = params || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"EXECUTEINTERFACE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidinterface\"] = params.interface || \"\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext || \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.create(self.serviceLocator.getUrl(\"form-submit-data\"), data);\r\n        },\r\n        /**\r\n         * Request to execute SAP Connecor\r\n         * @param {object} params h_pageCacheId, guidinterface\r\n         */\r\n        executeSAPConnector: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n            params = params || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"EXECUTESAP\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidsap\"] = params.guidsap || \"\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext || \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.create(self.serviceLocator.getUrl(\"form-submit-data\"), data);\r\n        },\r\n        /**\r\n         * Request to execute a Bizagi connector\r\n         * @param params\r\n         * @return {{}}\r\n         */\r\n        executeConnector: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n            params = params || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"EXECUTECONNECTOR\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidConnector\"] = params.guidConnector || \"\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext || \"\";\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.create(self.serviceLocator.getUrl(\"form-submit-data\"), data);\r\n        },\r\n        /*\r\n         *   Document Templates generate rest service\r\n         */\r\n        generateDocumentTemplate: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n            params.append = params.append ? params.append : false;\r\n\r\n            return $.create(\r\n                self.serviceLocator.getUrl(\"render-document-generate\"),\r\n                {\r\n                    h_pageCacheId: params.idPageCache,\r\n                    contextXpath: params.xpathcontext,\r\n                    groupMappingId: params.groupMapping,\r\n                    xpathAttribute: params.xpath,\r\n                    append: params.append,\r\n                    controlId: params.id\r\n                }\r\n            );\r\n        },\r\n        /*\r\n         *   Document Templates generate rest service\r\n         */\r\n        getAllDocumentsDownloadUrl: function(params) {\r\n            var self = this;\r\n            var url = this.serviceLocator.getUrl(\"render-document-generateAllDocuments\");\r\n            var data = {};\r\n            data[\"h_pageCacheId\"] = params.idPageCache;\r\n            data[\"contextXpath\"] = params.xpathContext;\r\n            data[\"xpathAttribute\"] = params.xpath;\r\n            data[\"idCase\"] = params.idCase;\r\n            data[\"idWorkItem\"] = params.idWorkItem;\r\n            data[\"p_sessionId\"] = params.sessionId;\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data) + \"&xsrf=\" + bizagi.getXSRFToken();\r\n\r\n        },\r\n\r\n\r\n        getCaseNumber: function(params) {\r\n            var self = this;\r\n            //this function use sendEMail\r\n            //and not possible use dat ain ajax\r\n            //this is workaround (rhonyp)\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"case-handler-getCaseSummary\").replace(\"{idCase}\", params.idCase) + \"?eventAsTasks=false&onlyUserWorkItems=true&mobileDevice=\" + bizagi.isMobile(),\r\n                type: \"GET\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n\r\n        getCaseAssignees: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            // Required params: idCase\r\n            return $.read(\r\n                self.serviceLocator.getUrl(\"case-handler-getCaseAssignees\"), {\r\n                    idCase: params.idCase\r\n                }\r\n            ).pipe(function(response) {\r\n                    return response;\r\n                });\r\n        },\r\n\r\n        getWorkitems: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            return $.read(self.serviceLocator.getUrl(\"case-handler-getWorkItems\"), {\r\n                idCase: params.idCase,\r\n                onlyUserWorkItems: params.onlyUserWorkItems || \"\"\r\n            });\r\n        },\r\n        /*\r\n         *   Executes a grid export action in the server\r\n         */\r\n        getGridExportUrl: function(params) {\r\n\r\n            var self = this,\r\n                url = this.serviceLocator.getUrl(\"render-upload-data-url\"),\r\n                data = {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = params.exportType; //\"data\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"disposition\"] = params.disposition;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sort\"] = params.sort;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"sessionId\"] = params.sessionId;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"idForm\"] = params.idForm;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            (params.contexttype) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype : \"\";\r\n\r\n            return self.verifyPathToBase(bizagi.services.ajax.pathToBase, url) + \"?\" + jQuery.param(data) + \"&xsrf=\" + bizagi.getXSRFToken();\r\n        },\r\n\r\n        /*\r\n         * Executes a send email action in the server\r\n         */\r\n        sendEmail: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            var data = {};\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"PROCESSPROPERTYVALUE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"propertyName\"] = params.property || \"sendEmail\";\r\n            (params.xpathContext) ? data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext : \"\";\r\n\r\n            // Email parameters\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"to\"] = params.to;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"subject\"] = params.subject;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"message\"] = params.message;\r\n            data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"selected\"] = JSON.encode(params.selected);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            var url = params.url || self.serviceLocator.getUrl(\"form-get-data\");\r\n\r\n            return $.create(url, data);\r\n        },\r\n\r\n        /*\r\n         * Request to invalidates page cache in server, since it is no needed anymore\r\n         */\r\n        invalidatePageCache: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"INVALIDATEPAGECACHE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"form-submit-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"INVALIDATEPAGECACHE\"\r\n            });\r\n        },\r\n\r\n        /*\r\n         * Search users usign parameters suchs as userName, fullName, domain and organization\r\n         * @params { domain: (string), userName: (string), fullName: (string), organization: (string), page: (int), pageSize: (int) }\r\n         * @return {deferred} ajax object with JSON content\r\n         */\r\n        getUsersList: function(params) {\r\n            var self = this;\r\n\r\n            return $.read(self.serviceLocator.getUrl(\"admin-getUsersList\"), params);\r\n        },\r\n        /*\r\n         * Search users for preferences usign parameters suchs as userName, fullName, domain and organization\r\n         * @params { domain: (string), userName: (string), fullName: (string), organization: (string), page: (int), pageSize: (int) }\r\n         * @return {deferred} ajax object with JSON content\r\n         */\r\n        getUsersListFromPreferences: function(params) {\r\n            return $.read(this.serviceLocator.getUrl(\"admin-getUsersList-FromPreferences\"), params);\r\n        },\r\n\r\n        /*\r\n         * Search users for Stakeholders\r\n         * @params { domain: (string), userName: (string), fullName: (string), organization: (string), page: (int), pageSize: (int) }\r\n         * @return {deferred} ajax object with JSON content\r\n         */\r\n        getUsersListForStakeholders: function(params) {\r\n            return $.read(this.serviceLocator.getUrl(\"admin-getUsersList-ForStakeholders\"), params);\r\n        },\r\n\r\n        /*\r\n         * Search users usign parameters suchs as userName, fullName, domain and organization\r\n         * @params { domain: (string), userName: (string), fullName: (string), organization: (string), page: (int), pageSize: (int) }\r\n         * @return {deferred} ajax object with JSON content\r\n         */\r\n        getUsersForAssignation: function(params) {\r\n            var self = this;\r\n\r\n            return $.read(self.serviceLocator.getUrl(\"admin-getUsersForAssignation\"), params);\r\n        },\r\n\r\n        /**\r\n         * Get Users Creation/Edition Form\r\n         */\r\n        getUsersForm: function(params) {\r\n            var self = this;\r\n            return $.create(self.serviceLocator.getUrl(\"admin-usersform\"), params);\r\n        },\r\n        /**\r\n         *   Return generate Data To Send By Email\r\n         */\r\n        generateDataToSendByEmail: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n            var data = {\r\n                action: \"GenerateDataToSendByEmail\",\r\n                idUser: params.idUser,\r\n                password: params.password\r\n            };\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"admin-GenerateDataToSendByEmail\"),\r\n                data: params,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n        /**\r\n         * Return generate Send user password Mail\r\n         */\r\n        sendUserEmail: function(params) {\r\n            var self = this;\r\n            params = params || {};\r\n            var data = {\r\n                action: \"SendUserEmail\",\r\n                emailTo: params.eMailTo,\r\n                subject: params.subject,\r\n                body: params.body\r\n            };\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"admin-sendUserEmail\"),\r\n                data: params,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Get bizagi configuration\r\n         * @param {Function}   type callback function when the file load is succed\r\n         * @return {deferred} ajax object with JSON content\r\n         */\r\n        getConfiguration: function() {\r\n            var self = this;\r\n            var url = self.serviceLocator.getUrl(\"admin-users-config\");\r\n\r\n            return $.read(url);\r\n        },\r\n\r\n        /**\r\n         * Validate if url has 'http' string, in that case is not necesary add the pathToBase prefix\r\n         */\r\n        verifyPathToBase: function(pathToBase, url) {\r\n\r\n            if (url.indexOf(\"http\") != -1 && pathToBase != \"\") {\r\n                return url;\r\n            } else {\r\n                return pathToBase + url;\r\n            }\r\n\r\n        },\r\n\r\n        /**\r\n         * Get template of entity\r\n         * @param params { guid, prepare}\r\n         */\r\n        getTemplate: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n            params = params || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"LOADTEMPLATE\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = \"entity\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidEntity\"] = params.guid;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isProcessData\"] = params.forcePersonalizedColumns;\r\n\r\n            if (params.templateType) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"templatetype\"] = params.templateType;\r\n            }\r\n\r\n            if (params.templateGuid) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"templateguid\"] = params.templateGuid;\r\n            }\r\n\r\n            if (params.isDefaultTemplate != undefined) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isDefaultTemplate\"] = params.isDefaultTemplate;\r\n            }\r\n\r\n            // Fix device type since on mobility there are tablet_ios, tablet_android, smartphone_ios, smartphone_ios\r\n            // and the service recives either tablet or smartphone\r\n            var deviceType = bizagi.util.detectDevice();\r\n            if (bizagi.util.isTabletDevice()) {\r\n                deviceType = \"tablet\";\r\n            } else if (bizagi.util.isSmartphoneDevice()) {\r\n                deviceType = \"mobile\";\r\n            }\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicetype\"] = deviceType;\r\n\r\n            // When prepare is true just return data, this feature is used by multiaction service\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.create(self.serviceLocator.getUrl(\"form-get-data\"), data);\r\n        },\r\n\r\n        /**\r\n         * Chek if an entity has startform\r\n         * @param params\r\n         * @return {*}\r\n         */\r\n        hasStartForm: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n\r\n            if (params.guidWFClass) {\r\n                data.guidWFClass = params.guidWFClass;\r\n            }\r\n\r\n            return $.read(self.serviceLocator.getUrl(\"render-processes-startform\"), data);\r\n        },\r\n\r\n        /**\r\n         * Get the start form of the case\r\n         * @param params\r\n         * @return {*}\r\n         */\r\n        getStartForm: function(params) {\r\n            var self = this;\r\n            var data = {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"LOADSTARTFORM\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"guidprocess\"] = params.guidprocess;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"isActionStartForm\"] = true;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicetype\"] = self.deviceType;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicecode\"] = self.deviceCode;\r\n\r\n            if (params.idStartScope) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idStartScope\"] = params.idStartScope;\r\n            }\r\n            if (params.idCase) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idCase\"] = params.idCase;\r\n            }\r\n            if (params.idStartScope) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idStartScope\"] = params.idStartScope;\r\n            }\r\n            if (params.idWorkitem) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idWorkitem\"] = params.idWorkitem;\r\n            }\r\n            if (params.additionalXpaths) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"additionalXpaths\"] = params.additionalXpaths;\r\n            }\r\n            if (params.surrogatedKey) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"surrogatedKey\"] = params.surrogatedKey;\r\n            }\r\n            if (params.recordXpath) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"recordlauncherxpath\"] = params.recordXpath;\r\n            }\r\n            if (params.mappingstakeholders) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"mappingstakeholders\"] = params.mappingstakeholders;\r\n            }\r\n\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"form-get-data\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                cache: true\r\n            });\r\n        },\r\n        /*\r\n         *   Start a link form edition\r\n         */\r\n        editActionForm: function(params) {\r\n            // Actually it does the same than edit grid records\r\n            return this.editGridRecord(params);\r\n        },\r\n\r\n        /**\r\n         * Get list of actions in action launcher\r\n         * @param params\r\n         * @return {*}\r\n         */\r\n        getActions: function(params) {\r\n            var self = this;\r\n            var extendParams = $.extend(params, { prepare: true });\r\n\r\n            var data = self.getPropertyData(extendParams) || [];\r\n\r\n            if (params.ptags) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"tags\"] = params.ptags;\r\n            }\r\n\r\n            if (params.pmaxitems) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"maxitems\"] = params.pmaxitems;\r\n            }\r\n\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-property-refresh\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\",\r\n                serviceType: \"PROCESSPROPERTYVALUE\",\r\n                beforeSend: function(xhr, status) {\r\n                    bizagi.multiactionConnection = bizagi.multiactionConnection || [];\r\n                    bizagi.multiactionConnection.push(xhr);\r\n                }\r\n            });\r\n\r\n        },\r\n\r\n        /**\r\n         * Execute actions or constructors\r\n         * @param params\r\n         */\r\n        executeActions: function(params) {\r\n            var self = this;\r\n            var extendParams = $.extend({}, params, { prepare: true });\r\n            var data = self.getPropertyData(extendParams) || [];\r\n\r\n            if (params.pguidConstructor) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"guidConstructor\"] = params.pguidConstructor;\r\n            }\r\n\r\n            if (params.pguidAction) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"guidAction\"] = params.pguidAction;\r\n            }\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-property-refresh\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\",\r\n                serviceType: \"PROCESSPROPERTYVALUE\"\r\n            });\r\n\r\n        },\r\n\r\n        /**\r\n         * Get list of actions in action launcher\r\n         * @param params\r\n         * @return {*}\r\n         */\r\n        getPolymorphicActions: function(params) {\r\n            var self = this;\r\n            var extendParams = $.extend(params, { prepare: true });\r\n            var data = self.getPropertyData(extendParams) || [];\r\n\r\n            if (params.ptags) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"tags\"] = params.ptags;\r\n            }\r\n\r\n            if (params.additionalXpaths) {\r\n                data[self.Class.BA_ACTION_PARAMETER_PREFIX + \"additionalXpaths\"] = params.additionalXpaths;\r\n            }\r\n\r\n            if (params.prepare) {\r\n                return data;\r\n            }\r\n\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-property-refresh\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: params.dataType || \"json\",\r\n                serviceType: \"PROCESSPROPERTYVALUE\"\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Make a JSON tree of polymorphic constructors categories\r\n         * @param values\r\n         * @return {Array}\r\n         */\r\n        serializePolymorphicActions: function(values) {\r\n            // json serializer\r\n            var actions = [];\r\n            var GUID_ENTITY = 0, DISPLAY_NAME = 1, XPATHCONTEXT = 2, TYPE = 3, GUID_OBJECT = 4, GUID_CONSTRUCTOR = 5, GUID_PARENT_ENTITY = 6;\r\n\r\n            /**\r\n             * Get children by guid of entity\r\n             * @param guid\r\n             * @return {Array}\r\n             */\r\n            var getChildren = function(guid) {\r\n                var children = [];\r\n                guid = guid || \"\";\r\n\r\n                $.each(values, function(key, value) {\r\n                    if (value[GUID_PARENT_ENTITY] == guid) {\r\n                        children.push(value);\r\n                    }\r\n                });\r\n                return children;\r\n            };\r\n\r\n            /**\r\n             * Get parents by action object\r\n             * @param node\r\n             * @return {string}\r\n             */\r\n            var getParents = function(node) {\r\n                node = node || {};\r\n                var parents = \"\";\r\n\r\n                $.each(values, function(key, value) {\r\n                    if (value[GUID_ENTITY] == node[GUID_PARENT_ENTITY]) {\r\n                        parents += getParents(value) + value[DISPLAY_NAME] + \" > \";\r\n                    }\r\n                });\r\n                return parents;\r\n            };\r\n\r\n\r\n            /**\r\n             * Make a tree of actions\r\n             * @param list\r\n             * @param guid\r\n             * @return {*}\r\n             */\r\n            var fillTree = function(list, guid) {\r\n                var node;\r\n                var children = getChildren(guid);\r\n                $.each(children, function(key, value) {\r\n                    var child = fillTree([], value[GUID_ENTITY]);\r\n                    node = {\r\n                        \"guidEntity\": value[GUID_ENTITY],\r\n                        \"displayName\": value[DISPLAY_NAME],\r\n                        \"hasConstructor\": (value[GUID_CONSTRUCTOR]) ? true : false,\r\n                        \"type\": value[TYPE],\r\n                        \"guidObject\": value[GUID_OBJECT],\r\n                        \"guidConstructor\": value[GUID_CONSTRUCTOR],\r\n                        \"xpathContext\": value[XPATHCONTEXT],\r\n                        \"children\": child,\r\n                        \"parents\": getParents(value)\r\n                    };\r\n                    if (node.guidConstructor !== \"\" || node.children.length > 0) {\r\n                        list.push(node);\r\n                    }\r\n                });\r\n\r\n                return list;\r\n            };\r\n            fillTree(actions, \"\");\r\n            return actions;\r\n        },\r\n\r\n        /**\r\n         * Gets the image for an entity xpath\r\n         * @param params\r\n         */\r\n        getEntityImage64: function(params) {\r\n            var self = this,\r\n                data = {\r\n                    width: params.data,\r\n                    height: params.height,\r\n                    xpath: params.xpath\r\n                },\r\n                url = self.serviceLocator.getUrl(\"render-entity-layout-image64\").replace(\"{entity}\", params.entity).replace(\"{surrogateKey}\", params.surrogateKey);\r\n\r\n            return $.ajax({\r\n                url: url,\r\n                data: data\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Get data files when user access from my stuff, because there is no scope\r\n         */\r\n        getFilesDataForLayoutUploadControl: function(params) {\r\n            var self = this;\r\n            return $.read(self.serviceLocator.getUrl(\"render-entity-layout-upload-files\"), params);\r\n        },\r\n\r\n        /**\r\n         * Process an upload file into the server\r\n         * @param {} params\r\n         * @returns {}\r\n         */\r\n        processUploadFile: function(params) {                \r\n            return $.ajax({\r\n                url: this.verifyMobilePathToBase(bizagi.services.ajax.pathToBase || \"\", params.url),\r\n                data: params.formData,\r\n                type: \"POST\",\r\n                contentType: false,\r\n                processData: false\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Commit an add or edit request for a grid\r\n         * @param params\r\n         * @returns {*}\r\n         */\r\n        commitGridAction: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"COMMIT\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending rollback request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-commit-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"COMMIT\"\r\n            });\r\n        },\r\n        /*\r\n         *   Commit an add or edit request for a grid\r\n         */\r\n        sendCheckpointAction: function(params) {\r\n            var self = this;\r\n\r\n            // Define data\r\n            var data = params.extra || {};\r\n\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"CHECKPOINT\";\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpath\"] = params.xpath;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"idRender\"] = params.idRender;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"xpathContext\"] = params.xpathContext;\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + self.Class.BA_PAGE_CACHE] = params.idPageCache;\r\n\r\n            if (params.contexttype) {\r\n                data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"contexttype\"] = params.contexttype;\r\n            }\r\n\r\n            // Log submit data\r\n            bizagi.debug(\"Sending checkpoint request for grid '\" + params.xpath + \"'\", data);\r\n\r\n            // If the parameter \"prepare\" is true, only return the data, so we can use the multiaction request\r\n            if (params.prepare)\r\n                return data;\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: params.url || self.serviceLocator.getUrl(\"render-grid-checkpoint-url\"),\r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\",\r\n                serviceType: \"CHECKPOINT\"\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Validate if url has 'http' string, in that case is not necesary add the pathToBase prefix\r\n         */\r\n        verifyMobilePathToBase: function(pathToBase, url) {\r\n            return bizagi.util.isSharepointContext() ? (url || \"\").replaceAll(pathToBase, \"\"): url;                \r\n        }\r\n\r\n    });\r\n","/*\r\n*   Name: Bizagi Rendering Services\r\n*   Author: Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This class will provide a facade to access to workportal REST services\r\n*/\r\n\r\nbizagi.render.services.service.extend(\"bizagi.render.services.service\", {},\r\n{\r\n    /* \r\n     *   Constructor\r\n     */\r\n    init: function(params) {\r\n        // Call base\r\n        var self = this;\r\n\r\n        self._super(params);\r\n        self.database = params.database;\r\n    },\r\n\r\n    getFormData: function(params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n\r\n            if (bizagi.util.isNativePluginSupported() && typeof(bizagiapp.getNativeFormData) !== \"undefined\") {\r\n                return self.getFormDataFromNative(params)\r\n                    .then(function(result) {\r\n                        return self.database.mergeForm(result[1], result[0].data);\r\n                    });\r\n\r\n            } else {\r\n                if(params.offlineType === 'task'){\r\n                    //It is not a start event\r\n                    if(params.isEdited || !params.isOpen){\r\n                        var def = new $.Deferred();\r\n                        $.when(self.database.getTaskData(params)).then(function(formData){\r\n                            \r\n                            var formPromise = self.database.getTaskForm(params)\r\n                            $.when(self.database.mergeDataDocument(formData.data, null, formPromise)).done(function(complexData){\r\n                                var object = {\r\n                                    data: complexData, \r\n                                    isOpen: params.isOpen\r\n                                };\r\n                                self.database.mergeForm(object, formPromise).then(function(mergedForm){\r\n                                    def.resolve(mergedForm);\r\n                                });\r\n                            });\r\n    \r\n                        });\r\n                        return def.promise();\r\n                    }\r\n                    else\r\n                        return self.database.getTaskForm(params);\r\n                }\r\n                else {\r\n                    return $.when(self.database.getCase(params.idCase))\r\n                    .then(function(response) {\r\n                        var idWfClass = $.trim(response.idWfClass.toString());\r\n                        return self.database.mergeForm(response, self.database.getFormData(idWfClass));\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    getOfflineImage: function(params, fileType){\r\n        if(params.offlineType === \"task\")\r\n            return this.database.getActivityImage(params, fileType);\r\n        else\r\n            return this.database.getStartDataImage(params, fileType);\r\n    },\r\n\r\n    getOfflineActivityDataImage: function(params, fileFormat){\r\n        return this.database.getActivityDataImage(params, fileFormat);\r\n    },\r\n\r\n    saveOfflineImage: function(params, image){\r\n        if (params.operationType === \"synchronization\")\r\n            return this.database.saveActivityFormImage(params, image);\r\n        else if (params.operationType === \"edition\"){\r\n            if(params.offlineType === \"task\")\r\n                return this.database.saveActivityDataImage(params, image);\r\n            else\r\n                return this.database.saveStartDataImage(params, image);\r\n        }\r\n        else \r\n            return null;\r\n    },\r\n\r\n    saveOfflineFile: function(params, file, mimeType){\r\n        if (params.operationType === \"synchronization\")\r\n            return this.database.saveActivityFormFile(params, file, mimeType);\r\n        else if (params.operationType === \"edition\"){\r\n            if(params.offlineType === \"task\")\r\n                return this.database.saveActivityDataFile(params, file, mimeType);\r\n            else\r\n                return this.database.saveStartDataFile(params, file, mimeType);\r\n        }\r\n        else \r\n            return null;\r\n    },\r\n\r\n    getOfflineFile: function(params, fileType, mimeType){\r\n        if(params.offlineType === \"task\")\r\n            return this.database.getActivityFile(params, fileType, mimeType);\r\n        else\r\n            return this.database.getStartDataFile(params, fileType, mimeType);\r\n    },\r\n\r\n    getOfflineActivityDataFile: function(params, fileType, mimeType){\r\n        return this.database.getActivityDataFile(params, fileType, mimeType);\r\n    },\r\n\r\n    getFormDataFromNative: function(params) {\r\n        var def = new $.Deferred();\r\n\r\n        bizagiapp.getNativeFormData(params, function(form) {\r\n\r\n            bizagiapp.getCase(params.idCase, function(caseInfo) {\r\n\r\n                var result = [JSON.parse(form), JSON.parse(caseInfo)];\r\n\r\n                def.resolve(result);\r\n\r\n            }, function(error) {\r\n\r\n                def.reject(error);\r\n\r\n            });\r\n\r\n\r\n        }, function(error) {\r\n            def.reject(error);\r\n        })\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    submitData: function(params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n\r\n            var data = self.resolveData(params.data || {}, params.xpathContext);\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = params.action;\r\n\r\n            if (bizagi.util.isNativePluginSupported() && typeof (bizagiapp.getNativeFormData) !== \"undefined\") {\r\n                return self.saveNativeFormInfo(params, data);\r\n            }\r\n\r\n            if(params.offlineType === 'task'){\r\n                return self.database.saveTaskData(params,data);                 \r\n            }\r\n            else{\r\n                return self.database.saveStartData(params, data);   \r\n            }\r\n            \r\n        }\r\n    },\r\n\r\n    saveNativeFormInfo: function(params, data) {\r\n        var self = this;\r\n\r\n        var def = new $.Deferred();\r\n\r\n        self.getFormDataFromNative(params).then(function(result) {\r\n            return self.database.nativesaveStartData(data, result[1], result[0].data)\r\n                .done(function(doc) {\r\n                    bizagiapp.saveFormData(params, doc);\r\n                    def.resolve(doc);\r\n                });\r\n        });\r\n\r\n        return def.promise();\r\n    }\r\n});\r\n","/*\r\n *   Name: BizAgi Rendering Services\r\n *   Author: Diego Parra\r\n *   Comments:\r\n *   -   This class will provide a facade to access to multiaction rendering REST services\r\n */\r\n$.Class.extend(\"bizagi.render.services.multiactionservice\", {\r\n    // Statics\r\n    BA_ACTION_PARAMETER_PREFIX: \"p_\",\r\n    BA_CONTEXT_PARAMETER_PREFIX: \"h_\",\r\n    BA_PAGE_CACHE: \"pageCacheId\"\r\n}, {\r\n\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function (service) {\r\n        this.service = service;\r\n        this.serviceLocator = service.serviceLocator;\r\n\r\n        // Multiaction - batch stuff\r\n        this.batch = {};\r\n        this.batchTimer = 50;\r\n        this.circularDependencies = new bizagi.circularDependencies();\r\n\r\n        // Create proxyed version of methods\r\n        this.replicateServiceMethods();\r\n    },\r\n\r\n    /*\r\n    *   Returns the internal service\r\n    */\r\n    getService: function () {\r\n        return this.service;\r\n    },\r\n\r\n    /*\r\n    *   Create a proxied multiaction version for service calls\r\n    */\r\n    replicateServiceMethods: function () {\r\n        var self = this;\r\n        for (var key in this.service.Class.prototype) {\r\n            // Omit the folowing methods\r\n            if (key == \"init\" || key == \"constructor\" || key == \"Class\" || key == \"multiaction\") continue;\r\n\r\n            // Replicate instance methods\r\n            self[key] = eval('var tmp = function(){ return this.proxyMethod(this.getService().' + key + ', arguments);};tmp');\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Perform the proxy call for each service method\r\n    */\r\n    proxyMethod: function (method, arguments) {\r\n        var service = this.service;\r\n\r\n        // Check if has only one argument, else execute directly\r\n        if (!arguments || arguments.length != 1) {\r\n            return method.apply(service, arguments);\r\n        }\r\n\r\n        // Check if the argument is object, else execute directly\r\n        if (typeof (arguments[0]) != \"object\") {\r\n            return method.apply(service, arguments);\r\n        }\r\n\r\n        var params = arguments[0];\r\n\r\n        // If the caller is requesting a prepare call, just execute the method with the current arguments\r\n        if (params.prepare == true) return method.apply(service, arguments);\r\n\r\n        // Prepare the ajax instead of sending it\r\n        params.prepare = true;\r\n        var action = method.apply(service, arguments);\r\n\r\n        return this.add(action);\r\n    },\r\n\r\n    /**\r\n    * This method make a standard error message\r\n    */\r\n    makeCircularDependenciesError: function (error) {\r\n        var messageTmpl = bizagi.localization.getResource(\"render-actions-loop-validation\");\r\n\r\n        return printf(messageTmpl, error.dependencyFrom, error.dependencyTo);\r\n    },\r\n\r\n\r\n    /*\r\n    *   Add an action to be performed in a multiaction, and be resolved later\r\n    *   returns a deferred\r\n    */\r\n    add: function (action) {\r\n        var self = this;\r\n        var deferred = new $.Deferred();\r\n\r\n        var name = action.h_action || \"unnamed\";\r\n\r\n        // Put here all actions to ignore in circular dependencies\r\n        var exceptionActions = [\"PROCESSPROPERTYVALUE\", \"LOADTEMPLATE\", \"ADDRELATIONWITHDATA\"];\r\n\r\n        if (exceptionActions.indexOf(name) < 0 && bizagi.override.detectCircularDependencies) {\r\n            self.circularDependencies.addNode(name, action);\r\n        }\r\n\r\n        // First clear previous timeout\r\n        clearTimeout(self.batchTimeout);\r\n        var tag = action.tag = Math.guid();\r\n        var singleAction = { action: action, deferred: deferred };\r\n        self.batch[tag] = singleAction;\r\n\r\n        // Start a new timeout\r\n        self.batchTimeout = setTimeout(function () {\r\n            var resolveDependencies = self.circularDependencies.resolve();\r\n\r\n            if (resolveDependencies.error) {\r\n                // Reset Queue\r\n                for (var i in self.batch) {\r\n                    var message = resolveDependencies.error.multiactionError;\r\n                    self.batch[i].deferred.reject(message);\r\n                }\r\n                self.batch = {};\r\n            } else {\r\n                self.fire();\r\n            }\r\n        }, self.batchTimer);\r\n\r\n        return deferred.promise();\r\n    },\r\n    /*\r\n    *   Fires up the multiaction\r\n    */\r\n    fire: function () {\r\n        var self = this;\r\n        var batch = {};\r\n\r\n        // Prepare actions and clone batch manually\r\n        var actions = [];\r\n        $.each(self.batch, function (tag, item) {\r\n            actions.push(item.action);\r\n            batch[tag] = item;\r\n        });\r\n\r\n        // Reset batch\r\n        self.batch = {};\r\n\r\n        // Fire ajax \r\n        $.when(self.execute({ actions: actions, rejectDeferreds: false }))\r\n                .done(function (responses) {\r\n\r\n                    // Process each response\r\n                    $.each(responses, function (i, response) {\r\n                        var tag = response.tag;\r\n                        if (!response.error) {\r\n                            batch[tag].deferred.resolve(response.result);\r\n                        } else {\r\n                            batch[tag].deferred.reject(response.error, response, response.error.message);\r\n                        }\r\n\r\n                        // Remove paired tag from collection\r\n                        delete batch[tag];\r\n                    });\r\n\r\n                    // Check if there are unpaired actions so we need to trigger fail deferred\r\n                    $.each(batch, function (i, item) {\r\n                        item.deferred.reject({ type: \"not-processed\", message: \"Operation didn't executed\" }, '', \"Operation didn't executed\");\r\n                    });\r\n                }).fail(function (xhr, type, error) {\r\n\r\n                    // Check if there are unpaired actions so we need to trigger fail deferred\r\n                    var errorMessage = typeof (error) !== \"undefined\" ? error.message : (error || \"Operation didn't executed\");\r\n                    $.each(batch, function (i, item) {\r\n                        item.deferred.reject({ type: \"not-processed\", message: errorMessage }, '', \"Operation didn't executed\");\r\n                    });\r\n                });\r\n    },\r\n    /*\r\n    *   Sends a multiaction to the server\r\n    */\r\n    execute: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n        var rejectDeferreds = params.rejectDeferreds !== undefined ? params.rejectDeferreds : true;\r\n        data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"multiaction\";\r\n\r\n        // Check action tag\r\n        $.each(params.actions, function (i, action) {\r\n            action[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"tag\"] = action.tag || i;\r\n            delete action.tag;\r\n        });\r\n\r\n        // Fill optional parameters\r\n        params = params || {};\r\n        if (params.actions) {\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"actions\"] = JSON.encode(params.actions);\r\n        }\r\n\r\n        // Log submit data\r\n        bizagi.debug(\"Performing multi-action\", data);\r\n\r\n        // Call ajax and returns promise\r\n        var deferred = new $.Deferred();\r\n        $.ajax({\r\n            url: self.serviceLocator.getUrl(\"render-multiaction\"),\r\n            data: data,\r\n            type: \"POST\",\r\n            dataType: \"json\",\r\n            serviceType: \"MULTIACTION\",\r\n            beforeSend: function (xhr, status) {\r\n                bizagi.multiactionConnection = bizagi.multiactionConnection || [];\r\n                bizagi.multiactionConnection.push(xhr);\r\n            }\r\n\r\n        }).done(function (responses) {\r\n            for (i in responses) {\r\n                if (typeof responses[i] !== \"function\") {\r\n                    var response = responses[i];\r\n                    if (response.error) {\r\n                        if (rejectDeferreds) {\r\n                            deferred.reject(this, \"servererror\", response);\r\n                            return;\r\n                        }\r\n\r\n                    }\r\n                }\r\n            }\r\n            deferred.resolve(responses);\r\n\r\n        }).fail(function (xhr) {\r\n            var response = xhr.responseText || xhr;\r\n            var finalResponse;\r\n            // Try to parse the response\r\n            try {\r\n                finalResponse = JSON.parse(response);\r\n            } catch (e) { }\r\n            deferred.reject(xhr, \"servererror\", finalResponse);\r\n        });\r\n\r\n        return deferred.promise();\r\n    }\r\n});\r\n","/*\r\n *   Name: BizAgi Rendering Services\r\n *   Author: Einer Perez\r\n *   Comments:\r\n *   -   This class will provide a facade to access to multiaction rendering REST services\r\n */\r\nbizagi.render.services.multiactionservice.extend(\"bizagi.render.services.metadatamultiactionservice\", {\r\n    // Statics\r\n    BA_ACTION_PARAMETER_PREFIX: \"p_\",\r\n    BA_CONTEXT_PARAMETER_PREFIX: \"h_\",\r\n    BA_PAGE_CACHE: \"h_pageCacheId\"\r\n}, {\r\n\r\n    /*\r\n    *   Sends a multiaction to the server\r\n    */\r\n    execute: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n        var rejectDeferreds = params.rejectDeferreds !== undefined ? params.rejectDeferreds : true;\r\n        data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"action\"] = \"multiaction\";\r\n\r\n        // Check action tag\r\n        $.each(params.actions, function (i, action) {\r\n            action[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"tag\"] = action.tag || i;\r\n            if (action[self.Class.BA_PAGE_CACHE]) {\r\n                data[self.Class.BA_PAGE_CACHE] = action[self.Class.BA_PAGE_CACHE];\r\n            }\r\n            delete action[self.Class.BA_PAGE_CACHE];\r\n            delete action.tag;\r\n        });\r\n\r\n        // Fill optional parameters\r\n        params = params || {};\r\n        if (params.actions) {\r\n            data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"actions\"] = JSON.encode(params.actions);\r\n        }\r\n\r\n        // Log submit data\r\n        bizagi.debug(\"Performing multi-action metadata\", data);\r\n\r\n        // Call ajax and returns promise\r\n        var deferred = new $.Deferred();\r\n        $.ajax({\r\n            url: self.serviceLocator.getUrl(\"render-multiaction-metadata\"),\r\n            data: data,\r\n            type: \"POST\",\r\n            dataType: \"json\",\r\n            serviceType: \"MULTIACTION\",\r\n            beforeSend: function (xhr, status) {\r\n                bizagi.multiactionConnection = bizagi.multiactionConnection || [];\r\n                bizagi.multiactionConnection.push(xhr);\r\n            }\r\n\r\n        }).done(function (responses) {\r\n            for (i in responses) {\r\n                if (typeof responses[i] !== \"function\") {\r\n                    var response = responses[i];\r\n                    if (response.error) {\r\n                        if (rejectDeferreds) {\r\n                            deferred.reject(this, \"servererror\", response);\r\n                            return;\r\n                        }\r\n\r\n                    }\r\n                }\r\n            }\r\n            deferred.resolve(responses);\r\n\r\n        }).fail(function (xhr) {\r\n            var response = xhr.responseText || xhr;\r\n            var finalResponse;\r\n            // Try to parse the response\r\n            try {\r\n                finalResponse = JSON.parse(response);\r\n            } catch (e) { }\r\n            deferred.reject(xhr, \"servererror\", finalResponse);\r\n        });\r\n\r\n        return deferred.promise();\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Database Plugin\r\n*   Author: Ricardo Perez\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\n//$.Class.extend\r\n$.Class(\"bizagi.workportal.services.db\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function() {\r\n        var self = this;\r\n\r\n        var queryString = bizagi.readQueryString();\r\n        self.disabledb = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n\r\n        self.globalId = (typeof BIZAGI_USER != \"undefined\")\r\n            ? (\"\" + BIZAGI_USER + \"-\" + BIZAGI_PROXY_PREFIX + \"-\" + BIZAGI_DOMAIN).toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n\r\n        if (!self.disabledb) {\r\n            self.createDatabases();\r\n        }\r\n    },\r\n\r\n    /*\r\n    * Delete all Documents (databases)\r\n    * Example for callback : function (err, info) { }\r\n    * \r\n    */\r\n    _destroy: function(callback) {\r\n        this.deleteDatabases(callback);\r\n    },\r\n\r\n    createDatabases: function(){\r\n        var self = this;\r\n        var globalIdHash = self.globalId.hashCode();\r\n        \r\n        self.dbRecentProcesses = new PouchDB(\"RecentProcesses\" + globalIdHash, { auto_compaction: true }); // Recent process\r\n        self.dbProcessesHierarchy =  new PouchDB(\"ProcessesHierarchy\" + globalIdHash, { auto_compaction: true }); // Process hierarchy to new cases creation\r\n        self.dbStartForms =  new PouchDB(\"StartForms\" + globalIdHash, { auto_compaction: true } ); // To save all forms for server\r\n        self.dbStartData =  new PouchDB(\"StartData\" + globalIdHash, { auto_compaction: true } ); // Save the data from forms    \r\n\r\n        //Offline forms in whole process\r\n        self.dbActivities = new PouchDB(\"Activities\" + globalIdHash, { auto_compaction: true } ); // Save the offline tasks that can be worked with offline forms\r\n        self.dbActivityForms = new PouchDB(\"ActivityForms\" + globalIdHash, { auto_compaction: true } ); \r\n        self.dbActivityData = new PouchDB(\"ActivityData\" + globalIdHash, { auto_compaction: true } ); // Cases in outbox that will be advanced\r\n    },\r\n\r\n    deleteDatabases: function(callback){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n\r\n        var databases = [\r\n            self.dbRecentProcesses,\r\n            self.dbProcessesHierarchy,\r\n            self.dbStartForms,\r\n            self.dbStartData,\r\n            self.dbActivities,\r\n            self.dbActivityForms,\r\n            self.dbActivityData\r\n        ]\r\n        \r\n        var databasesDeleted = 0;\r\n        if (typeof callback === \"undefined\") {\r\n            callback = function(err, info) {\r\n                if(err){\r\n                    def.reject(err);\r\n                }\r\n                else{\r\n                    databasesDeleted++;\r\n                    if(databasesDeleted == databases.length){\r\n                        def.resolve(\"All db deleted successfully\");\r\n                    }\r\n                }\r\n            };\r\n        }\r\n        \r\n        databases.forEach(function(database){\r\n            database.destroy(callback);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    restartDatabases: function(){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when(self.deleteDatabases())\r\n        .done( function(){\r\n            self.createDatabases();\r\n            def.resolve();\r\n        })\r\n        .fail( function(){\r\n            self.createDatabases();\r\n            def.resolve();\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getHierarchyObjects: function(obj, key, val) {\r\n        var self = this;\r\n        var objects = [];\r\n        for (var i in obj) {\r\n            if (!obj.hasOwnProperty(i)) continue;\r\n            if (typeof obj[i] == \"object\") {\r\n                objects = objects.concat(self.getHierarchyObjects(obj[i], key, val));\r\n            } else if (i == key && obj[i] == val || i == key && val == '') {\r\n                objects.push(obj);\r\n            } else if (obj[i] == val && key == '') {\r\n                // only add if the object is not already in the array\r\n                if (objects.lastIndexOf(obj) == -1) {\r\n                    objects.push(obj);\r\n                }\r\n            }\r\n        }\r\n        return objects;\r\n    },\r\n\r\n    /*\r\n    *   This method return all the open cases for the user authenticated from de DB\r\n    *   Returns a promise\r\n    */\r\n    getAllOpenCases: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        function map(doc) {\r\n            if (doc.closed === false && doc.createdBy.userName === \"admon\") {\r\n                emit(doc, null);\r\n            }\r\n        }\r\n\r\n        self.dbStartData.query({ map: map }, { reduce: false }, function(err, response) {\r\n            if (!err) {\r\n                def.resolve(response);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    }\r\n});\r\n","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author: Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\nvar STOREOBJECTNAME = \"offlineTasks\";\r\nbizagi.workportal.services.db.extend(\"bizagi.workportal.services.db\", {}, {\r\n\r\n    /**\r\n     * This method create a new case in the db to offline status\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    createNewCase: function(params) {\r\n        var self = this;\r\n        var idWfClass = params.idWfClass,\r\n            id = new Date().toISOString(),\r\n            def = new $.Deferred();\r\n\r\n        var offlineCase = {\r\n            _id: id,\r\n            idWfClass: idWfClass.toString(),\r\n            idWorkFlow: idWfClass.toString(),\r\n            idCase: id,\r\n            isFavorite: false,\r\n            globalId: self.globalId,\r\n            createdBy: {\r\n                Name: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\"\r\n            },\r\n            creationDate: new Date(),\r\n            process: params.process || \"Offline\",\r\n            categoryName: params.process || params.categoryName || \"Offline\",\r\n            displayName: params.displayName || \"Offline\",\r\n            radNumber: id,\r\n            // closed: false,\r\n            isOfflineForm: true,\r\n            formsRenderVersion: 2,\r\n            isOpen: true,\r\n            workItems: [\r\n                {\r\n                    idWorkItem: bizagi.util.uniqueID(),\r\n                    idTask: bizagi.util.uniqueID(),\r\n                    idCase: id,\r\n                    colorState: \"Green\",\r\n                    State: \"Green\",\r\n                    TaskName: params.process || \"Offline\"\r\n                }\r\n            ]\r\n        };\r\n\r\n        self.dbStartData.put(offlineCase, function callback(err, result) {\r\n            if (!err) {\r\n                def.resolve(offlineCase);\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Delete case\r\n     * @param {} params \r\n     * @returns {} promise \r\n     */\r\n    deleteCase: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbStartData.get(params.idCase, function(err, doc) {\r\n            if (!err) {\r\n                self.dbStartData.remove(doc, function(error, response) {\r\n                    if (!error) {\r\n                        def.resolve(response);\r\n                    } else {\r\n                        bizagi.log(\"Error erasing case\");\r\n                        def.reject(err);\r\n                    }\r\n                });\r\n\r\n            } else {\r\n                bizagi.log(\"Error, the case do not exist\");\r\n                def.reject(err);\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getWorkitems: function(params) {\r\n        var self = this,\r\n            def = new $.Deferred();\r\n\r\n        if(params.fromWorkItemId){\r\n            var doc = {\r\n                workItems: [params.fromWorkItemId]}\r\n            def.resolve(doc);\r\n        }\r\n        else{\r\n        self.dbStartData.get(params.idCase, function(err, doc) {\r\n            if (!err) {\r\n                def.resolve(doc);\r\n            } else {\r\n\r\n                def.reject(err);\r\n            }\r\n        });\r\n        }\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method return the categories as the services if exists in the database\r\n     * @param {} data \r\n     * @returns {} promise\r\n     */\r\n    getCategories: function(data) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        if (!data.enableOfflineForm) {\r\n            def.resolve({});\r\n        }\r\n        else{\r\n            var db = self.dbProcessesHierarchy;\r\n            $.when(bizagi.util.db.getDocument(db, self.globalId))\r\n            .then(function( processesHierarchyDoc ){\r\n                self.categories = processesHierarchyDoc.doc;\r\n                if (data.idApp || data.idCategory) {\r\n                    var groupCategory = getGroup(self.categories, data);\r\n                    def.resolve({\r\n                        category: groupCategory,\r\n                        totalApps: (data.idApp ? groupCategory.length : 0)\r\n                    });\r\n                } else {\r\n                    var tempCategories = self.categories;\r\n                    while (tempCategories.length == 1\r\n                        && (tempCategories[0].categories || tempCategories[0].subCategories)) {\r\n                        tempCategories = getGroup(\r\n                            tempCategories,\r\n                            tempCategories[0].appId ? { idApp: tempCategories[0].appId }\r\n                            : { idCategory: tempCategories[0].idCategory }\r\n                        );\r\n                    }\r\n\r\n                    def.resolve({\r\n                        category: tempCategories,\r\n                        totalApps: (tempCategories[0] && tempCategories[0].appId ? tempCategories.length : 0)\r\n                    });\r\n                }\r\n            })\r\n            .fail( function(){ //Document not found\r\n                def.resolve({\r\n                    category: [],\r\n                    totalApps: 0\r\n                });\r\n            });\r\n        }\r\n        return def.promise();\r\n\r\n        /**\r\n         * Get the group for new cases similar to service \r\n         * @param {} categories \r\n         * @param {} data \r\n         * @returns {} \r\n         */\r\n        function getGroup(categories, data) {\r\n            for (var i = 0, len = categories.length; i < len; i++) {\r\n                if (categories[i].appId && categories[i].appId == data.idApp) {\r\n                    return categories[i].categories;\r\n                }\r\n                if (categories[i].idCategory && categories[i].idCategory == data.idCategory) {\r\n                    return categories[i].subCategories;\r\n                } else {\r\n                    if (categories[i].categories) {\r\n                        var cat = getGroup(categories[i].categories, data);\r\n                        if (cat) {\r\n                            return cat;\r\n                        }\r\n                    }\r\n\r\n                    if (categories[i].subCategories) {\r\n                        var cat = getGroup(categories[i].subCategories, data);\r\n                        if (cat) {\r\n                            return cat;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This method return all the open cases for the user authenticated from de DB\r\n     * @returns {} promise\r\n     */\r\n    getAllOpenCases: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        function map(doc) {\r\n            if (doc.closed === false && doc.createdBy.userName === \"admon\") {\r\n                emit(doc, null);\r\n            }\r\n        }\r\n\r\n        self.dbStartData.query({\r\n            map: map\r\n        }, {\r\n            reduce: false\r\n        }, function(err, response) {\r\n            if (!err) {\r\n                def.resolve(response);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Get case by id\r\n     * @param {} idCase \r\n     * @returns {} \r\n     */\r\n    getCase: function(idCase) {\r\n        var self = this;\r\n        var db = self.dbStartData;\r\n        return bizagi.util.db.getDocument(db, idCase);\r\n    },\r\n\r\n    /**\r\n     * This method return the cases created offline by idWorkflow\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    getCustomizedColumnsData: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var cases = {\r\n            \"cases\": {\r\n                \"rows\": [],\r\n                \"totalPages\": 1,\r\n                \"page\": 1,\r\n                \"lstIdCases\": []\r\n            }\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"true\";\r\n\r\n        if (params.radnumber || params.radNumber) {\r\n            params[\"radNumber\"] = params.radnumber ? params.radnumber : params.radNumber;\r\n        }\r\n\r\n        if (params.idcase || params.idCase) {\r\n            params[\"radNumber\"] = params.idcase ? params.idcase : params.idCase;\r\n        }\r\n\r\n        self.dbStartData.allDocs({\r\n            include_docs: true\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.total_rows; i < len; i++) {\r\n                    if (isOpen === resp.rows[i].value.isOpen &&\r\n                    (typeof (params.radNumber) === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || params.radNumber.toString() === resp.rows[i].value.radNumber)) {\r\n                        var localCase = {\r\n                            id: resp.rows[i].id,\r\n                            idWFClass: resp.rows[i].idWFClass,\r\n                            idWorkFlow: resp.rows[i].id,\r\n                            taskState: \"\",\r\n                            isFavorite: resp.rows[i].value.isFavorite,\r\n                            guidFavorite: \"\",\r\n                            isOpen: resp.rows[i].value.isOpen,\r\n                            isOfflineForm: true,\r\n                            syncStatus: resp.rows[i].syncStatus,\r\n                            fields: [\r\n                                {\r\n                                    Value: resp.rows[i].value.process,\r\n                                    DisplayName: resp.rows[i].value.process,\r\n                                    DataType: \"VarChar\",\r\n                                    isRadNumber: false\r\n                                }, {\r\n                                    Value: resp.rows[i].value.creationDate,\r\n                                    DisplayName: \"Process creation date\",\r\n                                    DataType: \"DateTime\",\r\n                                    isRadNumber: false\r\n                                }\r\n                            ]\r\n                        };\r\n                        cases.cases.rows.push(localCase);\r\n                        cases.cases.lstIdCases.push(resp.rows[i].id);\r\n                    }\r\n                }\r\n\r\n                // Update counter\r\n                cases.cases.totalPages = cases.cases.page = cases.cases.rows.length > 0 ? 1 : 0;\r\n\r\n                def.resolve(JSON.stringify(cases));\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local data base\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getAllProcesses: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        if (typeof (params.inputtray) === \"undefined\") {\r\n            params.inputtray = true;\r\n        }\r\n\r\n        // params.inputtry: draft | outbox | inbox disable\r\n        var response = {\r\n            \"workflows\": {\r\n                \"taskstate\": \"\",\r\n                \"workflow\": []\r\n            }\r\n        };\r\n\r\n        //Reduce and rereduce functions search in http://docs.couchdb.org/en/latest/ddocs.html#view-functions\r\n        var queryFun = {\r\n            map: function(doc) {//Trae los documentos del usuario segun el filtro de all, o si estan en favorites etc\r\n                if (doc.idWfClass) {\r\n                    emit({\r\n                        idWf: doc.idWfClass,\r\n                        isOpen: doc.isOpen.toString()\r\n                    }, 1);\r\n                }\r\n            },\r\n            reduce: \"_count\"\r\n        };\r\n\r\n        self.dbProcessesHierarchy.get(self.globalId, function(err, doc) {\r\n            if (!err) {\r\n\r\n                self.dbStartData.query(queryFun, {\r\n                    reduce: true\r\n                }, function(error, resp) {\r\n                    if (!error) {\r\n                        for (var i = 0, len = resp.rows.length; i < len; i++) {\r\n                            if (resp.rows[i].key.isOpen == params.inputtray.toString()) {\r\n                                // Revisar si es necesario agregar aqui el parametro\r\n                                var cat = self.getHierarchyObjects(doc, \"idCategory\", resp.rows[i].key.idWf);\r\n                                response.isOpen = params.inputtray;\r\n                                response.workflows.workflow.push({\r\n                                    category: \"Offline Procesess\",\r\n                                    name: cat[0] ? cat[0].categoryName : \"\",\r\n                                    idworkflow: resp.rows[i].key.idWf,\r\n                                    count: resp.rows[i].value,\r\n                                    isFavorite: false\r\n                                });\r\n                            }\r\n                        };\r\n                        def.resolve(JSON.stringify(response));\r\n                    } else {\r\n                        def.reject(\"error\");\r\n                    }\r\n                });\r\n            } else {\r\n                def.reject(\"error\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getOutboxCases: function() {\r\n        // body\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var isOpen = false;\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                // Get the user documents according to filter all, or if its are in favorites etc.\r\n                emit(doc.isOpen,doc);\r\n                \r\n            }\r\n        };\r\n\r\n        self.dbStartData.query(queryFun, {\r\n                reduce: false,\r\n                key: isOpen\r\n            },\r\n            function(err, doc) {\r\n                if (!err) {\r\n                    def.resolve(doc);\r\n                } else {\r\n                    bizagi.log(\"Error loading data before syncronization\");\r\n                    def.reject(err);\r\n                }\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    getOutboxTaskCases: function(){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        self.dbActivityData.allDocs({include_docs:true}, function(err, resp) {\r\n            if (!err){\r\n                def.resolve(resp);\r\n            }\r\n            else\r\n                def.reject(err);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getOutboxTaskCasesFilteredBySyncStatus: function(pSyncStatus, includeDocs){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        pSyncStatus = pSyncStatus || \"none\";\r\n        var queryMap = {\r\n            map: function filterCaseBySyncStatus(doc, emit){\r\n                var emitValue = doc.syncStatus;\r\n                if( (pSyncStatus === \"any\" && emitValue) || (pSyncStatus === \"none\" && !emitValue) ){\r\n                    emitValue = pSyncStatus;\r\n                }\r\n                emit(emitValue);\r\n            }\r\n        };\r\n        \r\n\r\n        var filterParameters = {\r\n            key: pSyncStatus,\r\n            include_docs: includeDocs == true\r\n        }\r\n        self.dbActivityData.query(queryMap, filterParameters, function( error, result){\r\n            if(error){\r\n                def.reject(error);\r\n            }\r\n            else {\r\n                def.resolve(result.rows);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    existantCase: function(params, data) {\r\n        var self = this;\r\n        var idWfClass = params.idWfClass,\r\n            id = params.idCase + \"-\" + params.idWorkitem;\r\n\r\n        return offlineCase = {\r\n            _id: id,\r\n            idCase: id,\r\n            isFavorite: false,\r\n            globalId: self.globalId,\r\n            createdBy: {\r\n                Name: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\"\r\n            },\r\n            creationDate: new Date(),\r\n            process: params.process || \"Offline\",\r\n            categoryName: params.process || params.categoryName || \"Offline\",\r\n            displayName: params.displayName || \"Offline\",\r\n            radNumber: id,\r\n            // closed: false,\r\n            isOfflineForm: true,\r\n            formsRenderVersion: 2,\r\n            syncronized: false,\r\n            isOpen: true,\r\n            workItems: [\r\n                {\r\n                    idWorkItem: bizagi.util.uniqueID(),\r\n                    idTask: bizagi.util.uniqueID(),\r\n                    idCase: id,\r\n                    colorState: \"Green\",\r\n                    State: \"Green\",\r\n                    TaskName: params.process || \"Offline\"\r\n                }\r\n            ]\r\n        };\r\n    },\r\n\r\n    /**\r\n     * This method return the cases created offline by idWorkflow\r\n     * @param {} params \r\n     * @returns {}  Returns a promise\r\n     *  Struct: [\r\n     *   idCase, idWorkItem, idTask,\r\n     *   dueDate, processName, activityName,\r\n     *   customzedColumns: [key, value],\r\n     *   isOfflineForm, isOpen\r\n     * ]\r\n     */\r\n    getCasesList: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var cases = {\r\n            \"page\": 1,\r\n            \"totalPages\": 1,\r\n            \"elements\": []\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"drafts\";\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                emit(doc.isOpen, doc);\r\n            }\r\n        };\r\n\r\n        self.dbStartData.query(queryFun, {\r\n            reduce: false,\r\n            key: isOpen\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.rows.length; i < len; i++) {\r\n                    if (typeof params.radNumber === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || resp.rows[i].value.radNumber.toString().indexOf(params.radNumber.toString()) != -1) {\r\n\r\n                        var localCase = [\r\n                            resp.rows[i].value.idCase,\r\n                            resp.rows[i].value.workItems[0][\"idWorkItem\"][0] || \"\",\r\n                            resp.rows[i].value.workItems[0][\"idTask\"][0] || \"\",\r\n                            resp.rows[i].value.creationDate,\r\n                            resp.rows[i].value.categoryName,\r\n                            resp.rows[i].value.displayName,\r\n                            [\r\n                                [\"Case No\", resp.rows[i].value.idCase],\r\n                                [\"Process\", resp.rows[i].value.process],\r\n                                [\"Process creation date\", bizagi.util.formatDateTime(resp.rows[i].value.creationDate)]\r\n                            ],\r\n                            resp.rows[i].value.isOfflineForm,\r\n                            resp.rows[i].value.isOpen\r\n                        ];\r\n                        localCase.syncStatus = resp.rows[i].value.syncStatus;\r\n                        cases.elements.push(localCase);\r\n                    }\r\n                }\r\n                def.resolve(cases);\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local database\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    /*\r\n    *   This method return the cases created offline by idWorkflow\r\n    *   Returns a promise\r\n    */\r\n    getCustomizedColumnsNewData: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var cases = {\r\n            \"cases\": {\r\n                \"rows\": [],\r\n                \"totalPages\": 1,\r\n                \"page\": 1,\r\n                \"lstIdCases\": []\r\n            }\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"true\";\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                emit(doc.isOpen, doc);\r\n            }\r\n        };\r\n\r\n        self.dbStartData.query(queryFun, {\r\n            reduce: false,\r\n            key: isOpen\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.rows.length; i < len; i++) {\r\n                    if ( (typeof (params.radNumber) === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || params.radNumber.toString() === resp.rows[i].value.radNumber)) {\r\n                        var localCase = {\r\n                            id: resp.rows[i].value.idCase,\r\n                            idWFClass: resp.rows[i].value.idWfClass,\r\n                            idWorkFlow: resp.rows[i].value.idWorkFlow,\r\n                            taskState: \"\",\r\n                            isFavorite: resp.rows[i].value.isFavorite,\r\n                            guidFavorite: \"\",\r\n                            isOpen: resp.rows[i].value.isOpen,\r\n                            isAborted: false,\r\n                            isOfflineForm: true,\r\n                            fields: [\r\n                                resp.rows[i].value.idCase,\r\n                                resp.rows[i].value.process,\r\n                                {\r\n                                    \"workitems\": resp.rows[i].value.workItems\r\n                                },\r\n                                bizagi.util.formatDateTime(resp.rows[i].value.creationDate),\r\n                                \"\",\r\n                                bizagi.util.formatDateTime(resp.rows[i].value.creationDate)\r\n                            ]\r\n                        };\r\n                        cases.cases.rows.push(localCase);\r\n                        cases.cases.lstIdCases.push(resp.rows[i].id);\r\n                    }\r\n                }\r\n\r\n                // Update counter\r\n                cases.cases.totalPages = cases.cases.page = cases.cases.rows.length > 0 ? 1 : 0;\r\n\r\n                def.resolve(JSON.stringify(cases));\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local database\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Get recent processes\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    getRecentProcesses: function(params) {\r\n        var self = this;\r\n        var deferred = new $.Deferred();\r\n        var db = self.dbRecentProcesses;\r\n        $.when(bizagi.util.db.getDocument(db, self.globalId))\r\n        .then( function(recentProcesses){\r\n            deferred.resolve(recentProcesses);\r\n        })\r\n        .fail( function(error){\r\n            var emptyRecents = { \"processes\": [] };\r\n            deferred.resolve(emptyRecents);\r\n        })\r\n        return deferred.promise();\r\n    },\r\n    /**\r\n     * Save all the work items as a single object\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    saveOfflineTasks: function(tasksMap) {           \r\n        var self = this;\r\n        for( i in tasksMap) {\r\n            var currentTask = tasksMap[i];\r\n            var idWfClass = currentTask[10],\r\n            id = currentTask[0]+'-'+currentTask[1];\r\n\r\n            var offlineCase = {\r\n                _id: id,\r\n                endDate: currentTask.endDate,\r\n                group: currentTask.group,\r\n                icon: currentTask.icon,\r\n                state: currentTask.state,\r\n                taskState: currentTask.taskState,\r\n                shortEndDate: currentTask.shortEndDate,\r\n                atRiskTime: currentTask[11],\r\n                type: currentTask.type,\r\n                idWfClass: idWfClass.toString(),\r\n                idWorkFlow: idWfClass.toString(),\r\n                idCase: currentTask[0],\r\n                isFavorite: currentTask[9],\r\n                isEdited: false,\r\n                createdBy: {\r\n                    Name: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                    userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\"\r\n                },\r\n                creationDate: currentTask[12],\r\n                process: currentTask[4],\r\n                categoryName: tasksMap.process || tasksMap.categoryName || \"Offline\",\r\n                displayName: tasksMap.displayName || \"Offline\",\r\n                radNumber: id,\r\n                wfClassDisplayName: \"\",\r\n                // closed: false,\r\n                isOfflineForm: true,\r\n                formsRenderVersion: 2,\r\n                syncronized: false,\r\n                isOpen: true,\r\n                workItems: [\r\n                    {\r\n                        idWorkItem: currentTask[1],\r\n                        idTask: currentTask[2],\r\n                        idCase: currentTask[0],\r\n                        colorState: currentTask.taskstate,\r\n                        State: currentTask.taskstate,\r\n                        TaskName: currentTask[5]\r\n                    }\r\n                ]\r\n            };\r\n\r\n            bizagi.util.db.saveDocument(self.dbActivities, offlineCase);\r\n        }\r\n    },\r\n    \r\n\r\n    /**\r\n     * Clean all tasks\r\n     * @returns {} promise \r\n     */\r\n    cleanOfflineTasks: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbActivities.get(STOREOBJECTNAME, function(err, doc) {\r\n            if (!err) {\r\n                self.dbStartData.remove(doc, function(error, response) {\r\n                    if (!error) {\r\n                        def.resolve(response);\r\n                    } else {\r\n                        bizagi.log(\"Error erasing tasks\");\r\n                        def.reject(err);\r\n                    }\r\n                });\r\n\r\n            } else {\r\n                bizagi.log(\"Error, no offline tasks\");\r\n                def.reject(err);\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n    /**\r\n     * Get all offline tasks\r\n     * @returns {} promise \r\n     */\r\n    getOfflineCases: function(params) {\r\n        var self = this,\r\n        def = new $.Deferred();\r\n        var cases = {\r\n            \"page\": 1,\r\n            \"totalPages\": 1,\r\n            \"elements\": []\r\n        };\r\n        var isOpen = params.isOpen;\r\n        self.dbActivities.allDocs({include_docs:true}, function(err, resp) {  \r\n            if (!err){\r\n                for (var i = 0, len = resp.total_rows; i < len; i++) {   \r\n                    if(resp.rows[i].doc.isOpen == isOpen){\r\n                        var localCase = [\r\n                            resp.rows[i].doc.idCase,\r\n                            resp.rows[i].doc.workItems[0][\"idWorkItem\"] || \"\",\r\n                            resp.rows[i].doc.workItems[0][\"idTask\"] || \"\",\r\n                            resp.rows[i].doc.creationDate,\r\n                            resp.rows[i].doc.process,\r\n                            resp.rows[i].doc.workItems[0][\"TaskName\"],\r\n                            [\r\n                                [\"Case No\", resp.rows[i].doc.idCase],\r\n                                [\"Process\", resp.rows[i].doc.process],\r\n                                [\"Process creation date\", bizagi.util.formatDateTime(resp.rows[i].doc.creationDate)]\r\n                            ],\r\n                            resp.rows[i].doc.isOfflineForm,\r\n                            resp.rows[i].doc.isOpen,\r\n                            resp.rows[i].doc.isFavorite,\r\n                            resp.rows[i].doc.idWfClass,\r\n                            resp.rows[i].doc.atRiskTime,\r\n                            resp.rows[i].doc.creationDate\r\n                        ];\r\n                        localCase.isEdited = resp.rows[i].doc.isEdited; \r\n                        localCase.offlineType = 'task';\r\n                        localCase.endDate = resp.rows[i].doc.endDate;\r\n                        localCase.group = resp.rows[i].doc.group; \r\n                        localCase.icon = resp.rows[i].doc.icon;\r\n                        localCase.shortEndDate = resp.rows[i].doc.shortEndDate;\r\n                        localCase.state = resp.rows[i].doc.state;\r\n                        localCase.taskState = resp.rows[i].doc.taskState;\r\n                        localCase.type = resp.rows[i].doc.type;\r\n                        localCase.wfClassDisplayName = resp.rows[i].doc.wfClassDisplayName;\r\n                        localCase.syncStatus = resp.rows[i].doc.syncStatus;\r\n                        cases.elements.push(localCase);      \r\n                    }\r\n                }\r\n                def.resolve(cases);                \r\n            }                \r\n            else\r\n                def.reject(err);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    updateCaseSyncStatus: function(params){\r\n        \r\n        var self = this;        \r\n        var docId = params.id;\r\n        if(params.type === \"start\") {\r\n            return updateSyncAttribute(self.dbStartData, docId);\r\n        }\r\n        else {\r\n            return updateSyncAttribute(self.dbActivityData, docId)\r\n            .then(function() {\r\n                updateSyncAttribute(self.dbActivities, docId);\r\n            });\r\n        }\r\n                \r\n        function updateSyncAttribute(db,docId) {\r\n        return    $.when(bizagi.util.db.getDocument(db, docId))\r\n                    .then(function(doc){\r\n                        doc.syncStatus = params.syncStatus;\r\n                        return $.when(bizagi.util.db.saveDocument(db,doc))\r\n                        \r\n                    })\r\n                    .then(function(saveResp){\r\n                        return saveResp\r\n                    });\r\n                    \r\n        }\r\n    },\r\n\r\n    wasActivityWorkedOffline: function(internalId){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when( bizagi.util.db.getDocument(self.dbActivityData, internalId))\r\n        //Data exists, so was worked offline\r\n        .then( function(activityData){\r\n            def.resolve(true);\r\n        })\r\n        //Data doesn't exist, so not was worked offline\r\n        .fail( function(err){\r\n            def.resolve(false);\r\n        })\r\n        return def.promise();\r\n    }\r\n});","/*\r\n*   Name: BizAgi Database Plugin\r\n*   Author: oscaro\r\n*   Comments:\r\n*   -   This script creates a plugin to handler oll db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\nbizagi.workportal.services.db.extend(\"bizagi.workportal.services.db\", {}, {\r\n\r\n    /**\r\n     * This method return the form for a new case to offline status\r\n     * @param {} idWFClass\r\n     * @returns {} Returns a promise\r\n     */\r\n    getFormData: function(idWFClass) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbStartForms.get(idWFClass, function(err, doc) {\r\n            if (!err) {\r\n                if (typeof (doc.form) !== \"undefined\") {\r\n                    setTimeout(function() {\r\n                        def.resolve({ form: doc.form, type: \"form\" });\r\n                    }, 300);\r\n                } else {\r\n                    var responseText = {\r\n                        errorType: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form\"),\r\n                        message: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form-message\")                        \r\n                    };\r\n                    \r\n                    def.reject(JSON.stringify(responseText));\r\n                }\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method merge the form and the data to result form\r\n     * @param {} doc\r\n     * @param {} form\r\n     * @returns {}\r\n     */\r\n    mergeForm: function(doc, form) {\r\n\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        $.when(form).done(function(form) {\r\n            if (!doc.data) {\r\n                def.resolve(form);\r\n            } else {\r\n                // If it case is in outbox or closed, hide buttons in the form\r\n                if (!doc.isOpen) {\r\n                    form.form.buttons = [];\r\n                    if(Object.keys(doc.data).length === 0) {\r\n                        fillForm(form.form.elements, {\r\n                            key: \"read-only-form\",\r\n                            value: \"\"\r\n                        });    \r\n                    }\r\n                }\r\n\r\n                for (prop in doc.data) {\r\n                    fillForm(form.form.elements, {\r\n                        key: prop,\r\n                        value: doc.data[prop]\r\n                    });\r\n                }\r\n\r\n                function fillForm(element, data) {\r\n                    if (element.length && element.length > 0) {\r\n                        for (var i = 0, len = element.length; i < len; i++) {\r\n                            fillForm(element[i], data);\r\n                        }\r\n                    } else {\r\n                        if (element.container) {\r\n                            fillForm(element.container.elements, data);\r\n                        } else {\r\n                            // If it case is in outbox or closed, make all renders in the form not editable\r\n                            if (!doc.isOpen) {\r\n                                element.render.properties.editable = false;\r\n                            }\r\n\r\n                            if (element.render.properties.xpath == data.key) {\r\n                                if (element.render.properties.type === \"grid\") {\r\n                                    self.setRenderGridValues(element.render);\r\n                                }\r\n                                self.setRenderValues(element.render.properties, data.value);\r\n                            }\r\n\r\n                        }\r\n                    }\r\n                }\r\n\r\n                def.resolve(form);\r\n            }\r\n        }).fail(function(cause) {\r\n            if (!cause.responseText)\r\n                var responseText = {\r\n                    errorType: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form\"),\r\n                    message: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form-message\")\r\n                };\r\n\r\n            cause.responseText = JSON.stringify(responseText);\r\n\r\n            def.reject(cause);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Set render Grid values\r\n     * @param {} render\r\n     * @returns {}\r\n     */\r\n    setRenderGridValues: function(render) {\r\n        render.properties.data.columns = [];\r\n        for (var i = 0, length = render.elements.length; i < length; i++) {\r\n            render.properties.data.columns.push(render.elements[i].render.properties.xpath);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This function sets the type of each xpath\r\n     * @param {} doc\r\n     * @param {} form\r\n     * @returns {}\r\n     */\r\n    setDataType: function(doc, form) {\r\n\r\n    },\r\n\r\n    /**\r\n     *  This method return the categories like the services if exists in the database\r\n     * @param {} params\r\n     * @param {} data\r\n     * @returns {} Returns a promise\r\n     */\r\n    setRenderValues: function(params, data) {\r\n        var type = params.type;\r\n\r\n        if (!type) type = \"label\";\r\n\r\n        var typeGroupBasic = [\"text\", \"label\", \"number\", \"money\", \"date\", \"boolean\", \"geolocation\", \"hidden\", \"upload\"];\r\n        var typeGroupCombo = [\"combo\", \"cascadingCombo\", \"radio\", \"list\"];\r\n\r\n        if (typeGroupBasic.indexOf(type) !== -1) {\r\n            params.value = data.value;\r\n            return;\r\n        }\r\n\r\n        if (typeGroupCombo.indexOf(type) !== -1) {\r\n            for (var i = 0, len = params.data.length; i < len; i++) {\r\n                if (params.data[i].id == data.value) {\r\n                    params.value = [{ id: data.value, value: params.data[i].value }];\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        if (type === \"search\") {\r\n            for (var j = 0, lengthData = params.data.length; j < lengthData; j++) {\r\n                if (params.data[j].id == data.value.id) {\r\n                    params.value = data.value;\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (type === \"image\") {\r\n            params.value = data;\r\n            return;\r\n        }\r\n\r\n        if (type === \"grid\") {\r\n            //New complex object for grids\r\n            params[\"deleted-records\"] = data.value[\"deleted-records\"] ? data.value[\"deleted-records\"] : {};\r\n            data.value = data.value.rows;\r\n            \r\n            params.data.records = data.value.length;\r\n            params.data.total = 1;\r\n            params.data.page = 1;\r\n\r\n            var lengthColumns = params.data.columns.length;\r\n            var tmpEditAndVisible = [];\r\n            var lengthRows = data.value.length;\r\n            params.data.rows = [];\r\n            for (var row = 0; row < lengthRows; row++) {\r\n                // Add random value\r\n                var details = data.value[row].length>lengthColumns ? data.value[row][lengthColumns] : undefined;\r\n                var idRow = details ? details.idRow : bizagi.util.randomNumber(); \r\n                \r\n                var tmpElement = [];\r\n                var tempRow = [];                \r\n                tmpElement[0] = idRow;\r\n\r\n                for (var col = 0; col < lengthColumns; col++) {                    \r\n                    var index = -1;\r\n                    if (data.value[row][col]) {\r\n                        if(data.value[row][col].xpath){\r\n                            index = params.data.columns.indexOf(data.value[row][col].xpath);\r\n                            tempRow[index] = data.value[row][col];    \r\n                        }\r\n                        else if(!data.value[row][col].changes){\r\n                            tempRow[col] = data.value[row][col];\r\n                        }\r\n                    }\r\n                    tempRow[col] = (tempRow[col]) ? tempRow[col] : {};\r\n                    tmpElement[tmpElement.length] = \"true\";\r\n                }\r\n                var mergedRow = $.merge([idRow], tempRow);\r\n                                 \r\n                if(details && details.isNew) {\r\n                    params[\"new-records\"] = params[\"new-records\"] ? params[\"new-records\"] : {};\r\n                    params[\"new-records\"][idRow] = details.changes;\r\n                }\r\n                params.data.rows.push(mergedRow);\r\n                tmpEditAndVisible[tmpEditAndVisible.length] = tmpElement;\r\n            }\r\n\r\n            params.data.editable = tmpEditAndVisible;\r\n            params.data.visible = tmpEditAndVisible;\r\n\r\n            return;\r\n        }\r\n\r\n        // No type supported\r\n        try {\r\n            params.value = data.value;\r\n        } catch (e) {\r\n        }\r\n\r\n        bizagi.log(type + \" not supported in render factory\", data, \"error\");\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * This method simulate a summary response\r\n     * @param {} params\r\n     * @returns {} Returns a promise\r\n     */\r\n    getSummary: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        if(params.offlineType && params.offlineType === \"task\"){\r\n            var activityCaseId = params.idCase + \"-\" + params.idWorkitem;\r\n            self.dbActivities.get(activityCaseId, function(err, doc) {\r\n                if (!err)\r\n                    def.resolve($.extend(doc, {\r\n                        processPath: \"/\",\r\n                        currentState: doc.workItems,\r\n                        countAssigness: 0,\r\n                        countEvents: 0,\r\n                        isOpen: doc.isOpen.toString(),\r\n                        countSubProcesses: 0\r\n                    }));\r\n                else\r\n                    def.reject(err);\r\n            });\r\n        }\r\n        else {\r\n            self.dbStartData.get(params.idCase, function(err, doc) {\r\n                if (!err)\r\n                    def.resolve($.extend(doc, {\r\n                        processPath: \"/\",\r\n                        currentState: doc.workItems,\r\n                        countAssigness: 0,\r\n                        countEvents: 0,\r\n                        isOpen: doc.isOpen.toString(),\r\n                        countSubProcesses: 0\r\n                    }));\r\n                else\r\n                    def.reject(err);\r\n            });\r\n        }\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Save the image as an attachment to the form.\r\n     * This function only is called for store locally images in tasks \r\n     * that already exists in the server. For save new images use the saveActivityDataImage function.\r\n     * @param {*} params \r\n     * @param {*} image The blob corresponding to the image\r\n     */\r\n    saveActivityFormImage: function(params, image){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        var mimeType = \"image/png\";\r\n        return bizagi.util.db.saveAttachment(self.dbActivityForms, documentId, attachmentId, mimeType, image, true);\r\n    },\r\n\r\n    /**\r\n     * Save the image as an attachment to the Activity Data.\r\n     * This function only is called for store images uploaded in offline mode. \r\n     * @param {*} params \r\n     * @param {*} image The blob corresponding to the image\r\n     */\r\n    saveActivityDataImage: function(params, image){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        var mimeType = \"image/png\";\r\n        return bizagi.util.db.saveAttachment(self.dbActivityData, documentId, \r\n            attachmentId, mimeType, image, true);\r\n    },\r\n\r\n    getActivityDataImage: function(params, fileType){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        bizagi.util.db.getAttachment(self.dbActivityData,documentId, attachmentId, fileType, \"image/png\",\r\n            function(attachment){\r\n                def.resolve(attachment);\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    getActivityImage: function(params, fileType){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n\r\n        bizagi.util.db.getAttachment(self.dbActivityData, documentId, attachmentId, fileType, undefined, \r\n            function(dataResult){\r\n                if(dataResult !== undefined){\r\n                    def.resolve(dataResult);\r\n                }\r\n                else{\r\n                    bizagi.util.db.getAttachment(self.dbActivityForms, documentId, attachmentId, fileType, undefined, \r\n                        function(formResult){\r\n                            if(formResult !== undefined){\r\n                                def.resolve(formResult);\r\n                            }\r\n                            else{\r\n                                def.resolve(\"\");\r\n                            }\r\n                        }\r\n                    );\r\n                }\r\n            } \r\n        );\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Save the image as an attachment to the Start Form Data.\r\n     * This function only is called for store images uploaded in offline mode. \r\n     * @param {*} params \r\n     * @param {*} image The blob corresponding to the image\r\n     */\r\n    saveStartDataImage: function(params, image){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase;\r\n        var mimeType = \"image/png\";\r\n        return bizagi.util.db.saveAttachment(self.dbStartData, documentId, attachmentId, mimeType, image, true);\r\n    },  \r\n    \r\n    getStartDataImage: function(params, fileType){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase;\r\n        bizagi.util.db.getAttachment(self.dbStartData,documentId, attachmentId, fileType, \"image/png\",\r\n            function(attachment){\r\n                def.resolve(attachment);\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    saveActivityFormFile: function(params, file, mimeType){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        return bizagi.util.db.saveAttachment(self.dbActivityForms, documentId, attachmentId, mimeType, file, true);\r\n    },\r\n\r\n    saveActivityDataFile: function(params, file, mimeType){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        return bizagi.util.db.saveAttachment(self.dbActivityData, documentId, attachmentId, mimeType, file, true);\r\n    },\r\n\r\n    getActivityDataFile: function(params, fileType, mimeType){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        bizagi.util.db.getAttachment(self.dbActivityData,documentId, attachmentId, fileType, mimeType,\r\n            function(attachment){\r\n                def.resolve(attachment);\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    getActivityFile: function(params, fileType, mimeType){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n\r\n        bizagi.util.db.getAttachment(self.dbActivityData, documentId, attachmentId, fileType, mimeType, \r\n            function(dataResult){\r\n                if(dataResult !== undefined){\r\n                    def.resolve(dataResult);\r\n                }\r\n                else{\r\n                    bizagi.util.db.getAttachment(self.dbActivityForms, documentId, attachmentId, fileType, mimeType, \r\n                        function(formResult){\r\n                            if(formResult !== undefined){\r\n                                def.resolve(formResult);\r\n                            }\r\n                            else{\r\n                                def.resolve(null);\r\n                            }\r\n                        }\r\n                    );\r\n                }\r\n            } \r\n        );\r\n\r\n        return def.promise();\r\n    },\r\n    \r\n    /**\r\n     * Save the file as an attachment to the Start Form Data.\r\n     * This function only is called for store files uploaded in offline mode. \r\n     * @param {*} params \r\n     * @param {*} file The blob corresponding to the file\r\n     */\r\n    saveStartDataFile: function(params, file, mimeType){\r\n        var self = this;\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase;\r\n        return bizagi.util.db.saveAttachment(self.dbStartData, documentId, \r\n            attachmentId, mimeType, file, true);\r\n    },\r\n    \r\n    getStartDataFile: function(params, fileType, mimeType){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var attachmentId = params.id;\r\n        var documentId = params.idCase;\r\n        bizagi.util.db.getAttachment(self.dbStartData,documentId, attachmentId, fileType, mimeType,\r\n            function(attachment){\r\n                def.resolve(attachment);\r\n            });\r\n        return def.promise();\r\n    },\r\n    \r\n    \r\n    /**\r\n     * Save the form with all xpaths resolved\r\n     * @param {R} params, workitem id, case id\r\n     * @param {*} data: form data\r\n     */\r\n    saveTaskForm: function(params, formData){\r\n        var db = this.dbActivityForms;\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        formData._id = documentId;\r\n        formData.dataChangeset = params.dataChangeset;\r\n        return bizagi.util.db.saveDocument(db, formData)\r\n    },\r\n\r\n    getTaskForm: function(params){\r\n        var db = this.dbActivityForms;\r\n        var docId = params.idCase + '-' + params.idWorkitem;\r\n        return bizagi.util.db.getDocument(db, docId);\r\n    },\r\n\r\n    deleteTaskForm: function(params){\r\n        var documentId = params.idCase + '-' + params.idWorkitem;\r\n        var db = this.dbActivityForms;\r\n        return bizagi.util.db.deleteDocument(db, documentId);\r\n    },\r\n\r\n    updateTaskForm: function(params, formData){\r\n        this.saveTaskForm(params, formData);\r\n    },\r\n\r\n    getStartForm: function(params){\r\n        var db = this.dbStartForms;\r\n        var docId = params.idProcess;\r\n        return bizagi.util.db.getDocument(db, docId);\r\n    },\r\n\r\n    saveStartForm: function(params, form){\r\n        var db = this.dbStartForms;\r\n        form._id = params.idProcess;\r\n        return bizagi.util.db.saveDocument(db, form);\r\n    },\r\n\r\n    mergeTaskAction: function( oldAction, newAction ){\r\n        Object.keys(newAction).forEach( function(key){\r\n                oldAction[key] = newAction[key];                        \r\n        } );\r\n        return oldAction;\r\n    },\r\n\r\n    /*\r\n    *   This method save the form data of the created case\r\n    *   Returns a promise\r\n    */\r\n    saveTaskData: function(params, data) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var docId = params.idCase + '-' + params.idWorkitem;\r\n        var db = self.dbActivityData;\r\n        $.when( bizagi.util.db.getDocument(db, docId))\r\n        .then( function(document){  \r\n            var dataUpdated = document.data?\r\n                self.mergeTaskAction(document.data, data) :\r\n                data;\r\n            performSaveTaskData(dataUpdated);\r\n        })\r\n        //First save\r\n        .fail( function(){\r\n            performSaveTaskData(data);\r\n        });\r\n        \r\n        function performSaveTaskData(dataToSave){\r\n            var doc = {\r\n                _id: docId,\r\n                data: dataToSave,\r\n                idForm: params.idForm\r\n            }\r\n            $.when(bizagi.util.db.saveDocument(db, doc))\r\n            .then( function(saveResult){\r\n                var markTaskPromise;\r\n                if(params.action === \"next\"){\r\n                    markTaskPromise = self.closeOfflineTask(params);\r\n                }else if(params.action === \"save\"||params.action===\"SAVE\"){\r\n                    markTaskPromise = self.markTaskEdited(params);\r\n                }\r\n                $.when(markTaskPromise)\r\n                .then( function(markResponse){\r\n                    def.resolve(markResponse);\r\n                })\r\n                .fail( function(markError){\r\n                    def.reject(markError);\r\n                });\r\n            })\r\n            .fail( function(saveError){\r\n                def.reject(saveError);\r\n            });\r\n        }\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    separateComplexControls: function(params, data){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var mergePromise;\r\n        if(params.offlineType && params.offlineType !== \"task\"){\r\n            mergePromise = new $.Deferred(),\r\n            mergePromise.resolve(data);\r\n        }\r\n        else{\r\n            mergePromise = self.mergeDataDocument(data, null, self.getTaskForm(params));\r\n        }\r\n        $.when(mergePromise).done( function(mergeRes){\r\n            var images = [];\r\n            var uploads = [];\r\n            var grids = [];\r\n            Object.keys(mergeRes).forEach(function(key){\r\n                var value = mergeRes[key];\r\n                if(value && value.renderId && value.type && value.type === \"image\"){\r\n                    value.xpath = key;\r\n                    images.push(value);\r\n                    delete data[key];\r\n                }\r\n                else if (value && value.renderId && value.type && value.type === \"upload\"){\r\n                    value.xpath = key;\r\n                    uploads.push(value);\r\n                    delete data[key];\r\n                }\r\n                else if (value && value.renderId && value.type && value.type === \"grid\"){\r\n                    value.xpath = key;\r\n                    grids.push(value);\r\n                    delete data[key];\r\n                }\r\n            });\r\n            def.resolve({\r\n                data: data,\r\n                images: images,\r\n                uploads: uploads,\r\n                grids: grids});\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    markTaskEdited: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var db = self.dbActivities;\r\n        var docId = params.idCase + '-' + params.idWorkitem;\r\n\r\n        $.when(bizagi.util.db.getDocument(db, docId))\r\n        .then(function(document){\r\n            document.isEdited = true;\r\n            $.when(bizagi.util.db.saveDocument(db, document))\r\n            .then( function(updateResponse){\r\n                def.resolve(updateResponse);\r\n            })\r\n            .fail( function(updateErr){\r\n                def.reject(updateErr);\r\n            });\r\n        })\r\n        .fail(function(getErr){\r\n            def.reject(getErr);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    closeOfflineTask: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var db = self.dbActivities;\r\n        var docId = params.idCase + '-' + params.idWorkitem;\r\n\r\n        $.when(bizagi.util.db.getDocument(db, docId))\r\n        .then(function(document){\r\n            document.isOpen = false;\r\n            $.when(bizagi.util.db.saveDocument(db, document))\r\n            .then( function(updateResponse){\r\n                def.resolve(updateResponse);\r\n            })\r\n            .fail( function(updateErr){\r\n                def.reject(updateErr);\r\n            });\r\n        })\r\n        .fail(function(getErr){\r\n            def.reject(getErr);\r\n        })\r\n        return def.promise();\r\n    },\r\n\r\n    getTaskData: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var id = params.idCase + '-' + params.idWorkitem;\r\n        self.dbActivityData.get(id, function(err, resp) {\r\n            if (!err)\r\n                def.resolve(resp);\r\n            else\r\n                def.reject(err);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    deleteTaskData: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var id = params.idCase + '-' + params.idWorkitem;\r\n        self.dbActivityData.get(id, function(getErr, getResp) {\r\n            if (!getErr){\r\n                self.dbActivityData.remove(getResp, function(err, resp) {\r\n                    if(!err){\r\n                        console.log(\"Case deleted of outbox\", params);\r\n                        def.resolve(resp);\r\n                    }\r\n                    else{\r\n                        def.reject(err);\r\n                    }\r\n                });\r\n            }\r\n            else{\r\n                def.resolve(getErr);\r\n                console.log(\"Case not exists in outbox\", params);\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n    \r\n    /*\r\n    *   This method saves the form info in the db\r\n    *   Returns a promise\r\n    */\r\n   saveStartData: function(params, data) {\r\n    var self = this;\r\n    var def = new $.Deferred();\r\n\r\n    self.dbStartData.get(params.idCase, function(err, doc) {\r\n        if (!err) {\r\n            self.mergeDataDocument(data, doc, self.getFormData(doc.idWfClass.toString()))\r\n                .done(function(resp) {\r\n                    doc = self.mergeData(data, doc, resp);\r\n                    if(params.idForm){\r\n                        doc.idForm = params.idForm;\r\n                    }\r\n                    self.dbStartData.put(doc, function(error, response) {\r\n                        if (!error)\r\n                            def.resolve(response);\r\n                        else\r\n                            def.reject(error);\r\n                    });\r\n                });\r\n\r\n        } else {\r\n            def.reject(err);\r\n        }\r\n    });\r\n\r\n    return def.promise();\r\n    },\r\n\r\n    filterXpathsByType: function(form, type){\r\n        var xpaths = [];\r\n        var elements = form.form.elements;\r\n        extractRenderElements(elements, xpaths);\r\n\r\n        function extractRenderElements(elements, xpaths){\r\n            if(elements){\r\n                for (var i = 0; i < elements.length; i++) {\r\n                    var isContainer = elements[i].container;\r\n                    if( isContainer ){\r\n                        extractRenderElements(elements[i].container.elements, xpaths);\r\n                    }\r\n                    else {\r\n                        extractXpathFromRenderProperties(elements[i].render.properties, xpaths);\r\n                    }\r\n                }\r\n            }            \r\n        }\r\n\r\n        function extractXpathFromRenderProperties(renderProperties, xpaths){ \r\n            if (renderProperties.xpath && renderProperties.type === type) {\r\n                xpaths.push({\r\n                    xpath: renderProperties.xpath,\r\n                    renderId: renderProperties.id,\r\n                    value: renderProperties.value\r\n                });\r\n            }\r\n        }\r\n\r\n        return xpaths;\r\n\r\n    },\r\n\r\n    mergeDataDocument: function(data, doc, form) {\r\n        var defer = new $.Deferred();\r\n        var response = {};\r\n\r\n        $.when(form).done(function(resp) {\r\n\r\n            for (prop in data) {\r\n                if (prop != \"h_action\") {\r\n                    response[prop] = {};\r\n                    response[prop].value = data[prop];\r\n                    fillForm(resp.form.elements, {\r\n                        key: prop,\r\n                        value: data[prop]\r\n                    });\r\n                }\r\n            }\r\n\r\n            function fillForm(element, datafill) {\r\n                if (element.length && element.length > 0) {\r\n                    for (var i = 0, len = element.length; i < len; i++) {\r\n                        fillForm(element[i], datafill);\r\n                    }\r\n                } else {\r\n                    if (element.container) {\r\n                        fillForm(element.container.elements, datafill);\r\n                    } else {\r\n                        if (element.render.properties.xpath == datafill.key) {\r\n                            response[datafill.key].DataType = element.render.properties.dataType || \"\";\r\n                            response[datafill.key].type = element.render.properties.type || \"\";\r\n                            response[datafill.key].renderId = element.render.properties.id;                            \r\n                        }                        \r\n                    }\r\n                }\r\n            }\r\n\r\n            defer.resolve(response);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    mergeData: function (data, doc, resp) {\r\n\r\n        if (data.h_action == \"next\") {\r\n            doc.isOpen = false;\r\n        }\r\n\r\n        doc.data = doc.data || {};\r\n\r\n        for (var i in resp) {\r\n\r\n            var assigned = false;\r\n\r\n            for (var j in doc.data) {\r\n\r\n                if (i == j) {\r\n\r\n                    if (bizagi.util.isEmpty(resp[i]) || bizagi.util.isEmpty(resp[i].value)) {\r\n                        delete doc.data[j];\r\n                        assigned = true;\r\n                    } else {\r\n                        doc.data[j] = resp[i];\r\n                        assigned = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!assigned) {\r\n                doc.data[i] = resp[i];\r\n            }\r\n        }\r\n\r\n        return doc;\r\n\r\n    },\r\n\r\n    nativeSaveFormInfo: function (data, doc, form) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.mergeDataDocument(data, doc, form)\r\n            .done(function (resp) {\r\n                doc = self.mergeData(data, doc, resp);\r\n                def.resolve(doc);\r\n            });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    deleteNextButton: function(data){\r\n        if(data.form && data.form.buttons){\r\n\r\n            data.form.buttons = data.form.buttons.filter(function(value){\r\n                var properties = value.button.properties;\r\n                if(properties){\r\n                    return !(properties.caption && properties.caption===\"render-form-button-next\");\r\n                }\r\n                return true;\r\n            });\r\n        }\r\n        return data;\r\n    }\r\n\r\n});","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author: Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n$.Class.extend(\"bizagi.workportal.services.pullWorker\", {}, {\r\n    init: function(params) {\r\n        var self = this;\r\n        var queryString = bizagi.readQueryString();\r\n\r\n        self.services = params;\r\n        self.database = params.database;\r\n        \r\n        var querydisable = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n        self.disabledb = querydisable;\r\n\r\n        self.globalId = (typeof BIZAGI_USER != \"undefined\")\r\n            ? (\"\" + BIZAGI_USER + \"-\" + BIZAGI_PROXY_PREFIX + \"-\" + BIZAGI_DOMAIN).toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n    },\r\n\r\n    pull: function() {\r\n        var self = this;\r\n        if (self.disabledb) {\r\n            return false;\r\n        }\r\n        return self.syncOfflineCases();\r\n    },\r\n    \r\n    /**\r\n     * This function send to the server the offline cases created\r\n     * @param {} argument \r\n     * @returns {} \r\n     */\r\n    syncOfflineCases: function(argument) {\r\n        var self = this;\r\n        if (typeof (self.database) !== \"undefined\") {\r\n            self.synchronizing = self.synchronizing || false;\r\n\r\n            if (!self.synchronizing) {\r\n                self.synchronizing = true;\r\n                self.pushInProgressPromise = new $.Deferred();\r\n                var syncCasesQueue = new bizagiQueue();\r\n                var syncStarts = self.syncOfflineStartCases(syncCasesQueue);\r\n                var syncTasks = self.syncOfflineTaskCases(syncCasesQueue);\r\n\r\n                $.when(syncStarts, syncTasks)\r\n                .then( function( startRes, taskRes){\r\n                    return syncCasesQueue.execute();\r\n                })\r\n                .then(function(){\r\n                    self.synchronizing = false;\r\n                    self.pushInProgressPromise.resolve(true);\r\n                })\r\n                .fail( function( queueErr, startErr, taskErr ){\r\n                    console.log(\"Error pushing cases to server with errors\", startErr, taskErr,  queueErr);\r\n                    self.synchronizing = false;\r\n                    self.pushInProgressPromise.reject(false);\r\n                });\r\n            }\r\n        }\r\n        \r\n        return self.pushInProgressPromise.promise();\r\n    },\r\n\r\n    syncSingleOfflineStartCase: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when(self.database.getCase(params.idCase))\r\n        .then( function(newCase){\r\n            var syncCaseParams = {\r\n                idCase: newCase.idCase,\r\n                data: newCase.data || {},\r\n                idProcess: newCase.idWorkFlow,\r\n                type : \"start\",\r\n                id: newCase.idCase,\r\n                syncStatus : \"started\"\r\n            }\r\n            return self.generateSyncCasePromise(syncCaseParams);\r\n        })\r\n        .then( function(syncResponse){\r\n            def.resolve(syncResponse);\r\n        })\r\n        .fail( function(err){\r\n            def.reject(err);\r\n        })\r\n        return def.promise();\r\n    },\r\n\r\n    syncOfflineStartCases: function(synchCasesQueue){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when(self.database.getOutboxCases())\r\n        .done(function(response) {\r\n            for (var i = 0; i < response.rows.length; i++) {  \r\n                var newCase = response.rows[i].value;\r\n                \r\n                if(newCase.syncStatus){\r\n                    continue;\r\n                }\r\n\r\n                var syncCaseParams = {\r\n                    idCase: newCase.idCase,\r\n                    data: newCase.data || {},\r\n                    idProcess: newCase.idWorkFlow,\r\n                    type : \"start\",\r\n                    id: newCase.idCase,\r\n                    syncStatus : \"started\"\r\n                }                \r\n                \r\n                synchCasesQueue.add(self.generateSyncCasePromise(syncCaseParams));\r\n            }\r\n            def.resolve({\"Start\" : response.rows.length});\r\n        })\r\n        .fail(function(err){\r\n            def.reject(err);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n\r\n    syncOfflineTaskCases: function(synchCasesQueue){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var syncStatusCriteria = \"none\";\r\n        self.database.getOutboxTaskCasesFilteredBySyncStatus(syncStatusCriteria, true).done(\r\n            function(responses){\r\n                for (var i = 0; i < responses.length; i++) {                      \r\n                    var caseData = responses[i].doc;\r\n                    var itemId = responses[i].id;\r\n                    var id = itemId.split('-');\r\n                    var syncCaseParams = {\r\n                        idCase: id[0],\r\n                        idWorkitem: id[1],\r\n                        data: caseData.data || {},\r\n                        type : \"task\",\r\n                        id: itemId,\r\n                        syncStatus : \"started\"\r\n                    }\r\n                    synchCasesQueue.add(self.generateSyncCasePromise(syncCaseParams));\r\n                }\r\n                def.resolve({\"Tasks\" : responses.length});\r\n            }\r\n        )\r\n        .fail(function(err){\r\n            def.reject(err);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n\r\n    generateSyncCasePromise: function(syncCaseParams){\r\n        var self = this;\r\n        var syncDeferred = new $.Deferred();                \r\n        $.when(self.database.updateCaseSyncStatus(syncCaseParams))\r\n        .then(function(){\r\n            var syncPromise;\r\n            if(syncCaseParams.type == \"start\")\r\n                syncPromise = self.services.syncOfflineStartCase(syncCaseParams);\r\n            else\r\n                syncPromise = self.services.syncOfflineTaskCase(syncCaseParams);\r\n            return syncPromise;\r\n        })\r\n        .then( function(successMsg){\r\n            syncDeferred.resolve(successMsg);\r\n        })\r\n        .fail( function(error){\r\n            syncDeferred.reject(error);\r\n        });\r\n        return syncDeferred.promise();\r\n    }\r\n\r\n});","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author:Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\n$.Class.extend(\"bizagi.workportal.services.fetchWorker\", {}, {\r\n    init: function(params) {\r\n        var self = this;\r\n        self.services = params;\r\n        self.db = params.database;\r\n        self.maxOfflineCases = 100;\r\n        self.secondsBeforeAllowFetchAgain = 2;\r\n        self.tasksSyncDelda = 8;\r\n        self.startSyncDelta = 8;\r\n        var queryString = bizagi.readQueryString();\r\n        self.disabledb = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n\r\n        self.globalId = (typeof BIZAGI_USER != \"undefined\")\r\n            ? (\"\" + BIZAGI_USER + \"-\" + BIZAGI_PROXY_PREFIX + \"-\" + BIZAGI_DOMAIN).toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n\r\n        self.fetchInProgress = false;\r\n        \r\n    },\r\n\r\n    fetch: function(argument){\r\n        var self = this;\r\n\t\t\t   \r\n        var timeBeforeFetch = self.secondsBeforeAllowFetchAgain * 1000;\r\n        if( self.lastFetch){\r\n            if( self.lastFetch + timeBeforeFetch < Date.now() && !self.fetchInProgress){\r\n                executeFetch();\r\n\t\t\t}\r\n        }\r\n        else if (!self.fetchInProgress){\r\n            executeFetch();\r\n        }        \r\n\r\n        function executeFetch(){\r\n            self.fetchInProgress = true;\r\n            self.fetchInProgressPromise = new $.Deferred();\r\n            var fetchStartForms = self.fetchStartForms();\r\n            var fetchTaskForms = self.fetchTasks();\r\n            $.when.apply($, [fetchStartForms, fetchTaskForms] )\r\n            .then(function(){\r\n                self.lastFetch = Date.now();           \r\n                self.fetchInProgressPromise.resolve(true);\r\n                self.fetchInProgress = false;\r\n            })\r\n            .fail( function(){\r\n                self.fetchInProgressPromise.reject(\"Error executing fetch v2\");\r\n                self.fetchInProgress = false;\r\n            })\r\n\r\n            $.when(self.services.getRecentOfflineProcesses())\r\n            .then(function(recentProcceses){\r\n                self.saveRecentProcesses(recentProcceses);\r\n            })\r\n        }\r\n\t\t\t   \r\n        return self.fetchInProgressPromise.promise();\r\n    },\r\n\r\n    fetchStartForms: function(){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        //Check last synchronization and evaluate if is needed\r\n        var db = self.db.dbProcessesHierarchy;\r\n        $.when(bizagi.util.db.getDocument(db, self.globalId))\r\n        .then( function(document){\r\n            var isSyncNeeded = true;\r\n            var lastSync = document.lastSynchronization;            \r\n            if(document.doc && lastSync){\r\n                var currentTime = Date.now();                \r\n                isSyncNeeded = lastSync + (self.startSyncDelta * 60*60*1000 ) < currentTime;  \r\n            }\r\n            if(isSyncNeeded){\r\n                performStartFormsFetch();\r\n            }\r\n            else{\r\n                console.log(\"Sync start forms is not needed\");\r\n                def.resolve(\"Sync start forms is not needed\");\r\n            }\r\n        })\r\n        //First synchronization\r\n        .fail( function(){\r\n            performStartFormsFetch();\r\n        });\r\n\r\n        function performStartFormsFetch(){\r\n            var offlineProcessTree;\r\n            $.when(self.services.processesHierarchy())\r\n            .then(function(dataCategory) {                \r\n                offlineProcessTree = dataCategory;\r\n                offlineProcessTree.lastSynchronization = Date.now();\r\n                return self.saveProcessesHierarchy(offlineProcessTree);                \r\n            })\r\n            .then( function(){\r\n                return self.processTreeToFetchStartForms(offlineProcessTree)\r\n            })\r\n            .then( function(){\r\n                console.log(\"Sv2: Offline start forms downloaded succesfully\");\r\n                def.resolve();\r\n            })\r\n            .fail( function(err){\r\n                console.log(\"Sv2: Problem downloading any offline start form\", err);\r\n                def.reject();\r\n            });\r\n        }\r\n        return def.promise();\r\n    },\r\n\r\n    processTreeToFetchStartForms: function(offlineProcessTree){\r\n        var self = this;\r\n        var downloadFormsQueue = new bizagiQueue();\r\n\r\n        for(var i=0; i< offlineProcessTree.length; i++ ){\r\n            var currentApplication = offlineProcessTree[i];\r\n            var categories = currentApplication.categories;\r\n            for( var j = 0; j < categories.length; j++){\r\n                processCategory(categories[j], downloadFormsQueue);\r\n            }\r\n        }\r\n\r\n        function processCategory(category, downloadFormsQueue){\r\n            if(category.isProcess === \"true\" && category.hasOfflineForm){\r\n                var downloadProm = self.services.downloadOfflineStartForm({\r\n                    idProcess: category.idCategory\r\n                });\r\n                downloadFormsQueue.add(downloadProm);\r\n            }\r\n            else if (category.subCategories){\r\n                for( var k = 0; k < category.subCategories.length; k++){\r\n                    var subCategory = category.subCategories[k];\r\n                    processCategory(subCategory, downloadFormsQueue);\r\n                }\r\n            }\r\n        }\r\n\r\n        return downloadFormsQueue.execute();\r\n    },\r\n\r\n    fetchTasks: function() {\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var data = {};\r\n        data[\"pageSize\"] = self.maxOfflineCases;\r\n        data[\"page\"] = 1;\r\n\r\n        var urlMobile = self.services.serviceLocator.getUrl(\"offline-tasks\");\r\n\r\n        $.when( $.read(urlMobile, data))\r\n        .then( function(response){\r\n            return self.processTasksToFetchForms(response)\r\n        })\r\n        .then(function(processTasksResponse){\r\n            def.resolve(processTasksResponse);\r\n        })\r\n        .fail( function(err){\r\n            def.reject(err);\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    processTasksToFetchForms: function(tasksResponse) {        \r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var tasksToDownload = {};\r\n        var serverTasks = {};\r\n        var elementsMap = {};\r\n\r\n        var row, i = -1;    \r\n        var actualDate = new Date();\r\n        var statusFunction = tasksResponse.advanceSearch ? self.services.defineActivityStateByTaskState :self.services.defineActivityStateByDate;\r\n        var queueReadyToProcess = new $.Deferred();\r\n        var processOfflineFormsQueue = new bizagiQueue();\r\n\r\n        while ((row = tasksResponse.rows[++i])) {\r\n            var tempElement = {}, el = [\"\", \"\", \"\", \"\", \"\", \"\", [], \"\", \"\", \"\", \"\",\"\",\"\"];\r\n            var field, j = -1;\r\n            while ((field = tasksResponse.headers[++j])) {\r\n                tempElement[field.fieldName.toLowerCase()] = {\r\n                    \"displayName\": field.displayName,\r\n                    \"value\": row[j]\r\n                };\r\n                self.services.serializeActivity(el, field.fieldName.toLowerCase(), tempElement[field.fieldName.toLowerCase()]);\r\n            }\r\n            \r\n            var tmpElement = el;\r\n            var status = {};\r\n\r\n            status = statusFunction(tmpElement[3], tmpElement.taskstate);\r\n\r\n            // Time to atRiskTimeDelta\r\n            if (tmpElement.length >= 10 && parseInt(tmpElement[11], 10) > 0) {\r\n                var tmpEndDate = new Date(tmpElement[3]);\r\n\r\n                if (actualDate.getTime() > tmpEndDate.getTime()) {\r\n                    status.state = \"red\";\r\n                } else {\r\n                    if (actualDate.getTime() > (tmpEndDate.getTime() - (parseInt(tmpElement[11], 10) * 60000))) {\r\n                        status.state = \"yellow\";\r\n                    } else {\r\n                        status.state = \"green\";\r\n                    }\r\n                }\r\n            }\r\n\r\n            //Tasks are offline\r\n            tmpElement[7] = true;\r\n            tmpElement = $.extend({}, tmpElement, status, {\r\n                \"endDate\": tmpElement[3],\r\n                \"idworkitem\": tmpElement[1],\r\n                \"idwfclass\": !bizagi.util.validateFeatureSupport(\"advancedSearch\") ? tmpElement[7] : tmpElement[10]\r\n            })\r\n\r\n            var idCase = tmpElement[0];\r\n            var idWorkitem = tmpElement[1];\r\n            var internalId = idCase + \"-\" + idWorkitem;\r\n            serverTasks[internalId] = true;\r\n\r\n            elementsMap[internalId] = tmpElement;\r\n\r\n            tasksToDownload[internalId] = {\r\n                idCase: idCase,\r\n                idWorkitem: idWorkitem, \r\n                syncDelda: self.tasksSyncDelda,                \r\n                dataChangeset: tmpElement.dataChangeset\r\n            };       \r\n        }\r\n\r\n        //Si el task fue trabajado y tiene error de sincronizacin no se actualiza.\r\n        $.when(self.db.getOutboxTaskCasesFilteredBySyncStatus(\"any\", false))\r\n        .then( function(result){\r\n            for(var i=0; i <result.length; i++){\r\n                delete tasksToDownload[result[i].id];\r\n                delete elementsMap[result[i].id];\r\n            }\r\n            return true;\r\n        })\r\n        //Buscar las actividades que estn en el inbox offline\r\n        .then( function(){\r\n            var localActivitiesProm = new $.Deferred();\r\n            self.db.dbActivities.allDocs({include_docs:false}, function(err, response){\r\n                if(err)\r\n                    localActivitiesProm.reject();\r\n                else\r\n                    localActivitiesProm.resolve(response.rows);\r\n            });\r\n            return localActivitiesProm.promise();\r\n        })\r\n        //Si una actividad ya no est disponible (est local pero no en la lista del server) se debe eliminar la actividad, la forma y el caso\r\n        .then( function(localActivities) {\r\n            for(var i = 0; i < localActivities.length; i++){\r\n                localActivityInternalId = localActivities[i].id;\r\n                var isActivityAvailable = serverTasks[localActivityInternalId] ? true : false;\r\n                if(!isActivityAvailable){\r\n                    processOfflineFormsQueue.add(self.deleteLocalDataIfActivityWasNotWorked(localActivityInternalId));\r\n                }\r\n            }\r\n            queueReadyToProcess.resolve();\r\n        })\r\n        .fail( function(error){\r\n            console.log(\"Diff algorithm error\", error);\r\n            queueReadyToProcess.resolve();\r\n        });\r\n\r\n        $.when(queueReadyToProcess)\r\n        .then(function(){\r\n            return self.services.database.saveOfflineTasks(elementsMap);  \r\n        })\r\n        .then( function (saveResponse) {\r\n            for (var key in tasksToDownload){\r\n                var processFormProm = self.services.downloadOfflineTaskForm(tasksToDownload[key]);\r\n                processOfflineFormsQueue.add(processFormProm);\r\n            }\r\n            return processOfflineFormsQueue.execute();\r\n        })\r\n        .then(function(result){\r\n            def.resolve(result);\r\n        })\r\n        .fail(function(err){\r\n            def.reject(err);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    deleteLocalDataIfActivityWasNotWorked: function(internalId){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        $.when(self.db.wasActivityWorkedOffline(internalId))\r\n        .then( function(wasWorked){\r\n            if(!wasWorked){\r\n                var deleteActivity = bizagi.util.db.deleteDocument(self.db.dbActivities, internalId);\r\n                var deleteActivityForm = bizagi.util.db.deleteDocument(self.db.dbActivityForms, internalId);\r\n            }\r\n            def.resolve();\r\n        })\r\n        return def.promise();\r\n    },\r\n\r\n    getHierarchyObjects: function(obj, key, val) {\r\n        var self = this;\r\n        var objects = [];\r\n\r\n        for (var i in obj) {\r\n            if (!obj.hasOwnProperty(i)) continue;\r\n            if (typeof obj[i] == \"object\") {\r\n                objects = objects.concat(self.getHierarchyObjects(obj[i], key, val));\r\n            } else if (i == key && obj[i] == val || i == key && val == '') {\r\n                objects.push(obj);\r\n            } else if (obj[i] == val && key == '') {\r\n                // Only add if the object is not already in the array\r\n                if (objects.lastIndexOf(obj) == -1) {\r\n                    objects.push(obj);\r\n                }\r\n            }\r\n        }\r\n\r\n        return objects;\r\n    },\r\n\r\n\r\n    /**\r\n     * Save in the db the user permitions to create cases\r\n     * @param {} hierarchy \r\n     * @returns {} \r\n     */\r\n    saveProcessesHierarchy: function(hierarchy) {\r\n        var self = this;\r\n        var db = self.db.dbProcessesHierarchy;\r\n        var docHierarchy = {\r\n            _id: self.globalId,\r\n            doc: hierarchy\r\n        };\r\n        //Hierarchy is an array, the atribute should be saved in the document\r\n        if(hierarchy.lastSynchronization){\r\n            docHierarchy.lastSynchronization = hierarchy.lastSynchronization;\r\n        }\r\n        return bizagi.util.db.saveDocument( db, docHierarchy);\r\n    },\r\n\r\n    /**\r\n     * Save in the db the user recent processes to create cases\r\n     * @param {} processes \r\n     * @returns {} \r\n     */\r\n    saveRecentProcesses: function(processes) {\r\n        var self = this;\r\n        var db = self.db.dbRecentProcesses;\r\n        processes._id = self.globalId;\r\n        return bizagi.util.db.saveDocument( db, processes);\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Database Plugin\r\n*   Author: Ricardo Perez\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\n//$.Class.extend\r\n$.Class(\"bizagi.workportal.services.db.old\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function() {\r\n        var self = this;\r\n\r\n        var queryString = bizagi.readQueryString();\r\n        self.disabledb = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n\r\n        if (!self.disabledb) {\r\n            self.dbProcessRecent = new PouchDB(\"DataProcessesRecent\"); // Recent process\r\n            self.dbProcessHierarchy = new PouchDB(\"DataProcessesHierarchy\"); // Process hierarchy to new cases creation\r\n            self.dbForms = new PouchDB(\"DataRenderForms\"); // To save all forms for server\r\n            self.dbCases = new PouchDB(\"DataRenderCases\"); // Save the data from forms            \r\n        }\r\n\r\n        self.globalId = (typeof BIZAGI_USER != \"undefined\")\r\n            ? BIZAGI_USER.toLowerCase() + \"-\" + BIZAGI_PROXY_PREFIX.toLowerCase() + \"-\" + BIZAGI_DOMAIN.toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n    },\r\n\r\n    /*\r\n    * Delete all Documents (databases)\r\n    * Example for callback : function (err, info) { }\r\n    * \r\n    */\r\n    _destroy: function(callback) {\r\n        var self = this;\r\n        if (typeof callback === \"undefined\") {\r\n            callback = function(err, info) {\r\n            };\r\n        }\r\n\r\n        PouchDB.destroy(\"DataRenderForms\", callback);\r\n        PouchDB.destroy(\"DataRenderCases\", callback);\r\n        PouchDB.destroy(\"DataProcessesHierarchy\", callback);\r\n        PouchDB.destroy(\"DataProcessesRecent\", callback);        \r\n    },\r\n\r\n    getHierarchyObjects: function(obj, key, val) {\r\n        var self = this;\r\n        var objects = [];\r\n        for (var i in obj) {\r\n            if (!obj.hasOwnProperty(i)) continue;\r\n            if (typeof obj[i] == \"object\") {\r\n                objects = objects.concat(self.getHierarchyObjects(obj[i], key, val));\r\n            } else if (i == key && obj[i] == val || i == key && val == '') {\r\n                objects.push(obj);\r\n            } else if (obj[i] == val && key == '') {\r\n                // only add if the object is not already in the array\r\n                if (objects.lastIndexOf(obj) == -1) {\r\n                    objects.push(obj);\r\n                }\r\n            }\r\n        }\r\n        return objects;\r\n    },\r\n\r\n    /*\r\n    *   This method return all the open cases for the user authenticated from de DB\r\n    *   Returns a promise\r\n    */\r\n    getAllOpenCases: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        function map(doc) {\r\n            if (doc.closed === false && doc.createdBy.userName === \"admon\") {\r\n                emit(doc, null);\r\n            }\r\n        }\r\n\r\n        self.dbCases.query({ map: map }, { reduce: false }, function(err, response) {\r\n            if (!err) {\r\n                def.resolve(response);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    }\r\n});\r\n","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author: Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\n\r\nbizagi.workportal.services.db.old.extend(\"bizagi.workportal.services.db.old\", {}, {\r\n\r\n    /**\r\n     * This method create a new case in the db to offline status\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    createNewCase: function(params) {\r\n        var self = this;\r\n        var idWfClass = params.idWfClass,\r\n            id = new Date().toISOString(),\r\n            def = new $.Deferred();\r\n\r\n        var offlineCase = {\r\n            _id: id,\r\n            idWfClass: idWfClass.toString(),\r\n            idWorkFlow: idWfClass.toString(),\r\n            idCase: id,\r\n            isFavorite: false,\r\n            globalId: self.globalId,\r\n            createdBy: {\r\n                Name: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\"\r\n            },\r\n            creationDate: new Date(),\r\n            process: params.process || \"Offline\",\r\n            categoryName: params.process || params.categoryName || \"Offline\",\r\n            displayName: params.displayName || \"Offline\",\r\n            radNumber: id,\r\n            // closed: false,\r\n            isOfflineForm: true,\r\n            formsRenderVersion: 2,\r\n            syncronized: false,\r\n            isOpen: true,\r\n            workItems: [\r\n                {\r\n                    idWorkItem: Math.guid(),\r\n                    idTask: Math.guid(),\r\n                    idCase: id,\r\n                    colorState: \"Green\",\r\n                    State: \"Green\",\r\n                    TaskName: params.process || \"Offline\"\r\n                }\r\n            ]\r\n        };\r\n\r\n        self.dbCases.put(offlineCase, function callback(err, result) {\r\n            if (!err) {\r\n                def.resolve(offlineCase);\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Delete case\r\n     * @param {} params \r\n     * @returns {} promise \r\n     */\r\n    deleteCase: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbCases.get(params.idCase, function(err, doc) {\r\n            if (!err) {\r\n                self.dbCases.remove(doc, function(error, response) {\r\n                    if (!error) {\r\n                        def.resolve(response);\r\n                    } else {\r\n                        bizagi.log(\"Error erasing case\");\r\n                        def.reject(err);\r\n                    }\r\n                });\r\n\r\n            } else {\r\n                bizagi.log(\"Error, the case do not exist\");\r\n                def.reject(err);\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getWorkitems: function(params) {\r\n        var self = this,\r\n            def = new $.Deferred();\r\n\r\n        self.dbCases.get(params.idCase, function(err, doc) {\r\n            if (!err) {\r\n                def.resolve(doc);\r\n            } else {\r\n\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method return the categories as the services if exists in the database\r\n     * @param {} data \r\n     * @returns {} promise\r\n     */\r\n    getCategories: function(data) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        if (!data.enableOfflineForm) {\r\n            def.resolve({});\r\n        }\r\n\r\n        self.dbProcessHierarchy.get(self.globalId, function(err, doc) {\r\n            if (!err) {\r\n                self.categories = doc.doc;\r\n\r\n                if (data.idApp || data.idCategory) {\r\n                    var groupCategory = getGroup(self.categories, data);\r\n                    def.resolve({\r\n                        category: groupCategory,\r\n                        totalApps: (data.idApp ? groupCategory.length : 0)\r\n                    });\r\n                } else {\r\n                    var tempCategories = self.categories;\r\n                    while (tempCategories.length == 1\r\n                        && (tempCategories[0].categories || tempCategories[0].subCategories)) {\r\n                        tempCategories = getGroup(\r\n                            tempCategories,\r\n                            tempCategories[0].appId ? { idApp: tempCategories[0].appId }\r\n                            : { idCategory: tempCategories[0].idCategory }\r\n                        );\r\n                    }\r\n\r\n                    def.resolve({\r\n                        category: tempCategories,\r\n                        totalApps: (tempCategories[0] && tempCategories[0].appId ? tempCategories.length : 0)\r\n                    });\r\n                }\r\n            } else {\r\n                def.reject(\"could not extract this document\");\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n\r\n        /**\r\n         * Get the group for new cases similar to service \r\n         * @param {} categories \r\n         * @param {} data \r\n         * @returns {} \r\n         */\r\n        function getGroup(categories, data) {\r\n            for (var i = 0, len = categories.length; i < len; i++) {\r\n                if (categories[i].appId && categories[i].appId == data.idApp) {\r\n                    return categories[i].categories;\r\n                }\r\n                if (categories[i].idCategory && categories[i].idCategory == data.idCategory) {\r\n                    return categories[i].subCategories;\r\n                } else {\r\n                    if (categories[i].categories) {\r\n                        var cat = getGroup(categories[i].categories, data);\r\n                        if (cat) {\r\n                            return cat;\r\n                        }\r\n                    }\r\n\r\n                    if (categories[i].subCategories) {\r\n                        var cat = getGroup(categories[i].subCategories, data);\r\n                        if (cat) {\r\n                            return cat;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This method return all the open cases for the user authenticated from de DB\r\n     * @returns {} promise\r\n     */\r\n    getAllOpenCases: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        function map(doc) {\r\n            if (doc.closed === false && doc.createdBy.userName === \"admon\") {\r\n                emit(doc, null);\r\n            }\r\n        }\r\n\r\n        self.dbCases.query({\r\n            map: map\r\n        }, {\r\n            reduce: false\r\n        }, function(err, response) {\r\n            if (!err) {\r\n                def.resolve(response);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Get case by id\r\n     * @param {} idCase \r\n     * @returns {} \r\n     */\r\n    getCase: function(idCase) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbCases.get(idCase, function(err, doc) {\r\n            if (!err) {\r\n                def.resolve(doc);\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method return the cases created offline by idWorkflow\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    getCustomizedColumnsData: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var cases = {\r\n            \"cases\": {\r\n                \"rows\": [],\r\n                \"totalPages\": 1,\r\n                \"page\": 1,\r\n                \"lstIdCases\": []\r\n            }\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"true\";\r\n\r\n        if (params.radnumber || params.radNumber) {\r\n            params[\"radNumber\"] = params.radnumber ? params.radnumber : params.radNumber;\r\n        }\r\n\r\n        if (params.idcase || params.idCase) {\r\n            params[\"radNumber\"] = params.idcase ? params.idcase : params.idCase;\r\n        }\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                emit(doc.globalId, doc);\r\n            }\r\n        };\r\n\r\n        self.dbCases.query(queryFun, {\r\n            reduce: false,\r\n            key: self.globalId\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.total_rows; i < len; i++) {\r\n                    if (isOpen === resp.rows[i].value.isOpen &&\r\n                    (typeof (params.radNumber) === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || params.radNumber.toString() === resp.rows[i].value.radNumber)) {\r\n                        var localCase = {\r\n                            id: resp.rows[i].id,\r\n                            idWFClass: resp.rows[i].idWFClass,\r\n                            idWorkFlow: resp.rows[i].id,\r\n                            taskState: \"\",\r\n                            isFavorite: resp.rows[i].value.isFavorite,\r\n                            guidFavorite: \"\",\r\n                            isOpen: resp.rows[i].value.isOpen,\r\n                            isOfflineForm: true,\r\n                            fields: [\r\n                                {\r\n                                    Value: resp.rows[i].value.process,\r\n                                    DisplayName: resp.rows[i].value.process,\r\n                                    DataType: \"VarChar\",\r\n                                    isRadNumber: false\r\n                                }, {\r\n                                    Value: resp.rows[i].value.creationDate,\r\n                                    DisplayName: \"Process creation date\",\r\n                                    DataType: \"DateTime\",\r\n                                    isRadNumber: false\r\n                                }\r\n                            ]\r\n                        };\r\n                        cases.cases.rows.push(localCase);\r\n                        cases.cases.lstIdCases.push(resp.rows[i].id);\r\n                    }\r\n                }\r\n\r\n                // Update counter\r\n                cases.cases.totalPages = cases.cases.page = cases.cases.rows.length > 0 ? 1 : 0;\r\n\r\n                def.resolve(JSON.stringify(cases));\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local data base\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getAllProcesses: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        if (typeof (params.inputtray) === \"undefined\") {\r\n            params.inputtray = true;\r\n        }\r\n\r\n        // params.inputtry: draft | outbox | inbox disable\r\n        var response = {\r\n            \"workflows\": {\r\n                \"taskstate\": \"\",\r\n                \"workflow\": []\r\n            }\r\n        };\r\n\r\n        //Reduce and rereduce functions search in http://docs.couchdb.org/en/latest/ddocs.html#view-functions\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                //Trae los documentos del usuario segun el filtro de all, o si estan en favorites etc\r\n                if (doc.idWfClass && doc.globalId) {\r\n                    emit({\r\n                        idWf: doc.idWfClass,\r\n                        gId: doc.globalId,\r\n                        isOpen: doc.isOpen.toString()\r\n                    }, 1);\r\n                }\r\n            },\r\n            reduce: \"_count\"\r\n        };\r\n\r\n        self.dbProcessHierarchy.get(self.globalId, function(err, doc) {\r\n            if (!err) {\r\n\r\n                self.dbCases.query(queryFun, {\r\n                    reduce: true\r\n                }, function(error, resp) {\r\n                    if (!error) {\r\n                        for (var i = 0, len = resp.total_rows; i < len; i++) {\r\n                            if (resp.rows[i].key.gId == self.globalId && resp.rows[i].key.isOpen == params.inputtray.toString()) {\r\n                                // Revisar si es necesario agregar aqui el parametro\r\n                                var cat = self.getHierarchyObjects(doc, \"idCategory\", resp.rows[i].key.idWf);\r\n                                response.isOpen = params.inputtray;\r\n                                response.workflows.workflow.push({\r\n                                    category: \"Offline Procesess\",\r\n                                    name: cat[0] ? cat[0].categoryName : \"\",\r\n                                    idworkflow: resp.rows[i].key.idWf,\r\n                                    count: resp.rows[i].value,\r\n                                    isFavorite: false\r\n                                });\r\n                            }\r\n                        };\r\n                        def.resolve(JSON.stringify(response));\r\n                    } else {\r\n                        def.reject(\"error\");\r\n                    }\r\n                });\r\n            } else {\r\n                def.reject(\"error\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    getOutboxCases: function() {\r\n        // body\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                // Get the user documents according to filter all, or if its are in favorites etc.\r\n                if (!doc.isOpen) {\r\n                    //  emit({ idWfClass: doc.idWfClass, isOpen: doc.isOpen.toString() }, doc);\r\n                    emit(doc.globalId, doc);\r\n                }\r\n            }\r\n        };\r\n\r\n        self.dbCases.query(queryFun, {\r\n                reduce: false,\r\n                key: self.globalId\r\n            },\r\n            function(err, doc) {\r\n                if (!err) {\r\n                    def.resolve(doc);\r\n                } else {\r\n                    bizagi.log(\"Error loading data before syncronization\");\r\n                    def.reject(err);\r\n                }\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method return the cases created offline by idWorkflow\r\n     * @param {} params \r\n     * @returns {}  Returns a promise\r\n     *  Struct: [\r\n     *   idCase, idWorkItem, idTask,\r\n     *   dueDate, processName, activityName,\r\n     *   customzedColumns: [key, value],\r\n     *   isOfflineForm, isOpen\r\n     * ]\r\n     */\r\n    getCasesList: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var cases = {\r\n            \"page\": 1,\r\n            \"totalPages\": 1,\r\n            \"elements\": []\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"true\";\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                emit(doc.globalId, doc);\r\n            }\r\n        };\r\n\r\n        self.dbCases.query(queryFun, {\r\n            reduce: false,\r\n            key: self.globalId\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.total_rows; i < len; i++) {\r\n                    if (isOpen === resp.rows[i].value.isOpen &&\r\n                    (typeof params.radNumber === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || resp.rows[i].value.radNumber.toString().indexOf(params.radNumber.toString()) != -1)) {\r\n\r\n                        var localCase = [\r\n                            resp.rows[i].value.idCase,\r\n                            resp.rows[i].value.workItems[0][\"idWorkItem\"][0] || \"\",\r\n                            resp.rows[i].value.workItems[0][\"idTask\"][0] || \"\",\r\n                            resp.rows[i].value.creationDate,\r\n                            resp.rows[i].value.categoryName,\r\n                            resp.rows[i].value.displayName,\r\n                            [\r\n                                [\"Case No\", resp.rows[i].value.idCase],\r\n                                [\"Process\", resp.rows[i].value.process],\r\n                                [\"Process creation date\", bizagi.util.formatDateTime(resp.rows[i].value.creationDate)]\r\n                            ],\r\n                            resp.rows[i].value.isOfflineForm,\r\n                            resp.rows[i].value.isOpen\r\n                        ];\r\n\r\n                        cases.elements.push(localCase);\r\n                    }\r\n                }\r\n                def.resolve(JSON.stringify(cases));\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local database\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n        return def.promise();\r\n    },\r\n\r\n    /*\r\n    *   This method return the cases created offline by idWorkflow\r\n    *   Returns a promise\r\n    */\r\n    getCustomizedColumnsNewData: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var cases = {\r\n            \"cases\": {\r\n                \"rows\": [],\r\n                \"totalPages\": 1,\r\n                \"page\": 1,\r\n                \"lstIdCases\": []\r\n            }\r\n        };\r\n\r\n        var isOpen = params.inputtray === \"true\";\r\n\r\n        var queryFun = {\r\n            map: function(doc) {\r\n                emit(doc.globalId, doc);\r\n            }\r\n        };\r\n\r\n        self.dbCases.query(queryFun, {\r\n            reduce: false,\r\n            key: self.globalId\r\n        }, function(error, resp) {\r\n            if (!error) {\r\n                for (var i = 0, len = resp.total_rows; i < len; i++) {\r\n                    if (isOpen === resp.rows[i].value.isOpen &&\r\n                    (typeof (params.radNumber) === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || params.radNumber.toString() === resp.rows[i].value.radNumber)) {\r\n                        var localCase = {\r\n                            id: resp.rows[i].value.idCase,\r\n                            idWFClass: resp.rows[i].value.idWfClass,\r\n                            idWorkFlow: resp.rows[i].value.idWorkFlow,\r\n                            taskState: \"\",\r\n                            isFavorite: resp.rows[i].value.isFavorite,\r\n                            guidFavorite: \"\",\r\n                            isOpen: resp.rows[i].value.isOpen,\r\n                            isAborted: false,\r\n                            isOfflineForm: true,\r\n                            fields: [\r\n                                resp.rows[i].value.idCase,\r\n                                resp.rows[i].value.process,\r\n                                {\r\n                                    \"workitems\": resp.rows[i].value.workItems\r\n                                },\r\n                                bizagi.util.formatDateTime(resp.rows[i].value.creationDate),\r\n                                \"\",\r\n                                bizagi.util.formatDateTime(resp.rows[i].value.creationDate)\r\n                            ]\r\n                        };\r\n                        cases.cases.rows.push(localCase);\r\n                        cases.cases.lstIdCases.push(resp.rows[i].id);\r\n                    }\r\n                }\r\n\r\n                // Update counter\r\n                cases.cases.totalPages = cases.cases.page = cases.cases.rows.length > 0 ? 1 : 0;\r\n\r\n                def.resolve(JSON.stringify(cases));\r\n            } else {\r\n                bizagi.log(\"Error loading cases from local database\");\r\n                def.reject(\"Error loading cases from local database\");\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Get recent processes\r\n     * @param {} params \r\n     * @returns {} promise\r\n     */\r\n    getRecentProcesses: function(params) {\r\n        var self = this;\r\n        var deferred = new $.Deferred();\r\n        var recent = { \"processes\": [] };\r\n\r\n        if (!self.recentProcesses) {\r\n            self.dbProcessRecent.get(self.globalId, function(error, doc) {\r\n                if (!error) {\r\n                    self.recentProcesses = doc.doc;\r\n                    deferred.resolve(self.recentProcesses);\r\n                } else {\r\n                    bizagi.log(\"Could not extract this document\");\r\n                    deferred.reject(error);\r\n                }\r\n            });\r\n        } else {\r\n            deferred.resolve(self.recentProcesses);\r\n        }\r\n\r\n        return deferred.promise();\r\n    }\r\n});","/*\r\n*   Name: BizAgi Database Plugin\r\n*   Author: oscaro\r\n*   Comments:\r\n*   -   This script creates a plugin to handler oll db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\nbizagi.workportal.services.db.old.extend(\"bizagi.workportal.services.db.old\", {}, {\r\n\r\n    /**\r\n     * This method return the form for a new case to offline status\r\n     * @param {} idWFClass\r\n     * @returns {} Returns a promise\r\n     */\r\n    getFormData: function(idWFClass) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbForms.get(idWFClass + \"-\" + idWFClass + \"-\" + self.globalId, function(err, doc) {\r\n            if (!err) {\r\n                if (typeof (doc.form) !== \"undefined\") {\r\n                    setTimeout(function() {\r\n                        def.resolve({ form: doc.form, type: \"form\" });\r\n                    }, 300);\r\n                } else {\r\n                    var responseText = {\r\n                        errorType: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form\"),\r\n                        message: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form-message\")                        \r\n                    };\r\n                    \r\n                    def.reject(JSON.stringify(responseText));\r\n                }\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * This method merge the form and the data to result form\r\n     * @param {} doc\r\n     * @param {} form\r\n     * @returns {}\r\n     */\r\n    mergeForm: function(doc, form) {\r\n\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        $.when(form).done(function(form) {\r\n            if (!doc.data) {\r\n                def.resolve(form);\r\n            } else {\r\n                // If it case is in outbox or closed, hide buttons in the form\r\n                if (!doc.isOpen) {\r\n                    form.form.buttons = [];\r\n                    if(Object.keys(doc.data).length === 0) {\r\n                        fillForm(form.form.elements, {\r\n                            key: \"read-only-form\",\r\n                            value: \"\"\r\n                        });    \r\n                    }\r\n                }\r\n\r\n                for (prop in doc.data) {\r\n                    fillForm(form.form.elements, {\r\n                        key: prop,\r\n                        value: doc.data[prop]\r\n                    });\r\n                }\r\n\r\n                function fillForm(element, data) {\r\n                    if (element.length && element.length > 0) {\r\n                        for (var i = 0, len = element.length; i < len; i++) {\r\n                            fillForm(element[i], data);\r\n                        }\r\n                    } else {\r\n                        if (element.container) {\r\n                            fillForm(element.container.elements, data);\r\n                        } else {\r\n                            // If it case is in outbox or closed, make all renders in the form not editable\r\n                            if (!doc.isOpen) {\r\n                                element.render.properties.editable = false;\r\n                            }\r\n\r\n                            if (element.render.properties.xpath == data.key) {\r\n                                if (element.render.properties.type === \"grid\") {\r\n                                    self.setRenderGridValues(element.render);\r\n                                }\r\n                                self.setRenderValues(element.render.properties, data.value);\r\n                            }\r\n\r\n                        }\r\n                    }\r\n                }\r\n\r\n                def.resolve(form);\r\n            }\r\n        }).fail(function(cause) {\r\n            if (!cause.responseText)\r\n                var responseText = {\r\n                    errorType: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form\"),\r\n                    message: bizagi.localization.getResource(\"workportal-offline-error-nonexisting-form-message\")\r\n                };\r\n\r\n            cause.responseText = JSON.stringify(responseText);\r\n\r\n            def.reject(cause);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Set render Grid values\r\n     * @param {} render\r\n     * @returns {}\r\n     */\r\n    setRenderGridValues: function(render) {\r\n        render.properties.data.columns = [];\r\n        for (var i = 0, length = render.elements.length; i < length; i++) {\r\n            render.properties.data.columns.push(render.elements[i].render.properties.xpath);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This function sets the type of each xpath\r\n     * @param {} doc\r\n     * @param {} form\r\n     * @returns {}\r\n     */\r\n    setDataType: function(doc, form) {\r\n\r\n    },\r\n\r\n    /**\r\n     *  This method return the categories like the services if exists in the database\r\n     * @param {} params\r\n     * @param {} data\r\n     * @returns {} Returns a promise\r\n     */\r\n    setRenderValues: function(params, data) {\r\n        var type = params.type;\r\n\r\n        if (!type) type = \"label\";\r\n\r\n        var typeGroupBasic = [\"text\", \"label\", \"number\", \"money\", \"date\", \"boolean\", \"geolocation\", \"hidden\", \"upload\"];\r\n        var typeGroupCombo = [\"combo\", \"cascadingCombo\", \"radio\", \"list\"];\r\n\r\n        if (typeGroupBasic.indexOf(type) !== -1) {\r\n            params.value = data.value;\r\n            return;\r\n        }\r\n\r\n        if (typeGroupCombo.indexOf(type) !== -1) {\r\n            for (var i = 0, len = params.data.length; i < len; i++) {\r\n                if (params.data[i].id == data.value) {\r\n                    params.value = [{ id: data.value, value: params.data[i].value }];\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        if (type === \"search\") {\r\n            for (var j = 0, lengthData = params.data.length; j < lengthData; j++) {\r\n                if (params.data[j].id == data.value.id) {\r\n                    params.value = data.value;\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (type === \"image\") {\r\n            params.value = data;\r\n            return;\r\n        }\r\n\r\n        if (type === \"grid\") {\r\n            params.data.records = data.value.length;\r\n            params.data.total = 1;\r\n            params.data.page = 1;\r\n\r\n            var lengthColumns = params.data.columns.length;\r\n            var tmpEditAndVisible = [];\r\n            var lengthRows = data.value.length;\r\n\r\n            for (var row = 0; row < lengthRows; row++) {\r\n                // Add random value\r\n                var idRow = bizagi.util.randomNumber();\r\n\r\n                var tmpElement = [];\r\n                var tempRow = [];\r\n\r\n                tmpElement[tmpElement.length] = idRow;\r\n\r\n                for (var col = 0; col < lengthColumns; col++) {\r\n                    var index = typeof (data.value[row][col]) !== \"undefined\" ? params.data.columns.indexOf(data.value[row][col].xpath) : -1;\r\n\r\n                    if (index != -1) {\r\n                        tempRow[index] = data.value[row][col];\r\n                    }\r\n\r\n                    tempRow[col] = (typeof (tempRow[col]) === \"undefined\") ? {} : tempRow[col];\r\n                    tmpElement[tmpElement.length] = \"true\";\r\n                }\r\n\r\n                params.data.rows.push($.merge([idRow], tempRow));\r\n                tmpEditAndVisible[tmpEditAndVisible.length] = tmpElement;\r\n            }\r\n\r\n            params.data.editable = tmpEditAndVisible;\r\n            params.data.visible = tmpEditAndVisible;\r\n\r\n            return;\r\n        }\r\n\r\n        // No type supported\r\n        try {\r\n            params.value = data.value;\r\n        } catch (e) {\r\n        }\r\n\r\n        bizagi.log(type + \" not supported in render factory\", data, \"error\");\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * This method simulate a summary response\r\n     * @param {} params\r\n     * @returns {} Returns a promise\r\n     */\r\n    getSummary: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbCases.get(params.idCase, function(err, doc) {\r\n            if (!err)\r\n                def.resolve($.extend(doc, {\r\n                    processPath: \"/\",\r\n                    currentState: doc.workItems,\r\n                    countAssigness: 0,\r\n                    countEvents: 0,\r\n                    isOpen: doc.isOpen.toString(),\r\n                    countSubProcesses: 0\r\n                }));\r\n            else\r\n                def.reject(err);\r\n        });\r\n\r\n        return def.promise();\r\n    },      \r\n\r\n    /*\r\n    *   This method save the form info in the DB\r\n    *   Returns a promise\r\n    */\r\n    saveFormInfo: function(params, data) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.dbCases.get(params.idCase, function(err, doc) {\r\n            if (!err) {\r\n                self.mergeDataDocument(data, doc, self.getFormData(doc.idWfClass.toString()))\r\n                    .done(function(resp) {\r\n\r\n                        doc = self.mergeData(data, doc, resp);\r\n\r\n                        self.dbCases.put(doc, function(error, response) {\r\n                            if (!error)\r\n                                def.resolve(response);\r\n                            else\r\n                                def.reject(error);\r\n                        });\r\n                    });\r\n\r\n            } else {\r\n                def.reject(err);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    mergeDataDocument: function(data, doc, form) {\r\n        var defer = new $.Deferred();\r\n        var response = {};\r\n\r\n        $.when(form).done(function(resp) {\r\n\r\n            for (prop in data) {\r\n                if (prop != \"h_action\") {\r\n                    response[prop] = {};\r\n                    response[prop].value = data[prop];\r\n                    fillForm(resp.form.elements, {\r\n                        key: prop,\r\n                        value: data[prop]\r\n                    });\r\n                }\r\n            }\r\n\r\n            function fillForm(element, datafill) {\r\n                if (element.length && element.length > 0) {\r\n                    for (var i = 0, len = element.length; i < len; i++) {\r\n                        fillForm(element[i], datafill);\r\n                    }\r\n                } else {\r\n                    if (element.container) {\r\n                        fillForm(element.container.elements, datafill);\r\n                    } else {\r\n                        if (element.render.properties.xpath == datafill.key) {\r\n                            response[datafill.key].DataType = element.render.properties.dataType || \"\";\r\n                            response[datafill.key].type = element.render.properties.type || \"\";\r\n\r\n                            // Remove empty object of the Collection\r\n                            if (!bizagi.util.isEmpty(response[datafill.key])) {\r\n                                var lengthRows = response[datafill.key].value.length;\r\n\r\n                                for (var row = 0; row < lengthRows; row++) {\r\n                                    if (!bizagi.util.isEmpty(response[datafill.key].value[row])) {\r\n\r\n                                        if (response[datafill.key].type === \"image\") {\r\n                                            var url = response[datafill.key].value[row] || \"\";\r\n\r\n                                            response[datafill.key].value = url.replace(/^data:.*;base64,/, \"\");\r\n                                        } else {\r\n                                            var tempDataColumn = [];\r\n                                            var lengthCols = response[datafill.key].value[row].length;\r\n\r\n                                            for (var col = 0; col < lengthCols; col++) {\r\n                                                if (!bizagi.util.isEmpty(response[datafill.key].value[row][col])) {\r\n                                                    tempDataColumn.push(response[datafill.key].value[row][col]);\r\n                                                }\r\n                                            }\r\n\r\n                                            response[datafill.key].value[row] = tempDataColumn;\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                }\r\n            }\r\n\r\n            defer.resolve(response);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    mergeData: function (data, doc, resp) {\r\n\r\n        if (data.h_action == \"next\") {\r\n            doc.isOpen = false;\r\n        }\r\n\r\n        doc.data = doc.data || {};\r\n\r\n        for (var i in resp) {\r\n\r\n            var assigned = false;\r\n\r\n            for (var j in doc.data) {\r\n\r\n                if (i == j) {\r\n\r\n                    if (bizagi.util.isEmpty(resp[i]) || bizagi.util.isEmpty(resp[i].value)) {\r\n                        delete doc.data[j];\r\n                        assigned = true;\r\n                    } else {\r\n                        doc.data[j] = resp[i];\r\n                        assigned = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!assigned) {\r\n                doc.data[i] = resp[i];\r\n            }\r\n        }\r\n\r\n        return doc;\r\n\r\n    },\r\n\r\n    nativeSaveFormInfo: function (data, doc, form) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        self.mergeDataDocument(data, doc, form)\r\n            .done(function (resp) {\r\n                doc = self.mergeData(data, doc, resp);\r\n                def.resolve(doc);\r\n            });\r\n\r\n        return def.promise();\r\n    }\r\n});","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author: Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n$.Class.extend(\"bizagi.workportal.services.pullWorker.old\", {}, {\r\n    init: function(params) {\r\n        var self = this;\r\n        var queryString = bizagi.readQueryString();\r\n\r\n        self.services = params;\r\n        self.database = params.database;\r\n\r\n        var querydisable = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n        self.disabledb = querydisable;\r\n\r\n        if (!self.disabledb) {\r\n            self.dbForms = new PouchDB(\"DataRenderForms\");\r\n            self.dbCases = new PouchDB(\"DataRenderCases\");\r\n            self.dbProcessHierarchy = new PouchDB(\"DataProcessesHierarchy\");\r\n            self.dbProcessRecent = new PouchDB(\"DataProcessesRecent\");\r\n        }\r\n\r\n        self.globalId = (typeof BIZAGI_USER != \"undefined\")\r\n            ? BIZAGI_USER.toLowerCase() + \"-\" + BIZAGI_PROXY_PREFIX\r\n            .toLowerCase() + \"-\" + BIZAGI_DOMAIN.toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n    },\r\n\r\n    pull: function() {\r\n        var self = this;\r\n\r\n        if (self.disabledb) {\r\n            return false;\r\n        }\r\n\r\n        return $.when(self.syncOfflineCases())\r\n            .done(function() {\r\n                return true;\r\n            });\r\n    },\r\n    \r\n    /**\r\n     * This function send to the server the offline cases created\r\n     * @param {} argument \r\n     * @returns {} \r\n     */\r\n    syncOfflineCases: function(argument) {\r\n        var self = this;\r\n\r\n        if (typeof (self.database) !== \"undefined\") {\r\n            self.synchronizing = self.synchronizing || false;\r\n\r\n            if (!self.synchronizing) {\r\n                self.synchronizing = true;\r\n                return self.database.getOutboxCases().done(function(response) {\r\n                    var array_cases = [];\r\n                    for (var i = 0; i < response.total_rows; i++) {\r\n                        var obj = response.rows[i].value;\r\n                        var objToSend = [];\r\n                        for (var item in obj.data) {\r\n                            if (item != \"h_action\") {\r\n                                objToSend.push({\r\n                                    \"domain\": typeof (BIZAGI_DOMAIN) !== \"undefined\" ? BIZAGI_DOMAIN : \"domain\",\r\n                                    \"user\": typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                                    \"xpath\": item,\r\n                                    \"value\": self.processDataValues(obj.data[item].value, obj.data[item].type),\r\n                                    \"DataType\": obj.data[item].DataType,\r\n                                    \"type\": obj.data[item].type\r\n                                });\r\n                            }\r\n                        }\r\n\r\n                        obj = $.extend(obj, { \"objToSend\": objToSend });\r\n\r\n                        // idWfClass\r\n                        array_cases.push(\r\n                            self.services.syncOfflineCases(obj).pipe(\r\n                                function(rta) {\r\n                                    var formData = decodeURIComponent(this.data).split('&');\r\n                                    for (var i = formData.length - 1; i >= 0; i--) {\r\n                                        var pivot = formData[i].split(\"=\");\r\n                                        if (pivot[0] == \"idCase\") {\r\n                                            return self.database.deleteCase({\r\n                                                idCase: pivot[1]\r\n                                            });\r\n                                        }\r\n                                    }\r\n                                    // When it returns \"yes\" then remove the case of database\r\n                                }, function(fail) {\r\n                                    bizagi.log(fail);\r\n                                }\r\n                            )\r\n                        );\r\n                    }\r\n\r\n                    return $.when.apply($, array_cases).pipe(function() {                        \r\n                        // Show message to successfully synchronization\r\n                        self.synchronizing = false;                        \r\n                        return true;\r\n                    });\r\n                });\r\n            }\r\n        }        \r\n    },\r\n\r\n    processDataValues: function(data, fileType) {\r\n        var self = this; \r\n        if($.type(data) == \"array\" && fileType == \"upload\") {\r\n\r\n            for ( var i = 0 ; i < data.length; i++){\r\n                data[i] = data[i].filter(function(element){\r\n                    return element[\"xpath\"] != \"mimeType\";\r\n                });\r\n            }\r\n\r\n            return data;\r\n        }\r\n\r\n        if ($.type(data) == \"object\") {\r\n            // For search\r\n            if (data.hasOwnProperty(\"id\")) {\r\n                data = data.id;\r\n            }\r\n        }\r\n\r\n        if(fileType == \"grid\"){ \r\n            for(var rowPos = 0; rowPos < data.length; rowPos++){ \r\n                var row = data[rowPos]; \r\n                for(var cellPos= 0; cellPos< row.length; cellPos++){ \r\n                    var cell = row[cellPos]; \r\n                    cell.value = self.processDataValues(cell.value); \r\n                } \r\n            } \r\n        } \r\n\r\n        return data;\r\n    }\r\n});","/*\r\n*   Name: Bizagi Database Plugin\r\n*   Author:Bizagi Mobile Team\r\n*   Comments:\r\n*   -   This script creates a plugin to handler all db functionalities\r\n*   -   Pre-requisite pouchDB\r\n*/\r\n\r\n$.Class.extend(\"bizagi.workportal.services.fetchWorker.old\", {}, {\r\n    init: function(params) {\r\n        var self = this;\r\n        self.services = params;\r\n\r\n        var queryString = bizagi.readQueryString();\r\n        self.disabledb = (queryString && queryString[\"disabledb\"]) ? eval(queryString[\"disabledb\"]) : false;\r\n\r\n        if (!self.disabledb) {\r\n            self.dbForms = new PouchDB(\"DataRenderForms\");\r\n            self.dbCases = new PouchDB(\"DataRenderCases\");\r\n            self.dbProcessHierarchy = new PouchDB(\"DataProcessesHierarchy\");\r\n            self.dbProcessRecent = new PouchDB(\"DataProcessesRecent\");\r\n        }\r\n\r\n        self.globalId = typeof (BIZAGI_USER) != \"undefined\"\r\n            ? BIZAGI_USER.toLowerCase() + \"-\" + BIZAGI_PROXY_PREFIX.toLowerCase() + \"-\" + BIZAGI_DOMAIN.toLowerCase()\r\n            : \"admon\" + \"-\" + \"http://localhost/bizagiR100x\" + \"-\" + \"domain\";\r\n    },\r\n\r\n    fetch: function(argument) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        if (self.disabledb) {\r\n            def.reject(\"Disable Sync\");\r\n            return def.promise();\r\n        }\r\n\r\n        $.when(self.services.processesHierarchy())\r\n            .done(function(dataCategory, dataRecents) {\r\n                $.when(self.saveProcessesHierarchy(dataCategory),\r\n                        self.processesHierarchyTofetchForms(),\r\n                        self.services.getRecentOfflineProcesses())\r\n                    .done(function(data1, data2, dataRecents) {\r\n                        self.saveRecentProcesses(dataRecents);\r\n                        def.resolve(\"All data fetched\");\r\n                    }).fail(function(data1, data2, data3) {\r\n                        if (data1 === \"nothing\") {\r\n                            def.reject(0);\r\n                        } else {\r\n                            def.reject(\"Error fetching data\");\r\n                        }\r\n                    });\r\n            });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Save in the db the user permitions to create cases\r\n     * @returns {} \r\n     */\r\n    processesHierarchyTofetchForms: function() {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var changeset = bizagi.util.getItemLocalStorage((\"formChangeset\" + self.globalId));\r\n        if (changeset === null || typeof changeset === \"undefined\") {\r\n            changeset = 0;\r\n        }\r\n\r\n        self.callSyncForms({\r\n            changeSet: changeset\r\n        }).done(function(data) {\r\n            console.log(data, \"Sync forms\");\r\n            def.resolve(data);\r\n        }).fail(function(error) {\r\n            if (error === \"nothing\") {\r\n                console.log(\"Nothing to sync\");\r\n            } else {\r\n                console.log(error, \"Error sync forms\");\r\n            }\r\n            def.reject(error);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    callSyncForms: function(params) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var changeSet = params.changeSet;\r\n\r\n        self.services.processesHierarchyTofetchForms(params)\r\n            .done(function(data) {\r\n                if (data.changeSet > changeSet) {\r\n                    // Add code to validate if form and save\r\n                    var prom = null;\r\n                    if (data.changeSetType === 1) // Form \r\n                        prom = self.saveProcessesHierarchyTofetchForms(data.result);\r\n                    if (data.changeSetType === 4) { // Grant acess\r\n                        prom = self.saveProcessInHierarchy(data.result);\r\n                    }\r\n\r\n                    $.when(prom).done(function() {\r\n                        self.callSyncForms({\r\n                            changeSet: data.changeSet\r\n                        }).done(function(resp) {\r\n                            def.resolve(resp);\r\n                        }).fail(function(error) {\r\n                            def.reject(error);\r\n                        });\r\n                    }).fail(function(err) {\r\n                        def.reject(err);\r\n                    });\r\n                } else {\r\n                    // Set the variable changeset in localStorage\r\n                    bizagi.util.setItemLocalStorage((\"formChangeset\" + self.globalId), data.changeSet);\r\n                    changeSet = parseInt(changeSet);\r\n                    if (data.changeSet === 0 && changeSet === 0) {\r\n                        // Nothing to sync                    \r\n                        def.reject(\"nothing\");\r\n                    } else {\r\n                        def.resolve(\"succesfully\");\r\n                    }\r\n                }\r\n            }).fail(function(error) {\r\n                def.reject(error);\r\n            });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    saveProcessInHierarchy: function(data) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        def.resolve(\"\");\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    getHierarchyObjects: function(obj, key, val) {\r\n        var self = this;\r\n        var objects = [];\r\n\r\n        for (var i in obj) {\r\n            if (!obj.hasOwnProperty(i)) continue;\r\n            if (typeof obj[i] == \"object\") {\r\n                objects = objects.concat(self.getHierarchyObjects(obj[i], key, val));\r\n            } else if (i == key && obj[i] == val || i == key && val == '') {\r\n                objects.push(obj);\r\n            } else if (obj[i] == val && key == '') {\r\n                // Only add if the object is not already in the array\r\n                if (objects.lastIndexOf(obj) == -1) {\r\n                    objects.push(obj);\r\n                }\r\n            }\r\n        }\r\n\r\n        return objects;\r\n    },\r\n\r\n    /**\r\n     * Save in the db the user Forms\r\n     * @param {} result \r\n     * @returns {} \r\n     */\r\n    saveProcessesHierarchyTofetchForms: function(result) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var docHierarchy = {\r\n            _id: result.wfClass.toString() + \"-\" + result.wfClass.toString() + \"-\" + self.globalId,\r\n            globalid: self.globalId,\r\n            idWfClass: result.wfClass,\r\n            idWorkFlow: result.workFlow,\r\n            form: result.data.form\r\n        };\r\n\r\n        self.dbForms.get(docHierarchy._id, function(err, doc) {\r\n            // If error, then the doc doesn't exists and it's added\r\n            if (err) {\r\n                // If it does not exist then add\r\n                self.dbForms.put(docHierarchy, function callback(err, result) {\r\n                    if (!err) {\r\n                        def.resolve(result);\r\n                    } else {\r\n                        def.reject(\"Could not add the document\");\r\n                    }\r\n                });\r\n            } else {\r\n                // If no error, then the doc exists and must be replaced if is outdated\r\n                self.dbForms.put({\r\n                    _rev: doc._rev,\r\n                    _id: doc._id,\r\n                    form: docHierarchy.form\r\n                }, function callback(err, result) {\r\n                    if (!err) {\r\n                        def.resolve(result);\r\n                    } else {\r\n                        def.reject(\"Could not update the document\");\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Save in the db the user permitions to create cases\r\n     * @param {} hierarchy \r\n     * @returns {} \r\n     */\r\n    saveProcessesHierarchy: function(hierarchy) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var docHierarchy = {\r\n            _id: self.globalId,\r\n            doc: hierarchy\r\n        };\r\n\r\n        // Try to search de doc\r\n        self.dbProcessHierarchy.get(docHierarchy._id, function(err, doc) {\r\n            // If error, then the doc doesn't exists and it's add\r\n            if (err) {\r\n                // If it does not exist then add\r\n                self.dbProcessHierarchy.put(docHierarchy, function callback(err, result) {\r\n                    if (!err) {\r\n\r\n                        def.resolve(result);\r\n                    } else {\r\n\r\n                        def.reject(\"Could not add the document\");\r\n                    }\r\n                });\r\n            } else {\r\n                // If not error, then the doc exists and must be replaced if is outdated\r\n                self.dbProcessHierarchy.put({\r\n                    _id: doc._id,\r\n                    _rev: doc._rev,\r\n                    doc: hierarchy\r\n                }, function callback(err, result) {\r\n\r\n                    if (!err) {\r\n\r\n                        def.resolve(result);\r\n                    } else {\r\n\r\n                        def.reject(\"Could not update the document\");\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /**\r\n     * Save in the db the user recent processes to create cases\r\n     * @param {} processes \r\n     * @returns {} \r\n     */\r\n    saveRecentProcesses: function(processes) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var docRecent = {\r\n            _id: self.globalId,\r\n            doc: processes\r\n        };\r\n\r\n        self.dbProcessRecent.get(docRecent._id, function(err, doc) {\r\n            // If error, then the doc does not exists and it's added\r\n            if (err) {\r\n                // If it does not exist then add\r\n                self.dbProcessRecent.put(docRecent, function callback(err, result) {\r\n                    if (!err) {\r\n                        def.resolve(result);\r\n                    } else {\r\n                        def.reject(\"Could not add the document\");\r\n                    }\r\n                });\r\n            } else {\r\n                // If no error, then the doc exists and must be replaced if is outdated\r\n                self.dbProcessRecent.put({\r\n                    _rev: doc._rev,\r\n                    _id: doc._id,\r\n                    doc: processes\r\n                }, function callback(err, result) {\r\n                    if (!err) {\r\n                        def.resolve(result);\r\n                    } else {\r\n                        def.reject(\"Could not update the document\");\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    }\r\n});","/*\r\n*   Name: BizAgi Work Portal Service Context Factory\r\n*   Author: Diego Parra (based on Edward Morales version)\r\n*   Comments:\r\n*   -   This script will define the endpoints to be used based on the given context\r\n*/\r\n\r\n$.Class.extend(\"bizagi.workportal.services.context\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function (params) {\r\n        this.context = params.context;\r\n        this.endPoints = bizagi.workportal.services.getEndPoints(params);\r\n        this.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n    },\r\n\r\n    /*\r\n    *   Returns the given url for a specified service\r\n    */\r\n    getUrl: function (service) {\r\n        if (typeof this.endPoints[service] === 'undefined') {\r\n            bizagi.log(\"Url not found\",\"No endpoint defined for: \" + service);\r\n        }\r\n        return this.endPoints[service];\r\n    },\r\n\r\n    setProxyPrefix: function (params) {\r\n        this.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n        this.endPoints = bizagi.workportal.services.getEndPoints(params);\r\n    }\r\n});\r\n","/*\r\n*   Name: BizAgi Services WorkPortal End Points\r\n*   Author: Diego Parra (based on Edward Morales version)\r\n*   Comments:\r\n*   -   This script defines all the end-points used to retrieve ajax stuff\r\n*   -   All urls must be relative to the base application\r\n*/\r\n\r\n// Create or define namespace\r\nbizagi.workportal = (typeof (bizagi.workportal) !== \"undefined\") ? bizagi.workportal : {};\r\nbizagi.workportal.services = (typeof (bizagi.workportal.services) !== \"undefined\") ? bizagi.workportal.services : {};\r\nbizagi.workportal.services.endPoints = [];\r\n\r\n// Creates a endpoint hash factory to resolve custom requirements\r\nbizagi.workportal.services.getEndPoints = function (params) {\r\n    // Default workportal end-points\r\n    if (params.context == \"workportal\") {\r\n        var endPoints = {\r\n            \"user-handler\": params.proxyPrefix + \"RestServices/UserHandler.ashx\",\r\n            \"process-handler\": params.proxyPrefix + \"RestServices/ProcessHandler.ashx\",\r\n            \"query-handler\": params.proxyPrefix + \"Rest/Handlers/Query\",\r\n            \"case-handler\": params.proxyPrefix + \"RestServices/CaseHandler.ashx\",\r\n            \"query-form\": params.proxyPrefix + \"App/ListaDetalle/QueryForm.aspx\",\r\n            \"query-form-edit\": params.proxyPrefix + \"App/ListaDetalle/SaveQuery.aspx\",\r\n            \"query-form-delete\": params.proxyPrefix + \"App/ListaDetalle/QueryForm.aspx\",\r\n            \"query-form-delete-cube\": params.proxyPrefix + \"Rest/Queries/Cubes/{idCube}\",\r\n            \"favorites-handler\": params.proxyPrefix + \"RestServices/FavoritesHandler.ashx\",\r\n            \"file-handler\": params.proxyPrefix + \"RestServices/EntityHandler.ashx\",\r\n            \"login-handler\": params.proxyPrefix + \"Rest/Users/UserAuthentication\",\r\n            \"login-handlerv10\": params.proxyPrefix + \"RestServices/UserHandler.ashx?action=authenticateUser&userName={0}&password={1}&domain={2}\",\r\n            \"logoff-handler\": params.proxyPrefix + \"RestServices/UserHandler.ashx?action=logOff\",\r\n            \"logoff-handlerv1\": params.proxyPrefix + \"Rest/Users/LogOff\",\r\n\r\n            // Rest Services\r\n            \"authorization-handler-getMenuAuthorization\": params.proxyPrefix + \"Rest/Authorization/MenuAuthorization\",\r\n            \"authorization-handler-isCaseCreationAuthorized\": params.proxyPrefix + \"Rest/Authorization/Processes/{0}/IsCaseCreationAuthorized\",\r\n            \"case-handler-getCaseSummary\": params.proxyPrefix + \"Rest/Cases/{idCase}/Summary\",\r\n\r\n            //ReleaseActivityResponse\r\n            \"case-handler-releaseActivity\": params.proxyPrefix + \"Rest/Cases/{idCase}/ReleaseActivity\",\r\n\r\n            //mobile beta services\r\n            \"case-handler-getCasesList\": params.proxyPrefix + \"Rest/Processes/SearchCases\",\r\n            \"case-handler-getActivityList\": params.proxyPrefix + \"Api/Cases/Activities\",\r\n        \r\n            // Services to Offline capability\r\n            \"offline-getProcessTree\": params.proxyPrefix + \"Rest/Processes/OfflineProcessTree\",\r\n\r\n            //\"offline-getForms\": params.proxyPrefix + \"Rest/Handlers/Render\",\r\n            \"offline-tasks\": params.proxyPrefix + \"Api/Cases/GetOfflineTasks\",\r\n            \"offline-getForms\": params.proxyPrefix + \"Rest/RenderForm/offlineForms\",\r\n            \"offline-sendForm\": params.proxyPrefix + \"Rest/Cases/SaveAsynchWorkItemOffLine\",\r\n\r\n            // StartProcess\r\n            \"case-handler-getCaseTasks\": params.proxyPrefix + \"Rest/Cases/{idCase}/Tasks\",\r\n            \"case-handler-getCaseEvents\": params.proxyPrefix + \"Rest/Cases/{idCase}/Events\",\r\n            \"case-handler-getCaseSubprocesses\": params.proxyPrefix + \"Rest/Cases/{idCase}/Subprocesses\",\r\n            \"case-handler-getTaskAssignees\": params.proxyPrefix + \"Rest/Cases/{idCase}/Tasks/{idTask}/Assignees\",\r\n            \"case-handler-getCaseAssignees\": params.proxyPrefix + \"Rest/Cases/{idCase}/Assignees\",\r\n            \"case-handler-getWorkItems\": params.proxyPrefix + \"Rest/Cases/{idCase}/WorkItems\",\r\n            \"case-handler-getAsynchExecutionState\": params.proxyPrefix + \"Rest/Cases/{idCase}/AsynchExecutionState\",\r\n            \"case-handler-addNewCase\": params.proxyPrefix + \"Rest/Cases\",\r\n            \"case-handler-startProcess\": params.proxyPrefix + \"Rest/Processes/StartProcess/{idProcess}\",\r\n            \"handler-execute-action-start\": params.proxyPrefix + \"Api/Cases/{processId}/Start\",\r\n            \"case-handler-supportedLogTypes\": params.proxyPrefix + \"Rest/Cases/SupportedLogsTypes\",\r\n            \"case-handler-getActivityLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/ActivityLog\",\r\n            \"case-handler-getActivityDetailLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/{idWorkItemFrom}/ActivityDetailLog\",\r\n            \"case-handler-getEntityLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/EntityLog\",\r\n            \"case-handler-getEntityDetailLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/EntityDetailLog\",\r\n            \"case-handler-getUserLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/UserLog\",\r\n            \"case-handler-getUserDetailLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/{idUser}/UserDetailLog\",\r\n            \"case-handler-getAdminLog\": params.proxyPrefix + \"Rest/Cases/{idCase}/AdminLog\",\r\n            \"case-handler-getCaseFormsRenderVersion\": params.proxyPrefix + \"Rest/Cases/{idCase}/FormsRenderVersion\",\r\n            \"case-handler-validateHasStartForm\": params.proxyPrefix + \"Api/Processes/{processId}/StartContext\",\r\n\r\n            //Favorites Restful\r\n            \"favorites-handler-saveFavorite\": params.proxyPrefix + \"Rest/Favorites\",\r\n            \"favorites-handler-deleteFavorite\": params.proxyPrefix + \"Rest/Favorites/{guidFavorite}\",\r\n\r\n            //ICONS && IMAGES\r\n            \"process-getIcon\": params.proxyPrefix + \"Api/Processes/{processId}/Icon\",\r\n            \"collections-getIcon\": params.proxyPrefix + \"Api/CurrentUser/Collections/{collectionId}/Icon\",\r\n\r\n            //BAMAnalytics Restful\r\n            \"bamAnalytics-handler-getAnalisysQueries\": params.proxyPrefix + \"Rest/BAMAnalytics/AnalisysQueries\",\r\n            \"bamAnalytics-handler-updateQuery\": params.proxyPrefix + \"Rest/BAMAnalytics/Reports/Ids/{idQuery}\",\r\n\r\n            //Inbox Restful\r\n            \"inbox-handler-getInboxSummary\": params.proxyPrefix + \"Rest/Inbox/Summary\",\r\n\r\n            //Messages Restful\r\n            \"MessageHandler-NewComment\": params.proxyPrefix + \"Rest/Cases/Comments\",\r\n            \"MessageHandler-GetComments\": params.proxyPrefix + \"Rest/Cases/Comments\",\r\n            \"MessageHandler-SetCategoryToComment\": params.proxyPrefix + \"Rest/Cases/Comments/{idComment}\",\r\n            \"MessageHandler-RemoveComment\": params.proxyPrefix + \"Rest/Cases/Comments/{idComment}\",\r\n            \"MessageHandler-ReplyComment\": params.proxyPrefix + \"Rest/Cases/Comments/{idComment}/Replies\",\r\n            \"MessageHandler-RemoveReply\": params.proxyPrefix + \"Rest/Cases/Comments/{idComment}/Replies/{idReply}\",\r\n            \"MessageHandler-GetCategoryColors\": params.proxyPrefix + \"Rest/Cases/Comments/CategoryColors\",\r\n            \"MessageHandler-RenameCategoryColor\": params.proxyPrefix + \"Rest/Cases/Comments/CategoryColors/{idColorCategory}\",\r\n            \"MessageHandler-CountNewComments\": params.proxyPrefix + \"Rest/Cases/Comments/{idComment}/NewComments/Count\",\r\n\r\n            //Processes Restful\r\n            \"process-handler-getAllProcesses\": params.proxyPrefix + \"Rest/Processes\",\r\n            \"process-handler-getFavourites\": params.proxyPrefix + \"Rest/Home/MyFavorites/Count\",\r\n            \"process-handler-getFavouriteCases\": params.proxyPrefix + \"Rest/Home/MyFavorites\",\r\n            \"process-handler-getCustomizedColumnsData\": params.proxyPrefix + \"Rest/Processes/CustomizedColumnsData\",\r\n            \"process-handler-getCategory\": params.proxyPrefix + \"Rest/Processes/Categories\",\r\n            \"process-handler-getRecentProcesses\": params.proxyPrefix + \"Rest/Processes/RecentProcesses\",\r\n            \"process-handler-getCustomizedColumnsDataInfo\": params.proxyPrefix + \"Rest/Processes/CustomizedColumnsDataInfo\",\r\n            \"process-handler-getOrganizations\": params.proxyPrefix + \"Rest/Profile/Organizations\",                                              \r\n\r\n            //workportal\r\n            \"process-handler-getMyStuff\": params.proxyPrefix + \"Api/CurrentUser/Collections\",\r\n            \"process-handler-getIdCasesOfProcessEntities\": params.proxyPrefix + \"Api/Entities/Cases\",\r\n\t        \"templates-handler-getCollectionData\": params.proxyPrefix + \"Api/Collection/{idFact}/Data\",\r\n            //\"data-navigation-handler\": params.proxyPrefix + \"Api/Entities/{guidLeftEntity}/Data/{surrogateKeyLeftEntity}\",\r\n            \"data-navigation-handler-collection\": params.proxyPrefix + \"Api/CurrentUser/Collections/{reference}/Data/{surrogateKey}\",\r\n            \"data-navigation-handler-entity\": params.proxyPrefix + \"Api/CurrentUser/Entities/{reference}/Data/{surrogateKey}/{xpath}\",\r\n            \"data-navigation-handler-entity-filters\": params.proxyPrefix + \"Api/CurrentUser/Entities/{reference}/Filters/{surrogateKey}/{xpath}\",\r\n\r\n            //\"action-handler-getProcessAddAction\": params.proxyPrefix + \"Api/Entities/{guidLeftEntity}/Collection/{guidFact}/Actions\",\r\n            \"action-handler-getProcessAddAction\": params.proxyPrefix + \"Api/CurrentUser/Collections/{reference}/{surrogateKey}/Actions\",\r\n\r\n            //My Searches\r\n            'my-search-getSearchLists': params.proxyPrefix + \"Api/CurrentUser/Searches\",\r\n            'my-search-getFilters': params.proxyPrefix + \"Api/CurrentUser/Searches/{guidSearch}/Filters\",\r\n            'my-search-getFiltersData': params.proxyPrefix + \"Api/CurrentUser/Searches/{guidSearch}/FilterData\",\r\n            'my-search-getData': params.proxyPrefix + \"Api/CurrentUser/Searches/{guidSearch}/Data\",\r\n\r\n            \"templates-handler-getVirtualCollectionData\" : params.proxyPrefix + \"Api/Collection/{guidVirtualCollection}/VirtualData\",\r\n            \"templates-handler-getMultipleActions\" : params.proxyPrefix + \"Rest/Entities/multipleInstancesActions\",\r\n            \r\n            \"process-handler-getMapping\" : params.proxyPrefix + \"Rest/Entities/Mapping\",\r\n            \"process-handler-getForm\" : params.proxyPrefix + \"Rest/Handlers/Render\",\r\n            \"process-handler-startform\": params.proxyPrefix + \"Rest/Processes/HasStartForm\",\r\n            //\"process-handler-rule\": params.proxyPrefix + \"Rest/Action/Rule\",\r\n            \"process-handler-rule\": params.proxyPrefix + \"Api/Rules/{ruleId}/Execute\",\r\n            //\"process-action-execute\" : params.proxyPrefix + \"Api/Action/Execute\",\r\n            \"process-action-execute\": params.proxyPrefix + \"Api/Rules/{ruleId}/ExecuteMultiple\",\r\n            \"process-handler-getActivitiesData\": params.proxyPrefix + \"Api/Processes/CasesData/MyActivities\",\r\n            \"process-handler-getPendingsData\": params.proxyPrefix + \"Api/Processes/CasesData/MyPendings\",\r\n            \r\n            //\"entities-handler-getActions\" : params.proxyPrefix + \"Rest/Entities/Actions\",\r\n            \"entities-handler-getActions\": params.proxyPrefix + \"Api/Entities/{guidEntity}/{surrogateKey}/actions\",\r\n            \"entities-handler-getUsersAndEvents\" : params.proxyPrefix + \"Rest/Processes/CasesData/UsersAndEvents\",\r\n            \"entities-handler-getUsers\" : params.proxyPrefix + \"Api/Cases/{caseId}/Users\",\r\n            \"entities-handler-getEvents\" : params.proxyPrefix + \"Api/Cases/{caseId}/CurrentEvents\",\r\n            \"entities-handler-getUsersImages\" : params.proxyPrefix + \"Rest/Users/UserPictures\",\r\n            \"entities-handler-getShotCuts\" : params.proxyPrefix + \"Api/CurrentUser/Shortcuts\",\r\n            \r\n            //Queries Restful\r\n            \"query-handler-getqueries\": params.proxyPrefix + \"Rest/Queries\",\r\n            \"query-handler-getQueryForm\": params.proxyPrefix + \"Rest/Handlers/Render\",\r\n\r\n            //Users Restful\r\n            \"user-handler-getCurrentUser\": params.proxyPrefix + \"Rest/Users/CurrentUser\",\r\n\r\n            // Old render integration, readonly\r\n            \"old-render\": params.proxyPrefix + \"App/ListaDetalle/Detalle.aspx\",\r\n\r\n            //Service locator for reports\r\n            \"Reports\": params.proxyPrefix + \"RestServices/BAMAnalyticsHandler.ashx\",\r\n            \"reports-handler-deleteQueries\": params.proxyPrefix + \"Rest/BAMAnalytics/Reports/{QueryId}\",\r\n\r\n            //Service locator for bizagi folders\r\n            \"folders-handler-getUserQueries\": params.proxyPrefix + \"Rest/SmartFolders\",\r\n            \"folders-associate-deleteSmartFolder\": params.proxyPrefix + \"Rest/SmartFolders/{idSmartFolder}\",\r\n            \"folders-handler\": params.proxyPrefix + \"RestServices/SmartFoldersHandler.ashx\",\r\n            \"folders-associate\": params.proxyPrefix + \"App/Ajax/AJAXGateway.aspx\",\r\n            \"smartfolders-integration\": params.proxyPrefix + \"App/WorkPortal/ConfigureFilteredFolder.aspx\",\r\n\r\n            //Service locator for menu\r\n            \"AlarmAdmin\": params.proxyPrefix + \"App/Admin/AlarmsAdmin.aspx\",\r\n            \"AnalyticsProcess\": params.proxyPrefix + \"App/Cockpit/AnalyticsProcess.aspx\",\r\n            \"AnalyticsSensor\": params.proxyPrefix + \"App/Cockpit/AnalyticsSensor.aspx\",\r\n            \"AnalyticsTask\": params.proxyPrefix + \"App/Cockpit/AnalyticsTask.aspx\",\r\n            \"AsynchronousWorkitemRetries\": params.proxyPrefix + \"App/Admin/AsynchDisabledWorkitems.aspx\",\r\n            \"AuthenticationLogQuery\": params.proxyPrefix + \"App/Admin/AuthLogQuery.aspx\",\r\n            \"BAMProcess\": params.proxyPrefix + \"App/Cockpit/BAMProcess.aspx\",\r\n            \"BAMTask\": params.proxyPrefix + \"App/Cockpit/BAMTask.aspx\",\r\n            \"BusinessPolicies\": params.proxyPrefix + \"App/Admin/BusinessPolicies/BusinessPoliciesSelector.aspx\",\r\n            \"CaseAdmin\": params.proxyPrefix + \"App/Admin/CaseSearch.aspx\",\r\n            \"adminReassignCases\": \"CaseAdmin\", // Open workportal module called 'adminCases'\r\n            \"asyncECMUpload\": \"asyncECMUpload\", // Open workportal module called 'asyncECMUpload'\r\n            \"CasesMonitor\": params.proxyPrefix + \"App/Admin/CasesMonitor.aspx\",\r\n            \"Closed\": params.proxyPrefix + \"App/ListaDetalle/listaitems.aspx?h_Location=Cerrados&I_ProcessState=Completed\",\r\n            \"CurrentUser\": params.proxyPrefix + \"App/Admin/CurrentUser.aspx\",\r\n            \"EncryptionAdmin\": params.proxyPrefix + \"App/Admin/Encrypt.aspx\",\r\n            \"MobileUpdatesAdmin\": params.proxyPrefix + \"App/MobileUpdates/default.aspx\",\r\n            \"EntityAdmin\": params.proxyPrefix + \"App/Admin/Entity.aspx\",\r\n            \"LocationResources\": params.proxyPrefix + \"App/Admin/AdminLocResources.aspx\",\r\n            \"NewCase\": params.proxyPrefix + \"App/Radicar/application.aspx\",\r\n            \"Pending\": params.proxyPrefix + \"App/ListaDetalle/listaitems.aspx?h_Location=Pendientes&I_processState=Running\",\r\n            \"Profiles\": params.proxyPrefix + \"App/Admin/ProfilesAdminSearch.aspx\",\r\n            \"Search\": params.proxyPrefix + \"App/ListaDetalle/Search.aspx\",\r\n            \"UserAdmin\": params.proxyPrefix + \"App/Admin/ListUsers.aspx\",\r\n            \"UserDefaultAssignation\": params.proxyPrefix + \"App/Admin/DefaultAssignationUser.aspx?h_AdminDefaultAssign=1\",\r\n            \"UserPendingRequests\": params.proxyPrefix + \"App/Admin/UserPendingRequests.aspx\",\r\n            \"ListPreferences\": (bizagi.UserPreferencesUrl !== \"\") ? params.proxyPrefix + bizagi.UserPreferencesUrl : params.proxyPrefix + \"App/Admin/CurrentUser.aspx\",\r\n            \"GRDimensionAdmin\": params.proxyPrefix + \"App/Cockpit/DimensionEdit.aspx\",\r\n            \"Licenses\": params.proxyPrefix + \"App/Admin/Licenses.aspx\",\r\n            \"AnalysisQueries\": params.proxyPrefix + \"App/Inicio/WPAnalysisQuery.aspx\",\r\n            \"DocumentTemplates\": params.proxyPrefix + \"App/Admin/AdminDocumentTemplates.aspx\",\r\n            \"ProcessAdmin\": params.proxyPrefix + \"App/Admin/AdminProcess.aspx\",\r\n            \"ResourceBAM\": params.proxyPrefix + \"App/Cockpit/BAMResourceMonitor.aspx\",\r\n            \"WorkPortalVersion\": params.proxyPrefix + \"Rest/Util/Version\",\r\n\r\n            // entities administration\r\n            \"entities-administration\": \"RestServices/EntityHandler.ashx\",\r\n\r\n            //Theme Rest Service Handler\r\n            \"theme-handler-getLogoImagePath\": params.proxyPrefix + \"Rest/Theme/LogoImage\",\r\n\r\n            // Logout Service, already implemented on java environment\r\n            \"logout\": params.proxyPrefix + \"Rest/Authentication/logout\",\r\n            \"logoutDotNet\": params.proxyPrefix + \"App/Inicio/LogOff.aspx\",            \r\n            \"authenticationConfig\": params.proxyPrefix + \"Api/Authentication/BizagiConfig\",\r\n            \"logout-oauth2\": params.proxyPrefix + \"Api/Authentication/OAuth2/IdentityProvider/Server/Logout\",\r\n            \"FederateLogoffUrl\": params.proxyPrefix + \"Api/Authentication/FederateLogoffUrl\",\r\n            \"oauth2AuthenticationConfig\": params.proxyPrefix + \"Api/Authentication/OAuth2/OAuth2AuthenticationConfig\",\r\n\r\n            //Massive Activity Asigments\r\n            \"massive-activity-assignments-getOrganizationInfo\": params.proxyPrefix + \"Rest/Users/OrganizationInfo\",\r\n            \"massive-activity-assignments-getCasesByOrganization\": params.proxyPrefix + \"Rest/Queries/GetCasesByOrganization\",\r\n            \"massive-activity-assignments-reassignCases\": params.proxyPrefix + \"Rest/Cases/ReassignCases\",\r\n            \"massive-activity-assignments-searchUsers\": params.proxyPrefix + \"Rest/Users/\",\r\n\r\n            //Asynchronous ECM Upload\r\n            \"async-ecm-upload-baseService\": params.proxyPrefix + \"Rest/Handlers/Metadata\",\r\n\r\n            // Workportal\r\n            \"domains\": params.proxyPrefix + \"Rest/Authentication/Domains\",\r\n\r\n            // Theme Builder\r\n            //\"ThemeBuilder\": params.proxyPrefix + \"ThemeBuilder/index.html?language=\" + bizagi.localization.language,\r\n            \"getCurrentTheme\": params.proxyPrefix + \"Api/Theme/Current\",\r\n\r\n            //Frankenstein\r\n            \"admin-getAuthenticationLog\": params.proxyPrefix + \"Rest/Users/AuthLog\",\r\n            \"admin-getAuthenticationDomains\": params.proxyPrefix + \"Rest/Users/Domains\",\r\n            \"admin-getAuthenticationEventsTypes\": params.proxyPrefix + \"Rest/Users/EventTypes\",\r\n            \"admin-getAuthenticationEventSubTypes\": params.proxyPrefix + \"Rest/Users/EventSubTypes\",\r\n            \"admin-EncryptString\": params.proxyPrefix + \"Rest/Util/EncryptString\",\r\n            \"admin-UserPendingRequests\": params.proxyPrefix + \"Rest/Users/UserPendingRequests\",\r\n            \"admin-UserAuthenticationInfo\": params.proxyPrefix + \"Rest/Users/UserAuthenticationInfo\",\r\n            \"admin-updateUserAuthenticationInfo\": params.proxyPrefix + \"Rest/Users/UpdateUserAuthenticationInfo\",\r\n            \"admin-generateRandomPassword\": params.proxyPrefix + \"Rest/Util/GenerateRandomPassword\",\r\n            \"admin-GenerateDataToSendByEmail\": params.proxyPrefix + \"Rest/Users/GenerateDataToSendByEmail\",\r\n            \"admin-sendEmail\": params.proxyPrefix + \"Rest/Util/SendEmail/\",\r\n            \"admin-getApplicationList\": params.proxyPrefix + \"Rest/Application\",\r\n            \"admin-getApplicationProcesses\": params.proxyPrefix + \"Rest/Application/{idApp}/Process\",\r\n            \"admin-getProcessVersion\": params.proxyPrefix + \"Rest/Processes/Version\",\r\n            \"admin-getProcessTasks\": params.proxyPrefix + \"Rest/Processes/Version/{version}/Tasks\",\r\n\r\n            //servicios alarmas\r\n            \"admin-getTaskAlarms\": params.proxyPrefix + \"Rest/Alarm/TaskAlarms\",\r\n            \"admin-getLapseMode\": params.proxyPrefix + \"Rest/Alarm/LapseMode\",\r\n            \"admin-getRecurrMode\": params.proxyPrefix + \"Rest/Alarm/RecurrMode\",\r\n            \"admin-getScheduleType\": params.proxyPrefix + \"Rest/Alarm/ScheduleType\",\r\n            \"admin-getBossList\": params.proxyPrefix + \"Rest/Alarm/Boss\",\r\n            \"admin-addAlarm\": params.proxyPrefix + \"Rest/Alarm\",\r\n            \"admin-editAlarm\": params.proxyPrefix + \"Rest/Alarm/{idAlarm}\",\r\n            \"admin-deleteAlarm\": params.proxyPrefix + \"Rest/Alarm\",\r\n            \"admin-alarmRecipients\": params.proxyPrefix + \"Rest/Alarm/{idAlarm}/Recipient\",\r\n            \"admin-deleteAlarmRecipients\": params.proxyPrefix + \"Rest/Alarm/Recipient\",\r\n            \"admin-recipientToAlarm\": params.proxyPrefix + \"Rest/Alarm/{idAlarm}/Recipient/{idRecipient}\",\r\n            \"admin-enableAlarm\": params.proxyPrefix + \"Rest/Alarm/Task/{idTask}/ToggleAlarm\",\r\n            \"admin-getCategoriesList\": params.proxyPrefix + \"Rest/Application/Category\",\r\n            \"admin-getCasesList\": params.proxyPrefix + \"Rest/Queries/SearchCases\",\r\n            \"admin-abortItems\": params.proxyPrefix + \"Rest/Cases/Abort\",\r\n            \"admin-reassignItems\": params.proxyPrefix + \"Rest/Cases/Reassign\",\r\n            \"admin-getDefaultAssignationUserToAllProcess\": params.proxyPrefix + \"Rest/Users/{serviceAction}/\",\r\n            \"admin-getDefaultAssignationUserToProcess\": params.proxyPrefix + \"Rest/Users/Process/{process}/AssignationUser\",\r\n            \"admin-setDefaultAssignationUserToProcess\": params.proxyPrefix + \"Rest/Users/Process/{process}/AssignationUser\",\r\n            \"admin-getProfilesTypes\": params.proxyPrefix + \"Rest/Profile/Types\",\r\n            \"admin-searchProfiles\": params.proxyPrefix + \"Rest/Profile\",\r\n            \"admin-getUsersByProfile\": params.proxyPrefix + \"Rest/Users/Profile/{type}/{id}\",\r\n            \"admin-removeUserFromProfile\": params.proxyPrefix + \"Rest/Profile/{type}/{id}/User/{idUser}/\",\r\n            \"admin-addUserToProfile\": params.proxyPrefix + \"Rest/Profile/{type}/{id}/User/{idUser}/\",\r\n            \"admin-async-activities-get-activities\": params.proxyPrefix + \"Rest/Cases/Asynchronous/Activities\",\r\n            \"admin-async-activities-get-retry-now\": params.proxyPrefix + \"Rest/Cases/{idCase}/Workitem/{idworkItem}/RetryNow\",\r\n            \"admin-async-activities-get-activities-by-task\": params.proxyPrefix + \"Rest/Cases/Asynchronous/Activities/Task\",\r\n            \"admin-async-activities-enable-execution\": params.proxyPrefix + \"Rest/Cases/Asynchronous/Enable\",\r\n            \"admin-async-activities-enable-multiple\": params.proxyPrefix + \"Rest/Cases/Asynchronous/EnableMultiple\",\r\n            \"admin-async-activities-async-execution\": params.proxyPrefix + \"Rest/Cases/{idCase}/Workitem/{idWorkitem}/AsynchExecution\",\r\n            \"admin-async-activities-async-execution-log\": params.proxyPrefix + \"Rest/Cases/{idCase}/Workitem/{idworkItem}/AsynchExecutionLog\",\r\n            \"admin-Licenses\": params.proxyPrefix + \"Rest/Licenses\",\r\n            \"admin-GetDimensions\": params.proxyPrefix + \"Rest/Dimensions\",\r\n            \"admin-EditDimension\": params.proxyPrefix + \"Rest/Dimensions/{id}\",\r\n            \"admin-CreateAdministrableDimension\": params.proxyPrefix + \"Rest/Dimensions/Administrable\",\r\n            \"admin-DeleteDimension\": params.proxyPrefix + \"Rest/Dimensions/{id}?isAdministrable={administrable}\",\r\n            \"admin-EntityPathChildNodesAction\": params.proxyPrefix + \"Rest/Dimensions/EntityChildNodes\",\r\n            \"admin-GetActiveWFClasses\": params.proxyPrefix + \"Rest/Dimensions/ActiveProcess\",\r\n            \"admin-document-templates-storeDocumentTemplates\": params.proxyPrefix + \"Rest/DocumentTemplates/StoreDocumentTemplates\",\r\n            \"admin-document-templates-restoreDocumentTemplates\": params.proxyPrefix + \"Rest/DocumentTemplates/RestoreDocumentTemplate\",\r\n            \"admin-document-templates-uploadDocumentTemplate\": params.proxyPrefix + \"Rest/DocumentTemplates/UploadDocumentTemplate\",\r\n            \"admin-processes-workflowClasses\": params.proxyPrefix + \"Rest/Processes/WorkflowClasses\",\r\n            \"admin-processes-tasksByWorkflow\": params.proxyPrefix + \"Rest/Processes/TasksByWorkflow\",\r\n            \"admin-processes-modifyProcessDuration\": params.proxyPrefix + \"Rest/Processes/{idWorkflow}/Duration/\",\r\n            \"admin-processes-modifyTaskDuration\": params.proxyPrefix + \"Rest/Processes/Task/{idTask}/Duration/\",\r\n            \"admin-language-resource\": params.proxyPrefix + \"Rest/Multilanguage/Resource\",\r\n            \"admin-language-languages\": params.proxyPrefix + \"Rest/Multilanguage/Languages\",\r\n            \"bam-resourcemonitor-myteam\": params.proxyPrefix + \"Rest/Reports/BAM/Resources/MyTeam\",\r\n            \"reports-analysisquery\": params.proxyPrefix + \"Rest/Reports/AnalysisQueries\",\r\n            \"reports-analysisquery-update\": params.proxyPrefix + \"Rest/Reports/AnalysisQueries\",\r\n            \"reports-analysisquery-delete\": params.proxyPrefix + \"Rest/Reports/AnalysisQueries\",\r\n            \"processviewer-processdefinition\": params.proxyPrefix + \"Rest/Reports/Components/ProcessDefinition\",\r\n            \"processviewer-processgraphicinfo\": params.proxyPrefix + \"Rest/Reports/Components/ProcessGraphicInfo\",\r\n            \r\n             // Mobile Updates\r\n            \"mobile-getLastUpdate\": params.proxyPrefix + \"Rest/Util/mobileUpdates\",\r\n\r\n            //discussionCase\r\n            \"discussion-case\": params.proxyPrefix + \"Api/CaseResource/Discussion?globalParent={globalParent}\",\r\n            \"discussion-case-v1\": params.proxyPrefix + \"Api/CaseResource/{globalParent}/Discussion\",\r\n            \"get-users\": params.proxyPrefix + \"Rest/Users/UserPictures\",\r\n            \"new-discussion\": params.proxyPrefix + \"Api/CaseResource/Discussion\",\r\n            \"count-comments\": params.proxyPrefix + \"Api/CaseResource/{idParent}/Comment/Count\",\r\n            \"comment-case\": params.proxyPrefix + \"Api/CaseResource/{idParent}/Comment\",\r\n            \"new-comment\": params.proxyPrefix + \"Api/CaseResource/Comment\",\r\n            \"new-comment-attach\": params.proxyPrefix + \"Api/CaseResource/Attachment\",\r\n            \"get-list-files\": params.proxyPrefix + \"Api/CaseResource/File?globalParent={globalParent}\",\r\n            \"get-list-files-v1\": params.proxyPrefix + \"Api/CaseResource/{globalParent}/File\",\r\n            \"project-resource-action\": params.proxyPrefix + \"Api/CaseResource/{typeResource}\",\r\n            \"thumbnail-file\": params.proxyPrefix + \"Api/CaseResource/File/Thumbnails\",\r\n            \"get-attachment\": params.proxyPrefix + \"Api/CaseResource/Attachment/{idAttachment}\",\r\n            \"get-mobile-attachment\": params.proxyPrefix + \"Api/CaseResource/Mobile/Attachment/{idAttachment}\",\r\n\r\n            //Files and Attachments\r\n            \"project-files-upload\": params.proxyPrefix + \"Api/CaseResource/File\",\r\n            \"count-files\": params.proxyPrefix + \"Api/CaseResource/File/Count?globalParent={globalParent}\",\r\n            \"count-files-v1\": params.proxyPrefix + \"Api/CaseResource/{globalParent}/File/Count\",\r\n            \"remove-comment\": params.proxyPrefix + \"Api/CaseResource/Comment\",\r\n\r\n            //Mobile CaseSummary\r\n            \"time-schemas-effectiveduration\": params.proxyPrefix + \"Api/WorkingTimeSchema/EffectiveDuration?idUser={idUser}&fromDate={fromDate}&toDate={toDate}\",\r\n            \"case-handler-getCaseAssignees\": params.proxyPrefix + \"Rest/Cases/{idCase}/Assignees\",\r\n            \"project-users-get\": params.proxyPrefix + \"Rest/Users/UserPictures\",\r\n\r\n            //Mobile plans\r\n            \"project-plan-get\": params.proxyPrefix + \"Api/Plans/{idPlan}\",\r\n            \"project-plan-activities\": params.proxyPrefix + \"Api/Plans/{idPlan}/Activities\",\r\n            \"project-plan-workitems\": params.proxyPrefix + \"Api/Plans/{idPlan}/WorkItems\",\r\n            \"project-plan-transitions-get\": params.proxyPrefix + \"Api/Plans/{idPlan}/Activities/Transitions\",\r\n            \"project-plan-activity-edit\": params.proxyPrefix + \"Api/Plans/{idPlan}/Activities/{id}\",\r\n            \"project-plan-get-by-parent\": params.proxyPrefix + \"Api/Plans?parentWorkItem={parentWorkItem}\",\r\n            \"project-plan-parent\": params.proxyPrefix + \"Api/Plans/{idPlan}/ParentCase\",\r\n            \"project-plan-update\": params.proxyPrefix + \"Api/Plans/{idPlan}\",\r\n            \"project-plan-execute\": params.proxyPrefix + \"Api/Plans/Execute\",\r\n            \"project-plan-close\": params.proxyPrefix + \"Api/Plans/Close\",\r\n            \"project-plan-delete\": params.proxyPrefix + \"Api/Plans/{idPlan}\",\r\n            \"project-plan-first-parent-plan\": params.proxyPrefix + \"Api/Plans/{idPlan}/FirstParentPlan\"\r\n        };\r\n\r\n        var newUserServices = bizagi.util.getFeatureObject(\"userService.v1.enabled\");\r\n        if (newUserServices) {\r\n\r\n            endPoints[\"user-handler-getCurrentUser\"] = params.proxyPrefix + \"Rest/Users/CurrentUserGuid\";\r\n            endPoints[\"get-users\"] = params.proxyPrefix + \"Rest/Users/UserPicturesGuid\";\r\n            endPoints[\"entities-handler-getUsersImages\"] = params.proxyPrefix + \"Rest/Users/UserPicturesGuid\";\r\n            endPoints[\"project-users-get\"] = params.proxyPrefix + \"Rest/Users/UserPicturesGuid\";\r\n            \r\n            endPoints[\"entities-handler-getUsers\"] = params.proxyPrefix + \"Api/Cases/{caseId}/UsersGuid\";\r\n            //endPoints[\"case-handler-getWorkItems\"] = params.proxyPrefix + \"Rest/Cases/{idCase}/WorkItemsGuid\";\r\n            endPoints[\"case-handler-getCaseSummary\"] = params.proxyPrefix + \"Rest/Cases/{idCase}/SummaryGuid\";\r\n            endPoints[\"case-handler-getCaseAssignees\"] = params.proxyPrefix + \"Rest/Cases/{idCase}/AssigneesGuid\";\r\n\r\n            endPoints[\"discussion-case\"] = params.proxyPrefix + \"Api/CaseResource/DiscussionGuid?globalParent={globalParent}\";\r\n            //endPoints[\"discussion-case-v1\"] = params.proxyPrefix + \"Api/CaseResource/{globalParent}/DiscussionGuid\";\r\n            endPoints[\"new-discussion\"] = params.proxyPrefix + \"Api/CaseResource/DiscussionGuid\";\r\n            \r\n            endPoints[\"comment-case\"] = params.proxyPrefix + \"Api/CaseResource/{idParent}/CommentGuid\";\r\n            endPoints[\"new-comment\"] = params.proxyPrefix + \"Api/CaseResource/CommentGuid\";\r\n\r\n            endPoints[\"project-files-upload\"] = params.proxyPrefix + \"Api/CaseResource/FileGuid\";\r\n            endPoints[\"get-list-files\"] = params.proxyPrefix + \"Api/CaseResource/FileGuid?globalParent={globalParent}\";\r\n      \r\n            //Mobile case summary\r\n            endPoints[\"time-schemas-effectiveduration\"] = params.proxyPrefix + \"Api/WorkingTimeSchema/EffectiveDurationGuid?idUser={idUser}&fromDate={fromDate}&toDate={toDate}\";\r\n            //Mobile plans\r\n            endPoints[\"project-plan-get\"] = params.proxyPrefix + \"Api/Plans/Guid/{idPlan}\";\r\n            endPoints[\"project-plan-update\"] = params.proxyPrefix + \"Api/Plans/Guid/{idPlan}\";\r\n            endPoints[\"project-plan-activities\"] = params.proxyPrefix + \"Api/Plans/{idPlan}/ActivitiesGuid\";\r\n            endPoints[\"project-plan-workitems\"] = params.proxyPrefix + \"Api/Plans/{idPlan}/WorkItemsGuid\";\r\n            endPoints[\"project-plan-first-parent-plan\"] = params.proxyPrefix + \"Api/Plans/{idPlan}/FirstParentPlanGuid\";\r\n            endPoints[\"project-plan-activity-edit\"] = params.proxyPrefix + \"Api/Plans/{idPlan}/ActivitiesGuid/{id}\";      \r\n        }\r\n\r\n        return endPoints;\r\n    }\r\n    return {};\r\n};","/*\r\n *   Name: BizAgi Rendering Services\r\n *   Author: Diego Parra (based on Edward Morales version)\r\n *   Comments:\r\n *   -   This class will provide a facade to access to workportal REST services\r\n */\r\n\r\n$.Class.extend(\"bizagi.workportal.services.service\", {\r\n    // Statics\r\n    BA_CONTEXT_PARAMETER_PREFIX: \"h_\",\r\n    ENTITIES_QUERY_PAGE_SIZE: 10\r\n}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function (params) {\r\n        var self = this;\r\n        params = typeof (params) == \"object\" ? params : {};\r\n        params.context = !bizagi.util.isEmpty(params.context) ? params.context : \"workportal\";\r\n\r\n        params.proxyPrefix = !bizagi.util.isEmpty(params.proxyPrefix) ? params.proxyPrefix : \"\";\r\n        params.proxyPrefix = this.normalizeUrl(params.proxyPrefix);\r\n        bizagi.RPproxyPrefix = params.proxyPrefix;\r\n\r\n\r\n        params.sharepointProxyPrefix = !bizagi.util.isEmpty(params.sharepointProxyPrefix) ? params.sharepointProxyPrefix : \"\";\r\n        params.sharepointProxyPrefix = this.normalizeUrl(params.sharepointProxyPrefix);\r\n\r\n        this.serviceLocator = new bizagi.workportal.services.context(params);\r\n\r\n        // Define default value of number of records to show\r\n        this.pageSize = 10;\r\n\r\n        this.deviceType = params.deviceType || (bizagi.util.isSmartphoneDevice() ? bizagi.deviceEnum.smartphone: (bizagi.util.isTabletDevice() ? bizagi.deviceEnum.tablet: bizagi.deviceEnum.desktop));\r\n        this.deviceCode = bizagi.util.getDeviceCode();\r\n\r\n        // Get override for pageSize, use BIZAGI_INBOX_ROWS_PER_PAGE constant within config file\r\n        if (typeof BIZAGI_INBOX_ROWS_PER_PAGE !== \"undefined\") {\r\n            this.pageSize = ($.isNumeric(BIZAGI_INBOX_ROWS_PER_PAGE)) ? BIZAGI_INBOX_ROWS_PER_PAGE : this.pageSize;\r\n        }\r\n    },\r\n    /**\r\n     * This method will return the url defined as endPoint using the parameter 'endPoint' name\r\n     */\r\n    getUrl: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(params.endPoint);\r\n        return url;\r\n    },\r\n    /**\r\n     * This method will return the url normalized\r\n     */\r\n    normalizeUrl: function (url) {\r\n        if (url !== \"\") {\r\n            if (url[url.length - 1] != \"/\") {\r\n                url = url.concat(\"/\");\r\n            }\r\n\r\n            if (url.indexOf(\"http://\") == -1 && url.indexOf(\"https://\") == -1) {\r\n                url = \"http://\" + url;\r\n            }\r\n        }\r\n        return url;\r\n    },\r\n\r\n    /**\r\n     * This service get all overrides keys within configuration project\r\n     *\r\n     * @return {json}\r\n     */\r\n    getOverrides: function () {\r\n        var self = this;\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"overrides\")\r\n        }).pipe(function (overrides) {\r\n            overrides = overrides || {};\r\n\r\n            $.each(overrides, function (key, value) {\r\n                var valueUppercase = value.toUpperCase();\r\n                if (valueUppercase == \"TRUE\" || valueUppercase == \"FALSE\") {\r\n                    overrides[key] = bizagi.util.parseBoolean(value);\r\n                }\r\n            });\r\n\r\n            return overrides;\r\n        });\r\n    },\r\n\r\n    /**\r\n     * This service get json of theme definition\r\n     *@return {json} theme definition\r\n     */\r\n    getCurrentTheme: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('getCurrentTheme');\r\n\r\n        return $.read(url);\r\n    },\r\n\r\n    /**\r\n     * This method will return the response of the user information login is correct\r\n     * this method is use for native smartphone\r\n     **/\r\n    authenticatedUser: function (params) {\r\n        var self = this;\r\n        var urlSend = self.serviceLocator.getUrl(\"login-handler\");\r\n\r\n        return $.read({\r\n            url: urlSend,\r\n            data: {\r\n                \"userName\": BIZAGI_USER,\r\n                \"password\": BIZAGI_PASSWORD,\r\n                \"domain\": BIZAGI_DOMAIN\r\n            }\r\n        }).pipe(\r\n            function (response) {\r\n                return response;\r\n            },\r\n            function (data) {\r\n                urlSend = self.serviceLocator.getUrl('login-handlerv10');\r\n                urlSend = urlSend.replace('{0}', BIZAGI_USER || '');\r\n                urlSend = urlSend.replace('{1}', BIZAGI_PASSWORD || '');\r\n                urlSend = urlSend.replace('{2}', BIZAGI_DOMAIN || '');\r\n                return $.ajax({\r\n                    url: urlSend,\r\n                    type: 'GET',\r\n                    dataType: 'json'\r\n                });\r\n            }\r\n        );\r\n    },\r\n\r\n    /**\r\n     *\r\n     * this method is use for native smartphone\r\n     **/\r\n    logoutUser: function (params) {\r\n        var self = this;\r\n        var urlSend = self.serviceLocator.getUrl('logoff-handlerv1');\r\n        return $.read({\r\n            url: urlSend\r\n        });\r\n    },\r\n    /*\r\n     *   Logoff the current user\r\n     */\r\n    logOffUser: function (params) {\r\n        var self = this;\r\n        var urlSend = self.serviceLocator.getUrl(\"logoff-handler\");\r\n        return $.read({\r\n            url: urlSend\r\n        });\r\n    },\r\n    /*\r\n     *   Gets the current working user\r\n     */\r\n    getCurrentUser: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl(\"user-handler-getCurrentUser\"));\r\n    },\r\n    /*\r\n     *   Gets the inbox summary for the current logged user\r\n     *   Returns a promise of the data being retrieved\r\n     */\r\n    getInboxSummary: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl(\"inbox-handler-getInboxSummary\"))\r\n            .pipe(function (response) {\r\n                // Extract inboxSummary property\r\n                return response[\"inboxSummary\"];\r\n            });\r\n    },\r\n    /*\r\n     *   Return all the available processes in bizagi\r\n     */\r\n    getAllProcesses: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl('process-handler-getAllProcesses');\r\n\r\n        if (params.taskState != undefined) {\r\n            data['taskState'] = params.taskState;\r\n        }\r\n\r\n        if (params.onlyFavorites != undefined && params.onlyFavorites != '') {\r\n            data['onlyFavorites'] = params.onlyFavorites;\r\n        }\r\n\r\n        if (params.myActivities != undefined && params.myActivities != \"\") {\r\n            data[\"myActivities\"] = params.myActivities;\r\n        }\r\n\r\n        if (params.myPendings != undefined && params.myPendings != \"\") {\r\n            data[\"myPendings\"] = params.myPendings;\r\n        }\r\n\r\n        if (params.smartfoldersParameters) {\r\n            url = url + '?' + params.smartfoldersParameters;\r\n        }\r\n\r\n        if (bizagi.isMobile()) {\r\n            data['mobileDevice'] = true;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                // !! (double Not) (bang bang) <-- For Boolean Type Casting http://jibbering.com/faq/notes/type-conversion/#tcBool\r\n                if (!!params.skipAggrupate)\r\n                    return response;\r\n                // Aggrupate workflows by categories\r\n                var responseData = {};\r\n                var categories = {};\r\n                var allProcesses = bizagi.localization.getResource('workportal-widget-inbox-all-processes');\r\n                var allCases = {\r\n                    name: bizagi.localization.getResource('workportal-widget-inbox-all-cases'),\r\n                    path: '',\r\n                    category: allProcesses,\r\n                    isFavorite: (params.onlyFavorites || false),\r\n                    guidFavorite: '',\r\n                    idworkflow: '',\r\n                    guidWFClass: '',\r\n                    count: 0\r\n                };\r\n\r\n                // Create a default category\r\n                categories[allProcesses] = [];\r\n                categories[allProcesses].workflows = [];\r\n                categories[allProcesses].workflows.push(allCases);\r\n                if (response.workflows) {\r\n                    $.each(response.workflows.workflow, function (i, workflow) {\r\n                        // Creates the category if it doesn't exist\r\n                        if (!categories[workflow.category]) {\r\n                            categories[workflow.category] = [];\r\n                            categories[workflow.category].workflows = [];\r\n                        }\r\n\r\n                        // Push the workflow\r\n                        categories[workflow.category].workflows.push(workflow);\r\n\r\n                        // Sum the cases count\r\n                        //  if (bizagi.util.isEmpty(params.onlyFavorites) || params.onlyFavorites == false) {\r\n                        allCases.count += Number(workflow.count);\r\n                        // }\r\n                    });\r\n                }\r\n\r\n                // Build result array once grouped\r\n                responseData.categories = [];\r\n                for (key in categories) {\r\n                    responseData.categories.push({\r\n                        name: key,\r\n                        workflows: categories[key].workflows\r\n                    });\r\n                }\r\n\r\n                return responseData;\r\n            });\r\n    },\r\n    /*\r\n     *   Return my favourites count\r\n     */\r\n    getFavourites: function () {\r\n        var self = this;\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"process-handler-getFavourites\");\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Return my favourites count\r\n     */\r\n    getMyStuff: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"process-handler-getMyStuff\");\r\n\r\n        if (typeof params.icon !== \"undefined\" && params.icon) {\r\n            data.icon = true;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data);\r\n    },\r\n    /*\r\n     *   Return my favourites cases\r\n     */\r\n    getFavouriteCases: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"process-handler-getFavouriteCases\");\r\n\r\n        data[\"pageSize\"] = params.pageSize || self.pageSize;\r\n        data[\"page\"] = params.page || 1;\r\n\r\n        if (bizagi.isMobile()) {\r\n            data[\"mobileDevice\"] = true;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Return all the available cases in bizagi and thinking for mobile response\r\n     */\r\n    getCasesList: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"case-handler-getCasesList\");\r\n\r\n        params = params || {};\r\n\r\n        data[\"pageSize\"] = params.pageSize || 10;\r\n        data[\"page\"] = params.page || 1;\r\n        data[\"numberOfFields\"] = params.numberOfFields || \"-1\"; //1;\r\n        data[\"idWfClass\"] = params.idWfClass || \"-1\";\r\n\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                var elementToHtml = {\r\n                    overdue: [],\r\n                    today: [],\r\n                    tomorrow: [],\r\n                    upcoming: [],\r\n                    page: response.page,\r\n                    totalPages: response.totalPages\r\n                };\r\n                var actualDate = new Date();\r\n                var actualMonth = actualDate.getMonth();\r\n                var actualDay = actualDate.getDate();\r\n                var actualYear = actualDate.getYear();\r\n                var lengthData = typeof response.elements !== \"undefined\" ? response.elements.length : 0;\r\n\r\n                for (var counter = 0; lengthData > counter; counter++) {\r\n                    var tmpElement = response.elements[counter];\r\n                    var tmpdate = new Date(tmpElement[3]);\r\n                    var tmpDay = tmpdate.getDate();\r\n                    var tmpMonth = tmpdate.getMonth();\r\n                    var tmpYear = tmpdate.getYear();\r\n\r\n                    if (actualDay > tmpDay || (actualMonth > tmpMonth || actualYear > tmpYear)) {\r\n                        tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"dd MMM yyyy\");\r\n                        elementToHtml.overdue.push(tmpElement);\r\n                    } else {\r\n                        if (actualDay == tmpDay) {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm\");\r\n                            elementToHtml.today.push(tmpElement);\r\n\r\n                        } else if ((actualDay + 1) == tmpDay) {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm\");\r\n                            elementToHtml.tomorrow.push(tmpElement);\r\n\r\n                        } else {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"dd MMM yyyy\");\r\n                            elementToHtml.upcoming.push(tmpElement);\r\n                        }\r\n                    }\r\n                }\r\n                return elementToHtml;\r\n            });\r\n\r\n    },\r\n\r\n    /*\r\n     *   Return all the available cases in bizagi and thinking for mobile response\r\n     */\r\n    getCasesListBeta: function (params) {\r\n        var self = this;\r\n\r\n        return self.getMobileCasesList(params)\r\n            .then(function (response) {                \r\n                var groupedData = {\r\n                    elements: [],\r\n                    page: response.page,\r\n                    totalPages: response.totalPages,\r\n                    advanceSearch: response.advanceSearch || false\r\n                };\r\n\r\n                var actualDate = new Date();\r\n                var statusFunction = response.advanceSearch ? self.defineActivityStateByTaskState :self.defineActivityStateByDate;\r\n\r\n                for (var counter = 0; response.elements.length > counter; counter++) {\r\n                    var tmpElement = response.elements[counter];\r\n                    var status = {};\r\n\r\n                    status = statusFunction(tmpElement[3], tmpElement.taskstate);\r\n\r\n                    // Time to atRiskTimeDelta\r\n                    if (tmpElement.length >= 10 && parseInt(tmpElement[11], 10) > 0) {\r\n                        var tmpEndDate = new Date(tmpElement[3]);\r\n\r\n                        if (actualDate.getTime() > tmpEndDate.getTime()) {\r\n                            status.state = \"red\";\r\n                        } else {\r\n                            if (actualDate.getTime() > (tmpEndDate.getTime() - (parseInt(tmpElement[11], 10) * 60000))) {\r\n                                status.state = \"yellow\";\r\n                            } else {\r\n                                status.state = \"green\";\r\n                            }\r\n                        }\r\n                    }\r\n                \r\n                    groupedData.elements.push($.extend({}, tmpElement, status, {\r\n                        \"endDate\": tmpElement[3],\r\n                        \"idworkitem\": tmpElement[1],\r\n                        \"idwfclass\": !bizagi.util.validateFeatureSupport(\"advancedSearch\") ? tmpElement[7] : tmpElement[10]\r\n                    }));\r\n                }                               \r\n                return groupedData;\r\n            });\r\n    },\r\n   \r\n    getMobileCasesList: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        params = params || {};\r\n\r\n        if (typeof params.radNumber !== \"undefined\") {\r\n            data[\"radNumber\"] = params.radNumber;\r\n        }\r\n\r\n        data[\"pageSize\"] = params.pageSize || 10;\r\n        data[\"page\"] = params.page || 1;\r\n\r\n        var urlMobile = self.serviceLocator.getUrl(\"case-handler-getActivityList\");\r\n\r\n        //if server version is less than server version where the new service was implemented, then call last version of service\r\n        if (!bizagi.util.validateFeatureSupport(\"advancedSearch\")) {\r\n            urlMobile = self.serviceLocator.getUrl(\"case-handler-getCasesList\");\r\n            data[\"numberOfFields\"] = params.numberOfFields || \"-1\"; //1;\r\n            data[\"idWfClass\"] = params.idWfClass || \"-1\";\r\n            return $.read(urlMobile, data);\r\n        }\r\n\r\n        return $.read(urlMobile, data).then(function (resp) {\r\n            var response = {elements: [], rows: []};\r\n            var row, i = -1;\r\n            while ((row = resp.rows[++i])) {\r\n                var tempElement = {}, el = [\"\", \"\", \"\", \"\", \"\", \"\", [], \"\", \"\", \"\", \"\",\"\",\"\"];\r\n                var field, j = -1;\r\n                while ((field = resp.headers[++j])) {\r\n                    tempElement[field.fieldName.toLowerCase()] = {\r\n                        \"displayName\": field.displayName,\r\n                        \"value\": row[j]\r\n                    };\r\n                    self.serializeActivity(el, field.fieldName.toLowerCase(), tempElement[field.fieldName.toLowerCase()]);\r\n                }\r\n\r\n                response.elements.push(el);\r\n                response.rows.push(tempElement);\r\n            }\r\n            return {\r\n                \"page\": resp.page || resp.currentPage,\r\n                \"totalPages\": resp.totalPages,\r\n                \"elements\": response.elements,\r\n                \"rows\": response.rows,\r\n                \"advanceSearch\": true\r\n            };\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Returns the activity status based on the end date and the risk\r\n     * @param {String} endDate ISO representation of a date\r\n     * @returns {{}}\r\n     */\r\n    defineActivityStateByDate: function (endDate) {\r\n        var status = {};\r\n\r\n        if ( endDate ) {\r\n            var activityDate = new Date( endDate );\r\n            var now = new Date();\r\n            var today = new Date( now.getFullYear(), now.getMonth(), now.getDate() );\r\n            var second = 1000;\r\n            var minute = 60 * second;\r\n            var day = 24 * 60 * minute;\r\n\r\n            // Before today\r\n            if( activityDate.getTime( ) < today.getTime( ) - second ) {\r\n                status = { group: \"1|\" + bizagi.localization.getResource(\"workportal-taskfeed-overdue\"), state: \"red\",  type: \"overdue\", icon: \"overdue\", shortEndDate: bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\")};\r\n            }\r\n            // Today but before now\r\n            else if( activityDate.getTime( ) < now.getTime( ) + minute - second ) {\r\n                status = { group: \"2|\" + bizagi.localization.getResource(\"workportal-taskfeed-today\"), state: \"red\", type: \"today\", icon: \"overdue\", shortEndDate: bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\")};\r\n            }\r\n            // Today but after now\r\n            else if( activityDate.getTime( ) < today.getTime( ) + day - second ) {\r\n                status = { group: \"2|\" + bizagi.localization.getResource(\"workportal-taskfeed-today\"), state: \"yellow\", type: \"today\", icon: \"ontime\", shortEndDate: bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\") };\r\n            }\r\n            // Tomorrow\r\n            else if( activityDate.getTime( ) < today.getTime( ) + 2 * day - second ) {\r\n                status = { group: \"3|\" + bizagi.localization.getResource(\"workportal-taskfeed-tomorrow\"), state: \"green\", type: \"tomorrow\" , icon: \"upcoming\", shortEndDate:  bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\")};\r\n            }\r\n            // After tomorrow\r\n            else {\r\n                status = { group: \"4|\" + bizagi.localization.getResource(\"workportal-taskfeed-upcomming\"), state: \"green\", type: \"upcoming\" , icon: \"upcoming\", shortEndDate:  bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\")};\r\n            }\r\n        } else {\r\n            status = { group: \"1|\" + bizagi.localization.getResource(\"workportal-taskfeed-overdue\"), state: \"red\", type: \"overdue\", shortEndDate : \"--\" ,  icon: \"overdue\"};\r\n        }\r\n\r\n        return status;\r\n    },\r\n\r\n    /**\r\n     * Returns the activity status based on the taskstate property\r\n     * @param {String} endDate ISO representation of a date\r\n     * @param {String} taskstate Color name\r\n     * @returns {{}}\r\n     */\r\n    defineActivityStateByTaskState: function(endDate, taskstate) {\r\n        var status = {\r\n            group: \"1|\" + bizagi.localization.getResource(\"workportal-taskfeed-overdue\"),\r\n            state: taskstate,\r\n            type: \"overdue\",\r\n            shortEndDate : \"--\",\r\n            icon: \"overdue\"\r\n        };\r\n\r\n        if ( endDate && taskstate ) {\r\n            var activityDate = new Date( endDate );\r\n            var now = new Date();\r\n            var today = new Date( now.getFullYear(), now.getMonth(), now.getDate() );\r\n            var second = 1000;\r\n            var minute = 60 * second;\r\n            var day = 24 * 60 * minute;\r\n\r\n            status = {\r\n                group: \"\",\r\n                state: taskstate,\r\n                type: \"\",\r\n                icon: \"\",\r\n                shortEndDate: bizagi.util.dateFormatter.formatDate(new Date(endDate), \"MMMM dd yyyy | hh:mm tt\")\r\n            };\r\n            // Before today\r\n            if( activityDate.getTime( ) < today.getTime( ) - second ) {\r\n                status.group = \"1|\" + bizagi.localization.getResource(\"workportal-taskfeed-overdue\");\r\n                status.type = \"overdue\";\r\n            }\r\n            // Today\r\n            else if( activityDate.getTime( ) < today.getTime( ) + day - second ) {\r\n                status.group = \"2|\" + bizagi.localization.getResource(\"workportal-taskfeed-today\");\r\n                status.type = \"today\";\r\n            }\r\n            // Tomorrow\r\n            else if( activityDate.getTime( ) < today.getTime( ) + 2 * day - second ) {\r\n                status.group = \"3|\" + bizagi.localization.getResource(\"workportal-taskfeed-tomorrow\");\r\n                status.type = \"tomorrow\";\r\n            }\r\n            // After tomorrow\r\n            else {\r\n                status.group = \"4|\" + bizagi.localization.getResource(\"workportal-taskfeed-upcomming\");\r\n                status.type = \"upcoming\";\r\n            }\r\n\r\n            switch( taskstate ) {\r\n                case \"green\":\r\n                    status.icon = \"upcoming\";\r\n                    break;\r\n                case \"yellow\":\r\n                    status.icon = \"ontime\";\r\n                    break;\r\n                case \"red\":\r\n                default:\r\n                    status.icon = \"overdue\";\r\n                    break;\r\n            }\r\n        }\r\n        return status;\r\n    },\r\n\r\n    serializeActivity: function (el, fieldName, element) {\r\n        switch (fieldName) {\r\n            case \"radnumber\":\r\n                el[6].push([element.displayName, element.value]);\r\n                break;\r\n            //Proceso\r\n            case \"wfclsdisplayname\":\r\n                el[4] = element.value !== null ? element.value.toString() : bizagi.localization.getResource(\"workportal-project-activity-plan\");\r\n                break;\r\n            //Actividad\r\n            case \"currenttask\":\r\n                el[5] = element.value !== null ? element.value.toString() : bizagi.localization.getResource(\"workportal-project-casedashboard-activity\");\r\n                break;\r\n            //Fecha creacin caso\r\n            case \"cascreationdate\":\r\n                el[12] = element.value;\r\n                break;\r\n            // Actividad vence en\r\n            case \"wiestimatedsolutiondate\":\r\n                el[3] = element.value;\r\n                break;\r\n            //Fecha Solucin caso\r\n            case \"cassolutiondate\":\r\n                //el[6] = [\"\"];\r\n                break;\r\n            // Id de caso\r\n            case \"idcase\":\r\n                el[0] = element.value;\r\n                break;\r\n            // idWorkItem\r\n            case \"idworkitem\":\r\n                el[1] = element.value.toString();\r\n                break;\r\n            //Fecha de entrada al estado\r\n            case \"wientrydate\":\r\n                //el[6] = [\"\"];\r\n                break;\r\n            case \"taskid\":\r\n                el[2] = element.value;\r\n                break;\r\n            case \"taskstate\":\r\n                el.taskstate = ( element.value ? ( \"\" + element.value ).toLowerCase() : \"\" );\r\n                break;\r\n            //idWorkflow\"\r\n            case \"idwfclass\":\r\n                el[10] = el.idwfclass = element.value;\r\n                break;\r\n            //Is Favorite\r\n            case \"isfavorite\":\r\n                el[9] = element.value;\r\n                break;\r\n            case \"atrisktime\":\r\n                el[11] = element.value;\r\n                break;\r\n            case \"guidfavorite\":\r\n                el[8] = element.value;\r\n                break;\r\n            case \"isevent\":\r\n                el.isEvent = element.value;\r\n                break;\r\n            case \"datachangesetversion\":\r\n                el.dataChangeset = element.value;\r\n                break;                \r\n        }\r\n    },\r\n\r\n    /**\r\n     * Obtiene la lista de actividades para el usuario actual con filtros\r\n     * Version: 2, Llamado al servicio con todas las prestaciones de filtrado\r\n     */\r\n    getCurrentActivities: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        params = params || {};\r\n\r\n        data[\"page\"] = params.page || 1;\r\n        data[\"pageSize\"] = params.pageSize || 10;\r\n\r\n        if (typeof params.radNumber !== \"undefined\") {\r\n            data[\"radNumber\"] = params.radNumber;\r\n        }\r\n\r\n        var url = self.serviceLocator.getUrl('case-handler-getActivityList');\r\n        return $.read(url, data).then(function (resp) {\r\n            return self.processActivitiesResponse(resp);\r\n        });\r\n    },\r\n\r\n    processActivitiesResponse: function (resp, highlight, process_filter) {\r\n        var self = this;\r\n        var row;\r\n        var i = -1;\r\n\r\n        resp.elements = [];\r\n        resp.processes = [];\r\n\r\n        while ((row = resp.rows[++i])) {\r\n            var tempElement = {};\r\n            var field, j = -1;\r\n            while ((field = resp.headers[++j])) {\r\n                tempElement[\"o_\" + field.fieldName.toLowerCase()] = {\"displayName\": field.displayName, \"value\": row[j]};\r\n                tempElement[field.fieldName.toLowerCase()] = row[j];\r\n            }\r\n            $.extend(tempElement, self.defineActivityStateByDate(tempElement[\"wiestimatedsolutiondate\"]), {highlightedNumber: self.highlightsString(tempElement[\"radnumber\"], highlight)});\r\n            resp.elements.push(tempElement);\r\n\r\n            var process = resp.processes.find(function (el) {\r\n                return el.processname == tempElement[\"wfclsdisplayname\"];\r\n            });\r\n\r\n            if (typeof process === \"undefined\") {\r\n                resp.processes.push({\r\n                    processname: tempElement[\"wfclsdisplayname\"],\r\n                    idwfclass: tempElement[\"idwfclass\"],\r\n                    active: (process_filter || false) ? \"active\" : \"\"\r\n                });\r\n            }\r\n        }\r\n        return resp;\r\n    },\r\n\r\n    highlightsString: function (string, highlight) {\r\n        if (typeof string !== \"string\" || typeof highlight !== \"string\") {\r\n            return string;\r\n        }\r\n\r\n        var expresion = new RegExp(highlight, \"gi\");\r\n        return string.replace(expresion, function (match, offset) {\r\n            return \"<strong>\" + match + \"</strong>\";\r\n        });\r\n    },\r\n\r\n    getDiscussionCase: function (params) {\r\n        var self = this;\r\n        var data = data || {};\r\n        data['globalParent'] = params.globalParent;\r\n        var url = bizagi.util.validateFeatureSupport(\"discussionCase\") ? self.serviceLocator.getUrl('discussion-case') : self.serviceLocator.getUrl('discussion-case-v1');\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: data,\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    editDiscussion: function (data) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"new-discussion\");\r\n        return $.update({\r\n            url: url,\r\n            data: JSON.stringify(data),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getUsersDiscussion: function (params) {\r\n        var self = this;\r\n        var data = data || {};\r\n        data[\"userIds\"] = params;\r\n        data[\"width\"] = 50;\r\n        data[\"height\"] = 50;\r\n        var url = self.serviceLocator.getUrl(\"get-users\");\r\n\r\n        var newUserServices = bizagi.util.getFeatureObject(\"userService.v1.enabled\");\r\n        if (newUserServices) {\r\n            return $.ajax({\r\n                url: url, \r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        } else {    \r\n            return $.read(url, data)\r\n                .pipe(function (response) {\r\n                    return response;\r\n                });\r\n        }        \r\n    },\r\n\r\n    getEffectiveDuration: function (data) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"time-schemas-effectiveduration\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: data,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getUsersData: function (data) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-users-get\");\r\n        var newUserServices = bizagi.util.getFeatureObject(\"userService.v1.enabled\");\r\n        if (newUserServices) {\r\n            return $.ajax({\r\n                url: url, \r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        } else {    \r\n            return $.read({\r\n                url: url,\r\n                data: data,\r\n                dataType: \"json\"\r\n            });\r\n        }   \r\n\r\n        \r\n    },\r\n\r\n    createNewDiscussion: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"new-discussion\");\r\n\r\n        params = params || {};\r\n\r\n        return $.create({\r\n            url: url,\r\n            data: JSON.stringify(params),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    createNewComment: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        var data = params.data || {};\r\n        var url = self.serviceLocator.getUrl(\"new-comment\");\r\n\r\n        return $.create({\r\n            url: url.replace(\"{typeResource}\", \"Comment\"),\r\n            data: JSON.stringify(data),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Update Project File\r\n     */\r\n    updateProjectFile: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-files-upload\");\r\n\r\n        return $.update({\r\n            url: url,\r\n            data: JSON.stringify(params),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Update Project File\r\n     */\r\n    createProjectFile: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-files-upload\");\r\n\r\n        return $.create({\r\n            url: url,\r\n            data: JSON.stringify(params),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Count the files number\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getFilesCount: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        var url = bizagi.util.validateFeatureSupport(\"filesCount\") ? self.serviceLocator.getUrl(\"count-files\") : self.serviceLocator.getUrl(\"count-files-v1\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    getCommentCase: function (data) {\r\n        var self = this;\r\n        data = data || {};\r\n\r\n        var url = self.serviceLocator.getUrl(\"comment-case\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: data,\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    getCommentsByParent: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        var url = self.serviceLocator.getUrl(\"count-comments\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    getFilesList: function (params) {\r\n        var self = this;\r\n        var url = bizagi.util.validateFeatureSupport(\"filesList\") ? self.serviceLocator.getUrl(\"get-list-files\") : self.serviceLocator.getUrl(\"get-list-files-v1\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    deleteFile: function(data){\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-resource-action\");\r\n        return $.destroy({\r\n            url: url.replace(\"{typeResource}\", \"Attachment\"),\r\n            data: JSON.stringify(data),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getFilesThumbnail: function (data) {\r\n        var self = this;\r\n        data = data || {};\r\n        var url = self.serviceLocator.getUrl(\"thumbnail-file\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: data,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    getAttachment: function (guidAttachment) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl(\"get-attachment\");\r\n        url = url.replace(\"{idAttachment}\", guidAttachment.idAttachment);\r\n        return url;\r\n    },\r\n\r\n    getMobileAttachment: function (guidAttachment) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl(\"get-mobile-attachment\");\r\n        url = url.replace(\"{idAttachment}\", guidAttachment.idAttachment);\r\n        return url + \"?sessionId=\";\r\n    },\r\n\r\n    /*\r\n     *   Return all the available processes in bizagi\r\n     */\r\n    getAllAdministrableEntities: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data[\"action\"] = \"entitiesList\";\r\n        data[\"kind\"] = \"administrable\";\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"entities-administration\"),\r\n            data: data,\r\n            type: \"POST\",\r\n            dataType: \"json\"\r\n        }).pipe(function (data) {\r\n            var result = {\r\n                entities: []\r\n            };\r\n            $.each(data, function (i, item) {\r\n                result.entities.push(item);\r\n            });\r\n            return result;\r\n        });\r\n    },\r\n    /*\r\n     *   Return all the available processes in bizagi\r\n     */\r\n    getEntitiesList: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        params[\"action\"] = \"entitiesList\";\r\n        params[\"kind\"] = \"entitiesData\";\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"entities-administration\"),\r\n            data: params,\r\n            type: \"POST\",\r\n            dataType: \"json\"\r\n        });\r\n    },\r\n    /*\r\n     *   Returns all the cases for the current user filtered by a workflow\r\n     */\r\n    getCasesByWorkflow: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl('process-handler-getCustomizedColumnsDataInfo');\r\n\r\n\r\n        // Required params\r\n        if (!bizagi.util.isEmpty(params.taskState))\r\n            data['taskState'] = params.taskState;\r\n        if (!bizagi.util.isEmpty(params.idWorkflow))\r\n            data['idWorkflow'] = params.idWorkflow;\r\n\r\n        // Special case to search all favorite cases for all processes\r\n        if (params.onlyFavorites == true) {\r\n            data['onlyFavorites'] = true;\r\n            data['taskState'] = 'all';\r\n        }\r\n\r\n        // Optional params\r\n        data['pageSize'] = params.pageSize || self.pageSize;\r\n        data['page'] = params.page || 1;\r\n\r\n        if (bizagi.isMobile()) {\r\n            data['mobileDevice'] = true;\r\n        }\r\n\r\n        if (params.smartfoldersParameters) {\r\n            var param = params.smartfoldersParameters.split('&');\r\n            $.each(param, function (k, v) {\r\n                var keyvalue = v.split('=');\r\n                data[keyvalue[0]] = keyvalue[1];\r\n            });\r\n        }\r\n\r\n        if (params.radnumber || params.radNumber) {\r\n            data['radNumber'] = params.radNumber ? params.radNumber : params.radnumber;\r\n        }\r\n\r\n        if ((params.idcase || params.idCase) && bizagi.util.isNumeric(params.idcase || params.idCase)) {\r\n            data['idCase'] = params.idCase ? params.idCase : params.idcase;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                $.each(response.cases.rows, function (key, value) {\r\n                    var newFieldsValue = [];\r\n\r\n                    //  Set id of case to radnumber\r\n                    response.cases.rows[key]['radnumber'] = value.id;\r\n                    $.each(value.fields, function (fieldsKey, fieldsValue) {\r\n                        // when delete element from fields array, each function lose key value\r\n                        if (fieldsValue != undefined) {\r\n                            // Radnumber\r\n                            try {\r\n                                if (fieldsValue.isRadNumber != undefined && fieldsValue.isRadNumber == 'true') {\r\n                                    response.cases.rows[key]['radnumber'] = fieldsValue.Value;\r\n                                    response.cases.rows[key]['casenumberdisplayname'] = fieldsValue.DisplayName;\r\n                                } else if (fieldsValue.workitems != undefined) {\r\n                                    response.cases.rows[key]['workitems'] = fieldsValue.workitems;\r\n                                } else {\r\n                                    newFieldsValue.push(fieldsValue);\r\n                                }\r\n                            } catch (e) { }\r\n                        }\r\n                    });\r\n\r\n                    // Update Fields\r\n                    response.cases.rows[key]['fields'] = newFieldsValue;\r\n                });\r\n                return response.cases;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the Organization List\r\n     */\r\n    getOrganizationsList: function () {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl('process-handler-getOrganizations');\r\n        var data = {};\r\n        data['type'] = 12;\r\n        data['name'] = '';\r\n\r\n        return $.read(url, data);\r\n    },\r\n    /*\r\n     *   Returns the data for the inbox grid view\r\n     */\r\n    getCustomizedColumnsData: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"process-handler-getCustomizedColumnsData\");\r\n        data[\"pageSize\"] = params.pageSize || self.pageSize;\r\n        data[\"page\"] = params.page || 1;\r\n\r\n        // data for sort columns\r\n        data[\"orderFieldName\"] = params.orderFieldName || \"\";\r\n        data[\"orderType\"] = params.orderType || \"0\";\r\n        data[\"order\"] = params.order || \"\";\r\n\r\n        if (bizagi.isMobile()) {\r\n            data[\"mobileDevice\"] = true;\r\n        }\r\n\r\n        // Fixes stuff\r\n        // TODO: this must be fixed in the server\r\n        params.taskState = params.taskState || 'all';\r\n        if (params.taskState.toString().toLowerCase() === '')\r\n            params.taskState = 'all';\r\n        if (params.taskState.toString().toLowerCase() === 'red')\r\n            params.taskState = 'Red';\r\n        if (params.taskState.toString().toLowerCase() === 'yellow')\r\n            params.taskState = 'Yellow';\r\n        if (params.taskState.toString().toLowerCase() === 'green')\r\n            params.taskState = 'Green';\r\n\r\n        data.taskState = params.taskState;\r\n        // Required params\r\n        if (!bizagi.util.isEmpty(params.idWorkflow)) {\r\n            data['idWorkflow'] = params.idWorkflow;\r\n        }\r\n        if (!bizagi.util.isEmpty(params.idTask)) {\r\n            data['idTask'] = params.idTask;\r\n        }\r\n\r\n        if (!bizagi.util.isEmpty(params.radNumber)) {\r\n            data['radNumber'] = params.radNumber;\r\n        }\r\n\r\n        // Special case to search all favorite cases for all processes\r\n        if (params.onlyFavorites == true) {\r\n            data['onlyFavorites'] = true;\r\n            data['taskState'] = 'all';\r\n        }\r\n\r\n        if (params.smartfoldersParameters) {\r\n            var param = params.smartfoldersParameters.split('&');\r\n            $.each(param, function (k, v) {\r\n                var keyvalue = v.split('=');\r\n                data[keyvalue[0]] = keyvalue[1];\r\n            });\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *   Returns the data for the inbox grid view\r\n     */\r\n    getCustomizedColumnsDataBeta: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl('process-handler-getCustomizedColumnsData');\r\n\r\n        data['pageSize'] = params.pageSize || self.pageSize;\r\n        data['page'] = params.page || 1;\r\n\r\n        // data for sort columns\r\n        data['orderFieldName'] = params.orderFieldName || '';\r\n        data['orderType'] = params.orderType || '0';\r\n        data['order'] = params.order || '';\r\n        data['mobileDevice'] = bizagi.isMobile() ? true : false;\r\n\r\n        // Fixes stuff\r\n        // TODO: this must be fixed in the server\r\n        params.taskState = params.taskState || 'all';\r\n        if (params.taskState.toString().toLowerCase() === '')\r\n            params.taskState = 'all';\r\n        if (params.taskState.toString().toLowerCase() === 'red')\r\n            params.taskState = 'Red';\r\n        if (params.taskState.toString().toLowerCase() === 'yellow')\r\n            params.taskState = 'Yellow';\r\n        if (params.taskState.toString().toLowerCase() === 'green')\r\n            params.taskState = 'Green';\r\n\r\n        data.taskState = params.taskState;\r\n        // Required params\r\n        if (!bizagi.util.isEmpty(params.idWorkflow)) {\r\n            data['idWorkflow'] = params.idWorkflow;\r\n        }\r\n        if (!bizagi.util.isEmpty(params.idTask)) {\r\n            data['idTask'] = params.idTask;\r\n        }\r\n\r\n        if (!bizagi.util.isEmpty(params.radNumber)) {\r\n            data['radNumber'] = params.radNumber;\r\n        }\r\n\r\n        // Special case to search all favorite cases for all processes\r\n        if (params.onlyFavorites == true) {\r\n            data['onlyFavorites'] = true;\r\n            data['taskState'] = 'all';\r\n        }\r\n\r\n        if (params.smartfoldersParameters) {\r\n            var param = params.smartfoldersParameters.split('&');\r\n            $.each(param, function (k, v) {\r\n                var keyvalue = v.split('=');\r\n                data[keyvalue[0]] = keyvalue[1];\r\n            });\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        //return $.read(url, data);\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n\r\n                var groupedData = {\r\n                    columnTitle: [],\r\n                    lstIdCases: [],\r\n                    elements: [],\r\n                    page: response.page,\r\n                    totalPages: response.totalPages\r\n                };\r\n\r\n                var actualDate = new Date();\r\n                var actualMonth = actualDate.getMonth();\r\n                var actualDay = actualDate.getDate();\r\n                var actualYear = actualDate.getYear();\r\n\r\n                groupedData.columnTitle = response.cases.columnTitle;\r\n                groupedData.lstIdCases = response.cases.lstIdCases;\r\n                groupedData.page = response.cases.page;\r\n                groupedData.totalPages = response.cases.totalPages;\r\n\r\n                for (var counter = 0, length = response.cases.rows.length; counter < length; counter++) {\r\n                    var tmpElement = response.cases.rows[counter];\r\n\r\n                    var tmpdate = new Date(tmpElement.fields[3]);\r\n                    var tmpDay = tmpdate.getDate();\r\n                    var tmpMonth = tmpdate.getMonth();\r\n                    var tmpYear = tmpdate.getYear();\r\n\r\n                    if (actualDay > tmpDay || (actualMonth > tmpMonth || actualYear > tmpYear)) {\r\n                        tmpElement.fields[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement.fields[3]), 'dd MMM'); // 'dd MMM hh:mm'\r\n                        groupedData.elements.push($.extend({}, tmpElement, {'group': 'overdue'}));\r\n\r\n                    } else {\r\n                        if (actualDay == tmpDay) {\r\n                            tmpElement.fields[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement.fields[3]), 'hh:mm');\r\n                            groupedData.elements.push($.extend({}, tmpElement, {'group': 'today'}));\r\n\r\n                        } else if ((actualDay + 1) == tmpDay) {\r\n                            tmpElement.fields[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement.fields[3]), 'hh:mm');\r\n                            groupedData.elements.push($.extend({}, tmpElement, {'group': 'tomorrow'}));\r\n\r\n                        } else {\r\n                            tmpElement.fields[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement.fields[3]), 'dd MMM');\r\n                            groupedData.elements.push($.extend({}, tmpElement, {'group': 'upcoming'}));\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // No data items\r\n                if (typeof (groupedData.elements) === 'undefined' || (typeof (groupedData.elements) !== 'undefined' && groupedData.elements.length === 0)) {\r\n                    groupedData.elements.push({ noResults: true, message: bizagi.localization.getResource('workportal-menu-search-found-no-cases') });\r\n                }\r\n\r\n                return groupedData;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the available categories filtered by a parent category\r\n     *   If not parent category is sent, it will return the base categories\r\n     */\r\n    getCategories: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n\r\n        // Required params\r\n        if (params.idCategory)\r\n            data['idCategory'] = params.idCategory;\r\n        if (params.idApp)\r\n            data['idApp'] = params.idApp;\r\n\r\n        if (bizagi.isMobile()) {\r\n            data['mobileDevice'] = true;\r\n        }\r\n\r\n\r\n        data['groupByApp'] = params.groupByApp || false;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('process-handler-getCategory'), data);\r\n    },\r\n    /*\r\n     *   Returns the recent process\r\n     */\r\n    getRecentProcesses: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('process-handler-getRecentProcesses'), params);\r\n    },\r\n\r\n    /*\r\n     *   Returns the summary for a case\r\n     */\r\n    getCaseSummary: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl('case-handler-getCaseSummary'),\r\n            data: {\r\n                idCase: params.idCase,\r\n                eventAsTasks: params.eventAsTasks || \"false\",\r\n                onlyUserWorkItems: params.onlyUserWorkItems || \"true\",\r\n                mobileDevice: bizagi.isMobile() || \"false\"\r\n            },\r\n            serviceType: \"GETSUMMARY\"\r\n        }).pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n\r\n    /*\r\n     *   Returns the assigness for a case (all users assigned to any task of this case)\r\n     */\r\n    getCaseAssignees: function(params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(self.serviceLocator.getUrl('case-handler-getCaseAssignees'), {\r\n            idCase: params.idCase\r\n        }).pipe(function(response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Returns all the tasks belonging to a process, aditionally return if it has an active workitem or not\r\n     */\r\n    getCaseTasks: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getCaseTasks'), {\r\n                idCase: params.idCase\r\n            }\r\n        );\r\n    },\r\n    /*\r\n     *   Returns all the events available for a case\r\n     */\r\n    getCaseEvents: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl('case-handler-getCaseEvents'),\r\n            data: {\r\n                idCase: params.idCase\r\n            },\r\n            serviceType: 'GETEVENTS'\r\n        })\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns all the available subprocesses for a case\r\n     */\r\n    getCaseSubprocesses: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl('case-handler-getCaseSubprocesses'),\r\n            data: {\r\n                idCase: params.idCase\r\n            },\r\n            serviceType: 'GETSUBPROCESSES'\r\n        })\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns forms render version for a case\r\n     */\r\n    getCaseFormsRenderVersion: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getCaseFormsRenderVersion'), {\r\n                idCase: params.idCase\r\n            }\r\n        );\r\n    },\r\n    /**\r\n     *  Get json from forms render version service\r\n     */\r\n    getCaseFormsRenderVersionDataContent: function (options) {\r\n        var self = this;\r\n        var defer = new $.Deferred();\r\n\r\n        $.when(self.getCaseFormsRenderVersion(options))\r\n            .done(function (data) {\r\n                // return json content\r\n                defer.resolve(data);\r\n            });\r\n        return defer.promise();\r\n    },\r\n    /*\r\n     *   Returns all the assignees belonging to a workitem (case - task combination)\r\n     */\r\n    getTaskAssignees: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase, idTask\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getTaskAssignees'), {\r\n                idCase: params.idCase,\r\n                idTask: params.idTask\r\n            }\r\n        );\r\n    },\r\n    /*\r\n     *   Returns the available workitems for a case (Routing service)\r\n     */\r\n    getWorkitems: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        params = params || {};\r\n\r\n        data.idCase = params.idCase;\r\n        data.fromTask = params.fromTask;\r\n        data.fromWorkItemId = params.fromWorkItemId;\r\n        data.mobileDevice = bizagi.isMobile();\r\n\r\n        params.eventAsTasks ? (data.eventAsTasks = params.eventAsTasks) : \"\";\r\n\r\n        if (typeof params.onlyUserWorkItems !== \"undefined\") {\r\n            data.onlyUserWorkItems = params.onlyUserWorkItems;\r\n        }\r\n\r\n        // Required params: idCase\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl('case-handler-getWorkItems'),\r\n            data: data,\r\n            serviceType: 'GETWORKITEMS'\r\n        });\r\n    },\r\n    /*\r\n     *   Returns the available workitems for a case (Routing service)\r\n     */\r\n    getQueries: function (params) {\r\n        var self = this;\r\n\r\n        if (self.hashQueries && params.idElement) {\r\n            return self.hashQueries[params.idElement];\r\n        } else {\r\n            var defer = new $.Deferred();\r\n\r\n            // Call ajax and returns promise\r\n            $.read(self.serviceLocator.getUrl('query-handler-getqueries'))\r\n                .done(function (response) {\r\n                    self.hashQueries = {};\r\n                    self.hashQueries[0] = {};\r\n\r\n                    // Process the full response converting it into small entries inside a hashtable\r\n                    self.processQueries(response.query);\r\n                    defer.resolve(self.hashQueries['-1']);\r\n                });\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     *   Creates a hash of queries to simulate each category request\r\n     */\r\n    processQueries: function (queries) {\r\n        var self = this;\r\n        $.each(queries, function (i, query) {\r\n            if (!self.hashQueries[query.idParent]) {\r\n                self.hashQueries[query.idParent] = [];\r\n            }\r\n            self.hashQueries[query.idParent].push(query);\r\n            if (query.nodes) {\r\n                self.processQueries(query.nodes);\r\n            } else {\r\n                query.nodes = {};\r\n            }\r\n        });\r\n    },\r\n    /*\r\n     *   Creates a new case in BizAgi\r\n     */\r\n    createNewCase: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.create({\r\n            url: self.serviceLocator.getUrl('case-handler-addNewCase'),\r\n            data: {\r\n                idWfClass: params.idWfClass,\r\n                caseData: params.caseData ? JSON.stringify(params.caseData) : null,\r\n                idOrganization: params.idOrganization ? params.idOrganization : null\r\n            },\r\n            serviceType: 'NEWCASE'\r\n        });\r\n    },\r\n\r\n    /*\r\n     * La idea con este servicio es por ahora quitar el hatStartForm del servicio de Shortcuts y de acciones\r\n     * retorna si tiene forma de inicio y el guid de la entidad de proceso\r\n     */\r\n    validateHasStartForm: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            processId: params.processId\r\n        };\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"case-handler-validateHasStartForm\"),\r\n            data: data,\r\n            batchRequest: true\r\n        });\r\n    },\r\n\r\n\r\n    /*\r\n     *   Start process in Bizagi\r\n     */\r\n    startProcess: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        var data = {\r\n            idProcess: params.idProcess,\r\n            entityMapping: params.mapping ? JSON.stringify(params.mapping) : {}\r\n        };\r\n\r\n        if (typeof params.idParentCase !== \"undefined\") {\r\n            data.idParentCase = params.idParentCase;\r\n        }\r\n\r\n        var defer = $.Deferred();\r\n\r\n        $.create({\r\n            url: self.serviceLocator.getUrl(\"case-handler-startProcess\"),\r\n            data: data,\r\n            serviceType: \"STARTPROCESS\"\r\n        }).fail(function (error) {\r\n            var response = $.parseJSON(error.responseText);\r\n            if (response.status === \"error\" && !bizagi.util.isVersionSupported()) {\r\n                var oldParams = {\r\n                    idWfClass: params.idProcess || params.idWfClass,\r\n                    idOrganization: params.idOrganization || null\r\n                };\r\n\r\n                self.createNewCase(oldParams)\r\n                    .then(function (result) {\r\n                        result.oldVersion = true;\r\n\r\n                        defer.resolve(result);\r\n                    }).fail(function (error) {\r\n                    defer.reject(error);\r\n                });\r\n            } else {\r\n                defer.reject(error);\r\n            }\r\n        }).done(function (data) {\r\n            defer.resolve(data);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    /*\r\n     *   Start process in BizAgi\r\n     */\r\n    actionCreateCase: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            processId: (typeof params.idProcess !== \"undefined\") ? params.idProcess : params.guidProcess\r\n        }\r\n        // When the proccess is a shortcut it does not have mapping and parentCaseId,\r\n        // but when the process is not a shortcut, it has a context, so it comes with mapping and parentCaseId\r\n        if (typeof params.parentCaseId !== \"undefined\") {\r\n            data.parentCaseId = params.parentCaseId;\r\n        }\r\n        if (typeof params.mapping !== \"undefined\") {\r\n            data.entityMapping = params.mapping ? JSON.stringify(params.mapping) : {};\r\n        }\r\n\r\n        return $.create({\r\n            url: self.serviceLocator.getUrl(\"handler-execute-action-start\"),\r\n            data: data,\r\n            serviceType: \"STARTPROCESS\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get the first parent plan on not contextualizeds plans\r\n     * */\r\n    getFirstParentPlan: function (data) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"project-plan-first-parent-plan\");\r\n        var defer = $.Deferred();\r\n        $.when($.read({\r\n            url: url,\r\n            data: data,\r\n            dataType: \"json\"\r\n        })).done(function (response) {\r\n            defer.resolve(response);\r\n        }).fail(function () {\r\n            defer.resolve(null);\r\n        });\r\n        return defer.promise();\r\n    },\r\n    /*\r\n     *   Search cases with radNumber\r\n     */\r\n    searchCases: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n\r\n        data['h_action'] = 'SEARCHCASES';\r\n        data['onlyUserCases'] = false;\r\n        data['active'] = false;\r\n        data['page'] = params.page || 1;\r\n        if (params.radNumber)\r\n            data['radNumber'] = $.trim(params.radNumber);\r\n        data['pageSize'] = params.pageSize || self.pageSize;\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('query-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Search cases with radNumber\r\n     */\r\n    queryCases: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n\r\n        data.h_action = 'QUERYCASES';\r\n        data.onlyUserCases = params.onlyUserCases || false;\r\n        data.active = params.active && true;\r\n        data.page = params.page || 1;\r\n        if (params.radNumber)\r\n            data.radNumber = $.trim(params.radNumber);\r\n        data.pageSize = params.pageSize || self.pageSize;\r\n\r\n        data.filter = params.filter;\r\n        data.outputxpath = params.outputxpath;\r\n\r\n        // data for sort columns\r\n        data.orderFieldName = params.orderFieldName || '';\r\n        data.orderType = (params.orderType == 'asc' || params.orderType == 1) ? 1 : 0;\r\n        data.order = params.order || '';\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('query-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Search entities service\r\n     */\r\n    queryEntities: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n\r\n        data.h_action = 'QUERYENTITIES';\r\n        data.page = params.page || 1;\r\n        data.pageSize = self.Class.ENTITIES_QUERY_PAGE_SIZE;\r\n\r\n        // Query parameters\r\n        data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + 'idEnt'] = params.idEntity;\r\n        data.filter = params.filter;\r\n        data.outputxpath = params.outputxpath;\r\n\r\n        // Data to sort columns\r\n        data.orderFieldName = params.orderFieldName || '';\r\n        data.orderType = params.orderType || '';\r\n        data.order = params.order || '';\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('query-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *  Get Menu Authorization\r\n     */\r\n    getMenuAuthorization: function () {\r\n        var self = this;\r\n\r\n        return $.read(\r\n            self.serviceLocator.getUrl('authorization-handler-getMenuAuthorization')\r\n        );\r\n    },\r\n    /*\r\n     *  The user have permissions to excecute this Case\r\n     */\r\n    isCaseCreationAuthorized: function (params) {\r\n        var self = this;\r\n        var urlSend = self.serviceLocator.getUrl('authorization-handler-isCaseCreationAuthorized');\r\n        urlSend = urlSend.replace('{0}', params.idWfClass || '');\r\n\r\n        return $.read({\r\n            url: urlSend //,\r\n            //data: { 'idWfClass': params.idWfClass }\r\n            //data: { 'userName': BIZAGI_USER, 'password': BIZAGI_PASSWORD, 'domain': BIZAGI_DOMAIN }\r\n        });\r\n    },\r\n    /*\r\n     *   Returns the execution state of an async workitem\r\n     */\r\n    getAsynchExecutionState: function(params) {\r\n        var self = this;\r\n        var idAsynchWorkitem;\r\n        params = params || {};\r\n\r\n        if (params.idCase != -1) {\r\n            return $.read({\r\n                url: self.serviceLocator.getUrl(\"case-handler-getAsynchExecutionState\"),\r\n                data: {\r\n                    idCase: params.idCase,\r\n                    idAsynchWorkitem: params.idAsynchWorkitem\r\n                },\r\n                serviceType: \"ASYNCHEXECUTION\"\r\n            });\r\n        } else {\r\n            return $.read({\r\n                url: self.serviceLocator.getUrl(\"case-handler-getAsynchExecutionState\"),\r\n                data: {\r\n                    idCase: params.idCase,\r\n                    idAsynchWorkitem: params.idAsynchWorkitem\r\n                },\r\n                serviceType: \"ASYNCHEXECUTION\"\r\n            });\r\n        }\r\n    },\r\n\r\n    /*\r\n     *  Returns the supported log types\r\n     */\r\n    supportedLogTypes: function () {\r\n        var self = this;\r\n\r\n        return $.read(self.serviceLocator.getUrl('case-handler-supportedLogTypes'));\r\n    },\r\n    /*\r\n     *   Returns the Activity Log for a case\r\n     */\r\n    getActivityLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getActivityLog'), {\r\n                idCase: params.idCase,\r\n                orden: params.sort || 0,\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the Activity Detail Log for a case\r\n     */\r\n    getActivityDetailLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idWorkItemFrom\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getActivityDetailLog'), {\r\n                idCase: params.idCase,\r\n                idWorkItemFrom: params.idWorkItemFrom,\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the Entity Log for a case\r\n     */\r\n    getEntityLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getEntityLog'), {\r\n                idCase: params.idCase,\r\n                orden: params.sort || 0,\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the Entity Detail Log for a case\r\n     */\r\n    getEntityDetailLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getEntityDetailLog'), {\r\n                idCase: params.idCase,\r\n                idEntity: params.idEntity || -1,\r\n                userFullName: params.userFullName || '',\r\n                attribDisplayName: params.attribDisplayName || '',\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the User Log for a case\r\n     */\r\n    getUserLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getUserLog'), {\r\n                idCase: params.idCase,\r\n                orden: params.sort || 0,\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the User Detail Log for a case\r\n     */\r\n    getUserDetailLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase , idUser\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getUserDetailLog'), {\r\n                idCase: params.idCase,\r\n                idUser: params.idUser,\r\n                entDisplayName: params.entDisplayName || '',\r\n                attribDisplayName: params.attribDisplayName || '',\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Returns the Admin Log for a case\r\n     */\r\n    getAdminLog: function (params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        // Required params: idCase\r\n        return $.read(\r\n            self.serviceLocator.getUrl('case-handler-getAdminLog'), {\r\n                idCase: params.idCase,\r\n                orden: params.sort || 0,\r\n                idActualPage: params.idActualPage || 1,\r\n                pageSize: params.pageSize || 10\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Adds a New Favorite\r\n     */\r\n    addFavorite: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n\r\n        return $.create(\r\n            self.serviceLocator.getUrl('favorites-handler-saveFavorite'), {\r\n                idObject: params.idObject,\r\n                favoriteType: params.favoriteType\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    /*\r\n     *   Favorites service\r\n     */\r\n    delFavorite: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n\r\n        // Required params: guidFavorite\r\n        return $.destroy(\r\n            self.serviceLocator.getUrl('favorites-handler-deleteFavorite'), {\r\n                guidFavorite: params.idObject\r\n            }\r\n        )\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n    // Data Transformations for Summary Widget\r\n    /*\r\n     * Render Assigness\r\n     */\r\n    summaryAssigness: function (options) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var idCase = options.idCase || \"\";\r\n\r\n        $.when(\r\n            self.getCaseAssignees({\r\n                idCase: idCase\r\n            })\r\n        ).done(function (baseAssignees) {\r\n\r\n            var assignees = baseAssignees.assignees || [];\r\n            var assigneesLength = assignees.length;\r\n            var assigneesFix = {\r\n                showAssignees: (bizagi.override.showAssignees && assignees.length > 0) ? true : false,\r\n                assignees: {},\r\n                events: \"\",\r\n                activities: \"\"\r\n            };\r\n\r\n            var assigneesEvents = \"\";\r\n            var assigneesActivities = \"\";\r\n            var assigneesEventsList = [];\r\n            var assigneesActivitiesList = [];\r\n\r\n            for (var i = 0; i < assigneesLength; i++) {\r\n                if (bizagi.util.parseBoolean(assignees[i].isEvent)) {\r\n                    if (assigneesEventsList.indexOf(assignees[i].idUser) == -1) {\r\n                        assigneesEventsList.push(assignees[i].idUser);\r\n                        assigneesEvents += assignees[i].Name + \", \";\r\n                    }\r\n                } else {\r\n                    if (assigneesActivitiesList.indexOf(assignees[i].idUser) == -1) {\r\n                        assigneesActivitiesList.push(assignees[i].idUser);\r\n                        assigneesActivities += assignees[i].Name + \", \";\r\n                    }\r\n                }\r\n            }\r\n            //join assignees to event and activities\r\n            assigneesFix.events = assigneesEvents.substring(0, assigneesEvents.length - 2);\r\n            assigneesFix.activities = assigneesActivities.substring(0, assigneesActivities.length - 2);\r\n\r\n\r\n            def.resolve(assigneesFix);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n    /*\r\n     * Render Assigness\r\n     */\r\n    summarySubProcess: function (options) {\r\n        var self = this;\r\n        var def = $.Deferred();\r\n        var idCase = options.idCase || '';\r\n\r\n        $.when(\r\n            self.getCaseSubprocesses({\r\n                idCase: idCase\r\n            })\r\n        ).done(function (subprocess) {\r\n            subprocess['showSubProcess'] = (subprocess['subProcesses'].length >= 1) ? true : false;\r\n            subprocess['showSubProcesColumns'] = (subprocess['CustFields'][0] !== undefined && subprocess['CustFields'][0][0].length >= 1) ? true : false;\r\n\r\n            // Prepare json for subprocess\r\n            if (subprocess['showSubProcesColumns']) {\r\n                subprocess['subProcPersonalized'] = {};\r\n                var len;\r\n                for (var n = 0; n < subprocess['CustFields'].length; n++) {\r\n                    len = 0;\r\n                    for (var i = 0; i < subprocess['subProcesses'].length; i++) {\r\n                        if (subprocess['subProcesses'][i]['idCustData'] == n) {\r\n                            subprocess['subProcPersonalized'][n] = subprocess['subProcPersonalized'][n] || {};\r\n                            subprocess['subProcPersonalized'][n]['subProcesses'] = subprocess['subProcPersonalized'][n]['subProcesses'] || {};\r\n                            subprocess['subProcPersonalized'][n]['subProcesses'][len++] = subprocess['subProcesses'][i];\r\n                        }\r\n                    }\r\n\r\n                    if (subprocess[\"subProcesses\"][n][\"idCustData\"] != -1 && subprocess[\"subProcPersonalized\"][n] != undefined) {\r\n                        subprocess[\"subProcPersonalized\"][n][\"CustFields\"] = subprocess[\"CustFields\"][n];\r\n                        subprocess[\"subProcPersonalized\"][n][\"idCase\"] = subprocess[\"idCase\"];\r\n                    }\r\n                }\r\n            }\r\n\r\n            def.resolve(subprocess);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n    /*\r\n     * Render Case Events\r\n     */\r\n    summaryCaseEvents: function (options) {\r\n        var self = this;\r\n        var def = $.Deferred();\r\n        var idCase = options.idCase || '';\r\n\r\n        $.when(\r\n            self.getCaseEvents({\r\n                idCase: idCase\r\n            })\r\n        ).done(function (events) {\r\n            events['showEvents'] = (events['events'].length >= 1) ? true : false;\r\n            def.resolve(events);\r\n        }).fail(function(error){\r\n            def.reject();\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n    /*\r\n     * Render Details\r\n     * @param idWorkitem\r\n     */\r\n    summaryCaseDetails: function (options) {\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var idWorkitem = options.idWorkitem || 0;\r\n\r\n        $.when(\r\n            self.getCaseSummaryDataContent(options)\r\n        ).done(function (data) {\r\n            data.currentState = data.currentState || [];\r\n            var dataCurrentStateLength = data.currentState.length;\r\n            // Show or hide tabs\r\n            data.showEvents = (data.countEvents >= 1) ? true : false;\r\n            data.showParentProcess = (data.idParentCase >= 1) ? true : false;\r\n            data.parentProcess = {\r\n                \"displayName\": data.parentDisplayName,\r\n                \"idCase\": data.idParentCase\r\n            };\r\n\r\n            //data.isOpen: if request have onlyUserWorkItems = true, so verify workitems of current user\r\n            //data.isClosed: if request have onlyUserWorkItems = false, not verify workitems of current user\r\n            data.isClosedForAllUsers = bizagi.util.parseBoolean(data.isClosed);\r\n            data.isClosed = (bizagi.util.parseBoolean(data.isOpen)) ? false : true;\r\n            data.showAssignees = (bizagi.override.showAssignees && data.countAssigness > 0) ? true : false;\r\n            data.showSubProcess = (data.countSubProcesses > 0) ? true : false;\r\n            data.showForm = (bizagi.util.parseBoolean(data.hasGlobalForm)) ? true : false;\r\n            data.allowsReassign = \"false\";\r\n\r\n            for (i = 0; i < dataCurrentStateLength; i++) {\r\n                if (data.currentState[i].idWorkItem == idWorkitem) {\r\n                    data.allowsReassign = data.currentState[i].allowsReassign;\r\n                }\r\n            }\r\n\r\n            // edit original data, no show events in activities tab\r\n            var currentStateTypes = [];\r\n            var m = 0; // counter for new activities array\r\n            for (i = 0; i < dataCurrentStateLength; i++) {\r\n                if (!bizagi.util.parseBoolean(data.currentState[i].isEvent) && bizagi.util.parseBoolean(data\r\n                        .currentState[i].assignToCurrentUser) && data.currentState[i].idWorkItem != idWorkitem) {\r\n                    currentStateTypes[m++] = data.currentState[i];\r\n                }\r\n            }\r\n\r\n            data.currentStateTypes = currentStateTypes;\r\n            data.showActivities = (currentStateTypes.length > 0) ? true : false;\r\n\r\n            def.resolve(data);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    releaseActivity: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"case-handler-releaseActivity\");\r\n        url = url.replace(\"{idCase}\", params.idCase);\r\n        var data = {};\r\n        // Define data\r\n        if (params) {\r\n            data[\"idCase\"] = params.idCase;\r\n            data[\"idWorkItem\"] = params.idWorkItem;\r\n        }\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: url,\r\n            data: data,\r\n            type: \"POST\",\r\n            dataType: \"json\"\r\n        });\r\n\r\n    },\r\n    /**\r\n     *\r\n     * Segment Activities for summary in render module\r\n     * @param options {data,idWorkItem}\r\n     */\r\n    summaryActivities: function (options) {\r\n        var activities = {};\r\n        var data = options['data'] || {};\r\n        var idWorkItem = idWorkItem || options['idWorkitem'] || 0;\r\n\r\n        try {\r\n            activities['showActivities'] = (data['currentStateTypes'].length >= 1) ? true : false;\r\n            activities['currentState'] = data['currentStateTypes'];\r\n            activities['globalIdWorkitem'] = idWorkItem;\r\n            activities['creationDate'] = data['creationDate'];\r\n        } catch (e) { }\r\n\r\n        return activities;\r\n    },\r\n    /**\r\n     *  Get json from cases service\r\n     */\r\n    getCaseSummaryDataContent: function (options) {\r\n        var self = this;\r\n        var promise = new $.Deferred();\r\n\r\n        $.when(self.getCaseSummary(options))\r\n            .done(function (data) {\r\n                // Completes data\r\n                data.taskState = self.icoTaskState;\r\n                data.process = data.process ? data.process : \"\";\r\n\r\n                if (data.createdBy) {\r\n                    data.createdByName = data.createdBy.Name;\r\n                    data.createdByUserName = data.createdBy.userName;\r\n                    data.caseDescription = (data.caseDescription == \"\" ? \"\" : data.caseDescription);\r\n                    data.processPath = data.processPath.replace(/\\//g, \" > \") + data.process;\r\n                    data.showWorkOnIt = true;\r\n                }\r\n\r\n                // return json content\r\n                promise.resolve(data);\r\n            });\r\n\r\n        return promise.promise();\r\n    },\r\n    /**\r\n     * Definition service for bizagi smart folders\r\n     *\r\n     * @param id optional with filter purpose\r\n     */\r\n    getSmartFolders: function (id) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.idFolder = id || '';\r\n        // Call read and returns promise\r\n        return $.read(self.serviceLocator.getUrl('folders-handler-getUserQueries'), data).pipe(function (response) {\r\n            if (id == -1 || id == '') {\r\n                return response;\r\n            } else {\r\n                return self.searchFolders(id, response) || [];\r\n            }\r\n        });\r\n    },\r\n    /**\r\n     * Delete smart folder\r\n     * @param options {idSmartFolder,idUser}\r\n     */\r\n    deleteSmartFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = '6';\r\n        options = options || {};\r\n\r\n        data.idSmartFolder = options.idSmartFolder || '';\r\n        data.idUser = options.idUser || '';\r\n\r\n        return $.destroy(self.serviceLocator.getUrl('folders-associate-deleteSmartFolder'), data);\r\n    },\r\n    /**\r\n     * Definition service for bizagi folders\r\n     *\r\n     * @param id optional with filter purpose\r\n     */\r\n    getFolders: function (id) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = 'getUserFolder';\r\n        data.idFolder = id || '';\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-handler'),\r\n            type: 'POST',\r\n            data: data,\r\n            dataType: 'json'\r\n        }).pipe(function (response) {\r\n            if (id == '') {\r\n                var folders = {\r\n                    folders: [{\r\n                        name: bizagi.localization.getResource('workportal-widget-folders'),\r\n                        id: '-1',\r\n                        idParent: 0,\r\n                        childs: response\r\n                    }]\r\n                };\r\n                return folders;\r\n            } else if (id == -1) {\r\n                return response;\r\n            } else {\r\n                return self.searchFolders(id, response) || [];\r\n            }\r\n        });\r\n    },\r\n    searchFolders: function (idFolder, data) {\r\n        for (var i = 0; i < data.folders.length; i++) {\r\n            var value = data.folders[i];\r\n            if (value.id == idFolder) {\r\n                return data.folders[i]['childs'];\r\n                break;\r\n            }\r\n        }\r\n        return undefined;\r\n    },\r\n    getCasesByFolder: function (query) {\r\n        query = query || '';\r\n\r\n        return $.ajax({\r\n            cache: true,\r\n            url: 'RestServices/' + query,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    makeFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = 'CreateUpdateFolder';\r\n        data.folderName = options.folderName || 'No Name';\r\n\r\n        // Make folder under subcategory\r\n        if (options.idParentFolder != undefined && options.idParentFolder > 1) {\r\n            data.idParentFolder = options.idParentFolder;\r\n        }\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    updateFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n        options = options || {};\r\n\r\n        data.action = 'CreateUpdateFolder';\r\n        // Define idFolder\r\n        data.idFolder = options.idFolder || '';\r\n\r\n        // Update name\r\n        if (options.folderName) {\r\n            data.folderName = options.folderName;\r\n        }\r\n\r\n        // Update path\r\n        if (options.idParentFolder) {\r\n            data.idParentFolder = options.idParentFolder;\r\n        }\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /**\r\n     * Associate cases to folders\r\n     *\r\n     * @param options {idcase,idCustomFolder}\r\n     */\r\n    associateCaseToFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = '4';\r\n        options = options || {};\r\n\r\n        data.idCase = options.idCase || '';\r\n        data.idCustomFolder = options.idCustomFolder;\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-associate'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     * Dissasociate cases to folder\r\n     *\r\n     * @param options {idFolder, idCase}\r\n     */\r\n    dissasociateCaseFromFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = 'DeleteCaseFromFolder';\r\n        options = options || {};\r\n\r\n        data.idFolder = options.idFolder;\r\n        data.idCase = options.idCase;\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-handler'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /**\r\n     * Delete folder\r\n     * @param options {idCustomFolder}\r\n     */\r\n    deleteFolder: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = '5';\r\n        options = options || {};\r\n\r\n        data.idCustomFolder = options.idCustomFolder || '';\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('folders-associate'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /**\r\n     * Gets a file binary from the server\r\n     * @param options {fileId}\r\n     */\r\n    getFile: function (options) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = this.serviceLocator.getUrl('file-handler');\r\n        options = options || {};\r\n\r\n        data.action = 'getFileContent';\r\n        data.uploadId = options.uploadId || '';\r\n        data.entityId = options.entityId || '';\r\n        data.entityKey = options.entityKey || '';\r\n\r\n        return bizagi.services.ajax.pathToBase + url + '?' + jQuery.param(data);\r\n    },\r\n    /**\r\n     * Get Comments per case\r\n     * @param params {idCase=int&idColorCategory=int&pag=int&pagSize=int}\r\n     * @return json\r\n     */\r\n    getComments: function (params) {\r\n        //params.idCase = params.idCase || 0;\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        return $.read(encodeURI(self.serviceLocator.getUrl('MessageHandler-GetComments')), {\r\n            idCase: params.idCase || '',\r\n            idColorCategory: (typeof params.idColorCategory == 'number') ? params.idColorCategory : '',\r\n            pag: params.pag || 1,\r\n            pagSize: params.pagSize || 10\r\n        })\r\n            .pipe(function (result) {\r\n                var def = new $.Deferred();\r\n                var picture = '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';\r\n                if (!result.comments) {\r\n                    result.comments = [];\r\n                } else {\r\n                    // Add CategoryColor for each comment\r\n                    $.each(result.comments, function (key, value) {\r\n                        if (!result.comments[key].hasOwnProperty('CategoryColor')) {\r\n                            result.comments[key]['CategoryColor'] = '';\r\n                        }\r\n                    });\r\n                }\r\n                if (!result.users) {\r\n                    $.when(self.getCurrentUser())\r\n                        .done(function (user) {\r\n                            result.users = [];\r\n                            result.users.push({\r\n                                Id: user.idUser,\r\n                                Name: user.user,\r\n                                DisplayName: user.userName,\r\n                                Picture: picture\r\n                            });\r\n                        });\r\n                } else {\r\n                    $.each(result.users, function (key, value) {\r\n                        // Add picture to all users\r\n                        result.users[key]['Picture'] = (result.users[key]['Picture'] === '') ? picture : result.users[key]['Picture'];\r\n                    });\r\n                }\r\n                def.resolve(result);\r\n                return def.promise();\r\n            });\r\n    },\r\n    /**\r\n     * This function allow create new comment into the activity\r\n     *\r\n     * @param options {idCase,comment}\r\n     * @return json\r\n     */\r\n    makeNewComment: function (options) {\r\n        var self = this;\r\n        var picture = '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';\r\n        return $.create(self.serviceLocator.getUrl('MessageHandler-NewComment'), {\r\n            idCase: options.idCase || '',\r\n            comment: options.comment.replace(/\\n/g, '<br>') || ''\r\n        })\r\n            .pipe(function (result) {\r\n                if (result.comments) {\r\n                    var comments = [result.comments];\r\n                    $.each(comments, function (key, value) {\r\n                        // Add CategoryColor for each comment\r\n                        comments[key]['CategoryColor'] = '';\r\n                    });\r\n                    result.comments = comments;\r\n                }\r\n\r\n                if (result.users) {\r\n                    var users = [result.users];\r\n                    $.each(users, function (key, value) {\r\n                        // Add picture to all users\r\n                        users[key]['Picture'] = (users[key]['Picture'] == '') ? picture : users[key]['Picture'];\r\n                    });\r\n                    result.users = users;\r\n                }\r\n\r\n                return result;\r\n            });\r\n    },\r\n    /**\r\n     * This function allow create new replies into the comment\r\n     *\r\n     * @param options {idCase=int&idComment=int&comment=string}\r\n     * @return json\r\n     */\r\n    makeNewReply: function (options) {\r\n        var self = this;\r\n        var picture = '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';\r\n\r\n        options = options || {};\r\n\r\n        return $.create(self.serviceLocator.getUrl('MessageHandler-ReplyComment'), {\r\n            idCase: options.idCase || '',\r\n            idComment: options.idComment || '',\r\n            comment: options.comment.replace(/\\n/g, '<br>') || ''\r\n        })\r\n            .pipe(function (result) {\r\n                if (result.comments) {\r\n                    result.Replies = [result.comments];\r\n                }\r\n\r\n                if (result.users) {\r\n                    var users = [result.users];\r\n                    $.each(users, function (key, value) {\r\n                        // Add picture to all users\r\n                        users[key]['Picture'] = (users[key]['Picture'] == '') ? picture : users[key]['Picture'];\r\n                    });\r\n                    result.users = users;\r\n                }\r\n\r\n                return result;\r\n            });\r\n    },\r\n    /**\r\n     * Remove one comment from the list in mobiles\r\n     *\r\n     * @param options {content:{guid:\"...\"},attachmentsToDelete:[\"...\", \"...\", ...]};\r\n     * @return json {action:true|false, message:'if error, explain why'}\r\n     */\r\n    removeMobileComment: function (options) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('remove-comment');\r\n\r\n        options = options || {};\r\n\r\n        return $.destroy({\r\n            url: url,\r\n            data: JSON.stringify(options),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Remove one comment from the list\r\n     *\r\n     * @param options {idCase=int&idComment=int}\r\n     * @return json {action:true|false, message:'if error, explain why'}\r\n     */\r\n    removeComment: function (options) {\r\n        var self = this;\r\n\r\n        options = options || {};\r\n\r\n        return $.destroy(self.serviceLocator.getUrl('MessageHandler-RemoveComment'), {\r\n            idCase: options.idCase || '',\r\n            idComment: options.idComment || ''\r\n        });\r\n    },\r\n    /**\r\n     * Remove one replies from the list\r\n     *\r\n     * @param options {idCase=int&idComment=int&idReply=int}\r\n     * @return json {action:true|false, message:'if error, explain why'}\r\n     */\r\n    removeReply: function (options) {\r\n        var self = this;\r\n\r\n        options = options || {};\r\n\r\n        return $.destroy(self.serviceLocator.getUrl('MessageHandler-RemoveReply'), {\r\n            idCase: options.idCase || '',\r\n            idComment: options.idComment || '',\r\n            idReply: options.idReply || ''\r\n        });\r\n\r\n    },\r\n    /**\r\n     * Rename category\r\n     *\r\n     * @param options {idColorCategory=int&colorName=string}\r\n     * @return json\r\n     */\r\n    renameCommentCategory: function (options) {\r\n        var self = this;\r\n\r\n        options = options || {};\r\n\r\n        return $.update(self.serviceLocator.getUrl('MessageHandler-RenameCategoryColor'), {\r\n            idColorCategory: (options.idColorCategory >= 0) ? options.idColorCategory : '',\r\n            colorName: options.colorName || ''\r\n        });\r\n    },\r\n    /**\r\n     * @param options {idCase=int&idComment=int&idColorCategory={0-5}}\r\n     * return json\r\n     */\r\n    setCommentCategory: function (options) {\r\n        var self = this;\r\n\r\n        options = options || {};\r\n\r\n        return $.update(self.serviceLocator.getUrl('MessageHandler-SetCategoryToComment'), {\r\n            idCase: options.idCase || '',\r\n            idComment: options.idComment || '',\r\n            idColorCategory: (typeof options.idColorCategory == 'number') ? options.idColorCategory : ''\r\n        });\r\n    },\r\n    /**\r\n     * @return json Definition of all categories of message\r\n     */\r\n    getCommentsCategories: function () {\r\n        var self = this;\r\n\r\n        return $.read(self.serviceLocator.getUrl('MessageHandler-GetCategoryColors'))\r\n            .pipe(function (result) {\r\n                if (result.length > 1 && result[0]['categories']) {\r\n                    return result[0];\r\n                } else {\r\n                    return result;\r\n                }\r\n            });\r\n    },\r\n    /**\r\n     * This service can be define number of new comments based on idComment\r\n     * @param json  options {idCase=int, idLastComment=int}\r\n     * @return int\r\n     */\r\n    getNewComments: function (options) {\r\n        var self = this;\r\n\r\n        options = options || {};\r\n\r\n        return $.read(encodeURI(self.serviceLocator.getUrl('MessageHandler-CountNewComments')), {\r\n            idCase: options.idCase || 0,\r\n            idComment: options.idComment || 0\r\n        });\r\n    },\r\n    /**\r\n     * Get all analisys queries\r\n     * @return json\r\n     */\r\n    getAnalisysQueries: function () {\r\n        var self = this;\r\n\r\n        return $.read(self.serviceLocator.getUrl('bamAnalytics-handler-getAnalisysQueries'));\r\n    },\r\n    /**\r\n     * Update name and comment\r\n     *\r\n     * @param options json {queryName,queryDescription,idQuery }\r\n     * @return json  {response:true}\r\n     */\r\n    updateQueries: function (options) {\r\n        var self = this;\r\n\r\n        return $.update(self.serviceLocator.getUrl('bamAnalytics-handler-updateQuery'), {\r\n            idQuery: (options.idQuery >= 0) ? options.idQuery : '',\r\n            queryName: options.queryName || '',\r\n            queryDescription: options.queryDescription || ''\r\n        });\r\n    },\r\n    /**\r\n     * Delete query\r\n     *\r\n     * @param queryId integer\r\n     * @return json  {response:true}\r\n     */\r\n    deleteQueries: function (queryId) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        data.action = '1612';\r\n        data.QueryId = queryId || '';\r\n\r\n        return $.destroy(self.serviceLocator.getUrl('reports-handler-deleteQueries'), data);\r\n    },\r\n    /**\r\n     * Get bizagi configuration\r\n     * @param {Function}   type    callback function when the file load is succed\r\n     * @return {deferred} ajax object with JSON content\r\n     */\r\n    getConfiguration: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"authenticationConfig\");\r\n\r\n        return $.read(url);\r\n    },\r\n    /**\r\n     * Logout Service\r\n     */\r\n    logout: function () {\r\n        var self = this;\r\n        // Remove session storage of authentication data\r\n        sessionStorage.removeItem('bizagiAuthentication');\r\n\r\n        //Call to the restfull service for domain list\r\n        try {\r\n            var javaLogout = $.create(self.serviceLocator.getUrl('logout'));\r\n\r\n            $.when(javaLogout).done(function () {\r\n                location.reload();\r\n            }).fail(function () {\r\n                bizagi.log('Error logging out');\r\n            });\r\n        } catch (e) { }\r\n    },\r\n\r\n    /**\r\n     * Logout from different types of services\r\n     * This method can reload the page after calling the logout service required\r\n     */\r\n    logoutMobile: function() {\r\n        var self = this;\r\n        var logoutData = { sourceLogout: \"user\" };\r\n\r\n        // Remove session storage of authentication data\r\n        sessionStorage.removeItem(\"bizagiAuthentication\");\r\n\r\n        // Hybrid will use normal system\r\n        if (bizagi.util.isCordovaSupported()) {\r\n            var url = self.serviceLocator.getUrl(\"logout\");\r\n            return $.create(url);\r\n        } else {\r\n            // Call to the restfull service for domain list\r\n            try {\r\n\r\n                $.when(self.getConfiguration()).done(function (data) {\r\n                    if (data.redirectErrorPage) {\r\n                        window.location.href = data.redirectErrorPage;\r\n                        return;\r\n                    }\r\n\r\n                    var authenticationType = data.authenticationType;\r\n                    switch (authenticationType) {\r\n                        case \"Federate\":\r\n                        var logOffURL = data.logOffURL;\r\n                        var federationLogoutBindingProtocol = data.federationLogoutBindingProtocol;\r\n\r\n                        if (authenticationSubType === 'WSFederated') {\r\n                            $.when($.create(self.serviceLocator.getUrl(\"logout\"), logoutData)).done(function () {\r\n                                location.href = logOffURL;\r\n                            }).fail(function () {\r\n                                bizagi.log(\"Error logging out\");\r\n                            }).always(function () {\r\n                                location.href = data.logOffURL;\r\n                            });\r\n                        }\r\n                        else if (authenticationSubType === 'Saml') {\r\n                            var param = {};\r\n                            $.when($.read(self.serviceLocator.getUrl(\"FederateLogoffUrl\"), param)).done(function (res) {\r\n                                if (res.federateLogoffUrl) {\r\n                                    logOffURL = res.federateLogoffUrl;\r\n                                }\r\n\r\n                                $.when($.create(self.serviceLocator.getUrl(\"logout\"), logoutData)).done(function () {\r\n                                    if (federationLogoutBindingProtocol === 'POST') {\r\n                                        window.document.open('text/html');\r\n                                        window.document.write(logOffURL);\r\n                                        window.document.close();\r\n                                    }\r\n                                    else {\r\n                                        window.location.href = logOffURL;\r\n                                    }\r\n                                }).fail(function () {\r\n                                    bizagi.log(\"Error logging out\");\r\n                                }).always(function () {\r\n                                });\r\n\r\n                            }).fail(function () {\r\n                                bizagi.log(\"Error logging out\");\r\n                            }).always(function () {\r\n                            });\r\n                        }\r\n                        break;\r\n                    case \"SAML\":\r\n                        loader.nativeAjax(loader.getPathUrl(self.serviceLocator.getUrl(\"logout\"), logoutData),\r\n                            function(response) {\r\n                                var jsonResponse = JSON.parse(response.responseText);\r\n\r\n                                if (jsonResponse.logout === true) {\r\n                                    if (typeof jsonResponse.samlUrlRedirect != \"undefined\") {\r\n                                        var url = decodeURI(jsonResponse.samlUrlRedirect);\r\n                                        var iframe = document.createElement(\"iframe\");\r\n\r\n                                        document.getElementsByTagName(\"body\")[0].appendChild(iframe);\r\n\r\n                                        $(iframe).on(\"load\", function() {\r\n                                            var iframeContent = bizagi.util.isIE8() ?\r\n                                                $(this.contentWindow.document.body) :\r\n                                                $(this.contentWindow.eval(\"document.body\"));\r\n                                            var rawResponse = iframeContent.text();\r\n\r\n                                            location.reload();\r\n                                        });\r\n\r\n                                        iframe.src = url;\r\n\r\n                                    } else {\r\n                                        location.reload();\r\n                                    }\r\n                                } else {\r\n                                    bizagi.log(\"Error logging out\");\r\n                                }\r\n                            });\r\n                        break;\r\n                    case \"OAuth2\":\r\n                        $.when($.create(self.serviceLocator.getUrl(\"logout\"), logoutData)).done(function() {\r\n                            $.when($.read(self.serviceLocator.getUrl(\"oauth2AuthenticationConfig\")))\r\n                                .done(function(response) {\r\n                                    if (response.logoutUrl && response.logoutUrl != \"\") {\r\n                                        var logoutUrl = response.logoutUrl;\r\n                                        var callbackUrl = response.homeUrl;\r\n\r\n                                        logoutUrl = logoutUrl.replace(/post_logout_redirect_uri=[^&]*/,\r\n                                            \"post_logout_redirect_uri=\" + callbackUrl);\r\n                                        location.href = logoutUrl;\r\n                                    } else {\r\n                                        location.reload();\r\n                                    }\r\n\r\n                                }).fail(function() {\r\n                                    bizagi.log(\"Error logging out\");\r\n                                });\r\n                        }).fail(function() {\r\n                            bizagi.log(\"Error logging out\");\r\n                        });\r\n                        break;\r\n                    default:\r\n                        //Normal\r\n                        $.when($.create(self.serviceLocator.getUrl(\"logout\"), logoutData))\r\n                            .done(function() {\r\n                                window.location = bizagi.services.ajax.loginPage;\r\n                            }).fail(function() {\r\n                                bizagi.log(\"Error logging out\");\r\n                            });\r\n                        break;\r\n                    }\r\n                }).fail(function(message) {\r\n                    bizagi.log(message);\r\n                });\r\n            } catch (e) {\r\n                bizagi.log(e);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Services for Massive Activity Assignment\r\n     */\r\n\r\n    /*\r\n     * Obtain the organization info, such as roles, skills or locations. One of this options\r\n     * must be specified as a parameter\r\n     * @param object  {objectType=Roles|Skills|Locations}\r\n     * @return json\r\n     */\r\n    getOrganizationInfo: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n\r\n        data['objectType'] = params;\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('massive-activity-assignments-getOrganizationInfo'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Get Cases By Organization, using parameters suchs as roles, skills and locations\r\n     * @param object  {roles=(string),roles=(skills), locations=(string)}\r\n     * @return json\r\n     */\r\n    getCasesByOrganization: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n\r\n\r\n        data['roles'] = (params.roles) ? '[' + params.roles.toString() + ']' : '[]';\r\n\r\n        data['skills'] = (params.skills) ? '[' + params.skills.toString() + ']' : '[]';\r\n\r\n        data['locations'] = (params.locations) ? '[' + params.locations.toString() + ']' : '[]';\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('massive-activity-assignments-getCasesByOrganization'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Get Cases By Organization, using parameters suchs as roles, skills and locations\r\n     * @param object  {user=[array], roles=(string),roles=(skills), locations=(string)}\r\n     */\r\n    reassignCases: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n\r\n        data['users'] = (params.user) ? '[' + params.user.toString() + ']' : '[]';\r\n        data['roles'] = (params.roles) ? '[' + params.roles.toString() + ']' : '[]';\r\n        data['skills'] = (params.skills) ? '[' + params.skills.toString() + ']' : '[]';\r\n        data['locations'] = (params.locations) ? '[' + params.locations.toString() + ']' : '[]';\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('massive-activity-assignments-reassignCases'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     * Search the users inside the Organization, using parameters suchs as userName, full name, domain, roles, skills and locations\r\n     * All parameters are optional\r\n     * @param object  {userName=(string), fullName=(string), domain=(string), roles=(string),roles=(skills), locations=(string)}\r\n     * @return json\r\n     */\r\n    searchUsers: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n\r\n        data['userName'] = params.userName || '';\r\n\r\n        data['fullName'] = params.fullName || '';\r\n\r\n        data['domain'] = params.domain || '';\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('massive-activity-assignments-searchUsers'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /**\r\n     * Get json with bizagi domains list\r\n     * @return {deferred} ajax object with JSON content\r\n     */\r\n    getDomainList: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('domains');\r\n\r\n        return $.read(url);\r\n    },\r\n    /**\r\n     * Services for Asynchronous ECM Upload\r\n     */\r\n\r\n    /* Get the ECM Pending Scheduled Jobs\r\n     * @return {deferred} ajax object with JSON content\r\n     */\r\n    getEcmAllScheduledJobs: function () {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n        data['action'] = 'getEcmAllScheduledJobs';\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('async-ecm-upload-baseService'), data);\r\n    },\r\n    /* Retries an especific ECM Pending Scheduled Job\r\n     * @param object  {jobId=(string)} //The id of the job wich is going to be retried\r\n     * @return {deferred} ajax object with JSON content\r\n     */\r\n    retryECMPendingScheduledJob: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n        data['action'] = 'retryECMPendingScheduledJob';\r\n        data['idJob'] = params;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('async-ecm-upload-baseService'), data);\r\n    },\r\n    /*\r\n     *   Returns the current workportal version\r\n     */\r\n    getWorkPortalVersion: function () {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('WorkPortalVersion'),\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        }).always(function (data) {\r\n            // Compatibility with java version\r\n            data = data || {};\r\n\r\n            if (data.version == '') {\r\n                // Take the build version\r\n                data.version = bizagi.loader.productBuild || '';\r\n            }\r\n            return data;\r\n        });\r\n    },\r\n    /*\r\n     *   Returns the combo's data to authentication log depending of the params\r\n     */\r\n    getAuthenticationLogData: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n        var url = '';\r\n\r\n        if (params['dataType'] == 'domains') {\r\n            url = 'admin-getAuthenticationDomains';\r\n        } else if (params['dataType'] == 'events') {\r\n            url = 'admin-getAuthenticationEventsTypes';\r\n        } else {\r\n            url = 'admin-getAuthenticationEventSubTypes';\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(url),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Get the search result of authentication log\r\n     */\r\n    getAuthenticationLogResult: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        var data = {};\r\n\r\n        data['action'] = params.action;\r\n        data['domain'] = params.domain;\r\n        data['userName'] = params.userName;\r\n        data['dtFrom'] = params.dtFrom;\r\n        data['dtTo'] = params.dtTo;\r\n        data['eventSubType'] = params.eventSubType;\r\n        data['eventType'] = params.eventType;\r\n        data['pag'] = params.pag;\r\n        data['pagSize'] = params.pagSize;\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-getAuthenticationLog'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     *   Return the password encrypted\r\n     */\r\n    encryptString: function (params) {\r\n        var self = this;\r\n\r\n        var data = {};\r\n\r\n        // Define data\r\n        params = params || {};\r\n\r\n        data.entry = params.entry;\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-EncryptString'),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return the users requests\r\n     */\r\n    userPendingRequests: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            pag: params.pag,\r\n            pagSize: params.pagSize\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl(\"admin-UserPendingRequests\"), data);\r\n    },\r\n\r\n    /*\r\n     *   Return the User Authentication Info\r\n     */\r\n    userAuthenticationInfo: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('admin-UserAuthenticationInfo'), {\r\n            idUser: params.idUser\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return Update User Authentication Info\r\n     */\r\n    updateUserAuthenticationInfo: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.create(self.serviceLocator.getUrl('admin-updateUserAuthenticationInfo'), {\r\n            idUser: params.idUser,\r\n            password: params.password,\r\n            enable: params.enable,\r\n            expired: params.expired,\r\n            locked: params.locked\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return generate Data To Send By Email\r\n     */\r\n    generateRandomPassword: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        params['action'] = 'generateRandomPassword';\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-generateRandomPassword'),\r\n            data: params,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return generate Data To Send By Email\r\n     */\r\n    generateDataToSendByEmail: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['action'] = 'GenerateDataToSendByEmail';\r\n        data['idUser'] = params.idUser;\r\n        data['password'] = params.password;\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-GenerateDataToSendByEmail'),\r\n            data: params,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return generate Send Mail\r\n     */\r\n    sendEmail: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['action'] = 'sendEmail';\r\n        data['emailTo'] = params.emailTo;\r\n        data['subject'] = params.subject;\r\n        data['body'] = params.body;\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-sendEmail'),\r\n            data: params,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return Applications, Categories or processes list\r\n     */\r\n    getApplicationCategoriesList: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = '';\r\n\r\n        if (params.action == 'Applications') {\r\n            url = 'admin-getApplicationList';\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(url),\r\n                type: 'GET',\r\n                dataType: 'json'\r\n            });\r\n        } else {\r\n            url = 'admin-getCategoriesList';\r\n            data.idApp = params.idApp;\r\n            data.idCategory = params.idCategory;\r\n            if (data.idCategory == '') {\r\n                data.idCategory = -1;\r\n            }\r\n\r\n            if (typeof (params.filterStartEvent) !== 'undefined') {\r\n                data.filterStartEvent = params.filterStartEvent;\r\n            }\r\n\r\n            // Call ajax and returns promise\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(url),\r\n                data: data,\r\n                type: 'GET',\r\n                dataType: 'json'\r\n            });\r\n        }\r\n    },\r\n\r\n    /*\r\n     *   Return the list of all cases that matched the filters\r\n     */\r\n    getAdminCasesList: function (params) {\r\n        var self = this;\r\n        var data = params || {};\r\n\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            //eliminar esto con el servicio restfull\r\n            cache: true,\r\n            url: self.serviceLocator.getUrl('admin-getCasesList'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n\r\n    },\r\n\r\n    /*\r\n     *   Return the application's processes\r\n     */\r\n    getApplicationProcesses: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getApplicationProcesses');\r\n\r\n        var data = {};\r\n\r\n        data['idApp'] = params['idApp'] ? params['idApp'] : -1;\r\n\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *   Return the application's processes\r\n     */\r\n    getProcessVersion: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getProcessVersion');\r\n\r\n        var data = {};\r\n\r\n        data['idWfClass'] = params['idWFClass'];\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *   Return the the workflow's versions task\r\n     */\r\n    getProcessTasks: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getProcessTasks');\r\n\r\n        var data = {};\r\n\r\n        data['idWfClass'] = params['idWFClass'];\r\n        data['version'] = params['version'] ? params['version'] : undefined;\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     * Retrieves the alarms from an specific task\r\n     */\r\n    getTaskAlarms: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getTaskAlarms');\r\n\r\n        var data = {};\r\n\r\n        data['idTask'] = params['idTask'];\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     * Retrieves each kind of alarm lapse\r\n     */\r\n    getLapseMode: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getLapseMode');\r\n\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     * Retrieves each kind of alarm recurrence\r\n     */\r\n    getRecurrMode: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getRecurrMode');\r\n\r\n        return $.read(url);\r\n    },\r\n\r\n\r\n    /*\r\n     * Retrieves each kind of alarm recurrence\r\n     */\r\n    getScheduleType: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getScheduleType');\r\n\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     *   Retrieves the boss list\r\n     */\r\n    getBossList: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-getBossList');\r\n        return $.read(url);\r\n    },\r\n\r\n    /**\r\n     *   Add a new alarm\r\n     */\r\n    addAlarm: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-addAlarm');\r\n\r\n        var data = {};\r\n\r\n        data['idTask'] = params['idTask'];\r\n        data['idRecurrMode'] = params['idRecurrMode'];\r\n        data['idLapseMode'] = params['idLapseMode'];\r\n        data['scheduleType'] = params['scheduleType'];\r\n        data['alarmTime'] = params['alarmTime'];\r\n        data['alarmRecurrTime'] = params['alarmRecurrTime'];\r\n        data['sendToCurrentAssignee'] = params['sendToCurrentAssignee'];\r\n\r\n        return $.update(url, data);\r\n        /*\r\n         return $.ajax({\r\n         url: self.serviceLocator.getUrl('admin-addAlarm'),\r\n         data: data,\r\n         type: 'PUT',\r\n         dataType: 'json'\r\n         });\r\n         */\r\n    },\r\n\r\n    /*\r\n     *   Edits an existin alarm\r\n     */\r\n    editAlarm: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-editAlarm');\r\n\r\n        var data = {};\r\n\r\n        data['idTask'] = params['idTask'];\r\n        data['idAlarm'] = params['idAlarm'];\r\n        data['idRecurrMode'] = params['idRecurrMode'];\r\n        data['idLapseMode'] = params['idLapseMode'];\r\n        data['scheduleType'] = params['scheduleType'];\r\n        data['alarmTime'] = params['alarmTime'];\r\n        data['alarmRecurrTime'] = params['alarmRecurrTime'];\r\n        data['sendToCurrentAssignee'] = params['sendToCurrentAssignee'];\r\n\r\n\r\n        return $.update(url, data);\r\n\r\n\r\n    },\r\n\r\n    /*\r\n     *   Delete an alarm\r\n     */\r\n    deleteAlarm: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-deleteAlarm');\r\n\r\n        var data = {};\r\n\r\n        data['idAlarm'] = params['idAlarm'];\r\n\r\n        return $.destroy(url, params);\r\n\r\n    },\r\n\r\n    /*\r\n     * Returns the Alarm Recipients\r\n     * @param param: idAlarm : the alarm id to get the related recipients\r\n     */\r\n    getAlarmRecipients: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-alarmRecipients');\r\n\r\n        var data = {};\r\n\r\n        data['idAlarm'] = params['idAlarm'];\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     * Adds a new Alarm Recipient to the current alam\r\n     * @param param: idAlarm : the alarm id to get the related recipients\r\n     * @param param: idRecipient : the recipient id\r\n     */\r\n    addRecipientToAlarm: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-recipientToAlarm');\r\n\r\n        var data = {};\r\n\r\n        data['idAlarm'] = params['idAlarm'];\r\n        data['idRecipient'] = params['idRecipient'];\r\n\r\n        return $.update(url, data);\r\n\r\n\r\n    },\r\n\r\n    /*\r\n     * Delete/s the alarm recipient/s from the current task\r\n     * @param param: idRecipient : the recipient id/s who is going to be deleted\r\n     */\r\n    deleteRecipientsFromAlarm: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-deleteAlarmRecipients');\r\n\r\n        var data = {};\r\n\r\n        data['idRecipients'] = params['idRecipients'];\r\n\r\n        return $.destroy(url, data);\r\n    },\r\n\r\n    /*\r\n     * Send the action to toggle the alarms state: enable or disable\r\n     * @param param: idTask : the task id who is going to be actvidated/deactivaded his alarms\r\n     */\r\n    enableAlarm: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-enableAlarm');\r\n\r\n        var data = {};\r\n\r\n        data['idTask'] = params['idTask'];\r\n\r\n        return $.create(url, data);\r\n    },\r\n\r\n    /*\r\n     * Invalidate or Reassign a set of cases\r\n     */\r\n    abortReassignItems: function (params) {\r\n        var self = this;\r\n        var data = params || {};\r\n        var url = params.action == 'abort' ? 'admin-abortItems' : 'admin-reassignItems';\r\n        // Call ajax and returns promise\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(url),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n    /*\r\n     * Services for Asynchronous Activities\r\n     */\r\n    asyncActivitiesServices: function (params) {\r\n        var self = this;\r\n        var data = params;\r\n        var url = '';\r\n        var type = 'GET';\r\n        if (params.action == 'getActivities') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-get-activities');\r\n        } else if (params.action == 'retryNow') {\r\n            type = 'POST';\r\n            url = self.serviceLocator.getUrl('admin-async-activities-get-retry-now');\r\n            url = url.replace('{idCase}', params.idCase);\r\n            url = url.replace('{idworkItem}', params.idWorkitem);\r\n            url = url.replace(\"{idAsynchWorkitem}\", params.idAsynchWorkitem);\r\n        } else if (params.action == 'getActivitiesByTask') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-get-activities-by-task');\r\n        } else if (params.action == 'enableExecution') {\r\n            type = 'POST';\r\n            url = self.serviceLocator.getUrl('admin-async-activities-enable-execution');\r\n        } else if (params.action == 'enableMultiple') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-enable-multiple');\r\n            type = 'POST';\r\n        } else if (params.action == 'asyncExecution') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-async-execution');\r\n        } else if (params.action == 'asyncExecutionLog') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-async-execution-log');\r\n            url = url.replace('{idCase}', params.idCase);\r\n            url = url.replace('{idworkItem}', params.idWorkItem);\r\n            url = url.replace(\"{idAsynchWorkitem}\", params.idAsynchWorkitem);\r\n        } else if (params.action == 'getAsyncExecution') {\r\n            url = self.serviceLocator.getUrl('admin-async-activities-async-get-current-execution-log');\r\n        }\r\n        // Call ajax and returns promise\r\n        var response = $.ajax({\r\n            url: url,\r\n            data: data,\r\n            type: type,\r\n            dataType: 'json'\r\n        });\r\n\r\n        return response;\r\n    },\r\n\r\n    /*\r\n     *  Return generate Default Assignation To all Process\r\n     */\r\n    getDefaultAssignationUserToAllProcess: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('admin-getDefaultAssignationUserToAllProcess'), {\r\n            serviceAction: 'getDefaultAssignationUserToAllProcess'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *  Return generate Default Assignation To Process\r\n     */\r\n    getDefaultAssignationUserToProcess: function (params) {\r\n        var self = this;\r\n        var process;\r\n        // Call ajax and returns promise\r\n        if (params.idWFClass == '') {\r\n            process = -1\r\n        } else {\r\n            process = params.idWfClass\r\n        }\r\n        return $.read(self.serviceLocator.getUrl('admin-getDefaultAssignationUserToProcess'), {\r\n            serviceAction: 'getDefaultAssignationUserToProcess',\r\n            process: process\r\n\r\n        });\r\n    },\r\n\r\n    /*\r\n     * Return Assignation Process\r\n     */\r\n    setDefaultAssignationUserToProcess: function (params) {\r\n        var self = this;\r\n        if (params.idWFClass == '') {\r\n            process = -1\r\n        } else {\r\n            process = params.idWfClass\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.create(self.serviceLocator.getUrl('admin-setDefaultAssignationUserToProcess'), {\r\n            serviceAction: 'setDefaultAssignationUserToProcess',\r\n            process: process,\r\n            idUser: params.idUser\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get the icon of a given process\r\n     * @param params\r\n     */\r\n    getProcessIcon: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            processId: params.processId\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"process-getIcon\"),\r\n            data: data,\r\n            batchRequest: true\r\n        });\r\n    },\r\n    /**\r\n     * Get the icon of a given collection\r\n     * @param params\r\n     */\r\n    getCollectionIcon: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            collectionId: params.collectionId\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"collections-getIcon\"),\r\n            data: data,\r\n            batchRequest: true\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Returns the combo's data to Type Profiles depending of the params\r\n     */\r\n    getProfilesTypes: function (params) {\r\n        var self = this;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('admin-getProfilesTypes'));\r\n    },\r\n\r\n    /*\r\n     *  Return generate Search Profiles\r\n     */\r\n    searchProfiles: function (params) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl('admin-searchProfiles');\r\n        var data = {};\r\n        data['type'] = params['profileType'];\r\n        data['name'] = params['profileName'];\r\n\r\n        data[\"orgId\"] = params[\"orgId\"] ? params[\"orgId\"] : null;\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *  Return Users By Profiles\r\n     */\r\n    getUsersByProfile: function (params) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl('admin-getUsersByProfile');\r\n        var data = {};\r\n        data['type'] = params['profileType'];\r\n        data['id'] = params['idProfile'];\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *  Remove User Profiles\r\n     */\r\n    removeUserFromProfile: function (params) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl('admin-removeUserFromProfile');\r\n        var data = {};\r\n        data['type'] = params['profileType'];\r\n        data['id'] = params['idProfile'];\r\n        data['idUser'] = params['idUser'];\r\n\r\n        return $.destroy(url, data);\r\n    },\r\n\r\n    /*\r\n     *  Add Users Profiles\r\n     */\r\n    addUserToProfile: function (params) {\r\n        var self = this;\r\n\r\n        var url = self.serviceLocator.getUrl('admin-addUserToProfile');\r\n        var data = {};\r\n        data['type'] = params['profileType'];\r\n        data['id'] = params['idProfile'];\r\n        data['idUser'] = params['idUser'];\r\n\r\n        return $.update(url, data);\r\n    },\r\n    /*\r\n     *  Display Licenses\r\n     */\r\n    licenses: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-Licenses');\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     *   Return Dimensions List\r\n     */\r\n    getDimensions: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-GetDimensions');\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     *   Edit Dimensions\r\n     */\r\n    editDimension: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['id'] = params.id;\r\n        data['displayName'] = params.displayName;\r\n        data['name'] = params.name;\r\n        data['idWfClass'] = params.idWfClass;\r\n        data['entityPath'] = params.entityPath;\r\n        data['description'] = params.description;\r\n        var url = self.serviceLocator.getUrl('admin-EditDimension');\r\n        // Call ajax and returns promise\r\n        return $.create(url, data);\r\n        /*return $.ajax({\r\n         url: self.serviceLocator.getUrl('admin-EditDimension'),\r\n         data: params,\r\n         type: 'POST',\r\n         dataType: 'json'\r\n         });*/\r\n    },\r\n\r\n    /*\r\n     *   Create Dimensions\r\n     */\r\n    createAdministrableDimension: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['displayName'] = params.displayName;\r\n        data['name'] = params.name;\r\n        data['idWfClass'] = params.idWfClass;\r\n        data['entityPath'] = params.entityPath;\r\n        data['Description'] = params.description;\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-CreateAdministrableDimension'),\r\n            data: params,\r\n            type: 'PUT',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     * Delete manageable dimensions\r\n     */\r\n    deleteDimension: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-DeleteDimension');\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['id'] = params.id;\r\n        data['idDimension'] = params.id;\r\n        data['administrable'] = params.administrable;\r\n        // Call ajax and returns promise\r\n        return $.destroy(url, data);\r\n    },\r\n\r\n    /*\r\n     *   Dimensions Process Tree\r\n     */\r\n    entityPathChildNodesAction: function (params) {\r\n        var self = this;\r\n\r\n        // Define data\r\n        params = params || {};\r\n        var data = {};\r\n        data['pathNodeType'] = params.nodeType;\r\n        data['idNode'] = params.idNode;\r\n        data['nodeDisplayPath'] = params.nodeDisplayPath;\r\n        data['nodePath'] = params.nodePath;\r\n        data['idWfClass'] = params.idWfClass;\r\n        // Call ajax and returns promise\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('admin-EntityPathChildNodesAction'),\r\n            data: params,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Return list of available processes\r\n     */\r\n    getActiveWFClasses: function (params) {\r\n        var self = this;\r\n        var data = params || {};\r\n\r\n        // Call ajax and returns promise\r\n\r\n        return $.ajax({\r\n            //eliminar esto con el servicio restfull\r\n            cache: true,\r\n            url: self.serviceLocator.getUrl('admin-GetActiveWFClasses'),\r\n            data: data,\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     *   Resturn the list of Stored Document Templates\r\n     */\r\n    storeDocumentTemplates: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-document-templates-storeDocumentTemplates');\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     * Restore an selected document template using his Guid as parameter\r\n     * @param params {Object} Guid: the associated Guid from the desired document template\r\n     */\r\n    restoreDocumentTemplates: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-document-templates-restoreDocumentTemplates');\r\n\r\n        url += '?Guid=' + params.Guid;\r\n\r\n        return $.read(url);\r\n    },\r\n\r\n    /*\r\n     * Retreieves the workflow from the actual processes\r\n     */\r\n    getWorkFlowClasses: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-processes-workflowClasses');\r\n        return $.read(url);\r\n    },\r\n\r\n\r\n    /*\r\n     * Retreives the task from a desired workflow\r\n     * @param params {Object} idWorkFlow: the desired workflow id\r\n     */\r\n    getTaskByWorkFlow: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-processes-tasksByWorkflow');\r\n\r\n        var data = {};\r\n        data['idWorkflow'] = params.idWorkflow;\r\n\r\n\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     * Modifies the process durationworkflow\r\n     * @param params {Object} idWorkflow: the desired process id to modify\r\n     * @param params {Object} duration: the duracion, converted in minutes\r\n     */\r\n    modifyProcessDuration: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-processes-modifyProcessDuration');\r\n\r\n        var data = {};\r\n        data['idWorkflow'] = params.idWorkflow;\r\n        data['duration'] = params.duration;\r\n\r\n        return $.create(url, data);\r\n    },\r\n\r\n    /*\r\n     * Modifies the task duration form a desired workflow\r\n     * @param params {Object} idTask: the desired task id to modifie\r\n     * @param params {Object} duration: the duracion, converted in minutes\r\n     */\r\n    modifyTaskDuration: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-processes-modifyTaskDuration');\r\n\r\n        var data = {};\r\n        data['idTask'] = params.idTask;\r\n        data['duration'] = params.duration;\r\n\r\n        return $.create(url, data);\r\n    },\r\n\r\n    /*\r\n     * this retrive data for the report my team\r\n     */\r\n    getDataForMyTeam: function () {\r\n\r\n        var self = this;\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('bam-resourcemonitor-myteam'),\r\n            type: 'GET',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n     * Retrive data for reports\r\n     */\r\n    getReporstAnalysisQuery: function () {\r\n\r\n        var self = this;\r\n\r\n        return $.read(self.serviceLocator.getUrl('reports-analysisquery'));\r\n    },\r\n\r\n    /*\r\n     * Update report data\r\n     */\r\n    updateReportData: function (params) {\r\n\r\n        var self = this;\r\n\r\n        return $.update(self.serviceLocator.getUrl('reports-analysisquery-update'), params);\r\n    },\r\n\r\n    /*\r\n     * Delete report data\r\n     */\r\n    deleteReportData: function (params) {\r\n\r\n        var self = this;\r\n\r\n        return $.destroy(self.serviceLocator.getUrl('reports-analysisquery-delete') + '?' + params);\r\n    },\r\n    /*\r\n     *Entrega la lista de idiomas soportados\r\n     */\r\n    getStoreLanguageTemplates: function () {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl('admin-language-languages');\r\n        var data = {justActives: false};\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /*\r\n     *Download template language list\r\n     */\r\n    getLanguageTemplate: function (params) {\r\n        var self = this;\r\n        var defer = $.Deferred();\r\n        var url = self.serviceLocator.getUrl('admin-language-resource') + '?cultureName=' + params.cultureName;\r\n        defer.resolve('OK');\r\n        window.location.href = url;\r\n        /*\r\n         var response=  $.ajax({\r\n         type: 'GET',\r\n         url: url\r\n         });\r\n         response.always(function(response, status, xhr) {\r\n         if(response.responseText.indexOf('error') >= 0){\r\n         defer.reject('Download error');\r\n         }else{\r\n         defer.resolve('OK');\r\n         window.location.href=url;\r\n         }\r\n         });*/\r\n        return defer.promise();\r\n    },\r\n    /*\r\n     * Process definition service for process viewer\r\n     */\r\n    processDefinition: function (params) {\r\n        var self = this;\r\n        return $.read(self.serviceLocator.getUrl('processviewer-processdefinition'), params);\r\n    },\r\n\r\n    /*\r\n     * Graphic info for process viewer\r\n     */\r\n    graphicInfo: function (params) {\r\n        var self = this;\r\n        return $.read(self.serviceLocator.getUrl('processviewer-processgraphicinfo'), params);\r\n    },\r\n\r\n    /**\r\n     * This service get the last version of BizagiBPM\r\n     *\r\n     * @return {json}\r\n     */\r\n    getLastUpdateByMobile: function () {\r\n        var self = this;\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"mobile-getLastUpdate\")\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getCollectionData: function (params) {\r\n        var self = this,\r\n            data = {},\r\n            url = self.serviceLocator.getUrl('templates-handler-getCollectionData');\r\n\r\n        data.idFact = params.idFact;\r\n        data.pag = params.page || 1;\r\n        data.pagSize = params.pageSize || 10;\r\n        data.filters = params.filters ? ((!Array.isArray(params.filters)) ? JSON.stringify(params.filters) : undefined) : undefined;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getVirtualCollectionData: function (params) {\r\n        var self = this,\r\n            data = {},\r\n            url = self.serviceLocator.getUrl('templates-handler-getVirtualCollectionData');\r\n\r\n        data.guidVirtualCollection = params.guidVirtualCollection;\r\n        data.pag = params.page || 1;\r\n        data.pagSize = params.pageSize || 10;\r\n        data.filters = params.filters ? ((!Array.isArray(params.filters)) ? JSON.stringify(params.filters) : undefined) : undefined;\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getSearchData: function (params) {\r\n        var self = this;\r\n        // Call ajax and returns promise\r\n        var urlSend = self.serviceLocator.getUrl(\"my-search-getData\");\r\n        urlSend = urlSend.replace(\"{guidSearch}\", params.guidSearch);\r\n        var filters = params.filters || [];\r\n\r\n        var data = {\r\n            filters: JSON.stringify(filters),\r\n            pag: params.page || 1,\r\n            calculateFilters: params.calculateFilters || false,\r\n            pagSize: params.pageSize || 10\r\n        };\r\n        return $.read(urlSend, data).then(function (data) {\r\n            return self.serializeEntityData(data);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Return an array with the collections or entity related to stakeholder entities\r\n     * @param params\r\n     */\r\n    getCollectionEntityData: function (params) {\r\n        var self = this, url;\r\n        params = params || {};\r\n        var data = {\r\n            templateType: (params.referenceType === \"VIRTUAL\" || params.referenceType === \"FACT\") ? \"List\" : \"Content\",\r\n            surrogateKey: params.surrogateKey,\r\n            pag: params.page || 1,\r\n            pagSize: params.pageSize || 10,\r\n            defaultFilterApplied: params.defaultFilterApplied,\r\n            filters: JSON.stringify(params.filters)\r\n        };\r\n\r\n        // VIRTUAL\r\n        if (params.referenceType === \"VIRTUAL\") {\r\n            url = self.serviceLocator.getUrl('data-navigation-handler-collection');\r\n            data.reference = params.reference;\r\n        }\r\n        // ENTITY AND FACTS\r\n        else {\r\n            url = self.serviceLocator.getUrl('data-navigation-handler-entity');\r\n            data.reference = params.guidEntityCurrent;\r\n            data.xpath = params.xpath;\r\n            data.collectionId = params.reference;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data).then(function (response) {\r\n            return self.serializeEntityData(response);\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     */\r\n    getFiltersEntityData: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        var data = {\r\n            reference: params.guidEntityCurrent,\r\n            collectionId: params.reference,\r\n            surrogateKey: params.surrogateKey,\r\n            xpath: params.xpath,\r\n            templateType: \"List\",\r\n            defaultFilterApplied: params.defaultFilterApplied,\r\n            filters: JSON.stringify(params.filters)\r\n        };\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"data-navigation-handler-entity-filters\"),\r\n            data: data\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getProcessAddAction: function (params) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"action-handler-getProcessAddAction\");\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, params)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getMultipleActions: function (params) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"templates-handler-getMultipleActions\");\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, params)\r\n            .pipe(function (response) {\r\n                return response;\r\n            });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getMapping: function (params) {\r\n        var self = this;\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"process-handler-getMapping\"),\r\n            data: params,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param data\r\n     * @returns {*}\r\n     */\r\n    getForm: function (data) {\r\n        var self = this;\r\n\r\n        data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicetype\"] = self.deviceType;\r\n        data[self.Class.BA_CONTEXT_PARAMETER_PREFIX + \"devicecode\"] = self.deviceCode;\r\n\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"process-handler-getForm\"),\r\n            data: data,\r\n            type: 'POST',\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Chek if an entity has startform\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    hasStartForm: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        if (params.guid) {\r\n            data.guidWFClass = params.guid;\r\n        }\r\n\r\n        return $.read(self.serviceLocator.getUrl(\"process-handler-startform\"), data);\r\n    },\r\n\r\n    /**\r\n     * Executes the action\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    executeAction: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            surrogateKey: JSON.stringify(params.surrogatedKey),\r\n            entityId: params.entityId,\r\n            ruleId: params.processId\r\n        };\r\n\r\n        // Call ajax and returns promise\r\n        return $.create({\r\n            url: self.serviceLocator.getUrl(\"process-action-execute\"),\r\n            data: data\r\n        });\r\n    },\r\n\r\n    /**\r\n     * executes a rule\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    actionRule: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            surrogateKey: params.surrogateKey,\r\n            entityId: params.entityId,\r\n            ruleId: params.processId\r\n        }\r\n\r\n        return $.create({\r\n            url: self.serviceLocator.getUrl(\"process-handler-rule\"),\r\n            data: data,\r\n            batchRequest: false\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get following cases\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getActivitiesData: function (params) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"process-handler-getActivitiesData\");\r\n        params = params || {};\r\n        var data = {\r\n            page: params.page || 1,\r\n            pagsize: params.pageSize || 10\r\n        };\r\n\r\n        if (typeof (params.idworkflow) !== \"undefined\" && params.idworkflow ||\r\n            typeof (params.idWorkflow) !== \"undefined\" && params.idWorkflow) {\r\n            data.idWorkflow = params.idworkflow || params.idWorkflow;\r\n        }\r\n        if (typeof params.idCase !== \"undefined\" && params.idCase) {\r\n            data.idCase = params.idCase;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data).then(function (response) {\r\n            return self.serializeEntityData(response);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Return an array with the collections related to stakeholder entities\r\n     */\r\n    getPendingsData: function (params) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"process-handler-getPendingsData\");\r\n        params = params || {};\r\n        var data = {\r\n            page: params.page || 1,\r\n            pagsize: params.pageSize || 10\r\n        };\r\n\r\n        if (typeof (params.idworkflow) !== \"undefined\" && params.idworkflow ||\r\n            typeof (params.idWorkflow) !== \"undefined\" && params.idWorkflow) {\r\n            data.idWorkflow = params.idworkflow || params.idWorkflow;\r\n        }\r\n        if (typeof params.idCase !== \"undefined\" && params.idCase) {\r\n            data.idCase = params.idCase;\r\n        }\r\n        if (typeof params.taskState !== \"undefined\" && params.taskState) {\r\n            data.taskState = params.taskState;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data).then(function (response) {\r\n            return self.serializeEntityData(response);\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get actions\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getActionsData: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl('entities-handler-getActions'),\r\n            data: params,\r\n            batchRequest: true\r\n        }).pipe(function (response) {\r\n            return response;\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get Users, assignees and events from cases\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    getUsersAndEvents: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        if (params.idCases && params.idCases.length > 0) {\r\n            data.idCases = params.idCases.toString();\r\n        }\r\n\r\n        return $.read(self.serviceLocator.getUrl(\"entities-handler-getUsersAndEvents\"), data);\r\n    },\r\n\r\n    /**\r\n     * Get Users, assignees and events from cases\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    getUsers: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            caseId: params.caseId\r\n        };\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"entities-handler-getUsers\"),\r\n            data: params,\r\n            batchRequest: true\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get Users, assignees and events from cases\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    getEvents: function (params) {\r\n        var self = this;\r\n        var data = {\r\n            caseId: params.caseId\r\n        };\r\n\r\n        // Call ajax and returns promise\r\n        return $.read({\r\n            url: self.serviceLocator.getUrl(\"entities-handler-getEvents\"),\r\n            data: params,\r\n            batchRequest: true\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get Users images\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    getUsersImages: function (params, userIds) {\r\n        var self = this;\r\n        var data = {};\r\n        var url = self.serviceLocator.getUrl(\"entities-handler-getUsersImages\");\r\n\r\n        if (userIds && userIds.length > 0) {\r\n            data.userIds = userIds.toString();\r\n        }\r\n\r\n        data.width = params.width;\r\n        data.height = params.height;\r\n        data.square = params.square;\r\n\r\n        var newUserServices = bizagi.util.getFeatureObject(\"userService.v1.enabled\");\r\n        if (newUserServices) {\r\n            return $.ajax({\r\n                url: url, \r\n                data: data,\r\n                type: \"POST\",\r\n                dataType: \"json\"\r\n            });\r\n        } else {    \r\n            return $.read({\r\n                url: url,\r\n                data: data,\r\n                dataType: \"json\"\r\n            });\r\n        }  \r\n    },\r\n\r\n    /**\r\n     * Get stakeholder shortCurts\r\n     * @param params\r\n     * @return {*}\r\n     */\r\n    getShortCuts: function (params) {\r\n        var self = this,\r\n            data = {},\r\n            url = self.serviceLocator.getUrl(\"entities-handler-getShotCuts\");\r\n\r\n        if (typeof params.icon !== \"undefined\" && params.icon) {\r\n            data.icon = true;\r\n        }\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(url, data);\r\n    },\r\n\r\n    /**\r\n     *   Returns the available list of searches\r\n     */\r\n    getSearchLists: function () {\r\n        var self = this;\r\n        return $.read(self.serviceLocator.getUrl(\"my-search-getSearchLists\"), {});\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param params\r\n     */\r\n    getIdCasesOfProcessEntities: function (params) {\r\n        params = params || {};\r\n        var self = this;\r\n        var ids = {\r\n            ids: JSON.stringify(params)\r\n        };\r\n\r\n        // TODO: Validate compatibility\r\n        if (bizagi.version.server.lessThanOrEqualsTo(\"11.0.0.2608\")) {\r\n            // Call ajax and returns promise\r\n            return $.read({\r\n                url: self.serviceLocator.getUrl(\"process-handler-getIdCasesOfProcessEntities\"),\r\n                data: ids\r\n            });\r\n\r\n        }else{\r\n            return $.ajax({\r\n                url: self.serviceLocator.getUrl(\"process-handler-getIdCasesOfProcessEntities\"),\r\n                data: ids,\r\n                type: \"POST\"\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Retuns query form to searches\r\n     * @param params\r\n     * @returns {*}\r\n     */\r\n    getQueryForm: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl(\"query-handler-getQueryForm\"),\r\n            data: params,\r\n            type: \"POST\",\r\n            dataType: params.dataType || \"json\"\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Returns an object with the filter to send to the server\r\n     * @param params\r\n     * @param filterObject\r\n     * @param callback is called when a filter is added to the array\r\n     */\r\n    defineFilterObject: function (params, filterObject, callback) {\r\n        var properties = params.properties;\r\n        var xpath = properties.xpath.split('@')[0];\r\n\r\n        var filter = filterObject.find(function (el) {\r\n            return el.xpath == xpath;\r\n        });\r\n\r\n        //if the control exists is because it is a range\r\n        if (filter) {\r\n            if (properties.rangeQuery == \"from\") {\r\n                filter.value = filter.value || {};\r\n                filter.searchType = 'range';\r\n                filter.value.min = params.value;\r\n            }\r\n            else if (properties.rangeQuery == \"to\") {\r\n                filter.value = filter.value || {};\r\n                filter.searchType = 'range';\r\n                filter.value.max = params.value;\r\n            }\r\n            else {\r\n                params.properties.typeSearch = filter.searchType;\r\n                var values = setValues(params);\r\n                $.extend(filter, values);\r\n            }\r\n\r\n            if (properties.orderType) {\r\n                filter.orderType = properties.orderType;\r\n            }\r\n            if (callback) {\r\n                callback(bizagi.clone(filter));\r\n            }\r\n        }\r\n        else {\r\n            var isDefaultFilter = properties.defaultFilter || false;\r\n            filter = setValues(params);\r\n\r\n            if (properties.orderType) {\r\n                filter.orderType = properties.orderType;\r\n            }\r\n\r\n            if (typeof filter.value != 'undefined' || filter.orderType || isDefaultFilter) {\r\n                filterObject.push(filter);\r\n                if (callback) {\r\n                    callback(bizagi.clone(filter));\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        function setValues(params) {\r\n            var properties = params.properties;\r\n            var searchType = properties.typeSearch;\r\n            var value = params.value;\r\n\r\n            //Identifing the type control in order to define search type\r\n            if (properties.type == \"boolean\") {\r\n                if (value.toLowerCase() === \"null\") {\r\n                    value = null;\r\n                    searchType = \"Nullable\"\r\n                }\r\n                else {\r\n                    value = bizagi.util.parseBoolean(value);\r\n                    searchType = \"exact\"\r\n                }\r\n            }\r\n\r\n            if (properties.type == \"number\" || properties.type == \"money\" || properties.type == \"date\") {\r\n                searchType = \"exact\"\r\n            }\r\n\r\n            if (typeof params.value == 'object') {\r\n                value = [];\r\n                if (Array.isArray(params.value)) {\r\n                    for (var i = 0, len = params.value.length; i < len; i++) {\r\n                        var val = parseInt(params.value[i].id);\r\n                        if (!isNaN(val)) {\r\n                            value.push(val);\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    var val = parseInt(params.value.id);\r\n                    if (!isNaN(val)) {\r\n                        value.push(val);\r\n                    }\r\n                }\r\n                searchType = \"exact\";\r\n                value = value.length > 0 ? value : undefined;\r\n            }\r\n\r\n            if (properties.rangeQuery && properties.rangeQuery !== \"none\") {\r\n                value = {\r\n                    min: params.value,\r\n                    max: params.value\r\n                };\r\n                searchType = \"range\";\r\n            }\r\n\r\n            searchType = searchType || \"approx\";\r\n\r\n            var filter = {\r\n                xpath: xpath,\r\n                searchType: searchType\r\n            };\r\n\r\n            if (typeof value !== 'undefined') {\r\n                filter.value = value;\r\n            }\r\n\r\n            return filter;\r\n        }\r\n    },\r\n\r\n    /*PLAN*/\r\n    getPlan: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-get\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getActivities: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-activities\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    updatePlan: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-update\");\r\n        return $.update({\r\n            url: url.replace(\"{idPlan}\", params.id),\r\n            data: JSON.stringify(params),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    putExecutePlan: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-execute\");\r\n\r\n        return $.create({\r\n            url: url,\r\n            data: params,\r\n            contentType: \"application/x-www-form-urlencoded\"\r\n        });\r\n    },\r\n\r\n    deletePlan: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-delete\");\r\n\r\n        return $.destroy({\r\n            url: url.replace(\"{idPlan}\", params.id),\r\n            data: params,\r\n            contentType: \"application/x-www-form-urlencoded\"\r\n        });\r\n    },\r\n\r\n    closePlan: function (params) {\r\n\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-close\");\r\n\r\n        return $.create({\r\n            url: url,\r\n            data: params,\r\n            contentType: \"application/x-www-form-urlencoded\"\r\n        });\r\n    },\r\n\r\n    getWorkitemsPlan: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-workitems\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getTransitionsByPlan: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-transitions-get\");\r\n\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    editActivityPlan: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n\r\n        if (params.activity) {\r\n            data = params.activity;\r\n            data.items = params.items;\r\n        } else {\r\n            data = params;\r\n        }\r\n\r\n        var url = self.serviceLocator.getUrl(\"project-plan-activity-edit\").replace(\"{idPlan}\", data.idPlan).replace(\"{id}\", data.id);\r\n\r\n        return $.update({\r\n            url: url,\r\n            data: JSON.stringify(data),\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getPlanByParent: function (data) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-get-by-parent\");\r\n        var def = $.Deferred();\r\n\r\n        $.when($.read({\r\n            url: url,\r\n            data: data,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        })).done(function (response) {\r\n            def.resolve(response);\r\n        });\r\n\r\n        return def.promise();\r\n\r\n    },\r\n\r\n    getItemsByActivity: function (params) {\r\n        var self = this;\r\n        var url = self.serviceLocator.getUrl(\"project-plan-activity-tasks-get\");\r\n        return $.read({\r\n            url: url,\r\n            data: params,\r\n            dataType: \"json\",\r\n            contentType: \"application/json\"\r\n        });\r\n    },\r\n\r\n    getPlanParent: function (data) {\r\n        var self = this,\r\n            url = self.serviceLocator.getUrl(\"project-plan-parent\");\r\n        return $.read({\r\n            url: url,\r\n            data: data,\r\n            dataType: \"json\"\r\n        });\r\n    },\r\n    /**\r\n     * Serializador de servicio de entitiData\r\n     * @param data\r\n     * @returns {*}\r\n     */\r\n    serializeEntityData: function (data) {\r\n        var serializedData = data;\r\n        serializedData.entities = [];\r\n\r\n        /**\r\n         * build the return object.\r\n         * @param header\r\n         * @param row\r\n         * @returns {{data: {}, guid: *, surrogateKey: *, timestamp: *}}\r\n         * @private\r\n         */\r\n        function _buildNewObject(header, row) {\r\n            var newObject = {\r\n                    data: {},\r\n                    guid: row.guidEntity,\r\n                    timestamp: header.timestamp\r\n                },\r\n                columns = header.columns,\r\n                rowData = row.row;\r\n\r\n            for (name in row) {\r\n                if (row.hasOwnProperty(name) && name.toString() !== \"row\" && name.toString() !== \"id\") {\r\n                    newObject[name] = row[name];\r\n                }\r\n            }\r\n\r\n            for (var i = 0, len = columns.length; i < len; i += 1) {\r\n                newObject.data[columns[i]] = rowData[i];\r\n            }\r\n\r\n            return newObject;\r\n        };\r\n\r\n        var k = -1, kRow;\r\n        while (kRow = data.rows[++k]) {\r\n            var i = -1, iCell;\r\n            while (iCell = data.cells[++i]) {\r\n                if (iCell.id === kRow.id) {\r\n                    var kReturnObject = _buildNewObject(iCell, kRow);\r\n                    serializedData.entities.push(kReturnObject);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return serializedData;\r\n    },\r\n\r\n  \r\n});","/*\r\n *   Name: BizAgi Rendering Services\r\n *   Author: Diego Parra (based on Edward Morales version)\r\n *   Comments:\r\n *   -   This class will provide a facade to access to workportal REST services\r\n */\r\n\r\nbizagi.workportal.services.service.extend(\"bizagi.workportal.services.service\", {}, {\r\n    /*\r\n     *   Constructor\r\n     */\r\n    init: function(params) {\r\n        // Call base\r\n        var self = this;\r\n        self.shouldSynchronize = !(bizagi.util.isNativePluginSupported() && bizagi.util.isiOSSmartphoneDevice() && params.module !== \"offlineServices\");\r\n\r\n        self.isOfflineFormsV2Supported =  bizagi.util.isOfflineFormsV2Supported();\r\n        self._super(params);\r\n\r\n        // Create instance of database services\r\n        if(!params.oldOfflineServicesAlreadyEnabled){\r\n            self.database = typeof (bizagi.workportal.services.db) !== \"undefined\" && !bizagi.util.isSharepointContext() ? new bizagi.workportal.services.db() : null;\r\n\r\n            self.enableOfflineEvents();\r\n        }        \r\n\r\n        if(self.isOfflineFormsV2Supported){\r\n            //Workflow context let us access to rendering services to retrieve offline forms\r\n            params.context=\"workflow\";\r\n            params.database = self.database;\r\n            self.renderDataService = typeof(bizagi.render.services.service) !== \"undefined\"\r\n                ? new bizagi.render.services.service(params): bizagi.render.services.service;            \r\n\r\n            if (bizagi.util.isNativePluginSupported() && bizagi.getNativeComponent() === \"offline\") {\r\n                bizagiapp.offlineModuleReady();\r\n            }\r\n\r\n            self.fetchWorker = new bizagi.workportal.services.fetchWorker(this);\r\n            self.pullWorker = new bizagi.workportal.services.pullWorker(this);\r\n\t\t\t\t\t\t\t\t\t\t  \r\n            if(self.shouldSynchronize){\r\n            \tself.configureOfflineHandlers();\r\n            }\r\n        }\r\n        \r\n    },\r\n\r\n    /**\r\n     * Configure events handler specifically for native devices\r\n     * @returns {}\r\n     */\r\n    configureOfflineHandlers: function () {\r\n\r\n        var self = this;\r\n\r\n        $(document).on(\"fetch-offline-processes\", function() {\r\n            self.fetchOfflineData();\r\n        });\r\n\r\n\r\n        $(document).on(\"get-offline-categories\", function(e,params) {\r\n            console.log(params);\r\n            params = params || {};\r\n            params.enableOfflineForm = true;\r\n            $.when( self.getCategories(params) ).done(function(resp){\r\n                if (bizagi.util.isNativePluginSupported()) {\r\n                    bizagiapp.setOfflineCategories(resp);\r\n                }\r\n            }).fail(function(error){\r\n                return error;\r\n            });\r\n        });\r\n\r\n        $(document).on(\"get-offline-recent-processes\", function() {\r\n            $.when( self.getRecentProcesses() ).done(function(resp){\r\n                if (bizagi.util.isNativePluginSupported()) {\r\n                    bizagiapp.setOfflineRecentProcesses(resp);\r\n                }\r\n            }).fail(function(error){\r\n                return error;\r\n            });\r\n        });\r\n\r\n        $(document).on(\"create-startform-case\",function(e,params) {\r\n\r\n            params = params || {};\r\n            params.categoryName = \"\";\r\n            params.isOfflineForm = true;\r\n\r\n            $.when( self.createNewCase(params)).done( function(resp){\r\n                if (bizagi.util.isNativePluginSupported()) {\r\n                    bizagiapp.openCreatedStartForm(resp);\r\n                }\r\n            }).fail(function(error){\r\n                console.log(\"error creating new offline case\");\r\n            });\r\n        });\r\n\r\n        $(document).on(\"get-offline-cases\", function(e,param){\r\n            var params = {};\r\n            params.enableOfflineForm = true;\r\n            params.inputtray = param;\r\n\r\n            $.when( self.getCasesListBeta(params)).done( function (resp){\r\n                resp.inboxType = param;\r\n                bizagiapp.setOfflineInboxCases(resp);\r\n            }).fail(function(error){\r\n                console.log(\"error gathering offline cases\");\r\n            });\r\n        });\r\n\r\n        $(document).on(\"get-offline-case-workitems\", function(e,params){\r\n            var params = params || {};\r\n            params.isOfflineForm = params.isOfflineForm || true;\r\n            params.idCase = params.idCase || \"\";\r\n\r\n            $.when(self.getWorkitems(params)).done(function(resp){\r\n                if (bizagi.util.isNativePluginSupported()) {\r\n                    bizagiapp.openCreatedStartForm(resp);\r\n                }\r\n            }).fail(function(error){\r\n                console.log(\"error gathering the workITems from the given caseId\");\r\n            });\r\n        });\r\n\r\n        $(document).on(\"delete-offline-case\", function(e,params){\r\n            var params = params || {};\r\n            params.idCase = params.idCase || \"\";\r\n\r\n            $.when(self.deleteCase(params)).done(function(resp){\r\n                if (bizagi.util.isNativePluginSupported()) {\r\n                    bizagiapp.offlineCaseDeleted(\"success\");\r\n                }\r\n            }).fail(function(error){\r\n                bizagiapp.offlineCaseDeleted(\"error\");\r\n                console.log(\"error gathering the workITems from the given caseId\");\r\n            });\r\n        });\r\n\r\n        // Execute this trigger in render on next event\r\n        $(document).off(\"tryPushData.offline\");\r\n        $(document).on(\"tryPushData.offline\", function(e) {\r\n            if (self.online) {\r\n                self.pushOfflineData();\r\n            }\r\n        });\r\n\r\n        $(document).off(\"tryPushCase.offline\");\r\n        $(document).on(\"tryPushCase.offline\", function(event, params) {\r\n            if (self.online && params){\r\n                $.when(self.pullWorker.syncSingleOfflineStartCase(params))\r\n                    .then( function(syncResponse){\r\n                        params.responsePromise.resolve(syncResponse);\r\n                    })\r\n                    .fail( function(syncError){\r\n                        params.responsePromise.reject(syncError);\r\n                    });\r\n            }\r\n        });\r\n\r\n        //Clean databases\r\n        $(document).off(\"cleanDatabases.offline\");\r\n        $(document).on(\"cleanDatabases.offline\", function() {\r\n            $.when(self.database.restartDatabases())\r\n                .done(function(){\r\n                    var isIphoneNative = bizagi.util.isiOSSmartphoneDevice() && bizagi.util.isNativePluginSupported();\r\n                    if(! isIphoneNative ){\r\n                        bizagi.webpart.publish(\"bz-summary-item-clear\");\r\n                        bizagi.webpart.publish(\"bz-update-list-cases\", { updateDataList: true });\r\n                        if(!self.online){\r\n                            $(document).trigger(\"offline.inbox\");\r\n                        }\r\n                    }\r\n                });\r\n        });\r\n\r\n    },\r\n\r\n    enableOfflineEvents: function() {\r\n        var self = this;\r\n\r\n        if (bizagi.isMobileDevice()) {\r\n            if (typeof navigator.connection != \"undefined\") {\r\n                if (typeof (Connection) !== \"undefined\"\r\n                    && (navigator.connection.type == Connection.NONE || navigator.connection.type == \"unknown\")) {\r\n                    self.online = false;\r\n                } else {\r\n                    self.online = true;\r\n                }\r\n            } else {\r\n                var queryString = bizagi.readQueryString();\r\n                var queryoffline = (queryString && queryString[\"online\"]) ? eval(queryString[\"online\"]) : true;\r\n                self.online = queryoffline;\r\n            }\r\n\t\t\t\r\n            $(document).off(\"online.services\");\r\n            $(document).on(\"online.services\", function() {\r\n                self.online = true;\r\n                if(self.isOfflineFormsV2Supported && self.shouldSynchronize) {\r\n                    self.returnOnlineStatus();\r\n                }                \r\n            });\r\n\r\n            $(document).off(\"offline.services\");\r\n            $(document).on(\"offline.services\", function() {\r\n                self.online = false;\r\n            });\r\n\r\n        }\r\n    },\r\n\r\n    returnOnlineStatus: function() {\r\n        var self = this;\r\n        if ( bizagi.util.isNativePluginSupported() && bizagi.util.isiOSSmartphoneDevice()){\r\n            bizagiapp.openSyncDialog();            \r\n            $.when(self.pushOfflineData()).always(function(pushStatus) {\r\n                self.fetchOfflineData(pushStatus);\r\n            });\r\n        }else{\r\n            if ( bizagi.util.isNativePluginSupported() && bizagi.util.isOfflineFormsV2Supported()){\r\n                bizagiapp.openSyncDialog();\r\n            }\r\n            $.when(self.logoutUser()).always(function() {\r\n                $.when(self.authenticatedUser()).always(function() {\r\n                    $.when(self.pushOfflineData()).always(function(pushStatus) {\r\n                        $.when(self.fetchOfflineData(pushStatus))\r\n                        .always( function(){\r\n                            bizagi.webpart.publish(\"bz-update-list-cases\", { updateDataList: true });\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n        }        \r\n    },\r\n\r\n    /*\r\n     * Get all data from server : new case structure, forms data\r\n     */\r\n    fetchOfflineData: function( pushStatus) {\r\n        var self = this;\r\n        if(!self.isOfflineFormsV2Supported){\r\n            return;\r\n        }\r\n        var message = \"\";\r\n        var isPushSuccess = pushStatus == true;\r\n\r\n        $.when(self.fetchWorker.fetch()).done(function(data) {\r\n            showSyncMessage(isPushSuccess);\r\n        }).fail(function(data) {\r\n            showSyncMessage(false);\r\n        });\r\n\r\n        function showSyncMessage(success){\r\n            var message = bizagi.util.isValidResource(\"workportal-mobile-offline-sync-successful\")\r\n                ? bizagi.localization.getResource(\"workportal-mobile-offline-sync-successful\")\r\n                : \"Synchronization successful\";\r\n            var type = \"success\";\r\n            if(!success){\r\n                message = bizagi.util.isValidResource(\"workportal-mobile-offline-sync-fail\")\r\n                        ? bizagi.localization.getResource(\"workportal-mobile-offline-sync-fail\")\r\n                        : \"Synchronization failed\";\r\n                type = \"error\";\r\n            }\r\n            if ( bizagi.util.isNativePluginSupported() ){\r\n                bizagiapp.synchronizationFinished(type);\r\n            }\r\n            else {\r\n                bizagi.util.showNotification({ text: message, type: type });\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n     * put all data to server : new case structure, forms data\r\n     */\r\n    pushOfflineData: function() { \r\n        var self = this;\r\n        if(!self.isOfflineFormsV2Supported){\r\n            return;\r\n        }\r\n        return self.pullWorker.pull();    \r\n    },\r\n    /*\r\n     *   Gets the current working user\r\n     */\r\n    getCurrentUser: function(params) {\r\n        var self = this;\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n\r\n            // Call ajax and returns promise\r\n            // save this response in the local storage and get when offline\r\n            var data = {\r\n                idUser: 1,\r\n                user: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                domain: typeof (BIZAGI_DOMAIN) !== \"undefined\" ? BIZAGI_DOMAIN : \"domain\",\r\n                delegateUserName: \"\",\r\n                idDelegateUser: -1,\r\n                groupSeparator: \",\",\r\n                language: \"en-US\",\r\n                decimalSeparator: \".\",\r\n                decimalDigits: \"2\",\r\n                symbol: \"$\",\r\n                ShortDateFormat: \"M/d/yyyy\",\r\n                TimeFormat: \"h:mm tt\",\r\n                LongDateFormat: \"dddd, MMMM d, yyyy\",\r\n                twoDigitYearMax: 2029,\r\n                twoDigitYearMaxDelta: 13,\r\n                uploadMaxFileSize: \"1048576\",\r\n                isMultiOrganization: \"false\",\r\n                associatedStakeholders: [],\r\n                sUserProperties : []\r\n            };\r\n\r\n            defer.resolve(data);\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     *   Return all the available processes in bizagi\r\n     */\r\n    getAllProcesses: function(params) {\r\n        var self = this;\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n        if (params.inputtray == \"inbox\") {\r\n            return self._super(params);\r\n        } else {\r\n            return $.when(self.database.getAllProcesses(params)).pipe(function(response) {\r\n                response = JSON.parse(response);\r\n                // Aggrupate workflows by categories\r\n                if (!!params.skipAggrupate)\r\n                    return response;\r\n                var responseData = {};\r\n                var categories = {};\r\n                var allProcesses = bizagi.localization.getResource(\"workportal-widget-inbox-all-processes\");\r\n                var allCases = {\r\n                    name: bizagi.localization.getResource(\"workportal-widget-inbox-all-cases\"),\r\n                    path: \"\",\r\n                    category: allProcesses,\r\n                    isFavorite: (params.onlyFavorites || false),\r\n                    guidFavorite: \"\",\r\n                    idworkflow: \"\",\r\n                    guidWFClass: \"\",\r\n                    count: 0\r\n                };\r\n\r\n                // Create a default category\r\n                categories[allProcesses] = [];\r\n                categories[allProcesses].workflows = [];\r\n                categories[allProcesses].workflows.push(allCases);\r\n                if (response.workflows) {\r\n                    $.each(response.workflows.workflow, function(i, workflow) {\r\n                        // Creates the category if it doesn't exist\r\n                        if (!categories[workflow.category]) {\r\n                            categories[workflow.category] = [];\r\n                            categories[workflow.category].workflows = [];\r\n                        }\r\n\r\n                        // Push the workflow\r\n                        categories[workflow.category].workflows.push(workflow);\r\n\r\n                        // Sum the cases count\r\n                        allCases.count += Number(workflow.count);\r\n                    });\r\n                }\r\n\r\n                // Build result array once grouped\r\n                responseData.categories = [];\r\n                for (key in categories) {\r\n                    responseData.categories.push({\r\n                        name: key,\r\n                        workflows: categories[key].workflows\r\n                    });\r\n                }\r\n                return responseData;\r\n            });\r\n\r\n        }\r\n    },\r\n    /*\r\n     *   Returns all the cases for the current user filtered by a workflow\r\n     */\r\n    getCasesByWorkflow: function(params) {\r\n        var self = this;\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (params.inputtray === \"inbox\") {\r\n            if (self.online) {\r\n                return self._super(params);\r\n            } else {\r\n                var defer = new $.Deferred();\r\n                $.when(self.getCustomizedColumnsDataTasks(params)).pipe(function(response) {\r\n                    response = JSON.parse(response);\r\n                    $.each(response.cases.rows, function(key, value) {\r\n                        var newFieldsValue = [];\r\n\r\n                        //  Set id of case to radnumber\r\n                        response.cases.rows[key][\"radnumber\"] = value.id;\r\n                        $.each(value.fields, function(fieldsKey, fieldsValue) {\r\n                            // when delete element from fields array, each function lose key value\r\n                            if (fieldsValue != undefined) {\r\n                                // Radnumber\r\n                                try {\r\n                                    if (fieldsValue.isRadNumber != undefined && fieldsValue.isRadNumber == \"true\") {\r\n                                        response.cases.rows[key][\"radnumber\"] = fieldsValue.Value;\r\n                                    } else if (fieldsValue.workitems != undefined) {\r\n                                        response.cases.rows[key][\"workitems\"] = fieldsValue.workitems;\r\n                                    } else {\r\n                                        newFieldsValue.push(fieldsValue);\r\n                                    }\r\n                                } catch (e) {\r\n                                }\r\n                            }\r\n                        });\r\n\r\n                        // Update Fields\r\n                        response.cases.rows[key]['fields'] = newFieldsValue;\r\n                    });\r\n                    defer.resolve(response.cases);\r\n                });\r\n                return defer.promise();\r\n\r\n            }\r\n        } else {\r\n            var defer = new $.Deferred();\r\n            $.when(self.database.getCustomizedColumnsData(params)).pipe(function(response) {\r\n                response = JSON.parse(response);\r\n                $.each(response.cases.rows, function(key, value) {\r\n                    var newFieldsValue = [];\r\n\r\n                    //  Set id of case to radnumber\r\n                    response.cases.rows[key][\"radnumber\"] = value.id;\r\n                    $.each(value.fields, function(fieldsKey, fieldsValue) {\r\n                        // when delete element from fields array, each function lose key value\r\n                        if (fieldsValue != undefined) {\r\n                            // Radnumber\r\n                            try {\r\n                                if (fieldsValue.isRadNumber != undefined && fieldsValue.isRadNumber == \"true\") {\r\n                                    response.cases.rows[key][\"radnumber\"] = fieldsValue.Value;\r\n                                } else if (fieldsValue.workitems != undefined) {\r\n                                    response.cases.rows[key][\"workitems\"] = fieldsValue.workitems;\r\n                                } else {\r\n                                    newFieldsValue.push(fieldsValue);\r\n                                }\r\n                            } catch (e) {\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    // Update Fields\r\n                    response.cases.rows[key]['fields'] = newFieldsValue;\r\n                });\r\n                defer.resolve(response.cases);\r\n            });\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     * Get columns data from offline tasks\r\n     */\r\n    getCustomizedColumnsDataTasks: function(params) {\r\n        var self = this;\r\n        var deferred = new $.Deferred();\r\n\r\n        var cases = {\r\n            \"cases\": {\r\n                \"rows\": [],\r\n                \"totalPages\": 1,\r\n                \"page\": 1,\r\n                \"lstIdCases\": []\r\n            }\r\n        };\r\n\r\n        if (params.radnumber || params.radNumber) {\r\n            params[\"radNumber\"] = params.radnumber ? params.radnumber : params.radNumber;\r\n        }\r\n\r\n        if (params.idcase || params.idCase) {\r\n            params[\"radNumber\"] = params.idcase ? params.idcase : params.idCase;\r\n        }\r\n\r\n\r\n\r\n        $.when(self.database.getOfflineCases({isOpen: true}))\r\n            .pipe(function(resp) {\r\n                tasks = resp.elements;\r\n                for (var i = 0, len = tasks.length; i < len; i++) {\r\n                    var currTask = tasks[i];\r\n                    if (typeof (params.radNumber) === \"undefined\" || params.radNumber.toString() === \"\"\r\n                        || params.radNumber.toString() === currTask[0]) {\r\n                        var localCase = {\r\n                            id: currTask[0],\r\n                            idWFClass: currTask[10],\r\n                            idWorkFlow: currTask[10],\r\n                            taskState: currTask.taskState,\r\n                            isFavorite: currTask[9],\r\n                            isEdited: currTask.isEdited,\r\n                            offlineType: 'task',\r\n                            //guidFavorite: currTask.guidfavorite.value,\r\n                            isOpen: true,\r\n                            isOfflineForm: true,\r\n                            fields: [\r\n                                {\r\n                                    Value: currTask.wfclsdisplayname,\r\n                                    DisplayName: currTask.wfclsdisplayname,\r\n                                    DataType: \"VarChar\",\r\n                                    isRadNumber: false\r\n                                }, {\r\n                                    Value: currTask[12],\r\n                                    DisplayName: \"Process creation date\",\r\n                                    DataType: \"DateTime\",\r\n                                    isRadNumber: false\r\n                                }\r\n                            ]\r\n                        };\r\n                        cases.cases.rows.push(localCase);\r\n                        cases.cases.lstIdCases.push(currTask[0]);\r\n                    }\r\n                }\r\n\r\n                // Update counter\r\n                cases.cases.totalPages = cases.cases.page = cases.cases.rows.length > 0 ? 1 : 0;\r\n\r\n                deferred.resolve(JSON.stringify(cases));\r\n            });\r\n\r\n        return deferred.promise();\r\n    },\r\n    /*\r\n     *  Get Menu Authorization\r\n     */\r\n    getMenuAuthorization: function() {\r\n        var self = this;\r\n\r\n        if (self.online) {\r\n            return self._super();\r\n        } else {\r\n            // Call ajax and returns promise\r\n            var defer = new $.Deferred();\r\n            var data = {\r\n                \"permissions\": [\r\n                    { \"Cases\": [\"NewCase\", \"Pending\", \"Closed\", \"Search\"] },\r\n                    {\r\n                        \"AnalysisReports\": [\r\n                            \"BAMProcess\", \"BAMTask\", \"AnalyticsProcess\", \"AnalyticsTask\", \"AnalyticsSensor\",\r\n                            \"AnalysisQueries\", \"BAMResourceMonitor\"\r\n                        ]\r\n                    }, {\r\n                        \"Admin\": [\r\n                            \"UserAdmin\", \"Licenses\", \"EntityAdmin\", \"CaseAdmin\", \"AlarmAdmin\", \"EncryptionAdmin\",\r\n                            \"MobileUpdatesAdmin\", \"AsynchronousWorkitemRetries\", \"UserPendingRequests\",\r\n                            \"AuthenticationLogQuery\", \"BusinessPolicies\", \"Profiles\", \"UserDefaultAssignation\",\r\n                            \"GRDimensionAdmin\", \"ThemeBuilder\"\r\n                        ]\r\n                    }, { \"CurrentUserAdministration\": [\"CurrentUser\"] }, { \"LogOut\": [] }, { \"Search\": [] },\r\n                    { \"SmartFolders\": [] }, { \"CustomFolders\": [] }, { \"BizagiQueries\": [] }, { \"AnalysisQueries\": [] },\r\n                    { \"StateLog\": [] }, { \"PrintableVersion\": [] }\r\n                ]\r\n            };\r\n\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     *   Gets the inbox summary for the current logged user\r\n     *   Returns a promise of the data being retrieved\r\n     */\r\n    getInboxSummary: function(params) {\r\n        var self = this;\r\n        var enableDefaultMethod = self.online;\r\n        if (params && (params.inputtray == \"false\" || params.inputtray == \"true\")) {\r\n            enableDefaultMethod = false;\r\n        }\r\n        if (enableDefaultMethod) {\r\n            return self._super(params);\r\n        } else {\r\n            // Call ajax and returns promise\r\n            var defer = new $.Deferred();\r\n            $.when('{\"inboxSummary\":{\"Red\":7,\"Yellow\":0,\"Green\":0,\"Black\":0,\"All\":7}}').pipe(function(response) {\r\n                var data = JSON.parse(response);\r\n                defer.resolve(data[\"inboxSummary\"]);\r\n            });\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     *   Returns the available categories filtered by a parent category\r\n     *   If not parent category is sent, it will return the base categories\r\n     */\r\n    getCategories: function(params) {\r\n        var self = this;\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            // Define data\r\n            params = params || {};\r\n            var data = {};\r\n\r\n            // Required params\r\n            if (params.idCategory)\r\n                data[\"idCategory\"] = params.idCategory;\r\n            if (params.idApp)\r\n                data[\"idApp\"] = params.idApp;\r\n\r\n            data[\"enableOfflineForm\"] = params.enableOfflineForm || false;\r\n\r\n\r\n            data[\"groupByApp\"] = params.groupByApp || false;\r\n\r\n            // Call ajax and returns promise\r\n            return self.database.getCategories(data);\r\n        }\r\n    },\r\n\r\n    /*\r\n     * CREATE NEW CASES\r\n     */\r\n    createNewCase: function(params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n            return self.database.createNewCase(params);\r\n        }\r\n    },\r\n\r\n    getWorkitems: function(params) {\r\n        var self = this;\r\n\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n\r\n            if (bizagi.util.isNativePluginSupported() && typeof (bizagiapp.getCase) !== \"undefined\") {\r\n                return self.getNativeWorkItems(params);\r\n            } else {\r\n                return self.database.getWorkitems(params);\r\n            }\r\n\r\n        }\r\n    },\r\n\r\n    getNativeWorkItems: function(params){\r\n        var defer = new $.Deferred();\r\n\r\n        bizagiapp.getCase(params.idCase, function(response){\r\n\r\n            var workItems = JSON.parse(response);\r\n\r\n            defer.resolve(workItems);\r\n\r\n        }, function(response){\r\n            defer.reject(response);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    getCaseSummary: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n\r\n            return self.database.getSummary(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n     *   Delete offline cases created localy\r\n     *   return a promise\r\n     */\r\n    deleteCase: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        return self.database.deleteCase(params);\r\n    },\r\n\r\n    /*\r\n     *   Get subprocesses\r\n     *   return a promise\r\n     */\r\n    getCaseSubprocesses: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n            defer.resolve({ subProcesses: [] });\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * This service get all overrides keys within configuration project\r\n     *\r\n     * @return {json}\r\n     */\r\n    getOverrides: function() {\r\n        return {};\r\n    },\r\n\r\n    /**\r\n     * Return all the available cases in bizagi and thinking for mobile response\r\n     * @param {} params: inputtray:  inbox | outbox-new | outbox-finished | drafts \r\n     * @returns {}\r\n     */\r\n    getCasesListBeta: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (params.inputtray === \"inbox\") {\r\n            if (self.online) {\r\n                var _super = self._super.bind(self);\r\n                var responsePromise = new $.Deferred();\r\n                var fetchPromise = self.isOfflineFormsV2Supported ? self.fetchWorker.fetch() : false;\r\n                $.when(fetchPromise)\r\n                .always(function( fetchResponse) {\r\n                    $.when(_super(params))\r\n                    .then(function (superResponse){\r\n                        responsePromise.resolve(superResponse);\r\n                    })\r\n                    .fail( function(superError){\r\n                        responsePromise.reject(superError);\r\n                    });\r\n                });\r\n                return responsePromise.promise();             \r\n            } else {\r\n                //Bring work items from db that contain offlineform\r\n                var deferred = new $.Deferred();\r\n                $.when(self.database.getOfflineCases({isOpen: true}))\r\n                    .pipe(function(tasks) {\r\n                        var taskFeedData = self.getTaskFeedData(tasks);\r\n                        deferred.resolve(taskFeedData);\r\n                    });\r\n\r\n                return deferred.promise();\r\n            }\r\n        } else if(params.inputtray === \"drafts\" || params.inputtray === \"outbox-new\"){\r\n            \r\n            var defer = new $.Deferred();\r\n            $.when(self.database.getCasesList(params))\r\n                .pipe(function(response) {\r\n                    var taskFeedData = self.getTaskFeedData(response);\r\n                    defer.resolve(taskFeedData);\r\n                });\r\n\r\n            return defer.promise();\r\n        } else {\r\n            var defer = new $.Deferred();            \r\n            $.when(self.database.getOfflineCases({isOpen: false}))\r\n                .pipe(function(tasks) {\r\n                    var taskFeedData = self.getTaskFeedData(tasks);\r\n                    defer.resolve(taskFeedData);\r\n                });\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    getMobileCasesList: function(params) {\r\n        var self = this;\r\n\r\n        if (params.inputtray === \"inbox\") {\r\n            return self._super(params);\r\n        } else {\r\n            return getCasesListBeta(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n     * Customize Columns\r\n     */\r\n    getTaskFeedData: function(response) {\r\n        var overdue = bizagi.localization.getResource(\"workportal-taskfeed-overdue\");\r\n        var today = bizagi.localization.getResource(\"workportal-taskfeed-today\");\r\n        var tomorrow = bizagi.localization.getResource(\"workportal-taskfeed-tomorrow\");\r\n        var upcoming = bizagi.localization.getResource(\"workportal-taskfeed-upcomming\");\r\n\r\n        var groupedData = {\r\n            elements: [],\r\n            page: response.page,\r\n            totalPages: response.totalPages,\r\n            advanceSearch: false\r\n        };\r\n\r\n        var actualDate = new Date();\r\n        var actualMonth = actualDate.getMonth();\r\n        var actualDay = actualDate.getDate();\r\n        var actualYear = actualDate.getFullYear();\r\n\r\n        for (var counter = 0; response.elements.length > counter; counter++) {\r\n            var tmpElement = response.elements[counter];\r\n            if(tmpElement.offlineType !== undefined && tmpElement.offlineType === \"task\")\r\n                tmpElement[3] = tmpElement.endDate;\r\n            var status = {};\r\n\r\n            var originalEndDate = tmpElement[3];\r\n\r\n            if (tmpElement[3] !== \"\") {\r\n                var tmpdate = new Date(tmpElement[3]);\r\n                var tmpDay = tmpdate.getDate();\r\n                var tmpMonth = tmpdate.getMonth();\r\n                var tmpYear = tmpdate.getFullYear();\r\n                var dateDiff = ((new Date(tmpYear, tmpMonth, tmpDay, 0, 0, 0)\r\n                - new Date(actualYear, actualMonth, actualDay, 0, 0, 0)));\r\n\r\n                if (dateDiff < 0) {\r\n                    tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]),\r\n                        \"MMMM dd | hh:mm tt\");\r\n                    status = { group: \"1|\" + overdue, state: \"red\", type: \"overdue\", icon: \"overdue\" };\r\n                } else {\r\n                    if (actualMonth === tmpMonth && actualDay === tmpDay) {\r\n                        tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm tt\");\r\n\r\n                        // Define if the case is overdue\r\n                        if (tmpdate.getTime() < actualDate.getTime()) {\r\n                            status = {\r\n                                group: \"2|\" + today + \", \"\r\n                                + bizagi.util.dateFormatter.formatDate(actualDate, \"MMMM dd\"),\r\n                                state: \"red\",\r\n                                type: \"today\",\r\n                                icon: \"overdue\"\r\n                            };\r\n                        } else {\r\n                            status = {\r\n                                group: \"2|\" + today + \", \"\r\n                                + bizagi.util.dateFormatter.formatDate(actualDate, \"MMMM dd\"),\r\n                                state: \"yellow\",\r\n                                type: \"today\",\r\n                                icon: \"ontime\"\r\n                            };\r\n                        }\r\n                    } else if (actualMonth === tmpMonth && (actualDay + 1) === tmpDay) {\r\n                        tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm tt\");\r\n                        status = {\r\n                            group: \"3|\" + tomorrow + \", \"\r\n                            + bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"MMMM dd\"),\r\n                            state: \"yellow\",\r\n                            type: \"tomorrow\",\r\n                            icon: \"ontime\"\r\n                        };\r\n                    } else {\r\n                        tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"MMMM dd | hh:mm tt\");\r\n                        status = { group: \"4|\" + upcoming, state: \"green\", type: \"upcoming\", icon: \"upcoming\" };\r\n                    }\r\n                }\r\n            } else {\r\n                tmpElement[3] = \"--\";\r\n                status = { group: \"1|\" + overdue, state: \"red\", type: \"overdue\", icon: \"overdue\" }\r\n            }\r\n\r\n            groupedData.elements.push($.extend({}, tmpElement, status,\r\n                { \"endDate\": originalEndDate, \"idworkitem\": tmpElement[1] }));\r\n        }\r\n\r\n        return groupedData;\r\n    },\r\n\r\n    /*\r\n     * Render Details\r\n     * @param idWorkitem\r\n     */\r\n    summaryCaseDetails: function(options) {\r\n        var self = this;\r\n        var params = options || {};\r\n\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (!params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n            var def = $.Deferred();\r\n            var idWorkitem = options[\"idWorkitem\"] || 0;\r\n\r\n            $.when(self.getCaseSummaryDataContent(options))\r\n                .done(function(data) {\r\n\r\n                    data.currentState = data.currentState || [];\r\n                    var dataCurrentStateLength = data.currentState.length;\r\n\r\n                    // Show or hide tabs\r\n                    data[\"showEvents\"] = (data[\"countEvents\"] >= 1) ? true : false;\r\n                    data[\"showParentProcess\"] = (data[\"idParentCase\"] >= 1) ? true : false;\r\n                    data[\"parentProcess\"] = {\r\n                        'displayName': data[\"parentDisplayName\"],\r\n                        'idCase': data[\"idParentCase\"]\r\n                    };\r\n\r\n                    data[\"isClosed\"] = (data[\"isOpen\"] == \"true\") ? false : true;\r\n                    data[\"showAssignees\"] = (data[\"countAssigness\"] >= 1) ? true : false;\r\n                    data[\"showSubProcess\"] = (data[\"countSubProcesses\"] >= 1) ? true : false;\r\n                    data[\"showForm\"] = (data[\"hasGlobalForm\"] == \"true\") ? true : false;\r\n                    data[\"allowsReassign\"] = \"false\";\r\n\r\n                    for (var i = 0; i < dataCurrentStateLength; i++) {\r\n                        if (data[\"currentState\"][i][\"idWorkItem\"] == idWorkitem) {\r\n                            data[\"allowsReassign\"] = data[\"currentState\"][i][\"allowsReassign\"];\r\n                        }\r\n                    }\r\n\r\n                    // edit original data, no show events in activities tab\r\n                    var currentStateTypes = [];\r\n                    var m = 0; // counter for new activities array\r\n                    for (var j = 0; j < data[\"currentState\"].length; j++) {\r\n                        if (data[\"currentState\"][j][\"isEvent\"] == \"false\" &&\r\n                            data[\"currentState\"][j][\"assignToCurrentUser\"] == \"true\" &&\r\n                            data[\"currentState\"][j][\"idWorkItem\"] != idWorkitem) {\r\n                            currentStateTypes[m++] = data[\"currentState\"][j];\r\n                        }\r\n                    }\r\n\r\n                    data[\"currentStateTypes\"] = currentStateTypes;\r\n                    data[\"showActivities\"] = (currentStateTypes.length >= 1) ? true : false;\r\n\r\n                    def.resolve(data);\r\n                });\r\n\r\n            return def.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     *  Get json from cases service\r\n     */\r\n    getCaseSummaryDataContent: function(options) {\r\n        var self = this;\r\n        var promise = new $.Deferred();\r\n\r\n        $.when(self.getCaseSummary(options))\r\n            .done(function(data) {\r\n                // Completes data\r\n                data.taskState = self.icoTaskState;\r\n                data.process = data.process ? data.process : \"\";\r\n\r\n                if (data.createdBy) {\r\n                    data.createdByName = data.createdBy.Name;\r\n                    data.createdByUserName = data.createdBy.userName;\r\n                    data.caseDescription = (data.caseDescription == '' ? '' : data.caseDescription);\r\n                    data.processPath = data.processPath.replace(/\\//g, ' > ') + data.process;\r\n                    data.showWorkOnIt = true;\r\n                }\r\n\r\n                promise.resolve(data);\r\n            });\r\n        return promise.promise();\r\n    },\r\n\r\n    /*\r\n     *   Returns the data for the inbox grid view\r\n     */\r\n    getCustomizedColumnsData: function(params) {\r\n        var self = this;\r\n\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (params.inputtray === \"inbox\") {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n\r\n            $.when(self.database.getCustomizedColumnsNewData(params))\r\n                .pipe(function(response) {\r\n                    defer.resolve(JSON.parse(response));\r\n                });\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n     *   Returns the recent process\r\n     */\r\n    getRecentProcesses: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            return self.database.getRecentProcesses(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n     *   Start process in BizAgi\r\n     */\r\n    startProcess: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n\r\n            var data = {\r\n                hasStartForm: false,\r\n                idProcess: params.idProcess,\r\n                displayName: params.displayName,\r\n                caseInfo: {}\r\n            }\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get stakeholder shortCurts\r\n     * @param {} params\r\n     * @returns {}\r\n     */\r\n    getShortCuts: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the available list of searches\r\n     * @returns {}\r\n     */\r\n    getSearchLists: function() {\r\n        var self = this;\r\n\r\n        if (self.online) {\r\n            return self._super();\r\n        } else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get the icon of a given collection\r\n     * @param params\r\n     */\r\n    getCollectionIcon: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (self.online) {\r\n            return self._super(params);\r\n        } else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the recent process\r\n     * @param {} params\r\n     * @returns {}\r\n     */\r\n    getRecentOfflineProcesses: function (params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        // Call ajax and returns promise\r\n        return $.read(self.serviceLocator.getUrl('process-handler-getRecentProcesses'), params)\r\n            .then(function (data) {\r\n\r\n                var processes = data[\"processes\"] || [];\r\n                var recentProcess = {\"processes\": []};\r\n\r\n                if (!bizagi.util.isObjectEmpty(processes)) {\r\n                    var item;\r\n                    var counter = -1;\r\n                    while ((item = processes[++counter])) {\r\n                        if (item.hasOfflineForm) {\r\n                            recentProcess.processes.push(item);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                return recentProcess;\r\n            });\r\n    },\r\n\r\n    downloadImage: function(params, form, imageRenderControl){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n\r\n        var getPropertyDataParams = {\r\n            prepare: false,\r\n            xpath: imageRenderControl.xpath,\r\n            idRender: imageRenderControl.renderId,\r\n            xpathContext: \"\",\r\n            idPageCache: form.pageCacheId,\r\n            sessionId : form.sessionId,\r\n            property: \"fileFullContent\"\r\n        };\r\n\r\n        $.when(self.renderDataService.getPropertyData(getPropertyDataParams))\r\n            .done( function (base64Image){\r\n\r\n                if(base64Image && base64Image !== \"\"){\r\n                    var saveParams = {\r\n                        id: imageRenderControl.xpath,\r\n                        idCase: params.idCase,\r\n                        idWorkitem: params.idWorkitem,\r\n                        operationType: \"synchronization\"\r\n                    };\r\n                    $.when(self.database.saveActivityFormImage( saveParams, base64Image))\r\n                        .done( function(resp){\r\n                            def.resolve(resp);\r\n                        })\r\n                        .fail(function (err) {\r\n                            def.reject(err);\r\n                        });\r\n                }\r\n                else{\r\n                    def.resolve();\r\n                }\r\n            })\r\n            .fail(function(error){\r\n                def.reject(error);\r\n            });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    downloadBinaryFile: function( form, uploadControl, fileId, fileName ){\r\n        var self = this;\r\n        var def = new $.Deferred();def\r\n        var getFileUrlParams = {\r\n            xpath: uploadControl.xpath,\r\n            idRender: uploadControl.renderId,\r\n            xpathContext: \"\",\r\n            idPageCache: form.form.pageCacheId,\r\n            fileId : fileId,\r\n            sessionId: form.form.sessionId\r\n        };\r\n\r\n        //Crear URL\r\n        var fileUrl = self.renderDataService.getUploadFileUrl(getFileUrlParams);\r\n        // var xhr = new XMLHttpRequest();\r\n        // xhr.open(\"GET\", fileUrl);\r\n        // xhr.responseType = \"blob\";\r\n        // xhr.onload = function () {\r\n        //     var blob = this.response;\r\n        //     blob.name = fileName;\r\n        //     def.resolve(blob);\r\n        // };\r\n        // xhr.onerror = function() {\r\n        //     def.resolve(null);\r\n        // }\r\n        // xhr.send();\r\n\r\n        $.ajax({\r\n            url: fileUrl,\r\n            type: \"GET\",\r\n            dataType: \"binary\",\r\n            processData: false //Always false for binary dataType\r\n        }).then(function (binary_file) {\r\n            if (binary_file.type == \"application/json\") {\r\n                var reader = new FileReader();\r\n                reader.onloadend = function () {\r\n                    // reader.result contains the contents of blob as a typed array\r\n                    def.reject({ responseText: reader.result });\r\n                };\r\n                reader.readAsText(binary_file);\r\n            } else {\r\n                if (typeof binary_file == \"string\") {\r\n                    var xhr = arguments[2];\r\n                    var contentType = xhr.getResponseHeader('Content-type');\r\n                    binary_file = self.byteArrayToBlob(self.stringToByteArray(binary_file), contentType);\r\n                }\r\n                binary_file.name = fileName;\r\n                def.resolve(binary_file);\r\n            }\r\n        }).fail(function (error) {\r\n            def.reject(error);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n\r\n    downloadFilesInUploadControl: function(params, form, uploadControl, promisesArray){\r\n        var self = this;\r\n        if(uploadControl.value && Array.isArray(uploadControl.value)){\r\n            uploadControl.value.forEach( function(singleFileValue){\r\n                var fileId = singleFileValue[0];\r\n                var fileName = singleFileValue[1];\r\n                promisesArray.push(self.downloadSingleFile(params, form, uploadControl, fileId, fileName));\r\n            });\r\n        }\r\n    },\r\n\r\n    downloadSingleFile: function(params, form, uploadControl, fileId, fileName){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var downloadPromise = self.downloadBinaryFile(form, uploadControl, fileId, fileName);\r\n        $.when(downloadPromise)\r\n            .done( function(binaryFile){\r\n                if(binaryFile){\r\n                    params.operationType = \"synchronization\";\r\n                    params.id = uploadControl.xpath + '.' + fileId;\r\n                    self.renderDataService.saveOfflineFile(params, binaryFile, binaryFile.type);\r\n                }\r\n                def.resolve(binaryFile);\r\n            })\r\n            .fail( function(downloadError){\r\n                def.reject(downloadError);\r\n            });\r\n        return def.promise();\r\n    },\r\n\r\n    convertUploadOnlineValueInOfflineValue: function(uploadControl, data){\r\n        var self = this;\r\n        var offlineValue = [];\r\n        if(uploadControl.value && Array.isArray(uploadControl.value)){\r\n            uploadControl.value.forEach( function(singleFileValue){\r\n                var fileName = singleFileValue[1];\r\n                var fileExtension = bizagi.util.media.getFileExtension(fileName).toLowerCase();\r\n                offlineValue.push(\r\n                    {\r\n                        id: singleFileValue[0],\r\n                        fileName: fileName,\r\n                        mimeType: bizagi.util.media.getMIMETypeByExtension(fileExtension),\r\n                        status: \"existent\"\r\n                    }\r\n                );\r\n            });\r\n        }\r\n        data[uploadControl.xpath] = offlineValue;\r\n    },\r\n\r\n    syncOfflineStartCase: function(params){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n\r\n        var loadFormParams = {\r\n            action: \"LOADSTARTFORM\",\r\n            idProcess : params.idProcess,\r\n            downloadOfflineForm: true\r\n        };\r\n\r\n        $.when(self.renderDataService.getFormData(loadFormParams))\r\n            .then( function(serverResponse) {\r\n                if(serverResponse.errorType){\r\n                    def.reject(serverResponse);\r\n                }\r\n                else if(serverResponse.form){\r\n                    $.when(self.database.separateComplexControls({ offlineType: \"start\" }, params.data))\r\n                        .then( function (separatedCaseData){\r\n                            params.pageCacheId = serverResponse.form.pageCacheId;\r\n                            params.sessionId = serverResponse.form.sessionId;\r\n                            params.offlineType = \"start\";\r\n                            return self.performSyncOfflineCase(params, separatedCaseData, def);\r\n                        })\r\n                        .fail( function(err){\r\n                            def.reject(err);\r\n                        });\r\n                }\r\n                else{\r\n                    def.reject(\"Form not found in server response\");\r\n                }\r\n            })\r\n            .fail( function(getFormErr){\r\n                def.reject(getFormErr);\r\n            });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    performSyncOfflineCase: function(params, sData, promise){\r\n        var self = this;\r\n        var offlineType = params.offlineType;\r\n        var separatedCaseData = sData;\r\n        var data = sData.data;\r\n        var imageValues = separatedCaseData.images;\r\n        var uploadValues = separatedCaseData.uploads;\r\n        var gridValues = separatedCaseData.grids;\r\n        var uploadParams = {\r\n            pageCacheId: params.pageCacheId,\r\n            sessionId: params.sessionId,\r\n            idCase: params.idCase,\r\n            offlineType: offlineType,\r\n            idWorkitem: params.idWorkitem\r\n        };\r\n\r\n        var uploadPromises = [];\r\n        var actions = [];\r\n\r\n        if(uploadValues){\r\n            uploadValues.forEach( function(uploadControlValue){\r\n                self.generateUploadPromisesAndDeleteActionsForFilesInUploadControl(uploadParams,\r\n                    uploadControlValue, uploadPromises, actions);\r\n            });\r\n        }\r\n\r\n        if(imageValues){\r\n            imageValues.forEach( function(imageControlValue){\r\n                self.generateUploadPromiseForImageControl(uploadParams, imageControlValue,\r\n                    uploadPromises);\r\n            });\r\n        }\r\n\r\n        $.when.apply($, uploadPromises)\r\n        .then(function(){\r\n            processMultiAction();\r\n        });\r\n\r\n        function processMultiAction() {\r\n            \r\n            if(gridValues){\r\n                var gridPromises = self.generateGridPromises(gridValues, params.pageCacheId);\r\n                if(gridPromises.bizAdditions && gridPromises.bizAdditions.length> 0)\r\n                    actions = actions.concat(gridPromises.bizAdditions)\r\n                if(gridPromises.bizDeletions && gridPromises.bizDeletions.length> 0)\r\n                    actions = actions.concat(gridPromises.bizDeletions)\r\n                \r\n            } \r\n\r\n            var multiActionData = {};\r\n            for (var key in data) {\r\n                var dataValue = data[key];\r\n                if(dataValue.value !== undefined)\r\n                    multiActionData[key] = dataValue.value;\r\n                else\r\n                    multiActionData[key] = dataValue;\r\n            } \r\n\r\n            var syncAction;\r\n            if ( offlineType === \"start\" )\r\n                syncAction = \"createnewcase\";\r\n            else\r\n                syncAction = data.h_action === \"save\" ? \"trysave\" : \"trynext\";\r\n\r\n            var performActionProm = self.renderDataService.submitData({\r\n                action: syncAction,\r\n                data: multiActionData,\r\n                idPageCache: params.pageCacheId,\r\n                prepare: true,\r\n                transitions: \"\"\r\n            });\r\n            actions.push(performActionProm);\r\n\r\n            $.when(self.renderDataService.multiaction().execute({actions: actions}))\r\n                .done( function(multiactionResponse){\r\n                    console.log('SYNCH: ' + offlineType + ' Case synchronized with server', multiactionResponse);                   \r\n                    if(multiactionResponse.length > 0  && multiactionResponse[multiactionResponse.length-1].result && multiactionResponse[multiactionResponse.length-1].result.type === 'success') {\r\n                        var syncActionTagResponse = multiactionResponse[multiactionResponse.length-1].result;\r\n                        var deleteCasePromise;\r\n                        if(offlineType === \"start\"){\r\n                            deleteCasePromise = self.database.deleteCase(params);\r\n                        }\r\n                        else{\r\n                            deleteCasePromise = self.database.deleteTaskData(params);\r\n                        }\r\n                        $.when(deleteCasePromise)\r\n                            .done( function(deleteResponse){\r\n                                promise.resolve(syncActionTagResponse);\r\n                                console.log('SYNCH: Case data deleted of internal table', deleteResponse);\r\n                            })\r\n                            .fail( function(deleteError){\r\n                                promise.reject(deleteError);\r\n                                console.log('SYNCH: Error deleting Case data of internal table', deleteError);\r\n                            });\r\n    \r\n                        if(offlineType === \"task\"){\r\n                            self.database.deleteTaskForm(params).done( function(delFormResponse){\r\n                                console.log('SYNCH: Task form deleted of internal table', delFormResponse);\r\n                            });\r\n                        }\r\n                    }\r\n                    else {\r\n                        self.database.updateCaseSyncStatus({\r\n                            type: offlineType,\r\n                            id: params.id,\r\n                            syncStatus: \"failed\"\r\n                        });\r\n                        console.log(\"Multiaction not successful\", multiactionResponse);\r\n                        promise.reject(multiactionResponse);\r\n                    }\r\n                    \r\n                })\r\n                .fail( function(multiactionError){\r\n                    self.database.updateCaseSyncStatus({\r\n                        type: offlineType,\r\n                        id: params.id,\r\n                        syncStatus: \"failed\"\r\n                    });\r\n                    console.log(\"Multiaction error\", multiactionError);\r\n                    promise.reject(multiactionError);\r\n                });\r\n        }\r\n    },\r\n\r\n    syncOfflineTaskCase: function(params) {\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var data  = params.data;\r\n        delete params[\"data\"];   \r\n        \r\n        params.downloadOfflineForm = true;     \r\n\r\n        //Retrieve the form from server in order to obtain a valid idPageCache\r\n        var serverFormProm = self.renderDataService.getFormData(params);\r\n        $.when(serverFormProm)\r\n        .then( function(serverResponse) {\r\n            if(serverResponse.errorType){\r\n                return $.when(self.database.updateCaseSyncStatus({\r\n                    type: \"task\",\r\n                    id: params.idCase + \"-\" + params.idWorkitem,\r\n                    syncStatus: \"failed\"\r\n                }))\r\n                .always(function(updateResponse){\r\n                    def.reject(serverResponse);\r\n                });\r\n            }\r\n            else {\r\n                return $.when(self.database.separateComplexControls(params, data))\r\n                .then( function (separatedCaseData){\r\n                    params.pageCacheId = serverResponse.form.pageCacheId;\r\n                    params.sessionId = serverResponse.form.sessionId;\r\n                    params.offlineType = \"task\";\r\n                    params.id = params.idCase + \"-\" + params.idWorkitem;\r\n                    return self.performSyncOfflineCase(params, separatedCaseData, def);\r\n                })\r\n                .fail( function(syncError){\r\n                    def.reject(syncError);\r\n                });\r\n            }\r\n        })\r\n        .fail( function(getFormError){\r\n            def.reject(getFormError);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    generateUploadPromisesAndDeleteActionsForFilesInUploadControl: function(params,\r\n                                                                            uploadControl, uploadPromises, deleteActions){\r\n\r\n        var self = this;\r\n        var files = uploadControl.value;\r\n        if(!files || files.length == 0){\r\n            return;\r\n        }\r\n        files.forEach( function(file){\r\n            var status = file.status;\r\n            if(\"new\" === status){\r\n                var uploadParams = {\r\n                    fileId: file.id,\r\n                    fileName: file.fileName,\r\n                    fileMimeType: file.mimeType\r\n                }\r\n                $.extend(uploadParams, params);\r\n                var uploadPromise  = self.generateFileUploadPromise(uploadParams, uploadControl);\r\n                uploadPromises.push(uploadPromise);\r\n            }\r\n            else if (\"deleted\" === status){\r\n                var deleteParams = {\r\n                    renderId: uploadControl.renderId,\r\n                    xpath: uploadControl.xpath,\r\n                    fileId: file.id,\r\n                    idPageCache: params.pageCacheId\r\n                }\r\n                var deleteAction = self.generateFileDeleteAction(deleteParams);\r\n                deleteActions.push(deleteAction);\r\n            }\r\n        });\r\n    },\r\n\r\n    generateFileUploadPromise: function(params, uploadControl){\r\n        var self = this;\r\n        var uploadDeferred = new $.Deferred();\r\n        var xpath = uploadControl.xpath;\r\n        var attachmentId = xpath + '.' + params.fileId;\r\n\r\n        var getFilePromise;\r\n        var offlineType = params.offlineType;\r\n        if( offlineType && offlineType === \"start\"){\r\n            var getFileParams = {\r\n                id: attachmentId,\r\n                idCase: params.idCase,\r\n                offlineType: offlineType\r\n            };\r\n            getFilePromise = self.renderDataService.getOfflineFile(getFileParams,\r\n                bizagi.util.db.AttachmentType.Blob , params.fileMimeType);\r\n        }\r\n        else{\r\n            var getFileParams = {\r\n                id: attachmentId,\r\n                idCase: params.idCase,\r\n                idWorkitem: params.idWorkitem\r\n            };\r\n            getFilePromise = self.renderDataService.getOfflineActivityDataFile(getFileParams,\r\n                bizagi.util.db.AttachmentType.Blob , params.fileMimeType);\r\n        }\r\n\r\n\r\n        $.when(getFilePromise)\r\n            .done( function(blobFile){\r\n                if(blobFile){\r\n                    var uploadFileParams = {\r\n                        xpath: xpath,\r\n                        renderId: uploadControl.renderId,\r\n                        pageCacheId: params.pageCacheId,\r\n                        sessionId: params.sessionId,\r\n                        fileName: params.fileName\r\n                    };\r\n                    $.when(self.uploadFile(uploadFileParams, blobFile))\r\n                        .done( function(resp){\r\n                            uploadDeferred.resolve(resp);\r\n                        })\r\n                        .fail( function(err){\r\n                            uploadDeferred.reject(err);\r\n                        });\r\n                }\r\n                else{\r\n                    uploadDeferred.reject();\r\n                }\r\n            });\r\n        return uploadDeferred.promise();\r\n    },\r\n\r\n    generateFileDeleteAction: function( params ){\r\n        var self = this;\r\n        var fileId = params.fileId;\r\n        var fileXpath = params.xpath + (bizagi.util.isNumeric(fileId) ? \"[id=\" + fileId + \"]\" : \"[id='\" + fileId + \"']\");\r\n        var deleteParams = {\r\n            xpath: fileXpath,\r\n            idRender: params.renderId,\r\n            xpathContext: \"\",\r\n            idPageCache: params.idPageCache,\r\n            prepare: true\r\n        };\r\n        return self.renderDataService.deleteUploadFile(deleteParams);\r\n    },\r\n\r\n    uploadFile: function(params, binaryFile){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n\r\n        var formData = new FormData();\r\n        formData.append(\"h_xpath\", params.xpath);\r\n        formData.append(\"h_idRender\", params.renderId);\r\n        formData.append(\"h_xpathContext\", \"\");\r\n        formData.append(\"h_pageCacheId\", params.pageCacheId);\r\n        formData.append(\"p_sessionId\", params.sessionId);\r\n        formData.append(params.xpath, binaryFile, params.fileName);\r\n        try {\r\n            (BIZAGI_SESSION_NAME != undefined) ?\r\n                formData.append(BIZAGI_SESSION_NAME, params.sessionId) :\r\n                formData.append(\"JSESSIONID\", params.sessionId);\r\n        } catch (e) {\r\n            formData.append(\"JSESSIONID\", params.sessionId);\r\n        }\r\n\r\n        $.when(self.renderDataService.processUploadFile({\r\n            url: self.renderDataService.getUploadAddUrl(),\r\n            formData: formData\r\n        })).done( function(res){\r\n            if(res.type && res.type === \"error\"){\r\n                def.reject(res);\r\n            }\r\n            else{\r\n                console.log(\"File uploaded\", res);\r\n                def.resolve(res);\r\n            }\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    generateUploadPromiseForImageControl: function(params, imageControl, uploadPromises){\r\n        var self = this;\r\n        var uploadImageDeferred = new $.Deferred();\r\n\r\n        var offlineType = params.offlineType;\r\n        var getImagePromise;\r\n        var uploadParams = {\r\n            id: imageControl.xpath,\r\n            offlineType: offlineType\r\n        }\r\n        $.extend(uploadParams, params);\r\n\r\n        if(offlineType && offlineType === \"start\"){\r\n            getImagePromise = self.renderDataService.getOfflineImage(\r\n                uploadParams, bizagi.util.db.AttachmentType.Blob)\r\n        }\r\n        else{\r\n            getImagePromise = self.renderDataService.getOfflineActivityDataImage(\r\n                uploadParams, bizagi.util.db.AttachmentType.Blob);\r\n        }\r\n\r\n        $.when(getImagePromise)\r\n            .done(function(blobImage){\r\n                if(blobImage){\r\n                    $.extend(uploadParams, imageControl);\r\n                    $.when(self.uploadImage(uploadParams, blobImage))\r\n                        .done( function(){\r\n                            uploadImageDeferred.resolve();\r\n                        })\r\n                        .fail( function(){\r\n                            uploadImageDeferred.reject()\r\n                        });\r\n                }\r\n                else{\r\n                    uploadImageDeferred.reject();\r\n                }\r\n            });\r\n\r\n        uploadPromises.push(uploadImageDeferred);\r\n    },\r\n\r\n    uploadImage: function(params, blob){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var addParams = {};\r\n        addParams[\"h_xpath\"] = params.xpath;\r\n        addParams[\"h_idRender\"] = params.renderId;\r\n        addParams[\"h_xpathContext\"] = \"\";\r\n        addParams[\"h_pageCacheId\"] = params.pageCacheId;\r\n        addParams[\"p_sessionId\"] = params.sessionId;\r\n        addParams[\"h_action\"] = 'savefile';\r\n\r\n        try {\r\n            (BIZAGI_SESSION_NAME != undefined) ?\r\n                addParams[BIZAGI_SESSION_NAME] = params.sessionId :\r\n                addParams[\"JSESSIONID\"] = params.sessionId;\r\n        } catch (e) {\r\n            addParams[\"JSESSIONID\"] = params.sessionId;\r\n        }\r\n        addParams.queueID = \"q_\" + bizagi.util.encodeXpath(params.xpath);\r\n        var uploadParams = {};\r\n\r\n        uploadParams.data = addParams;\r\n        uploadParams.options = {};\r\n        uploadParams.options.fileKey = \"file\";\r\n        uploadParams.options.fileName = blob.name||\"offlineImage_\" + bizagi.util.randomNumber() + \".png\";\r\n        uploadParams.options.mimeType = \"image/png\";\r\n        uploadParams.options.uploadKey = {key: addParams[\"h_xpath\"]};\r\n        uploadParams.options.addUrl = self.renderDataService.getUploadAddFileUrl(false);\r\n\r\n\r\n        var vFD = new FormData();\r\n        //Copy all the atributes to the FormData object\r\n        $.each(uploadParams.data, function (key, item) {\r\n            vFD.append(key, item);\r\n        });\r\n        vFD.append(uploadParams.options.uploadKey.key, blob, uploadParams.options.fileName);\r\n\r\n        $.ajax({\r\n            url: uploadParams.options.addUrl,\r\n            type: \"POST\",\r\n            contentType: false,\r\n            processData: false,\r\n            data: vFD\r\n        }).done(function (resp) {\r\n            if(resp.type && resp.type === \"error\"){\r\n                def.reject(resp);\r\n            }\r\n            else{\r\n                console.log(\"Image uploaded\", resp);\r\n                def.resolve(resp);\r\n            }\r\n        }).fail(function (error) {\r\n            def.reject(error);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    /*\r\n     * Retreives the process  from Hierarchy\r\n     *\r\n     */\r\n    processesHierarchy: function () {\r\n        var self = this;\r\n        var data = {};\r\n        data['removeOnlineItems'] = 'true';\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('offline-getProcessTree'),\r\n            data: data,\r\n            dataType: 'json',\r\n            type: 'GET'\r\n        });\r\n    },\r\n  \r\n    generateGridPromises: function(gridsData, idPageCache) {\r\n        var self = this;\r\n        var promisesResponse = {\r\n            bizAdditions: [],\r\n            bizDeletions: []\r\n        }\r\n        gridsData.forEach( function(currentGridData) {\r\n            //Addition promises\r\n            if(currentGridData.value[\"new-records\"]){\r\n                var keys = Object.keys(currentGridData.value[\"new-records\"]);\r\n                for(var i = 0; i< keys.length; i++){\r\n                    var rowData = currentGridData.value[\"new-records\"][keys[i]];\r\n                    rowData['idPageCache'] = idPageCache;\r\n                    promisesResponse.bizAdditions.push(self.renderDataService.addGridRecordData(rowData))\r\n                }\r\n            }\r\n            //Delition promises\r\n            if(currentGridData.value[\"deleted-records\"]){\r\n                var keys = Object.keys(currentGridData.value[\"deleted-records\"]);\r\n                for(var i = 0; i< keys.length; i++){\r\n                    var rowData = currentGridData.value[\"deleted-records\"][keys[i]];\r\n                    rowData['idPageCache'] = idPageCache;\r\n                    promisesResponse.bizDeletions.push(self.renderDataService.deleteGridRecord(rowData))\r\n                }\r\n            }\r\n        });\r\n        return promisesResponse;\r\n    },\r\n\r\n    \r\n    downloadOfflineStartForm: function(params){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        params.action = \"LOADSTARTFORM\";\r\n        params.downloadOfflineForm = true;\r\n\r\n        retrieveAndSaveStartForm(params, def); \r\n        \r\n        // SWAT TODO: ENGINE should implement the hash support in order to prevent unnecessary data plan consumption\r\n        // $.when(self.database.getStartForm(params))\r\n        //     .done( function(localForm){\r\n        //         params.hash = localForm.hash;\r\n        //         retrieveAndSaveStartForm(params, def);\r\n        //     })\r\n        //     .fail( retrieveAndSaveStartForm(params, def) );\r\n\r\n        function retrieveAndSaveStartForm(params, promise){\r\n            $.when(self.renderDataService.getFormData(params))\r\n                .then( function(serverResponse) {\r\n                    if(serverResponse.errorType){\r\n                        def.reject(serverResponse);\r\n                    }                    \r\n                    if(serverResponse.form){\r\n                        serverResponse.form.properties.isTaskForm = false;\r\n                        var offlineStartFormButtons = [\r\n                            {\r\n                                button: {\r\n                                    properties: {\r\n                                        actions: [\r\n                                            \"submitData\",\r\n                                            \"refresh\"\r\n                                        ],\r\n                                        caption: \"render-form-button-save\",\r\n                                        id: \"ec0a5a02-0f81-44a7-8d64-ac090a01d61b\"\r\n                                    }\r\n                                },\r\n                            },\r\n                            {\r\n                                button: {\r\n                                    properties: {\r\n                                        actions: [\r\n                                            \"validate\",\r\n                                            \"submitData\",\r\n                                            \"next\",\r\n                                            \"routing\"\r\n                                        ],\r\n                                        caption: \"render-form-button-next\",\r\n                                        id: \"ba81c7af-0d83-4139-879d-b040f0f81bd7\"\r\n                                    }\r\n                                }\r\n                            }\r\n                        ];\r\n                        serverResponse.form.buttons = offlineStartFormButtons;\r\n                        return self.database.saveStartForm(params, serverResponse);\r\n                    }\r\n                    else\r\n                        def.reject(serverResponse);\r\n                })\r\n                .then( function(){\r\n                    promise.resolve();\r\n                })\r\n                .fail( function(err){\r\n                    promise.reject();\r\n                });\r\n        }\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    downloadOfflineTaskForm: function(params){        \r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var savedFormPromise = self.database.getTaskForm(params);\r\n        params.deleteNextButton = false;\r\n\r\n        $.when(savedFormPromise)\r\n            .done( function(savedForm){\r\n                var timeBeforeNextHardRedownload = 1000 * 60 * 60 * params.syncDelda;\r\n                var formShouldBeDownloaded = !savedForm.lastFullSync || (savedForm.lastFullSync + timeBeforeNextHardRedownload < Date.now());\r\n                if( formShouldBeDownloaded || savedForm.dataChangeset != params.dataChangeset){\r\n                    //params.hash = savedForm.hash;\r\n                    retrieveAndSaveForm(params, def);\r\n                }\r\n                else{\r\n                    //The form is up-to-date\r\n                    def.resolve();\r\n                }\r\n            })\r\n            //Form not exists\r\n            .fail( function(){\r\n                retrieveAndSaveForm(params, def);\r\n            });\r\n\r\n        function retrieveAndSaveForm(params, promise){\r\n            $.when(self.getServerTaskForm(params))\r\n                .then( function(form) {\r\n                    form.form.properties.isTaskForm = true;\r\n                    form.lastFullSync = Date.now();\r\n                    return self.database.saveTaskForm(params, form);\r\n                })\r\n                .then(function(){ promise.resolve() })\r\n                .fail(function(){ promise.reject() })\r\n\r\n        }\r\n        return def.promise();\r\n    },\r\n\r\n    getServerTaskForm: function(params){\r\n        var self = this;\r\n        var def = new $.Deferred();\r\n        var resolvedForm = undefined;\r\n        params.downloadOfflineForm = true;\r\n\r\n        $.when(self.renderDataService.getFormData(params))\r\n        .done( function(form){\r\n            if(form.errorType){\r\n                def.reject(form);\r\n            }\r\n            form.dataChangeset = params.dataChangeset;\r\n            if(params.deleteNextButton){\r\n                form = self.database.deleteNextButton(form);\r\n            }\r\n\r\n            var data = {};\r\n            var downloadPromises = [];\r\n            var uploads = self.database.filterXpathsByType(form, \"upload\");\r\n            uploads.forEach(function(upload){\r\n                self.downloadFilesInUploadControl(params, form, upload, downloadPromises);\r\n                self.convertUploadOnlineValueInOfflineValue(upload, data);\r\n            });\r\n\r\n            var downloadImagesPromise = self.downloadFormImages(form, params);\r\n            downloadPromises.push(downloadImagesPromise);\r\n            \r\n            var mergedFormPromise = new $.Deferred();\r\n            downloadPromises.push(mergedFormPromise);\r\n\r\n            var formPromise = new $.Deferred();\r\n            $.when(self.database.mergeDataDocument(data, null, formPromise))\r\n            .done( function(complexData){\r\n                var object = {data: data};\r\n                object.data = complexData;\r\n                object.isOpen = true;\r\n                self.database.mergeForm(object, formPromise).then(function(mergedForm){\r\n                    mergedFormPromise.resolve(mergedForm);\r\n                    resolvedForm = mergedForm;\r\n                });\r\n            })\r\n            .fail( function(err){\r\n                mergedFormPromise.reject(err);\r\n            });\r\n            formPromise.resolve(form);\r\n\r\n\r\n            $.when.apply($, downloadPromises).then(function(){\r\n                def.resolve(resolvedForm);\r\n            })\r\n            .fail( function() {\r\n                console.log(\"Error downloading task form\", params);\r\n                def.reject();\r\n            });\r\n\r\n        })\r\n        .fail( function(err){\r\n            def.reject(err);\r\n        });\r\n\r\n        return def.promise();\r\n    },\r\n\r\n    downloadFormImages: function(form, params){\r\n        var def = new $.Deferred();\r\n        var self = this;\r\n        var imageControls = self.database.filterXpathsByType(form, \"image\");\r\n        var downloadImagesPromises = [];\r\n        imageControls.forEach( function(currentImageControl){\r\n            downloadImagesPromises.push( self.downloadImage(params, form.form, currentImageControl) );\r\n        });\r\n        $.when.apply($, downloadImagesPromises).then(function(){\r\n            def.resolve();\r\n        }).fail( function(error){\r\n            console.log(\"Error downloading images\", params, error);\r\n            def.reject();\r\n        })\r\n        return def.promise();\r\n    },\r\n    // removeOfflineTaskFormsClosed: function(params) {\r\n    //     var self = this;\r\n    //     params = params || {};\r\n    //     var data = [];\r\n\r\n    //     if (typeof params.formsToDelete !== \"undefined\") {\r\n    //         data = params.formsToDelete;\r\n    //     }\r\n\r\n    //     data.forEach(currentForm => {\r\n    //         self.database.\r\n    //     });\r\n\r\n    // },\r\n\r\n});\r\n\r\n","/*\r\n*   Name: BizAgi Rendering Services\r\n*   Author: Diego Parra (based on Edward Morales version)\r\n*   Comments:\r\n*   -   This class will provide a facade to access to workportal REST services\r\n*/\r\n\r\nbizagi.workportal.services.service.extend(\"bizagi.workportal.services.service\", {}, {\r\n    /* \r\n    *   Constructor\r\n    */\r\n    init: function(params) {\r\n        // Call base\r\n        var self = this;\r\n\r\n        params.oldOfflineServicesAlreadyEnabled = !bizagi.util.isOfflineFormsV2Supported();\r\n\r\n        self._super(params);\r\n\r\n        // Create instance of database services\r\n        if(!bizagi.util.isOfflineFormsV2Supported()){\r\n            if(typeof (bizagi.workportal.services.db.old) !== \"undefined\"){\r\n                self.database = new bizagi.workportal.services.db.old();\r\n            }\r\n            self.enableOfflineEvents();\r\n        }     \r\n    },\r\n\r\n    enableOfflineEvents: function() {\r\n        var self = this;\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            self._super();\r\n        }\r\n        else {\r\n            if (bizagi.util.isTabletDevice()) {\r\n                if (typeof navigator.connection != \"undefined\") {\r\n                    if (typeof (Connection) !== \"undefined\"\r\n                        && (navigator.connection.type == Connection.NONE || navigator.connection.type == \"unknown\")) {\r\n                        self.online = false;\r\n                    } \r\n                    else {\r\n                        self.online = true;\r\n                    }\r\n                } \r\n                else {\r\n                    var queryString = bizagi.readQueryString();\r\n                    var queryoffline = (queryString && queryString[\"online\"]) ? eval(queryString[\"online\"]) : true;\r\n                    self.online = queryoffline;\r\n                }\r\n\r\n                $(document).off(\"online.services\");\r\n                $(document).on(\"online.services\", function() {\r\n                    self.online = true;\r\n                    bizagi.log(\"online.services\");\r\n                    self.returnOnlineStatus();\r\n                });\r\n\r\n                $(document).off(\"offline.services\");\r\n                $(document).on(\"offline.services\", function() {\r\n                    bizagi.log(\"offline.services\");\r\n                    self.online = false;\r\n                });\r\n\r\n            }\r\n\r\n            // Execute this trigger in render on next event        \r\n            $(document).off(\"tryPushData.offline\");\r\n            $(document).on(\"tryPushData.offline\", function(e) {\r\n                if (self.online) {\r\n                    self.pushOfflineData();\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    returnOnlineStatus: function() {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            this._super();\r\n        }\r\n        else{\r\n            var self = this;\r\n            $.when(self.logoutUser()).always(function() {\r\n                $.when(self.authenticatedUser()).always(function() {\r\n                    $.when(self.pushOfflineData()).always(function(pushStatus) {\r\n                        self.fetchOfflineData(pushStatus);\r\n                    });\r\n                });\r\n            });\r\n        }\r\n    },\r\n\r\n    /*\r\n    * Get all data from server : new case structure, forms data\r\n    */\r\n    fetchOfflineData: function(v2Param) {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            this._super(v2Param);\r\n        }\r\n        else if ( bizagi.util.hasOfflineFormsEnabled()) {\r\n            var synObject = new bizagi.workportal.services.fetchWorker.old(this);\r\n            var message = \"\";\r\n\r\n            $.when(synObject.fetch()).done(function(data) {\r\n                bizagi.log(\"Sync Completed\");\r\n                if (bizagi.util.isTabletDevice()) {\r\n                    message = bizagi.util.isValidResource(\"workportal-mobile-offline-sync-successful\")\r\n                        ? bizagi.localization.getResource(\"workportal-mobile-offline-sync-successful\")\r\n                        : \"Successful Synchronization\";\r\n\r\n                    bizagi.util.showNotification({ text: message, type: \"success\" }); // Localizar texto\r\n                }\r\n            }).fail(function(data) {\r\n                bizagi.log(\"Sync Failed\");\r\n\r\n                if (bizagi.util.isTabletDevice()) {\r\n                    if (data !== 0) {\r\n                        message = bizagi.util.isValidResource(\"workportal-mobile-offline-sync-fail\")\r\n                            ? bizagi.localization.getResource(\"workportal-mobile-offline-sync-fail\")\r\n                            : \"Failed Synchronization\";\r\n                        bizagi.util.showNotification({ text: message, type: \"error\" });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    /*\r\n    * put all data to server : new case structure, forms data\r\n    */\r\n    pushOfflineData: function() {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return this._super();\r\n        }\r\n        else if (bizagi.util.hasOfflineFormsEnabled()) {\r\n            var self = this;\r\n            var pullObject = new bizagi.workportal.services.pullWorker.old(this);\r\n            return $.when(pullObject.pull())\r\n                    .then(function(data) {\r\n                    bizagi.log(\"Offline cases syncronized, all data sended\");\r\n                }, function(cause) {\r\n                    bizagi.log(\"Error syncronizing cases\");\r\n                });\r\n        }\r\n    },\r\n\r\n    /*\r\n     * this function send to the server the offline cases created\r\n     */\r\n    syncOfflineCases: function (params) {\r\n        var self = this;\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('offline-sendForm'),\r\n            data: {\r\n                idCase: params.idCase,\r\n                idWFClass: params.idWfClass,\r\n                awCaseCreationContext: JSON.stringify(params.objToSend),\r\n                idWorkflow: params.idWfClass\r\n            },\r\n            type: 'POST',\r\n            dataType: 'json',\r\n            serviceType: 'LOAD'\r\n        });\r\n    },\r\n\r\n     /*\r\n     * Retreives Form structure + Form data\r\n     *\r\n     */\r\n    processesHierarchyTofetchForms: function (params) {\r\n        var self = this;\r\n        var data = {};\r\n        data['idChangeSet'] = params.changeSet;\r\n        return $.ajax({\r\n            url: self.serviceLocator.getUrl('offline-getForms'),\r\n            data: data,\r\n            dataType: 'json'\r\n        });\r\n    },\r\n\r\n    /*\r\n    *   Gets the current working user\r\n    */\r\n    getCurrentUser: function(params) {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return this._super(params);\r\n        }\r\n        else{\r\n            var self = this;\r\n\r\n            if (self.online) {\r\n                return self._super(params);\r\n            } \r\n            else {\r\n                var defer = new $.Deferred();\r\n\r\n                // Call ajax and returns promise\r\n                // save this response in the local storage and get when offline\r\n                var data = {\r\n                    idUser: 1,\r\n                    user: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                    userName: typeof (BIZAGI_USER) !== \"undefined\" ? BIZAGI_USER : \"admon\",\r\n                    domain: typeof (BIZAGI_DOMAIN) !== \"undefined\" ? BIZAGI_DOMAIN : \"domain\",\r\n                    delegateUserName: \"\",\r\n                    idDelegateUser: -1,\r\n                    groupSeparator: \",\",\r\n                    language: \"en-US\",\r\n                    decimalSeparator: \".\",\r\n                    decimalDigits: \"2\",\r\n                    symbol: \"$\",\r\n                    ShortDateFormat: \"M/d/yyyy\",\r\n                    TimeFormat: \"h:mm tt\",\r\n                    LongDateFormat: \"dddd, MMMM d, yyyy\",\r\n                    twoDigitYearMax: 2029,\r\n                    twoDigitYearMaxDelta: 13,\r\n                    uploadMaxFileSize: \"1048576\",\r\n                    isMultiOrganization: \"false\",\r\n                    associatedStakeholders: [],\r\n                    sUserProperties : []\r\n                };\r\n\r\n                defer.resolve(data);\r\n\r\n                return defer.promise();\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Return all the available processes in bizagi\r\n    */\r\n    getAllProcesses: function(params) {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return this._super(params);\r\n        }\r\n        else {\r\n            var self = this;\r\n            params.inputtray = params.inputtray || \"inbox\";\r\n            if (params.inputtray == \"inbox\") {\r\n                return self._super(params);\r\n            } \r\n            else {\r\n                return $.when(self.database.getAllProcesses(params)).pipe(function(response) {\r\n                    response = JSON.parse(response);\r\n                    // Aggrupate workflows by categories\r\n                    if (!!params.skipAggrupate)\r\n                        return response;\r\n                    var responseData = {};\r\n                    var categories = {};\r\n                    var allProcesses = bizagi.localization.getResource(\"workportal-widget-inbox-all-processes\");\r\n                    var allCases = {\r\n                        name: bizagi.localization.getResource(\"workportal-widget-inbox-all-cases\"),\r\n                        path: \"\",\r\n                        category: allProcesses,\r\n                        isFavorite: (params.onlyFavorites || false),\r\n                        guidFavorite: \"\",\r\n                        idworkflow: \"\",\r\n                        guidWFClass: \"\",\r\n                        count: 0\r\n                    };\r\n\r\n                    // Create a default category\r\n                    categories[allProcesses] = [];\r\n                    categories[allProcesses].workflows = [];\r\n                    categories[allProcesses].workflows.push(allCases);\r\n                    if (response.workflows) {\r\n                        $.each(response.workflows.workflow, function(i, workflow) {\r\n                            // Creates the category if it doesn't exist\r\n                            if (!categories[workflow.category]) {\r\n                                categories[workflow.category] = [];\r\n                                categories[workflow.category].workflows = [];\r\n                            }\r\n\r\n                            // Push the workflow\r\n                            categories[workflow.category].workflows.push(workflow);\r\n\r\n                            // Sum the cases count                        \r\n                            allCases.count += Number(workflow.count);\r\n                        });\r\n                    }\r\n\r\n                    // Build result array once grouped\r\n                    responseData.categories = [];\r\n                    for (key in categories) {\r\n                        responseData.categories.push({\r\n                            name: key,\r\n                            workflows: categories[key].workflows\r\n                        });\r\n                    }\r\n                    return responseData;\r\n                });\r\n\r\n            }\r\n        }\r\n    },\r\n    /*\r\n    *   Returns all the cases for the current user filtered by a workflow\r\n    */\r\n    getCasesByWorkflow: function(params) {\r\n        var self = this;\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return self._super(params);\r\n        }\r\n        else{\r\n            params.inputtray = params.inputtray || \"inbox\";\r\n\r\n            if (params.inputtray === \"inbox\") {\r\n                if (self.online) {\r\n                    return self._super(params);\r\n                } \r\n                else {\r\n                    var deferred = new $.Deferred();\r\n\r\n                    var cases = {\r\n                        \"rows\": [],\r\n                        \"totalPages\": 0,\r\n                        \"page\": 1,\r\n                        \"lstIdCases\": []\r\n                    };\r\n\r\n                    deferred.resolve(cases);\r\n                    return deferred.promise();\r\n                }\r\n            } \r\n            else {\r\n                var defer = new $.Deferred();\r\n                $.when(self.database.getCustomizedColumnsData(params)).pipe(function(response) {\r\n                    response = JSON.parse(response);\r\n                    $.each(response.cases.rows, function(key, value) {\r\n                        var newFieldsValue = [];\r\n\r\n                        //  Set id of case to radnumber\r\n                        response.cases.rows[key][\"radnumber\"] = value.id;\r\n                        $.each(value.fields, function(fieldsKey, fieldsValue) {\r\n                            // when delete element from fields array, each function lose key value\r\n                            if (fieldsValue != undefined) {\r\n                                // Radnumber\r\n                                try {\r\n                                    if (fieldsValue.isRadNumber != undefined && fieldsValue.isRadNumber == \"true\") {\r\n                                        response.cases.rows[key][\"radnumber\"] = fieldsValue.Value;\r\n                                    } else if (fieldsValue.workitems != undefined) {\r\n                                        response.cases.rows[key][\"workitems\"] = fieldsValue.workitems;\r\n                                    } else {\r\n                                        newFieldsValue.push(fieldsValue);\r\n                                    }\r\n                                } catch (e) {\r\n                                }\r\n                            }\r\n                        });\r\n\r\n                        // Update Fields \r\n                        response.cases.rows[key]['fields'] = newFieldsValue;\r\n                    });\r\n                    defer.resolve(response.cases);\r\n                });\r\n                return defer.promise();\r\n            }\r\n        }\r\n    },\r\n    /*\r\n    *  Get Menu Authorization\r\n    */\r\n    getMenuAuthorization: function() {\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return this._super();\r\n        }\r\n        else{\r\n            var self = this;\r\n\r\n            if (self.online) {\r\n                return self._super();\r\n            } else {\r\n                // Call ajax and returns promise\r\n                var defer = new $.Deferred();\r\n                var data = {\r\n                    \"permissions\": [\r\n                        { \"Cases\": [\"NewCase\", \"Pending\", \"Closed\", \"Search\"] },\r\n                        {\r\n                            \"AnalysisReports\": [\r\n                                \"BAMProcess\", \"BAMTask\", \"AnalyticsProcess\", \"AnalyticsTask\", \"AnalyticsSensor\",\r\n                                \"AnalysisQueries\", \"BAMResourceMonitor\"\r\n                            ]\r\n                        }, {\r\n                            \"Admin\": [\r\n                                \"UserAdmin\", \"Licenses\", \"EntityAdmin\", \"CaseAdmin\", \"AlarmAdmin\", \"EncryptionAdmin\",\r\n                                \"MobileUpdatesAdmin\", \"AsynchronousWorkitemRetries\", \"UserPendingRequests\",\r\n                                \"AuthenticationLogQuery\", \"BusinessPolicies\", \"Profiles\", \"UserDefaultAssignation\",\r\n                                \"GRDimensionAdmin\", \"ThemeBuilder\"\r\n                            ]\r\n                        }, { \"CurrentUserAdministration\": [\"CurrentUser\"] }, { \"LogOut\": [] }, { \"Search\": [] },\r\n                        { \"SmartFolders\": [] }, { \"CustomFolders\": [] }, { \"BizagiQueries\": [] }, { \"AnalysisQueries\": [] },\r\n                        { \"StateLog\": [] }, { \"PrintableVersion\": [] }\r\n                    ]\r\n                };\r\n\r\n                defer.resolve(data);\r\n\r\n                return defer.promise();\r\n            }\r\n        }\r\n    },\r\n    /*\r\n    *   Gets the inbox summary for the current logged user\r\n    *   Returns a promise of the data being retrieved\r\n    */\r\n    getInboxSummary: function(params) {\r\n        if (bizagi.util.isOfflineFormsV2Supported()) {\r\n            return this._super();\r\n        }\r\n        else {\r\n            var self = this;\r\n            var enableDefaultMethod = self.online;\r\n            if (params && (params.inputtray == \"false\" || params.inputtray == \"true\")) {\r\n                enableDefaultMethod = false;\r\n            }\r\n            if (enableDefaultMethod) {\r\n                return self._super(params);\r\n            } else {\r\n                // Call ajax and returns promise\r\n                var defer = new $.Deferred();\r\n                $.when('{\"inboxSummary\":{\"Red\":7,\"Yellow\":0,\"Green\":0,\"Black\":0,\"All\":7}}').pipe(function(response) {\r\n                    var data = JSON.parse(response);\r\n                    defer.resolve(data[\"inboxSummary\"]);\r\n                });\r\n                return defer.promise();\r\n            }\r\n        }\r\n    },\r\n    /*\r\n    *   Returns the available categories filtered by a parent category\r\n    *   If not parent category is sent, it will return the base categories\r\n    */\r\n    getCategories: function(params) {\r\n        var self = this;\r\n        if(bizagi.util.isOfflineFormsV2Supported()){\r\n            return self._super(params);\r\n        }\r\n        else{\r\n            if (self.online) {\r\n                return self._super(params);\r\n            } \r\n            else {\r\n                // Define data\r\n                params = params || {};\r\n                var data = {};\r\n\r\n                // Required params\r\n                if (params.idCategory)\r\n                    data[\"idCategory\"] = params.idCategory;\r\n                if (params.idApp)\r\n                    data[\"idApp\"] = params.idApp;\r\n\r\n                data[\"enableOfflineForm\"] = params.enableOfflineForm || false;\r\n\r\n\r\n                data[\"groupByApp\"] = params.groupByApp || false;\r\n\r\n                // Call ajax and returns promise\r\n                return self.database.getCategories(data);\r\n            }\r\n        }\r\n    },\r\n\r\n    /* \r\n    * CREATE NEW CASES\r\n    */\r\n    createNewCase: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || !params.isOfflineForm) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            return self.database.createNewCase(params);\r\n        }\r\n    },\r\n\r\n    getWorkitems: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || !params.isOfflineForm) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            if (bizagi.util.isNativePluginSupported() && typeof (bizagiapp.getCase) !== \"undefined\") {\r\n                return self.getNativeWorkItems(params);\r\n            } \r\n            else {\r\n                return self.database.getWorkitems(params);\r\n            }\r\n        }\r\n    },\r\n\r\n    getNativeWorkItems: function(params){\r\n        var defer = new $.Deferred();\r\n\r\n        bizagiapp.getCase(params.idCase, function(response){\r\n           \r\n            var workItems = JSON.parse(response);\r\n\r\n            defer.resolve(workItems);\r\n\r\n        }, function(response){\r\n            defer.reject(response);\r\n        });\r\n\r\n        return defer.promise();\r\n    },\r\n\r\n    getCaseSummary: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || !params.isOfflineForm) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            return self.database.getSummary(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Delete offline cases created localy\r\n    *   return a promise\r\n    */\r\n    deleteCase: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported()) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            return self.database.deleteCase(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Get subprocesses\r\n    *   return a promise\r\n    */\r\n    getCaseSubprocesses: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || !params.isOfflineForm) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n            defer.resolve({ subProcesses: [] });\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n    * This service get all overrides keys within configuration project\r\n    *\r\n    * @return {json}\r\n    */\r\n    getOverrides: function() {\r\n        return {};\r\n    },\r\n\r\n    /**\r\n     * Return all the available cases in bizagi and thinking for mobile response\r\n     * @param {} params: inputtray:  inbox | outbox (false) | drafts (true)\r\n     * @returns {} \r\n     */\r\n    getCasesListBeta: function(params) {\r\n        if (bizagi.util.isOfflineFormsV2Supported()) {\r\n            return this._super(params);\r\n        }\r\n        else {\r\n            var self = this;\r\n            params = params || {};\r\n\r\n            params.inputtray = params.inputtray || \"inbox\";\r\n\r\n            if (params.inputtray === \"inbox\" || params.inputtray == \"outbox-finished\") {\r\n                if (self.online && params.inputtray === \"inbox\" ) {\r\n                    return self._super(params);\r\n                } else {\r\n                    var deferred = new $.Deferred();\r\n\r\n                    var response = { \"page\": 1, \"totalPages\": 1, \"elements\": [] };\r\n                    deferred.resolve(response);\r\n\r\n                    return deferred.promise();\r\n                }\r\n            } \r\n            else {\r\n                var defer = new $.Deferred();\r\n                $.when(self.database.getCasesList(params))\r\n                    .pipe(function(response) {\r\n                        response = JSON.parse(response);\r\n\r\n                        var taskFeedData = self.getTaskFeedData(response);\r\n\r\n                        defer.resolve(taskFeedData);\r\n                    });\r\n\r\n                return defer.promise();\r\n            }\r\n        }\r\n    },\r\n\r\n    getMobileCasesList: function(params) {\r\n        var self = this;\r\n        if (bizagi.util.isOfflineFormsV2Supported() || params.inputtray === \"inbox\") {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            return getCasesListBeta(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n    * Customize Columns\r\n    */\r\n    getTaskFeedData: function(response) {\r\n        if (bizagi.util.isOfflineFormsV2Supported()) {\r\n            return this._super(response);\r\n        }\r\n        else {                \r\n            var overdue = bizagi.localization.getResource(\"workportal-taskfeed-overdue\");\r\n            var today = bizagi.localization.getResource(\"workportal-taskfeed-today\");\r\n            var tomorrow = bizagi.localization.getResource(\"workportal-taskfeed-tomorrow\");\r\n            var upcoming = bizagi.localization.getResource(\"workportal-taskfeed-upcomming\");\r\n\r\n            var groupedData = {\r\n                elements: [],\r\n                page: response.page,\r\n                totalPages: response.totalPages,\r\n                advanceSearch: false\r\n            };\r\n\r\n            var actualDate = new Date();\r\n            var actualMonth = actualDate.getMonth();\r\n            var actualDay = actualDate.getDate();\r\n            var actualYear = actualDate.getFullYear();\r\n\r\n            for (var counter = 0; response.elements.length > counter; counter++) {\r\n                var tmpElement = response.elements[counter];\r\n                var status = {};\r\n\r\n                var originalEndDate = tmpElement[3];\r\n\r\n                if (tmpElement[3] !== \"\") {\r\n                    var tmpdate = new Date(tmpElement[3]);\r\n                    var tmpDay = tmpdate.getDate();\r\n                    var tmpMonth = tmpdate.getMonth();\r\n                    var tmpYear = tmpdate.getFullYear();\r\n                    var dateDiff = ((new Date(tmpYear, tmpMonth, tmpDay, 0, 0, 0)\r\n                        - new Date(actualYear, actualMonth, actualDay, 0, 0, 0)));\r\n\r\n                    if (dateDiff < 0) {\r\n                        tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]),\r\n                            \"MMMM dd | hh:mm tt\");\r\n                        status = { group: \"1|\" + overdue, state: \"red\", type: \"overdue\", icon: \"overdue\" };\r\n                    } else {\r\n                        if (actualMonth === tmpMonth && actualDay === tmpDay) {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm tt\");\r\n\r\n                            // Define if the case is overdue\r\n                            if (tmpdate.getTime() < actualDate.getTime()) {\r\n                                status = {\r\n                                    group: \"2|\" + today + \", \"\r\n                                        + bizagi.util.dateFormatter.formatDate(actualDate, \"MMMM dd\"),\r\n                                    state: \"red\",\r\n                                    type: \"today\",\r\n                                    icon: \"overdue\"\r\n                                };\r\n                            } else {\r\n                                status = {\r\n                                    group: \"2|\" + today + \", \"\r\n                                        + bizagi.util.dateFormatter.formatDate(actualDate, \"MMMM dd\"),\r\n                                    state: \"yellow\",\r\n                                    type: \"today\",\r\n                                    icon: \"ontime\"\r\n                                };\r\n                            }\r\n                        } else if (actualMonth === tmpMonth && (actualDay + 1) === tmpDay) {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"hh:mm tt\");\r\n                            status = {\r\n                                group: \"3|\" + tomorrow + \", \"\r\n                                    + bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"MMMM dd\"),\r\n                                state: \"yellow\",\r\n                                type: \"tomorrow\",\r\n                                icon: \"ontime\"\r\n                            };\r\n                        } else {\r\n                            tmpElement[3] = bizagi.util.dateFormatter.formatDate(new Date(tmpElement[3]), \"MMMM dd | hh:mm tt\");\r\n                            status = { group: \"4|\" + upcoming, state: \"green\", type: \"upcoming\", icon: \"upcoming\" };\r\n                        }\r\n                    }\r\n                } else {\r\n                    tmpElement[3] = \"--\";\r\n                    status = { group: \"1|\" + overdue, state: \"red\", type: \"overdue\", icon: \"overdue\" }\r\n                }\r\n\r\n                groupedData.elements.push($.extend({}, tmpElement, status,\r\n                { \"endDate\": originalEndDate, \"idworkitem\": tmpElement[1] }));\r\n            }\r\n\r\n            return groupedData;\r\n        }\r\n    },\r\n\r\n    /*\r\n    * Render Details\r\n    * @param idWorkitem\r\n    */\r\n    summaryCaseDetails: function(options) {\r\n        var self = this;\r\n        var params = options || {};\r\n\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || !params.isOfflineForm) {\r\n            return self._super(params);\r\n        } else {\r\n            var def = $.Deferred();\r\n            var idWorkitem = options[\"idWorkitem\"] || 0;\r\n\r\n            $.when(self.getCaseSummaryDataContent(options))\r\n                .done(function(data) {\r\n\r\n                    data.currentState = data.currentState || [];\r\n                    var dataCurrentStateLength = data.currentState.length;\r\n\r\n                    // Show or hide tabs\r\n                    data[\"showEvents\"] = (data[\"countEvents\"] >= 1) ? true : false;\r\n                    data[\"showParentProcess\"] = (data[\"idParentCase\"] >= 1) ? true : false;\r\n                    data[\"parentProcess\"] = {\r\n                        'displayName': data[\"parentDisplayName\"],\r\n                        'idCase': data[\"idParentCase\"]\r\n                    };\r\n\r\n                    data[\"isClosed\"] = (data[\"isOpen\"] == \"true\") ? false : true;\r\n                    data[\"showAssignees\"] = (data[\"countAssigness\"] >= 1) ? true : false;\r\n                    data[\"showSubProcess\"] = (data[\"countSubProcesses\"] >= 1) ? true : false;\r\n                    data[\"showForm\"] = (data[\"hasGlobalForm\"] == \"true\") ? true : false;\r\n                    data[\"allowsReassign\"] = \"false\";\r\n\r\n                    for (var i = 0; i < dataCurrentStateLength; i++) {\r\n                        if (data[\"currentState\"][i][\"idWorkItem\"] == idWorkitem) {\r\n                            data[\"allowsReassign\"] = data[\"currentState\"][i][\"allowsReassign\"];\r\n                        }\r\n                    }\r\n\r\n                    // edit original data, no show events in activities tab\r\n                    var currentStateTypes = [];\r\n                    var m = 0; // counter for new activities array\r\n                    for (var j = 0; j < data[\"currentState\"].length; j++) {\r\n                        if (data[\"currentState\"][j][\"isEvent\"] == \"false\" &&\r\n                            data[\"currentState\"][j][\"assignToCurrentUser\"] == \"true\" &&\r\n                            data[\"currentState\"][j][\"idWorkItem\"] != idWorkitem) {\r\n                            currentStateTypes[m++] = data[\"currentState\"][j];\r\n                        }\r\n                    }\r\n\r\n                    data[\"currentStateTypes\"] = currentStateTypes;\r\n                    data[\"showActivities\"] = (currentStateTypes.length >= 1) ? true : false;\r\n\r\n                    def.resolve(data);\r\n                });\r\n\r\n            return def.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n    *  Get json from cases service\r\n    */\r\n    getCaseSummaryDataContent: function(options) {\r\n        var self = this;\r\n        if (bizagi.util.isOfflineFormsV2Supported()) {\r\n            return self._super(options);\r\n        }\r\n        else {\r\n            var promise = new $.Deferred();\r\n\r\n            $.when(self.getCaseSummary(options))\r\n                .done(function(data) {\r\n                    // Completes data\r\n                    data.taskState = self.icoTaskState;\r\n                    data.process = data.process ? data.process : \"\";\r\n\r\n                    if (data.createdBy) {\r\n                        data.createdByName = data.createdBy.Name;\r\n                        data.createdByUserName = data.createdBy.userName;\r\n                        data.caseDescription = (data.caseDescription == '' ? '' : data.caseDescription);\r\n                        data.processPath = data.processPath.replace(/\\//g, ' > ') + data.process;\r\n                        data.showWorkOnIt = true;\r\n                    }\r\n\r\n                    promise.resolve(data);\r\n                });\r\n            return promise.promise();\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Returns the data for the inbox grid view\r\n    */\r\n    getCustomizedColumnsData: function(params) {\r\n        var self = this;\r\n\r\n        params.inputtray = params.inputtray || \"inbox\";\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || params.inputtray === \"inbox\") {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n\r\n            $.when(self.database.getCustomizedColumnsNewData(params))\r\n                .pipe(function(response) {\r\n                    defer.resolve(JSON.parse(response));\r\n                });\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n    /*\r\n    *   Returns the recent process\r\n    */\r\n    getRecentProcesses: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || self.online) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            return self.database.getRecentProcesses(params);\r\n        }\r\n    },\r\n\r\n    /*\r\n    *   Start process in BizAgi\r\n    */\r\n    startProcess: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || self.online) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n\r\n            var data = {\r\n                hasStartForm: false,\r\n                idProcess: params.idProcess,\r\n                displayName: params.displayName,\r\n                caseInfo: {}\r\n            }\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get stakeholder shortCurts\r\n     * @param {} params \r\n     * @returns {} \r\n     */\r\n    getShortCuts: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || self.online) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the available list of searches\r\n     * @returns {} \r\n     */\r\n    getSearchLists: function() {\r\n        var self = this;\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || self.online) {\r\n            return self._super();\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Get the icon of a given collection\r\n     * @param params\r\n     */\r\n    getCollectionIcon: function(params) {\r\n        var self = this;\r\n        params = params || {};\r\n\r\n        if (bizagi.util.isOfflineFormsV2Supported() || self.online) {\r\n            return self._super(params);\r\n        } \r\n        else {\r\n            var defer = new $.Deferred();\r\n            var data = [];\r\n            defer.resolve(data);\r\n\r\n            return defer.promise();\r\n        }\r\n    }\r\n});\r\n"]}