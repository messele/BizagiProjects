$.Class.extend("bizagi.kendo.templates.services.service",{customTemplateFile:bizagi.loader.getResource("tmpl","bizagi.overrides."+bizagi.detectDevice()+".custom.templates"),cachedFiles:{},cachedTemplates:{},customTemplates:{}},{init:function(e){this.localization=e,this.cssRegex=/{{css "(.+)"}}/g,this.loadingFileDeferred={}},loadCustomTemplates:function(){var e=this,t=new $.Deferred;return $.when(this.getTemplateFile(this.Class.customTemplateFile)).done(function(r){var a=$("<div />").html(r),i=$("script",a);$.each(i,function(t,r){r=$(r),e.Class.customTemplates[r.attr("id")]=r.html()}),t.resolve()}),t.promise()},getTemplate:function(e,t){var r=!1;if(e=(e=e.replace(/([^#]*#)([^#]*#)([^#]*)/g,"$1$3")).replace(/([a-zA-Z_\/.-=]*)#([a-zA-Z_\/.-]*)\?(build=[a-zA-Z0-9.-]*)/g,"$1?$3#$2"),bizagi.enableCustomizations){var a=this.getHash(e);this.Class.customTemplates[a]&&(r=!0)}return r||"release"!==bizagi.loader.environment?this.internalGetTemplate(e,t).pipe(function(e){return e}):this.getTemplateForRelease(e,t).pipe(function(e){return e})},getTemplateWidget:function(e,t){var r=!1;if(e=(e=e.replace(/([^#]*#)([^#]*#)([^#]*)/g,"$1$3")).replace(/([a-zA-Z_\/.-=]*)#([a-zA-Z_\/.-]*)\?(build=[a-zA-Z0-9.-]*)/g,"$1?$3#$2"),bizagi.enableCustomizations){var a=this.getHash(e);this.Class.customTemplates[a]&&(r=!0)}return r||"release"!==bizagi.loader.environment?this.internalGetTemplate(e,t).pipe(function(e){return e}):this.getTemplateForRelease(e,t).then(function(e){return e})},getTemplateWebpart:function(e,t){return e=(e=e.replace(/([^#]*#)([^#]*#)([^#]*)/g,"$1$3")).replace(/([a-zA-Z_\/.-=]*)#([a-zA-Z_\/.-]*)\?(build=[a-zA-Z0-9.-]*)/g,"$1?$3#$2"),this.internalGetTemplate(e,t).pipe(function(e){return e})},getTemplateForRelease:function(e,t){var r,a,i=this,s=$.Deferred();return i.containsHash(e)?(r=i.getUrlWithoutHashes(e),a=i.getHash(e)):(r=e,a=""),i.Class.cachedTemplates[r]?s.resolve(i.processAndReturnTemplate(r,a,t)):$.when(i.loadTemplateFileForRelease(r)).done(function(){s.resolve(i.processAndReturnTemplate(r,a,t))}),s.promise()},loadTemplateFileForRelease:function(e){var t=this,r=$.Deferred();return t.Class.cachedTemplates[e]?t.Class.cachedTemplates[e]:t.loadingFileDeferred[e]?($.when(t.loadingFileDeferred[e]).done(function(){r.resolve(t.Class.cachedTemplates[e])}),r.promise()):(t.loadingFileDeferred[e]=$.Deferred(),$.when($.ajax({url:e,dataType:"text"}),t.localization.ready()).done(function(a){var i,s,o;for(i in a||r.reject(""),"string"!=typeof a&&(a=JSON.parse(a[0])),t.Class.cachedTemplates[e]=a,a)a.hasOwnProperty(i)&&(s=a[i],o=(o=t.localization.translate(s)).replace(t.cssRegex,""),t.Class.cachedTemplates[e][i]=o);t.loadingFileDeferred[e].resolve(),r.resolve(a)}),r.promise())},processAndReturnTemplate:function(e,t,r){var a=this,i=a.Class.cachedTemplates[r];if(!i){if(!(i=a.Class.cachedTemplates[e][t]))throw"template "+i+"doesn't exist";a.Class.cachedTemplates[r]=i}return i},internalGetTemplate:function(e,t){var r=this,a=new $.Deferred,i=this.Class.cachedTemplates[t];if(i)a.resolve(i);else if(r.containsHash(e)){var s=r.getUrlWithoutHashes(e),o=r.getHash(e);if(r.Class.customTemplates[s]&&r.Class.customTemplates[s][t])return a.resolve(r.Class.customTemplates[o]),a.promise();$.when(r.getTemplatePart(s,o,t)).done(function(e){r.Class.cachedTemplates[t]=e,a.resolve(e)})}else $.when(r.getTemplateFile(e)).done(function(e){r.Class.cachedTemplates[t]=e,a.resolve(e)});return a.promise()},getTemplatePart:function(e,t){var r=this,a=new $.Deferred;return $.when(r.loadingTemplatePartExecution).done(function(){r.loadingTemplatePart=!0,r.loadingTemplatePartExecution=new $.Deferred,$.when(r.getTemplateFile(e)).done(function(i){var s=$("<div />").html(i),o=$("#"+t,s);"debug"===BIZAGI_ENVIRONMENT&&0===o.length&&console.warn("No template part ("+t+") found in content for:"+e),i=o.html(),r.loadingTemplatePartExecution.resolve(),r.loadingTemplatePart=!0,a.resolve(i)})}),a.promise()},getTemplateFile:function(e){var t=this,r=this.Class.cachedFiles[e];return r||$.when($.ajax({url:e,dataType:"text"}),t.localization.ready()).pipe(function(r){if(!r)return"";"string"!=typeof r&&(r=r[0]);var a=t.localization.translate(r),i=a.match(t.cssRegex);return i&&$.each(i,function(e,r){var a=r.replace(t.cssRegex,"$1");bizagi.loader.loadFile({src:a,type:"css",environment:"debug"})}),a=a.replace(t.cssRegex,""),t.Class.cachedFiles[e]="string"==typeof a?a:a[0].outerHTML,a})},containsHash:function(e){return-1!==e.indexOf("#")},getHash:function(e){return e.substring(e.indexOf("#")+1,e.length)},getUrlWithoutHashes:function(e){return e.substring(0,e.indexOf("#"))}}),bizagi.override.enableMSF||(jQuery.fn.fastEmpty=function(){$(this).kendoTmplEmpty()},jQuery.fasttmpl=function(e,t){return jQuery.kendoTmpl(e,t)},jQuery.cacheTemplate=function(e,t){jQuery.cacheKendoTemplate(e,t)}),jQuery.fn.kendoTmplEmpty=function(){this.children().remove();var e=$(this);e.hasClass("ui-bizagi-component-loading")&&e.loadingMessage()},jQuery.kendoTmpl=function(e,t){if(void 0===e)return"";e=(e=e.replace(/(\n*)|(\r*)|(\t*)/g,"")).replace(/\s+/g," ");var r=kendo.template(e,{useWithBlock:!1})(t);return $.trim(r.replace(/>\s*</g,"><"))},jQuery.kendoTmpls=function(e,t){return $(jQuery.kendoTmpl(e,t))},jQuery.cacheKendoTemplate=function(e,t){var r=bizagi.kendo.templates.services.service.cachedTemplates[e];return jQuery.kendoTmpl(r,t)},function(){var e,t,r=window.steal||{},a=window.bizagi||{};a.loader=a.loader||{},"release"===a.loader.environment&&(t={registerMobileWebpart:function(e){"string"==typeof e&&(e=[e]),this.webparts=this.webparts||{},e.map(function(e){this.webparts[e]||(this.webparts[e]={class:"bizagi.workportal.webparts."+e,devices:null,location:"",name:e,js:[],css:[],tmpl:[]}),this.webparts[e].initialized=!0,this.webparts[e].initializing=!1,this.webparts[e].loadingDeferred=this.webparts[e].loadingDeferred||new $.Deferred}.bind(this))}},Object.keys(t).map(function(e){a.loader[e]=t[e]}),e=!1,r.origRequest=r.request,r.request=function(t,i,s){if(!(arguments[0]&&arguments[0].src&&(arguments[0].src+"").match(/\/workportalflat\/webparts\//i)))return this.origRequest(t,i,s);var o=a.detectDevice().replace(/[^a-z0-9]+/gi,"");if(!e){var n=a.loader.useAbsolutePath?a.loader.basePath+a.loader.getLocationPrefix():""+a.loader.getLocationPrefix(),l=n+"jquery/workportalflat/production/"+o+"/webpart."+o+".production.js?build="+a.loader.build,c=n+"jquery/workportalflat/production/"+o+"/webpart."+o+".production.css?build="+a.loader.build;e=!0,a.loader.loadFile({type:"js",src:l}),a.loader.loadFile({type:"css",src:c})}var d=arguments[0].id+"";a.loader.registerMobileWebpart(o),r.resources[d].completed.resolve(),r.resources[d].loaded.resolve(),r.resources[d].loading=!1,r.resources[d].executing=!1,r.resources[d].options.text=JSON.stringify(a.loader.webparts[o]),i(r.resources[d].options.text)})}(),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.util=void 0!==bizagi.util?bizagi.util:{},bizagi.context=void 0!==bizagi.context?bizagi.context:{},bizagi.util.smartphone=void 0!==bizagi.util.smartphone?bizagi.util.smartphone:{},bizagi.util.tablet=void 0!==bizagi.util.tablet?bizagi.util.tablet:{},bizagi.util.mobility=void 0!==bizagi.util.mobility?bizagi.util.mobility:{},bizagi.util.smartphone.startLoading=function(){bizagi.loading.start()},bizagi.util.smartphone.stopLoading=function(){bizagi.loading.stop()},bizagi.util.mobility.getResource=function(e,t){return bizagi.localization.getResource(e,t)},bizagi.loader.initWebpartOld=bizagi.loader.initWebpart,bizagi.loader.initWebpart=function(e,t,r){return null!=e&&(e.initialized?steal.then(function(){r&&r()}):e.devices?void 0!==e.devices[t]?bizagi.loader.initWebpartOld($.extend(e,e.devices[t]),t,r):console.log("No existe la definicion del device "+t+" Para el webpart "+e.name):bizagi.loader.initWebpartOld(e,t,r)),this},bizagi.util.initWebpart=function(e,t){var r=new $.Deferred;return t=t||bizagi.detectDevice(),e.initialized?r.resolve():e.initializing?$.when(e.loadingDeferred.promise()).done(function(){r.resolve()}):(e.loadingDeferred=new $.Deferred,e.initializing=!0,bizagi.loader.initWebpart(e,t,function(){e.loadingDeferred.resolve(),e.initializing=!1,r.resolve()})),r.promise()},bizagi.util.isDate=function(e){var t=!1,r="string"==typeof(e=e||"")?e.split("/"):"";try{if(3==r.length)new Date(e).getYear()>0&&(t=!0)}catch(e){t=!1}return t},bizagi.util.setContext=function(e,t){e=e||{},(t=t||!1)&&(bizagi.context={}),$.each(e,function(e,t){bizagi.context[e]=t})},bizagi.getTimeAgo=function(e){return $.timeago(new Date(e))},bizagi.getGroupedData=function(e){var t={},r=new Date,a=r.getFullYear(),i=r.getMonth(),s=r.getDate();e=bizagi.util.isDate(e)?e:r;var o=new Date(e),n=o.getMonth(),l=o.getFullYear(),c=o.getDate();return new Date(l,n,c,0,0,0)-new Date(a,i,s,0,0,0)<0?(t.date=bizagi.util.dateFormatter.formatDate(new Date(o),"dd MMM"),t.type=bizagi.localization.getResource("workportal-taskfeed-overdue"),t.status="red"):s===c?(t.date=bizagi.util.dateFormatter.formatDate(new Date(o),"hh:mm"),t.type=bizagi.localization.getResource("workportal-taskfeed-today"),t.status="yellow"):s+1===c?(t.date=bizagi.util.dateFormatter.formatDate(new Date(o),"hh:mm"),t.type=bizagi.localization.getResource("workportal-taskfeed-tomorrow"),t.status="yellow"):(t.date=bizagi.util.dateFormatter.formatDate(new Date(o),"dd MMM"),t.type=bizagi.localization.getResource("workportal-taskfeed-upcomming"),t.status="green"),t},bizagi.util.getTaskStatus=function(e){var t=new Date,r=t.getMonth(),a=t.getDate(),i=t.getFullYear(),s=e||"";if(!bizagi.util.isDate(s))return"--";var o=new Date(s),n=o.getDate(),l=o.getMonth(),c=o.getFullYear();return new Date(c,l,n,0,0,0)-new Date(i,r,a,0,0,0)<0?bizagi.util.dateFormatter.formatDate(new Date(s),"dd MMM"):r===l&&a===n?bizagi.util.dateFormatter.formatDate(new Date(s),"hh:mm"):r===l&&a+1===n?bizagi.util.dateFormatter.formatDate(new Date(s),"hh:mm"):bizagi.util.dateFormatter.formatDate(new Date(s),"dd MMM")},bizagi.util.formatDataType=function(e,t){return"NText"===t||"VarChar"===t?"<div>"+bizagi.util.replaceLineBreak(e)+"</div>":"Boolean"===t?bizagi.util.formatBoolean(e):"Int"===t||"BigInt"===t||"SmallInt"===t||"TinyInt"===t?e:"Money"===t?bizagi.util.formatMonetaryCell(e):"Float"===t||"Real"===t?bizagi.util.formatDecimalCell(e):"DateTime"===t?bizagi.util.dateFormatter.formatDate(new Date(e),bizagi.localization.getResource("dateFormat")+" "+bizagi.localization.getResource("timeFormat")):e},bizagi.util.formatDateTime=function(e){if(e="string"!=typeof(e=null==e?"":e)?e.toString():e,Date.parse(e)){var t=new Date(e);return(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+t.getFullYear()+" "+((t.getHours()<12&&e.toLowerCase().indexOf("pm")>0?t.getHours()+12:t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()))}return e},bizagi.util.formatMonetaryCell=function(e){return bizagi.util.formatMoney(e,BIZAGI_DEFAULT_CURRENCY_INFO)},bizagi.util.formatDecimal=function(e,t){var r=$("<i/>").text(e);return r.formatCurrency(t),r.text()},bizagi.util.syntaxHighlight=function(e){return void 0===e||null==e?"":(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),"<span class='"+t+"'>"+e+"</span>"})},bizagi.util.b64EncodeUnicode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.util=void 0!==bizagi.util?bizagi.util:{},bizagi.util.smartphone=void 0!==bizagi.util.smartphone?bizagi.util.smartphone:{},bizagi.util.mobility=void 0!==bizagi.util.mobility?bizagi.util.mobility:{},bizagi.environment="undefined"!=typeof BIZAGI_ENVIRONMENT?BIZAGI_ENVIRONMENT:queryString.environment||"debug",bizagi.util.smartphone.startLoading=function(){bizagi.loading.start()},bizagi.util.smartphone.stopLoading=function(){bizagi.loading.stop()},bizagi.util.smartphone.startkendo=function(e){void 0===bizagi.kendoMobileApplication?(bizagi.kendoMobileApplication=new kendo.mobile.Application($("body"),{transition:"slide",skin:"flat",initial:"initKendo",init:function(t){kendo.ui.progress($(".km-flat"),!0),bizagi.util.setIphoneXOverrides(),e.started&&e.started()}}),bizagi.kendoMobileApplication.bizagiNavigate=function(e,t){this.navigate(e,t)}):e.started&&e.started()},$.Class.extend("bizagi.workportal.controllers.controller",{},{init:function(e,t,r){this.workportalFacade=e,this.dataService=t,this.resources=bizagi.localization,this.container=r.container||document,this.componentContainers={},bizagi.workportal.controllers.instances={},bizagi.workportal.controllers.instances.controller=this},getWorkportal:function(){return this.workportalFacade.workportal},publish:function(e,t){return $(this.container).triggerHandler(e,t)},subscribe:function(e,t){$(this.container).bind(e,t)},subscribeEvent:function(e,t){$(document).bind(e,t)},subscribeOneTime:function(e,t){$(this.container).one(e,t)},unsubscribe:function(e,t){t?$(this.container).unbind(e,t):$(this.container).unbind(e)},render:function(){bizagi.showMessageBox("controllers render","Error");var e=this,t=new $.Deferred;return $.when(e.renderContent()).done(function(){e.postRender(),t.resolve(e.getContent())}),t.promise()},getContent:function(){return this.content},getResource:function(e,t){return this.resources.getResource(e,t)},renderContent:function(){return""},postRender:function(){}}),$.Class.extend("bizagi.workportal.services.context",{},{init:function(e){this.context=e.context,this.endPoints=bizagi.workportal.services.getEndPoints(e),this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix},getUrl:function(e){return void 0===this.endPoints[e]&&bizagi.log("Url not found","No endpoint defined for: "+e),this.endPoints[e]},setProxyPrefix:function(e){this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.endPoints=bizagi.workportal.services.getEndPoints(e)}}),bizagi.workportal=void 0!==bizagi.workportal?bizagi.workportal:{},bizagi.workportal.services=void 0!==bizagi.workportal.services?bizagi.workportal.services:{},bizagi.workportal.services.endPoints=[],bizagi.workportal.services.getEndPoints=function(e){if("workportal"==e.context){var t={"user-handler":e.proxyPrefix+"RestServices/UserHandler.ashx","process-handler":e.proxyPrefix+"RestServices/ProcessHandler.ashx","query-handler":e.proxyPrefix+"Rest/Handlers/Query","case-handler":e.proxyPrefix+"RestServices/CaseHandler.ashx","query-form":e.proxyPrefix+"App/ListaDetalle/QueryForm.aspx","query-form-edit":e.proxyPrefix+"App/ListaDetalle/SaveQuery.aspx","query-form-delete":e.proxyPrefix+"App/ListaDetalle/QueryForm.aspx","query-form-delete-cube":e.proxyPrefix+"Rest/Queries/Cubes/{idCube}","favorites-handler":e.proxyPrefix+"RestServices/FavoritesHandler.ashx","file-handler":e.proxyPrefix+"RestServices/EntityHandler.ashx","login-handler":e.proxyPrefix+"Rest/Users/UserAuthentication","login-handlerv10":e.proxyPrefix+"RestServices/UserHandler.ashx?action=authenticateUser&userName={0}&password={1}&domain={2}","logoff-handler":e.proxyPrefix+"RestServices/UserHandler.ashx?action=logOff","logoff-handlerv1":e.proxyPrefix+"Rest/Users/LogOff","authorization-handler-getMenuAuthorization":e.proxyPrefix+"Rest/Authorization/MenuAuthorization","authorization-handler-isCaseCreationAuthorized":e.proxyPrefix+"Rest/Authorization/Processes/{0}/IsCaseCreationAuthorized","case-handler-getCaseSummary":e.proxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-releaseActivity":e.proxyPrefix+"Rest/Cases/{idCase}/ReleaseActivity","case-handler-getCasesList":e.proxyPrefix+"Rest/Processes/SearchCases","case-handler-getActivityList":e.proxyPrefix+"Api/Cases/Activities","offline-getProcessTree":e.proxyPrefix+"Rest/Processes/OfflineProcessTree","offline-tasks":e.proxyPrefix+"Api/Cases/GetOfflineTasks","offline-getForms":e.proxyPrefix+"Rest/RenderForm/offlineForms","offline-sendForm":e.proxyPrefix+"Rest/Cases/SaveAsynchWorkItemOffLine","case-handler-getCaseTasks":e.proxyPrefix+"Rest/Cases/{idCase}/Tasks","case-handler-getCaseEvents":e.proxyPrefix+"Rest/Cases/{idCase}/Events","case-handler-getCaseSubprocesses":e.proxyPrefix+"Rest/Cases/{idCase}/Subprocesses","case-handler-getTaskAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/Tasks/{idTask}/Assignees","case-handler-getCaseAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/Assignees","case-handler-getWorkItems":e.proxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getAsynchExecutionState":e.proxyPrefix+"Rest/Cases/{idCase}/AsynchExecutionState","case-handler-addNewCase":e.proxyPrefix+"Rest/Cases","case-handler-startProcess":e.proxyPrefix+"Rest/Processes/StartProcess/{idProcess}","handler-execute-action-start":e.proxyPrefix+"Api/Cases/{processId}/Start","case-handler-supportedLogTypes":e.proxyPrefix+"Rest/Cases/SupportedLogsTypes","case-handler-getActivityLog":e.proxyPrefix+"Rest/Cases/{idCase}/ActivityLog","case-handler-getActivityDetailLog":e.proxyPrefix+"Rest/Cases/{idCase}/{idWorkItemFrom}/ActivityDetailLog","case-handler-getEntityLog":e.proxyPrefix+"Rest/Cases/{idCase}/EntityLog","case-handler-getEntityDetailLog":e.proxyPrefix+"Rest/Cases/{idCase}/EntityDetailLog","case-handler-getUserLog":e.proxyPrefix+"Rest/Cases/{idCase}/UserLog","case-handler-getUserDetailLog":e.proxyPrefix+"Rest/Cases/{idCase}/{idUser}/UserDetailLog","case-handler-getAdminLog":e.proxyPrefix+"Rest/Cases/{idCase}/AdminLog","case-handler-getCaseFormsRenderVersion":e.proxyPrefix+"Rest/Cases/{idCase}/FormsRenderVersion","case-handler-validateHasStartForm":e.proxyPrefix+"Api/Processes/{processId}/StartContext","favorites-handler-saveFavorite":e.proxyPrefix+"Rest/Favorites","favorites-handler-deleteFavorite":e.proxyPrefix+"Rest/Favorites/{guidFavorite}","process-getIcon":e.proxyPrefix+"Api/Processes/{processId}/Icon","collections-getIcon":e.proxyPrefix+"Api/CurrentUser/Collections/{collectionId}/Icon","bamAnalytics-handler-getAnalisysQueries":e.proxyPrefix+"Rest/BAMAnalytics/AnalisysQueries","bamAnalytics-handler-updateQuery":e.proxyPrefix+"Rest/BAMAnalytics/Reports/Ids/{idQuery}","inbox-handler-getInboxSummary":e.proxyPrefix+"Rest/Inbox/Summary","MessageHandler-NewComment":e.proxyPrefix+"Rest/Cases/Comments","MessageHandler-GetComments":e.proxyPrefix+"Rest/Cases/Comments","MessageHandler-SetCategoryToComment":e.proxyPrefix+"Rest/Cases/Comments/{idComment}","MessageHandler-RemoveComment":e.proxyPrefix+"Rest/Cases/Comments/{idComment}","MessageHandler-ReplyComment":e.proxyPrefix+"Rest/Cases/Comments/{idComment}/Replies","MessageHandler-RemoveReply":e.proxyPrefix+"Rest/Cases/Comments/{idComment}/Replies/{idReply}","MessageHandler-GetCategoryColors":e.proxyPrefix+"Rest/Cases/Comments/CategoryColors","MessageHandler-RenameCategoryColor":e.proxyPrefix+"Rest/Cases/Comments/CategoryColors/{idColorCategory}","MessageHandler-CountNewComments":e.proxyPrefix+"Rest/Cases/Comments/{idComment}/NewComments/Count","process-handler-getAllProcesses":e.proxyPrefix+"Rest/Processes","process-handler-getFavourites":e.proxyPrefix+"Rest/Home/MyFavorites/Count","process-handler-getFavouriteCases":e.proxyPrefix+"Rest/Home/MyFavorites","process-handler-getCustomizedColumnsData":e.proxyPrefix+"Rest/Processes/CustomizedColumnsData","process-handler-getCategory":e.proxyPrefix+"Rest/Processes/Categories","process-handler-getRecentProcesses":e.proxyPrefix+"Rest/Processes/RecentProcesses","process-handler-getCustomizedColumnsDataInfo":e.proxyPrefix+"Rest/Processes/CustomizedColumnsDataInfo","process-handler-getOrganizations":e.proxyPrefix+"Rest/Profile/Organizations","process-handler-getMyStuff":e.proxyPrefix+"Api/CurrentUser/Collections","process-handler-getIdCasesOfProcessEntities":e.proxyPrefix+"Api/Entities/Cases","templates-handler-getCollectionData":e.proxyPrefix+"Api/Collection/{idFact}/Data","data-navigation-handler-collection":e.proxyPrefix+"Api/CurrentUser/Collections/{reference}/Data/{surrogateKey}","data-navigation-handler-entity":e.proxyPrefix+"Api/CurrentUser/Entities/{reference}/Data/{surrogateKey}/{xpath}","data-navigation-handler-entity-filters":e.proxyPrefix+"Api/CurrentUser/Entities/{reference}/Filters/{surrogateKey}/{xpath}","action-handler-getProcessAddAction":e.proxyPrefix+"Api/CurrentUser/Collections/{reference}/{surrogateKey}/Actions","my-search-getSearchLists":e.proxyPrefix+"Api/CurrentUser/Searches","my-search-getFilters":e.proxyPrefix+"Api/CurrentUser/Searches/{guidSearch}/Filters","my-search-getFiltersData":e.proxyPrefix+"Api/CurrentUser/Searches/{guidSearch}/FilterData","my-search-getData":e.proxyPrefix+"Api/CurrentUser/Searches/{guidSearch}/Data","templates-handler-getVirtualCollectionData":e.proxyPrefix+"Api/Collection/{guidVirtualCollection}/VirtualData","templates-handler-getMultipleActions":e.proxyPrefix+"Rest/Entities/multipleInstancesActions","process-handler-getMapping":e.proxyPrefix+"Rest/Entities/Mapping","process-handler-getForm":e.proxyPrefix+"Rest/Handlers/Render","process-handler-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","process-handler-rule":e.proxyPrefix+"Api/Rules/{ruleId}/Execute","process-action-execute":e.proxyPrefix+"Api/Rules/{ruleId}/ExecuteMultiple","process-handler-getActivitiesData":e.proxyPrefix+"Api/Processes/CasesData/MyActivities","process-handler-getPendingsData":e.proxyPrefix+"Api/Processes/CasesData/MyPendings","entities-handler-getActions":e.proxyPrefix+"Api/Entities/{guidEntity}/{surrogateKey}/actions","entities-handler-getUsersAndEvents":e.proxyPrefix+"Rest/Processes/CasesData/UsersAndEvents","entities-handler-getUsers":e.proxyPrefix+"Api/Cases/{caseId}/Users","entities-handler-getEvents":e.proxyPrefix+"Api/Cases/{caseId}/CurrentEvents","entities-handler-getUsersImages":e.proxyPrefix+"Rest/Users/UserPictures","entities-handler-getShotCuts":e.proxyPrefix+"Api/CurrentUser/Shortcuts","query-handler-getqueries":e.proxyPrefix+"Rest/Queries","query-handler-getQueryForm":e.proxyPrefix+"Rest/Handlers/Render","user-handler-getCurrentUser":e.proxyPrefix+"Rest/Users/CurrentUser","old-render":e.proxyPrefix+"App/ListaDetalle/Detalle.aspx",Reports:e.proxyPrefix+"RestServices/BAMAnalyticsHandler.ashx","reports-handler-deleteQueries":e.proxyPrefix+"Rest/BAMAnalytics/Reports/{QueryId}","folders-handler-getUserQueries":e.proxyPrefix+"Rest/SmartFolders","folders-associate-deleteSmartFolder":e.proxyPrefix+"Rest/SmartFolders/{idSmartFolder}","folders-handler":e.proxyPrefix+"RestServices/SmartFoldersHandler.ashx","folders-associate":e.proxyPrefix+"App/Ajax/AJAXGateway.aspx","smartfolders-integration":e.proxyPrefix+"App/WorkPortal/ConfigureFilteredFolder.aspx",AlarmAdmin:e.proxyPrefix+"App/Admin/AlarmsAdmin.aspx",AnalyticsProcess:e.proxyPrefix+"App/Cockpit/AnalyticsProcess.aspx",AnalyticsSensor:e.proxyPrefix+"App/Cockpit/AnalyticsSensor.aspx",AnalyticsTask:e.proxyPrefix+"App/Cockpit/AnalyticsTask.aspx",AsynchronousWorkitemRetries:e.proxyPrefix+"App/Admin/AsynchDisabledWorkitems.aspx",AuthenticationLogQuery:e.proxyPrefix+"App/Admin/AuthLogQuery.aspx",BAMProcess:e.proxyPrefix+"App/Cockpit/BAMProcess.aspx",BAMTask:e.proxyPrefix+"App/Cockpit/BAMTask.aspx",BusinessPolicies:e.proxyPrefix+"App/Admin/BusinessPolicies/BusinessPoliciesSelector.aspx",CaseAdmin:e.proxyPrefix+"App/Admin/CaseSearch.aspx",adminReassignCases:"CaseAdmin",asyncECMUpload:"asyncECMUpload",CasesMonitor:e.proxyPrefix+"App/Admin/CasesMonitor.aspx",Closed:e.proxyPrefix+"App/ListaDetalle/listaitems.aspx?h_Location=Cerrados&I_ProcessState=Completed",CurrentUser:e.proxyPrefix+"App/Admin/CurrentUser.aspx",EncryptionAdmin:e.proxyPrefix+"App/Admin/Encrypt.aspx",MobileUpdatesAdmin:e.proxyPrefix+"App/MobileUpdates/default.aspx",EntityAdmin:e.proxyPrefix+"App/Admin/Entity.aspx",LocationResources:e.proxyPrefix+"App/Admin/AdminLocResources.aspx",NewCase:e.proxyPrefix+"App/Radicar/application.aspx",Pending:e.proxyPrefix+"App/ListaDetalle/listaitems.aspx?h_Location=Pendientes&I_processState=Running",Profiles:e.proxyPrefix+"App/Admin/ProfilesAdminSearch.aspx",Search:e.proxyPrefix+"App/ListaDetalle/Search.aspx",UserAdmin:e.proxyPrefix+"App/Admin/ListUsers.aspx",UserDefaultAssignation:e.proxyPrefix+"App/Admin/DefaultAssignationUser.aspx?h_AdminDefaultAssign=1",UserPendingRequests:e.proxyPrefix+"App/Admin/UserPendingRequests.aspx",ListPreferences:""!==bizagi.UserPreferencesUrl?e.proxyPrefix+bizagi.UserPreferencesUrl:e.proxyPrefix+"App/Admin/CurrentUser.aspx",GRDimensionAdmin:e.proxyPrefix+"App/Cockpit/DimensionEdit.aspx",Licenses:e.proxyPrefix+"App/Admin/Licenses.aspx",AnalysisQueries:e.proxyPrefix+"App/Inicio/WPAnalysisQuery.aspx",DocumentTemplates:e.proxyPrefix+"App/Admin/AdminDocumentTemplates.aspx",ProcessAdmin:e.proxyPrefix+"App/Admin/AdminProcess.aspx",ResourceBAM:e.proxyPrefix+"App/Cockpit/BAMResourceMonitor.aspx",WorkPortalVersion:e.proxyPrefix+"Rest/Util/Version","entities-administration":"RestServices/EntityHandler.ashx","theme-handler-getLogoImagePath":e.proxyPrefix+"Rest/Theme/LogoImage",logout:e.proxyPrefix+"Rest/Authentication/logout",logoutDotNet:e.proxyPrefix+"App/Inicio/LogOff.aspx",authenticationConfig:e.proxyPrefix+"Api/Authentication/BizagiConfig","logout-oauth2":e.proxyPrefix+"Api/Authentication/OAuth2/IdentityProvider/Server/Logout",FederateLogoffUrl:e.proxyPrefix+"Api/Authentication/FederateLogoffUrl",oauth2AuthenticationConfig:e.proxyPrefix+"Api/Authentication/OAuth2/OAuth2AuthenticationConfig","massive-activity-assignments-getOrganizationInfo":e.proxyPrefix+"Rest/Users/OrganizationInfo","massive-activity-assignments-getCasesByOrganization":e.proxyPrefix+"Rest/Queries/GetCasesByOrganization","massive-activity-assignments-reassignCases":e.proxyPrefix+"Rest/Cases/ReassignCases","massive-activity-assignments-searchUsers":e.proxyPrefix+"Rest/Users/","async-ecm-upload-baseService":e.proxyPrefix+"Rest/Handlers/Metadata",domains:e.proxyPrefix+"Rest/Authentication/Domains",getCurrentTheme:e.proxyPrefix+"Api/Theme/Current","admin-getAuthenticationLog":e.proxyPrefix+"Rest/Users/AuthLog","admin-getAuthenticationDomains":e.proxyPrefix+"Rest/Users/Domains","admin-getAuthenticationEventsTypes":e.proxyPrefix+"Rest/Users/EventTypes","admin-getAuthenticationEventSubTypes":e.proxyPrefix+"Rest/Users/EventSubTypes","admin-EncryptString":e.proxyPrefix+"Rest/Util/EncryptString","admin-UserPendingRequests":e.proxyPrefix+"Rest/Users/UserPendingRequests","admin-UserAuthenticationInfo":e.proxyPrefix+"Rest/Users/UserAuthenticationInfo","admin-updateUserAuthenticationInfo":e.proxyPrefix+"Rest/Users/UpdateUserAuthenticationInfo","admin-generateRandomPassword":e.proxyPrefix+"Rest/Util/GenerateRandomPassword","admin-GenerateDataToSendByEmail":e.proxyPrefix+"Rest/Users/GenerateDataToSendByEmail","admin-sendEmail":e.proxyPrefix+"Rest/Util/SendEmail/","admin-getApplicationList":e.proxyPrefix+"Rest/Application","admin-getApplicationProcesses":e.proxyPrefix+"Rest/Application/{idApp}/Process","admin-getProcessVersion":e.proxyPrefix+"Rest/Processes/Version","admin-getProcessTasks":e.proxyPrefix+"Rest/Processes/Version/{version}/Tasks","admin-getTaskAlarms":e.proxyPrefix+"Rest/Alarm/TaskAlarms","admin-getLapseMode":e.proxyPrefix+"Rest/Alarm/LapseMode","admin-getRecurrMode":e.proxyPrefix+"Rest/Alarm/RecurrMode","admin-getScheduleType":e.proxyPrefix+"Rest/Alarm/ScheduleType","admin-getBossList":e.proxyPrefix+"Rest/Alarm/Boss","admin-addAlarm":e.proxyPrefix+"Rest/Alarm","admin-editAlarm":e.proxyPrefix+"Rest/Alarm/{idAlarm}","admin-deleteAlarm":e.proxyPrefix+"Rest/Alarm","admin-alarmRecipients":e.proxyPrefix+"Rest/Alarm/{idAlarm}/Recipient","admin-deleteAlarmRecipients":e.proxyPrefix+"Rest/Alarm/Recipient","admin-recipientToAlarm":e.proxyPrefix+"Rest/Alarm/{idAlarm}/Recipient/{idRecipient}","admin-enableAlarm":e.proxyPrefix+"Rest/Alarm/Task/{idTask}/ToggleAlarm","admin-getCategoriesList":e.proxyPrefix+"Rest/Application/Category","admin-getCasesList":e.proxyPrefix+"Rest/Queries/SearchCases","admin-abortItems":e.proxyPrefix+"Rest/Cases/Abort","admin-reassignItems":e.proxyPrefix+"Rest/Cases/Reassign","admin-getDefaultAssignationUserToAllProcess":e.proxyPrefix+"Rest/Users/{serviceAction}/","admin-getDefaultAssignationUserToProcess":e.proxyPrefix+"Rest/Users/Process/{process}/AssignationUser","admin-setDefaultAssignationUserToProcess":e.proxyPrefix+"Rest/Users/Process/{process}/AssignationUser","admin-getProfilesTypes":e.proxyPrefix+"Rest/Profile/Types","admin-searchProfiles":e.proxyPrefix+"Rest/Profile","admin-getUsersByProfile":e.proxyPrefix+"Rest/Users/Profile/{type}/{id}","admin-removeUserFromProfile":e.proxyPrefix+"Rest/Profile/{type}/{id}/User/{idUser}/","admin-addUserToProfile":e.proxyPrefix+"Rest/Profile/{type}/{id}/User/{idUser}/","admin-async-activities-get-activities":e.proxyPrefix+"Rest/Cases/Asynchronous/Activities","admin-async-activities-get-retry-now":e.proxyPrefix+"Rest/Cases/{idCase}/Workitem/{idworkItem}/RetryNow","admin-async-activities-get-activities-by-task":e.proxyPrefix+"Rest/Cases/Asynchronous/Activities/Task","admin-async-activities-enable-execution":e.proxyPrefix+"Rest/Cases/Asynchronous/Enable","admin-async-activities-enable-multiple":e.proxyPrefix+"Rest/Cases/Asynchronous/EnableMultiple","admin-async-activities-async-execution":e.proxyPrefix+"Rest/Cases/{idCase}/Workitem/{idWorkitem}/AsynchExecution","admin-async-activities-async-execution-log":e.proxyPrefix+"Rest/Cases/{idCase}/Workitem/{idworkItem}/AsynchExecutionLog","admin-Licenses":e.proxyPrefix+"Rest/Licenses","admin-GetDimensions":e.proxyPrefix+"Rest/Dimensions","admin-EditDimension":e.proxyPrefix+"Rest/Dimensions/{id}","admin-CreateAdministrableDimension":e.proxyPrefix+"Rest/Dimensions/Administrable","admin-DeleteDimension":e.proxyPrefix+"Rest/Dimensions/{id}?isAdministrable={administrable}","admin-EntityPathChildNodesAction":e.proxyPrefix+"Rest/Dimensions/EntityChildNodes","admin-GetActiveWFClasses":e.proxyPrefix+"Rest/Dimensions/ActiveProcess","admin-document-templates-storeDocumentTemplates":e.proxyPrefix+"Rest/DocumentTemplates/StoreDocumentTemplates","admin-document-templates-restoreDocumentTemplates":e.proxyPrefix+"Rest/DocumentTemplates/RestoreDocumentTemplate","admin-document-templates-uploadDocumentTemplate":e.proxyPrefix+"Rest/DocumentTemplates/UploadDocumentTemplate","admin-processes-workflowClasses":e.proxyPrefix+"Rest/Processes/WorkflowClasses","admin-processes-tasksByWorkflow":e.proxyPrefix+"Rest/Processes/TasksByWorkflow","admin-processes-modifyProcessDuration":e.proxyPrefix+"Rest/Processes/{idWorkflow}/Duration/","admin-processes-modifyTaskDuration":e.proxyPrefix+"Rest/Processes/Task/{idTask}/Duration/","admin-language-resource":e.proxyPrefix+"Rest/Multilanguage/Resource","admin-language-languages":e.proxyPrefix+"Rest/Multilanguage/Languages","bam-resourcemonitor-myteam":e.proxyPrefix+"Rest/Reports/BAM/Resources/MyTeam","reports-analysisquery":e.proxyPrefix+"Rest/Reports/AnalysisQueries","reports-analysisquery-update":e.proxyPrefix+"Rest/Reports/AnalysisQueries","reports-analysisquery-delete":e.proxyPrefix+"Rest/Reports/AnalysisQueries","processviewer-processdefinition":e.proxyPrefix+"Rest/Reports/Components/ProcessDefinition","processviewer-processgraphicinfo":e.proxyPrefix+"Rest/Reports/Components/ProcessGraphicInfo","mobile-getLastUpdate":e.proxyPrefix+"Rest/Util/mobileUpdates","discussion-case":e.proxyPrefix+"Api/CaseResource/Discussion?globalParent={globalParent}","discussion-case-v1":e.proxyPrefix+"Api/CaseResource/{globalParent}/Discussion","get-users":e.proxyPrefix+"Rest/Users/UserPictures","new-discussion":e.proxyPrefix+"Api/CaseResource/Discussion","count-comments":e.proxyPrefix+"Api/CaseResource/{idParent}/Comment/Count","comment-case":e.proxyPrefix+"Api/CaseResource/{idParent}/Comment","new-comment":e.proxyPrefix+"Api/CaseResource/Comment","new-comment-attach":e.proxyPrefix+"Api/CaseResource/Attachment","get-list-files":e.proxyPrefix+"Api/CaseResource/File?globalParent={globalParent}","get-list-files-v1":e.proxyPrefix+"Api/CaseResource/{globalParent}/File","project-resource-action":e.proxyPrefix+"Api/CaseResource/{typeResource}","thumbnail-file":e.proxyPrefix+"Api/CaseResource/File/Thumbnails","get-attachment":e.proxyPrefix+"Api/CaseResource/Attachment/{idAttachment}","get-mobile-attachment":e.proxyPrefix+"Api/CaseResource/Mobile/Attachment/{idAttachment}","project-files-upload":e.proxyPrefix+"Api/CaseResource/File","count-files":e.proxyPrefix+"Api/CaseResource/File/Count?globalParent={globalParent}","count-files-v1":e.proxyPrefix+"Api/CaseResource/{globalParent}/File/Count","remove-comment":e.proxyPrefix+"Api/CaseResource/Comment","time-schemas-effectiveduration":e.proxyPrefix+"Api/WorkingTimeSchema/EffectiveDuration?idUser={idUser}&fromDate={fromDate}&toDate={toDate}","case-handler-getCaseAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/Assignees","project-users-get":e.proxyPrefix+"Rest/Users/UserPictures","project-plan-get":e.proxyPrefix+"Api/Plans/{idPlan}","project-plan-activities":e.proxyPrefix+"Api/Plans/{idPlan}/Activities","project-plan-workitems":e.proxyPrefix+"Api/Plans/{idPlan}/WorkItems","project-plan-transitions-get":e.proxyPrefix+"Api/Plans/{idPlan}/Activities/Transitions","project-plan-activity-edit":e.proxyPrefix+"Api/Plans/{idPlan}/Activities/{id}","project-plan-get-by-parent":e.proxyPrefix+"Api/Plans?parentWorkItem={parentWorkItem}","project-plan-parent":e.proxyPrefix+"Api/Plans/{idPlan}/ParentCase","project-plan-update":e.proxyPrefix+"Api/Plans/{idPlan}","project-plan-execute":e.proxyPrefix+"Api/Plans/Execute","project-plan-close":e.proxyPrefix+"Api/Plans/Close","project-plan-delete":e.proxyPrefix+"Api/Plans/{idPlan}","project-plan-first-parent-plan":e.proxyPrefix+"Api/Plans/{idPlan}/FirstParentPlan"};return bizagi.util.getFeatureObject("userService.v1.enabled")&&(t["user-handler-getCurrentUser"]=e.proxyPrefix+"Rest/Users/CurrentUserGuid",t["get-users"]=e.proxyPrefix+"Rest/Users/UserPicturesGuid",t["entities-handler-getUsersImages"]=e.proxyPrefix+"Rest/Users/UserPicturesGuid",t["project-users-get"]=e.proxyPrefix+"Rest/Users/UserPicturesGuid",t["entities-handler-getUsers"]=e.proxyPrefix+"Api/Cases/{caseId}/UsersGuid",t["case-handler-getCaseSummary"]=e.proxyPrefix+"Rest/Cases/{idCase}/SummaryGuid",t["case-handler-getCaseAssignees"]=e.proxyPrefix+"Rest/Cases/{idCase}/AssigneesGuid",t["discussion-case"]=e.proxyPrefix+"Api/CaseResource/DiscussionGuid?globalParent={globalParent}",t["new-discussion"]=e.proxyPrefix+"Api/CaseResource/DiscussionGuid",t["comment-case"]=e.proxyPrefix+"Api/CaseResource/{idParent}/CommentGuid",t["new-comment"]=e.proxyPrefix+"Api/CaseResource/CommentGuid",t["project-files-upload"]=e.proxyPrefix+"Api/CaseResource/FileGuid",t["get-list-files"]=e.proxyPrefix+"Api/CaseResource/FileGuid?globalParent={globalParent}",t["time-schemas-effectiveduration"]=e.proxyPrefix+"Api/WorkingTimeSchema/EffectiveDurationGuid?idUser={idUser}&fromDate={fromDate}&toDate={toDate}",t["project-plan-get"]=e.proxyPrefix+"Api/Plans/Guid/{idPlan}",t["project-plan-update"]=e.proxyPrefix+"Api/Plans/Guid/{idPlan}",t["project-plan-activities"]=e.proxyPrefix+"Api/Plans/{idPlan}/ActivitiesGuid",t["project-plan-workitems"]=e.proxyPrefix+"Api/Plans/{idPlan}/WorkItemsGuid",t["project-plan-first-parent-plan"]=e.proxyPrefix+"Api/Plans/{idPlan}/FirstParentPlanGuid",t["project-plan-activity-edit"]=e.proxyPrefix+"Api/Plans/{idPlan}/ActivitiesGuid/{id}"),t}return{}},$.Class.extend("bizagi.workportal.services.service",{BA_CONTEXT_PARAMETER_PREFIX:"h_",ENTITIES_QUERY_PAGE_SIZE:10},{init:function(e){(e="object"==typeof e?e:{}).context=bizagi.util.isEmpty(e.context)?"workportal":e.context,e.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,e.proxyPrefix=this.normalizeUrl(e.proxyPrefix),bizagi.RPproxyPrefix=e.proxyPrefix,e.sharepointProxyPrefix=bizagi.util.isEmpty(e.sharepointProxyPrefix)?"":e.sharepointProxyPrefix,e.sharepointProxyPrefix=this.normalizeUrl(e.sharepointProxyPrefix),this.serviceLocator=new bizagi.workportal.services.context(e),this.pageSize=10,this.deviceType=e.deviceType||(bizagi.util.isSmartphoneDevice()?bizagi.deviceEnum.smartphone:bizagi.util.isTabletDevice()?bizagi.deviceEnum.tablet:bizagi.deviceEnum.desktop),this.deviceCode=bizagi.util.getDeviceCode(),"undefined"!=typeof BIZAGI_INBOX_ROWS_PER_PAGE&&(this.pageSize=$.isNumeric(BIZAGI_INBOX_ROWS_PER_PAGE)?BIZAGI_INBOX_ROWS_PER_PAGE:this.pageSize)},getUrl:function(e){return this.serviceLocator.getUrl(e.endPoint)},normalizeUrl:function(e){return""!==e&&("/"!=e[e.length-1]&&(e=e.concat("/")),-1==e.indexOf("http://")&&-1==e.indexOf("https://")&&(e="http://"+e)),e},getOverrides:function(){return $.ajax({url:this.serviceLocator.getUrl("overrides")}).pipe(function(e){return e=e||{},$.each(e,function(t,r){var a=r.toUpperCase();"TRUE"!=a&&"FALSE"!=a||(e[t]=bizagi.util.parseBoolean(r))}),e})},getCurrentTheme:function(){var e=this.serviceLocator.getUrl("getCurrentTheme");return $.read(e)},authenticatedUser:function(e){var t=this,r=t.serviceLocator.getUrl("login-handler");return $.read({url:r,data:{userName:BIZAGI_USER,password:BIZAGI_PASSWORD,domain:BIZAGI_DOMAIN}}).pipe(function(e){return e},function(e){return r=(r=(r=(r=t.serviceLocator.getUrl("login-handlerv10")).replace("{0}",BIZAGI_USER||"")).replace("{1}",BIZAGI_PASSWORD||"")).replace("{2}",BIZAGI_DOMAIN||""),$.ajax({url:r,type:"GET",dataType:"json"})})},logoutUser:function(e){var t=this.serviceLocator.getUrl("logoff-handlerv1");return $.read({url:t})},logOffUser:function(e){var t=this.serviceLocator.getUrl("logoff-handler");return $.read({url:t})},getCurrentUser:function(e){return $.read(this.serviceLocator.getUrl("user-handler-getCurrentUser"))},getInboxSummary:function(e){return $.read(this.serviceLocator.getUrl("inbox-handler-getInboxSummary")).pipe(function(e){return e.inboxSummary})},getAllProcesses:function(e){e=e||{};var t={},r=this.serviceLocator.getUrl("process-handler-getAllProcesses");return null!=e.taskState&&(t.taskState=e.taskState),null!=e.onlyFavorites&&""!=e.onlyFavorites&&(t.onlyFavorites=e.onlyFavorites),null!=e.myActivities&&""!=e.myActivities&&(t.myActivities=e.myActivities),null!=e.myPendings&&""!=e.myPendings&&(t.myPendings=e.myPendings),e.smartfoldersParameters&&(r=r+"?"+e.smartfoldersParameters),bizagi.isMobile()&&(t.mobileDevice=!0),$.read(r,t).pipe(function(t){if(e.skipAggrupate)return t;var r={},a={},i=bizagi.localization.getResource("workportal-widget-inbox-all-processes"),s={name:bizagi.localization.getResource("workportal-widget-inbox-all-cases"),path:"",category:i,isFavorite:e.onlyFavorites||!1,guidFavorite:"",idworkflow:"",guidWFClass:"",count:0};for(key in a[i]=[],a[i].workflows=[],a[i].workflows.push(s),t.workflows&&$.each(t.workflows.workflow,function(e,t){a[t.category]||(a[t.category]=[],a[t.category].workflows=[]),a[t.category].workflows.push(t),s.count+=Number(t.count)}),r.categories=[],a)r.categories.push({name:key,workflows:a[key].workflows});return r})},getFavourites:function(){var e=this.serviceLocator.getUrl("process-handler-getFavourites");return $.read(e,{}).pipe(function(e){return e})},getMyStuff:function(e){var t={},r=this.serviceLocator.getUrl("process-handler-getMyStuff");return void 0!==e.icon&&e.icon&&(t.icon=!0),$.read(r,t)},getFavouriteCases:function(e){var t={},r=this.serviceLocator.getUrl("process-handler-getFavouriteCases");return t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,bizagi.isMobile()&&(t.mobileDevice=!0),$.read(r,t).pipe(function(e){return e})},getCasesList:function(e){var t={},r=this.serviceLocator.getUrl("case-handler-getCasesList");return e=e||{},t.pageSize=e.pageSize||10,t.page=e.page||1,t.numberOfFields=e.numberOfFields||"-1",t.idWfClass=e.idWfClass||"-1",$.read(r,t).pipe(function(e){for(var t={overdue:[],today:[],tomorrow:[],upcoming:[],page:e.page,totalPages:e.totalPages},r=new Date,a=r.getMonth(),i=r.getDate(),s=r.getYear(),o=void 0!==e.elements?e.elements.length:0,n=0;o>n;n++){var l=e.elements[n],c=new Date(l[3]),d=c.getDate(),u=c.getMonth(),p=c.getYear();i>d||a>u||s>p?(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"dd MMM yyyy"),t.overdue.push(l)):i==d?(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"hh:mm"),t.today.push(l)):i+1==d?(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"hh:mm"),t.tomorrow.push(l)):(l[3]=bizagi.util.dateFormatter.formatDate(new Date(l[3]),"dd MMM yyyy"),t.upcoming.push(l))}return t})},getCasesListBeta:function(e){var t=this;return t.getMobileCasesList(e).then(function(e){for(var r={elements:[],page:e.page,totalPages:e.totalPages,advanceSearch:e.advanceSearch||!1},a=new Date,i=e.advanceSearch?t.defineActivityStateByTaskState:t.defineActivityStateByDate,s=0;e.elements.length>s;s++){var o=e.elements[s],n={};if(n=i(o[3],o.taskstate),o.length>=10&&parseInt(o[11],10)>0){var l=new Date(o[3]);a.getTime()>l.getTime()?n.state="red":a.getTime()>l.getTime()-6e4*parseInt(o[11],10)?n.state="yellow":n.state="green"}r.elements.push($.extend({},o,n,{endDate:o[3],idworkitem:o[1],idwfclass:bizagi.util.validateFeatureSupport("advancedSearch")?o[10]:o[7]}))}return r})},getMobileCasesList:function(e){var t=this,r={};void 0!==(e=e||{}).radNumber&&(r.radNumber=e.radNumber),r.pageSize=e.pageSize||10,r.page=e.page||1;var a=t.serviceLocator.getUrl("case-handler-getActivityList");return bizagi.util.validateFeatureSupport("advancedSearch")?$.read(a,r).then(function(e){for(var r,a={elements:[],rows:[]},i=-1;r=e.rows[++i];){for(var s,o={},n=["","","","","","",[],"","","","","",""],l=-1;s=e.headers[++l];)o[s.fieldName.toLowerCase()]={displayName:s.displayName,value:r[l]},t.serializeActivity(n,s.fieldName.toLowerCase(),o[s.fieldName.toLowerCase()]);a.elements.push(n),a.rows.push(o)}return{page:e.page||e.currentPage,totalPages:e.totalPages,elements:a.elements,rows:a.rows,advanceSearch:!0}}):(a=t.serviceLocator.getUrl("case-handler-getCasesList"),r.numberOfFields=e.numberOfFields||"-1",r.idWfClass=e.idWfClass||"-1",$.read(a,r))},defineActivityStateByDate:function(e){var t={};if(e){var r=new Date(e),a=new Date,i=new Date(a.getFullYear(),a.getMonth(),a.getDate());t=r.getTime()<i.getTime()-1e3?{group:"1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),state:"red",type:"overdue",icon:"overdue",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),"MMMM dd yyyy | hh:mm tt")}:r.getTime()<a.getTime()+6e4-1e3?{group:"2|"+bizagi.localization.getResource("workportal-taskfeed-today"),state:"red",type:"today",icon:"overdue",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),"MMMM dd yyyy | hh:mm tt")}:r.getTime()<i.getTime()+864e5-1e3?{group:"2|"+bizagi.localization.getResource("workportal-taskfeed-today"),state:"yellow",type:"today",icon:"ontime",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),"MMMM dd yyyy | hh:mm tt")}:r.getTime()<i.getTime()+1728e5-1e3?{group:"3|"+bizagi.localization.getResource("workportal-taskfeed-tomorrow"),state:"green",type:"tomorrow",icon:"upcoming",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),"MMMM dd yyyy | hh:mm tt")}:{group:"4|"+bizagi.localization.getResource("workportal-taskfeed-upcomming"),state:"green",type:"upcoming",icon:"upcoming",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),"MMMM dd yyyy | hh:mm tt")}}else t={group:"1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),state:"red",type:"overdue",shortEndDate:"--",icon:"overdue"};return t},defineActivityStateByTaskState:function(e,t){var r={group:"1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),state:t,type:"overdue",shortEndDate:"--",icon:"overdue"};if(e&&t){var a=new Date(e),i=new Date,s=new Date(i.getFullYear(),i.getMonth(),i.getDate());switch(r={group:"",state:t,type:"",icon:"",shortEndDate:bizagi.util.dateFormatter.formatDate(new Date(e),"MMMM dd yyyy | hh:mm tt")},a.getTime()<s.getTime()-1e3?(r.group="1|"+bizagi.localization.getResource("workportal-taskfeed-overdue"),r.type="overdue"):a.getTime()<s.getTime()+864e5-1e3?(r.group="2|"+bizagi.localization.getResource("workportal-taskfeed-today"),r.type="today"):a.getTime()<s.getTime()+1728e5-1e3?(r.group="3|"+bizagi.localization.getResource("workportal-taskfeed-tomorrow"),r.type="tomorrow"):(r.group="4|"+bizagi.localization.getResource("workportal-taskfeed-upcomming"),r.type="upcoming"),t){case"green":r.icon="upcoming";break;case"yellow":r.icon="ontime";break;case"red":default:r.icon="overdue"}}return r},serializeActivity:function(e,t,r){switch(t){case"radnumber":e[6].push([r.displayName,r.value]);break;case"wfclsdisplayname":e[4]=null!==r.value?r.value.toString():bizagi.localization.getResource("workportal-project-activity-plan");break;case"currenttask":e[5]=null!==r.value?r.value.toString():bizagi.localization.getResource("workportal-project-casedashboard-activity");break;case"cascreationdate":e[12]=r.value;break;case"wiestimatedsolutiondate":e[3]=r.value;break;case"cassolutiondate":break;case"idcase":e[0]=r.value;break;case"idworkitem":e[1]=r.value.toString();break;case"wientrydate":break;case"taskid":e[2]=r.value;break;case"taskstate":e.taskstate=r.value?(""+r.value).toLowerCase():"";break;case"idwfclass":e[10]=e.idwfclass=r.value;break;case"isfavorite":e[9]=r.value;break;case"atrisktime":e[11]=r.value;break;case"guidfavorite":e[8]=r.value;break;case"isevent":e.isEvent=r.value;break;case"datachangesetversion":e.dataChangeset=r.value}},getCurrentActivities:function(e){var t=this,r={};e=e||{},r.page=e.page||1,r.pageSize=e.pageSize||10,void 0!==e.radNumber&&(r.radNumber=e.radNumber);var a=t.serviceLocator.getUrl("case-handler-getActivityList");return $.read(a,r).then(function(e){return t.processActivitiesResponse(e)})},processActivitiesResponse:function(e,t,r){var a,i=-1;for(e.elements=[],e.processes=[];a=e.rows[++i];){for(var s,o={},n=-1;s=e.headers[++n];)o["o_"+s.fieldName.toLowerCase()]={displayName:s.displayName,value:a[n]},o[s.fieldName.toLowerCase()]=a[n];$.extend(o,this.defineActivityStateByDate(o.wiestimatedsolutiondate),{highlightedNumber:this.highlightsString(o.radnumber,t)}),e.elements.push(o),void 0===e.processes.find(function(e){return e.processname==o.wfclsdisplayname})&&e.processes.push({processname:o.wfclsdisplayname,idwfclass:o.idwfclass,active:r?"active":""})}return e},highlightsString:function(e,t){if("string"!=typeof e||"string"!=typeof t)return e;var r=new RegExp(t,"gi");return e.replace(r,function(e,t){return"<strong>"+e+"</strong>"})},getDiscussionCase:function(e){var t=t||{};t.globalParent=e.globalParent;var r=bizagi.util.validateFeatureSupport("discussionCase")?this.serviceLocator.getUrl("discussion-case"):this.serviceLocator.getUrl("discussion-case-v1");return $.read({url:r,data:t,contentType:"application/json"}).pipe(function(e){return e})},editDiscussion:function(e){var t=this.serviceLocator.getUrl("new-discussion");return $.update({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},getUsersDiscussion:function(e){var t=t||{};t.userIds=e,t.width=50,t.height=50;var r=this.serviceLocator.getUrl("get-users");return bizagi.util.getFeatureObject("userService.v1.enabled")?$.ajax({url:r,data:t,type:"POST",dataType:"json"}):$.read(r,t).pipe(function(e){return e})},getEffectiveDuration:function(e){var t=this.serviceLocator.getUrl("time-schemas-effectiveduration");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getUsersData:function(e){var t=this.serviceLocator.getUrl("project-users-get");return bizagi.util.getFeatureObject("userService.v1.enabled")?$.ajax({url:t,data:e,type:"POST",dataType:"json"}):$.read({url:t,data:e,dataType:"json"})},createNewDiscussion:function(e){var t=this.serviceLocator.getUrl("new-discussion");return e=e||{},$.create({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},createNewComment:function(e){var t=(e=e||{}).data||{},r=this.serviceLocator.getUrl("new-comment");return $.create({url:r.replace("{typeResource}","Comment"),data:JSON.stringify(t),dataType:"json",contentType:"application/json"})},updateProjectFile:function(e){var t=this.serviceLocator.getUrl("project-files-upload");return $.update({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},createProjectFile:function(e){var t=this.serviceLocator.getUrl("project-files-upload");return $.create({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},getFilesCount:function(e){e=e||{};var t=bizagi.util.validateFeatureSupport("filesCount")?this.serviceLocator.getUrl("count-files"):this.serviceLocator.getUrl("count-files-v1");return $.read({url:t,data:e,contentType:"application/json"}).pipe(function(e){return e})},getCommentCase:function(e){e=e||{};var t=this.serviceLocator.getUrl("comment-case");return $.read({url:t,data:e,contentType:"application/json"}).pipe(function(e){return e})},getCommentsByParent:function(e){e=e||{};var t=this.serviceLocator.getUrl("count-comments");return $.read({url:t,data:e,contentType:"application/json"}).pipe(function(e){return e})},getFilesList:function(e){var t=bizagi.util.validateFeatureSupport("filesList")?this.serviceLocator.getUrl("get-list-files"):this.serviceLocator.getUrl("get-list-files-v1");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"}).pipe(function(e){return e})},deleteFile:function(e){var t=this.serviceLocator.getUrl("project-resource-action");return $.destroy({url:t.replace("{typeResource}","Attachment"),data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},getFilesThumbnail:function(e){e=e||{};var t=this.serviceLocator.getUrl("thumbnail-file");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"}).pipe(function(e){return e})},getAttachment:function(e){var t=this.serviceLocator.getUrl("get-attachment");return t=t.replace("{idAttachment}",e.idAttachment)},getMobileAttachment:function(e){var t=this.serviceLocator.getUrl("get-mobile-attachment");return(t=t.replace("{idAttachment}",e.idAttachment))+"?sessionId="},getAllAdministrableEntities:function(e){e=e||{};var t={action:"entitiesList",kind:"administrable"};return $.ajax({url:this.serviceLocator.getUrl("entities-administration"),data:t,type:"POST",dataType:"json"}).pipe(function(e){var t={entities:[]};return $.each(e,function(e,r){t.entities.push(r)}),t})},getEntitiesList:function(e){return(e=e||{}).action="entitiesList",e.kind="entitiesData",$.ajax({url:this.serviceLocator.getUrl("entities-administration"),data:e,type:"POST",dataType:"json"})},getCasesByWorkflow:function(e){e=e||{};var t={},r=this.serviceLocator.getUrl("process-handler-getCustomizedColumnsDataInfo");if(bizagi.util.isEmpty(e.taskState)||(t.taskState=e.taskState),bizagi.util.isEmpty(e.idWorkflow)||(t.idWorkflow=e.idWorkflow),1==e.onlyFavorites&&(t.onlyFavorites=!0,t.taskState="all"),t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,bizagi.isMobile()&&(t.mobileDevice=!0),e.smartfoldersParameters){var a=e.smartfoldersParameters.split("&");$.each(a,function(e,r){var a=r.split("=");t[a[0]]=a[1]})}return(e.radnumber||e.radNumber)&&(t.radNumber=e.radNumber?e.radNumber:e.radnumber),(e.idcase||e.idCase)&&bizagi.util.isNumeric(e.idcase||e.idCase)&&(t.idCase=e.idCase?e.idCase:e.idcase),$.read(r,t).pipe(function(e){return $.each(e.cases.rows,function(t,r){var a=[];e.cases.rows[t].radnumber=r.id,$.each(r.fields,function(r,i){if(null!=i)try{null!=i.isRadNumber&&"true"==i.isRadNumber?(e.cases.rows[t].radnumber=i.Value,e.cases.rows[t].casenumberdisplayname=i.DisplayName):null!=i.workitems?e.cases.rows[t].workitems=i.workitems:a.push(i)}catch(e){}}),e.cases.rows[t].fields=a}),e.cases})},getOrganizationsList:function(){var e=this.serviceLocator.getUrl("process-handler-getOrganizations"),t={type:12,name:""};return $.read(e,t)},getCustomizedColumnsData:function(e){e=e||{};var t={},r=this.serviceLocator.getUrl("process-handler-getCustomizedColumnsData");if(t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,t.orderFieldName=e.orderFieldName||"",t.orderType=e.orderType||"0",t.order=e.order||"",bizagi.isMobile()&&(t.mobileDevice=!0),e.taskState=e.taskState||"all",""===e.taskState.toString().toLowerCase()&&(e.taskState="all"),"red"===e.taskState.toString().toLowerCase()&&(e.taskState="Red"),"yellow"===e.taskState.toString().toLowerCase()&&(e.taskState="Yellow"),"green"===e.taskState.toString().toLowerCase()&&(e.taskState="Green"),t.taskState=e.taskState,bizagi.util.isEmpty(e.idWorkflow)||(t.idWorkflow=e.idWorkflow),bizagi.util.isEmpty(e.idTask)||(t.idTask=e.idTask),bizagi.util.isEmpty(e.radNumber)||(t.radNumber=e.radNumber),1==e.onlyFavorites&&(t.onlyFavorites=!0,t.taskState="all"),e.smartfoldersParameters){var a=e.smartfoldersParameters.split("&");$.each(a,function(e,r){var a=r.split("=");t[a[0]]=a[1]})}return $.read(r,t)},getCustomizedColumnsDataBeta:function(e){e=e||{};var t={},r=this.serviceLocator.getUrl("process-handler-getCustomizedColumnsData");if(t.pageSize=e.pageSize||this.pageSize,t.page=e.page||1,t.orderFieldName=e.orderFieldName||"",t.orderType=e.orderType||"0",t.order=e.order||"",t.mobileDevice=!!bizagi.isMobile(),e.taskState=e.taskState||"all",""===e.taskState.toString().toLowerCase()&&(e.taskState="all"),"red"===e.taskState.toString().toLowerCase()&&(e.taskState="Red"),"yellow"===e.taskState.toString().toLowerCase()&&(e.taskState="Yellow"),"green"===e.taskState.toString().toLowerCase()&&(e.taskState="Green"),t.taskState=e.taskState,bizagi.util.isEmpty(e.idWorkflow)||(t.idWorkflow=e.idWorkflow),bizagi.util.isEmpty(e.idTask)||(t.idTask=e.idTask),bizagi.util.isEmpty(e.radNumber)||(t.radNumber=e.radNumber),1==e.onlyFavorites&&(t.onlyFavorites=!0,t.taskState="all"),e.smartfoldersParameters){var a=e.smartfoldersParameters.split("&");$.each(a,function(e,r){var a=r.split("=");t[a[0]]=a[1]})}return $.read(r,t).pipe(function(e){var t={columnTitle:[],lstIdCases:[],elements:[],page:e.page,totalPages:e.totalPages},r=new Date,a=r.getMonth(),i=r.getDate(),s=r.getYear();t.columnTitle=e.cases.columnTitle,t.lstIdCases=e.cases.lstIdCases,t.page=e.cases.page,t.totalPages=e.cases.totalPages;for(var o=0,n=e.cases.rows.length;o<n;o++){var l=e.cases.rows[o],c=new Date(l.fields[3]),d=c.getDate(),u=c.getMonth(),p=c.getYear();i>d||a>u||s>p?(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"dd MMM"),t.elements.push($.extend({},l,{group:"overdue"}))):i==d?(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"hh:mm"),t.elements.push($.extend({},l,{group:"today"}))):i+1==d?(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"hh:mm"),t.elements.push($.extend({},l,{group:"tomorrow"}))):(l.fields[3]=bizagi.util.dateFormatter.formatDate(new Date(l.fields[3]),"dd MMM"),t.elements.push($.extend({},l,{group:"upcoming"})))}return(void 0===t.elements||void 0!==t.elements&&0===t.elements.length)&&t.elements.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")}),t})},getCategories:function(e){var t={};return(e=e||{}).idCategory&&(t.idCategory=e.idCategory),e.idApp&&(t.idApp=e.idApp),bizagi.isMobile()&&(t.mobileDevice=!0),t.groupByApp=e.groupByApp||!1,$.read(this.serviceLocator.getUrl("process-handler-getCategory"),t)},getRecentProcesses:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("process-handler-getRecentProcesses"),e)},getCaseSummary:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("case-handler-getCaseSummary"),data:{idCase:e.idCase,eventAsTasks:e.eventAsTasks||"false",onlyUserWorkItems:e.onlyUserWorkItems||"true",mobileDevice:bizagi.isMobile()||"false"},serviceType:"GETSUMMARY"}).pipe(function(e){return e})},getCaseAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseAssignees"),{idCase:e.idCase}).pipe(function(e){return e})},getCaseTasks:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseTasks"),{idCase:e.idCase})},getCaseEvents:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("case-handler-getCaseEvents"),data:{idCase:e.idCase},serviceType:"GETEVENTS"}).pipe(function(e){return e})},getCaseSubprocesses:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("case-handler-getCaseSubprocesses"),data:{idCase:e.idCase},serviceType:"GETSUBPROCESSES"}).pipe(function(e){return e})},getCaseFormsRenderVersion:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseFormsRenderVersion"),{idCase:e.idCase})},getCaseFormsRenderVersionDataContent:function(e){var t=new $.Deferred;return $.when(this.getCaseFormsRenderVersion(e)).done(function(e){t.resolve(e)}),t.promise()},getTaskAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getTaskAssignees"),{idCase:e.idCase,idTask:e.idTask})},getWorkitems:function(e){var t={};return e=e||{},t.idCase=e.idCase,t.fromTask=e.fromTask,t.fromWorkItemId=e.fromWorkItemId,t.mobileDevice=bizagi.isMobile(),e.eventAsTasks&&(t.eventAsTasks=e.eventAsTasks),void 0!==e.onlyUserWorkItems&&(t.onlyUserWorkItems=e.onlyUserWorkItems),$.read({url:this.serviceLocator.getUrl("case-handler-getWorkItems"),data:t,serviceType:"GETWORKITEMS"})},getQueries:function(e){var t=this;if(t.hashQueries&&e.idElement)return t.hashQueries[e.idElement];var r=new $.Deferred;return $.read(t.serviceLocator.getUrl("query-handler-getqueries")).done(function(e){t.hashQueries={},t.hashQueries[0]={},t.processQueries(e.query),r.resolve(t.hashQueries[-1])}),r.promise()},processQueries:function(e){var t=this;$.each(e,function(e,r){t.hashQueries[r.idParent]||(t.hashQueries[r.idParent]=[]),t.hashQueries[r.idParent].push(r),r.nodes?t.processQueries(r.nodes):r.nodes={}})},createNewCase:function(e){return e=e||{},$.create({url:this.serviceLocator.getUrl("case-handler-addNewCase"),data:{idWfClass:e.idWfClass,caseData:e.caseData?JSON.stringify(e.caseData):null,idOrganization:e.idOrganization?e.idOrganization:null},serviceType:"NEWCASE"})},validateHasStartForm:function(e){var t={processId:e.processId};return $.read({url:this.serviceLocator.getUrl("case-handler-validateHasStartForm"),data:t,batchRequest:!0})},startProcess:function(e){var t=this,r={idProcess:(e=e||{}).idProcess,entityMapping:e.mapping?JSON.stringify(e.mapping):{}};void 0!==e.idParentCase&&(r.idParentCase=e.idParentCase);var a=$.Deferred();return $.create({url:t.serviceLocator.getUrl("case-handler-startProcess"),data:r,serviceType:"STARTPROCESS"}).fail(function(r){if("error"!==$.parseJSON(r.responseText).status||bizagi.util.isVersionSupported())a.reject(r);else{var i={idWfClass:e.idProcess||e.idWfClass,idOrganization:e.idOrganization||null};t.createNewCase(i).then(function(e){e.oldVersion=!0,a.resolve(e)}).fail(function(e){a.reject(e)})}}).done(function(e){a.resolve(e)}),a.promise()},actionCreateCase:function(e){var t={processId:void 0!==e.idProcess?e.idProcess:e.guidProcess};return void 0!==e.parentCaseId&&(t.parentCaseId=e.parentCaseId),void 0!==e.mapping&&(t.entityMapping=e.mapping?JSON.stringify(e.mapping):{}),$.create({url:this.serviceLocator.getUrl("handler-execute-action-start"),data:t,serviceType:"STARTPROCESS"})},getFirstParentPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-first-parent-plan"),r=$.Deferred();return $.when($.read({url:t,data:e,dataType:"json"})).done(function(e){r.resolve(e)}).fail(function(){r.resolve(null)}),r.promise()},searchCases:function(e){e=e||{};var t={h_action:"SEARCHCASES",onlyUserCases:!1,active:!1};return t.page=e.page||1,e.radNumber&&(t.radNumber=$.trim(e.radNumber)),t.pageSize=e.pageSize||this.pageSize,$.ajax({url:this.serviceLocator.getUrl("query-handler"),data:t,type:"POST",dataType:"json"})},queryCases:function(e){e=e||{};var t={h_action:"QUERYCASES"};return t.onlyUserCases=e.onlyUserCases||!1,t.active=e.active&&!0,t.page=e.page||1,e.radNumber&&(t.radNumber=$.trim(e.radNumber)),t.pageSize=e.pageSize||this.pageSize,t.filter=e.filter,t.outputxpath=e.outputxpath,t.orderFieldName=e.orderFieldName||"",t.orderType="asc"==e.orderType||1==e.orderType?1:0,t.order=e.order||"",$.ajax({url:this.serviceLocator.getUrl("query-handler"),data:t,type:"POST",dataType:"json"})},queryEntities:function(e){e=e||{};var t={h_action:"QUERYENTITIES"};return t.page=e.page||1,t.pageSize=this.Class.ENTITIES_QUERY_PAGE_SIZE,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"idEnt"]=e.idEntity,t.filter=e.filter,t.outputxpath=e.outputxpath,t.orderFieldName=e.orderFieldName||"",t.orderType=e.orderType||"",t.order=e.order||"",$.ajax({url:this.serviceLocator.getUrl("query-handler"),data:t,type:"POST",dataType:"json"})},getMenuAuthorization:function(){return $.read(this.serviceLocator.getUrl("authorization-handler-getMenuAuthorization"))},isCaseCreationAuthorized:function(e){var t=this.serviceLocator.getUrl("authorization-handler-isCaseCreationAuthorized");return t=t.replace("{0}",e.idWfClass||""),$.read({url:t})},getAsynchExecutionState:function(e){return(e=e||{}).idCase,$.read({url:this.serviceLocator.getUrl("case-handler-getAsynchExecutionState"),data:{idCase:e.idCase,idAsynchWorkitem:e.idAsynchWorkitem},serviceType:"ASYNCHEXECUTION"})},supportedLogTypes:function(){return $.read(this.serviceLocator.getUrl("case-handler-supportedLogTypes"))},getActivityLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getActivityLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe(function(e){return e})},getActivityDetailLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getActivityDetailLog"),{idCase:e.idCase,idWorkItemFrom:e.idWorkItemFrom,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe(function(e){return e})},getEntityLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getEntityLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe(function(e){return e})},getEntityDetailLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getEntityDetailLog"),{idCase:e.idCase,idEntity:e.idEntity||-1,userFullName:e.userFullName||"",attribDisplayName:e.attribDisplayName||"",idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe(function(e){return e})},getUserLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getUserLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe(function(e){return e})},getUserDetailLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getUserDetailLog"),{idCase:e.idCase,idUser:e.idUser,entDisplayName:e.entDisplayName||"",attribDisplayName:e.attribDisplayName||"",idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe(function(e){return e})},getAdminLog:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getAdminLog"),{idCase:e.idCase,orden:e.sort||0,idActualPage:e.idActualPage||1,pageSize:e.pageSize||10}).pipe(function(e){return e})},addFavorite:function(e){return e=e||{},$.create(this.serviceLocator.getUrl("favorites-handler-saveFavorite"),{idObject:e.idObject,favoriteType:e.favoriteType}).pipe(function(e){return e})},delFavorite:function(e){return e=e||{},$.destroy(this.serviceLocator.getUrl("favorites-handler-deleteFavorite"),{guidFavorite:e.idObject}).pipe(function(e){return e})},summaryAssigness:function(e){var t=new $.Deferred,r=e.idCase||"";return $.when(this.getCaseAssignees({idCase:r})).done(function(e){for(var r=e.assignees||[],a=r.length,i={showAssignees:!!(bizagi.override.showAssignees&&r.length>0),assignees:{},events:"",activities:""},s="",o="",n=[],l=[],c=0;c<a;c++)bizagi.util.parseBoolean(r[c].isEvent)?-1==n.indexOf(r[c].idUser)&&(n.push(r[c].idUser),s+=r[c].Name+", "):-1==l.indexOf(r[c].idUser)&&(l.push(r[c].idUser),o+=r[c].Name+", ");i.events=s.substring(0,s.length-2),i.activities=o.substring(0,o.length-2),t.resolve(i)}),t.promise()},summarySubProcess:function(e){var t=$.Deferred(),r=e.idCase||"";return $.when(this.getCaseSubprocesses({idCase:r})).done(function(e){if(e.showSubProcess=e.subProcesses.length>=1,e.showSubProcesColumns=void 0!==e.CustFields[0]&&e.CustFields[0][0].length>=1,e.showSubProcesColumns){var r;e.subProcPersonalized={};for(var a=0;a<e.CustFields.length;a++){r=0;for(var i=0;i<e.subProcesses.length;i++)e.subProcesses[i].idCustData==a&&(e.subProcPersonalized[a]=e.subProcPersonalized[a]||{},e.subProcPersonalized[a].subProcesses=e.subProcPersonalized[a].subProcesses||{},e.subProcPersonalized[a].subProcesses[r++]=e.subProcesses[i]);-1!=e.subProcesses[a].idCustData&&null!=e.subProcPersonalized[a]&&(e.subProcPersonalized[a].CustFields=e.CustFields[a],e.subProcPersonalized[a].idCase=e.idCase)}}t.resolve(e)}),t.promise()},summaryCaseEvents:function(e){var t=$.Deferred(),r=e.idCase||"";return $.when(this.getCaseEvents({idCase:r})).done(function(e){e.showEvents=e.events.length>=1,t.resolve(e)}).fail(function(e){t.reject()}),t.promise()},summaryCaseDetails:function(e){var t=new $.Deferred,r=e.idWorkitem||0;return $.when(this.getCaseSummaryDataContent(e)).done(function(e){e.currentState=e.currentState||[];var a=e.currentState.length;for(e.showEvents=e.countEvents>=1,e.showParentProcess=e.idParentCase>=1,e.parentProcess={displayName:e.parentDisplayName,idCase:e.idParentCase},e.isClosedForAllUsers=bizagi.util.parseBoolean(e.isClosed),e.isClosed=!bizagi.util.parseBoolean(e.isOpen),e.showAssignees=!!(bizagi.override.showAssignees&&e.countAssigness>0),e.showSubProcess=e.countSubProcesses>0,e.showForm=!!bizagi.util.parseBoolean(e.hasGlobalForm),e.allowsReassign="false",i=0;i<a;i++)e.currentState[i].idWorkItem==r&&(e.allowsReassign=e.currentState[i].allowsReassign);var s=[],o=0;for(i=0;i<a;i++)!bizagi.util.parseBoolean(e.currentState[i].isEvent)&&bizagi.util.parseBoolean(e.currentState[i].assignToCurrentUser)&&e.currentState[i].idWorkItem!=r&&(s[o++]=e.currentState[i]);e.currentStateTypes=s,e.showActivities=s.length>0,t.resolve(e)}),t.promise()},releaseActivity:function(e){var t=this.serviceLocator.getUrl("case-handler-releaseActivity");t=t.replace("{idCase}",e.idCase);var r={};return e&&(r.idCase=e.idCase,r.idWorkItem=e.idWorkItem),$.ajax({url:t,data:r,type:"POST",dataType:"json"})},summaryActivities:function(e){var t={},r=e.data||{},a=a||e.idWorkitem||0;try{t.showActivities=r.currentStateTypes.length>=1,t.currentState=r.currentStateTypes,t.globalIdWorkitem=a,t.creationDate=r.creationDate}catch(e){}return t},getCaseSummaryDataContent:function(e){var t=this,r=new $.Deferred;return $.when(t.getCaseSummary(e)).done(function(e){e.taskState=t.icoTaskState,e.process=e.process?e.process:"",e.createdBy&&(e.createdByName=e.createdBy.Name,e.createdByUserName=e.createdBy.userName,e.caseDescription=""==e.caseDescription?"":e.caseDescription,e.processPath=e.processPath.replace(/\//g," > ")+e.process,e.showWorkOnIt=!0),r.resolve(e)}),r.promise()},getSmartFolders:function(e){var t=this,r={};return r.idFolder=e||"",$.read(t.serviceLocator.getUrl("folders-handler-getUserQueries"),r).pipe(function(r){return-1==e||""==e?r:t.searchFolders(e,r)||[]})},deleteSmartFolder:function(e){var t={action:"6"};return e=e||{},t.idSmartFolder=e.idSmartFolder||"",t.idUser=e.idUser||"",$.destroy(this.serviceLocator.getUrl("folders-associate-deleteSmartFolder"),t)},getFolders:function(e){var t=this,r={action:"getUserFolder"};return r.idFolder=e||"",$.ajax({url:t.serviceLocator.getUrl("folders-handler"),type:"POST",data:r,dataType:"json"}).pipe(function(r){return""==e?{folders:[{name:bizagi.localization.getResource("workportal-widget-folders"),id:"-1",idParent:0,childs:r}]}:-1==e?r:t.searchFolders(e,r)||[]})},searchFolders:function(e,t){for(var r=0;r<t.folders.length;r++){if(t.folders[r].id==e)return t.folders[r].childs}},getCasesByFolder:function(e){return e=e||"",$.ajax({cache:!0,url:"RestServices/"+e,type:"GET",dataType:"json"})},makeFolder:function(e){var t={action:"CreateUpdateFolder"};return t.folderName=e.folderName||"No Name",null!=e.idParentFolder&&e.idParentFolder>1&&(t.idParentFolder=e.idParentFolder),$.ajax({url:this.serviceLocator.getUrl("folders-handler"),data:t,type:"POST",dataType:"json"})},updateFolder:function(e){var t={};return e=e||{},t.action="CreateUpdateFolder",t.idFolder=e.idFolder||"",e.folderName&&(t.folderName=e.folderName),e.idParentFolder&&(t.idParentFolder=e.idParentFolder),$.ajax({url:this.serviceLocator.getUrl("folders-handler"),data:t,type:"POST",dataType:"json"})},associateCaseToFolder:function(e){var t={action:"4"};return e=e||{},t.idCase=e.idCase||"",t.idCustomFolder=e.idCustomFolder,$.ajax({url:this.serviceLocator.getUrl("folders-associate"),data:t,type:"POST",dataType:"json"})},dissasociateCaseFromFolder:function(e){var t={action:"DeleteCaseFromFolder"};return e=e||{},t.idFolder=e.idFolder,t.idCase=e.idCase,$.ajax({url:this.serviceLocator.getUrl("folders-handler"),data:t,type:"POST",dataType:"json"})},deleteFolder:function(e){var t={action:"5"};return e=e||{},t.idCustomFolder=e.idCustomFolder||"",$.ajax({url:this.serviceLocator.getUrl("folders-associate"),data:t,type:"POST",dataType:"json"})},getFile:function(e){var t={},r=this.serviceLocator.getUrl("file-handler");return e=e||{},t.action="getFileContent",t.uploadId=e.uploadId||"",t.entityId=e.entityId||"",t.entityKey=e.entityKey||"",bizagi.services.ajax.pathToBase+r+"?"+jQuery.param(t)},getComments:function(e){var t=this;return e=e||{},$.read(encodeURI(t.serviceLocator.getUrl("MessageHandler-GetComments")),{idCase:e.idCase||"",idColorCategory:"number"==typeof e.idColorCategory?e.idColorCategory:"",pag:e.pag||1,pagSize:e.pagSize||10}).pipe(function(e){var r=new $.Deferred,a="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";return e.comments?$.each(e.comments,function(t,r){e.comments[t].hasOwnProperty("CategoryColor")||(e.comments[t].CategoryColor="")}):e.comments=[],e.users?$.each(e.users,function(t,r){e.users[t].Picture=""===e.users[t].Picture?a:e.users[t].Picture}):$.when(t.getCurrentUser()).done(function(t){e.users=[],e.users.push({Id:t.idUser,Name:t.user,DisplayName:t.userName,Picture:a})}),r.resolve(e),r.promise()})},makeNewComment:function(e){return $.create(this.serviceLocator.getUrl("MessageHandler-NewComment"),{idCase:e.idCase||"",comment:e.comment.replace(/\n/g,"<br>")||""}).pipe(function(e){if(e.comments){var t=[e.comments];$.each(t,function(e,r){t[e].CategoryColor=""}),e.comments=t}if(e.users){var r=[e.users];$.each(r,function(e,t){r[e].Picture=""==r[e].Picture?"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABJwSURBVHhe7Vt5UJPnuj+ddvSqdcpotQougCyGRfY9QCQQwhKIrAqurUtbbbVV1KO2UrXH46lL1aOOdWvrcl3QuosIBUSGongA5bLXqLjCVbarrX/97vO8SSAieLRVJ86czPwmX0L8vve3PM/7vp/JX/7yn8d/FHhVCkykC+144403NL16vQ1TU1MtBpqiR48eoL8VE9YQnF/VgF7VdVLffPPNRkdHJ0SER0CpDIdCEYqQkBAtgvlZgdDQUHh5ecHMzIzFyCbIXtUAX9Z12MliN1c3JCcnIzkpGWp1jCBrSD6YBAgODoZczpALBMmCYGFhwULsIJi8rAG+zPM6s+vseGLiaMTFxSM2JlaQl8lkAoGBgQgMCERAQAD8/f0hlfrDz88Pfr5+8PX1FXByctKXxmslgiAfEqxAdFQ0VKooqCJVwnVvb1+Ct4i6l6cXPDw8CR5wd3OHm5sbXF1d4ezMcIYTlQwLYGNjoxfhZRr2ws7NTmm8vLwRSnWuIMelflK46kkRISbl6OAIB4K9vT3s7ewhkdgRJLC1sRWEra2tYWVlhWHDhonnPn36sAjcII3+kWplZQ0Pd08RYXt7Bx0pW0FKT8xqmBUsLYfB0sISFkMtMHToUAwZPASDBw8WTdDU1AwDBw4UGDBggAClikUwN2YFTLp37y5izvFlId7t+y4G9B8gSGmJaae9gQO0xPr3649+/fqJz/UlsNN9TPrAxMRE4J133hGf43RwEnRN0Wg1mMVR5q5vQc72pLl99sfj0b3bW3j77beJYF8t+vRtI9qjR0+80/sdIqoly8e9e/d+DJaWlrC1tRXlwn8z5lmh2MvTm2rYFt26dcOSeTNQnn8U2Ue2w8pyCHp076EjTwIIl/vgrbfeYkKCGAvQ+ykCcAq4VOjzE40xAiYm5CIvdvpRrHv26I6a8+nQXMxAbdFpFGcfxJTx8YIsk9fHnB3n9xicho7uc3K4D3ACGNxDjLUZyrh+hwwZSvXcD3J/T1wrPYNrJRkC10uzUPFLOnZvWQ13Zwf06tVL29yoPzBJqZc7fD2cRaN7913qG/Q3fuY+wKLwbMACGKwSjS4EsoHU3MzMBoOTwLVfV5pJOCNw41I2bpadxbVLubiUn46VyxZhYP9+QghujBx/pVyKr+d/goH9+gpRWAR2n4Xg1wwWmfcSRsee65IF4O7OdTxn+gTcvJyFm5cyBW6V5eB2xTncrvoFd2qKoLmcj5L8DHy37hsE+HmR828xMVgOMcWejcsw98MkSN3tRY/gBOgF4EToSsbo+oBMTG0UaRZg/fL5uFOWTcgSuFuRi7uV+aivKUTDlYtouFqKe9fLUVddgrLCLGQc/hGLPp+GQF83mPZ/F9tXzkPegfU4vHkJUmeOx9houSCuE4B3jWpjS4GMu3p/FuDtXqgsOIr6ihzUl2cLNFSeRUN1Ae7VXsD9qyVovH4JTTcq0XyrBo115bhbfQG1FzJQmrUfpWd24VbREdwpOoTrBftQkfk9StO3GApglCtCE65nruUFMz8gwrm4V0WozCHkorEmH02a82i5XoLWG5fx8E4VHt6txcP6q3hwuwotdaVovHIe96vO4l7ZGTSUHkd98WHUXzxEOIj6ojT4eziAF1rkfKqxuS/G06vHfzXy9HZo+2oikovmmjy01BKunEPr1UI8uF6EhzdK8dvtcvx2txq/37uKR/ev47f6WvHew7pitF4pQFNlFu5dOoF7JUcIh3Gv+BDukQiBXo7o2bMnkiOkvEU2rsepTYsmTklQigXQ0R/XoonIN1ZRCVzOQF3RUdy4eAI3S07jFs0It2hGaL5eSgJo8KhRJ8CtMjRQn7hRdBx1hRT9/L24lrcL1wm3C/eRAGmQ+7qKafIfcyfjxIZFxtUDTmxamHpwy3JRp0d/WIP6skxcPX8ENXn7tTiXhqqzB1CZewDl2VTXOQdwX1NCCbhGCagRopRn7iLsRGXWTlRR3ddkfY/abC2uZG+Hr6stYkOlyNi9Fic3LphlVBFgRzL3rINc6o7D36+ixpeJO5cycLs0nVxnZBDJLJoOc2k9kIfawpO4XpzZJoCm8DiuFaWjrphw4QjqqPnV5e/GDcJNwp3CvVi9YDLy9qxC5u7VOLVpocyoBDi1abH52X1ryZ3VKCMn66mRNVVlaxtaWQYayrNoVshFfRVNhdWFtCYowNWiDDy6RwmgfnC7/BzulucK0e4UH8edC2m4c36fQP2FfWgsPoCajC24eHQT8ug6P61ZbGJUAvBgzmxdqrlB7p3bv0643lKdQ6B6r8pCU3Uu9QWaCa4UounqRTReLUZFbppohCwAv3e/Oh/3K7Jx/3K6aH73i9MEGhkXqXRObsSVvL04tflLXgcY34PLoOjwP5Gz8x+4UXyCunkmWog8o5Vmg1bNLzQTXMRvNBM0XrlgIECVeO/htfNorTmLlvIMNJUeQWPJwTbyjRf345e934DPb3QN0NAKHtzhdXM1tef2o+HyaTSTCM1VmYJYq6YAD64VCbL1tCoUCWjQUAJ0AtBU2UpJaSk/TQIcfox8w/k9OLFxocaoyeuFOLouRV14aANulxwnAc4IEVprcmmOzycBLtB8X4o62iZX5OgEuFOpTYCGBchBc5lOAIo9O8+ozviOGt8io1v/d1mHxzYs1Fw7fwjNFRlCBCbWWnsOD66eJwFKUJ13SEyFIgFCgBI8oBJpocbZXJaOppJDbeRZgPzdf2/8aYcRNr6uFDi4NiW1NH0bLWlPCBFaqRlqBShEMy159WuB3xuuCAFYlAdUIkKAyydJAKp/nfvXcraT+18a5fq/ywTwNJW+dUljXeFBNFNTa9U1wgcU84fXi2lKzKOF0SFKAAlwu0IrAC2DW2gZ3HyZGqiBAOQ+Tu1Ybm58bf/fjIhTUHhwPRrJ0RbRB86KmD/kmeDmJXK+Cr/XswC0DyBRHlCP6CgAu396y1fGufl5FkfSVqdoNDR3t3AfoEbILrcLUEkC6DZCJEpHAbjzZ21bguzXqfY7inJk/bzU01uXUC84KRohk3yomwq59oUAtBFiUToKUHKI1vybv+D9xev7OLBqdmpe2gZcOLIJTRVZbQJot8UsQE2nAlRnbEPe7hU4s33p6y3AwbVzf6osPIHMXatQcnIbWmib/OAqrQWEABWdClCbsxOZ25eh/DSt/SkFp79b7PzaRuDExkXZdbQLrCg4JkS4cGwrmmupD9BiqDMBanL3kOvLaNOzgTZB+3Hp2Aac2rLYuHZ+z+PGqiUp2Q/qLtJuLwdVdJ/wwvFtyPh+BYpP78QN+r8C3gXepnsB1WfTkLNrJU5Sv/jl0HrcKNgjFkNHvluKxTMnvz4rQBYnOjraPDIycs1IpVrj6S9HQcY+tNISuJlmgJt0X6A0ay/O7F2Hw0Ru/7qF+OGbFPy4ai69XoJ8mjYr6WYI3wW6SSKMT1TDL3oilFHxGpVKlcrnfh4DXulnaYATw1SjsmWxk+GS/CXsx6+Ac9znUCpCsHPzSnFfkPcDfHOk/Ox+nDv8HY5uX4E9//wSaXT7+wwl4PyRjUIAvgs8LoHIK+NgN26FOBefk8/N1+BrvVJyXV2MHWFnFOrRjd6jZ8Nx3NdisIbwSPgMsuBQxKhV2LlpBUqz9wsBCqgfnPxxVZsAx7b9DdtWzkfK9IniuwU+ihjYJS974nx8Db5WaFR8oy4VJq9cDF3Md4SMGgv3pAVPDLKjCE5jl0AaMxUjQ1Xi+0BMcNzoWIyJi0K8OgKhIXLx/SD+3pBvRBJcEufDTgj5d9iPM8Ryek0Yuxx2BLfR8xE8KhlUcjteSXnQRUxY9Wcl3lEIJuSS9AU8ElPgE/shvEZNE3CLm0mk5wlSdmP/pkUy42sDLINdkh5L6ZgwZikkBNeEFMjVSS83EeHh4c4RqlGaJx0nh/6NU12SaiPExLSE9KQkY5YQOcJoxlftSEyFpA2LIUnQYjjBPXYm94hiHusLLQs+oUKd2OiYTAPUxe+FkUokck8hNTzhSwyPZ3zxOOIWYXgbFmJ4rBZ2sfMQokpofGEicOzDyXmHMam6CHblkoFTTyVFZDojFUcEuyBlG7sAAjGMvz6OUfNhKzBPC/U8SNRzKAnqF3PzlOd01/g5HVziGLZHTxB6UaRGEcFOSDExG/VcLaIZKe2IouOoOTrMpufZcFVNo+8oqv7cVppjFKQeB4lBBG05ap04xe936VQbocedsnkqKT0hfiZSqnZYqz6HdaQen9GxFlbhn8I6YlYbRqpG40/NDqRgtnM8RSquPX7Dwj/RRvAFkrImcl2RMiRkHTET1uHtYMJWYYxPBCxDpmFY6HRYKWfAOmwGHCI+FlPkH2qIERERsqBRE+AQvwCSmPlt8bMImdohfp07JQh15lTEZ1i3Ox38SJ6/ntzqQKgDKUFOyZhhACLJRHUYFvoxhik+hqV8MsxHTqLjj2BN7w0PnwGZaswfSwG5/5M71b5j7HxqKlRjOpcGS8c8GT+D2GkdezqpdbtOagWYu7ZTUoKQjhSTaUMIHYd82I5gcrwNU2FB5If4jSEhpsCa0jBc+RGcwqc9fwq4buRU+y7x8+EYkwJJ1OewIWIWwVMwyDtO1FrH+GmdMnSJjzu4pCO1dudxIUDSnNXwSpiDUdO/hrN6lpaYASnL4KkQkDOmtCOIjoMm6/ABLEdqMVSaDDP3aDp+H9aUBoliGhzCPoI8MuH5UsCd3yd2BlxiU+Co/hwSFblKNTVEmgQzrxhRaxy/rp0ycKkTUmt/OCoE+HHPfvz888/49ddf8ejRI6Sl58M5imo5qJ0UE7MgQhYyPSbRsQ6BE2HRhgkY4pOIAU6hsAycAOugSZCETIaDciq8wyfwjDDrmXtBuCpW4xGfApcY2uBEzYIk4hNRU4O8YmHmqYYFDdAweu0uGTj1mEvsVjupb78/IgRYunIjZi5eg282/zf+936TeC8j71+PkbIImAA9zAPGw9xfj3F0rIN0LMwJg73i8J6DHOa+o2EtmwCJfBIcFZPhpJwCZYT62b5ep5/6PGJnw4Vi6Rj5CSRhH8Oa4jTQOUxEjFXXRtDQKXKoM6cec4kdm4Bvd/wkyI7+dDn0pEaEfYjm1gfifWn8Z4JQO5Jh7qdHEob6EXwZY9rhMwaDPWLwnn0QhnrGwDpgLCQjJ8AxZBJclJMRGJaAZ1od8uJBGvMhPGJmwSXqUzjSVCIJnQZrqn8+uambSijfHj0iZeCSBbvUmVMGhNZsOyiITv3rah0xLamCf5WL9xOnL9ESI1JDfUa3wzsRQ9uQgCFeesTTcTwGuUXjPYkMg8goG/8xkMjGwlE+AS6KSfBUJD9TGXQjlU66Rc2Ah/pTuKimw5GcsVNQVw16H/1s/WDqEikGK+L3mEvkWJtL7JbepY5OjcZX3/4giBZc/J82QmHj5rYlwFc9XRAS8NQjjo518IjFkDbEYLC7FoNcVHhveCAGjQiBjV8iJAFJGBE0Fi4hE+AUNI6325upDwwjvNlVP3DkD/lEvg/P6OlwjfgII6iJ2AW/Dyv/JPRnAUhd4cpj8TNwif9m4NJQ7yedciBX6m7VCxH4mYVobvk/8XrrnmNErp3UYPdRRI7gxlAbIBqDXQ0RBTOncAwY7o+BBBvfOEj8EzFCRvcX5OMgVSbS75KkK4m4G0HSlQBu9J1+mUKhyB6pSoZb+GSMUHwAuyCqee8Y9LfxhamTUufO4/HTOmXgEh8buNSRlI9qKgqKLgvS/GABtu4++gSpQS5R5CxDpYUzI7IdThEYpIOZoxIDbKUYaOMDGxqvnV88nAMTEUi31pgTc9MJwCJ0+uiv/wD9tmeqUqnMDoqIp/qhxY831Red2NRRIZoNE3p+p6KIoJ6QISkDQkzOgNQgcpVhNoJBTZjhqIeSjnVwCIWZfQgG2PhhkK0PPGVqyJVq+p2iMpu5GBBn8n2fNiX21tUJf1AkwsfHJ5V+23csSBF5y1sWCSf/aEh89PH7g6QEoY6kDAgxMSbVBgURVMBUIKQddiGwdQuFs68SvrJwjJSH3eKx8pg7OM58zAndnnU9wI2CleJ/5KhXkE/KinKv4AvJFcoiaVDErYDgSHgERMKdYO8dgeGe4QJWbkRS79JzkDK1C4aVi0KQs3VTwM4jFO7SMAH/oHBIRypvyYNDi+iHlnt4LDymTgjzuHn8zKPLxvesgrByJgRTXUJsOsRKpIUHwmAHeGCG4DqkSBY9DSxqx39Hvy2crT9vJyRFUgk8Hu7wPD4e5zM7/awCdPU5VpbLhsE9hAdgKBIPTA/njqJ18Zo/Z/jvDMnxufk6+mv+qfH/Pz9r9qvYcZe2AAAAAElFTkSuQmCC":r[e].Picture}),e.users=r}return e})},makeNewReply:function(e){return e=e||{},$.create(this.serviceLocator.getUrl("MessageHandler-ReplyComment"),{idCase:e.idCase||"",idComment:e.idComment||"",comment:e.comment.replace(/\n/g,"<br>")||""}).pipe(function(e){if(e.comments&&(e.Replies=[e.comments]),e.users){var t=[e.users];$.each(t,function(e,r){t[e].Picture=""==t[e].Picture?"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":t[e].Picture}),e.users=t}return e})},removeMobileComment:function(e){var t=this.serviceLocator.getUrl("remove-comment");return e=e||{},$.destroy({url:t,data:JSON.stringify(e),dataType:"json",contentType:"application/json"}).pipe(function(e){return e})},removeComment:function(e){return e=e||{},$.destroy(this.serviceLocator.getUrl("MessageHandler-RemoveComment"),{idCase:e.idCase||"",idComment:e.idComment||""})},removeReply:function(e){return e=e||{},$.destroy(this.serviceLocator.getUrl("MessageHandler-RemoveReply"),{idCase:e.idCase||"",idComment:e.idComment||"",idReply:e.idReply||""})},renameCommentCategory:function(e){return e=e||{},$.update(this.serviceLocator.getUrl("MessageHandler-RenameCategoryColor"),{idColorCategory:e.idColorCategory>=0?e.idColorCategory:"",colorName:e.colorName||""})},setCommentCategory:function(e){return e=e||{},$.update(this.serviceLocator.getUrl("MessageHandler-SetCategoryToComment"),{idCase:e.idCase||"",idComment:e.idComment||"",idColorCategory:"number"==typeof e.idColorCategory?e.idColorCategory:""})},getCommentsCategories:function(){return $.read(this.serviceLocator.getUrl("MessageHandler-GetCategoryColors")).pipe(function(e){return e.length>1&&e[0].categories?e[0]:e})},getNewComments:function(e){return e=e||{},$.read(encodeURI(this.serviceLocator.getUrl("MessageHandler-CountNewComments")),{idCase:e.idCase||0,idComment:e.idComment||0})},getAnalisysQueries:function(){return $.read(this.serviceLocator.getUrl("bamAnalytics-handler-getAnalisysQueries"))},updateQueries:function(e){return $.update(this.serviceLocator.getUrl("bamAnalytics-handler-updateQuery"),{idQuery:e.idQuery>=0?e.idQuery:"",queryName:e.queryName||"",queryDescription:e.queryDescription||""})},deleteQueries:function(e){var t={action:"1612"};return t.QueryId=e||"",$.destroy(this.serviceLocator.getUrl("reports-handler-deleteQueries"),t)},getConfiguration:function(){var e=this.serviceLocator.getUrl("authenticationConfig");return $.read(e)},logout:function(){sessionStorage.removeItem("bizagiAuthentication");try{var e=$.create(this.serviceLocator.getUrl("logout"));$.when(e).done(function(){location.reload()}).fail(function(){bizagi.log("Error logging out")})}catch(e){}},logoutMobile:function(){var e=this,t={sourceLogout:"user"};if(sessionStorage.removeItem("bizagiAuthentication"),bizagi.util.isCordovaSupported()){var r=e.serviceLocator.getUrl("logout");return $.create(r)}try{$.when(e.getConfiguration()).done(function(r){if(r.redirectErrorPage)window.location.href=r.redirectErrorPage;else switch(r.authenticationType){case"Federate":var a=r.logOffURL,i=r.federationLogoutBindingProtocol;if("WSFederated"===authenticationSubType)$.when($.create(e.serviceLocator.getUrl("logout"),t)).done(function(){location.href=a}).fail(function(){bizagi.log("Error logging out")}).always(function(){location.href=r.logOffURL});else if("Saml"===authenticationSubType){$.when($.read(e.serviceLocator.getUrl("FederateLogoffUrl"),{})).done(function(r){r.federateLogoffUrl&&(a=r.federateLogoffUrl),$.when($.create(e.serviceLocator.getUrl("logout"),t)).done(function(){"POST"===i?(window.document.open("text/html"),window.document.write(a),window.document.close()):window.location.href=a}).fail(function(){bizagi.log("Error logging out")}).always(function(){})}).fail(function(){bizagi.log("Error logging out")}).always(function(){})}break;case"SAML":loader.nativeAjax(loader.getPathUrl(e.serviceLocator.getUrl("logout"),t),function(e){var t=JSON.parse(e.responseText);if(!0===t.logout)if(void 0!==t.samlUrlRedirect){var r=decodeURI(t.samlUrlRedirect),a=document.createElement("iframe");document.getElementsByTagName("body")[0].appendChild(a),$(a).on("load",function(){(bizagi.util.isIE8()?$(this.contentWindow.document.body):$(this.contentWindow.eval("document.body"))).text();location.reload()}),a.src=r}else location.reload();else bizagi.log("Error logging out")});break;case"OAuth2":$.when($.create(e.serviceLocator.getUrl("logout"),t)).done(function(){$.when($.read(e.serviceLocator.getUrl("oauth2AuthenticationConfig"))).done(function(e){if(e.logoutUrl&&""!=e.logoutUrl){var t=e.logoutUrl,r=e.homeUrl;t=t.replace(/post_logout_redirect_uri=[^&]*/,"post_logout_redirect_uri="+r),location.href=t}else location.reload()}).fail(function(){bizagi.log("Error logging out")})}).fail(function(){bizagi.log("Error logging out")});break;default:$.when($.create(e.serviceLocator.getUrl("logout"),t)).done(function(){window.location=bizagi.services.ajax.loginPage}).fail(function(){bizagi.log("Error logging out")})}}).fail(function(e){bizagi.log(e)})}catch(e){bizagi.log(e)}},getOrganizationInfo:function(e){var t={};return t.objectType=e,$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-getOrganizationInfo"),data:t,type:"GET",dataType:"json"})},getCasesByOrganization:function(e){var t={};return t.roles=e.roles?"["+e.roles.toString()+"]":"[]",t.skills=e.skills?"["+e.skills.toString()+"]":"[]",t.locations=e.locations?"["+e.locations.toString()+"]":"[]",$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-getCasesByOrganization"),data:t,type:"GET",dataType:"json"})},reassignCases:function(e){var t={};return t.users=e.user?"["+e.user.toString()+"]":"[]",t.roles=e.roles?"["+e.roles.toString()+"]":"[]",t.skills=e.skills?"["+e.skills.toString()+"]":"[]",t.locations=e.locations?"["+e.locations.toString()+"]":"[]",$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-reassignCases"),data:t,type:"POST",dataType:"json"})},searchUsers:function(e){var t={};return t.userName=e.userName||"",t.fullName=e.fullName||"",t.domain=e.domain||"",$.ajax({url:this.serviceLocator.getUrl("massive-activity-assignments-searchUsers"),data:t,type:"GET",dataType:"json"})},getDomainList:function(){var e=this.serviceLocator.getUrl("domains");return $.read(e)},getEcmAllScheduledJobs:function(){var e={action:"getEcmAllScheduledJobs"};return $.read(this.serviceLocator.getUrl("async-ecm-upload-baseService"),e)},retryECMPendingScheduledJob:function(e){var t={action:"retryECMPendingScheduledJob"};return t.idJob=e,$.read(this.serviceLocator.getUrl("async-ecm-upload-baseService"),t)},getWorkPortalVersion:function(){return $.ajax({url:this.serviceLocator.getUrl("WorkPortalVersion"),type:"GET",dataType:"json"}).always(function(e){return""==(e=e||{}).version&&(e.version=bizagi.loader.productBuild||""),e})},getAuthenticationLogData:function(e){var t="";return t="domains"==e.dataType?"admin-getAuthenticationDomains":"events"==e.dataType?"admin-getAuthenticationEventsTypes":"admin-getAuthenticationEventSubTypes",$.ajax({url:this.serviceLocator.getUrl(t),data:{},type:"GET",dataType:"json"})},getAuthenticationLogResult:function(e){var t={};return t.action=e.action,t.domain=e.domain,t.userName=e.userName,t.dtFrom=e.dtFrom,t.dtTo=e.dtTo,t.eventSubType=e.eventSubType,t.eventType=e.eventType,t.pag=e.pag,t.pagSize=e.pagSize,$.ajax({url:this.serviceLocator.getUrl("admin-getAuthenticationLog"),data:t,type:"GET",dataType:"json"})},encryptString:function(e){var t={};return e=e||{},t.entry=e.entry,$.ajax({url:this.serviceLocator.getUrl("admin-EncryptString"),data:t,type:"POST",dataType:"json"})},userPendingRequests:function(e){var t={pag:e.pag,pagSize:e.pagSize};return $.read(this.serviceLocator.getUrl("admin-UserPendingRequests"),t)},userAuthenticationInfo:function(e){return $.read(this.serviceLocator.getUrl("admin-UserAuthenticationInfo"),{idUser:e.idUser})},updateUserAuthenticationInfo:function(e){return $.create(this.serviceLocator.getUrl("admin-updateUserAuthenticationInfo"),{idUser:e.idUser,password:e.password,enable:e.enable,expired:e.expired,locked:e.locked})},generateRandomPassword:function(e){return(e=e||{}).action="generateRandomPassword",$.ajax({url:this.serviceLocator.getUrl("admin-generateRandomPassword"),data:e,type:"POST",dataType:"json"})},generateDataToSendByEmail:function(e){e=e||{};var t={action:"GenerateDataToSendByEmail"};return t.idUser=e.idUser,t.password=e.password,$.ajax({url:this.serviceLocator.getUrl("admin-GenerateDataToSendByEmail"),data:e,type:"POST",dataType:"json"})},sendEmail:function(e){e=e||{};var t={action:"sendEmail"};return t.emailTo=e.emailTo,t.subject=e.subject,t.body=e.body,$.ajax({url:this.serviceLocator.getUrl("admin-sendEmail"),data:e,type:"POST",dataType:"json"})},getApplicationCategoriesList:function(e){var t={},r="";return"Applications"==e.action?(r="admin-getApplicationList",$.ajax({url:this.serviceLocator.getUrl(r),type:"GET",dataType:"json"})):(r="admin-getCategoriesList",t.idApp=e.idApp,t.idCategory=e.idCategory,""==t.idCategory&&(t.idCategory=-1),void 0!==e.filterStartEvent&&(t.filterStartEvent=e.filterStartEvent),$.ajax({url:this.serviceLocator.getUrl(r),data:t,type:"GET",dataType:"json"}))},getAdminCasesList:function(e){var t=e||{};return $.ajax({cache:!0,url:this.serviceLocator.getUrl("admin-getCasesList"),data:t,type:"GET",dataType:"json"})},getApplicationProcesses:function(e){var t=this.serviceLocator.getUrl("admin-getApplicationProcesses"),r={};return r.idApp=e.idApp?e.idApp:-1,$.read(t,r)},getProcessVersion:function(e){var t=this.serviceLocator.getUrl("admin-getProcessVersion"),r={};return r.idWfClass=e.idWFClass,$.read(t,r)},getProcessTasks:function(e){var t=this.serviceLocator.getUrl("admin-getProcessTasks"),r={};return r.idWfClass=e.idWFClass,r.version=e.version?e.version:void 0,$.read(t,r)},getTaskAlarms:function(e){var t=this.serviceLocator.getUrl("admin-getTaskAlarms"),r={};return r.idTask=e.idTask,$.read(t,r)},getLapseMode:function(){var e=this.serviceLocator.getUrl("admin-getLapseMode");return $.read(e)},getRecurrMode:function(){var e=this.serviceLocator.getUrl("admin-getRecurrMode");return $.read(e)},getScheduleType:function(){var e=this.serviceLocator.getUrl("admin-getScheduleType");return $.read(e)},getBossList:function(e){var t=this.serviceLocator.getUrl("admin-getBossList");return $.read(t)},addAlarm:function(e){var t=this.serviceLocator.getUrl("admin-addAlarm"),r={};return r.idTask=e.idTask,r.idRecurrMode=e.idRecurrMode,r.idLapseMode=e.idLapseMode,r.scheduleType=e.scheduleType,r.alarmTime=e.alarmTime,r.alarmRecurrTime=e.alarmRecurrTime,r.sendToCurrentAssignee=e.sendToCurrentAssignee,$.update(t,r)},editAlarm:function(e){var t=this.serviceLocator.getUrl("admin-editAlarm"),r={};return r.idTask=e.idTask,r.idAlarm=e.idAlarm,r.idRecurrMode=e.idRecurrMode,r.idLapseMode=e.idLapseMode,r.scheduleType=e.scheduleType,r.alarmTime=e.alarmTime,r.alarmRecurrTime=e.alarmRecurrTime,r.sendToCurrentAssignee=e.sendToCurrentAssignee,$.update(t,r)},deleteAlarm:function(e){var t=this.serviceLocator.getUrl("admin-deleteAlarm");return e.idAlarm,$.destroy(t,e)},getAlarmRecipients:function(e){var t=this.serviceLocator.getUrl("admin-alarmRecipients"),r={};return r.idAlarm=e.idAlarm,$.read(t,r)},addRecipientToAlarm:function(e){var t=this.serviceLocator.getUrl("admin-recipientToAlarm"),r={};return r.idAlarm=e.idAlarm,r.idRecipient=e.idRecipient,$.update(t,r)},deleteRecipientsFromAlarm:function(e){var t=this.serviceLocator.getUrl("admin-deleteAlarmRecipients"),r={};return r.idRecipients=e.idRecipients,$.destroy(t,r)},enableAlarm:function(e){var t=this.serviceLocator.getUrl("admin-enableAlarm"),r={};return r.idTask=e.idTask,$.create(t,r)},abortReassignItems:function(e){var t=e||{},r="abort"==e.action?"admin-abortItems":"admin-reassignItems";return $.ajax({url:this.serviceLocator.getUrl(r),data:t,type:"POST",dataType:"json"})},asyncActivitiesServices:function(e){var t=this,r=e,a="",i="GET";return"getActivities"==e.action?a=t.serviceLocator.getUrl("admin-async-activities-get-activities"):"retryNow"==e.action?(i="POST",a=(a=(a=(a=t.serviceLocator.getUrl("admin-async-activities-get-retry-now")).replace("{idCase}",e.idCase)).replace("{idworkItem}",e.idWorkitem)).replace("{idAsynchWorkitem}",e.idAsynchWorkitem)):"getActivitiesByTask"==e.action?a=t.serviceLocator.getUrl("admin-async-activities-get-activities-by-task"):"enableExecution"==e.action?(i="POST",a=t.serviceLocator.getUrl("admin-async-activities-enable-execution")):"enableMultiple"==e.action?(a=t.serviceLocator.getUrl("admin-async-activities-enable-multiple"),i="POST"):"asyncExecution"==e.action?a=t.serviceLocator.getUrl("admin-async-activities-async-execution"):"asyncExecutionLog"==e.action?a=(a=(a=(a=t.serviceLocator.getUrl("admin-async-activities-async-execution-log")).replace("{idCase}",e.idCase)).replace("{idworkItem}",e.idWorkItem)).replace("{idAsynchWorkitem}",e.idAsynchWorkitem):"getAsyncExecution"==e.action&&(a=t.serviceLocator.getUrl("admin-async-activities-async-get-current-execution-log")),$.ajax({url:a,data:r,type:i,dataType:"json"})},getDefaultAssignationUserToAllProcess:function(e){return $.read(this.serviceLocator.getUrl("admin-getDefaultAssignationUserToAllProcess"),{serviceAction:"getDefaultAssignationUserToAllProcess"})},getDefaultAssignationUserToProcess:function(e){var t;return t=""==e.idWFClass?-1:e.idWfClass,$.read(this.serviceLocator.getUrl("admin-getDefaultAssignationUserToProcess"),{serviceAction:"getDefaultAssignationUserToProcess",process:t})},setDefaultAssignationUserToProcess:function(e){return""==e.idWFClass?process=-1:process=e.idWfClass,$.create(this.serviceLocator.getUrl("admin-setDefaultAssignationUserToProcess"),{serviceAction:"setDefaultAssignationUserToProcess",process:process,idUser:e.idUser})},getProcessIcon:function(e){var t={processId:e.processId};return $.read({url:this.serviceLocator.getUrl("process-getIcon"),data:t,batchRequest:!0})},getCollectionIcon:function(e){var t={collectionId:e.collectionId};return $.read({url:this.serviceLocator.getUrl("collections-getIcon"),data:t,batchRequest:!0})},getProfilesTypes:function(e){return $.read(this.serviceLocator.getUrl("admin-getProfilesTypes"))},searchProfiles:function(e){var t=this.serviceLocator.getUrl("admin-searchProfiles"),r={};return r.type=e.profileType,r.name=e.profileName,r.orgId=e.orgId?e.orgId:null,$.read(t,r)},getUsersByProfile:function(e){var t=this.serviceLocator.getUrl("admin-getUsersByProfile"),r={};return r.type=e.profileType,r.id=e.idProfile,$.read(t,r)},removeUserFromProfile:function(e){var t=this.serviceLocator.getUrl("admin-removeUserFromProfile"),r={};return r.type=e.profileType,r.id=e.idProfile,r.idUser=e.idUser,$.destroy(t,r)},addUserToProfile:function(e){var t=this.serviceLocator.getUrl("admin-addUserToProfile"),r={};return r.type=e.profileType,r.id=e.idProfile,r.idUser=e.idUser,$.update(t,r)},licenses:function(){var e=this.serviceLocator.getUrl("admin-Licenses");return $.read(e)},getDimensions:function(){var e=this.serviceLocator.getUrl("admin-GetDimensions");return $.read(e)},editDimension:function(e){e=e||{};var t={};t.id=e.id,t.displayName=e.displayName,t.name=e.name,t.idWfClass=e.idWfClass,t.entityPath=e.entityPath,t.description=e.description;var r=this.serviceLocator.getUrl("admin-EditDimension");return $.create(r,t)},createAdministrableDimension:function(e){e=e||{};var t={};return t.displayName=e.displayName,t.name=e.name,t.idWfClass=e.idWfClass,t.entityPath=e.entityPath,t.Description=e.description,$.ajax({url:this.serviceLocator.getUrl("admin-CreateAdministrableDimension"),data:e,type:"PUT",dataType:"json"})},deleteDimension:function(e){var t=this.serviceLocator.getUrl("admin-DeleteDimension");e=e||{};var r={};return r.id=e.id,r.idDimension=e.id,r.administrable=e.administrable,$.destroy(t,r)},entityPathChildNodesAction:function(e){e=e||{};var t={};return t.pathNodeType=e.nodeType,t.idNode=e.idNode,t.nodeDisplayPath=e.nodeDisplayPath,t.nodePath=e.nodePath,t.idWfClass=e.idWfClass,$.ajax({url:this.serviceLocator.getUrl("admin-EntityPathChildNodesAction"),data:e,type:"GET",dataType:"json"})},getActiveWFClasses:function(e){var t=e||{};return $.ajax({cache:!0,url:this.serviceLocator.getUrl("admin-GetActiveWFClasses"),data:t,type:"GET",dataType:"json"})},storeDocumentTemplates:function(){var e=this.serviceLocator.getUrl("admin-document-templates-storeDocumentTemplates");return $.read(e)},restoreDocumentTemplates:function(e){var t=this.serviceLocator.getUrl("admin-document-templates-restoreDocumentTemplates");return t+="?Guid="+e.Guid,$.read(t)},getWorkFlowClasses:function(){var e=this.serviceLocator.getUrl("admin-processes-workflowClasses");return $.read(e)},getTaskByWorkFlow:function(e){var t=this.serviceLocator.getUrl("admin-processes-tasksByWorkflow"),r={};return r.idWorkflow=e.idWorkflow,$.read(t,r)},modifyProcessDuration:function(e){var t=this.serviceLocator.getUrl("admin-processes-modifyProcessDuration"),r={};return r.idWorkflow=e.idWorkflow,r.duration=e.duration,$.create(t,r)},modifyTaskDuration:function(e){var t=this.serviceLocator.getUrl("admin-processes-modifyTaskDuration"),r={};return r.idTask=e.idTask,r.duration=e.duration,$.create(t,r)},getDataForMyTeam:function(){return $.ajax({url:this.serviceLocator.getUrl("bam-resourcemonitor-myteam"),type:"GET",dataType:"json"})},getReporstAnalysisQuery:function(){return $.read(this.serviceLocator.getUrl("reports-analysisquery"))},updateReportData:function(e){return $.update(this.serviceLocator.getUrl("reports-analysisquery-update"),e)},deleteReportData:function(e){return $.destroy(this.serviceLocator.getUrl("reports-analysisquery-delete")+"?"+e)},getStoreLanguageTemplates:function(){var e=this.serviceLocator.getUrl("admin-language-languages");return $.read(e,{justActives:!1})},getLanguageTemplate:function(e){var t=$.Deferred(),r=this.serviceLocator.getUrl("admin-language-resource")+"?cultureName="+e.cultureName;return t.resolve("OK"),window.location.href=r,t.promise()},processDefinition:function(e){return $.read(this.serviceLocator.getUrl("processviewer-processdefinition"),e)},graphicInfo:function(e){return $.read(this.serviceLocator.getUrl("processviewer-processgraphicinfo"),e)},getLastUpdateByMobile:function(){return $.read({url:this.serviceLocator.getUrl("mobile-getLastUpdate")})},getCollectionData:function(e){var t={},r=this.serviceLocator.getUrl("templates-handler-getCollectionData");return t.idFact=e.idFact,t.pag=e.page||1,t.pagSize=e.pageSize||10,t.filters=e.filters?Array.isArray(e.filters)?void 0:JSON.stringify(e.filters):void 0,$.read(r,t).pipe(function(e){return e})},getVirtualCollectionData:function(e){var t={},r=this.serviceLocator.getUrl("templates-handler-getVirtualCollectionData");return t.guidVirtualCollection=e.guidVirtualCollection,t.pag=e.page||1,t.pagSize=e.pageSize||10,t.filters=e.filters?Array.isArray(e.filters)?void 0:JSON.stringify(e.filters):void 0,$.read(r,t).pipe(function(e){return e})},getSearchData:function(e){var t=this,r=t.serviceLocator.getUrl("my-search-getData");r=r.replace("{guidSearch}",e.guidSearch);var a=e.filters||[],i={filters:JSON.stringify(a),pag:e.page||1,calculateFilters:e.calculateFilters||!1,pagSize:e.pageSize||10};return $.read(r,i).then(function(e){return t.serializeEntityData(e)})},getCollectionEntityData:function(e){var t,r=this,a={templateType:"VIRTUAL"===(e=e||{}).referenceType||"FACT"===e.referenceType?"List":"Content",surrogateKey:e.surrogateKey,pag:e.page||1,pagSize:e.pageSize||10,defaultFilterApplied:e.defaultFilterApplied,filters:JSON.stringify(e.filters)};return"VIRTUAL"===e.referenceType?(t=r.serviceLocator.getUrl("data-navigation-handler-collection"),a.reference=e.reference):(t=r.serviceLocator.getUrl("data-navigation-handler-entity"),a.reference=e.guidEntityCurrent,a.xpath=e.xpath,a.collectionId=e.reference),$.read(t,a).then(function(e){return r.serializeEntityData(e)})},getFiltersEntityData:function(e){var t={reference:(e=e||{}).guidEntityCurrent,collectionId:e.reference,surrogateKey:e.surrogateKey,xpath:e.xpath,templateType:"List",defaultFilterApplied:e.defaultFilterApplied,filters:JSON.stringify(e.filters)};return $.read({url:this.serviceLocator.getUrl("data-navigation-handler-entity-filters"),data:t})},getProcessAddAction:function(e){var t=this.serviceLocator.getUrl("action-handler-getProcessAddAction");return $.read(t,e).pipe(function(e){return e})},getMultipleActions:function(e){var t=this.serviceLocator.getUrl("templates-handler-getMultipleActions");return $.read(t,e).pipe(function(e){return e})},getMapping:function(e){return $.ajax({url:this.serviceLocator.getUrl("process-handler-getMapping"),data:e,type:"POST",dataType:"json"})},getForm:function(e){var t=this;return e[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=t.deviceType,e[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=t.deviceCode,$.ajax({url:t.serviceLocator.getUrl("process-handler-getForm"),data:e,type:"POST",dataType:"json"})},hasStartForm:function(e){var t={};return e.guid&&(t.guidWFClass=e.guid),$.read(this.serviceLocator.getUrl("process-handler-startform"),t)},executeAction:function(e){var t={surrogateKey:JSON.stringify(e.surrogatedKey),entityId:e.entityId,ruleId:e.processId};return $.create({url:this.serviceLocator.getUrl("process-action-execute"),data:t})},actionRule:function(e){var t={surrogateKey:e.surrogateKey,entityId:e.entityId,ruleId:e.processId};return $.create({url:this.serviceLocator.getUrl("process-handler-rule"),data:t,batchRequest:!1})},getActivitiesData:function(e){var t=this,r=t.serviceLocator.getUrl("process-handler-getActivitiesData"),a={page:(e=e||{}).page||1,pagsize:e.pageSize||10};return(void 0!==e.idworkflow&&e.idworkflow||void 0!==e.idWorkflow&&e.idWorkflow)&&(a.idWorkflow=e.idworkflow||e.idWorkflow),void 0!==e.idCase&&e.idCase&&(a.idCase=e.idCase),$.read(r,a).then(function(e){return t.serializeEntityData(e)})},getPendingsData:function(e){var t=this,r=t.serviceLocator.getUrl("process-handler-getPendingsData"),a={page:(e=e||{}).page||1,pagsize:e.pageSize||10};return(void 0!==e.idworkflow&&e.idworkflow||void 0!==e.idWorkflow&&e.idWorkflow)&&(a.idWorkflow=e.idworkflow||e.idWorkflow),void 0!==e.idCase&&e.idCase&&(a.idCase=e.idCase),void 0!==e.taskState&&e.taskState&&(a.taskState=e.taskState),$.read(r,a).then(function(e){return t.serializeEntityData(e)})},getActionsData:function(e){return e=e||{},$.read({url:this.serviceLocator.getUrl("entities-handler-getActions"),data:e,batchRequest:!0}).pipe(function(e){return e})},getUsersAndEvents:function(e){var t={};return e.idCases&&e.idCases.length>0&&(t.idCases=e.idCases.toString()),$.read(this.serviceLocator.getUrl("entities-handler-getUsersAndEvents"),t)},getUsers:function(e){e.caseId;return $.read({url:this.serviceLocator.getUrl("entities-handler-getUsers"),data:e,batchRequest:!0})},getEvents:function(e){e.caseId;return $.read({url:this.serviceLocator.getUrl("entities-handler-getEvents"),data:e,batchRequest:!0})},getUsersImages:function(e,t){var r={},a=this.serviceLocator.getUrl("entities-handler-getUsersImages");return t&&t.length>0&&(r.userIds=t.toString()),r.width=e.width,r.height=e.height,r.square=e.square,bizagi.util.getFeatureObject("userService.v1.enabled")?$.ajax({url:a,data:r,type:"POST",dataType:"json"}):$.read({url:a,data:r,dataType:"json"})},getShortCuts:function(e){var t={},r=this.serviceLocator.getUrl("entities-handler-getShotCuts");return void 0!==e.icon&&e.icon&&(t.icon=!0),$.read(r,t)},getSearchLists:function(){return $.read(this.serviceLocator.getUrl("my-search-getSearchLists"),{})},getIdCasesOfProcessEntities:function(e){e=e||{};var t={ids:JSON.stringify(e)};return bizagi.version.server.lessThanOrEqualsTo("11.0.0.2608")?$.read({url:this.serviceLocator.getUrl("process-handler-getIdCasesOfProcessEntities"),data:t}):$.ajax({url:this.serviceLocator.getUrl("process-handler-getIdCasesOfProcessEntities"),data:t,type:"POST"})},getQueryForm:function(e){return e=e||{},$.ajax({url:this.serviceLocator.getUrl("query-handler-getQueryForm"),data:e,type:"POST",dataType:e.dataType||"json"})},defineFilterObject:function(e,t,r){var a=e.properties,i=a.xpath.split("@")[0],s=t.find(function(e){return e.xpath==i});if(s){if("from"==a.rangeQuery)s.value=s.value||{},s.searchType="range",s.value.min=e.value;else if("to"==a.rangeQuery)s.value=s.value||{},s.searchType="range",s.value.max=e.value;else{e.properties.typeSearch=s.searchType;var o=l(e);$.extend(s,o)}a.orderType&&(s.orderType=a.orderType),r&&r(bizagi.clone(s))}else{var n=a.defaultFilter||!1;s=l(e),a.orderType&&(s.orderType=a.orderType),(void 0!==s.value||s.orderType||n)&&(t.push(s),r&&r(bizagi.clone(s)))}function l(e){var t=e.properties,r=t.typeSearch,a=e.value;if("boolean"==t.type&&("null"===a.toLowerCase()?(a=null,r="Nullable"):(a=bizagi.util.parseBoolean(a),r="exact")),"number"!=t.type&&"money"!=t.type&&"date"!=t.type||(r="exact"),"object"==typeof e.value){if(a=[],Array.isArray(e.value))for(var s=0,o=e.value.length;s<o;s++){var n=parseInt(e.value[s].id);isNaN(n)||a.push(n)}else{n=parseInt(e.value.id);isNaN(n)||a.push(n)}r="exact",a=a.length>0?a:void 0}t.rangeQuery&&"none"!==t.rangeQuery&&(a={min:e.value,max:e.value},r="range");var l={xpath:i,searchType:r=r||"approx"};return void 0!==a&&(l.value=a),l}},getPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-get");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getActivities:function(e){var t=this.serviceLocator.getUrl("project-plan-activities");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},updatePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-update");return $.update({url:t.replace("{idPlan}",e.id),data:JSON.stringify(e),dataType:"json",contentType:"application/json"})},putExecutePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-execute");return $.create({url:t,data:e,contentType:"application/x-www-form-urlencoded"})},deletePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-delete");return $.destroy({url:t.replace("{idPlan}",e.id),data:e,contentType:"application/x-www-form-urlencoded"})},closePlan:function(e){var t=this.serviceLocator.getUrl("project-plan-close");return $.create({url:t,data:e,contentType:"application/x-www-form-urlencoded"})},getWorkitemsPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-workitems");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getTransitionsByPlan:function(e){var t=this.serviceLocator.getUrl("project-plan-transitions-get");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},editActivityPlan:function(e){var t={};e.activity?(t=e.activity).items=e.items:t=e;var r=this.serviceLocator.getUrl("project-plan-activity-edit").replace("{idPlan}",t.idPlan).replace("{id}",t.id);return $.update({url:r,data:JSON.stringify(t),dataType:"json",contentType:"application/json"})},getPlanByParent:function(e){var t=this.serviceLocator.getUrl("project-plan-get-by-parent"),r=$.Deferred();return $.when($.read({url:t,data:e,dataType:"json",contentType:"application/json"})).done(function(e){r.resolve(e)}),r.promise()},getItemsByActivity:function(e){var t=this.serviceLocator.getUrl("project-plan-activity-tasks-get");return $.read({url:t,data:e,dataType:"json",contentType:"application/json"})},getPlanParent:function(e){var t=this.serviceLocator.getUrl("project-plan-parent");return $.read({url:t,data:e,dataType:"json"})},serializeEntityData:function(e){var t=e;function r(e,t){var r={data:{},guid:t.guidEntity,timestamp:e.timestamp},a=e.columns,i=t.row;for(name in t)t.hasOwnProperty(name)&&"row"!==name.toString()&&"id"!==name.toString()&&(r[name]=t[name]);for(var s=0,o=a.length;s<o;s+=1)r.data[a[s]]=i[s];return r}t.entities=[];for(var a,i=-1;a=e.rows[++i];)for(var s,o=-1;s=e.cells[++o];)if(s.id===a.id){var n=r(s,a);t.entities.push(n);break}return t}}),$.Class.extend("bizagi.workportal.services.routing",{BIZAGI_WORKPORTAL_WIDGET_START_FORM:"startForm"},{init:function(e){var t=this;e=e||{},t.params=e.params||{},t.dataService=e.dataService||{},t.modules={render:"activityform",oldRender:"oldrenderintegration",async:"async",activitySelector:"routing"},t.renderVersion=2,t.resetRouteInformation()},resetRouteInformation:function(){this.route={module:"",moduleParams:{}}},setRenderParams:function(e){this.params=this.getRenderParams(e)},getRenderParams:function(e){var t={idCase:parseInt(e.idCase||0),idWorkflow:parseInt(e.idWorkflow||0),idWorkitem:e.idWorkitem||e.idWorkItem||0,idTask:parseInt(e.idTask||0),eventAsTasks:e.eventAsTasks||!1,onlyUserWorkItems:e.onlyUserWorkItems||"true",formsRenderVersion:e.formsRenderVersion||0,referrer:e.referrer||"",isComplex:void 0!==e.isComplex,formsRenderVersion:2,onClose:e.onClose||"",isOfflineForm:e.isOfflineForm||!1,radNumber:e.radNumber||null},r=!0;try{r=BIZAGI_SETTINGS.skipSubprocessGlobalForm||!0}catch(e){}return this.skipSubprocessGlobalForm="true"==r,t},getRoute:function(e){var t=this,r=new $.Deferred;t.params=e||t.params;var a=e.fromTask||e.idTask||"",i=e.fromWorkItemId||e.idWorkitem||e.idWorkItem||"";return $.when(t.getRenderVersion(t.params)).done(function(e){t.renderVersion=e,t.route.moduleParams=t.getRenderParams(t.params),$.when(t.dataService.getWorkitems({idCase:t.params.idCase,onlyUserWorkItems:t.params.onlyUserWorkItems,isOfflineForm:t.params.isOfflineForm,fromTask:a,fromWorkItemId:i})).done(function(a){var i=a.workItems.length;if(t.route.moduleParams.hasWorkItems=!!i,t.route.moduleParams.isEvent=t.params.isEvent||!1,t.route.moduleParams.hasGlobalForm=bizagi.util.parseBoolean(a.hasGlobalForm),t.route.moduleParams.idWorkitem>0){if(t.setRenderModuleName(t.getRenderModuleName(e)),0===t.route.moduleParams.idTask&&(t.route.moduleParams.idTask=t.searchIdTask(t.route.moduleParams.idWorkitem)),t.route.moduleParams.radNumber=a.radNumber||"",t.route.moduleParams.idWorkflow=a.idWorkFlow||"",!t.route.moduleParams.displayName&&!t.params.displayName){var s=a.workItems.find(function(e){return Number(e.idWorkItem)===Number(t.route.moduleParams.idWorkitem)});void 0!==s&&s.displayName&&(t.route.moduleParams.displayName=s.displayName)}r.resolve(t.route),t.resetRouteInformation()}else{var o=t.checkAsyncWorkItems(a);if(0===i)t.route.moduleParams.idWorkflow=a.idWorkFlow||"",t.route.moduleParams.radNumber=a.radNumber||"",""!==$.trim(a.msgTask)?r.resolve(t.routeToMessageForm(a.msgTask)):bizagi.util.parseBoolean(a.hasGlobalForm)?(t.route.moduleParams.displayName=null,r.resolve(t.routeToGlobalForm(a))):r.resolve(t.routeToGlobalFormWithoutData());else if(1===i||o.length>0){var n=0;if(o.length>0)for(var l=0;l<i;l++)if("true"==a.workItems[l].isAsynch){n=l;break}t.route.moduleParams.idCase=a.workItems[n].idCase,t.route.moduleParams.idTask=a.workItems[n].idTask,t.route.moduleParams.fromTask=a.workItems[n].idTask,t.route.moduleParams.idWorkitem=a.workItems[n].idWorkItem,t.route.moduleParams.idWorkflow=a.workItems[n].idWorkFlow,t.route.moduleParams.displayName=a.workItems[n].displayName?a.workItems[n].displayName:"",t.route.moduleParams.radNumber=a.radNumber||"",o.length>0?t.setRenderModuleName(t.modules.async):t.setRenderModuleName(t.getRenderModuleName(e)),r.resolve(t.route),t.resetRouteInformation()}else a.checkProcess=!!(a.subProcesses.length>0&&t.skipSubprocessGlobalForm),a.checkWorkItems=i>1,a.fromSearchWidget="search"==t.params.referrer,t.setRenderModuleName(t.modules.activitySelector),t.route.moduleParams.data=a,r.resolve(t.route),t.resetRouteInformation()}}).fail(function(e){var a=bizagi.localization.getResource("workportal-menu-search-found-no-cases");r.resolve(t.routeToMessageForm(a))})}).fail(function(e,t,a){r.reject()}),r.promise()},setRenderModuleName:function(e){this.route.module=e,this.route.moduleParams.widgetName=e},getRenderModuleName:function(e){return 1==e?this.modules.oldRender:this.modules.render},searchIdTask:function(e,t){for(var r=0,a=0,i=(e=e||[]).length;a<i;a++)if(parseInt(e[a].idWorkItem)==parseInt(t)){r=parseInt(e[a].idTask);break}return r},checkAsyncWorkItems:function(e){var t=[];return $.each(e.workItems,function(r){"true"==e.workItems[r].isAsynch&&t.push({idCase:e.idCase,idWorkitem:e.workItems[r].idWorkItem,idTask:e.workItems[r].idTask})}),t},routeToGlobalForm:function(e){var t=this;if(t.route.moduleParams.idCase=$.isNumeric(e.idCaseForGlobalForm)&&e.idCaseForGlobalForm>0?e.idCaseForGlobalForm:t.route.moduleParams.idCase,t.route.moduleParams.idWorkflow=parseInt(e.idWorkFlow||0),1==t.renderVersion){var r=t.dataService.serviceLocator.getUrl("old-render")+"?PostBack=1&idCase=%s&idWorkitem=%s&idTask=%s",a=t.route.moduleParams.idCase||"",i=t.route.moduleParams.idWorkitem||"",s=t.route.moduleParams.idTask||"",o=printf(r,a,i,s);t.route.moduleParams.onlyUserWorkItems=t.route.moduleParams.idCase||"",t.setRenderModuleName(t.modules.oldRender),t.route.moduleParams.url=o}else t.setRenderModuleName(t.modules.render);return t.route},routeToGlobalFormWithoutData:function(){return this.setRenderModuleName(this.modules.render),this.route.moduleParams.withOutGlobalForm=!0,this.route},routeToMessageForm:function(e){var t=this;return e=e||"",t.setRenderModuleName(t.modules.render),t.route.moduleParams.withOutGlobalForm=!0,t.route.moduleParams.messageForm=e,t.route},getRenderVersion:function(e){var t=new $.Deferred,r=e.formsRenderVersion||0;return 0!=r?t.resolve(r):$.when(this.dataService.getCaseFormsRenderVersion({idCase:e.idCase})).done(function(e){r=parseInt(e.formsRenderVersion),t.resolve(r)}).fail(function(e,r,a){t.reject()}),t.promise()}}),$.Class.extend("bizagi.workportal.device.factory",{},{init:function(e){this.device=bizagi.util.detectDevice(),this.workportal=e,this.cachedFacade=null},getWorkportalFacade:function(e,t){var r=this,a=new $.Deferred;if(t=void 0===t||t,null!=r.cachedFacade)a.resolve(r.cachedFacade);else{if("desktop"===this.device)return r.cachedFacade=new bizagi.workportal.desktop.facade(this.workportal,e),$.when(r.cachedFacade.initAsyncStuff(t)).done(function(){a.resolve(r.cachedFacade)}),a.promise();if(bizagi.util.isTabletDevice())return r.cachedFacade=new bizagi.workportal.tablet.facade(e,this.device),$.when(r.cachedFacade.initAsyncStuff()).done(function(){a.resolve(r.cachedFacade)}),a.promise();if(bizagi.util.isSmartphoneDevice())return r.cachedFacade=new bizagi.workportal.smartphone.facade(e,this.device),$.when(r.cachedFacade.initAsyncStuff()).done(function(){a.resolve(r.cachedFacade)}),a.promise();bizagi.showMessageBox("Not supported device: "+this.device,"Error"),a.resolve("")}return a.promise()},getDataService:function(){return this.dataService}}),-1!=location.href.indexOf("#")&&(document.location="index.html"),bizagi.workportal=bizagi.workportal||{},bizagi.workportal.currentInboxView="inbox",bizagi.workportal.state=bizagi.workportal.state||{},bizagi.webparts=bizagi.webparts||{},bizagi.webparts.instances=bizagi.webparts.instances||[],$.Class.extend("bizagi.workportal.facade",{},{init:function(e){if(this.deviceFactory=new bizagi.workportal.device.factory(this),this.dataService=new bizagi.workportal.services.service(e),this.dataService.routing=new bizagi.workportal.services.routing({dataService:this.dataService}),!bizagi.util.isEmpty(window.location.search)){var t=bizagi.util.getQueryString();t.idCase&&(e.idCase=t.idCase,this.isConfiguredFromHash=!0),t.idWorkitem&&(e.idWorkitem=t.idWorkitem)}this.defaultParams=e||{}},createWebpart:function(e){return this.executeWebpart($.extend(e,{creating:!0}))},executeWebpart:function(e){var t=this.ownerDocument,r=($("body",t),e.canvas),a=!0;if(e.webpartConfiguration&&(a=this.testWebpartConfiguration(e)),a)return this.processWebpart(e).then(function(e){return e.name=e.webpart.Class.fullName,bizagi.webparts.instances.push(e),r.append(e.content),r.triggerHandler("ondomincluded"),e})},ready:function(){return this.executionDeferred.promise()},processWebpart:function(e){var t,r=new $.Deferred,a=this.deviceFactory.getWorkportalFacade(this.dataService,!1);return $.extend(e,this.defaultParams),$.when(a).then(function(t){var r=new $.Deferred;return $.when(t.loadWebpart(e)).done(function(){r.resolve(t)}),r.promise()}).then(function(r){return(t=r.getWebpart(e.webpart,e)).render(e)}).then(function(e){r.resolve({webpart:t,content:e})}).fail(function(e){r.reject(e)}),r.promise()},getMainController:function(){return this.mainController},execute:function(){var e=this,t=arguments,r=this.deviceFactory.getWorkportalFacade(e.dataService);return e.processOfflineData(),bizagi.loading.start(),$.when(r).then(function(e){return e.executeWebparts(t)}).then(function(){if(!bizagi.util.isEmpty(e.defaultParams.idCase)&&e.isConfiguredFromHash){var t={action:"routing",idCase:e.defaultParams.idCase};e.defaultParams.idWorkitem&&(t.idWorkitem=e.defaultParams.idWorkitem);var r=$("#homePortal").data("kendoMobileSplitView");r&&r.element&&r.element.hide(),bizagi.webpart.publish("executeRoutingAction",t)}else(!bizagi.util.isNativePluginSupported()||bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSTabletDevice())&&bizagi.kendoMobileApplication.navigate("#homePortal");bizagi.loading.stop()})},processOfflineData:function(){var e=this;!(bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice())&&void 0!==e.dataService.fetchOfflineData&&!0===e.dataService.online&&(bizagi.util.isNativePluginSupported()&&bizagi.util.isOfflineFormsV2Supported()&&bizagiapp.openSyncDialog(),$.when(e.dataService.pushOfflineData()).always(function(t){e.dataService.fetchOfflineData(t)}))}}),$.Class.extend("bizagi.workportal.smartphone.facade",{render_module:"renderingflat",setup:function(){this.render_module=bizagi.override.enableMSF?"rendering":"renderingflat"},getWidgetImplementation:function(e){bizagi.log("getWidgetImplementation"+e)}},{init:function(e,t){var r=this;r.templates={},r.dataService=e,r.setMobileMetaTags(),r.setMobileIcons(),r.modules={},r.device=t,r.homePortalFramework=new bizagi.workportal.homeportalFramework(this),bizagi.override.enableMSF?bizagi.hasOwnProperty("kendo")?r.templateService=new bizagi.kendo.templates.services.service(bizagi.localization):r.templateService=new bizagi.templates.services.service(bizagi.localization):r.templateService=new bizagi.kendo.templates.services.service(bizagi.localization)},setMobileMetaTags:function(){$("<meta>",{name:"apple-mobile-web-app-capable",content:"yes"}).appendTo("head"),$("<meta>",{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"}).appendTo("head"),$("<link>",{rel:"apple-touch-icon-precomposed",href:"jquery/common/base/css/smartphone/images/BizAgi_logo.png"}).appendTo("head"),$("<link>",{rel:"apple-touch-startup-image",href:"jquery/common/base/css/smartphone/images/splash.png"}).appendTo("head")},setMobileIcons:function(){$("head").append('<svg xmlns="http://www.w3.org/2000/svg" display="none" width="0" height="0" id="genome-mobile-icons"><defs> <path d="M14,11 C14.5522847,11 15,11.4477153 15,12 C15,12.5522847 14.5522847,13 14,13 C13.4477153,13 13,12.5522847 13,12 C13,11.4477153 13.4477153,11 14,11 Z M10.62,11.22 C10.8071865,11.4087188 10.9115368,11.664197 10.91,11.93 C10.9115368,12.195803 10.8071865,12.4512812 10.62,12.64 L8.53,14.71 C8.34373936,14.8947442 8.09233988,14.9988954 7.83,15 C7.5627541,14.9988906 7.30707144,14.8908556 7.12,14.7 C6.73227641,14.3099625 6.73227641,13.6800375 7.12,13.29 L7.42,13 L4.55,13 C3.61113249,13.0026559 2.7096639,12.6322374 2.04390894,11.9702332 C1.37815398,11.308229 1.00264842,10.4088675 1,9.47 L1,7 C1,6.44771525 1.44771525,6 2,6 C2.55228475,6 3,6.44771525 3,7 L3,9.47 C3.01094569,10.3182207 3.70170869,11.0000706 4.55,11 L7.55,11 L7.12,10.58 C6.93068735,10.3922334 6.82420168,10.1366375 6.82420168,9.87 C6.82420168,9.60336246 6.93068735,9.3477666 7.12,9.16 C7.51003745,8.77227641 8.13996255,8.77227641 8.53,9.16 L10.62,11.22 Z M2,3 C2.55228475,3 3,3.44771525 3,4 C3,4.55228475 2.55228475,5 2,5 C1.44771525,5 1,4.55228475 1,4 C1,3.44771525 1.44771525,3 2,3 Z M11.45,3 C12.3888675,2.99734409 13.2903361,3.36776255 13.9560911,4.02976678 C14.621846,4.691771 14.9973516,5.59113247 15,6.53 L15,9 C15,9.55228475 14.5522847,10 14,10 C13.4477153,10 13,9.55228475 13,9 L13,6.53 C12.9890543,5.6817793 12.2982913,4.99992938 11.45,5 L8.45,5 L8.88,5.42 C9.06931265,5.6077666 9.17579832,5.86336246 9.17579832,6.13 C9.17579832,6.39663754 9.06931265,6.6522334 8.88,6.84 C8.69128117,7.02718651 8.43580298,7.13153676 8.17,7.13 C7.90766012,7.12889538 7.65626064,7.02474416 7.47,6.84 L5.38,4.78 C5.19281349,4.59128117 5.08846324,4.33580298 5.09,4.07 C5.08846324,3.80419702 5.19281349,3.54871883 5.38,3.36 L7.47,1.29 C7.86212218,0.900639269 8.49563924,0.902877853 8.88499998,1.29500002 C9.27436072,1.68712218 9.27212216,2.32063925 8.88,2.71 L8.58,3 L11.45,3 Z" id="icon-sync-path-1"/> </defs><symbol viewBox="0 0 16 16" id="icon-sync"><desc>Created with sketchtool.</desc> \x3c!-- Generator: sketchtool 54.1 (76490) - https://sketchapp.com --\x3e    <g id="icon-sync-Mobile-Prototype" stroke="none" stroke-width="1" > <g id="icon-sync-Inbox-Offline-Edited" transform="translate(-311.000000, -157.000000)"> <g id="icon-sync-cases" transform="translate(0.000000, 141.000000)"> <g id="icon-sync-case"> <g id="icon-sync-edited" transform="translate(311.000000, 16.000000)"> <g id="icon-sync-2.0/16x/cloud"> <mask id="icon-sync-mask-2" fill="white"> <use xlink:href="#icon-sync-path-1"/> </mask> <use id="icon-sync-Mask" xlink:href="#icon-sync-path-1"/> </g> </g> </g> </g> </g> </g> </symbol><symbol viewBox="0 0 32 32" id="icon-trash"><desc>Created with sketchtool.</desc> \x3c!-- Generator: sketchtool 54.1 (76490) - https://sketchapp.com --\x3e   <g id="icon-trash-Mobile-Prototype" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="icon-trash-Drafts-Offline" transform="translate(-335.000000, -149.000000)"> <g id="icon-trash-cases" transform="translate(0.000000, 141.000000)"> <g id="icon-trash-case"> <g id="icon-trash-icon" transform="translate(335.000000, 8.000000)"> <rect id="icon-trash-box" x="0" y="0" width="32" height="32"/> <path d="M21,13 C21.553,13 22,13.447 22,14 L22,21 C22,22.654 20.654,24 19,24 L13,24 C11.346,24 10,22.654 10,21 L10,14 C10,13.447 10.447,13 11,13 C11.553,13 12,13.447 12,14 L12,21 C12,21.552 12.448,22 13,22 L19,22 C19.552,22 20,21.552 20,21 L20,14 C20,13.447 20.447,13 21,13 Z M14,19.5 C14,19.776 13.776,20 13.5,20 C13.224,20 13,19.776 13,19.5 L13,14.5 C13,14.224 13.224,14 13.5,14 C13.776,14 14,14.224 14,14.5 L14,19.5 Z M16.5,19.5 C16.5,19.776 16.276,20 16,20 C15.724,20 15.5,19.776 15.5,19.5 L15.5,14.5 C15.5,14.224 15.724,14 16,14 C16.276,14 16.5,14.224 16.5,14.5 L16.5,19.5 Z M19,19.5 C19,19.776 18.776,20 18.5,20 C18.224,20 18,19.776 18,19.5 L18,14.5 C18,14.224 18.224,14 18.5,14 C18.776,14 19,14.224 19,14.5 L19,19.5 Z M23,10 C23.553,10 24,10.447 24,11 C24,11.553 23.553,12 23,12 L9,12 C8.447,12 8,11.553 8,11 C8,10.447 8.447,10 9,10 L13,10 L13,9 C13,8.447 13.447,8 14,8 L18,8 C18.553,8 19,8.447 19,9 L19,10 L23,10 Z" id="icon-trash-trash" fill="#9E9E9E"/> </g> </g> </g> </g> </g> </symbol><symbol viewBox="0 0 24 24" id="icon-offline"><desc>Created with sketchtool.</desc> \x3c!-- Generator: sketchtool 54.1 (76490) - https://sketchapp.com --\x3e   <g id="icon-offline-Mobile-Prototype" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="icon-offline-Inbox-Offline" transform="translate(-32.000000, -97.000000)" fill="#9E9E9E"> <g id="icon-offline-controls/alert" transform="translate(16.000000, 84.000000)"> <g id="icon-offline-icon" transform="translate(16.000000, 13.000000)"> <path d="M7.86075713,14.278983 L8.17741033,13.9623298 C8.61266861,13.5270715 9.31870454,13.5270715 9.75396283,13.9623298 L12.0238702,16.2322372 L14.2937776,13.9623298 C14.7290359,13.5270715 15.4350718,13.5270715 15.8703301,13.9623298 L16.1869833,14.278983 C16.6222416,14.7146143 16.6222416,15.4202772 16.1869833,15.8555355 L13.9170759,18.1250699 L16.0777025,20.2856965 C16.5129608,20.7209548 16.5129608,21.4273637 16.0777025,21.862622 L15.7610493,22.1789022 C15.325791,22.6141605 14.6197551,22.6141605 14.1844968,22.1789022 L12.0238702,20.0182756 L9.86287064,22.1789022 C9.42761236,22.6141605 8.72157643,22.6141605 8.28631815,22.1789022 L7.96966495,21.862622 C7.53440666,21.4273637 7.53440666,20.7209548 7.96966495,20.2856965 L10.1302915,18.1250699 L7.86075713,15.8555355 C7.42549885,15.4202772 7.42549885,14.7142413 7.86075713,14.278983 M4.49878784,10.0558215 C6.56169578,8.40765836 9.17138062,7.41517996 12.0171567,7.41517996 C14.846522,7.41517996 17.4431529,8.39572325 19.5008392,10.0267297 C19.8999192,10.2557344 20.1714428,10.6812955 20.1714428,11.1743644 C20.1714428,11.9080002 19.5769255,12.5025176 18.8436626,12.5025176 C18.4408529,12.5025176 18.0842917,12.3193883 17.840741,12.0359296 L17.8317896,12.044881 C16.2276372,10.7887114 14.2128427,10.0334432 12.0175297,10.0334432 C9.81028159,10.0334432 7.78504382,10.7965438 6.17678871,12.0646485 L6.16746441,12.0553242 C5.92391372,12.3440045 5.56399577,12.5316094 5.15671039,12.5316094 C4.42307453,12.5316094 3.82855722,11.9370921 3.82855722,11.2034562 C3.82818425,10.7103873 4.09970784,10.2851992 4.49878784,10.0558215 M24,7.33573693 C24,8.06899981 23.4054827,8.6638901 22.6714739,8.6638901 C22.2716479,8.6638901 21.9173245,8.48337167 21.6737739,8.20326972 L21.632001,8.24504258 C19.0402188,6.00497296 15.6648225,4.64660906 11.9701622,4.64660906 C8.288183,4.64660906 4.92322994,5.99564866 2.3348045,8.22191832 C2.09125381,8.50798782 1.73282775,8.69298191 1.32815317,8.69298191 C0.594517312,8.69298191 0,8.0984646 0,7.36482874 C0,6.90495431 0.234226394,6.49990676 0.589668677,6.26157767 C3.65475228,3.60937403 7.64629825,2 12.0175297,2 C16.3730963,2 20.3515882,3.59818487 23.4118232,6.2332318 C23.7665195,6.47156089 24,6.87623547 24,7.33573693" id="icon-offline-icon-offline"/> </g> </g> </g> </g> </symbol></svg>')},initAsyncStuff:function(){var e=this;return $.when(e.loadTemplate("base",bizagi.getTemplate("base.workportal.smartphone"))).then(function(){var t=new $.Deferred;return $("body").append(e.getTemplate("base")),bizagi.util.smartphone.startkendo({started:function(){t.resolve()}}),t.promise()})},loadTemplate:function(e,t){var r=this;return r.templateService.getTemplate(t,e).done(function(t){"string"==typeof t&&(r.templates[e]=$.trim(t.replace(/\n/g,"")))})},loadTemplateWebpart:function(e,t){var r=this;return r.templateService.getTemplateWebpart(t,e).done(function(t){r.templates[e]=$.trim(t.replace(/\n/g,""))})},getTemplate:function(e){return this.templates[e]},loadWebpart:function(e){var t=this,r=new $.Deferred,a=e.webpart,i=bizagi.getWebpart(a,e);return i||bizagi.log("webpart not found"),"release"===bizagi.loader.environment?r.resolve(i):$.when(bizagi.util.initWebpart(i,t.device)).done(function(){$.when.apply(this,$.map(i.tmpl,function(e){return t.loadTemplateWebpart(e.originalAlias,bizagi.getTemplate(e.alias,!0))})).done(function(){r.resolve(i)})}),r.promise()},getWebpart:function(webpartImplementation,params){try{var dynamicFunction;-1===webpartImplementation.indexOf("bizagi")&&(webpartImplementation="bizagi.workportal.webparts."+webpartImplementation);var stringBuilder=["var baDynamicFn = function(facade, dataService, params){ \r\n"];return stringBuilder.push("return new "+webpartImplementation+"(facade, dataService, params);\r\n"),stringBuilder.push("}\r\n"),stringBuilder.push("baDynamicFn"),dynamicFunction=eval(stringBuilder.join("\n")),dynamicFunction(this,this.dataService,params)}catch(e){bizagi.log(e)}},executeWebpart:function(e){var t=this,r=new $.Deferred;return $.when(t.loadWebpart(e)).done(function(a){var i=a.class,s=t.getWebpart(i,e);$.when(s.render($.extend(e,{creating:!1}))).done(function(){e.canvas.triggerHandler("ondomincluded"),r.resolve(s)})}),r.promise()},executeWebparts:function(){var e=this,t=["homePortal","render","menu","newcase","summaryCase"];return e.loadModule(e.Class.render_module),t=arguments.length>0&&arguments[0].length>0&&arguments[0][0].executeParams?arguments[0][0].executeParams:t,$.when(e.dataService.getCurrentUser()).then(function(r){var a;r.userProperties={};for(var i=-1;a=r.sUserProperties[++i];)r.userProperties[a.key]=a.value;bizagi.currentUser=r;var s=r.userProperties.userstartpage=r.userProperties.userstartpage||"";e.sortMenuItemsByStartPage(s,r);var o,n=-1,l=[];return $.when(e.loadReleaseTemplates()).then(function(){for(;o=t[++n];){var r=e.executeWebpart({webpart:o,canvas:$("body")});l.push(r)}return $.when.apply($,l)})}).fail(function(){$.when(e.dataService.logoutMobile()).always(function(){e.defaultLogout()})})},loadReleaseTemplates:function(){if("release"!==bizagi.loader.environment)return!0;var self=this,defer=new $.Deferred,prefix=bizagi.loader.useAbsolutePath?bizagi.loader.basePath+bizagi.loader.getLocationPrefix():""+bizagi.loader.getLocationPrefix(),url=prefix+"jquery/workportalflat/production/"+this.device.replace(/[^a-z0-9]+/gi,"")+"/webpart."+this.device.replace(/[^a-z0-9]+/gi,"")+".production.tmpl.html?build="+bizagi.loader.build;return steal.then({src:url,id:url,type:"text",waits:!1,onError:function(e){bizagi.log("Could not load file "+e.src,e,"error"),defer.reject(e)}}).then(function(){var waitingTime=1e3;setTimeout(function(){var data=steal.resources[url].options.text;self.templates=eval("("+data+")"),Object.keys(self.templates).map(function(e){self.templates[e]=self.templateService.localization.translate(self.templates[e])}),defer.resolve()},waitingTime)}),defer.promise()},sortMenuItemsByStartPage:function(e,t){var r=this;("1"===e||"2"===e)&&void 0!==t.associatedStakeholders&&t.associatedStakeholders.length>0?r.homePortalFramework.homePortalLayout=$.extend(r.homePortalFramework.homePortalLayoutDashboard,r.homePortalFramework.homePortalLayoutTaskFeed,r.homePortalFramework.homePortalLayoutComplement):r.homePortalFramework.homePortalLayout=$.extend(r.homePortalFramework.homePortalLayoutTaskFeed,r.homePortalFramework.homePortalLayoutDashboard,r.homePortalFramework.homePortalLayoutComplement)},loadModule:function(e){var t=this;if("string"==typeof e)return void 0!==t.modules[e]?t.modules[e]:(t.modules[e]=new $.Deferred,bizagi.loader.start(e).then(function(){t.modules[e].resolve()}),t.modules[e].promise())},defaultLogout:function(){bizagi.util.isCordovaSupported()?window.location=bizagi.services.ajax.logoutPage:window.location.replace("")}}),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.webparts=void 0!==bizagi.webparts?bizagi.webparts:{},$.Class.extend("bizagi.workportal.webpart.helper",{},{init:function(e){this.dataService=e.dataService,this.resources=e.resources,this.workportalFacade=e.workportalFacade,this.templates={}},getFileImage:function(e){return e&&0!=e.length?e:this.getEmptyFile()},getFile:function(e){return e&&0!=e.length?this.dataService.getFile(e[0]):this.getEmptyFile()},loadTemplate:function(e,t){var r=this;return r.workportalFacade.templateService.getTemplate(t).done(function(t){r.templates[e]=t})},isWebpartInIFrame:function(){try{return window.self!==window.top}catch(e){return!0}},getFailServerErrorDeferred:function(e,t,r){}}),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.webpart=void 0!==bizagi.webpart?bizagi.webpart:{},bizagi.webpart.subscribe=function(e,t){$(document).bind(e,t)},bizagi.webpart.publish=function(e,t){return $(document).triggerHandler(e,t)},bizagi.webpart.whenCreated=function(e,t){bizagi.webpart.subscribe("bizagi-webpart-created",function(r){r.webpart.Class.fullname=="bizagi.workportal.webparts."+e&&t&&t(r)})},bizagi.webpart.whenExecuted=function(e,t){bizagi.webpart.subscribe("bizagi-webpart-executed",function(r){r.webpart.Class.fullname=="bizagi.workportal.webparts."+e&&t&&t(r)})},bizagi.workportal.controllers.controller.extend("bizagi.workportal.webparts.webpart",{BIZAGI_WORKPORTAL_WEBPART_ROUTING:"routing",BIZAGI_WORKPORTAL_WEBPART_RENDER:"activityform",BIZAGI_WORKPORTAL_WEBPART_ASYNC:"async",BIZAGI_WORKPORTAL_WEBPART_OLDRENDERINTEGRATION:"oldrenderintegration"},{init:function(e,t,r){var a=this;this._super(e,t,r),this.helper=new bizagi.workportal.webpart.helper(this),this.canvas=r.canvas,this.pane=r.pane,this.project=r.project,this.sharepointProxyPrefix=r.sharepointProxyPrefix,this.homePortalFramework=this.workportalFacade.homePortalFramework,this.namespace=r.namespace,this.isVisible=!0,this.isWebpartInIFrame=void 0!==r.isWebpartInIFrame?r.isWebpartInIFrame:a.helper.isWebpartInIFrame(),this.adjustButtonsToContent=r.adjustButtonsToContent,this.remoteServer=r.remoteServer,this.remoteServer&&(a.postmessageSocket=new bizagi.postmessage({remoteServer:this.remoteServer,destination:window.parent,origin:window}),a.postmessageSocket.receive=function(e){var t=e.data;if((!t.message||t.message.iframeidentifier!=BIZAGI_IFRAME_IDENTIFIER)&&t.event)switch(t.event){case"postmessage-bizagi-canCloseIFramePopUp":a.canHide&&a.Class.shortName==t.message.webPartDestine&&$.when(a.canHide()).done(function(){var e={event:"postmessage-bizagi-closeIFramePopUp",message:{}};e.message.iframeidentifier=BIZAGI_IFRAME_IDENTIFIER,a.postmessageSocket.send(e);var t={message:{},event:"ui-bizagi-reload-cases"};a.postmessageSocket.send(t)});break;case"postmessage-bizagi-openParentPopUp":break;default:a.publish(t.event,t.message,!0)}},a.postmessageSocket.startReceiving(),a.sendDimensionsiFrame())},sendDimensionsiFrame:function(e){var t=this;this.remoteServer&&(t.adjustButtonsToContent||t.namespace&&!e||t.isWebpartInIFrame&&window.setTimeout(function(){var e={message:{}};e.message.iframeName=BIZAGI_IFRAME_IDENTIFIER,e.message.iframeHeight=$("body").height(),"newcaselist"==t.Class.shortName||(e.message.iframeWidth=void 0),t.postmessageSocket.send(e)},50))},publish:function(e,t,r){if(e=this.namespace?this.namespace+"."+e:e,!r&&-1==e.indexOf("bizagi-webpart-created")&&-1==e.indexOf("bizagi-webpart-executed")&&this.postmessageSocket){var a={};a.event=e,t&&(t.canvas=null,t.workportal=null),a.message={},a.message=$.extend(t,{project:this.project,iframeidentifier:BIZAGI_IFRAME_IDENTIFIER}),this.postmessageSocket.send(a)}return this._super(e,$.extend(t,{project:this.project}))},subscribe:function(e,t){var r=this;e=this.namespace?this.namespace+"."+e:e,this._super(e,function(e,a){if(void 0===a&&(a={}),r.project==a.project&&r.isVisible)return t(e,a)})},unsubscribe:function(e,t){e=this.namespace?this.namespace+"."+e:e,this._super(e,t)},refresh:function(e){var t,r=this;return(t="view"==r.canvas.data("role")?r.canvas.data("kendoMobileView").contentElement():r.canvas).empty(),r.render(e).then(function(e){return t.append(e),r.canvas.triggerHandler("ondomincluded"),"included"})},render:function(e){var t=this;return t.params=e,e.creating?(t.content=t.empty(),t.publish("bizagi-webpart-created",{webpart:t}),t.content):(t.publish("bizagi-webpart-created",{webpart:t}),$.when(t.renderContent(e)).pipe(function(r){return"string"==typeof r&&(r=$(r)),t.content=r,e.canvas.append(r),$.when(t.postRender(e)).then(function(){return t.publish("bizagi-webpart-executed",{webpart:t}),t.sendDimensionsiFrame(),t.getContent()})}))},renderContent:function(e){},postRender:function(e){},getContent:function(){return this.content},empty:function(){return $("<div/>")},getTemplate:function(e){return this.workportalFacade.getTemplate(e)},createWebpart:function(e){return this.workportalFacade.workportal.createWebpart(e)},executeWebpart:function(e){return this.workportalFacade.workportal.executeWebpart(e)},manageError:function(e,t,r){var a=this,i="";if(-1==(i=e.responseText?e.responseText:e).indexOf("AUTHENTICATION_ERROR"))a.helper.getFailServerErrorDeferred({message:i,sharepointProxyPrefix:a.sharepointProxyPrefix},t),a.endWaiting(),r&&t.done(function(e){r.append(e),a.endWaiting()});else{var s=a.content="<div class='ui-bizagi-webpart-error-message'>The current user does not exist as a registered user in the bizagi project</div>";r&&r.append(s),a.endWaiting(),t.resolve(s)}},hide:function(e){this.canvas.hide(),e&&this.canvas.parent().hide(),this.isVisible=!1},show:function(){this.canvas.show(),this.canvas.parent().show(),this.isVisible=!0},isVisible:function(){return this.isVisible},destroy:function(){},getHomeportalFrameworkIntance:function(){return this.workportalFacade.homePortalFramework||(this.workportalFacade.homePortalFramework=new bizagi.workportal.homeportalFramework(this.workportalFacade)),this.workportalFacade.homePortalFramework}}),bizagi.workportal.webparts.webpart.extend("bizagi.workportal.webparts.rendermanager",{},{init:function(e,t,r){this._super(e,t,r),r&&void 0!==r.navigator||console.error("it is a render webpart and there is no navigator to this webpart"),this.navigator=r.navigator}}),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.webparts=void 0!==bizagi.webparts?bizagi.webparts:{},$.Class.extend("bizagi.workportal.homeportalFramework",{},{init:function(e){var t=this;t.workportalFacade=e,t.device=bizagi.detectDevice(),t.accumulatedContext=[],t.navigateFromRender=!1,t._homeportalShow(),t.configureHandler(),bizagi.util.mobility.homePortalNavigate=$.proxy(t.homePortalNavigate,t),bizagi.util.mobility.homePortalViewShown=$.proxy(t.homePortalViewShown,t),bizagi.util.mobility.homePortalViewInit=$.proxy(t.homePortalViewInit,t),bizagi.util.mobility.homePortalViewHide=$.proxy(t.homePortalViewHide,t),bizagi.util.mobility.drawerBeforeShow=$.proxy(t.drawerBeforeShow,t)},loadComponents:function(e,t){var r=this,a=[];return $.each(r.homePortalLayout,function(i,s){if(Array.isArray(s.position))$.each(s.position,function(o,n){if(n===e){var l=$("#"+s.canvas[o],t),c=r.workportalFacade.executeWebpart({webpart:i,canvas:l,pane:l.parent('div[data-role="pane"]')});a.push(c)}});else if("drawer"!==s.type&&s.position===e){var o=$("#"+s.canvas,t),n=r.workportalFacade.executeWebpart({webpart:i,canvas:o,pane:o.parent('div[data-role="pane"]')});a.push(n)}else if("drawer"===s.type&&s.position===e){o=$("#"+s.canvas,"body"),n=r.workportalFacade.executeWebpart({webpart:i,canvas:o});a.push(n)}}),$.when(a)},loadComponentTemplate:function(e,t,r){var a=this,i=kendo.template(a.workportalFacade.getTemplate(e),{useWithBlock:!1}),s=[];for(var o in a.homePortalLayout){var n=a.homePortalLayout[o];Array.isArray(n.position)?$.each(n.position,function(e,r){r===t&&s.push({canvas:a.homePortalLayout[o].canvas[e]})}):"drawer"!==n.type&&n.position===t&&s.push(n),"drawer"===n.type&&o===t&&$.extend(r,{canvas:n.canvas,direction:n.direction})}return i($.extend(r,{homePortalLayoutPositions:s}))},_homeportalShow:function(){var e=this;bizagi.webpart.subscribe("homeportalShow",function(t,r){r.params=r.params||{};var a="",i=!1,s=!1;switch(r.what){case"reportsChart":a="reportsChart",i=!1;break;case"stuffTemplates":a="renderTemplates",r.params.data&&r.params.data.navigateFromRender&&(e.setContextFromRender(r),e.navigateFromRender=s=r.params.data.navigateFromRender);break;case"favorites":case"pendings":case"ontime":case"overdue":case"risk":a="caseTemplates";break;case"startForm":r.transition="overlay:up",a=r.what;break;case"newCase":case"menu":case"render":i=!0;break;case"activitiesOptions":r.what="caseTemplatesOptions",i=!0;break;default:a=r.what}if(i)e.showDrawer(r.what);else{e.closeDrawers();var o=e.homePortalLayout[a].canvas,n=$("#"+o);if("none"===n.css("display")||"#renderTemplates"===n.selector){var l=n.parent().data("kendoMobilePane");r.preventNavigate||(s?e.navigateToRenderTemplates():l.navigate(o,r.transition||"")),r.title&&$.each(l.view().header,function(e,t){$(".km-navbar",t).data("kendoMobileNavBar").title(r.title)})}}bizagi.webpart.publish("homeportalShow-"+r.what,r.params)})},configureHandler:function(){var e=this;bizagi.webpart.subscribe("homeportalBack",function(t,r){e._back()}),bizagi.webpart.subscribe("homeportalShowNotification",function(e,t){$.notifier.add({text:t.message})})},showDrawer:function(e){"newCase"===e?$("#newCase-drawer").data("kendoMobileDrawer").show():"menu"===e?($("#menu-drawer").data("kendoMobileDrawer").scroller.reset(),$("#menu-drawer").data("kendoMobileDrawer").show()):"caseTemplatesOptions"===e?$("#caseTemplatesOptions").data("kendoMobileDrawer").show():$("#bz-render-drawer").length>0&&$("#bz-render-drawer").data("kendoMobileDrawer").show()},_cleanContext:function(){void 0!==this.accumulatedContext&&(this.accumulatedContext=[]),this.navigateFromRender=!1},getActionsContext:function(){var e={},t=this.accumulatedContext;return t.length>0?e.context=$.map(t,function(e){var t={entityGuid:e.entityGuid?e.entityGuid:e.guidEntityCurrent};return null!==e.surrogateKeyToMapping?t.surrogateKey="object"==typeof e.surrogateKeyToMapping?e.surrogateKeyToMapping:[e.surrogateKeyToMapping]:t.surrogateKey="",t}).filter(function(e){return""!==e.surrogateKey}):e.context=[],e},addContext:function(e){return this.accumulatedContext.push(e),{context:this.accumulatedContext}},extendCurrentContext:function(e){$.extend(this.accumulatedContext[this.accumulatedContext.length-1],e)},popContext:function(){return this.accumulatedContext.pop(),{context:this.accumulatedContext}},setContextFromRender:function(e){e=e.params||{},this.addContext($.extend(e.data,{entityType:"actionLauncher"}))},homePortalViewInit:function(e){e.view.element.trigger("view-initialized",e.view)},homePortalViewHide:function(e){e.view.element.trigger("view-hidden",e.view)},homePortalViewShown:function(e){e.view.element.trigger("view-showed",e.view)}}),bizagi="undefined"!=typeof bizagi?bizagi:{},bizagi.webparts=void 0!==bizagi.webparts?bizagi.webparts:{},bizagi.workportal.homeportalFramework.extend("bizagi.workportal.homeportalFramework",{},{init:function(e){var t=this;t._super(e),t.deviceType="smartphone",t.homePortalLayoutDashboard={menuHome:{position:"homePortal",direction:"left",type:"view",canvas:"menuHome",title:"",elastic:"false",layout:"main-default"}},t.homePortalLayoutTaskFeed={taskFeed:{position:"homePortal",direction:"left",canvas:"taskFeed",type:"view",title:"",layout:"activity-feed"}},t.homePortalLayoutComplement={loadForm:{position:"homePortal",direction:"right",type:"view",canvas:"loadForm",title:"Search Form",layout:"main-default-close-action"},renderTemplates:{position:"homePortal",direction:"right",type:"view",canvas:"renderTemplates",title:"Entities",layout:"main-double-header"},caseTemplates:{position:"homePortal",direction:"right",type:"view",canvas:"caseTemplates",title:"Cases",layout:"main-double-header-cases"},caseTemplatesOptions:{position:"homePortal",direction:"right",type:"drawer",canvas:"caseTemplatesOptions",title:""},stakeHolder:{position:"homePortal",canvas:"menuHome"},stuff:{position:"menuHome",canvas:"stuff"},shortCut:{position:"menuHome",canvas:"shortCut"},dashBoard:{position:"menuHome",canvas:"dashBoard"},searchesList:{position:"shortCut",canvas:"searchesList"}}},_back:function(e){this.container.data("kendoMobilePane").navigate("#:back",e||"")},_backRenderTemplates:function(e){var t=this;if(t.accumulatedContext.length>1){var r=t.accumulatedContext[t.accumulatedContext.length-1],a=t.popContext().context;if(r.navigateFromRender)bizagi.kendoMobileApplication.navigate("renderSplitView"),t.navigateFromRender=!1;else{var i=a[a.length-1],s={data:i,calculateFilters:i.calculateFilters||!1,filters:[],eventType:"DATA-NAVIGATION"};bizagi.webpart.publish("homeportalShow",{what:"stuffTemplates",title:s.data.displayName,params:s,preventNavigate:!0})}}else t.navigateFromRender&&(bizagi.kendoMobileApplication.navigate("renderSplitView"),t.navigateFromRender=!1);t._back(e)},configureHandler:function(){this._super()},navigateToRenderTemplates:function(e){$("#homeportal-pane").data("kendoMobilePane").navigate("renderTemplates"),bizagi.kendoMobileApplication.navigate("homePortal")},homePortalNavigate:function(e){e.url,e.sender.element},homePortalViewShown:function(e){var t=this;switch(t.destination=e.view.id.replace(/#/i,""),t.content=e.view.element,t.container=e.view.container,t.destination){case"dashBoard":$(".km-view-title",t.content).children().text("Stuff"),$(".btn-back",t.content).unbind("click").bind("click",function(){t._back("fade")}),$("#bz-workarea-newcase",t.content).unbind("click").bind("click",function(){t.showDrawer("newCase")});break;case"taskFeed":$(".bz-login-user",t.content).unbind("click").bind("click",function(){t.showDrawer("menu")}),$("#bz-workarea-newcase",t.content).unbind("click").bind("click",function(){t.showDrawer("newCase")});break;case"renderTemplates":$(".btn-back",t.content).unbind("click").bind("click",function(){t._backRenderTemplates()}),$("#bz-workarea-newdata",t.content).unbind("click").bind("click",function(){bizagi.webpart.publish("newData")});break;case"discussionCase":$(".btn-back",t.content).unbind("click").bind("click",function(){t._back()}),$("#bz-workarea-newcase",t.content).unbind("click").bind("click",function(){t.showDrawer("newCase")});break;case"caseTemplates":$(".btn-back",t.content).unbind("click").bind("click",function(){t._back()}),$("#bz-workarea-caseTemplatesOptions",t.content).unbind("click").bind("click",function(){t.showDrawer("caseTemplatesOptions")})}},drawerBeforeShow:function(e){var t=e.view.element.attr("id");"newCase-drawer"===t&&("caseTemplates"!==this.destination&&"renderTemplates"!==this.destination||e.preventDefault()),"caseTemplatesOptions"===t&&"renderTemplates"===this.destination&&e.preventDefault()},displayNotification:function(e){var t=this.container.data("kendoMobilePane");void 0===bizagi.templates.services.service.cachedTemplates["wp-notification"]?$.when(this.workportalFacade.loadTemplate("wp-notification",bizagi.getTemplate("base.workportal.smartphone.notification"))).done(function(){bizagi.util.mobility.showNotification(e,t.view().element)}):bizagi.util.mobility.showNotification(e,t.view().element)},closeDrawers:function(){$("#menu-drawer").data("kendoMobileDrawer").hide(),$("#newCase-drawer").data("kendoMobileDrawer").hide(),$("#caseTemplatesOptions").data("kendoMobileDrawer").hide()}}),$.Class("bizagi.workportal.command.search",{SEARCH_PAGE_SIZE:30,SEARCH_DELAY:700},{init:function(e){this.isTabletDevice=bizagi.util.isTabletDevice(),this.enableOfflineForm=bizagi.util.hasOfflineFormsEnabled(),this.dataService=e},searchList:function(e){(e=e||{}).inputtray=bizagi.util.inputTray(this.dataService.online);var t={radNumber:$.trim(e.query),idWorkflow:"",taskState:"all",onlyFavorites:!1,order:"",numberOfFields:2,orderFieldName:"",orderType:"0",page:e.page||1,pageSize:this.Class.SEARCH_PAGE_SIZE,inputtray:e.inputtray?e.inputtray:"inbox"};return bizagi.util.isQuickSearchEnabled()?this.loadDataListBeta(t):this.loadDataList(t)},loadDataList:function(e){return this.dataService.getCasesByWorkflow(e).done(function(e){e.elements=[];var t=[];0===e.totalPages&&t.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")});for(var r=0,a=e.rows.length;a>r;r++){var i=e.rows[r].fields,s=e.rows[r].radnumber||e.rows[r].id,o={},n=i[i.length-1],l={};if(o.radNumber=s,"string"!=typeof n.Value)for(var c=0,d=n.Value.length;c<d;c++){var u=n.Value[c];if(""!==u&&"string"==typeof u){l.solutionDate=u;break}}else l.solutionDate=n.Value;l.solutionDate=bizagi.util.getTaskStatus(l.solutionDate);for(var p=0;p<i.length;p++)if("Process"===i[p].DisplayName){l.processName=i[p].Value;break}if(l.processName||(l.processName=i[0].Value),void 0!==e.rows[r].workitems)for(var g=e.rows[r].workitems,f=0;g.length>f;f++){o[0]=e.rows[r].id,o[1]=g[f].idWorkItem,o[2]=g[f].idTask,o.state=g[f].State.toLowerCase()||"gray",o[5]=g[f].TaskName||bizagi.localization.getResource("webpart-cases-summary-without-name"),o[6]=[],o[6][0]=[],o[6][0]=[0,e.rows[r].id],o[4]=l.processName,o[3]=l.solutionDate,e.rows[r].isOfflineForm&&(o[7]=e.rows[r].isOfflineForm,o[8]=e.rows[r].isOpen);var m=$.extend(!0,{},o);t.push(m)}else{if(o[0]=e.rows[r].id,o[1]=o[2]=0,o[5]=bizagi.localization.getResource("webpart-cases-summary-without-name"),o.state="gray",o[6]=[],o[6][0]=[],o[6][0]=[0,e.rows[r].id],o[4]=l.processName,o[3]=l.solutionDate,e.rows[r].isOfflineForm){var h=bizagi.getGroupedData(i[3]);o[7]=e.rows[r].isOfflineForm,o[8]=e.rows[r].isOpen,o.state=h.status}t.push(o)}}return e.elements=t,e.elements}).fail(function(e){var t={elements:[],page:1,totalPages:1};return t.elements.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")}),t.elements})},loadDataListBeta:function(e){return this.dataService.getCasesListBeta(e).done(function(e){return 0===e.elements.length&&e.elements.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")}),e.elements}).fail(function(e){var t={elements:[],page:1,totalPages:1};return t.elements.push({noResults:!0,message:bizagi.localization.getResource("workportal-menu-search-found-no-cases")}),t.elements})},getCaseData:function(e){var t=e.dataItem,r={};return t&&void 0===t.noResults&&(-1!==t[1]&&-1!==t[2]?(r.idCase=t[0],r.idWorkitem=bizagi.util.isNumeric(t[1])?t[1]:0,r.idTask=bizagi.util.isNumeric(t[2])?t[2]:0,r.displayName=t[5]||t[6],r.radNumber=t.radNumber,r.isOfflineForm=!0===t[7]||!1,r.formsRenderVersion=!0===t[7]?2:0):(r.idCase=t[0],r.displayName=t[4]||t[0])),r}}),$.Class.extend("bizagi.actionsEvents",{},{init:function(e,t,r){this.initialParams=r||{},this.parent=t||"Entities",this.dataService=e},getEvents:function(e){var t=this,r=$.map(e,function(e){var r=e.idCase;if(void 0!==r&&r>0)return t.dataService.getEvents({caseId:r}).then(function(t){e.events=t.map(function(e){return e.isEvent=!0,e})})});return $.when.apply($,r)},getActions:function(e){var t=this,r=$.map(e,function(e){if("Entities"===t.parent||"Cases"===t.parent&&e.surrogateKey>=0){var r={surrogateKey:e.surrogateKey,guidEntity:e.guid};return void 0!==e.idCase&&(r.caseId=e.idCase),t.dataService.getActionsData(r).then(function(r){return e.actions=r,$.when.apply($,$.map(r,function(e){if("Process"==e.type)return t.dataService.validateHasStartForm({processId:e.reference}).then(function(t){e.hasStartForm=t.startForm,e.entityId=t.entityId,e.entityName=t.entityName})}))})}});return $.when.apply($,r)},getCommomActions:function(e){for(var t,r=e||[],a=[],i=-1;t=r[++i];)a[i]=t.actions||[];return a.shift().reduce(function(e,t){return a.every(function(e){return void 0!==e.find(function(e){return e.id==t.id})})&&void 0===e.find(function(e){return e.id==t.id})&&function(e){if(void 0===e.mode||"Entity"===e.mode)return 2==e.multiplicity||"Form"!=e.type&&("Process"!=e.type||!e.hasStartForm);return!1}(t)&&e.push(t),e},[])},executeActionSingleData:function(e,t){var r=this;if("WorkOnIt"===e.type){bizagi.loading.start();var a=void 0!==e.idCase?e.idCase:t.idCase;r.executeChangeCaseEvent(a,e.idTask,e.idWorkitem,t)}else if(void 0!==e.isEvent&&e.isEvent)r.processEvent(e);else{var i=e.type,s=2===e.multiplicity;if("Rule"===i){var o={actionType:i,entityId:t.guid,isMultiInstance:s,processId:e.reference,surrogateKey:t.surrogateKey,displayName:e.displayName};r.processAction(o).then(function(e){var t=printf(bizagi.localization.getResource("workportal-widget-templateengine-action-rule-notification-singular"),o.displayName,1);if("success"===e.result){var a=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-success");t=t+" "+printf(a,""),$.notifier.add({title:o.displayName,text:t,sticky:!0})}else{t=t+" "+(a=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-error")),$.notifier.add({title:o.displayName,text:t,sticky:!0,class_name:"error"})}r.refreshTemplate()})}else if("Form"===i||"Process"===i){o={actionType:i,displayName:e.displayName,entityGuid:t.guid,entitySurrogateKey:t.surrogateKey,id:e.id,isMultiInstance:s,isBatch:e.isBatch||null,reference:e.reference,readonlyform:e.readonlyform,showConfirmation:e.showConfirmation};"Process"===i&&(o.entityId=e.entityId,o.entityName=e.entityName,o.hasStartForm=e.hasStartForm),void 0!==t.idCase&&(o.caseId=t.idCase),r.processAction(o)}}},executeChangeCaseEvent:function(e,t,r,a){var i=this;$.when(bizagi.webpart.publish("changeCase",{idCase:e,idTask:t,idWorkitem:r})).fail(function(e){i.showErrorMessage(a.idCase,e)}).always(function(){bizagi.loading.stop()})},executeActionMultipleData:function(e,t,r){var a=this,i=2===e.multiplicity,s=r.map(function(e){return e.surrogateKey});switch(e.type){case"Process":var o={actionType:e.type,displayName:e.displayName,entityGuid:t.guid,entityId:e.entityId,entityName:e.entityName,id:e.id,isMultiInstance:i,reference:e.reference,hasStartForm:e.hasStartForm};"Cases"===a.parent&&(o.caseId=r.map(function(e){return e.idCase})),i?(o.isBatch=!1,o.entitySurrogateKey=s,a.processAction(o)):(o.isBatch=!0,a.processBatchCreationAction(o,r));break;case"Rule":o={actionType:e.type,entityId:t.guid,isMultiInstance:i,processId:e.reference,displayName:e.displayName};if(i)o.surrogatedKey=s,a.processAction(o).then(function(e){var t=printf(bizagi.localization.getResource("workportal-widget-templateengine-action-rule-notification-singular"),o.displayName,1),r="";"success"===e.result?(r=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-success"),r=printf(r,1)):r=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-error"),$.notifier.add({title:r,text:t,sticky:!0}),a.refreshTemplate()});else{o.confirmation=!1;for(var n,l=-1,c=[];n=r[++l];)o.surrogateKey=n.surrogateKey,c.push(a.processAction(o));$.when.apply($,c).then(function(){var e=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-notification-plural"),t=printf(e,o.displayName,r.length),i=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-success");t+=printf(i,""),$.notifier.add({title:o.displayName,text:t,sticky:!0}),a.refreshTemplate()}).fail(function(){var e=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-notification-plural"),t=printf(e,o.displayName,r.length),a=bizagi.localization.getResource("workportal-widget-templateengine-action-rule-error");t+=printf(a,""),$.notifier.add({title:o.displayName,text:t,sticky:!0,class_name:"error"})})}}},processBatchCreationAction:function(e,t){var r,a=this,i=-1;void 0!==(r=t[++i])&&(e.itemSelected=r,function s(){$.when(a.processAction(e)).always(function(){void 0!==(r=t[++i])&&(e.itemSelected=r,s())})}())},processAddAction:function(e){var t=this,r={actionType:e.type,addAction:!0,displayName:e.displayName,entityGuid:e.guidEntity,entitySurrogateKey:null,reference:e.reference};if("Process"===e.type)r.entityId=e.guidEntity,r.entityName=e.xpathContext,r.hasStartForm=e.startForm,t.processAction(r);else if("Form"===e.type){var a={xpathContext:"",guidEntity:e.guidEntity,accumulatedContext:JSON.stringify(t.initialParams.homePortalFramework.getActionsContext())};$.when(t.dataService.getMapping(a)).then(function(e){r.mapping=e,t.processAction(r)}).fail(function(r){t.showErrorMessage(e.displayName,r)})}},processAction:function(e){var t=this,r="Entities"===t.parent?"stuffTemplates":"caseTemplates";e.confirmation=void 0===e.confirmation||e.confirmation;var a=new $.Deferred;switch(e.actionType){case"Process":var i={xpathContext:e.entityName,guidEntity:e.entityId},s=void 0!==e.itemSelected?e.itemSelected.surrogateKey:e.entitySurrogateKey;t.initialParams.homePortalFramework.extendCurrentContext({surrogateKeyToMapping:s});var o=t.initialParams.homePortalFramework.getActionsContext();i.accumulatedContext=JSON.stringify(o),$.when(t.dataService.getMapping(i)).done(function(t){var i={guidProcess:e.reference,hasStartForm:e.hasStartForm,isBatch:void 0!==e.isBatch?e.isBatch:null,isMultiInstance:e.isMultiInstance,mapping:t,notification:!0,displayName:e.displayName,type:e.actionType,origin:r};void 0!==e.caseId&&(i.idParentCase=e.caseId),$.when(bizagi.webpart.publish("createNewCase",i)).then(function(){a.resolve(i)}).fail(function(){a.reject()})}).fail(function(r){t.showErrorMessage(e.displayName,r),a.reject()});break;case"Form":bizagi.webpart.publish("render-start-form",{params:{displayName:e.displayName,entityGuid:e.entityGuid,entitySurrogateKey:e.entitySurrogateKey,formGuid:e.reference,mapping:void 0!==e.mapping?e.mapping:null,type:e.actionType,origin:r,readonlyform:e.readonlyform,showConfirmation:e.showConfirmation}}),a.resolve();break;case"Rule":e.confirmation?bizagi.showConfirmationBox(bizagi.localization.getResource("workportal-widget-templateengine-action-rule-confirmation"),"Bizagi",!0,[{label:"Ok",action:"resolve"},{label:"Cancel",action:"reject"}]).done(function(){t.executeRuleAction(e).then(function(e){a.resolve(e)}).fail(function(e){a.reject(e)})}):t.executeRuleAction(e).then(function(e){a.resolve(e)}).fail(function(e){a.reject(e)});break;default:a.resolve()}return a.promise()},showErrorMessage:function(e,t){var r=bizagi.localization.getResource("workportal-widget-sortbar-execute-error-message").replace("%s",e);$.notifier.add({title:"Error",text:r,class_name:"error",sticky:!1})},executeRuleAction:function(e){var t=e.isMultiInstance?this.dataService.executeAction:this.dataService.actionRule;return $.when(t.apply(this.dataService,[e]))},refreshTemplate:function(){var e=this.initialParams.homePortalFramework.accumulatedContext,t={calculateFilters:!0,data:e.length>0?e[e.length-1]:this.accumulatedContext,filters:[],eventType:"DATA-NAVIGATION"};bizagi.webpart.publish("homeportalShow",{what:"stuffTemplates",title:t&&t.data?t.data.displayName:"",params:t,preventNavigate:!0})},processEvent:function(e){bizagi.webpart.publish("executeRoutingAction",{idCase:e.idCase,idWorkItem:e.idWorkitem,idTask:e.idTask,idWorkflow:e.idWorkflow,isEvent:!0})}}),$.Class.extend("bizagi.caseUsers",{},{init:function(e,t,r){this.initialParams=r||{},this.parent=t||"Entities",this.dataService=e,this.userDataPromise={}},getUsers:function(e){var t=this,r=[],a=$.map(e,function(e){return t.dataService.getUsers({caseId:e.idCase}).done(function(a){e.assignees=$.map(a.assignees,function(e){return $.extend(e,{initials:t._getInitials(e.name)})}),e.createdBy=$.extend(a.createdBy,{initials:t._getInitials(a.createdBy.name)}),e.users=t._getUniqueUsers($.merge([e.createdBy],e.assignees)),e.workOnIt=t._canWorkOnIt(a.assignees);for(var i,s=-1;i=e.users[++s];){r.find(function(e){return i.idUser==e.idUser})||r.push(i)}})});return $.when.apply($,a).then(function(e){return r})},_getInitials:function(e){var t=e.split(" ");return(void 0!==t[0]?t[0].charAt(0):"")+(void 0!==t[1]?t[1].charAt(0):"")},_getUniqueUsers:function(e){for(var t,r=-1,a=[];t=e[++r];){a.find(function(e){return t.idUser==e.idUser})||a.push({idUser:t.idUser,name:t.name,initials:t.initials})}return a.length>0&&(a[0].isAssignee=!0),a},_canWorkOnIt:function(e){for(var t,r=-1,a=!1;t=e[++r];)if(t.idUser===bizagi.currentUser.idUser){a=!0;break}return a}}),bizagi.render=void 0!==bizagi.render?bizagi.render:{},bizagi.render.services=void 0!==bizagi.render.services?bizagi.render.services:{},bizagi.render.services.endPoints=[],bizagi.render.services.getEndPoints=function(e){var t="Rest/Handlers/Render",r="Rest/Handlers/Render/Upload",a="Rest/Handlers/RenderFile",i="Rest/Handlers/Letter",s="Rest/Handlers/MultiAction",o="Rest/Handlers/Metadata";return"workflow"==e.context?{"form-get-data":e.proxyPrefix+t,"form-submit-data":e.proxyPrefix+t,"form-submit-data-upload":e.proxyPrefix+r,"render-property-refresh":e.proxyPrefix+t,"render-multiaction":e.proxyPrefix+s,"render-upload-cancel-image":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+a,"render-upload-add-url":e.proxyPrefix+r,"render-upload-delete-url":e.proxyPrefix+t,"render-ecm-upload-url":e.proxyPrefix+o,"render-multiaction-metadata":e.proxyPrefix+"Rest/Handlers/MetadataMultiAction","render-grid-edit-url":e.proxyPrefix+t,"render-grid-save-url":e.proxyPrefix+t,"render-grid-add-url":e.proxyPrefix+t,"render-grid-rollback-url":e.proxyPrefix+t,"render-grid-commit-url":e.proxyPrefix+t,"render-grid-checkpoint-url":e.proxyPrefix+t,"render-save-entity":e.proxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":e.proxyPrefix+"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.proxyPrefix+i,"render-letter-content-url":e.proxyPrefix+i,"render-letter-save-url":e.proxyPrefix+t,"render-letter-content-icons":e.proxyPrefix+"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.proxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.proxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.proxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}&xsrf="+bizagi.getXSRFToken(),"render-entity-layout-upload-files":e.proxyPrefix+"Api/Entities/{entity}/Files/{surrogateKey}/Array?xpath={xpath}","case-handler-getCaseSummary":e.proxyPrefix+"Rest/Cases/{idCase}/SummaryGuid","case-handler-getCaseSummaryByGuid":e.proxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getCaseAssignees":e.proxyPrefix+"Rest/Cases/{idCase}/AssigneesGuid","case-handler-getWorkItems":e.proxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid","admin-getUsersList":e.proxyPrefix+"Rest/Users/SearchUsers","admin-getUsersList-FromPreferences":e.proxyPrefix+"Rest/Users/SearchUsersFromPreferences","admin-getUsersList-ForStakeholders":e.proxyPrefix+"Rest/Users/SearchUsersForStakeholders","admin-getUsersForAssignation":e.proxyPrefix+"Rest/Users/UsersForAssignation","admin-users-config":e.proxyPrefix+"Api/Authentication/BizagiConfig","admin-usersform":e.proxyPrefix+"Rest/Handlers/Render","admin-GenerateDataToSendByEmail":e.proxyPrefix+"Rest/Users/GenerateDataToSendByEmail","admin-sendUserEmail":e.proxyPrefix+"Rest/Users/SendUserEmail"}:"sharepoint"==e.context||"portal"==e.context?(void 0===e.sharepointProxyPrefix&&alert("sharepointProxyPrefix param is requiered to build endpoints when context is 'sharepoint'"),{"form-get-data":e.sharepointProxyPrefix+t,"form-submit-data":e.sharepointProxyPrefix+t,"form-submit-data-upload":e.sharepointProxyPrefix+r,"render-property-refresh":e.sharepointProxyPrefix+t,"render-multiaction":e.sharepointProxyPrefix+s,"render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.sharepointProxyPrefix+a,"render-upload-add-url":e.sharepointProxyPrefix+r,"render-upload-delete-url":e.sharepointProxyPrefix+t,"render-ecm-upload-url":e.sharepointProxyPrefix+o,"render-grid-edit-url":e.sharepointProxyPrefix+t,"render-grid-save-url":e.sharepointProxyPrefix+t,"render-grid-add-url":e.sharepointProxyPrefix+t,"render-grid-rollback-url":e.sharepointProxyPrefix+t,"render-grid-commit-url":e.sharepointProxyPrefix+t,"render-grid-checkpoint-url":e.sharepointProxyPrefix+t,"render-save-entity":e.sharepointProxyPrefix+t,"render-stakeholder-associated":e.proxyPrefix+t,"render-search-default-image":"jquery/css/bizagi/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.sharepointProxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.sharepointProxyPrefix+"Rest/Handlers/Query","render-letter-notEditable-url":e.sharepointProxyPrefix+i,"render-letter-content-url":e.sharepointProxyPrefix+i,"render-letter-save-url":e.sharepointProxyPrefix+t,"render-letter-content-icons":"jquery/css/plugins/other/images/nicEditorIcons.gif","render-userfield-definition":e.sharepointProxyPrefix+"Rest/Userfields/{guidUserfield}/UserfieldDependency/{device}","render-document-generate":e.sharepointProxyPrefix+"Rest/DocumentTemplates/CaseTemplates","render-document-generateAllDocuments":e.sharepointProxyPrefix+"Rest/DocumentTemplates/TemplatesConcatFilesToPDF","render-processes-startform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-processes-getstartform":e.proxyPrefix+"Rest/Processes/HasStartForm","render-entity-layout-image64":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Base64","render-entity-layout-imageByteArray":e.proxyPrefix+"Api/Entities/{entity}/Picture/{surrogateKey}/Array?xpath={xpath}&width={width}&height={height}&idcase={idcase}&idworkitem={idworkitem}&contextxpath={contextxpath}&h_={hash}&xsrf="+bizagi.getXSRFToken(),"case-handler-getCaseSummary":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/Summary","case-handler-getCaseSummaryByGuid":e.sharepointProxyPrefix+"Rest/Cases/{guid}/SummaryByGuid","case-handler-getWorkItems":e.sharepointProxyPrefix+"Rest/Cases/{idCase}/WorkItems","case-handler-getWorkItemsByGuid":e.proxyPrefix+"Rest/Cases/{guid}/WorkItemsByGuid"}):"entitymanagement"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data":e.proxyPrefix+t+"?h_contexttype=entity","form-submit-data-upload":e.proxyPrefix+r+"?h_contexttype=entity","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=entity","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+a+"?h_contexttype=entity","render-upload-add-url":e.proxyPrefix+r+"?h_contexttype=entity","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=entity","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=entity","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=entity","render-letter-notEditable-url":e.proxyPrefix+i+"?h_contexttype=entity","render-letter-content-url":e.proxyPrefix+i+"?h_contexttype=entity","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=entity","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:"search"==e.context?{"form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data":e.proxyPrefix+t+"?h_contexttype=metadata","form-submit-data-upload":e.proxyPrefix+r+"?h_contexttype=metadata","render-property-refresh":e.proxyPrefix+t+"?h_contexttype=metadata","render-upload-cancel-image":"jquery/rendering/css/desktop/plugins/other/images/upload-cancel.png","render-upload-data-url":e.proxyPrefix+a+"?h_contexttype=metadata","render-upload-add-url":e.proxyPrefix+r+"?h_contexttype=metadata","render-upload-delete-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-edit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-add-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-rollback-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-commit-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-grid-checkpoint-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-default-image":"jquery/rendering/css/desktop/images/bizagi_xpress.png","render-search-form-get-data":e.proxyPrefix+t+"?h_contexttype=metadata","render-search-advanced-url":e.proxyPrefix+"Rest/Handlers/Query?h_contexttype=metadata","render-letter-notEditable-url":e.proxyPrefix+i+"?h_contexttype=metadata","render-letter-content-url":e.proxyPrefix+i+"?h_contexttype=metadata","render-letter-save-url":e.proxyPrefix+t+"?h_contexttype=metadata","render-letter-content-icons":"jquery/rendering/css/desktop/plugins/other/images/nicEditorIcons.gif"}:{}},$.Class.extend("bizagi.render.services.context",{},{init:function(e){this.context=e.context,this.endPoints=bizagi.render.services.getEndPoints(e),this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix},getUrl:function(e){return null==this.endPoints[e]&&alert("No endpoint defined for: "+e),this.endPoints[e]},setProxyPrefix:function(e){this.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.endPoints=bizagi.render.services.getEndPoints(e)}}),$.Class.extend("bizagi.render.services.service",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(e){(e=e||{}).context=e.context||"workflow",e.proxyPrefix=bizagi.util.isEmpty(e.proxyPrefix)?"":e.proxyPrefix,this.serviceLocator=new bizagi.render.services.context(e),this.multiactionService=new bizagi.render.services.multiactionservice(this),this.guid=Math.guid(),bizagi.override.enableECMMetadataMultiaction&&(this.multiactionMetadataService=new bizagi.render.services.metadatamultiactionservice(this)),this.userfieldRequests={},this.deviceType=e.deviceType||(bizagi.util.isSmartphoneDevice()?bizagi.deviceEnum.smartphone:bizagi.util.isTabletDevice()?bizagi.deviceEnum.tablet:bizagi.deviceEnum.desktop),this.deviceCode=bizagi.util.getDeviceCode()},multiaction:function(){return this.multiactionService},metadataECMMultiaction:function(){return bizagi.override.enableECMMetadataMultiaction?this.multiactionMetadataService:this},getFormData:function(e){var t=this;if(e&&e.data)return e.data;e=e||{};var r={};if(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action||"LOADFORM",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=t.deviceType,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=t.deviceCode,e.idProcess&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idProcess"]=e.idProcess),e.idForm&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.idEntity&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idEntity"]=e.idEntity),e.surrogateKey&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey),e.idRender&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.requestedForm&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"requestedForm"]=e.requestedForm),e.recordXPath&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordXPath"]=e.recordXPath),e.summaryForm&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"summaryForm"]=e.summaryForm),e.idCase&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idWorkitem&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.idTask&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idTask"]=e.idTask),e.idPageCache&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache),e.contextType&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contextType),e.guidEntity&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),bizagi.util.isEmpty(e.isRefresh)||(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"isRefresh"]=e.isRefresh),e.isActionStartForm&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=e.isActionStartForm),e.additionalXpaths&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.idStartScope&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),void 0!==e.readOnlyForm&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"readonlyform"]=e.readOnlyForm),void 0!==e.printversion&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"printForm"]=e.printversion),void 0!==e.recordXpath&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.guid&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guid"]=e.guid),e.downloadOfflineForm&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"downloadofflineform"]=1),!1===e.editable&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"DisplayFormAsReadOnly"]=!0),e.printversion){var a="all_";e[t.Class.BA_ACTION_PARAMETER_PREFIX+a+"rows"]&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+a+"rows"]=e[t.Class.BA_ACTION_PARAMETER_PREFIX+a+"rows"])}return e.prepare?r:(bizagi.chrono.initAndStart("data"),$.ajax({url:e.url||t.serviceLocator.getUrl("form-get-data"),data:r,type:"POST",dataType:"json",serviceType:e.action||"LOAD"}).pipe(function(t){if(bizagi.chrono.stopAndLog("data"),e.printversion)try{t.form.properties.editable="False";var a=function(e){return null==e?e:(e.hasOwnProperty("type")&&"grid"==e.type?(e.id=r.id+"-print",e.allowAdd="False",e.allowDelete="False",e.allowEdit="False",e.allowGrouping="False",e.allowMore="False",e.allowSearch="False"):$.each(r,function(t,r){"object"==typeof r&&(e[t]=a(e[t]))}),e)};t=a(t)}catch(e){}return t}))},getSearchFormData:function(e){var t=this;e=e||{};var r={};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHFORM",e.xpath&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idSearchForm&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm),e.idPageCache&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-search-form-get-data"),data:r,type:"POST",dataType:"json",serviceType:"SEARCHFORM"})},processDataValues:function(e){var t;for(t in e=$.extend(!0,{},e))e.hasOwnProperty(t)&&"object"==$.type(e[t])&&e[t].hasOwnProperty("id")&&(e[t]=e[t].id);return e},submitData:function(e){var t=this;data=t.resolveData(e.data||{},e.xpathContext),data=t.processDataValues(data),data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action,(e=e||{}).xpath&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath),e.idRender&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender),e.xpathContext&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.idPageCache&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache),e.guidEntity&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidEntity),e.contexttype&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.transitions&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"transitions"]=e.transitions),e.surrogatekey&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.forcePlanCompletion&&(data[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"forcePlanCompletion"]=e.forcePlanCompletion);var r=e.action.toString().toUpperCase();return bizagi.debug("Data sent",data),e.prepare?data:$.ajax({url:e.url||t.serviceLocator.getUrl("form-submit-data"),data:data,type:"POST",dataType:"json",serviceType:r})},resolveData:function(e,t){var r,a,i;if(!$.isEmptyObject(e)&&t&&-1!==t.search(/\[id=\d+\]/))for(r in e)-1!==r.search(/\[id=\d+\]/)&&t==r.substr(0,r.search(/\]/)+1)&&(a=r.substr(r.search(/\]/)+2),i=e[r],e[a]=i,delete e[r]);return e},getPropertyData:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,e.sessionId&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.guidentity&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),e.surrogatekey&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey),e.pxpath&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"xpath"]=e.pxpath),e.prows&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.prows),e.ppage&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.ppage),null!=e.pfilter&&null!=e.pfilter&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"filter"]=e.pfilter),null!=e.psort&&null!=e.psort&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.psort),e.porder&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.porder),e.pcaseId&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"caseId"]=e.pcaseId),e.pguidEntity&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"guidEntity"]=e.pguidEntity),e.psurrogatedKey&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.psurrogatedKey),e.pactionXpath&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"actionXpath"]=e.pactionXpath),e.ptemplateGuid&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"templateGuid"]=e.ptemplateGuid),e.pparameters&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"parameters"]=e.pparameters),bizagi.debug("Property refresh for '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-property-refresh"),data:r,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},getData:function(e){return this.getPropertyData($.extend(e,{property:"data"}))},getSearchData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"term"]=e.term,this.getPropertyData($.extend(e,{property:"data"}))},getCollapseData:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"collapseState"]=e.collapseState,this.getPropertyData($.extend(e,{property:"collapseState"}))},getGridData:function(e){var t=this;return e.extra=e.extra||{},e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"order"]=e.order,e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,e.extra[t.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,this.getPropertyData($.extend(e,{property:"data"}))},getGridDataExclusivesSelected:function(e){return e.extra=e.extra||{},e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"rows"]=e.rows,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"value"]=e.value,e.extra[this.Class.BA_ACTION_PARAMETER_PREFIX+"xpathfilter"]=e.xpathfilter,this.getPropertyData($.extend(e,{property:"exclusivesSelected"}))},getUploadCancelImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-upload-cancel-image")},getUploadFileUrl:function(e){var t=this,r=this.serviceLocator.getUrl("render-upload-data-url"),a={};return a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,a[t.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,a[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,e.contexttype&&(a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(a)+"&xsrf="+bizagi.getXSRFToken()},getUploadFileEntityUrl:function(e){var t=this,r=this.serviceLocator.getUrl("render-upload-data-url"),a={};return a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUETEMPLATE",a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="fileContent",a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,a[t.Class.BA_ACTION_PARAMETER_PREFIX+"fileId"]=e.fileId,e.isContextContainerWidgetRender?(a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,a[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,a[t.Class.BA_ACTION_PARAMETER_PREFIX+"xpathactions"]=e.xpathActions):(a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogatekey,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity),t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(a)+"&xsrf="+bizagi.getXSRFToken()},getUploadAddUrl:function(){var e=this.serviceLocator.getUrl("render-upload-add-url"),t={};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDFILE",this.verifyPathToBase(bizagi.services.ajax.pathToBase,e)+"?"+jQuery.param(t)},getUploadAddFileUrl:function(e){var t=this.serviceLocator.getUrl("form-submit-data-upload"),r={};return r[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=!0===e?"SAVEUSERIMAGE":"savefile",this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)},deleteImage:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="DELETEUSERIMAGE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing image '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-upload-delete-url"),data:r,type:"POST",dataType:"json"})},deleteUploadFile:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Removing file in upload '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-upload-delete-url"),data:r,type:"POST",dataType:"json"})},getECMMetadata:function(e){var t=this,r=e.extra||{};return r.action="getECMMetadata",r.idFileUpload=e.idFileUpload,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r.xpathContext=e.xpathContext,r.xPath=e.xPath,r.idAttrib=e.idAttrib,e.sessionId&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),bizagi.debug("Get file metadata '"+e.xPath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-ecm-upload-url"),data:r,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+t.guid}})},checkOutFile:function(e){var t=e.extra||{};return t.action="checkOutFile",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},cancelCheckOut:function(e){var t=e.extra||{};return t.action="cancelCheckOut",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("file checkout '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},deleteECMFile:function(e){var t=e.extra||{};return t.action="delete",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("delete file'"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMFileContent:function(e){var t=e.extra||{};return t.action="updateECMFileContent",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file content '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},updateECMMetadata:function(e){var t=e.extra||{};return t.action="updateECMMetadata",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Update file meta data '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getFileProperties:function(e){var t=e.extra||{};return t.action="getFileProperties",t.idFileUpload=e.idFileUpload,t.xPath=e.xPath,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Get file properties '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json",interceptor:{intercept:!0,source:"rendering_"+this.guid}})},uploadECMFile:function(e){var t=e.extra||{};return t.action="uploadECMFile",t.fileUpload=e.fileUpload,t.xPath=e.xPath,t.idAttrib=e.idAttrib,t.fileName=e.fileName,t.metaValues=e.metaValues,t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t.xpathContext=e.xpathContext,bizagi.debug("Upload ECM file '"+e.xPath+"'",t),e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("render-ecm-upload-url"),data:t,type:"POST",dataType:"json"})},getECMFileUrl:function(e){var t=this,r=e.url||t.serviceLocator.getUrl("render-ecm-upload-url")+"File",a=e.extra||{};return a.action="viewECMFile",a.idFileUpload=e.idFileUpload,a.xPath=e.xPath,a.idAttrib=e.idAttrib,a.fileName=e.fileName,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,a.xpathContext=e.xpathContext,e.sessionId&&(a[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId),e.p_sessionId&&(a.p_sessionId=e.p_sessionId),bizagi.debug("View uploaded file '"+e.xPath+"'",a),t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(a)+"&xsrf="+bizagi.getXSRFToken()},isFileOnECM:function(e){var t={action:"isFileOnECM"};return t.idUpload=e.idUpload,$.read(this.serviceLocator.getUrl("render-ecm-upload-url"),t)},editGridRecord:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EDITRELATION",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending edit request for relation '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-edit-url"),data:r,type:"POST",dataType:"json",serviceType:"EDITRELATION"})},addGridRecord:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATION",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Sending add request for grid '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-add-url"),data:r,type:"POST",dataType:"json",serviceType:"ADDRELATION"})},addGridRecordData:function(e){var t=this,r=e.extra||{};r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ADDRELATIONWITHDATA",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype);var a=e.submitData||{};for(key in a)r[key]=a[key];return bizagi.debug("Sending add request for grid '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-add-url"),data:r,type:"POST",dataType:"json",serviceType:"ADDRELATIONWITHDATA"})},saveGridRecord:function(e){var t=this,r=e.extra||{};r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVERELATION",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"disableServerGridValidations"]=e.disableServerGridValidations||!1,e.submitData.idPageCache&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var a=e.submitData||{};for(key in a=t.processDataValues(a))r[key]=a[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-save-url"),data:r,type:"POST",dataType:"json",serviceType:"SAVERELATION"})},deleteGridRecord:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REMOVERELATION",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending delete request for grid '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-save-url"),data:r,type:"POST",dataType:"json",serviceType:"REMOVERELATION"})},getFlipAssociation:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.id,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="flipped",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"flipstate"]=e.flipstate,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending request for flip association control '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-property-refresh"),data:r,type:"POST",dataType:"text"}).pipe(function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}})},rollbackGridAction:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="ROLLBACK",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-rollback-url"),data:r,type:"POST",dataType:"json",serviceType:"ROLLBACK"})},getSearchDefaultImage:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-search-default-image")},processDataCriteria:function(e){var t;for(t in e=$.extend(!0,[],e))e.hasOwnProperty(t)&&e[t].hasOwnProperty("value")&&"object"==$.type(e[t].value)&&e[t].value.hasOwnProperty("id")&&e[t].value.hasOwnProperty("label")&&(e[t].value=e[t].value.id);return e},submitSearch:function(e){var t,r=this,a=e.extra||{},i=e.sort&&""!==e.sort?e.sort:"";return e.order&&""!==e.order&&""!==i&&(i+=" "+e.order),a[r.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SEARCHENTITYFORRENDER",a[r.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,a[r.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,a[r.Class.BA_CONTEXT_PARAMETER_PREFIX+r.Class.BA_PAGE_CACHE]=e.idPageCache,a[r.Class.BA_ACTION_PARAMETER_PREFIX+"searchForm"]=e.idSearchForm,a[r.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=i,a[r.Class.BA_ACTION_PARAMETER_PREFIX+"page"]=e.page,a[r.Class.BA_ACTION_PARAMETER_PREFIX+"pageSize"]=e.rows,a[r.Class.BA_ACTION_PARAMETER_PREFIX+"searchFilter"]=e.searchFilter,t=r.processDataCriteria(e.criteria),a[r.Class.BA_ACTION_PARAMETER_PREFIX+"searchCriteria"]=JSON.encode(t),e.allowFullSearch&&(a[r.Class.BA_ACTION_PARAMETER_PREFIX+"allowFullSearch"]=e.allowFullSearch),e.maxRecords&&(a[r.Class.BA_ACTION_PARAMETER_PREFIX+"maxRowsAllowed"]=e.maxRecords),bizagi.debug("Performing advanced search",a),e.prepare?a:$.ajax({url:e.url||r.serviceLocator.getUrl("render-search-advanced-url"),data:a,type:"POST",dataType:"json",serviceType:"SEARCHENTITYFORRENDER"})},associateStakeholder:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"surrogateKey"]=e.surrogateKey,r.associatedUser=e.associatedUser,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guidentity,bizagi.debug("Property refresh for '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-stakeholder-associated"),data:r,type:"POST",dataType:e.dataType||"json"})},refreshAssociateStakeholder:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,bizagi.debug("Property refresh for '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-stakeholder-associated"),data:r,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getLetterNotEditableUrl:function(e){var t=this,r=e.extra||{};r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache;var a=e.url||t.serviceLocator.getUrl("render-letter-notEditable-url");return t.verifyPathToBase(bizagi.services.ajax.pathToBase,a)+"?"+jQuery.param(r)},getLetterContent:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="GETLETTER",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-letter-content-url"),data:r,type:"POST",dataType:"html"}).pipe(function(e){try{return bizagi.services.ajax.parseJSON(e)}catch(t){return e}})},getCanGenerateLetter:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CANGENERATELETTER",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?r:$.ajax({url:t.serviceLocator.getUrl("render-letter-content-url"),data:r,type:"POST",dataType:"json"})},saveLetterContent:function(e){var t=this,r=e.extra||{};r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="UPDATELETTER",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache;var a=e.content||"",i=(e.url||t.serviceLocator.getUrl("render-letter-save-url"))+"?"+jQuery.param(r);return bizagi.debug("Save request for letter sent to: "+i,a),e.prepare?r:$.ajax({url:i,data:a,type:"POST",dataType:"html"})},getLetterEditorIconsPath:function(){return bizagi.services.ajax.pathToBase+this.serviceLocator.getUrl("render-letter-content-icons")},executeButton:function(e){return this.getPropertyData($.extend(e,{property:"buttonRule"}))},getFilePrintUrl:function(e){var t=this,r=this.serviceLocator.getUrl("render-upload-data-url"),a={};return a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]="data",a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,a[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(a)},editLinkForm:function(e){return this.editGridRecord(e)},saveLinkForm:function(e){var t=this,r=e.extra||{};r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="SAVEFORMLINKRELATION",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.submitData.idPageCache&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.submitData.idPageCache,delete e.submitData.idPageCache);var a=e.submitData||{};for(key in a=t.processDataValues(a))r[key]=a[key];return bizagi.debug("Sending save request for grid '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-save-url"),data:r,type:"POST",dataType:"json",serviceType:"SAVEFORMLINKRELATION"})},rollbackLinkForm:function(e){return this.rollbackGridAction(e)},commitLinkForm:function(e){return this.commitGridAction(e)},sendCheckpoint:function(e){return this.sendCheckpointAction(e)},getUserfieldDefinition:function(e){var t=this;return e=e||{},t.userfieldRequests[e.userfield]?t.userfieldRequests[e.userfield]:(t.userfieldRequests[e.userfield]=$.read(t.serviceLocator.getUrl("render-userfield-definition"),{guidUserfield:e.userfield,device:e.device||"desktop"}),t.userfieldRequests[e.userfield])},refreshControl:function(e){var t=this;e=e||{};var r={};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESH",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,e.xpathContext&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.idForm&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("form-get-data"),data:r,type:"POST",dataType:"json",serviceType:"PARTIALREFRESH"})},refreshGridCell:function(e){var t=this;e=e||{};var r={};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="REFRESHGRIDCELL",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidcolumn"]=e.column,e.xpathContext&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.idForm&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idForm"]=e.idForm),e.typeRender&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"typeRender"]=e.typeRender),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("form-get-data"),data:r,type:"POST",dataType:"json"})},executeRule:function(e){var t=this,r={};return e=e||{},r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTERULE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidrule"]=e.rule||"",e.xpathContext&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),e.prepare?r:$.create(t.serviceLocator.getUrl("form-submit-data"),r)},executeInterface:function(e){var t=this,r={};return e=e||{},r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTEINTERFACE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidinterface"]=e.interface||"",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?r:$.create(t.serviceLocator.getUrl("form-submit-data"),r)},executeSAPConnector:function(e){var t=this,r={};return e=e||{},r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTESAP",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidsap"]=e.guidsap||"",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?r:$.create(t.serviceLocator.getUrl("form-submit-data"),r)},executeConnector:function(e){var t=this,r={};return e=e||{},r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="EXECUTECONNECTOR",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidConnector"]=e.guidConnector||"",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext||"",e.prepare?r:$.create(t.serviceLocator.getUrl("form-submit-data"),r)},generateDocumentTemplate:function(e){return(e=e||{}).append=!!e.append&&e.append,$.create(this.serviceLocator.getUrl("render-document-generate"),{h_pageCacheId:e.idPageCache,contextXpath:e.xpathcontext,groupMappingId:e.groupMapping,xpathAttribute:e.xpath,append:e.append,controlId:e.id})},getAllDocumentsDownloadUrl:function(e){var t=this.serviceLocator.getUrl("render-document-generateAllDocuments"),r={};return r.h_pageCacheId=e.idPageCache,r.contextXpath=e.xpathContext,r.xpathAttribute=e.xpath,r.idCase=e.idCase,r.idWorkItem=e.idWorkItem,r.p_sessionId=e.sessionId,this.verifyPathToBase(bizagi.services.ajax.pathToBase,t)+"?"+jQuery.param(r)+"&xsrf="+bizagi.getXSRFToken()},getCaseNumber:function(e){return $.ajax({url:this.serviceLocator.getUrl("case-handler-getCaseSummary").replace("{idCase}",e.idCase)+"?eventAsTasks=false&onlyUserWorkItems=true&mobileDevice="+bizagi.isMobile(),type:"GET",dataType:"json"})},getCaseAssignees:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getCaseAssignees"),{idCase:e.idCase}).pipe(function(e){return e})},getWorkitems:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("case-handler-getWorkItems"),{idCase:e.idCase,onlyUserWorkItems:e.onlyUserWorkItems||""})},getGridExportUrl:function(e){var t=this,r=this.serviceLocator.getUrl("render-upload-data-url"),a={};return a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.exportType,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"disposition"]=e.disposition,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,a[t.Class.BA_ACTION_PARAMETER_PREFIX+"sort"]=e.sort,a[t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=e.sessionId,a[t.Class.BA_ACTION_PARAMETER_PREFIX+"idForm"]=e.idForm,a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),t.verifyPathToBase(bizagi.services.ajax.pathToBase,r)+"?"+jQuery.param(a)+"&xsrf="+bizagi.getXSRFToken()},sendEmail:function(e){var t=this;e=e||{};var r={};if(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="PROCESSPROPERTYVALUE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"propertyName"]=e.property||"sendEmail",e.xpathContext&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext),r[t.Class.BA_ACTION_PARAMETER_PREFIX+"to"]=e.to,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"subject"]=e.subject,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"message"]=e.message,r[t.Class.BA_ACTION_PARAMETER_PREFIX+"selected"]=JSON.encode(e.selected),e.prepare)return r;var a=e.url||t.serviceLocator.getUrl("form-get-data");return $.create(a,r)},invalidatePageCache:function(e){var t=e.extra||{};return t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="INVALIDATEPAGECACHE",t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,e.prepare?t:$.ajax({url:e.url||this.serviceLocator.getUrl("form-submit-data"),data:t,type:"POST",dataType:"json",serviceType:"INVALIDATEPAGECACHE"})},getUsersList:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList"),e)},getUsersListFromPreferences:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-FromPreferences"),e)},getUsersListForStakeholders:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersList-ForStakeholders"),e)},getUsersForAssignation:function(e){return $.read(this.serviceLocator.getUrl("admin-getUsersForAssignation"),e)},getUsersForm:function(e){return $.create(this.serviceLocator.getUrl("admin-usersform"),e)},generateDataToSendByEmail:function(e){(e=e||{}).idUser,e.password;return $.ajax({url:this.serviceLocator.getUrl("admin-GenerateDataToSendByEmail"),data:e,type:"POST",dataType:"json"})},sendUserEmail:function(e){(e=e||{}).eMailTo,e.subject,e.body;return $.ajax({url:this.serviceLocator.getUrl("admin-sendUserEmail"),data:e,type:"POST",dataType:"json"})},getConfiguration:function(){var e=this.serviceLocator.getUrl("admin-users-config");return $.read(e)},verifyPathToBase:function(e,t){return-1!=t.indexOf("http")&&""!=e?t:e+t},getTemplate:function(e){var t=this,r={};e=e||{},r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADTEMPLATE",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]="entity",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidEntity"]=e.guid,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"isProcessData"]=e.forcePersonalizedColumns,e.templateType&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"templatetype"]=e.templateType),e.templateGuid&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"templateguid"]=e.templateGuid),null!=e.isDefaultTemplate&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"isDefaultTemplate"]=e.isDefaultTemplate);var a=bizagi.util.detectDevice();return bizagi.util.isTabletDevice()?a="tablet":bizagi.util.isSmartphoneDevice()&&(a="mobile"),r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=a,e.prepare?r:$.create(t.serviceLocator.getUrl("form-get-data"),r)},hasStartForm:function(e){var t={};return e.guidWFClass&&(t.guidWFClass=e.guidWFClass),$.read(this.serviceLocator.getUrl("render-processes-startform"),t)},getStartForm:function(e){var t=this,r={};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="LOADSTARTFORM",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"guidprocess"]=e.guidprocess,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"isActionStartForm"]=!0,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicetype"]=t.deviceType,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"devicecode"]=t.deviceCode,e.idStartScope&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idCase&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idCase"]=e.idCase),e.idStartScope&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idStartScope"]=e.idStartScope),e.idWorkitem&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idWorkitem"]=e.idWorkitem),e.additionalXpaths&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.surrogatedKey&&(r[t.Class.BA_ACTION_PARAMETER_PREFIX+"surrogatedKey"]=e.surrogatedKey),e.recordXpath&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"recordlauncherxpath"]=e.recordXpath),e.mappingstakeholders&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"mappingstakeholders"]=e.mappingstakeholders),$.ajax({url:t.serviceLocator.getUrl("form-get-data"),data:r,type:"POST",dataType:"json",cache:!0})},editActionForm:function(e){return this.editGridRecord(e)},getActions:function(e){var t=$.extend(e,{prepare:!0}),r=this.getPropertyData(t)||[];return e.ptags&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.pmaxitems&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"maxitems"]=e.pmaxitems),e.prepare?r:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:r,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}})},executeActions:function(e){var t=$.extend({},e,{prepare:!0}),r=this.getPropertyData(t)||[];return e.pguidConstructor&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidConstructor"]=e.pguidConstructor),e.pguidAction&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"guidAction"]=e.pguidAction),e.prepare?r:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:r,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},getPolymorphicActions:function(e){var t=$.extend(e,{prepare:!0}),r=this.getPropertyData(t)||[];return e.ptags&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"tags"]=e.ptags),e.additionalXpaths&&(r[this.Class.BA_ACTION_PARAMETER_PREFIX+"additionalXpaths"]=e.additionalXpaths),e.prepare?r:$.ajax({url:e.url||this.serviceLocator.getUrl("render-property-refresh"),data:r,type:"POST",dataType:e.dataType||"json",serviceType:"PROCESSPROPERTYVALUE"})},serializePolymorphicActions:function(e){var t=[],r=function(t){t=t||{};var a="";return $.each(e,function(e,i){i[0]==t[6]&&(a+=r(i)+i[1]+" > ")}),a},a=function(t,i){var s,o,n,l=(n=[],o=(o=i)||"",$.each(e,function(e,t){t[6]==o&&n.push(t)}),n);return $.each(l,function(e,i){var o=a([],i[0]);(""!==(s={guidEntity:i[0],displayName:i[1],hasConstructor:!!i[5],type:i[3],guidObject:i[4],guidConstructor:i[5],xpathContext:i[2],children:o,parents:r(i)}).guidConstructor||s.children.length>0)&&t.push(s)}),t};return a(t,""),t},getEntityImage64:function(e){var t={width:e.data,height:e.height,xpath:e.xpath},r=this.serviceLocator.getUrl("render-entity-layout-image64").replace("{entity}",e.entity).replace("{surrogateKey}",e.surrogateKey);return $.ajax({url:r,data:t})},getFilesDataForLayoutUploadControl:function(e){return $.read(this.serviceLocator.getUrl("render-entity-layout-upload-files"),e)},processUploadFile:function(e){return $.ajax({url:this.verifyMobilePathToBase(bizagi.services.ajax.pathToBase||"",e.url),data:e.formData,type:"POST",contentType:!1,processData:!1})},commitGridAction:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="COMMIT",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending rollback request for grid '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-commit-url"),data:r,type:"POST",dataType:"json",serviceType:"COMMIT"})},sendCheckpointAction:function(e){var t=this,r=e.extra||{};return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="CHECKPOINT",r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.xpath,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=e.idRender,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=e.xpathContext,r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+t.Class.BA_PAGE_CACHE]=e.idPageCache,e.contexttype&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=e.contexttype),bizagi.debug("Sending checkpoint request for grid '"+e.xpath+"'",r),e.prepare?r:$.ajax({url:e.url||t.serviceLocator.getUrl("render-grid-checkpoint-url"),data:r,type:"POST",dataType:"json",serviceType:"CHECKPOINT"})},verifyMobilePathToBase:function(e,t){return bizagi.util.isSharepointContext()?(t||"").replaceAll(e,""):t}}),bizagi.render.services.service.extend("bizagi.render.services.service",{},{init:function(e){this._super(e),this.database=e.database},getFormData:function(e){var t=this;if((e=e||{}).isOfflineForm){if(bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData)return t.getFormDataFromNative(e).then(function(e){return t.database.mergeForm(e[1],e[0].data)});if("task"===e.offlineType){if(e.isEdited||!e.isOpen){var r=new $.Deferred;return $.when(t.database.getTaskData(e)).then(function(a){var i=t.database.getTaskForm(e);$.when(t.database.mergeDataDocument(a.data,null,i)).done(function(a){var s={data:a,isOpen:e.isOpen};t.database.mergeForm(s,i).then(function(e){r.resolve(e)})})}),r.promise()}return t.database.getTaskForm(e)}return $.when(t.database.getCase(e.idCase)).then(function(e){var r=$.trim(e.idWfClass.toString());return t.database.mergeForm(e,t.database.getFormData(r))})}return t._super(e)},getOfflineImage:function(e,t){return"task"===e.offlineType?this.database.getActivityImage(e,t):this.database.getStartDataImage(e,t)},getOfflineActivityDataImage:function(e,t){return this.database.getActivityDataImage(e,t)},saveOfflineImage:function(e,t){return"synchronization"===e.operationType?this.database.saveActivityFormImage(e,t):"edition"===e.operationType?"task"===e.offlineType?this.database.saveActivityDataImage(e,t):this.database.saveStartDataImage(e,t):null},saveOfflineFile:function(e,t,r){return"synchronization"===e.operationType?this.database.saveActivityFormFile(e,t,r):"edition"===e.operationType?"task"===e.offlineType?this.database.saveActivityDataFile(e,t,r):this.database.saveStartDataFile(e,t,r):null},getOfflineFile:function(e,t,r){return"task"===e.offlineType?this.database.getActivityFile(e,t,r):this.database.getStartDataFile(e,t,r)},getOfflineActivityDataFile:function(e,t,r){return this.database.getActivityDataFile(e,t,r)},getFormDataFromNative:function(e){var t=new $.Deferred;return bizagiapp.getNativeFormData(e,function(r){bizagiapp.getCase(e.idCase,function(e){var a=[JSON.parse(r),JSON.parse(e)];t.resolve(a)},function(e){t.reject(e)})},function(e){t.reject(e)}),t.promise()},submitData:function(e){var t=this;if((e=e||{}).isOfflineForm){var r=t.resolveData(e.data||{},e.xpathContext);return r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]=e.action,bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getNativeFormData?t.saveNativeFormInfo(e,r):"task"===e.offlineType?t.database.saveTaskData(e,r):t.database.saveStartData(e,r)}return t._super(e)},saveNativeFormInfo:function(e,t){var r=this,a=new $.Deferred;return r.getFormDataFromNative(e).then(function(i){return r.database.nativesaveStartData(t,i[1],i[0].data).done(function(t){bizagiapp.saveFormData(e,t),a.resolve(t)})}),a.promise()}}),$.Class.extend("bizagi.render.services.multiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},{init:function(e){this.service=e,this.serviceLocator=e.serviceLocator,this.batch={},this.batchTimer=50,this.circularDependencies=new bizagi.circularDependencies,this.replicateServiceMethods()},getService:function(){return this.service},replicateServiceMethods:function(){var self=this;for(var key in this.service.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"multiaction"!=key&&(self[key]=eval("var tmp = function(){ return this.proxyMethod(this.getService()."+key+", arguments);};tmp"))},proxyMethod:function(e,arguments){var t=this.service;if(!arguments||1!=arguments.length)return e.apply(t,arguments);if("object"!=typeof arguments[0])return e.apply(t,arguments);var r=arguments[0];if(1==r.prepare)return e.apply(t,arguments);r.prepare=!0;var a=e.apply(t,arguments);return this.add(a)},makeCircularDependenciesError:function(e){var t=bizagi.localization.getResource("render-actions-loop-validation");return printf(t,e.dependencyFrom,e.dependencyTo)},add:function(e){var t=this,r=new $.Deferred,a=e.h_action||"unnamed";["PROCESSPROPERTYVALUE","LOADTEMPLATE","ADDRELATIONWITHDATA"].indexOf(a)<0&&bizagi.override.detectCircularDependencies&&t.circularDependencies.addNode(a,e),clearTimeout(t.batchTimeout);var i=e.tag=Math.guid(),s={action:e,deferred:r};return t.batch[i]=s,t.batchTimeout=setTimeout(function(){var e=t.circularDependencies.resolve();if(e.error){for(var r in t.batch){var a=e.error.multiactionError;t.batch[r].deferred.reject(a)}t.batch={}}else t.fire()},t.batchTimer),r.promise()},fire:function(){var e={},t=[];$.each(this.batch,function(r,a){t.push(a.action),e[r]=a}),this.batch={},$.when(this.execute({actions:t,rejectDeferreds:!1})).done(function(t){$.each(t,function(t,r){var a=r.tag;r.error?e[a].deferred.reject(r.error,r,r.error.message):e[a].deferred.resolve(r.result),delete e[a]}),$.each(e,function(e,t){t.deferred.reject({type:"not-processed",message:"Operation didn't executed"},"","Operation didn't executed")})}).fail(function(t,r,a){var i=void 0!==a?a.message:a||"Operation didn't executed";$.each(e,function(e,t){t.deferred.reject({type:"not-processed",message:i},"","Operation didn't executed")})})},execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,function(e,r){r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=r.tag||e,delete r.tag}),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action",r);var s=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction"),data:r,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done(function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void s.reject(this,"servererror",t)}s.resolve(e)}).fail(function(e){var t,r=e.responseText||e;try{t=JSON.parse(r)}catch(e){}s.reject(e,"servererror",t)}),s.promise()}}),bizagi.render.services.multiactionservice.extend("bizagi.render.services.metadatamultiactionservice",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"h_pageCacheId"},{execute:function(e){var t=this,r={},a=void 0===e.rejectDeferreds||e.rejectDeferreds;r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="multiaction",$.each(e.actions,function(e,a){a[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"tag"]=a.tag||e,a[t.Class.BA_PAGE_CACHE]&&(r[t.Class.BA_PAGE_CACHE]=a[t.Class.BA_PAGE_CACHE]),delete a[t.Class.BA_PAGE_CACHE],delete a.tag}),(e=e||{}).actions&&(r[t.Class.BA_CONTEXT_PARAMETER_PREFIX+"actions"]=JSON.encode(e.actions)),bizagi.debug("Performing multi-action metadata",r);var s=new $.Deferred;return $.ajax({url:t.serviceLocator.getUrl("render-multiaction-metadata"),data:r,type:"POST",dataType:"json",serviceType:"MULTIACTION",beforeSend:function(e,t){bizagi.multiactionConnection=bizagi.multiactionConnection||[],bizagi.multiactionConnection.push(e)}}).done(function(e){for(i in e)if("function"!=typeof e[i]){var t=e[i];if(t.error&&a)return void s.reject(this,"servererror",t)}s.resolve(e)}).fail(function(e){var t,r=e.responseText||e;try{t=JSON.parse(r)}catch(e){}s.reject(e,"servererror",t)}),s.promise()}}),$.Class("bizagi.workportal.services.db",{},{init:function(){var self=this,queryString=bizagi.readQueryString();self.disabledb=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb),self.globalId="undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain",self.disabledb||self.createDatabases()},_destroy:function(e){this.deleteDatabases(e)},createDatabases:function(){var e=this,t=e.globalId.hashCode();e.dbRecentProcesses=new PouchDB("RecentProcesses"+t,{auto_compaction:!0}),e.dbProcessesHierarchy=new PouchDB("ProcessesHierarchy"+t,{auto_compaction:!0}),e.dbStartForms=new PouchDB("StartForms"+t,{auto_compaction:!0}),e.dbStartData=new PouchDB("StartData"+t,{auto_compaction:!0}),e.dbActivities=new PouchDB("Activities"+t,{auto_compaction:!0}),e.dbActivityForms=new PouchDB("ActivityForms"+t,{auto_compaction:!0}),e.dbActivityData=new PouchDB("ActivityData"+t,{auto_compaction:!0})},deleteDatabases:function(e){var t=new $.Deferred,r=this,a=[r.dbRecentProcesses,r.dbProcessesHierarchy,r.dbStartForms,r.dbStartData,r.dbActivities,r.dbActivityForms,r.dbActivityData],i=0;return void 0===e&&(e=function(e,r){e?t.reject(e):++i==a.length&&t.resolve("All db deleted successfully")}),a.forEach(function(t){t.destroy(e)}),t.promise()},restartDatabases:function(){var e=this,t=new $.Deferred;return $.when(e.deleteDatabases()).done(function(){e.createDatabases(),t.resolve()}).fail(function(){e.createDatabases(),t.resolve()}),t.promise()},getHierarchyObjects:function(e,t,r){var a=[];for(var i in e)e.hasOwnProperty(i)&&("object"==typeof e[i]?a=a.concat(this.getHierarchyObjects(e[i],t,r)):i==t&&e[i]==r||i==t&&""==r?a.push(e):e[i]==r&&""==t&&-1==a.lastIndexOf(e)&&a.push(e));return a},getAllOpenCases:function(){var e=new $.Deferred;return this.dbStartData.query({map:function(e){!1===e.closed&&"admon"===e.createdBy.userName&&emit(e,null)}},{reduce:!1},function(t,r){t||e.resolve(r)}),e.promise()}});var STOREOBJECTNAME="offlineTasks";bizagi.workportal.services.db.extend("bizagi.workportal.services.db",{},{createNewCase:function(e){var t=e.idWfClass,r=(new Date).toISOString(),a=new $.Deferred,i={_id:r,idWfClass:t.toString(),idWorkFlow:t.toString(),idCase:r,isFavorite:!1,globalId:this.globalId,createdBy:{Name:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon"},creationDate:new Date,process:e.process||"Offline",categoryName:e.process||e.categoryName||"Offline",displayName:e.displayName||"Offline",radNumber:r,isOfflineForm:!0,formsRenderVersion:2,isOpen:!0,workItems:[{idWorkItem:bizagi.util.uniqueID(),idTask:bizagi.util.uniqueID(),idCase:r,colorState:"Green",State:"Green",TaskName:e.process||"Offline"}]};return this.dbStartData.put(i,function(e,t){e?a.reject(e):a.resolve(i)}),a.promise()},deleteCase:function(e){var t=this,r=new $.Deferred;return t.dbStartData.get(e.idCase,function(e,a){e?(bizagi.log("Error, the case do not exist"),r.reject(e)):t.dbStartData.remove(a,function(t,a){t?(bizagi.log("Error erasing case"),r.reject(e)):r.resolve(a)})}),r.promise()},getWorkitems:function(e){var t=new $.Deferred;if(e.fromWorkItemId){var r={workItems:[e.fromWorkItemId]};t.resolve(r)}else this.dbStartData.get(e.idCase,function(e,r){e?t.reject(e):t.resolve(r)});return t.promise()},getCategories:function(e){var t=this,r=new $.Deferred;if(e.enableOfflineForm){var a=t.dbProcessesHierarchy;$.when(bizagi.util.db.getDocument(a,t.globalId)).then(function(a){if(t.categories=a.doc,e.idApp||e.idCategory){var s=i(t.categories,e);r.resolve({category:s,totalApps:e.idApp?s.length:0})}else{for(var o=t.categories;1==o.length&&(o[0].categories||o[0].subCategories);)o=i(o,o[0].appId?{idApp:o[0].appId}:{idCategory:o[0].idCategory});r.resolve({category:o,totalApps:o[0]&&o[0].appId?o.length:0})}}).fail(function(){r.resolve({category:[],totalApps:0})})}else r.resolve({});return r.promise();function i(e,t){for(var r=0,a=e.length;r<a;r++){if(e[r].appId&&e[r].appId==t.idApp)return e[r].categories;if(e[r].idCategory&&e[r].idCategory==t.idCategory)return e[r].subCategories;var s;if(e[r].categories&&(s=i(e[r].categories,t)))return s;if(e[r].subCategories&&(s=i(e[r].subCategories,t)))return s}}},getAllOpenCases:function(){var e=new $.Deferred;return this.dbStartData.query({map:function(e){!1===e.closed&&"admon"===e.createdBy.userName&&emit(e,null)}},{reduce:!1},function(t,r){t||e.resolve(r)}),e.promise()},getCase:function(e){var t=this.dbStartData;return bizagi.util.db.getDocument(t,e)},getCustomizedColumnsData:function(e){var t=new $.Deferred,r={cases:{rows:[],totalPages:1,page:1,lstIdCases:[]}},a="true"===e.inputtray;return(e.radnumber||e.radNumber)&&(e.radNumber=e.radnumber?e.radnumber:e.radNumber),(e.idcase||e.idCase)&&(e.radNumber=e.idcase?e.idcase:e.idCase),this.dbStartData.allDocs({include_docs:!0},function(i,s){if(i)bizagi.log("Error loading cases from local data base"),t.reject("Error loading cases from local database");else{for(var o=0,n=s.total_rows;o<n;o++)if(a===s.rows[o].value.isOpen&&(void 0===e.radNumber||""===e.radNumber.toString()||e.radNumber.toString()===s.rows[o].value.radNumber)){var l={id:s.rows[o].id,idWFClass:s.rows[o].idWFClass,idWorkFlow:s.rows[o].id,taskState:"",isFavorite:s.rows[o].value.isFavorite,guidFavorite:"",isOpen:s.rows[o].value.isOpen,isOfflineForm:!0,syncStatus:s.rows[o].syncStatus,fields:[{Value:s.rows[o].value.process,DisplayName:s.rows[o].value.process,DataType:"VarChar",isRadNumber:!1},{Value:s.rows[o].value.creationDate,DisplayName:"Process creation date",DataType:"DateTime",isRadNumber:!1}]};r.cases.rows.push(l),r.cases.lstIdCases.push(s.rows[o].id)}r.cases.totalPages=r.cases.page=r.cases.rows.length>0?1:0,t.resolve(JSON.stringify(r))}}),t.promise()},getAllProcesses:function(e){var t=this,r=new $.Deferred;void 0===e.inputtray&&(e.inputtray=!0);var a={workflows:{taskstate:"",workflow:[]}},i={map:function(e){e.idWfClass&&emit({idWf:e.idWfClass,isOpen:e.isOpen.toString()},1)},reduce:"_count"};return t.dbProcessesHierarchy.get(t.globalId,function(s,o){s?r.reject("error"):t.dbStartData.query(i,{reduce:!0},function(i,s){if(i)r.reject("error");else{for(var n=0,l=s.rows.length;n<l;n++)if(s.rows[n].key.isOpen==e.inputtray.toString()){var c=t.getHierarchyObjects(o,"idCategory",s.rows[n].key.idWf);a.isOpen=e.inputtray,a.workflows.workflow.push({category:"Offline Procesess",name:c[0]?c[0].categoryName:"",idworkflow:s.rows[n].key.idWf,count:s.rows[n].value,isFavorite:!1})}r.resolve(JSON.stringify(a))}})}),r.promise()},getOutboxCases:function(){var e=new $.Deferred,t={map:function(e){emit(e.isOpen,e)}};return this.dbStartData.query(t,{reduce:!1,key:!1},function(t,r){t?(bizagi.log("Error loading data before syncronization"),e.reject(t)):e.resolve(r)}),e.promise()},getOutboxTaskCases:function(){var e=new $.Deferred;return this.dbActivityData.allDocs({include_docs:!0},function(t,r){t?e.reject(t):e.resolve(r)}),e.promise()},getOutboxTaskCasesFilteredBySyncStatus:function(e,t){var r=new $.Deferred,a={map:function(t,r){var a=t.syncStatus;("any"===e&&a||"none"===e&&!a)&&(a=e),r(a)}},i={key:e=e||"none",include_docs:1==t};return this.dbActivityData.query(a,i,function(e,t){e?r.reject(e):r.resolve(t.rows)}),r.promise()},existantCase:function(e,t){e.idWfClass;var r=e.idCase+"-"+e.idWorkitem;return offlineCase={_id:r,idCase:r,isFavorite:!1,globalId:this.globalId,createdBy:{Name:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon"},creationDate:new Date,process:e.process||"Offline",categoryName:e.process||e.categoryName||"Offline",displayName:e.displayName||"Offline",radNumber:r,isOfflineForm:!0,formsRenderVersion:2,syncronized:!1,isOpen:!0,workItems:[{idWorkItem:bizagi.util.uniqueID(),idTask:bizagi.util.uniqueID(),idCase:r,colorState:"Green",State:"Green",TaskName:e.process||"Offline"}]}},getCasesList:function(e){var t=new $.Deferred,r={page:1,totalPages:1,elements:[]},a="drafts"===e.inputtray,i={map:function(e){emit(e.isOpen,e)}};return this.dbStartData.query(i,{reduce:!1,key:a},function(a,i){if(a)bizagi.log("Error loading cases from local database"),t.reject("Error loading cases from local database");else{for(var s=0,o=i.rows.length;s<o;s++)if(void 0===e.radNumber||""===e.radNumber.toString()||-1!=i.rows[s].value.radNumber.toString().indexOf(e.radNumber.toString())){var n=[i.rows[s].value.idCase,i.rows[s].value.workItems[0].idWorkItem[0]||"",i.rows[s].value.workItems[0].idTask[0]||"",i.rows[s].value.creationDate,i.rows[s].value.categoryName,i.rows[s].value.displayName,[["Case No",i.rows[s].value.idCase],["Process",i.rows[s].value.process],["Process creation date",bizagi.util.formatDateTime(i.rows[s].value.creationDate)]],i.rows[s].value.isOfflineForm,i.rows[s].value.isOpen];n.syncStatus=i.rows[s].value.syncStatus,r.elements.push(n)}t.resolve(r)}}),t.promise()},getCustomizedColumnsNewData:function(e){var t=new $.Deferred,r={cases:{rows:[],totalPages:1,page:1,lstIdCases:[]}},a="true"===e.inputtray,i={map:function(e){emit(e.isOpen,e)}};return this.dbStartData.query(i,{reduce:!1,key:a},function(a,i){if(a)bizagi.log("Error loading cases from local database"),t.reject("Error loading cases from local database");else{for(var s=0,o=i.rows.length;s<o;s++)if(void 0===e.radNumber||""===e.radNumber.toString()||e.radNumber.toString()===i.rows[s].value.radNumber){var n={id:i.rows[s].value.idCase,idWFClass:i.rows[s].value.idWfClass,idWorkFlow:i.rows[s].value.idWorkFlow,taskState:"",isFavorite:i.rows[s].value.isFavorite,guidFavorite:"",isOpen:i.rows[s].value.isOpen,isAborted:!1,isOfflineForm:!0,fields:[i.rows[s].value.idCase,i.rows[s].value.process,{workitems:i.rows[s].value.workItems},bizagi.util.formatDateTime(i.rows[s].value.creationDate),"",bizagi.util.formatDateTime(i.rows[s].value.creationDate)]};r.cases.rows.push(n),r.cases.lstIdCases.push(i.rows[s].id)}r.cases.totalPages=r.cases.page=r.cases.rows.length>0?1:0,t.resolve(JSON.stringify(r))}}),t.promise()},getRecentProcesses:function(e){var t=new $.Deferred,r=this.dbRecentProcesses;return $.when(bizagi.util.db.getDocument(r,this.globalId)).then(function(e){t.resolve(e)}).fail(function(e){t.resolve({processes:[]})}),t.promise()},saveOfflineTasks:function(e){for(i in e){var t=e[i],r=t[10],a=t[0]+"-"+t[1],s={_id:a,endDate:t.endDate,group:t.group,icon:t.icon,state:t.state,taskState:t.taskState,shortEndDate:t.shortEndDate,atRiskTime:t[11],type:t.type,idWfClass:r.toString(),idWorkFlow:r.toString(),idCase:t[0],isFavorite:t[9],isEdited:!1,createdBy:{Name:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon"},creationDate:t[12],process:t[4],categoryName:e.process||e.categoryName||"Offline",displayName:e.displayName||"Offline",radNumber:a,wfClassDisplayName:"",isOfflineForm:!0,formsRenderVersion:2,syncronized:!1,isOpen:!0,workItems:[{idWorkItem:t[1],idTask:t[2],idCase:t[0],colorState:t.taskstate,State:t.taskstate,TaskName:t[5]}]};bizagi.util.db.saveDocument(this.dbActivities,s)}},cleanOfflineTasks:function(){var e=this,t=new $.Deferred;return e.dbActivities.get(STOREOBJECTNAME,function(r,a){r?(bizagi.log("Error, no offline tasks"),t.reject(r)):e.dbStartData.remove(a,function(e,a){e?(bizagi.log("Error erasing tasks"),t.reject(r)):t.resolve(a)})}),t.promise()},getOfflineCases:function(e){var t=new $.Deferred,r={page:1,totalPages:1,elements:[]},a=e.isOpen;return this.dbActivities.allDocs({include_docs:!0},function(e,i){if(e)t.reject(e);else{for(var s=0,o=i.total_rows;s<o;s++)if(i.rows[s].doc.isOpen==a){var n=[i.rows[s].doc.idCase,i.rows[s].doc.workItems[0].idWorkItem||"",i.rows[s].doc.workItems[0].idTask||"",i.rows[s].doc.creationDate,i.rows[s].doc.process,i.rows[s].doc.workItems[0].TaskName,[["Case No",i.rows[s].doc.idCase],["Process",i.rows[s].doc.process],["Process creation date",bizagi.util.formatDateTime(i.rows[s].doc.creationDate)]],i.rows[s].doc.isOfflineForm,i.rows[s].doc.isOpen,i.rows[s].doc.isFavorite,i.rows[s].doc.idWfClass,i.rows[s].doc.atRiskTime,i.rows[s].doc.creationDate];n.isEdited=i.rows[s].doc.isEdited,n.offlineType="task",n.endDate=i.rows[s].doc.endDate,n.group=i.rows[s].doc.group,n.icon=i.rows[s].doc.icon,n.shortEndDate=i.rows[s].doc.shortEndDate,n.state=i.rows[s].doc.state,n.taskState=i.rows[s].doc.taskState,n.type=i.rows[s].doc.type,n.wfClassDisplayName=i.rows[s].doc.wfClassDisplayName,n.syncStatus=i.rows[s].doc.syncStatus,r.elements.push(n)}t.resolve(r)}}),t.promise()},updateCaseSyncStatus:function(e){var t=this,r=e.id;return"start"===e.type?a(t.dbStartData,r):a(t.dbActivityData,r).then(function(){a(t.dbActivities,r)});function a(t,r){return $.when(bizagi.util.db.getDocument(t,r)).then(function(r){return r.syncStatus=e.syncStatus,$.when(bizagi.util.db.saveDocument(t,r))}).then(function(e){return e})}},wasActivityWorkedOffline:function(e){var t=new $.Deferred;return $.when(bizagi.util.db.getDocument(this.dbActivityData,e)).then(function(e){t.resolve(!0)}).fail(function(e){t.resolve(!1)}),t.promise()}}),bizagi.workportal.services.db.extend("bizagi.workportal.services.db",{},{getFormData:function(e){var t=new $.Deferred;return this.dbStartForms.get(e,function(e,r){if(e)t.reject(e);else if(void 0!==r.form)setTimeout(function(){t.resolve({form:r.form,type:"form"})},300);else{var a={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};t.reject(JSON.stringify(a))}}),t.promise()},mergeForm:function(e,t){var r=this,a=new $.Deferred;return $.when(t).done(function(t){if(e.data){for(prop in e.isOpen||(t.form.buttons=[],0===Object.keys(e.data).length&&i(t.form.elements,{key:"«read-only-form»",value:""})),e.data)i(t.form.elements,{key:prop,value:e.data[prop]});function i(t,a){if(t.length&&t.length>0)for(var s=0,o=t.length;s<o;s++)i(t[s],a);else t.container?i(t.container.elements,a):(e.isOpen||(t.render.properties.editable=!1),t.render.properties.xpath==a.key&&("grid"===t.render.properties.type&&r.setRenderGridValues(t.render),r.setRenderValues(t.render.properties,a.value)))}a.resolve(t)}else a.resolve(t)}).fail(function(e){if(!e.responseText)var t={errorType:bizagi.localization.getResource("workportal-offline-error-nonexisting-form"),message:bizagi.localization.getResource("workportal-offline-error-nonexisting-form-message")};e.responseText=JSON.stringify(t),a.reject(e)}),a.promise()},setRenderGridValues:function(e){e.properties.data.columns=[];for(var t=0,r=e.elements.length;t<r;t++)e.properties.data.columns.push(e.elements[t].render.properties.xpath)},setDataType:function(e,t){},setRenderValues:function(e,t){var r=e.type;r||(r="label");if(-1===["text","label","number","money","date","boolean","geolocation","hidden","upload"].indexOf(r))if(-1===["combo","cascadingCombo","radio","list"].indexOf(r))if("search"!==r){if("image"!==r){if("grid"===r){e["deleted-records"]=t.value["deleted-records"]?t.value["deleted-records"]:{},t.value=t.value.rows,e.data.records=t.value.length,e.data.total=1,e.data.page=1;var a=e.data.columns.length,i=[],s=t.value.length;e.data.rows=[];for(var o=0;o<s;o++){var n=t.value[o].length>a?t.value[o][a]:void 0,l=n?n.idRow:bizagi.util.randomNumber(),c=[],d=[];c[0]=l;for(var u=0;u<a;u++){t.value[o][u]&&(t.value[o][u].xpath?d[e.data.columns.indexOf(t.value[o][u].xpath)]=t.value[o][u]:t.value[o][u].changes||(d[u]=t.value[o][u])),d[u]=d[u]?d[u]:{},c[c.length]="true"}var p=$.merge([l],d);n&&n.isNew&&(e["new-records"]=e["new-records"]?e["new-records"]:{},e["new-records"][l]=n.changes),e.data.rows.push(p),i[i.length]=c}return e.data.editable=i,void(e.data.visible=i)}try{e.value=t.value}catch(e){}return bizagi.log(r+" not supported in render factory",t,"error"),null}e.value=t}else for(var g=0,f=e.data.length;g<f;g++)e.data[g].id==t.value.id&&(e.value=t.value);else for(var m=0,h=e.data.length;m<h;m++)e.data[m].id==t.value&&(e.value=[{id:t.value,value:e.data[m].value}]);else e.value=t.value},getSummary:function(e){var t=new $.Deferred;if(e.offlineType&&"task"===e.offlineType){var r=e.idCase+"-"+e.idWorkitem;this.dbActivities.get(r,function(e,r){e?t.reject(e):t.resolve($.extend(r,{processPath:"/",currentState:r.workItems,countAssigness:0,countEvents:0,isOpen:r.isOpen.toString(),countSubProcesses:0}))})}else this.dbStartData.get(e.idCase,function(e,r){e?t.reject(e):t.resolve($.extend(r,{processPath:"/",currentState:r.workItems,countAssigness:0,countEvents:0,isOpen:r.isOpen.toString(),countSubProcesses:0}))});return t.promise()},saveActivityFormImage:function(e,t){var r=e.id,a=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.saveAttachment(this.dbActivityForms,a,r,"image/png",t,!0)},saveActivityDataImage:function(e,t){var r=e.id,a=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.saveAttachment(this.dbActivityData,a,r,"image/png",t,!0)},getActivityDataImage:function(e,t){var r=new $.Deferred,a=e.id,i=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(this.dbActivityData,i,a,t,"image/png",function(e){r.resolve(e)}),r.promise()},getActivityImage:function(e,t){var r=new $.Deferred,a=this,i=e.id,s=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(a.dbActivityData,s,i,t,void 0,function(e){void 0!==e?r.resolve(e):bizagi.util.db.getAttachment(a.dbActivityForms,s,i,t,void 0,function(e){void 0!==e?r.resolve(e):r.resolve("")})}),r.promise()},saveStartDataImage:function(e,t){var r=e.id,a=e.idCase;return bizagi.util.db.saveAttachment(this.dbStartData,a,r,"image/png",t,!0)},getStartDataImage:function(e,t){var r=new $.Deferred,a=e.id,i=e.idCase;return bizagi.util.db.getAttachment(this.dbStartData,i,a,t,"image/png",function(e){r.resolve(e)}),r.promise()},saveActivityFormFile:function(e,t,r){var a=e.id,i=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.saveAttachment(this.dbActivityForms,i,a,r,t,!0)},saveActivityDataFile:function(e,t,r){var a=e.id,i=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.saveAttachment(this.dbActivityData,i,a,r,t,!0)},getActivityDataFile:function(e,t,r){var a=new $.Deferred,i=e.id,s=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(this.dbActivityData,s,i,t,r,function(e){a.resolve(e)}),a.promise()},getActivityFile:function(e,t,r){var a=new $.Deferred,i=this,s=e.id,o=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getAttachment(i.dbActivityData,o,s,t,r,function(e){void 0!==e?a.resolve(e):bizagi.util.db.getAttachment(i.dbActivityForms,o,s,t,r,function(e){void 0!==e?a.resolve(e):a.resolve(null)})}),a.promise()},saveStartDataFile:function(e,t,r){var a=e.id,i=e.idCase;return bizagi.util.db.saveAttachment(this.dbStartData,i,a,r,t,!0)},getStartDataFile:function(e,t,r){var a=new $.Deferred,i=e.id,s=e.idCase;return bizagi.util.db.getAttachment(this.dbStartData,s,i,t,r,function(e){a.resolve(e)}),a.promise()},saveTaskForm:function(e,t){var r=this.dbActivityForms,a=e.idCase+"-"+e.idWorkitem;return t._id=a,t.dataChangeset=e.dataChangeset,bizagi.util.db.saveDocument(r,t)},getTaskForm:function(e){var t=this.dbActivityForms,r=e.idCase+"-"+e.idWorkitem;return bizagi.util.db.getDocument(t,r)},deleteTaskForm:function(e){var t=e.idCase+"-"+e.idWorkitem,r=this.dbActivityForms;return bizagi.util.db.deleteDocument(r,t)},updateTaskForm:function(e,t){this.saveTaskForm(e,t)},getStartForm:function(e){var t=this.dbStartForms,r=e.idProcess;return bizagi.util.db.getDocument(t,r)},saveStartForm:function(e,t){var r=this.dbStartForms;return t._id=e.idProcess,bizagi.util.db.saveDocument(r,t)},mergeTaskAction:function(e,t){return Object.keys(t).forEach(function(r){e[r]=t[r]}),e},saveTaskData:function(e,t){var r=this,a=new $.Deferred,i=e.idCase+"-"+e.idWorkitem,s=r.dbActivityData;function o(t){var o={_id:i,data:t,idForm:e.idForm};$.when(bizagi.util.db.saveDocument(s,o)).then(function(t){var i;"next"===e.action?i=r.closeOfflineTask(e):"save"!==e.action&&"SAVE"!==e.action||(i=r.markTaskEdited(e)),$.when(i).then(function(e){a.resolve(e)}).fail(function(e){a.reject(e)})}).fail(function(e){a.reject(e)})}return $.when(bizagi.util.db.getDocument(s,i)).then(function(e){o(e.data?r.mergeTaskAction(e.data,t):t)}).fail(function(){o(t)}),a.promise()},separateComplexControls:function(e,t){var r,a=new $.Deferred;return e.offlineType&&"task"!==e.offlineType?(r=new $.Deferred).resolve(t):r=this.mergeDataDocument(t,null,this.getTaskForm(e)),$.when(r).done(function(e){var r=[],i=[],s=[];Object.keys(e).forEach(function(a){var o=e[a];o&&o.renderId&&o.type&&"image"===o.type?(o.xpath=a,r.push(o),delete t[a]):o&&o.renderId&&o.type&&"upload"===o.type?(o.xpath=a,i.push(o),delete t[a]):o&&o.renderId&&o.type&&"grid"===o.type&&(o.xpath=a,s.push(o),delete t[a])}),a.resolve({data:t,images:r,uploads:i,grids:s})}),a.promise()},markTaskEdited:function(e){var t=new $.Deferred,r=this.dbActivities,a=e.idCase+"-"+e.idWorkitem;return $.when(bizagi.util.db.getDocument(r,a)).then(function(e){e.isEdited=!0,$.when(bizagi.util.db.saveDocument(r,e)).then(function(e){t.resolve(e)}).fail(function(e){t.reject(e)})}).fail(function(e){t.reject(e)}),t.promise()},closeOfflineTask:function(e){var t=new $.Deferred,r=this.dbActivities,a=e.idCase+"-"+e.idWorkitem;return $.when(bizagi.util.db.getDocument(r,a)).then(function(e){e.isOpen=!1,$.when(bizagi.util.db.saveDocument(r,e)).then(function(e){t.resolve(e)}).fail(function(e){t.reject(e)})}).fail(function(e){t.reject(e)}),t.promise()},getTaskData:function(e){var t=new $.Deferred,r=e.idCase+"-"+e.idWorkitem;return this.dbActivityData.get(r,function(e,r){e?t.reject(e):t.resolve(r)}),t.promise()},deleteTaskData:function(e){var t=this,r=new $.Deferred,a=e.idCase+"-"+e.idWorkitem;return t.dbActivityData.get(a,function(a,i){a?(r.resolve(a),console.log("Case not exists in outbox",e)):t.dbActivityData.remove(i,function(t,a){t?r.reject(t):(console.log("Case deleted of outbox",e),r.resolve(a))})}),r.promise()},saveStartData:function(e,t){var r=this,a=new $.Deferred;return r.dbStartData.get(e.idCase,function(i,s){i?a.reject(i):r.mergeDataDocument(t,s,r.getFormData(s.idWfClass.toString())).done(function(i){s=r.mergeData(t,s,i),e.idForm&&(s.idForm=e.idForm),r.dbStartData.put(s,function(e,t){e?a.reject(e):a.resolve(t)})})}),a.promise()},filterXpathsByType:function(e,t){var r=[];function a(e,r){e.xpath&&e.type===t&&r.push({xpath:e.xpath,renderId:e.id,value:e.value})}return function e(t,r){if(t)for(var i=0;i<t.length;i++){var s=t[i].container;s?e(t[i].container.elements,r):a(t[i].render.properties,r)}}(e.form.elements,r),r},mergeDataDocument:function(e,t,r){var a=new $.Deferred,i={};return $.when(r).done(function(t){for(prop in e)"h_action"!=prop&&(i[prop]={},i[prop].value=e[prop],r(t.form.elements,{key:prop,value:e[prop]}));function r(e,t){if(e.length&&e.length>0)for(var a=0,s=e.length;a<s;a++)r(e[a],t);else e.container?r(e.container.elements,t):e.render.properties.xpath==t.key&&(i[t.key].DataType=e.render.properties.dataType||"",i[t.key].type=e.render.properties.type||"",i[t.key].renderId=e.render.properties.id)}a.resolve(i)}),a.promise()},mergeData:function(e,t,r){for(var a in"next"==e.h_action&&(t.isOpen=!1),t.data=t.data||{},r){var i=!1;for(var s in t.data)a==s&&(bizagi.util.isEmpty(r[a])||bizagi.util.isEmpty(r[a].value)?(delete t.data[s],i=!0):(t.data[s]=r[a],i=!0));i||(t.data[a]=r[a])}return t},nativeSaveFormInfo:function(e,t,r){var a=this,i=new $.Deferred;return a.mergeDataDocument(e,t,r).done(function(r){t=a.mergeData(e,t,r),i.resolve(t)}),i.promise()},deleteNextButton:function(e){return e.form&&e.form.buttons&&(e.form.buttons=e.form.buttons.filter(function(e){var t=e.button.properties;return!t||!(t.caption&&"render-form-button-next"===t.caption)})),e}}),$.Class.extend("bizagi.workportal.services.pullWorker",{},{init:function(params){var self=this,queryString=bizagi.readQueryString();self.services=params,self.database=params.database;var querydisable=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb);self.disabledb=querydisable,self.globalId="undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain"},pull:function(){return!this.disabledb&&this.syncOfflineCases()},syncOfflineCases:function(e){var t=this;if(void 0!==t.database&&(t.synchronizing=t.synchronizing||!1,!t.synchronizing)){t.synchronizing=!0,t.pushInProgressPromise=new $.Deferred;var r=new bizagiQueue,a=t.syncOfflineStartCases(r),i=t.syncOfflineTaskCases(r);$.when(a,i).then(function(e,t){return r.execute()}).then(function(){t.synchronizing=!1,t.pushInProgressPromise.resolve(!0)}).fail(function(e,r,a){console.log("Error pushing cases to server with errors",r,a,e),t.synchronizing=!1,t.pushInProgressPromise.reject(!1)})}return t.pushInProgressPromise.promise()},syncSingleOfflineStartCase:function(e){var t=this,r=new $.Deferred;return $.when(t.database.getCase(e.idCase)).then(function(e){var r={idCase:e.idCase,data:e.data||{},idProcess:e.idWorkFlow,type:"start",id:e.idCase,syncStatus:"started"};return t.generateSyncCasePromise(r)}).then(function(e){r.resolve(e)}).fail(function(e){r.reject(e)}),r.promise()},syncOfflineStartCases:function(e){var t=this,r=new $.Deferred;return $.when(t.database.getOutboxCases()).done(function(a){for(var i=0;i<a.rows.length;i++){var s=a.rows[i].value;if(!s.syncStatus){var o={idCase:s.idCase,data:s.data||{},idProcess:s.idWorkFlow,type:"start",id:s.idCase,syncStatus:"started"};e.add(t.generateSyncCasePromise(o))}}r.resolve({Start:a.rows.length})}).fail(function(e){r.reject(e)}),r.promise()},syncOfflineTaskCases:function(e){var t=new $.Deferred,r=this;return r.database.getOutboxTaskCasesFilteredBySyncStatus("none",!0).done(function(a){for(var i=0;i<a.length;i++){var s=a[i].doc,o=a[i].id,n=o.split("-"),l={idCase:n[0],idWorkitem:n[1],data:s.data||{},type:"task",id:o,syncStatus:"started"};e.add(r.generateSyncCasePromise(l))}t.resolve({Tasks:a.length})}).fail(function(e){t.reject(e)}),t.promise()},generateSyncCasePromise:function(e){var t=this,r=new $.Deferred;return $.when(t.database.updateCaseSyncStatus(e)).then(function(){return"start"==e.type?t.services.syncOfflineStartCase(e):t.services.syncOfflineTaskCase(e)}).then(function(e){r.resolve(e)}).fail(function(e){r.reject(e)}),r.promise()}}),$.Class.extend("bizagi.workportal.services.fetchWorker",{},{init:function(params){var self=this;self.services=params,self.db=params.database,self.maxOfflineCases=100,self.secondsBeforeAllowFetchAgain=2,self.tasksSyncDelda=8,self.startSyncDelta=8;var queryString=bizagi.readQueryString();self.disabledb=!(!queryString||!queryString.disabledb)&&eval(queryString.disabledb),self.globalId="undefined"!=typeof BIZAGI_USER?(BIZAGI_USER+"-"+BIZAGI_PROXY_PREFIX+"-"+BIZAGI_DOMAIN).toLowerCase():"admon-http://localhost/bizagiR100x-domain",self.fetchInProgress=!1},fetch:function(e){var t=this,r=1e3*t.secondsBeforeAllowFetchAgain;function a(){t.fetchInProgress=!0,t.fetchInProgressPromise=new $.Deferred;var e=t.fetchStartForms(),r=t.fetchTasks();$.when.apply($,[e,r]).then(function(){t.lastFetch=Date.now(),t.fetchInProgressPromise.resolve(!0),t.fetchInProgress=!1}).fail(function(){t.fetchInProgressPromise.reject("Error executing fetch v2"),t.fetchInProgress=!1}),$.when(t.services.getRecentOfflineProcesses()).then(function(e){t.saveRecentProcesses(e)})}return t.lastFetch?t.lastFetch+r<Date.now()&&!t.fetchInProgress&&a():t.fetchInProgress||a(),t.fetchInProgressPromise.promise()},fetchStartForms:function(){var e=new $.Deferred,t=this,r=t.db.dbProcessesHierarchy;function a(){var r;$.when(t.services.processesHierarchy()).then(function(e){return(r=e).lastSynchronization=Date.now(),t.saveProcessesHierarchy(r)}).then(function(){return t.processTreeToFetchStartForms(r)}).then(function(){console.log("Sv2: Offline start forms downloaded succesfully"),e.resolve()}).fail(function(t){console.log("Sv2: Problem downloading any offline start form",t),e.reject()})}return $.when(bizagi.util.db.getDocument(r,t.globalId)).then(function(r){var i=!0,s=r.lastSynchronization;if(r.doc&&s){var o=Date.now();i=s+60*t.startSyncDelta*60*1e3<o}i?a():(console.log("Sync start forms is not needed"),e.resolve("Sync start forms is not needed"))}).fail(function(){a()}),e.promise()},processTreeToFetchStartForms:function(e){for(var t=this,r=new bizagiQueue,a=0;a<e.length;a++)for(var i=e[a].categories,s=0;s<i.length;s++)o(i[s],r);function o(e,r){if("true"===e.isProcess&&e.hasOfflineForm){var a=t.services.downloadOfflineStartForm({idProcess:e.idCategory});r.add(a)}else if(e.subCategories)for(var i=0;i<e.subCategories.length;i++){o(e.subCategories[i],r)}}return r.execute()},fetchTasks:function(){var e=new $.Deferred,t=this,r={};r.pageSize=t.maxOfflineCases,r.page=1;var a=t.services.serviceLocator.getUrl("offline-tasks");return $.when($.read(a,r)).then(function(e){return t.processTasksToFetchForms(e)}).then(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}),e.promise()},processTasksToFetchForms:function(e){for(var t,r=this,a=new $.Deferred,i={},s={},o={},n=-1,l=new Date,c=e.advanceSearch?r.services.defineActivityStateByTaskState:r.services.defineActivityStateByDate,d=new $.Deferred,u=new bizagiQueue;t=e.rows[++n];){for(var p,g={},f=["","","","","","",[],"","","","","",""],m=-1;p=e.headers[++m];)g[p.fieldName.toLowerCase()]={displayName:p.displayName,value:t[m]},r.services.serializeActivity(f,p.fieldName.toLowerCase(),g[p.fieldName.toLowerCase()]);var h=f,y={};if(y=c(h[3],h.taskstate),h.length>=10&&parseInt(h[11],10)>0){var v=new Date(h[3]);l.getTime()>v.getTime()?y.state="red":l.getTime()>v.getTime()-6e4*parseInt(h[11],10)?y.state="yellow":y.state="green"}h[7]=!0;var C=(h=$.extend({},h,y,{endDate:h[3],idworkitem:h[1],idwfclass:bizagi.util.validateFeatureSupport("advancedSearch")?h[10]:h[7]}))[0],A=h[1],P=C+"-"+A;s[P]=!0,o[P]=h,i[P]={idCase:C,idWorkitem:A,syncDelda:r.tasksSyncDelda,dataChangeset:h.dataChangeset}}return $.when(r.db.getOutboxTaskCasesFilteredBySyncStatus("any",!1)).then(function(e){for(var t=0;t<e.length;t++)delete i[e[t].id],delete o[e[t].id];return!0}).then(function(){var e=new $.Deferred;return r.db.dbActivities.allDocs({include_docs:!1},function(t,r){t?e.reject():e.resolve(r.rows)}),e.promise()}).then(function(e){for(var t=0;t<e.length;t++){localActivityInternalId=e[t].id,!!s[localActivityInternalId]||u.add(r.deleteLocalDataIfActivityWasNotWorked(localActivityInternalId))}d.resolve()}).fail(function(e){console.log("Diff algorithm error",e),d.resolve()}),$.when(d).then(function(){return r.services.database.saveOfflineTasks(o)}).then(function(e){for(var t in i){var a=r.services.downloadOfflineTaskForm(i[t]);u.add(a)}return u.execute()}).then(function(e){a.resolve(e)}).fail(function(e){a.reject(e)}),a.promise()},deleteLocalDataIfActivityWasNotWorked:function(e){var t=this,r=new $.Deferred;return $.when(t.db.wasActivityWorkedOffline(e)).then(function(a){if(!a)bizagi.util.db.deleteDocument(t.db.dbActivities,e),bizagi.util.db.deleteDocument(t.db.dbActivityForms,e);r.resolve()}),r.promise()},getHierarchyObjects:function(e,t,r){var a=[];for(var i in e)e.hasOwnProperty(i)&&("object"==typeof e[i]?a=a.concat(this.getHierarchyObjects(e[i],t,r)):i==t&&e[i]==r||i==t&&""==r?a.push(e):e[i]==r&&""==t&&-1==a.lastIndexOf(e)&&a.push(e));return a},saveProcessesHierarchy:function(e){var t=this.db.dbProcessesHierarchy,r={_id:this.globalId,doc:e};return e.lastSynchronization&&(r.lastSynchronization=e.lastSynchronization),bizagi.util.db.saveDocument(t,r)},saveRecentProcesses:function(e){var t=this.db.dbRecentProcesses;return e._id=this.globalId,bizagi.util.db.saveDocument(t,e)}}),bizagi.workportal.services.service.extend("bizagi.workportal.services.service",{},{init:function(e){var t=this;t.shouldSynchronize=!(bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice()&&"offlineServices"!==e.module),t.isOfflineFormsV2Supported=bizagi.util.isOfflineFormsV2Supported(),t._super(e),e.oldOfflineServicesAlreadyEnabled||(t.database=void 0===bizagi.workportal.services.db||bizagi.util.isSharepointContext()?null:new bizagi.workportal.services.db,t.enableOfflineEvents()),t.isOfflineFormsV2Supported&&(e.context="workflow",e.database=t.database,t.renderDataService=void 0!==bizagi.render.services.service?new bizagi.render.services.service(e):bizagi.render.services.service,bizagi.util.isNativePluginSupported()&&"offline"===bizagi.getNativeComponent()&&bizagiapp.offlineModuleReady(),t.fetchWorker=new bizagi.workportal.services.fetchWorker(this),t.pullWorker=new bizagi.workportal.services.pullWorker(this),t.shouldSynchronize&&t.configureOfflineHandlers())},configureOfflineHandlers:function(){var e=this;$(document).on("fetch-offline-processes",function(){e.fetchOfflineData()}),$(document).on("get-offline-categories",function(t,r){console.log(r),(r=r||{}).enableOfflineForm=!0,$.when(e.getCategories(r)).done(function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineCategories(e)}).fail(function(e){return e})}),$(document).on("get-offline-recent-processes",function(){$.when(e.getRecentProcesses()).done(function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.setOfflineRecentProcesses(e)}).fail(function(e){return e})}),$(document).on("create-startform-case",function(t,r){(r=r||{}).categoryName="",r.isOfflineForm=!0,$.when(e.createNewCase(r)).done(function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.openCreatedStartForm(e)}).fail(function(e){console.log("error creating new offline case")})}),$(document).on("get-offline-cases",function(t,r){var a={enableOfflineForm:!0};a.inputtray=r,$.when(e.getCasesListBeta(a)).done(function(e){e.inboxType=r,bizagiapp.setOfflineInboxCases(e)}).fail(function(e){console.log("error gathering offline cases")})}),$(document).on("get-offline-case-workitems",function(t,r){(r=r||{}).isOfflineForm=r.isOfflineForm||!0,r.idCase=r.idCase||"",$.when(e.getWorkitems(r)).done(function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.openCreatedStartForm(e)}).fail(function(e){console.log("error gathering the workITems from the given caseId")})}),$(document).on("delete-offline-case",function(t,r){(r=r||{}).idCase=r.idCase||"",$.when(e.deleteCase(r)).done(function(e){bizagi.util.isNativePluginSupported()&&bizagiapp.offlineCaseDeleted("success")}).fail(function(e){bizagiapp.offlineCaseDeleted("error"),console.log("error gathering the workITems from the given caseId")})}),$(document).off("tryPushData.offline"),$(document).on("tryPushData.offline",function(t){e.online&&e.pushOfflineData()}),$(document).off("tryPushCase.offline"),$(document).on("tryPushCase.offline",function(t,r){e.online&&r&&$.when(e.pullWorker.syncSingleOfflineStartCase(r)).then(function(e){r.responsePromise.resolve(e)}).fail(function(e){r.responsePromise.reject(e)})}),$(document).off("cleanDatabases.offline"),$(document).on("cleanDatabases.offline",function(){$.when(e.database.restartDatabases()).done(function(){bizagi.util.isiOSSmartphoneDevice()&&bizagi.util.isNativePluginSupported()||(bizagi.webpart.publish("bz-summary-item-clear"),bizagi.webpart.publish("bz-update-list-cases",{updateDataList:!0}),e.online||$(document).trigger("offline.inbox"))})})},enableOfflineEvents:function(){var self=this;if(bizagi.isMobileDevice()){if(void 0!==navigator.connection)"undefined"==typeof Connection||navigator.connection.type!=Connection.NONE&&"unknown"!=navigator.connection.type?self.online=!0:self.online=!1;else{var queryString=bizagi.readQueryString(),queryoffline=!queryString||!queryString.online||eval(queryString.online);self.online=queryoffline}$(document).off("online.services"),$(document).on("online.services",function(){self.online=!0,self.isOfflineFormsV2Supported&&self.shouldSynchronize&&self.returnOnlineStatus()}),$(document).off("offline.services"),$(document).on("offline.services",function(){self.online=!1})}},returnOnlineStatus:function(){var e=this;bizagi.util.isNativePluginSupported()&&bizagi.util.isiOSSmartphoneDevice()?(bizagiapp.openSyncDialog(),$.when(e.pushOfflineData()).always(function(t){e.fetchOfflineData(t)})):(bizagi.util.isNativePluginSupported()&&bizagi.util.isOfflineFormsV2Supported()&&bizagiapp.openSyncDialog(),$.when(e.logoutUser()).always(function(){$.when(e.authenticatedUser()).always(function(){$.when(e.pushOfflineData()).always(function(t){$.when(e.fetchOfflineData(t)).always(function(){bizagi.webpart.publish("bz-update-list-cases",{updateDataList:!0})})})})}))},fetchOfflineData:function(e){if(this.isOfflineFormsV2Supported){var t=1==e;$.when(this.fetchWorker.fetch()).done(function(e){r(t)}).fail(function(e){r(!1)})}function r(e){var t=bizagi.util.isValidResource("workportal-mobile-offline-sync-successful")?bizagi.localization.getResource("workportal-mobile-offline-sync-successful"):"Synchronization successful",r="success";e||(t=bizagi.util.isValidResource("workportal-mobile-offline-sync-fail")?bizagi.localization.getResource("workportal-mobile-offline-sync-fail"):"Synchronization failed",r="error"),bizagi.util.isNativePluginSupported()?bizagiapp.synchronizationFinished(r):bizagi.util.showNotification({text:t,type:r})}},pushOfflineData:function(){if(this.isOfflineFormsV2Supported)return this.pullWorker.pull()},getCurrentUser:function(e){if(this.online)return this._super(e);var t=new $.Deferred,r={idUser:1,user:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",userName:"undefined"!=typeof BIZAGI_USER?BIZAGI_USER:"admon",domain:"undefined"!=typeof BIZAGI_DOMAIN?BIZAGI_DOMAIN:"domain",delegateUserName:"",idDelegateUser:-1,groupSeparator:",",language:"en-US",decimalSeparator:".",decimalDigits:"2",symbol:"$",ShortDateFormat:"M/d/yyyy",TimeFormat:"h:mm tt",LongDateFormat:"dddd, MMMM d, yyyy",twoDigitYearMax:2029,twoDigitYearMaxDelta:13,uploadMaxFileSize:"1048576",isMultiOrganization:"false",associatedStakeholders:[],sUserProperties:[]};return t.resolve(r),t.promise()},getAllProcesses:function(e){return e.inputtray=e.inputtray||"inbox","inbox"==e.inputtray?this._super(e):$.when(this.database.getAllProcesses(e)).pipe(function(t){if(t=JSON.parse(t),e.skipAggrupate)return t;var r={},a={},i=bizagi.localization.getResource("workportal-widget-inbox-all-processes"),s={name:bizagi.localization.getResource("workportal-widget-inbox-all-cases"),path:"",category:i,isFavorite:e.onlyFavorites||!1,guidFavorite:"",idworkflow:"",guidWFClass:"",count:0};for(key in a[i]=[],a[i].workflows=[],a[i].workflows.push(s),t.workflows&&$.each(t.workflows.workflow,function(e,t){a[t.category]||(a[t.category]=[],a[t.category].workflows=[]),a[t.category].workflows.push(t),s.count+=Number(t.count)}),r.categories=[],a)r.categories.push({name:key,workflows:a[key].workflows});return r})},getCasesByWorkflow:function(e){if(e.inputtray=e.inputtray||"inbox","inbox"===e.inputtray){if(this.online)return this._super(e);var t=new $.Deferred;return $.when(this.getCustomizedColumnsDataTasks(e)).pipe(function(e){e=JSON.parse(e),$.each(e.cases.rows,function(t,r){var a=[];e.cases.rows[t].radnumber=r.id,$.each(r.fields,function(r,i){if(null!=i)try{null!=i.isRadNumber&&"true"==i.isRadNumber?e.cases.rows[t].radnumber=i.Value:null!=i.workitems?e.cases.rows[t].workitems=i.workitems:a.push(i)}catch(e){}}),e.cases.rows[t].fields=a}),t.resolve(e.cases)}),t.promise()}t=new $.Deferred;return $.when(this.database.getCustomizedColumnsData(e)).pipe(function(e){e=JSON.parse(e),$.each(e.cases.rows,function(t,r){var a=[];e.cases.rows[t].radnumber=r.id,$.each(r.fields,function(r,i){if(null!=i)try{null!=i.isRadNumber&&"true"==i.isRadNumber?e.cases.rows[t].radnumber=i.Value:null!=i.workitems?e.cases.rows[t].workitems=i.workitems:a.push(i)}catch(e){}}),e.cases.rows[t].fields=a}),t.resolve(e.cases)}),t.promise()},getCustomizedColumnsDataTasks:function(e){var t=new $.Deferred,r={cases:{rows:[],totalPages:1,page:1,lstIdCases:[]}};return(e.radnumber||e.radNumber)&&(e.radNumber=e.radnumber?e.radnumber:e.radNumber),(e.idcase||e.idCase)&&(e.radNumber=e.idcase?e.idcase:e.idCase),$.when(this.database.getOfflineCases({isOpen:!0})).pipe(function(a){tasks=a.elements;for(var i=0,s=tasks.length;i<s;i++){var o=tasks[i];if(void 0===e.radNumber||""===e.radNumber.toString()||e.radNumber.toString()===o[0]){var n={id:o[0],idWFClass:o[10],idWorkFlow:o[10],taskState:o.taskState,isFavorite:o[9],isEdited:o.isEdited,offlineType:"task",isOpen:!0,isOfflineForm:!0,fields:[{Value:o.wfclsdisplayname,DisplayName:o.wfclsdisplayname,DataType:"VarChar",isRadNumber:!1},{Value:o[12],DisplayName:"Process creation date",DataType:"DateTime",isRadNumber:!1}]};r.cases.rows.push(n),r.cases.lstIdCases.push(o[0])}}r.cases.totalPages=r.cases.page=r.cases.rows.length>0?1:0,t.resolve(JSON.stringify(r))}),t.promise()},getMenuAuthorization:function(){if(this.online)return this._super();var e=new $.Deferred;return e.resolve({permissions:[{Cases:["NewCase","Pending","Closed","Search"]},{AnalysisReports:["BAMProcess","BAMTask","AnalyticsProcess","AnalyticsTask","AnalyticsSensor","AnalysisQueries","BAMResourceMonitor"]},{Admin:["UserAdmin","Licenses","EntityAdmin","CaseAdmin","AlarmAdmin","EncryptionAdmin","MobileUpdatesAdmin","AsynchronousWorkitemRetries","UserPendingRequests","AuthenticationLogQuery","BusinessPolicies","Profiles","UserDefaultAssignation","GRDimensionAdmin","ThemeBuilder"]},{CurrentUserAdministration:["CurrentUser"]},{LogOut:[]},{Search:[]},{SmartFolders:[]},{CustomFolders:[]},{BizagiQueries:[]},{AnalysisQueries:[]},{StateLog:[]},{PrintableVersion:[]}]}),e.promise()},getInboxSummary:function(e){var t=this.online;if(!e||"false"!=e.inputtray&&"true"!=e.inputtray||(t=!1),t)return this._super(e);var r=new $.Deferred;return $.when('{"inboxSummary":{"Red":7,"Yellow":0,"Green":0,"Black":0,"All":7}}').pipe(function(e){var t=JSON.parse(e);r.resolve(t.inboxSummary)}),r.promise()},getCategories:function(e){if(this.online)return this._super(e);var t={};return(e=e||{}).idCategory&&(t.idCategory=e.idCategory),e.idApp&&(t.idApp=e.idApp),t.enableOfflineForm=e.enableOfflineForm||!1,t.groupByApp=e.groupByApp||!1,this.database.getCategories(t)},createNewCase:function(e){return(e=e||{}).isOfflineForm?this.database.createNewCase(e):this._super(e)},getWorkitems:function(e){return(e=e||{}).isOfflineForm?bizagi.util.isNativePluginSupported()&&void 0!==bizagiapp.getCase?this.getNativeWorkItems(e):this.database.getWorkitems(e):this._super(e)},getNativeWorkItems:function(e){var t=new $.Deferred;return bizagiapp.getCase(e.idCase,function(e){var r=JSON.parse(e);t.resolve(r)},function(e){t.reject(e)}),t.promise()},getCaseSummary:function(e){return(e=e||{}).isOfflineForm?this.database.getSummary(e):this._super(e)},deleteCase:function(e){return e=e||{},this.database.deleteCase(e)},getCaseSubprocesses:function(e){if((e=e||{}).isOfflineForm){var t=new $.Deferred;return t.resolve({subProcesses:[]}),t.promise()}return this._super(e)},getOverrides:function(){return{}},getCasesListBeta:function(e){var t=this;if((e=e||{}).inputtray=e.inputtray||"inbox","inbox"===e.inputtray){if(t.online){var r=t._super.bind(t),a=new $.Deferred,i=!!t.isOfflineFormsV2Supported&&t.fetchWorker.fetch();return $.when(i).always(function(t){$.when(r(e)).then(function(e){a.resolve(e)}).fail(function(e){a.reject(e)})}),a.promise()}var s=new $.Deferred;return $.when(t.database.getOfflineCases({isOpen:!0})).pipe(function(e){var r=t.getTaskFeedData(e);s.resolve(r)}),s.promise()}if("drafts"===e.inputtray||"outbox-new"===e.inputtray){var o=new $.Deferred;return $.when(t.database.getCasesList(e)).pipe(function(e){var r=t.getTaskFeedData(e);o.resolve(r)}),o.promise()}o=new $.Deferred;return $.when(t.database.getOfflineCases({isOpen:!1})).pipe(function(e){var r=t.getTaskFeedData(e);o.resolve(r)}),o.promise()},getMobileCasesList:function(e){return"inbox"===e.inputtray?this._super(e):getCasesListBeta(e)},getTaskFeedData:function(e){for(var t=bizagi.localization.getResource("workportal-taskfeed-overdue"),r=bizagi.localization.getResource("workportal-taskfeed-today"),a=bizagi.localization.getResource("workportal-taskfeed-tomorrow"),i=bizagi.localization.getResource("workportal-taskfeed-upcomming"),s={elements:[],page:e.page,totalPages:e.totalPages,advanceSearch:!1},o=new Date,n=o.getMonth(),l=o.getDate(),c=o.getFullYear(),d=0;e.elements.length>d;d++){var u=e.elements[d];void 0!==u.offlineType&&"task"===u.offlineType&&(u[3]=u.endDate);var p={},g=u[3];if(""!==u[3]){var f=new Date(u[3]),m=f.getDate(),h=f.getMonth(),y=f.getFullYear();new Date(y,h,m,0,0,0)-new Date(c,n,l,0,0,0)<0?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"MMMM dd | hh:mm tt"),p={group:"1|"+t,state:"red",type:"overdue",icon:"overdue"}):n===h&&l===m?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"hh:mm tt"),p=f.getTime()<o.getTime()?{group:"2|"+r+", "+bizagi.util.dateFormatter.formatDate(o,"MMMM dd"),state:"red",type:"today",icon:"overdue"}:{group:"2|"+r+", "+bizagi.util.dateFormatter.formatDate(o,"MMMM dd"),state:"yellow",type:"today",icon:"ontime"}):n===h&&l+1===m?(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"hh:mm tt"),p={group:"3|"+a+", "+bizagi.util.dateFormatter.formatDate(new Date(u[3]),"MMMM dd"),state:"yellow",type:"tomorrow",icon:"ontime"}):(u[3]=bizagi.util.dateFormatter.formatDate(new Date(u[3]),"MMMM dd | hh:mm tt"),p={group:"4|"+i,state:"green",type:"upcoming",icon:"upcoming"})}else u[3]="--",p={group:"1|"+t,state:"red",type:"overdue",icon:"overdue"};s.elements.push($.extend({},u,p,{endDate:g,idworkitem:u[1]}))}return s},summaryCaseDetails:function(e){var t=e||{};if(t.inputtray=t.inputtray||"inbox",t.isOfflineForm){var r=$.Deferred(),a=e.idWorkitem||0;return $.when(this.getCaseSummaryDataContent(e)).done(function(e){e.currentState=e.currentState||[];var t=e.currentState.length;e.showEvents=e.countEvents>=1,e.showParentProcess=e.idParentCase>=1,e.parentProcess={displayName:e.parentDisplayName,idCase:e.idParentCase},e.isClosed="true"!=e.isOpen,e.showAssignees=e.countAssigness>=1,e.showSubProcess=e.countSubProcesses>=1,e.showForm="true"==e.hasGlobalForm,e.allowsReassign="false";for(var i=0;i<t;i++)e.currentState[i].idWorkItem==a&&(e.allowsReassign=e.currentState[i].allowsReassign);for(var s=[],o=0,n=0;n<e.currentState.length;n++)"false"==e.currentState[n].isEvent&&"true"==e.currentState[n].assignToCurrentUser&&e.currentState[n].idWorkItem!=a&&(s[o++]=e.currentState[n]);e.currentStateTypes=s,e.showActivities=s.length>=1,r.resolve(e)}),r.promise()}return this._super(t)},getCaseSummaryDataContent:function(e){var t=this,r=new $.Deferred;return $.when(t.getCaseSummary(e)).done(function(e){e.taskState=t.icoTaskState,e.process=e.process?e.process:"",e.createdBy&&(e.createdByName=e.createdBy.Name,e.createdByUserName=e.createdBy.userName,e.caseDescription=""==e.caseDescription?"":e.caseDescription,e.processPath=e.processPath.replace(/\//g," > ")+e.process,e.showWorkOnIt=!0),r.resolve(e)}),r.promise()},getCustomizedColumnsData:function(e){if(e.inputtray=e.inputtray||"inbox","inbox"===e.inputtray)return this._super(e);var t=new $.Deferred;return $.when(this.database.getCustomizedColumnsNewData(e)).pipe(function(e){t.resolve(JSON.parse(e))}),t.promise()},getRecentProcesses:function(e){return e=e||{},this.online?this._super(e):this.database.getRecentProcesses(e)},startProcess:function(e){if(e=e||{},this.online)return this._super(e);var t=new $.Deferred,r={hasStartForm:!1,idProcess:e.idProcess,displayName:e.displayName,caseInfo:{}};return t.resolve(r),t.promise()},getShortCuts:function(e){if(e=e||{},this.online)return this._super(e);var t=new $.Deferred;return t.resolve([]),t.promise()},getSearchLists:function(){if(this.online)return this._super();var e=new $.Deferred;return e.resolve([]),e.promise()},getCollectionIcon:function(e){if(e=e||{},this.online)return this._super(e);var t=new $.Deferred;return t.resolve([]),t.promise()},getRecentOfflineProcesses:function(e){return e=e||{},$.read(this.serviceLocator.getUrl("process-handler-getRecentProcesses"),e).then(function(e){var t=e.processes||[],r={processes:[]};if(!bizagi.util.isObjectEmpty(t))for(var a,i=-1;a=t[++i];)a.hasOfflineForm&&r.processes.push(a);return r})},downloadImage:function(e,t,r){var a=this,i=new $.Deferred,s={prepare:!1,xpath:r.xpath,idRender:r.renderId,xpathContext:"",idPageCache:t.pageCacheId,sessionId:t.sessionId,property:"fileFullContent"};return $.when(a.renderDataService.getPropertyData(s)).done(function(t){if(t&&""!==t){var s={id:r.xpath,idCase:e.idCase,idWorkitem:e.idWorkitem,operationType:"synchronization"};$.when(a.database.saveActivityFormImage(s,t)).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)})}else i.resolve()}).fail(function(e){i.reject(e)}),i.promise()},downloadBinaryFile:function(e,t,r,a){var i=this,s=new $.Deferred,o={xpath:t.xpath,idRender:t.renderId,xpathContext:"",idPageCache:e.form.pageCacheId,fileId:r,sessionId:e.form.sessionId},n=i.renderDataService.getUploadFileUrl(o);return $.ajax({url:n,type:"GET",dataType:"binary",processData:!1}).then(function(e){if("application/json"==e.type){var t=new FileReader;t.onloadend=function(){s.reject({responseText:t.result})},t.readAsText(e)}else{if("string"==typeof e){var r=arguments[2].getResponseHeader("Content-type");e=i.byteArrayToBlob(i.stringToByteArray(e),r)}e.name=a,s.resolve(e)}}).fail(function(e){s.reject(e)}),s.promise()},downloadFilesInUploadControl:function(e,t,r,a){var i=this;r.value&&Array.isArray(r.value)&&r.value.forEach(function(s){var o=s[0],n=s[1];a.push(i.downloadSingleFile(e,t,r,o,n))})},downloadSingleFile:function(e,t,r,a,i){var s=new $.Deferred,o=this,n=o.downloadBinaryFile(t,r,a,i);return $.when(n).done(function(t){t&&(e.operationType="synchronization",e.id=r.xpath+"."+a,o.renderDataService.saveOfflineFile(e,t,t.type)),s.resolve(t)}).fail(function(e){s.reject(e)}),s.promise()},convertUploadOnlineValueInOfflineValue:function(e,t){var r=[];e.value&&Array.isArray(e.value)&&e.value.forEach(function(e){var t=e[1],a=bizagi.util.media.getFileExtension(t).toLowerCase();r.push({id:e[0],fileName:t,mimeType:bizagi.util.media.getMIMETypeByExtension(a),status:"existent"})}),t[e.xpath]=r},syncOfflineStartCase:function(e){var t=new $.Deferred,r=this,a={action:"LOADSTARTFORM",idProcess:e.idProcess,downloadOfflineForm:!0};return $.when(r.renderDataService.getFormData(a)).then(function(a){a.errorType?t.reject(a):a.form?$.when(r.database.separateComplexControls({offlineType:"start"},e.data)).then(function(i){return e.pageCacheId=a.form.pageCacheId,e.sessionId=a.form.sessionId,e.offlineType="start",r.performSyncOfflineCase(e,i,t)}).fail(function(e){t.reject(e)}):t.reject("Form not found in server response")}).fail(function(e){t.reject(e)}),t.promise()},performSyncOfflineCase:function(e,t,r){var a=this,i=e.offlineType,s=t,o=t.data,n=s.images,l=s.uploads,c=s.grids,d={pageCacheId:e.pageCacheId,sessionId:e.sessionId,idCase:e.idCase,offlineType:i,idWorkitem:e.idWorkitem},u=[],p=[];l&&l.forEach(function(e){a.generateUploadPromisesAndDeleteActionsForFilesInUploadControl(d,e,u,p)}),n&&n.forEach(function(e){a.generateUploadPromiseForImageControl(d,e,u)}),$.when.apply($,u).then(function(){!function(){if(c){var t=a.generateGridPromises(c,e.pageCacheId);t.bizAdditions&&t.bizAdditions.length>0&&(p=p.concat(t.bizAdditions)),t.bizDeletions&&t.bizDeletions.length>0&&(p=p.concat(t.bizDeletions))}var s,n={};for(var l in o){var d=o[l];void 0!==d.value?n[l]=d.value:n[l]=d}s="start"===i?"createnewcase":"save"===o.h_action?"trysave":"trynext";var u=a.renderDataService.submitData({action:s,data:n,idPageCache:e.pageCacheId,prepare:!0,transitions:""});p.push(u),$.when(a.renderDataService.multiaction().execute({actions:p})).done(function(t){if(console.log("SYNCH: "+i+" Case synchronized with server",t),t.length>0&&t[t.length-1].result&&"success"===t[t.length-1].result.type){var s,o=t[t.length-1].result;s="start"===i?a.database.deleteCase(e):a.database.deleteTaskData(e),$.when(s).done(function(e){r.resolve(o),console.log("SYNCH: Case data deleted of internal table",e)}).fail(function(e){r.reject(e),console.log("SYNCH: Error deleting Case data of internal table",e)}),"task"===i&&a.database.deleteTaskForm(e).done(function(e){console.log("SYNCH: Task form deleted of internal table",e)})}else a.database.updateCaseSyncStatus({type:i,id:e.id,syncStatus:"failed"}),console.log("Multiaction not successful",t),r.reject(t)}).fail(function(t){a.database.updateCaseSyncStatus({type:i,id:e.id,syncStatus:"failed"}),console.log("Multiaction error",t),r.reject(t)})}()})},syncOfflineTaskCase:function(e){var t=new $.Deferred,r=this,a=e.data;delete e.data,e.downloadOfflineForm=!0;var i=r.renderDataService.getFormData(e);return $.when(i).then(function(i){return i.errorType?$.when(r.database.updateCaseSyncStatus({type:"task",id:e.idCase+"-"+e.idWorkitem,syncStatus:"failed"})).always(function(e){t.reject(i)}):$.when(r.database.separateComplexControls(e,a)).then(function(a){return e.pageCacheId=i.form.pageCacheId,e.sessionId=i.form.sessionId,e.offlineType="task",e.id=e.idCase+"-"+e.idWorkitem,r.performSyncOfflineCase(e,a,t)}).fail(function(e){t.reject(e)})}).fail(function(e){t.reject(e)}),t.promise()},generateUploadPromisesAndDeleteActionsForFilesInUploadControl:function(e,t,r,a){var i=this,s=t.value;s&&0!=s.length&&s.forEach(function(s){var o=s.status;if("new"===o){var n={fileId:s.id,fileName:s.fileName,fileMimeType:s.mimeType};$.extend(n,e);var l=i.generateFileUploadPromise(n,t);r.push(l)}else if("deleted"===o){var c={renderId:t.renderId,xpath:t.xpath,fileId:s.id,idPageCache:e.pageCacheId},d=i.generateFileDeleteAction(c);a.push(d)}})},generateFileUploadPromise:function(e,t){var r,a=this,i=new $.Deferred,s=t.xpath,o=s+"."+e.fileId,n=e.offlineType;if(n&&"start"===n){var l={id:o,idCase:e.idCase,offlineType:n};r=a.renderDataService.getOfflineFile(l,bizagi.util.db.AttachmentType.Blob,e.fileMimeType)}else{l={id:o,idCase:e.idCase,idWorkitem:e.idWorkitem};r=a.renderDataService.getOfflineActivityDataFile(l,bizagi.util.db.AttachmentType.Blob,e.fileMimeType)}return $.when(r).done(function(r){if(r){var o={xpath:s,renderId:t.renderId,pageCacheId:e.pageCacheId,sessionId:e.sessionId,fileName:e.fileName};$.when(a.uploadFile(o,r)).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)})}else i.reject()}),i.promise()},generateFileDeleteAction:function(e){var t=e.fileId,r={xpath:e.xpath+(bizagi.util.isNumeric(t)?"[id="+t+"]":"[id='"+t+"']"),idRender:e.renderId,xpathContext:"",idPageCache:e.idPageCache,prepare:!0};return this.renderDataService.deleteUploadFile(r)},uploadFile:function(e,t){var r=new $.Deferred,a=new FormData;a.append("h_xpath",e.xpath),a.append("h_idRender",e.renderId),a.append("h_xpathContext",""),a.append("h_pageCacheId",e.pageCacheId),a.append("p_sessionId",e.sessionId),a.append(e.xpath,t,e.fileName);try{null!=BIZAGI_SESSION_NAME?a.append(BIZAGI_SESSION_NAME,e.sessionId):a.append("JSESSIONID",e.sessionId)}catch(t){a.append("JSESSIONID",e.sessionId)}return $.when(this.renderDataService.processUploadFile({url:this.renderDataService.getUploadAddUrl(),formData:a})).done(function(e){e.type&&"error"===e.type?r.reject(e):(console.log("File uploaded",e),r.resolve(e))}),r.promise()},generateUploadPromiseForImageControl:function(e,t,r){var a,i=this,s=new $.Deferred,o=e.offlineType,n={id:t.xpath,offlineType:o};$.extend(n,e),a=o&&"start"===o?i.renderDataService.getOfflineImage(n,bizagi.util.db.AttachmentType.Blob):i.renderDataService.getOfflineActivityDataImage(n,bizagi.util.db.AttachmentType.Blob),$.when(a).done(function(e){e?($.extend(n,t),$.when(i.uploadImage(n,e)).done(function(){s.resolve()}).fail(function(){s.reject()})):s.reject()}),r.push(s)},uploadImage:function(e,t){var r=new $.Deferred,a={};a.h_xpath=e.xpath,a.h_idRender=e.renderId,a.h_xpathContext="",a.h_pageCacheId=e.pageCacheId,a.p_sessionId=e.sessionId,a.h_action="savefile";try{null!=BIZAGI_SESSION_NAME?a[BIZAGI_SESSION_NAME]=e.sessionId:a.JSESSIONID=e.sessionId}catch(t){a.JSESSIONID=e.sessionId}a.queueID="q_"+bizagi.util.encodeXpath(e.xpath);var i={};i.data=a,i.options={},i.options.fileKey="file",i.options.fileName=t.name||"offlineImage_"+bizagi.util.randomNumber()+".png",i.options.mimeType="image/png",i.options.uploadKey={key:a.h_xpath},i.options.addUrl=this.renderDataService.getUploadAddFileUrl(!1);var s=new FormData;return $.each(i.data,function(e,t){s.append(e,t)}),s.append(i.options.uploadKey.key,t,i.options.fileName),$.ajax({url:i.options.addUrl,type:"POST",contentType:!1,processData:!1,data:s}).done(function(e){e.type&&"error"===e.type?r.reject(e):(console.log("Image uploaded",e),r.resolve(e))}).fail(function(e){r.reject(e)}),r.promise()},processesHierarchy:function(){var e={removeOnlineItems:"true"};return $.ajax({url:this.serviceLocator.getUrl("offline-getProcessTree"),data:e,dataType:"json",type:"GET"})},generateGridPromises:function(e,t){var r=this,a={bizAdditions:[],bizDeletions:[]};return e.forEach(function(e){if(e.value["new-records"])for(var i=Object.keys(e.value["new-records"]),s=0;s<i.length;s++){(o=e.value["new-records"][i[s]]).idPageCache=t,a.bizAdditions.push(r.renderDataService.addGridRecordData(o))}if(e.value["deleted-records"])for(i=Object.keys(e.value["deleted-records"]),s=0;s<i.length;s++){var o;(o=e.value["deleted-records"][i[s]]).idPageCache=t,a.bizDeletions.push(r.renderDataService.deleteGridRecord(o))}}),a},downloadOfflineStartForm:function(e){var t,r,a=new $.Deferred,i=this;return e.action="LOADSTARTFORM",e.downloadOfflineForm=!0,t=e,r=a,$.when(i.renderDataService.getFormData(t)).then(function(e){if(e.errorType&&a.reject(e),e.form)return e.form.properties.isTaskForm=!1,e.form.buttons=[{button:{properties:{actions:["submitData","refresh"],caption:"render-form-button-save",id:"ec0a5a02-0f81-44a7-8d64-ac090a01d61b"}}},{button:{properties:{actions:["validate","submitData","next","routing"],caption:"render-form-button-next",id:"ba81c7af-0d83-4139-879d-b040f0f81bd7"}}}],i.database.saveStartForm(t,e);a.reject(e)}).then(function(){r.resolve()}).fail(function(e){r.reject()}),a.promise()},downloadOfflineTaskForm:function(e){var t=new $.Deferred,r=this,a=r.database.getTaskForm(e);function i(e,t){$.when(r.getServerTaskForm(e)).then(function(t){return t.form.properties.isTaskForm=!0,t.lastFullSync=Date.now(),r.database.saveTaskForm(e,t)}).then(function(){t.resolve()}).fail(function(){t.reject()})}return e.deleteNextButton=!1,$.when(a).done(function(r){var a=36e5*e.syncDelda;!r.lastFullSync||r.lastFullSync+a<Date.now()||r.dataChangeset!=e.dataChangeset?i(e,t):t.resolve()}).fail(function(){i(e,t)}),t.promise()},getServerTaskForm:function(e){var t=this,r=new $.Deferred,a=void 0;return e.downloadOfflineForm=!0,$.when(t.renderDataService.getFormData(e)).done(function(i){i.errorType&&r.reject(i),i.dataChangeset=e.dataChangeset,e.deleteNextButton&&(i=t.database.deleteNextButton(i));var s={},o=[];t.database.filterXpathsByType(i,"upload").forEach(function(r){t.downloadFilesInUploadControl(e,i,r,o),t.convertUploadOnlineValueInOfflineValue(r,s)});var n=t.downloadFormImages(i,e);o.push(n);var l=new $.Deferred;o.push(l);var c=new $.Deferred;$.when(t.database.mergeDataDocument(s,null,c)).done(function(e){var r={data:s};r.data=e,r.isOpen=!0,t.database.mergeForm(r,c).then(function(e){l.resolve(e),a=e})}).fail(function(e){l.reject(e)}),c.resolve(i),$.when.apply($,o).then(function(){r.resolve(a)}).fail(function(){console.log("Error downloading task form",e),r.reject()})}).fail(function(e){r.reject(e)}),r.promise()},downloadFormImages:function(e,t){var r=new $.Deferred,a=this,i=a.database.filterXpathsByType(e,"image"),s=[];return i.forEach(function(r){s.push(a.downloadImage(t,e.form,r))}),$.when.apply($,s).then(function(){r.resolve()}).fail(function(e){console.log("Error downloading images",t,e),r.reject()}),r.promise()}}),bizagi.workportal.services.routing.extend("bizagi.workportal.services.routing",{},{init:function(e){this._super(e)},getRoute:function(e){new $.Deferred;if(this.params=e||this.params,void 0!==e.offlineAction&&"next"===e.offlineAction){var t=new $.Deferred;return t.resolve(this.routeToGlobalFormWithoutData()),bizagi.loading.stop(),t.promise()}return this._super(e)}});
//# sourceMappingURL=../../../../Maps/smartphone_android/workportalflat.smartphone.production.js.map
