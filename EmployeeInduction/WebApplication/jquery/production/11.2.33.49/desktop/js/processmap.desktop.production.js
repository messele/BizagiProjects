bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.dashboard.menu.activity",{},{init:function(e,t,i){var a=this;a.params=i||{},a._super(e,t,i),a.loadTemplates({"project-dashboard-menu":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.dashboard.menu.activity").concat("#project-dashboard-menu1")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.params.contextsLeftSidebarCaseDashboard.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var i=this;i.params=$.extend(i.params,t.args),i.params.plan.idActivitySelected=void 0,i.clean();var a=i.getContent().empty();void 0!==e.type&&(i.params.showContextByMenuDashboard=e.type);var o={showFormOverview:i.params.menuDashboard.showFormOverview,showFormActivity:i.params.menuDashboard.showFormActivity,showCommentsOptionMenu:i.params.menuDashboard.showCommentsOptionMenu,showFilesOptionMenu:i.params.menuDashboard.showFilesOptionMenu,showTimeLineOptionMenu:i.params.menuDashboard.showTimeLineOptionMenu&&(!i.params.isAdhocProcess||i.params.isAdhocProcess&&bizagi.util.isEnableFeature("enableTimelineOnLiveProcesses")),showPlanOptionMenu:i.params.menuDashboard.showPlanOptionMenu,contextPlanOptionMenu:i.params.menuDashboard.contextPlanOptionMenu,contextFormActivityOptionMenu:i.params.menuDashboard.contextFormActivityOptionMenu};i.getTemplate("project-dashboard-menu").render(o).appendTo(a),i.params.showContextByMenuDashboard&&$("li[data-context='"+i.params.showContextByMenuDashboard.toUpperCase()+"']",i.content).addClass("active").siblings().removeClass("active"),i.handlerEvents()},loadContentById:function(e){var t=this;e.preventDefault();var i=$(e.target).closest("li");if(!i.hasClass("active")){var a=i.data("context");a&&$.when(bizagi.util.autoSave()).done(function(){$(document).data("auto-save","");var e=t.pub("notify",{type:"NAVIGATOR_GETLEVEL"}),i=parseInt(e[0],10),o="",r=i;"PLANACTIVITIES"==a&&(r=i+1,o=bizagi.localization.getResource("workportal-project-casedashboard-plan")),t.params.refreshLastItemBreadcrumb=!1,t.pub("notify",{type:a.toUpperCase(),args:$.extend(t.params,{showContextByMenuDashboard:a,histName:o,level:r})}),$("li[data-context='"+t.params.showContextByMenuDashboard.toUpperCase()+"']",t.content).addClass("active").siblings().removeClass("active")})}},subMenuHandler:function(){var e=this.getContent(),t=$("[data-context='COMMENTS']",e),i=$("[data-context='FILES']",e),a=$("[data-context='TIMELINE']",e);$(".ui-bizagi-wp-project-tab-submenu a",e).on("click",function(){t.toggle(),i.toggle(),a.toggle()})},handlerEvents:function(){var e=this,t=e.getContent();e.subMenuHandler(),$(".ui-bizagi-wp-project-tab-links a",t).on("click",$.proxy(e.loadContentById,e)),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).on("click",function(){var t={action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:e.params.idCase,idTask:e.params.idTask,idWorkflow:e.params.idWorkflow,idWorkItem:e.params.idWorkitem,referrer:e.params.referrer||"inboxGrid"};e.publish("executeAction",t)})},clean:function(){var e=this,t=e.getContent();e.params&&e.params.contextsLeftSidebarCaseDashboard&&e.params.contextsLeftSidebarCaseDashboard.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))}),$(".ui-bizagi-wp-project-tab-links a",t).off(),$(".ui-bizagi-wp-project-tab-links li .ui-bizagi-refresh-form",t).off()}}),bizagi.injector.register("bizagi.workportal.widgets.project.dashboard.menu.activity",["workportalFacade","dataService",bizagi.workportal.widgets.project.dashboard.menu.activity],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.content.dashboard",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"project-content-dashboard":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.content.dashboard").concat("#project-plan-content-dashboard")})},renderContent:function(){var e=this,t=e.getTemplate("project-content-dashboard");return e.content=t.render({}),e.content},postRender:function(){setTimeout(function(){$(window).trigger("resize")},1e3)}}),bizagi.injector.register("bizagi.workportal.widgets.project.content.dashboard",["workportalFacade","dataService",bizagi.workportal.widgets.project.content.dashboard],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processMap",{},{init:function(e,t,i){var a=this;a._super(e,t,i),a.instanceBizagiProcessMap=new bizagi.processMap(this),a.loadTemplates({"project-processmap":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-wrapper"),"project-process-diagram":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-process-diagram"),"project-activity-map":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-activity-map"),"project-subprocess":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processMap").concat("#project-processmap-subprocess")})},renderContent:function(){var e=this,t=e.instanceBizagiProcessMap.renderContent();return e.content=t.render(e.viewOptions),e.content},postRender:function(){this.instanceBizagiProcessMap.postRender()},configureHandlers:function(){this.instanceBizagiProcessMap.configureHandlers()},onProcessDiagram:function(){this.instanceBizagiProcessMap.onProcessDiagram()},onActivityMap:function(){this.instanceBizagiProcessMap.onActivityMap()},onSupprocess:function(){this.instanceBizagiProcessMap.onSupprocess()},navigationManager:function(e){var t=this.instanceBizagiProcessMap.navigationManager(e);t.container.append(t.template.render(t.viewOptions))},renderProcessDiagram:function(){this.instanceBizagiProcessMap.renderProcessDiagram()},resize:function(){this.instanceBizagiProcessMap.resize()},renderActivityMap:function(){this.instanceBizagiProcessMap.renderActivityMap()},renderSubProcessMap:function(){this.instanceBizagiProcessMap.renderSubProcessMap()},appendActivityMapZoom:function(){this.instanceBizagiProcessMap.appendActivityMapZoom()},appendProcessMapZoom:function(){this.instanceBizagiProcessMap.appendProcessMapZoom()},appendSubprocessZoom:function(){this.instanceBizagiProcessMap.appendSubprocessZoom()},appendSubprocessDragScroll:function(){this.instanceBizagiProcessMap.appendSubprocessDragScroll()},bindTooltip:function(e){this.instanceBizagiProcessMap.bindTooltip(e)}}),bizagi.injector.register("bizagi.workportal.widgets.project.processMap",["workportalFacade","dataService",bizagi.workportal.widgets.project.processMap]),bizagi.workportal.widgets.graphicquery.extend("bizagi.workportal.widgets.project.processDiagram.helper",{},{getPVHeight:function(){var e=$(window).height()-50,t=this.$header.height()+180;return($(".ui-bizagi-wp-project-tab-content").height()||e)-t}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.caseState",{},{init:function(e,t,i){var a=this;a._super(e,t,i),a.contextsSidebarActivity=i.contextsSidebarActivity,a.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),a.loadTemplates({"project-caseState":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-wrapper"),"project-caseState-popup-release":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-popup-release"),"project-caseState-remaining":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.caseState").concat("#project-caseState-remaining")}),a.releaseDialogBox={}},renderContent:function(){return this.content=$("<div></div>"),this.releaseDialogBox.formContent=this.getTemplate("project-caseState-popup-release").render({}),this.content},postRender:function(){var e=this;(e.contextsSidebarActivity||[]).forEach(function(t){e.sub(t,$.proxy(e.updateView,e))}),e.plugins={},e.plugins.popupRelease={form:{buttonAccept:$("#button-accept-release",e.releaseDialogBox.formContent),buttonCancel:$("#button-cancel-release",e.releaseDialogBox.formContent)}},e.plugins.popupRelease.form.buttonAccept.on("click",$.proxy(e.onClickAcceptRelease,e)),e.plugins.popupRelease.form.buttonCancel.on("click",$.proxy(e.onClickCancelRelease,e))},updateView:function(e,t){var i=this;$.extend(i.params,t.args);var a=t.args;i.getContent().empty();var o={isFavoriteCase:"off"};if(a.isFavorite&&JSON.parse(a.isFavorite)?o.isFavoriteCase="bz-icon-star":o.isFavoriteCase="bz-icon-star-outline",i.showCaseNumber(a,o),a.creationDate){var r="MM/dd/yyyy H:mm",s=a.creationDate,n=bizagi.util.dateFormatter.getDateFromFormat(s,r);o.creationDateFormat=i.getFormattedDate(n);var c=bizagi.util.dateFormatter.getDateFromFormat(a.solutionDate,r);o.solutionDateFormat=i.getFormattedDate(c);var p=new Date;i.calculateDataForTemplate(o,n,p,c,a)}$(i.getContent()).on("click",".show-diagram-case",function(){!(!i.params.isAdhocProcess||void 0===i.params.isAdhocProcess)?i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkFlow,isAdhoc:!0,idProcess:i.params.idAdhocProcess}):i.showGraphicQuery({idCase:i.params.idCaseForGraphicQuery||i.params.idCase,idWorkflow:i.params.idWorkFlow})}),$(i.getContent()).on("click",".show-process-help",function(){i.showHelpUrl(i.params.helpUrl)})},calculateDataForTemplate:function(e,t,i,a,o){var r=this.getContent(),s={};s.idUser=bizagi.currentUser.idUser,bizagi.util.parseBoolean(o.isOpen)?(s.fromDate=t.getTime(),s.toDate=i.getTime()):(s.fromDate=a.getTime(),s.toDate=i.getTime());var n=s.toDate-s.fromDate,c=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-n),null,!1);bizagi.util.parseBoolean(o.isOpen)?(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-opened").replace("%s",c),e.colorStateCase="Opened"):(e.relativeTimeState=bizagi.localization.getResource("workportal-project-case-state-closed").replace("%s",c),e.colorStateCase="Closed"),e.percentCompleteBar=100,e.isOpen=bizagi.util.parseBoolean(o.isOpen),this.getTemplate("project-caseState-remaining").render($.extend(o,e)).appendTo($("#ui-bizagi-remaining",r))},showCaseNumber:function(e,t){var i=this,a=i.getContent(),o=i.getTemplate("project-caseState"),r=!1;r=!(!this.params.isAdhocProcess||void 0===this.params.isAdhocProcess)&&this.params.isAdhocProcess,i.params.helpUrl=bizagi.util.validateUrlWellFormed(i.params.helpUrl),o.render($.extend(e,t,{security:bizagi.menuSecurity,isAdhocProcess:r,urlHelp:!bizagi.util.isEmpty(i.params.helpUrl)})).appendTo(a),$(".case-summary-favorite",a).on("click",$.proxy(i.onClickFavorite,i)),$(".case-summary-back",i.content).on("click",$.proxy(i.goToCase,i,"back")),$(".case-summary-next",i.content).on("click",$.proxy(i.goToCase,i,"next")),i.showBackNextNavigation()},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,i=e.getMonth(),a=BIZAGI_LANGUAGE;return null!=a&&null!=a&&a.length>0&&"fr"==a.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[i]:t[i]+" "+$.datepicker.formatDate("dd",e)},onClickFavorite:function(e){e.preventDefault();var t=this,i={};$(e.target).hasClass("bz-icon-star-outline")?(i={idObject:t.params.idCase,favoriteType:"CASES"},$.when(t.dataService.addFavorite(i)).done(function(i){t.params.guidFavorite=i.idFavorites,$(e.target).removeClass("bz-icon-star-outline"),$(e.target).addClass("bz-icon-star")})):(i={idObject:t.params.guidFavorite,favoriteType:"CASES"},$.when(t.dataService.delFavorite(i)).done(function(){$(e.target).addClass("bz-icon-star-outline"),$(e.target).removeClass("bz-icon-star")}))},showHelpUrl:function(e){window.open(e)},onSelectMenu:function(e,t){if(0===$(e.currentTarget).find("i").length)switch($(t.item).data("item")){case"reassing":this.onClickMenuReasign();break;case"release":this.onClickMenuRelease()}},onClickMenuReasign:function(){var e=this,t=e.params.idCase,i=e.params.idWorkitem;bizagi.loader.startAndThen("admin").then(function(){$.when(e.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:t,idWorkItem:i},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))})},onClickMenuRelease:function(){var e=this;e.releaseDialogBox.formContent.dialog({resizable:!1,draggable:!1,height:"auto",width:"660px",modal:!0,title:bizagi.localization.getResource("workportal-widget-dialog-box-release-ok"),maximize:!0,close:function(){e.releaseDialogBox.formContent.dialog("destroy"),e.releaseDialogBox.formContent.detach()}})},onClickAcceptRelease:function(){var e=this,t={idCase:e.params.idCase,idWorkItem:e.params.idWorkitem};$.when(e.dataService.releaseActivity(t)).done(function(i){var a;switch(i.status?i.status:""){case"Success":e.publish("changeWidget",{widgetName:bizagi.workportal.currentInboxView});break;case"ConfigurationError":a=e.getResource("workportal-widget-dialog-box-release-configuration-error-message").replace("{0}",t.idWorkItem),bizagi.showMessageBox(a,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1);break;default:a=e.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem),bizagi.showMessageBox(a,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}}).fail(function(){var i=e.getResource("workportal-widget-dialog-box-release-error-message").replace("{0}",t.idWorkItem);bizagi.showMessageBox(i,e.getResource("workportal-widget-dialog-box-release-error"),"error",!1)}),e.releaseDialogBox.formContent.dialog("destroy"),e.releaseDialogBox.formContent.detach()},onClickCancelRelease:function(){this.releaseDialogBox.formContent.dialog("destroy"),this.releaseDialogBox.formContent.detach()},callGetEffectiveDuration:function(e){var t=$.Deferred();return e.fromDate?$.when(this.dataService.getEffectiveDuration(e)).done(function(e){t.resolve(e)}):t.resolve(null),t.promise()},clean:function(){var e=this;$(".show-diagram-case",e.getContent()).off();var t=e.contextsSidebarActivity||[];this.params={},t.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})},goToCase:function(e){var t="back"==e?this.getBackCase():this.getNextCase();t>0&&this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:t})},getListKey:function(){if(bizagi.lstIdCases=bizagi.lstIdCases||{},bizagi.lstIdCases.length>1)for(var e=0;e<bizagi.lstIdCases.length;e++)if(this.params.idCase==bizagi.lstIdCases[e])return e;return-1},getNextCase:function(){var e=this.getListKey();return bizagi.lstIdCases.length==e+1||1==bizagi.lstIdCases.length?-1:bizagi.lstIdCases[e+1]},getBackCase:function(){var e=this.getListKey();return 0==e?-1:bizagi.lstIdCases[e-1]||-1},showBackNextNavigation:function(){var e=this,t=e.getNextCase(),i=e.getBackCase();t<=0?$(".case-summary-next",e.content).hide():$(".case-summary-next",e.content).show(),i<=0?$(".case-summary-back",e.content).hide():$(".case-summary-back",e.content).show(),t<=0&&i<=0?($(".content-right-sidebar").removeClass("bz-state-number--active-case"),$(".bz-case-navigation").hide()):($(".content-right-sidebar").addClass("bz-state-number--active-case"),$(".bz-case-navigation").show())}}),bizagi.injector.register("bizagi.workportal.widgets.project.caseState",["workportalFacade","dataService",bizagi.workportal.widgets.project.caseState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityState",{},{init:function(e,t,i){this._super(e,t,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.datePickerRegional=bizagi.localization.getResource("datePickerRegional"),this.loadTemplates({"project-activityState-wrapper":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityState").concat("#project-activityState-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var i=this,a=t.args;i.params=a,i.getContent();var o={},r=a.currentState||[],s=r.filter(function(e){return e.idWorkItem==a.idWorkitem})[0];if(s){o.activityName=s.state,o.activityIsEvent=bizagi.util.parseBoolean(s.isEvent);var n="MM/dd/yyyy H:mm",c=bizagi.util.dateFormatter.getDateFromFormat(s.entryDateWorkItem,n);c.getTime&&(o.initDateFormat=i.getFormattedDate(c));var p=new Date,d=bizagi.util.dateFormatter.getDateFromFormat(s.estimatedSolutionDate,n);o.estimatedSolutionDateFormat="",c.getTime&&d.getTime&&s?i.calculateDataForTemplate(s,o,c,p,d,r):i.updateTemplateWidget(o,r)}},initilizeActionMenu:function(e){var t=this,i=!1;if(e&&e.length>0)for(j=0;j<e.length;++j)e[j]&&t.params&&e[j].idWorkItem==t.params.idWorkitem&&(i=bizagi.util.parseBoolean(e[j].allowsReassign)||!1);var a=$("#bt-case-action-reassing",t.content),o=$("#ui-bizagi-wp-project-activity-button:not(.ui-bizagi-wp-project-activity-shared)",t.content);i&&a.show(),a.on("click",function(){t.onClickMenuReasign()}),o.on("click",function(){t.onClickShareActivity()})},onClickMenuReasign:function(){var e=this,t=e.params.idCase,i=e.params.idWorkitem;bizagi.loader.startAndThen("admin").then(function(){$.when(e.publish("showDialogWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_REASSIGN_CASE,data:{idCase:t,idWorkItem:i},closeVisible:!1,maximize:!0,modalParameters:{title:bizagi.localization.getResource("render-actions-reassign"),width:"910px",id:"CaseAdmin"}}))})},onClickShareActivity:function(){var e={idWorkItem:this.params.idWorkitem},t=$("#ui-bizagi-wp-project-activity-button",this.content);t.attr("disabled",!0),$.when(this.dataService.getShareActivity(e)).done(function(e){var i=window.parent.bizagi.injector.get("notifier");!0===e.value?(t.addClass("ui-bizagi-wp-project-activity-shared").unbind("click"),i.showSucessMessage(bizagi.localization.getResource("workportal-project-activity-success-message"),"")):i.showErrorMessage(bizagi.localization.getResource("workportal-project-activity-error-message"),"")}).always(function(){t.attr("disabled",!1)})},calculateDataForTemplate:function(e,t,i,a,o,r){new Date(Date.now()-i.getTime());var s=a.getTime()-o.getTime(),n=i.getTime()-o.getTime(),c=(bizagi.currentUser.idUser,i.getTime()),p=Date.now(),d=!1,l={idUser:bizagi.currentUser.idUser,fromDate:a.getTime(),toDate:o.getTime()},u={};s>0?(l.fromDate=o.getTime(),l.toDate=a.getTime(),d=!0):(u.idUser=bizagi.currentUser.idUser,u.fromDate=i.getTime(),u.toDate=o.getTime());var g=p-c,m=l.toDate-l.fromDate,b=s>0?0:u.toDate-u.fromDate,h=bizagi.util.dateFormatter.getRelativeTime(new Date(Date.now()-g),null,!1);if(t.colorState=e.colorState,t.relativeTimeState=bizagi.localization.getResource("workportal-project-activity-state-opened").replace("%s",h),t.percentCompleteBar=100,0===n)t.showEstimatedSolutionDate=!1;else if(t.showEstimatedSolutionDate=!0,!1===d){var w=this.getPercentBar(b/1e3/60,m/1e3/60);t.percentCompleteBar=w.percent}e&&(t.isEvent=bizagi.util.parseBoolean(e.isEvent),t.canShareActivity=e.canShareActivity,t.isShared=e.isShared),t.estimatedSolutionDateFormat=this.getFormattedDate(o),this.updateTemplateWidget(t,r)},getPercentBar:function(e,t){var i={};return i.percent=Math.round(100*(1-t/e)),i},updateTemplateWidget:function(e,t){var i=this.getContent().empty();!1===bizagi.override.enableShareActivity&&(e.canShareActivity=!1,e.isShared=!1),this.getTemplate("project-activityState-wrapper").render(e).appendTo(i),t.length>0&&this.initilizeActionMenu(t),this.shareActivityTooltip()},shareActivityTooltip:function(){var e=$("#ui-bizagi-wp-project-activity-button",this.content);e.on("mouseenter",function(){var t=e.hasClass("ui-bizagi-wp-project-activity-shared")?"workportal-project-activity-shared":"workportal-project-activity-share";e.attr("title",bizagi.localization.getResource(t))}),e.tooltip({tooltipClass:"custom-tooltip-styling-bottom-bar",position:{my:"right top",at:"left top",of:e,collision:"flip"}})},getFormattedDate:function(e){var t=this.datePickerRegional.monthNames,i=e.getMonth(),a=BIZAGI_LANGUAGE;return null!=a&&null!=a&&a.length>0&&"fr"==a.substring(0,2)?$.datepicker.formatDate("dd",e)+" "+t[i]:t[i]+" "+$.datepicker.formatDate("dd",e)},clean:function(){var e=this,t=e.contextsSidebarActivity||[];this.params={},t.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})},callGetEffectiveDuration:function(e){var t=this,i=$.Deferred();return setTimeout(function(){e.fromDate?$.when(t.dataService.getEffectiveDuration(e)).done(function(e){i.resolve(e)}):i.resolve(null)},200),i.promise()}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityState",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.processState",{},{init:function(e,t,i){this._super(e,t,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-process-state":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.processState").concat("#project-process-state")})},renderContent:function(){var e=this.getTemplate("project-process-state");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var i=this,a=t.args,o=i.getContent().empty();i.params=a;var r={};r.showParentProcess=a.idParentCase>=1,r.parentProcess={displayName:a.parentDisplayName,idCase:a.idParentCase,idWorkItem:a.idWorkItem,idTask:"0"==a.idTask?"":a.idTask,idWorkflow:a.idWorkflowParentCase},i.getTemplate("project-process-state").render($.extend(a,r)).appendTo(o),$("#go-to-parent-case",o).on("click",$.proxy(i.onClickGoToParentCase,i))},onClickGoToParentCase:function(e){e.preventDefault();this.routingExecute($(e.target).closest("#go-to-parent-case"))},clean:function(){var e=this;e.params={},e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.processState",["workportalFacade","dataService",bizagi.workportal.widgets.project.processState]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.users",{},{init:function(e,t,i,a){var o=this;o.relatedusers=i,o._super(e,t,a),o.contextsSidebarActivity=a.contextsSidebarActivity,o.plugins={},o.users=[],o.loadedUsers=!1,o.loadTemplates({"project-users":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.users").concat("#project-users-main")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))}),e.sub("ON_RENDER_FINISH",$.proxy(e.onRenderFinish,e))},updateView:function(e,t){var i=this;i.params=t,setTimeout(function(){!1===i.loadedUsers&&i.onRenderFinish()},500)},onRenderFinish:function(){var e=this,t=e.params.args,i=e.getContent().empty();e.loadedUsers=!0,e.getTemplate("project-users").render().appendTo(i),e.showCreatorInformation(i);var a=[{id:t.createdBy.userId,typeName:"owner"}];t.idCase>0&&e.relatedusers.render(e.content,".relatedusers-wrapper",t.idCase,a)},showCreatorInformation:function(e){var t=this,i={userIds:t.params.args.createdBy.userId,width:50,height:50};t.dataService.getUsersData(i).done(function(i){var a=usersAdapter.createJsonUserInfo(i[0].id,i[0].name,i[0].username,i[0].picture?"data:image/png;base64,"+i[0].picture:void 0,i[0].email,i[0].name.getInitials(),!1,!0,[],[]);e.find("#ui-bizagi-wp-project-users-wrapper .ui-bizagi-wp-project-users-creator-info").userinformation(t,{user:a})})},clean:function(){var e=this;e.loadedUsers=!1,e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.users",["workportalFacade","dataService","relatedusers",bizagi.workportal.widgets.project.users]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.subprocesses.data",{responseSubprocessState:{},responseSubprocess:function(e){return e&&(responseSubprocessState=e),responseSubprocessState},auxArrayListSubprocessesState:[],auxArrayListSubprocesses:function(e){return e?jQuery.isArray(e)&&0===e.length?void(this.auxArrayListSubprocessesState.length=0):this.auxArrayListSubprocessesState.push(e):this.auxArrayListSubprocessesState}},{init:function(e,t,i){this._super(e,t,i),this.Class.auxArrayListSubprocesses([]),this.loadTemplates({"project-subprocesses-tootip-custom-properties":bizagi.getTemplate("bizagi.workportal.desktop.widgets.project.subprocesses.data").concat("#project-subprocesses-tooltip-custom-properties-wrapper")})},initializeTooltip:function(e){var t=this,i=t.getContent();$(e,i).tooltip({position:{collision:"flipfit",my:"right center",at:"left-10 center"},show:null,content:function(){var e,i,a,o=$(this).closest("li").find("#idCase").val(),r=t.Class.auxArrayListSubprocesses().filter(function(e){return e.idCase==o});if(r.length>0)return e=r[0].indexSubprocess,i=r[0].idCustData,a=$(this).text(),t.getContentTooltip(e,i,a,t.getTemplate("project-subprocesses-tootip-custom-properties"))},open:function(e,t){if(void 0===e.originalEvent)return!1;var i=$(t.tooltip).attr("id");$("div.ui-tooltip").not("#"+i).remove()},close:function(e,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("400",function(){$(this).remove()})})}})},getContentTooltip:function(e,t,i,a){"-1"==t&&(t="0");var o=function(e,t){return{nameProperty:e,valueProperty:t}},r=[],s="",n=this.getSubprocessData(e,t),c=n.custData,p=n.custDataTypes,d=n.custFields,l=n.displayName;if(r.push(new o(bizagi.localization.getResource("workportal-widget-inboxcommon-subprocess"),l)),c.length)for(var u=0;u<c.length;u+=1)s=c[u],p&&("Money"==p[u]?s=bizagi.util.formatMonetaryCell(s):"Boolean"==p[u]?s=bizagi.util.formatBoolean(s):"Float"==p[u]||"Real"==p[u]?s=bizagi.util.formatDecimalCell(s):"function"==typeof s&&(s="")),r.push(new o(d[u],s));var g={};g.arrayCustomsProperties=r,g.nameSubprocess=i;var m=a,b=$('<div class="bizagi-custom-tooltip-subprocesses"></div>');return m.render(g).appendTo(b),b.html()},getSubprocessData:function(e,t){var i={},a=this.Class.responseSubprocess().subProcesses,o=this.Class.responseSubprocess().subProcPersonalized;if(a&&a.length>0){i.custData=a[e].custData,i.custDataTypes=a[e].custDataTypes;var r=this.Class.responseSubprocess().CustFields[t];i.custFields=r[Object.keys(r)[0]],i.displayName=a[e].displayName}else o&&Object.keys(o).length>0&&(i.custData=o[0].subProcesses[e].custData,i.custDataTypes=o[0].subProcesses[e].custDataTypes,i.custFields=o[0].CustFields[0],i.displayName=o[0].subProcesses[e].displayName);return i},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses.data",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses.data]),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.events",{},{init:function(e,t,i){this._super(e,t,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-events":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.events").concat("#project-events-wrapper")})},renderContent:function(){var e=this.getTemplate("project-events");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var i=this,a=t.args,o=i.getContent().empty();i.params=a,$.when(i.getArgsTemplate(a)).done(function(e){i.getTemplate("project-events").render($.extend(a,e)).appendTo(o),$(".list-events li.event a",o).on("click",$.proxy(i.onClickGoEvent,i)),i.initializeTooltip(".list-events li")})},getArgsTemplate:function(e){var t=$.Deferred(),i={};if(e.countEvents>=1)for(var a=0;a<e.currentState.length;a++)"true"==e.currentState[a].isEvent&&e.currentState[a].idWorkItem==e.idWorkitem&&(e.countEvents=e.countEvents-1);return i.showEvents=e.countEvents>=1,i.showEvents?$.when(this.callSummaryCaseEvents(e.idCase)).done(function(a){e.showEvents=a.events.length>=1,e.showEvents&&(i.events=[],a.events.forEach(function(e){i.events.push($.extend(e[Object.keys(e)[0]],{idWorkFlow:a.idWorkFlow}))})),t.resolve(i)}):t.resolve(i),t.promise()},onClickGoEvent:function(e){e.preventDefault();var t=this;$.when(bizagi.util.autoSave()).done(function(){t.routingExecute($(e.target).closest("li"))})},callSummaryCaseEvents:function(e){var t=$.Deferred();return $.when(this.dataService.summaryCaseEvents({idCase:e})).done(function(e){t.resolve(e)}),t.promise()},clean:function(){var e=this;this.params={},e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.events",["workportalFacade","dataService",bizagi.workportal.widgets.project.events],!0),bizagi.workportal.widgets.project.subprocesses.data.extend("bizagi.workportal.widgets.project.subprocesses",{responseSubprocess:function(e){return this._super(e)},auxArrayListSubprocesses:function(e){return this._super(e)}},{init:function(e,t,i){this._super(e,t,i),this.contextsSidebarActivity=i.contextsSidebarActivity,this.loadTemplates({"project-subprocesses":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.subprocesses").concat("#project-subprocesses-wrapper")})},renderContent:function(){return this.content=$("<div></div>"),this.content},postRender:function(){var e=this;e.contextsSidebarActivity.forEach(function(t){e.sub(t,$.proxy(e.updateView,e))})},updateView:function(e,t){var i=this,a=t.args;i.getContent().empty();i.params=a,i.params.idCase>0&&$.when(i.dataService.summarySubProcess({idCase:i.params.idCase})).done(function(e){i.Class.responseSubprocess(e),i.organizeDataForSubprocesses(i.params)})},organizeDataForSubprocesses:function(e){var t=this;if(t.Class.responseSubprocess().showSubProcess){$.each(t.Class.responseSubprocess().subProcesses,function(e){var i=t.Class.responseSubprocess().subProcesses[e].custData;if(i&&i.length)for(var a=0;a<i.length;a+=1)null===i[a]&&(i[a]="")});var i=t.Class.responseSubprocess().subProcesses||t.Class.responseSubprocess().subProcPersonalized;t.Class.auxArrayListSubprocesses([]);for(var a=0;a<Object.keys(i).length;a+=1){var o=i[a];t.Class.auxArrayListSubprocesses({isOpen:o.isOpen,radNumber:o.radNumber,displayName:o.displayName,idCase:o.idCase,indexSubprocess:a,idCustData:o.idCustData}),o.subProcesses&&Object.keys(o).forEach(function(e){t.Class.auxArrayListSubprocesses({isOpen:o[e].isOpen,radNumber:o[e].radNumber,displayName:o[e].displayName,idCase:o[e].idCase,indexSubprocess:a,idCustData:o[e].idCustData})})}t.renderWidget()}},renderWidget:function(){var e=this,t=e.getContent();e.getTemplate("project-subprocesses").render({auxArrayListSubprocesses:e.Class.auxArrayListSubprocesses()}).appendTo(t),$(".list-subprocesses a",t).on("click",$.proxy(e.onClickGoSubprocess,e)),e.initializeTooltip(".list-subprocesses li")},onClickGoSubprocess:function(e){e.preventDefault();this.routingExecute($(e.target).closest("li"))},clean:function(){var e=this;e.params={},e.pluginTooltip=null,e.contextsSidebarActivity.forEach(function(t){e.unsub(t,$.proxy(e.updateView,e))})}}),bizagi.injector.register("bizagi.workportal.widgets.project.subprocesses",["workportalFacade","dataService",bizagi.workportal.widgets.project.subprocesses]),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityMap",{},{init:function(e,t,i){this.radNumber=i.radNumber,this._super(e,t,i),this.loadTemplates({"project-activityMap":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activityMap").concat("#project-activityMap-wrapper")})},renderContent:function(){var e=this.getTemplate("project-activityMap");return this.content=e.render({}),this.content},postRender:function(){var e=this;e.sub("HOME",$.proxy(e.updateView,e)),e.sub("OVERVIEW",$.proxy(e.updateView,e)),e.sub("COMMENTS",$.proxy(e.updateView,e)),e.sub("PROCESSMAP",$.proxy(e.updateView,e)),e.sub("LOG",$.proxy(e.updateView,e)),e.sub("PLANCREATE",$.proxy(e.updateView,e)),e.sub("PLANCOMMENTS",$.proxy(e.updateView,e))},updateView:function(e,t){var i=t.args,a=this.getContent().empty(),o={actualState:""};i.currentState[0]&&(o.actualState=i.currentState[0].state),this.getTemplate("project-activityMap").render($.extend(i,o)).appendTo(a),this.params=i}}),bizagi.injector.register("bizagi.workportal.widgets.project.activityMap",["workportalFacade","dataService",bizagi.workportal.widgets.project.activityMap],!0),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activityMap.tooltip",{},{init:function(e,t,i){this._super(e,t,i),this.loadTemplates({"project-tooltip":bizagi.getTemplate("bizagi.workportal.desktop.widget.activityMap.tooltip").concat("#project-processmap-tooltip")}),this.cache={},this.radNumber=i.radNumber},renderContent:function(){},postRender:function(){this.dateFormat=this.getResource("dateFormat")+" "+this.getResource("timeFormat")},configureHandlers:function(e,t){e.find(".ui-bizagi-wp-project-processmap-process").on("click",$.proxy(this.onProcess,this,t)),e.find(".ui-bizagi-wp-project-processmap-tooltip-title").on("click",$.proxy(this.onIdCase,this,t))},onProcess:function(e,t){this.showGraphicQuery(e)},onIdCase:function(e,t){var i=$(t.currentTarget).data("idcase"),a=$(t.currentTarget).data("idworkitem"),o=$(t.currentTarget).data("idtask"),r=$(t.currentTarget).data("idworkflow");this.publish("executeAction",{action:bizagi.workportal.actions.action.BIZAGI_WORKPORTAL_ACTION_ROUTING,idCase:i,idWorkItem:a,idTask:o,idWorkflow:r})},bindTooltip:function(e){var t=this;t.tooltipClass=e.tooltipClass,e.$container.tooltip({items:e.items,content:function(i){if(!(e.$container.data("clicked")||!1)){if("activityMap"==e.diagram){if(!$(this).is("circle"))return;if(this.className.baseVal.indexOf("activity-map-activity-highlight")<0)return;$.when(t.getActivityMapTooltipContent($(this))).done(function(e){i(e)})}else{var a=t.getSubprocessTooltipContent($(this));i(a)}return"loading.."}},open:function(e,t){for(var i=0;i<$(".ui-tooltip").length-1;i++)$("#"+$(".ui-tooltip")[i].id).remove()},show:{duration:60,effect:"none"},tooltipClass:t.tooltipClass,hide:{delay:60,duration:60},position:{my:"left+20 top+20"},close:function(e,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(120,1)},function(){$(this).fadeOut(20,function(){$(this).remove()})})}})},getActivityMapTooltipContent:function(e){var t=this,i=new $.Deferred,a=e.data("guidWorkitem"),o={guidWorkitem:a,gqData:{idCase:e.data("idCase"),idWorkflow:e.data("idWorkflow")}};if(t.guidWorkitem=a,t.isCached(o.guidWorkitem)){var r=t.cache[o.guidWorkitem];i.resolve(t.buildContent(r,o.gqData))}else $.when(t.dataService.getActivitySummary(o)).done(function(e){i.resolve(t.buildContent(e,o.gqData)),t.appendToCache(o.guidWorkitem,e)});return i.promise()},getSubprocessTooltipContent:function(e){var t={gqData:{idCase:e.data("idcase"),idWorkflow:e.data("idworkflow")}},i={endDate:e.data("enddate"),startDate:e.data("startdate"),process:e.data("process"),idCase:e.data("idcase")};return this.buildContent(i,t.gqData)},appendToCache:function(e,t){this.cache[e]=t},isCached:function(e){return void 0!==this.cache[e]},buildContent:function(e,t){var i=this,a=$("<div></div>"),o=i.getTemplate("project-tooltip"),r=void 0!==e.assigneeName;return e.assignee=r,e.radNumber=i.radNumber,e.idWorkflow=t.idWorkflow,e.idTask=e.idTask||0,e.idWorkitem=e.idWorkItem||0,e.graphicQuery=bizagi.menuSecurity.GraphicQuery,a=o.render(e),$("."+i.tooltipClass).html(a),bizagi.util.formatInvariantDate(a,i.dateFormat),i.configureHandlers(a,t),a}}),bizagi.workportal.widgets.widget.extend("bizagi.workportal.widgets.project.activity.description",{},{init:function(e,t,i){this._super(e,t,i),i=i||{},this.loadTemplates({"project-activity-description":bizagi.getTemplate("bizagi.workportal.desktop.widget.project.activity.description").concat("#project-activity-description")})},renderContent:function(){var e=this,t=e.getTemplate("project-activity-description"),i=e.getWorkitemDescription();return e.content=i?t.render({description:i}):$("<div />"),e.content},postRender:function(){},getWorkitemDescription:function(){for(var e=this.params||{},t=e.idWorkitem||0,i=e.currentState||[],a="",o=0;o<i.length;o++)if(t==i[o].idWorkItem){a=i[o].tskDescription;break}return a},clean:function(){}}),bizagi.injector.register("bizagi.workportal.widgets.project.activity.description",["workportalFacade","dataService",bizagi.workportal.widgets.project.activity.description],!0);
//# sourceMappingURL=../../../../Maps/desktop/processmap.desktop.production.js.map
