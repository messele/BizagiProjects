!function(t){function i(e,t,i){var n=r(e,t,i),a=n.tabsMetaInfo,o=n.tabMetaInfo,s=0;if(a&&o){var l="rtl"===i?a.scrollLeftNormalized+a.clientWidth-a.scrollWidth:a.scrollLeft;s=o.left-a.left+l}return{left:s,width:o?o.width:0}}function r(t,i,r){var n=void 0;if(t){var a=t.getBoundingClientRect();n={clientWidth:t?t.clientWidth:0,scrollLeft:t?t.scrollLeft:0,scrollLeftNormalized:t?function(t,i){var r=t.scrollLeft;if("rtl"!==i)return r;var n=function(e){if(!e||!window.document.body)return"indeterminate";var t=window.document.createElement("div");t.appendChild(document.createTextNode("ABCD")),t.dir="rtl",t.style.fontSize="14px",t.style.width="4px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.overflow="scroll",document.body.appendChild(t),type="reverse",t.scrollLeft>0?type="default":(t.scrollLeft=1,0===t.scrollLeft&&(type="negative"));return document.body.removeChild(t),type}(t);if("indeterminate"===n)return Number.NaN;switch(n){case"negative":return e.scrollWidth-e.clientWidth+r;case"reverse":return e.scrollWidth-e.clientWidth-r}return r}(t,r):0,scrollWidth:t?t.scrollWidth:0,left:a.left,right:a.right}}var o=void 0;return t&&!1!==i&&(o=i.getBoundingClientRect()),{tabsMetaInfo:n,tabMetaInfo:o}}t.fn.material_bizagi_tabs=function(e,n){var a=t.extend({},t.fn.material_bizagi_tabs.defaults,e),o={index:0,tabs:[],$el:void 0,$active:void 0,$active_content:void 0,init:function(e,n){var o,s=this,l=t(">ul.bz-tabs",e),d=s.$el=t(e);function u(e,t){if(void 0!==t){var n=i(l.get(0),e.get(0),a.direction);t.css("left",n.left).css("width",n.width)}var o=scrollSelectedIntoView(l.get(0),e.get(0),a.direction);l.scrollLeft(o),l.trigger("updatePositions",r(l.get(0),e.get(0),a.direction))}s.index=a.active_index_tab,t(">li.bz-tab",l).each(function(e,i){e===a.active_index_tab?(s.$active=t(this),s.$active.addClass("active")):t(t(i).data("reference"),d).hide(),s.tabs.push({index:e,element:i})}),s.$active_content=t(s.$active.data("reference"),d),u(s.$active),l.on("click","> li.bz-tab",function(e){if(e.stopPropagation(),void 0===o){o=t("<li class='bz-indicator-bar'></li>");var r=i(l.get(0),s.$active.get(0),a.direction);o.css("left",r.left).css("width",r.width),o=l.prepend(o).find(".bz-indicator-bar")}s.$active.removeClass("active"),s.$active_content.hide(),s.$active=t(this);var n=s.$active.data("reference");s.index=s.$active.data("index"),s.$active_content=t(n,d),s.$active.addClass("active"),u(s.$active,o),l.trigger("updateActive",{index:s.index}),s.$active_content.show(),e.preventDefault()})},getActiveTab:function(){return{index:this.index,tab:this.$active,contantTab:this.$active_content}},moveToNextTab:function(){var e=this.index+1<this.tabs.length?this.index+1:0;this.tabs[e].element.click()},refreshPositions:function(){this.tabs[this.index].element.click()}};return"string"==typeof e&&e?(void 0===(o=t(this).data("base"))&&console.error("this plugin is has not been initialized!!"),o[e](n)):this.each(function(){o.init(this,n),t(this).data("base",o)})},t.fn.material_bizagi_tabs.defaults={direction:"ltr",active_index_tab:0},scrollSelectedIntoView=function(e,t,i){var n=r(e,t,i),a=n.tabsMetaInfo,o=n.tabMetaInfo;if(o&&a){var s=void 0;return o.left<a.left?s=a.scrollLeft+(o.left-a.left):o.right>a.right&&(s=a.scrollLeft+(o.right-a.right)),s}}}($),function(e){e.fn.mfb=function(t){"use strict";var i=this,r={element:e("<div class='mfb-component__overlay'></div>"),opened:!1};(t=t||{}).buttons=t.buttons||[],t.activePrincipalButton=t.activePrincipalButton||!1,t.placement=void 0!==t.placement&&-1!==["mfb-component--tl","mfb-component--tr","mfb-component--bl","mfb-component--br"].indexOf(t.placement)?t.placement:"mfb-component--br",t.efect=void 0!==t.efect&&-1!==["mfb-zoomin","mfb-slidein","mfb-slidein-spring","mfb-fountain"].indexOf(t.efect)?t.efect:"mfb-slidein",t.clickHoverOpt=t.clickHoverOpt||"click",t.toggleMethod=t.toggleMethod||"data-mfb-toggle",t.menuState=t.menuState||"data-mfb-state",t.menuStateValue=t.menuStateValue||"closed",t.isOpen=t.isOpen||"open",t.isClosed=t.isClosed||"closed",t.mainButtonClass=t.mainButtonClass||"mfb-component__button--main",t.restingIcon=t.restingIcon||"mo-icon bz-plus",t.activeIcon=t.activeIcon||"mo-icon bz-cross",e(this).children(".mfb-component-holder").remove();var n,a;function o(e,t,i){for(var r=0,n=e.length;r<n;r++)e[r].addEventListener(t,i,!1)}function s(e,t){t?(e.siblings().addClass("mfb-component__overlay--blur"),e.closest("[data-role]").siblings().addClass("mfb-component__overlay--blur")):(e.siblings().removeClass("mfb-component__overlay--blur"),e.closest("[data-role]").siblings().removeClass("mfb-component__overlay--blur"))}var l=kendo.template('<ul class="mfb-component-holder #: data.placement # #: data.efect #" #: data.toggleMethod #="#: data.clickHoverOpt #" #: data.menuState#="#: data.menuStateValue #">   <li class="mfb-component__wrap">      #if (data.activePrincipalButton && data.buttons.length >= 1){#       <a #if(typeof data.buttons[0].label !== "undefined"){# data-mfb-label="#: data.buttons[0].label #"#}# class="mfb-component__button--main">           <i class="mfb-component__main-icon--resting mfb-icon-font bz-#:data.restingIcon#"></i><i class="mfb-component__main-icon--active mfb-icon-font bz-#:data.buttons[0].icon#"></i>       </a>       #}else{#       <a #if(typeof data.label !== "undefined"){# data-mfb-label="#: data.label #"#}# class="mfb-component__button--main">           <i class="mfb-component__main-icon--resting mfb-icon-font bz-#:data.restingIcon#"></i><i class="mfb-component__main-icon--active mfb-icon-font bz-#:data.activeIcon#"></i>       </a>       #}#       # if(data.buttons.length > 0){#       <ul class="mfb-component__list">           #for(var i = (data.activePrincipalButton ? 1 : 0), len = data.buttons.length; i< len; i++){#           <li data-id="#: data.buttons[i].id #">               <a href="#: data.buttons[i].link #" data-index="#: i#" #if(typeof data.buttons[i].label !== "undefined"){# data-mfb-label="#: data.buttons[i].label #"#}# class="mfb-component__button--child">                  <i class="mfb-component__child-icon mfb-icon-font bz-#: data.buttons[i].icon #"></i>               </a>           </li>           #}#       </ul>       #}#   </li></ul>',{useWithBlock:!1})(t);"prepend"===t.position?this.prepend(l):this.append(l);var d=t.buttons.length>0?function(i){for(n=i.target;n&&!n.getAttribute(t.toggleMethod);)if(!(n=n.parentNode))return;if(a=n.getAttribute(t.menuState)===t.isOpen?t.isClosed:t.isOpen,t.activePrincipalButton&&"open"!==a){var o=t.buttons[0];t.click&&t.click(i,e.extend(o,{principal:!0}),this),s(e(n),!0)}"open"!==a||r.opened?(r.element.remove(),s(e(n),!1)):(r.element.appendTo(n).bind("click",function(){this.remove(),r.opened=!1,n.setAttribute(t.menuState,"close"),s(e(n),!1)}),s(e(n),!0)),r.opened=!r.opened,n.setAttribute(t.menuState,a)}:function(e){t.click&&(e.preventDefault(),t.click(e,{principal:!0},this))};o(e("["+t.toggleMethod+"='"+t.clickHoverOpt+"'] ."+t.mainButtonClass,this),"click",d),o(e(".mfb-component__button--child",this),"click",function(r){var n=e(this).data("index"),a=t.buttons[n];e(".mfb-component__overlay",i).click(),t.click&&(r.preventDefault(),t.click(r,e.extend(a,{principal:!1}),this))})}}(jQuery),function(e){e.fn.bz_navigation_buttons=function(t){var i=(t=t||{}).buttons||[],r=t.isDesign||!1,n=t.lastActionExecuted||!1,a=t.allowAddButtons||!1,o=this;o.empty(),o.addClass("bz-buttons--navigation");var s=e('<ul class="bz-buttons--container"></ul>');s.appendTo(o);return function(){for(var t=2,l=0;l<i.length;l++)!function(i){var n=i.properties.caption,a=e('<li class="bz-button--container"><button class="bz-btn">{0}</button></li>'.replace("{0}",n)),o=0;a.on("click",function(){s.trigger("onSelectButton",{$element:a,button:i});var e=s.get(0),t=e.clientWidth,n=r?35:0;e.scrollWidth>t&&(o>t?e.scrollLeft=o-t+n:o-e.scrollLeft<e.scrollLeft&&(e.scrollLeft=o-(e.scrollLeft+n)))}).appendTo(s),o=t=t+a.get(0).offsetWidth+2}(i[l].button);if(r){var d=e('<div class="bz-button--add"><svg class="ico_16x16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-plus"></use></svg></div>');a&&(d.click(function(){s.trigger("onAddButton")}),d.appendTo(o));var u=s.get(0),p=d.get(0).scrollWidth,c=o.get(0).scrollWidth,g=u.scrollWidth,h=e('<div class="bz-button--rigth"><svg class="ico_16x16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-arrow-rigth"></use></svg></div>'),f=g>c-p;f&&h.insertAfter(s),h.on("click",function(){u.scrollLeft+=40});var m=!1,b=e('<div class="bz-button--left"><svg class="ico_16x16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-arrow-left"></use></svg></div>');b.on("click",function(){u.scrollLeft-=40}),s.on("scroll",function(e){var t=e.target,i=t.scrollWidth-t.clientWidth,r=t.scrollLeft;0===r&&m&&(m=!1,b.detach()),f&&r===i&&(f=!1,h.detach()),!m&&r>0&&(b.prependTo(o),m=!0),!f&&r<i&&(f=!0,h.insertAfter(s))}),"addButton"===n&&f&&(u.scrollLeft=u.scrollWidth-u.clientWidth)}}(),s}}(jQuery),function(e){var t;if(void 0===t){var i=e('<div style="background:none;display:none;"/>').appendTo("body");t=i.css("backgroundColor"),i.remove()}e.fn.rippleEffect=function(i){var r=e.extend({},e.fn.rippleEffect.defaults,i);return this.each(function(){e(this).on("click",function(i){var n,a,o,s,l,d,u,p,c=e(this),g=i.type;function h(){return""!=r.inkColor?r.inkColor:function(i,r){var n,a,o,s;l=i,d=r,n=function e(i){return i.css("backgroundColor")==t?i.is("body")?d||t:e(i.parent()):i.css("backgroundColor")}(l),a=e.fn.rippleEffect.colorToHex(n),s=(o=e.fn.rippleEffect.getLuminationValue(a))<=239?o<=70?e.fn.rippleEffect.getColorLuminance(a,.8):e.fn.rippleEffect.getColorLuminance(a,.2):e.fn.rippleEffect.getColorLuminance(a,-.15);var l,d;return s}(p,r.inkDefaultColor)}if(p=c,""!=r.appendInkTo&&(p=c.closest(r.appendInkTo)),0==p.find("."+r.inkClass).length&&p.append('<span class="'+r.inkContainerClass+'"><span class="'+r.inkClass+'"></span></span>'),(u=p.find("."+r.inkContainerClass+" >  ."+r.inkClass)).removeClass("animate"),!u.height()&&!u.width()){if(l=Math.max(p.outerWidth(),p.outerHeight()),void 0!==c.data("ripple")&&""!=c.data("ripple"))d=c.data("ripple");else if(void 0!==c.data("ripple-getcolorfromid")&&""!=c.data("ripple-getcolorfromid")){var f=c.data("ripple-getcolorfromid");d=e(f).length>0?e(f).css("background-color"):h()}else d=h();u.css({height:l,width:l,"background-color":d})}if("click"===g)n=i.pageX,a=i.pageY;else if("touchstart"===g){var m=i.originalEvent.touches[0]||i.originalEvent.changedTouches[0];n=m.pageX,a=m.pageY}o=n-p.offset().left-u.width()/2,s=a-p.offset().top-u.height()/2,u.css({top:s+"px",left:o+"px"}).addClass("animate"),setTimeout(function(){u.removeClass("animate")},400)})})},e.fn.rippleEffect.defaults={inkContainerClass:"ripple",inkClass:"ink",inkDefaultColor:"#F0F0F0",inkColor:"",appendInkTo:""},e.fn.rippleEffect.getLuminationValue=function(e){e=e.substring(1);var t=parseInt(e,16);return.2126*(t>>16&255)+.7152*(t>>8&255)+.0722*(t>>0&255)},e.fn.rippleEffect.getColorLuminance=function(e,t){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var i,r,n="#";for(r=0;r<3;r++)i=parseInt(e.substr(2*r,2),16),n+=("00"+(i=Math.round(Math.min(Math.max(0,i+i*t),255)).toString(16))).substr(i.length);return n},e.fn.rippleEffect.colorToHex=function(e){return"#"===e.substr(0,1)?color:(e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""}}(jQuery),function(e){e.widget("ui.bizagi_grid_tablet",e.ui.bizagi_grid,{_init:function(){this._super(),this.isOfflineForm=void 0!==this.options.isOfflineForm&&bizagi.util.parseBoolean(this.options.isOfflineForm)},attachHandlers:function(){var t=this;t._getComponent("pager").find("ul li button").bind("click",function(){var i=parseInt(e(this).attr("data-page-number"));i&&t.changePage(i)}),t._getComponent("dynamicPager").find("input").bind("click",function(){t.selectDynamicPager()}),t._getComponent("columns").find(".bz-tablet-grid__label").bind("click",function(){if(!t.isOfflineForm){var i=e(this).attr("data-column-index");t.sortBy(i)}}),t._getComponent("buttons").find("[data-action]").bind("click",function(){"totalizer"===e(this).attr("data-action")?t.totalizer():(t.processAction(e(this).attr("data-action")),t.unselectRow())}),t._getComponent("rowButtons").find("[data-action]").bind("click",function(){t.processAction(e(this).attr("data-action")),t.unselectRow()}),this.isOfflineForm?t._getComponent("rows").on("click",".bz-tablet-grid__cell-more [data-action=more]",function(i){var r=e(i.target).parents("[data-bizagi-component=cells]");if(r&&r.hasClass("bz-tablet-grid__row")){var n=r.attr("data-business-key");bizagi.util.parseBoolean(r.attr("data-new-row"))||!1?t.onRemoveNewRow(n):t.processAction("remove",{key:n})}}):(t._getComponent("rows").find("tr").bind("click",function(i){var r=e(i.target).closest(".bz-tablet-grid__cell");if(i.stopPropagation(),r&&r.hasClass("bz-tablet-grid__cell")){var n=e(this).attr("data-key"),a=e(this).attr("data-business-key");t.selectRow(n,a)}}),t._addColumnActions())},totalizer:function(){this.options.totalData()},onRowSelected:function(){e.ui.bizagi_grid.prototype.onRowSelected.apply(this,arguments),this._showRowButtons()},onRowUnselected:function(){e.ui.bizagi_grid.prototype.onRowUnselected.apply(this,arguments),this._hideRowButtons()},getCell:function(t,i,r){var n=this._getComponent("rows").find("[data-business-key="+t+"]"),a="";return a=r<4?e("td",e(n))[r+1]:e("td:visible",e(n))[r],e(a)},_canShowButtons:function(){var e=this.options.actions;return this.isOfflineForm?e.add||e.remove||e.edit||e.inlineAdd:e.add},drawPager:function(){for(var t=this,i=t.options,r=[],n=1;n<=t.data.total;n++)r.push({number:n,active:n==t.data.page});var a={renderPages:t.data.page<3||t.data.page>t.data.total-2?[]:[t.data.page-1,t.data.page,t.data.page+1],pages:r,pagination:{totalPages:t.data.total,currentPage:t.data.page}};return e.fasttmpl(i.template.pager,a)},_canShowRowButtons:function(){var e=this.options.actions;return!this.isOfflineForm&&(e.edit||e.details||this.options.columns.length>this.options.maxColumns)},_showRowButtons:function(){window.document;this.element.find("[data-bizagi-component=rows] tr[data-key="+this.selectedRow+"]").addClass("ui-bizagi-state-selected")},_hideRowButtons:function(){var t=this;(e.ui.bizagi_grid.prototype.onRowUnselected.apply(t,arguments),t._getComponent("rows").find("tr[data-key="+t.selectedRow+"]").removeClass("ui-bizagi-state-selected"),t.isOfflineForm)||t._getComponent("rowButtons").hide()},getNewRowKeys:function(t){return t=t||this._getComponent("rows").find("[data-new-row=true]"),e.map(t,function(t,i){return e(t).data("business-key")})},processAction:function(t){e.ui.bizagi_grid.prototype.processAction.apply(this,arguments),"save"===t&&this.onSaveAddedRows(),"cancel"===t&&this.onCancelEdition()},isNewRecord:function(t){var i=this._getComponent("rows");return!(!i||(t=i.find("[data-business-key='"+t+"']"),!e(t).data("new-row")))},addInlineRow:function(){var t=this;t._triggerHandler("beforeInlineAdd");var i=t.drawRow(t.createAddRowData(),!0),r=e(i);t.postRenderRow(r),t._getComponent("rows").append(r);var n=t._getComponent("buttons");t.isOfflineForm?(n.find("[data-action=save]").removeClass("bz-tablet-grid__buttons--hidden"),n.find("[data-action=cancel]").removeClass("bz-tablet-grid__buttons--hidden")):(n.find("[data-action=save]").css("display","inline-block"),n.find("[data-action=cancel]").css("display","inline-block")),0===t.data.rows.length&&(t._getComponent("table").show(),t._getComponent("emptyTable").hide()),t._triggerHandler("afterInlineAdd")},createAddRowData:function(){var t=this,i=t.options,r=[];return e.each(i.columns,function(e){if(e===t.columnKeyIndex){var i=Math.ceil(1e5*Math.random());r.push(i)}else r.push(null)}),r},onAddRow:function(){if(this.options.actions.add)return this.options.actions.inlineAdd?this.addInlineRow():this._triggerHandler("addRow")},onCancelEdition:function(){var e=this,t=e._getComponent("rows").find("[data-new-row=true]"),i=e._getComponent("rows").find("[data-new-row=false]");t.detach();var r=e._getComponent("buttons");return e.isOfflineForm?(r.find("[data-action=save]").addClass("bz-tablet-grid__buttons--hidden"),r.find("[data-action=cancel]").addClass("bz-tablet-grid__buttons--hidden")):(r.find("[data-action=save]").hide(),r.find("[data-action=cancel]").hide()),0===i.length&&(e._getComponent("table").hide(),e._getComponent("emptyTable").show()),e._triggerHandler("cancelEdition",{keys:e.getNewRowKeys(t)})},onSaveAddedRows:function(){var t=this,i=t.getNewRowKeys(),r=t._getComponent("buttons");if(i.length>=1&&t.isValid()){var n=t._getComponent("rows");return t.isOfflineForm?(e.each(i,function(t,i){var r=n.find("[data-business-key='"+i+"']");e(r).attr("data-new-row","false")}),r.find("[data-action=save]").addClass("bz-tablet-grid__buttons--hidden"),r.find("[data-action=cancel]").addClass("bz-tablet-grid__buttons--hidden"),t._triggerHandler("saveAddedRows",{keys:i}),!0):(r.find("[data-action=save]").hide(),r.find("[data-action=cancel]").hide(),t._triggerHandler("saveAddedRows",{keys:i}),t._triggerHandler("removeNewRecords",{keys:i}))}return!0},_addColumnActions:function(){var t=this,i=[];(t.options.actions.details||t.options.columns.length>t.options.maxColumns)&&i.push({name:bizagi.localization.getResource("render-collection-navigator-details-form"),fn:function(i){var r=e(i).parents("[data-bizagi-component=cells]").attr("data-business-key");t.options.actions.details?t.processAction("details",{key:r}):t.processAction("more",{key:r})}}),t.options.actions.edit&&i.push({name:bizagi.localization.getResource("render-grid-edit-label"),fn:function(i){var r=e(i).parents("[data-bizagi-component=cells]").attr("data-business-key");t.processAction("edit",{key:r})}}),t.options.actions.remove&&i.push({name:bizagi.localization.getResource("render-ecm-confirm-bt-delete"),fn:function(i){var r=e(i).parents("[data-bizagi-component=cells]").attr("data-business-key");t.processAction("remove",{key:r})}}),t._getComponent("rows").find("[data-action=more]").overflowMenu({items:i})},onRemoveNewRow:function(e){var t=this,i=t._getComponent("buttons"),r=t._getComponent("rows").find("tr[data-business-key="+e+"]"),n=t._getComponent("rows").find("[data-new-row=false]"),a=t._getComponent("rows").find("[data-new-row=true]");return r.detach(),1===a.length&&(i.find("[data-action=save]").addClass("bz-tablet-grid__buttons--hidden"),i.find("[data-action=cancel]").addClass("bz-tablet-grid__buttons--hidden")),0===n.length&&(t._getComponent("table").hide(),t._getComponent("emptyTable").show()),t._triggerHandler("cancelEdition",{keys:t.getNewRowKeys(r)})},_replaceElement:function(e,t,i){return e.replace(new RegExp("{{element "+t+"}}","g"),i)}})}(jQuery),function(e){e.fn.bztabs=function(t){var i=e(this);(t=t||{}).activeTab=t.activeTab||0,t.tabNumber=t.tabNumber||1;var r=t.activate&&"function"==typeof t.activate?t.activate:function(){},n=(t.beforeActivate&&"function"==typeof t.beforeActivate&&t.beforeActivate,i.find(">div.bz-bizagi-container-tap-popup").hide()),a=n.children().length,o=e("<div class='bz-header_select'></div>"),s=t.tabNumber>a?a:t.tabNumber,l=Math.floor(100/Number(s));n.children().each(function(e,t){o.append("<div class='bz-wp-tabs-ui bz-wp-tabs-item' data-index='"+e+"' data-reference-tab='"+t.getAttribute("data-reference-tab")+"'><span>"+t.textContent+"</span></div>")}),o.find("> .bz-wp-tabs-ui").css("width",l+"%"),o.append("<div class='bz-wp-tabs-arrow-container'><div class='bz-cm-icon bz-mo-icon bz-plus'></div></div>"),i.prepend(o);var d=i.find("> .bz-bizagi-container-tap-popup > .bz-container-items-tabs").eq(t.activeTab);e(e(d).data("reference-tab"),i).addClass("childrenActive"),d.addClass("tabSelected");var u=e(".bz-wp-tabs-ui:nth-child("+(t.activeTab+1)+")",o).addClass("tabSelected"),p=l+(100-l*s);function c(){t.tabNumber<a?(e(".bz-wp-tabs-arrow-container",i).first().addClass("show-pluss"),o.addClass("show-pluss"),u.trigger("click",{origin:"popUp"})):(e(".bz-wp-tabs-arrow-container",i).removeClass("show-pluss"),o.removeClass("show-pluss"),o.find("> .bz-wp-tabs-ui:last").addClass("bz-wp-no-border"))}function g(t,a){if((a=a||{}).origin=a.origin||"header",t.stopPropagation(),t.preventDefault(),!e(this).hasClass("tabSelected")||"popUp"===a.origin){var s,d,c,g=t.currentTarget.getAttribute("data-reference-tab"),h=e(g,i);u=e(t.currentTarget),i.find(">div.childrenActive").removeClass("childrenActive"),h.addClass("childrenActive"),o.find(">div.tabSelected").removeClass("tabSelected").css("width",l+"%"),"block"===n.css("display")&&n.toggle(),a.origin&&"popUp"===a.origin&&(u=e("[data-reference-tab='"+g+"']",o),s=g,d=o.find(".bz-wp-tabs-ui"),c=!0,d.each(function(e,t){s!==t.getAttribute("data-reference-tab")&&c?(o.remove("[data-reference-tab='"+s+"']"),o.append(t)):c=!1})),u.addClass("tabSelected").css("width",p+"%"),r(t,a)}}u.css("width",p+"%"),void 0!==t.domIncluded?e.when(t.domIncluded).done(function(){c()}):c(),i.find(".bz-wp-tabs-arrow-container").first().bind("click",function(t){var i=o.innerWidth()-29,r=0;e(".bz-container-items-tabs",n).removeClass("show"),o.find(".bz-wp-tabs-ui").each(function(t,a){(r+=e(":first-child",a).outerWidth())>i&&n.children().each(function(t,i){if(i.textContent===a.textContent)return e(i).addClass("show"),e(".cell.bz-container-items-tabs").css("border-bottom",""),void e(".cell.bz-container-items-tabs.show").last().css("border-bottom","none")})}),t.stopPropagation(),t.preventDefault(),n.toggle()}),e(">div.cell",n).bind("click",function(e){g(e,{origin:"popUp"})}),e(".bz-wp-tabs-ui",o).bind("click",g),o.bind("resizeHeader",function(){c()})}}(jQuery),$.Class.extend("bizagi.rendering.element",{ELEMENT_TYPE_CONTAINER:1,ELEMENT_TYPE_RENDER:2,ELEMENT_TYPE_COLUMN:3},{init:function(e){this.renderFactory=e.renderFactory,this.dataService=e.dataService,this.parent=e.parent,this.resources=bizagi.localization,this.observableElement=$("<div />"),this.disposed=!1,this.initializeData(e.data),this.subscribers=[]},initializeData:function(e){this.properties={},e&&e.properties&&(this.properties=e.properties),this.properties.xpathContext=this.getXpathContext(),this.properties.idPageCache=this.getPageCache()},getXpathContext:function(){return null!=this.parent&&"function"==typeof this.parent.getXpathContext?this.parent.getXpathContext():""},getPageCache:function(){return null!=this.parent&&"function"==typeof this.parent.getPageCache?this.parent.getPageCache():""},getFormContainer:function(){if(void 0!==this.parent)return this.parent.getFormContainer()},getResource:function(e){return this.resources.getResource(e)},getElementType:function(){},resize:function(e){},focus:function(){if(this.properties.required){var e=$("#ui-bizagi-wp-app-render-form-content");bizagi.util.isScrolledIntoView(this.element,e)||$(this.element).attr("tabindex",-1).focus(),this.element&&this.element.effect("highlight",2e3)}this.parent&&"function"==typeof this.parent.focus&&this.parent.focus()},triggerGlobalHandler:function(e,t){return this.disposed?null:this.parent?this.parent.triggerGlobalHandler(e,t):null},trigger:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.trigger(e,t):null},triggerHandler:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.triggerHandler(e,t):null},bind:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.bind(e,t):(this.subscribers.push({event:e}),null)},unbind:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.unbind(e,t):null},one:function(e,t){return this.disposed?null:this.observableElement?this.observableElement.one(e,t):(this.subscribers.push({event:e}),null)},getRenderedElement:function(){},getMode:function(){if(this.parent)return this.parent.getMode()},getParams:function(){if(this.parent)return this.parent.getParams()},getFormType:function(){return this.getFormContainer().properties.type||"form"},ready:function(){},isReadyToSave:function(){},getCustomHandlers:function(){return null},dispose:function(){var e=this;e.disposed=!0,setTimeout(function(){null!=e.subscribers&&$.each(e.subscribers,function(t,i){e.unbind(i.event)}),delete e.subscribers,e.observableElement&&e.observableElement.off(),bizagi.util.dispose(e)},bizagi.override.disposeTime||50)},isDisposed:function(){return this.disposed},processFailMessage:function(e){var t=this.getFormContainer(),i=bizagi.util.isOfflineForm({context:this});if("CustomMessageException"===e.errorType){t.validationController.clearValidationMessages();var r=bizagi.localization.getResource(e.message);t.validationController.showErrorMessage(r)}else if("InvalidCaseStateException"===e.errorType){var n=t.getParams();t.validationController.clearValidationMessages(),t.container.trigger("routing",{idCase:n.idCase||bizagi.context.idCase})}else{var a=(e="string"==typeof(e=e||{})?JSON.parse(e):e).type||"error",o=e.code||"code";if(e=e.responseText||e.message||e,"not-processed"===a)return;if("not-shown"===a)return;if(i&&"AUTH_ERROR"===o)return;t.validationController.clearValidationMessages(),"alert"==a?t.validationController.showAlertMessage(e):t.validationController.showErrorMessage(e)}return e},startLoading:function(){},endLoading:function(){},beforeToRefresh:function(){},afterToRefresh:function(){}}),bizagi.rendering.element.extend("bizagi.rendering.container",{TYPE_QUERY_FORM:"queryForm"},{initializeData:function(e){var t=this;t._super(e);var i=t.properties;i.uniqueId=Math.ceil(1e6*Math.random()),i.editable=void 0===i.editable||bizagi.util.parseBoolean(i.editable),i.visible=void 0===i.visible||bizagi.util.parseBoolean(i.visible),i.orientation=i.orientation||"auto",this.originalProperties=JSON.parse(JSON.encode(i)),this.children=[],this.childrenHash={},e.elements&&$.each(e.elements,function(e,i){i.render?t.createRenderElement(i):i.container?t.createContainerElement(i):i.form&&t.createFormElement(i)})},createRenderElement:function(e){var t,i=this,r=i.properties;0==r.editable&&(e.render.properties.editable=r.editable,"grid"==e.render.properties.type&&(e.render.properties.inlineEdit=!1)),!1===r.required&&(e.render.properties.required=r.required),"duplicate"==e.render.properties.retype&&(t=bizagi.clone(e));var n=i.renderFactory.getRender({type:e.render.properties.type,data:e.render,dataService:i.dataService,parent:i,mode:i.getMode()});i.children.push(n),"duplicate"==e.render.properties.retype&&i.processDuplicateRender(n,t),i.getFormContainer().registerRender(n)},createContainerElement:function(e){var t=this,i=t.properties;0==i.editable&&(e.container.properties.editable=i.editable),!1===i.required&&(e.container.properties.required=i.required);var r=t.renderFactory.getContainer({type:e.container.properties.type,data:e.container,parent:t,dataService:t.dataService,mode:t.getMode(),isDesign:"design"===t.getMode()});t.children.push(r),t.getFormContainer().registerRender(r)},createFormElement:function(e){var t=this,i=t.properties;0==i.editable&&(e.container.properties.editable=i.editable);var r=t.renderFactory.getContainer({type:e.form.properties.type||"form",data:e.form,parent:t,dataService:t.dataService,mode:t.getMode()});t.children.push(r)},getElement:function(){return this.container},getElementsByType:function(e,t){t=t||[];return $.each(this.children,function(i,r){r.properties.type==e&&t.push(r),r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&r.getElementsByType(e,t)}),t},processDuplicateRender:function(e,t){var i=this,r=JSON.parse(JSON.encode(t.render));r.properties.displayName=r.properties.displayName+" "+i.getResource("render-text-duplicate-label-sufix"),r.properties.xpath=r.properties.xpath+".clone",r.properties.isClone=!0;var n=i.renderFactory.getRender({type:r.properties.type,data:r,parent:i,mode:i.getMode()});e.cloneRender=n,i.children.push(n)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_CONTAINER},render:function(){var e,t=this;t.getMode();return e=t.internalRender(),t.applyContainerDefaults(),e.attr("data-container-id",t.properties.id),t.properties.tag&&e.attr("data-tag",t.properties.tag),t.params&&t.params.requestedForm&&e.addClass(t.params.requestedForm),e},internalRender:function(){var e=this.renderContainerHtml(),t=this.container=$(e);return this.postRenderContainer(t),this.container},renderContainerHtml:function(){return this.renderingDeferred=this.renderingDeferred||new $.Deferred,this.renderContainer()},isRendered:function(){return!!this.renderingDeferred&&this.renderingDeferred.promise()},getRenderedElement:function(){return bizagi.util.isEmpty(this.container)&&alert("container hasn't been rendered!"),this.container},applyContainerDefaults:function(){var e=this.properties;e.backgroundColor&&this.changeBackgroundColor(e.backgroundColor),e.visible||this.changeVisibility(e.visible)},changeBackgroundColor:function(e){this.properties.backgroundColor=e,$.each(this.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.changeBackgroundColor(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeBackgroundColor(e)})},changeVisibility:function(e){var t=this.properties;t.visible=bizagi.util.parseBoolean(e),t.visible?this.container.show():this.container.hide()},changeEditability:function(e){this.properties.editable=bizagi.util.parseBoolean(e),$.each(this.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.changeEditability(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.changeEditability(e)})},replaceTag:function(e,t,i){bizagi.util.replaceSelector(e,t,i)},replaceChildrenTag:function(e,t){this.replaceTag(e,".children",t)},replaceChildrenHtml:function(e,t){return e.replace("{{children}}",t)},renderContainer:function(){},postRenderContainer:function(e){var t=this,i=(t.properties,t.getMode());t.renderingDeferred&&t.renderingDeferred.resolve(),t.container=e,t.executeChildrenPostRender(e),"execution"==i&&(t.configureHandlers(),t.applyPlaceHolderPolyfill()),"design"==i&&t.configureDesignView(),"layout"==i&&(t.configureDesignView(),t.configureLayoutView())},applyPlaceHolderPolyfill:function(){var e=window.placeHolderConfig||{};("placeholder"in $("<input>")[0]||"placeHolder"in $("<input>")[0])&&!e.forceApply||Placeholders.enable()},executeChildrenPostRender:function(e){var t=this,i=e.children();$.each(i,function(e,i){i=$(i);var r=Number(i.data("unique-id"));if(r){var n=t.childrenHash[r];if(n){var a=n.getElementType();a==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&n.postRenderElement(i),a==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&n.postRenderContainer(i)}}else t.executeChildrenPostRender(i)})},configureHandlers:function(){},configureDesignView:function(){},configureLayoutView:function(){},renderChildrenHtml:function(){var e=this,t="";return $.each(e.children,function(i,r){var n=r.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(t+=r.renderElement()),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(t+=r.renderContainerHtml()),e.childrenHash[r.properties.uniqueId]=r}),t},collectRenderValues:function(e){this.children&&$.each(this.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValues(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSent()&&i.collectData(e)})},hasChanged:function(e){if((e=e||[]).length)return e;this.children&&$.each(this.children,function(t,i){if(e.length||i.hasChanged(e))return!1})},collectRenderValuesQueryForm:function(e){$.each(this.children,function(t,i){i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValuesQueryForm(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSentQueryForm()&&i.collectDataQueryForm(e)})},firstChild:function(){return this.children[0]},getRenders:function(e,t){return t=t||[],e.indexOf("[")>0&&(e=e.substring(0,e.indexOf("["))),$.each(this.children,function(i,r){r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?r.getRenders(e,t):r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&e==r.properties.xpath&&t.push(r)}),t},getRender:function(e){var t=this.getRenders(e),i=null;return $.each(t,function(e,t){t.properties.editable&&null==i&&(i=t)}),null==i&&$.each(t,function(e,t){i=t}),i},getRendersByXpath:function(e){return this.getRenders(e)},getContainer:function(e){var t;return this.properties.id==e?this:($.each(this.children,function(i,r){if(r.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var n=r.getContainer(e);if(null!=n)return t=n,!1}}),t)},isValid:function(e){return $.each(this.children,function(t,i){i.properties.visible&&(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.isValid(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.isValid(e))}),0==e.length},hasValidGrids:function(e){return $.each(this.children,function(t,i){i.properties.visible&&(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.hasValidGrids(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&void 0!==i.grid&&i.isValid(e))}),0==e.length},ready:function(){return $.when(this.parent.ready(),this.isRendered())},isReadyToSave:function(){var e=$.map(this.children,function(e){return e.isReadyToSave()});return $.when.apply($,e)},getFocus:function(){var e;return $.each(this.children,function(t,i){if(i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER){var r=i.getFocus();bizagi.util.isEmpty(r)||(e=r)}}),e},getCustomHandlers:function(){var e=this.getFormContainer();if(e)return e.getCustomHandlers()},getCustomHandler:function(e){var t=this.getCustomHandlers();if(t)return t[e]},dispose:function(){var e=this;setTimeout(function(){e.children&&$.each(e.children,function(e,t){t.dispose()})},bizagi.override.disposeTime||50),e._super()},refreshContainer:function(e){var t=this,i=t.properties;return t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||e.xpathContext,contexttype:t.properties.contexttype||""})).done(function(e){if(!t.isDisposed()){t.unregisterChildren(),delete t.children,delete t.childrenHash,t.getFormContainer().removeActions(),!1===t.properties.editable&&e.container&&e.container.properties&&(e.container.properties.editable=!1),t.initializeData(e.container);var i=t.container,r=t.render();"tabItem"==t.properties.type&&$(r).addClass("childrenActive"),i.replaceWith(r);var n=e.container&&e.container.actions?e.container.actions:[];t.getFormContainer().refreshActions(n),t.triggerChildrenActions(),t.afterToRefresh()}}).fail(function(e){e=t.processFailMessage(e)}).always(function(){t.endLoading()})},refreshDesignContainer:function(e){var t=this,i=t.properties;if(t.beforeToRefresh(e),$.extend(e.properties,{editable:i.editable,contexttype:i.contexttype||"",idPageCache:i.idPageCache,idRender:i.id,messageValidation:i.messageValidation,uniqueId:i.uniqueId,visible:i.visible,xpath:i.xpath,mode:"design",xpathContext:i.xpathContext||""}),!t.isDisposed()){t.unregisterChildren(),delete t.children,delete t.childrenHash,!1===t.properties.editable&&e.container&&e.container.properties&&(e.container.properties.editable=!1),t.initializeData(e.container);var r=t.container,n=t.render();"tabItem"==t.properties.type&&$(n).addClass("childrenActive"),r&&r.replaceWith(n),t.afterToRefresh()}},beforeToRefresh:function(){for(var e=0;e<this.children.length;e++)this.children[e].beforeToRefresh()},afterToRefresh:function(){for(var e=0;e<this.children.length;e++)this.children[e].afterToRefresh()},triggerChildrenActions:function(){this.getFormContainer();for(var e=this.children,t=0,i=e.length;t<i;t++){var r=e[t],n=r.getElementType();n===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?r.triggerChildrenActions():n===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&r.triggerRenderChange({changed:!1})}},registerActions:function(e){var t=this.getFormContainer();e&&t.actionController.buildActions(e)},unregisterChildren:function(){for(var e=this.getFormContainer(),t=this.children,i=0,r=t.length;i<r;i++){var n=t[i],a=n.getElementType();a===bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?n.unregisterChildren():a===bizagi.rendering.element.ELEMENT_TYPE_RENDER&&e.unregisterRender(n)}},replaceChild:function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){if(t[i].properties.uniqueId==e.properties.uniqueId){t.splice(i,1),t.splice(i,0,e);break}}},getChildById:function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){var n=t[i];if(n.properties.id==e)return n}return null}}),bizagi.rendering.element.extend("bizagi.rendering.render",{postRenderTimeout:0,maxRendersPerScreen:50,rendersExecuted:0,renderOptimization:!1,TYPE_QUERY_FORM:"queryForm",startOptimization:function(){bizagi.rendering.render.postRenderTimeout=500,bizagi.rendering.render.rendersExecuted=0,bizagi.rendering.render.renderOptimization=!1},stopOptimization:function(){bizagi.rendering.render.postRenderTimeout=0,bizagi.rendering.render.rendersExecuted=0,bizagi.rendering.render.renderOptimization=!1}},{initializeData:function(e){var t=this;t._super(e);var i=t.getFormContainer(),r=t.properties;r.included=void 0!==r.included&&bizagi.util.parseBoolean(r.included),r.uniqueId=Math.ceil(1e6*Math.random()),r.displayName=r.displayName||"",r.editable=void 0===r.editable||bizagi.util.parseBoolean(r.editable),r.visible=void 0===r.visible||bizagi.util.parseBoolean(r.visible),r.includedInResult=void 0!==r.includedInResult&&bizagi.util.parseBoolean(r.includedInResult);var n=bizagi.util.normalizeType(r.type);/^hidden$/i.test(n)&&(r.visible=!1),r.required=void 0!==r.required&&bizagi.util.parseBoolean(r.required),r.submitOnChange=void 0!==r.submitOnChange&&bizagi.util.parseBoolean(r.submitOnChange),r.maxLength=r.maxLength||0,r.helpText=bizagi.util.trim(r.helpText)||"",r.textFormat=r.textFormat||{},r.valueFormat=r.valueFormat||{},r.isHidden=void 0!==r.isHidden&&bizagi.util.parseBoolean(r.isHidden),r.visible=!r.isHidden&&r.visible,r.color&&(r.textFormat.color=r.color),r.backgroundColor&&(r.textFormat.backgroundColor=r.backgroundColor),r.required=!!r.editable&&r.required,r.orientation=r.orientation||"auto",r.contexttype=i.params&&i.params.data&&i.params.data.contextType?i.params.data.contextType:"",t.originalProperties={textFormat:{color:r.textFormat.color,backgroundColor:r.textFormat.backgroundColor},valueFormat:{color:r.textFormat.color,backgroundColor:r.textFormat.backgroundColor},visible:r.visible,editable:r.editable,required:r.required,labelAlign:r.labelAlign,valueAlign:r.valueAlign},t.value=void 0!==r.value?r.value:null,t.properties.originalValue=t.value,t.properties.previousValue=t.value,t.calculateInitialLayoutProperties()},calculateInitialLayoutProperties:function(){var e=this,t=e.properties;t.displayType=t.displayType||"normal",t.labelAlign=t.labelAlign||e.getDefaultLabelAlign(t.displayType),t.valueAlign=t.valueAlign||e.getDefaultValueAlign(t.displayType),"rtl"===t.orientation&&(t.labelAlign=e.getRTLAlign(t.labelAlign),t.valueAlign=e.getRTLAlign(t.valueAlign));var i=e.calculateRenderWidth(t.labelWidth,t.valueWidth,t.displayType);t.labelWidth=i.label,t.valueWidth=i.control,"percentage"===t.layoutType&&(t.valueWidth=i.control),0==t.labelWidth&&(t.displayType="value",t.valueWidth=i.control),0==t.valueWidth&&(t.displayType="label"),"userfield"===t.type&&("both"===t.displayType?(t.valueWidth=t.valueWidth||50,t.labelWidth=t.labelWidth||50):"vertical"===t.displayType?(t.valueWidth=100,t.labelWidth=100):(t.valueWidth=100,t.labelWidth=0))},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_RENDER},render:function(e){return this.renderElement(e)},renderElement:function(e){var t=this,i=t.properties,r=t.getFormContainer();t.renderingDeferred=new $.Deferred,e=e||"render";var n=t.renderFactory.getTemplate(e),a=i.displayName;"string"==typeof a&&(a=(a=(a=(a=(a=(a=a.replaceAll("&","&amp;")).replaceAll("$","&#36;")).replaceAll("<","&lt;").replaceAll(">","&gt;")).replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;")).replaceAll("\\n","<br/>")).replaceAll("\n","<br/>"));var o="desktop"!==bizagi.util.detectDevice()&&("association"===i.type||"uploadecm"===i.type||("actionLauncher"===i.type||"polymorphicLauncher"===i.type)&&bizagi.util.isTabletDevice()||"grid"===i.type&&!bizagi.util.isTabletDevice()),s=parseFloat(i.labelWidth),l=$.fasttmpl(n,{label:a,helpText:i.helpText,editable:i.editable,isExtendedText:"text"==i.type&&i.isExtended,orientation:i.orientation,uniqueId:i.uniqueId,id:i.id,xpath:i.xpath,tag:i.tag,displayType:i.displayType,displayOptionClass:t.getDisplayOptionClass(i.displayType),labelAlignClass:t.getAlignClass(i.labelAlign),valueAlignClass:t.getAlignClass(i.valueAlign),labelWidth:s,stringLabelWidth:s+("pixels"==i.layoutType?"px":"%"),valueWidth:parseFloat(i.valueWidth),stringValueWidth:parseFloat(i.valueWidth)+("pixels"==i.layoutType?"px":"%"),layoutType:i.layoutType,isDesign:"design"===t.getMode(),messageValidation:i.messageValidation,printVersion:r.params.printversion,cssClass:i.cssclass||"",includedInResult:i.includedInResult,included:i.included,type:i.type,showFullRender:o,required:i.required,helpText:i.helpText}),d=t.internalRenderControl();return d||(d=""),"object"==typeof d&&d.done?"resolved"===d.state()?(l=t.replaceControlHtml(l,t.resolveResult(d)),t.asyncRenderDeferred=null):(t.asyncRenderDeferred=d,l=t.replaceControlHtml(l,"")):l=t.replaceControlHtml(l,d),l},resolveResult:function(e){return bizagi.resolveResult(e)},isRendered:function(){return!!this.renderingDeferred&&this.renderingDeferred.promise()},internalRenderControl:function(){var e=this,t=e.properties;return e.control=null,e.renderFactory.printVersion?(t.editable=!1,e.renderControl()):t.editable?e.renderControl():e.renderReadOnly()},postRenderElement:function(e){var t=this,i=t.properties;t.element=e,i.submitOnChange&&t.configureSubmitOnChange(),isLabelFormat=!0;var r=function(e){bizagi.rendering.render.renderOptimization&&bizagi.rendering.render.rendersExecuted>bizagi.rendering.render.maxRendersPerScreen?setTimeout(function(){t.internalPostRender(e),bizagi.rendering.render.postRenderTimeout+=50},bizagi.rendering.render.postRenderTimeout):t.internalPostRender(e),bizagi.rendering.render.rendersExecuted++};t.asyncRenderDeferred?$.when(t.asyncRenderDeferred).done(function(i){var n=t.getControl();"function"==typeof t.emptyControlByAsyncRenderDeferred&&t.emptyControlByAsyncRenderDeferred(),n.append(i),r(e),t.processLayout(!isLabelFormat,t.properties.valueFormat||{})}):r(e)},internalPostRender:function(e){var t=this,i=t.properties,r=t.getMode();t.control=t.getControl(),t.renderingDeferred&&t.renderingDeferred.resolve(),i.editable?t.renderFactory.printVersion&&t.postRenderPrintVersion?t.postRenderPrintVersion():t.postRender():t.postRenderReadOnly(e),"execution"==r?t.performExecutionModeMethods():t.performDesignModeMethods(),t.processLayout(isLabelFormat,t.properties.textFormat||{}),t.processLayout(!isLabelFormat,t.properties.valueFormat||{})},performExecutionModeMethods:function(){var e=this,t=e.properties;e.getFormType()==e.Class.TYPE_QUERY_FORM&&e.configureHandlersQueryForm(),t.editable?e.configureHandlers():e.configureHandlersReadOnly(),e.internalSetInitialValue()},performDesignModeMethods:function(){this.configureDesignView(),this.internalSetInitialValue()},replaceControlHtml:function(e,t){return t=t||"",(e=e||"").replace("{{control}}",t)},getRenderedElement:function(){return bizagi.util.isEmpty(this.element)&&bizagi.log(" render hasn't been rendered!",this,"error"),this.element},internalSetInitialValue:function(){var e=this,t=e.properties;e.internalSetInitialValueFlag=!0,t.editable,bizagi.util.isEmpty(e.value)||e.setDisplayValue(e.value),e.internalSetInitialValueFlag=!1},isValid:function(e){var t,i=this,r=i.properties,n=i.grid&&i.grid.properties&&i.grid.properties.inlineAdd;if(!1===bizagi.util.parseBoolean(r.visible))return!0;if(!1===bizagi.util.parseBoolean(r.editable)&&!n)return!0;if(i.setValidationMessage(""),bizagi.util.parseBoolean(r.required)){var a=i.getFormContainer(),o=!1,s=i.grid?[i]:a.getRenders(r.xpath),l=/^query/i.test(r.type);if(s.filter(function(e){return e.properties.id==r.id}).forEach(function(e){if(e.hasValue()&&(e.properties.editable||n))return o=!0,!1}),!o&&!i.properties.isClone){t=i.getResource("render-required-text").replaceAll("#label#",r.displayName);var d={xpath:r.xpath,message:t};return l&&(d=$.extend({},d,{id:r.id,isQuery:l})),e.push(d),!1}}if("duplicate"==r.retype){if(i.cloneRender&&i.cloneRender.getValue()!=i.getValue())return t=i.getResource("render-text-retype-error"),e.push({xpath:r.xpath,message:t}),!1}else if("double"==r.retype){var u=$("input",i.element);if(u&&u.data("oldValue")){if(""===u.val())return t=i.getResource("render-text-retype-error"),e.push({xpath:r.xpath,message:t}),!1;if(u.val()!=u.data("oldValue"))return t=i.getResource("render-text-retype-error"),e.push({xpath:r.xpath,message:t}),!1}}var p=!i.grid||!i.grid.getColumn||i.grid.getColumn(i.properties.xpath).properties.editable;if("userPassword"!==r.type&&void 0!==r.maxLength&&r.maxLength>0&&bizagi.util.isNumeric(r.maxLength)&&(p||!p&&i.controlValueIsChanged())){var c=new Number(r.maxLength),g=i.getValue();if(g&&g.toString().length>c)return t=i.getResource("render-text-maxLength-error").replaceAll("#maxLength#",c),e.push({xpath:r.xpath,message:t}),!1}return!0},hasValue:function(){var e=this.getValue();return e=e&&"text"===this.properties.type?e.trim():e,!bizagi.util.isEmpty(e)},postRender:function(){},postRenderReadOnly:function(){},configureHandlers:function(){},configureHandlersReadOnly:function(){},configureDesignView:function(){},processLayout:function(e,t){var i=this,r=i.properties;if(null!=i.getControl()){(t=t||{}).color&&i.changeColor(t.color,e),t.background&&i.changeBackgroundColor(t.background),!t.bold&&t.bold&&e||i.changeFontBold(t.bold,e),t.italic&&i.changeFontItalic(t.italic,e),t.underline&&i.changeFontUnderline(t.underline,e),t.strikethru&&i.changeFontStrikethru(t.strikethru,e),t.size&&i.changeFontSize(t.size,e),r.required=null!=r.required&&bizagi.util.parseBoolean(r.required);var n=null==r.visible||bizagi.util.parseBoolean(r.visible);r.required&&i.changeRequired(r.required),n||i.changeVisibility(n)}},setValue:function(e,t){var i=this;t=void 0===t||t,bizagi.util.identicalObjects(e,i.value)||(i.properties.previousValue=i.properties.originalValue=i.value,i.value=i.properties.value=e,i.properties.required&&"execution"==i.getMode()&&(i.checkRequired([])?i.changeRequiredLabel(!1):i.changeRequiredLabel(!0)),t&&!i.internalSetInitialValueFlag&&(i.triggerRenderChange(),i.triggerRenderValidate()))},checkRequired:function(e){var t=this.properties;return!(bizagi.util.parseBoolean(t.required)&&!this.hasValue())||(message=this.getResource("render-required-text").replaceAll("#label#",t.displayName),e.push({xpath:t.xpath,message:message}),!1)},validateInputRetype:function(){return!this.properties.retype||!this.cloneRender||this.getValue()==this.cloneRender.getValue()},triggerRenderChange:function(e){(e=e||{}).changed=void 0===e.changed||e.changed,this.triggerHandler("renderchange",{render:this,changed:e.changed})},triggerRenderValidate:function(){this.triggerHandler("rendervalidate",{render:this})},setDisplayValue:function(e){var t=this,i=t.getControl();if(t.setValue(e,!1),!t.properties.editable&&("check"!==t.properties.display||"check"===t.properties.display&&!0===bizagi.override.enableCheck)){var r=t.getDisplayValue(e);"string"!=typeof r&&"number"!=typeof r||(r=bizagi.util.sanitizeHTML(r),$(i).html("<label class='readonly-control'>"+r+"</label>"))}},getValue:function(){return this.value},getDisplayValue:function(){return this.getValue()},getLabel:function(){bizagi.util.mustImplement("getLabel")},getControl:function(){bizagi.util.mustImplement("getControl")},getControlFiller:function(){bizagi.util.mustImplement("getControlFiller")},renderControl:function(){},setValidationMessage:function(e){this.validationMessage=e},renderReadOnly:function(){var e=this.getValue(),t="";return bizagi.util.isObject(e)&&void 0!==e.value?t=bizagi.util.sanitizeHTML(e.value):bizagi.util.isEmpty(e)||(t=bizagi.util.isString(e)?bizagi.util.decodedDisplayValue(e):e),t},postRenderPrintVersion:function(){},changeDisplayOption:function(e){this.properties.displayType=e},getDisplayOptionClass:function(e){return""},changeLabelAlign:function(e){this.properties.labelAlign=e},changeValueAlign:function(e){this.properties.valueAlign=e},getAlignClass:function(e){return""},customizeRenderWidth:function(){},changeColor:function(e,t){var i=this,r=i.getControl(),n=i.getLabel();t=void 0===t&&null==t||t;r&&n&&("none"!=e?"value"!==i.properties.displayType&&t?(i.element.each(function(){this.style.setProperty("color",e,"important")}),"grid"==i.properties.type&&i.getControl().find(".bz-mobile-grid__header-title").each(function(){this.style.setProperty("color",e,"important")}),i.getLabel().find("label").css("color",e,"!important"),!1===i.properties.editable&&(i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getElementsToStylize($("label",i.getControl()).css("color",e,"!important")))):(i.getElementsToStylize(i.getControl()).css("color",e,"!important"),i.getControl().find("*").each(function(t,r){i.getElementsToStylize(r).css("color",e,"!important")})):(i.element.css("color",""),i.getLabel().find("label").css("color",""),i.getControl().css("color",""),i.getControl().find("input, textarea").each(function(e,t){var r=$(t).data("originalColor")||"";i.getElementsToStylize(t).css("color",r)})))},changeBackgroundColor:function(e){var t=this,i=t.getControl(),r=t.getLabel();if(i&&r)if("none"!=e){t.element.each(function(){this.style.setProperty("background-color",e,"important")}),void 0!==r.find("label").style?t.getLabel().find("label").style("background-color",e,"important"):t.getLabel().find("label").css("background-color",e,"!important");var n=t.getLabel().attr("style");n+="; background-color:"+e+"!important",t.getLabel().attr("style",n)}else t.element.css("background-color",""),t.getLabel().find("label").css("background-color",""),t.getControl().css("background-color",""),t.getControl().find("input, textarea").each(function(e,t){var i=$(t).data("originalColor")||"";$(t).css("background-color",i)})},getFormattingLabel:function(){return this.getLabel().find("label")},changeFontBold:function(e,t){var i=this;t=void 0===t&&null==t||t;0!=bizagi.util.parseBoolean(e)&&t?(i.getFormattingLabel().css("font-weight","bold","!important"),i.getControl().each(function(e,t){$(t).css("font-weight","bold","!important")})):t&&i.getFormattingLabel().css("font-weight","normal","!important"),t||(1==bizagi.util.parseBoolean(e)?i.getControl().find("*").each(function(e,t){$(t).css("font-weight","bold","!important")}):(i.getControl().find("*").each(function(e,t){$(t).css("font-weight","normal","!important")}),i.getControl().css("font-weight","normal","!important")))},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue,n=!0,a=bizagi.util.normalizeType(e.type);if($.forceCollectData)return!0;if("grid"===a&&"pending"===this.ready().state())return!1;if(["combo","queryCombo","list","queryList","radio","queryRadio"].includes(a)||/^cascadingcombo$/i.test(a))t&&void 0!==t.length&&(t=t[0]),i&&void 0!==i.length&&(i=i[0]),r&&void 0!==r.length&&(r=r[0]),t=t&&t.id?t.id:t,i=i&&i.id?i.id:i,n=void 0!==(r=r&&r.id?r.id:r)&&null!=r?i!=t||i==r:i!=t;else if("boolean"===a||"queryBoolean"===a||"queryCheck"===a)n=bizagi.util.parseBoolean(i)!=bizagi.util.parseBoolean(t);else if("searchNumber"===a)n=!!t;else if("number"===a)n=(null!==t&&""!==t||null!==i&&""!==i)&&i!==t;else if("text"===a)n=(null!==t&&""!==t||null!==i&&""!==i)&&i!==t;else if("date"===a)n=!(!i&&!t)&&i!=t;else if("actionLauncher"===a){n=!1;var o=[];try{o="string"==typeof i?JSON.parse(i):i}catch(e){}var s=function(e,t){e=e||"";for(var i=!1,r=0,n=(t=t||[]).length;r<n;r++)if(t[r].guidAction==e){i=!0;break}return i};if(o.length==t.length)for(var l=0,d=o.length;l<d;l++)s(o[l].guidAction,t)||(n=!0);else n=!0}else if("polymorphicLauncher"===a||"entityTemplate"===a)n=i.length!=t.length||JSON.encode(t)!=JSON.encode(i);else if("image"===a)n=!(null==i&&t.indexOf(!0)<0);else if("searchList"===a){var u={};try{u=JSON.parse(t)}catch(e){console.log("Error when detect change value on searchList control")}n=JSON.encode(i)!=JSON.encode(u.value)}else n=i!==t;return n},changeFontItalic:function(e,t){var i=this;t=void 0===t&&null==t||t;"value"!=i.properties.displayType&&t?1==bizagi.util.parseBoolean(e)?i.getFormattingLabel().css("font-style","italic","!important"):i.getFormattingLabel().css("font-style","normal","!important"):1==bizagi.util.parseBoolean(e)?(t&&i.getFormattingLabel().css("font-style","italic","!important"),i.properties.editable?i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("font-style","italic","!important")}):i.getElementsToStylize(i.getControl()).css("font-style","italic","!important")):(t&&i.getFormattingLabel().css("font-style","normal","!important"),i.properties.editable?i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("font-style","normal","!important")}):i.getElementsToStylize(i.getControl()).css("font-style","normal","!important"))},changeFontUnderline:function(e,t){var i=this,r=i.properties.textFormat||{},n=i.properties.valueFormat||{},a=bizagi.util.parseBoolean(r.strikethru)?"line-through ":"",o=bizagi.util.parseBoolean(n.strikethru)?"line-through ":"";t=void 0===t&&null==t||t;1==bizagi.util.parseBoolean(e)&&t?(i.getFormattingLabel().css("text-decoration",a+"underline","!important"),i.getControl().each(function(e,t){i.getElementsToStylize(t).css("text-decoration",a+"underline")})):t&&i.getFormattingLabel().css("text-decoration",a,"!important"),"value"!=i.properties.displayType&&t||(1==bizagi.util.parseBoolean(e)?i.properties.editable?i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("text-decoration",o+"underline","!important")}):i.getElementsToStylize(i.getControl()).css("text-decoration",o+"underline","!important"):i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("text-decoration",o,"!important")}))},changeFontStrikethru:function(e,t){var i=this,r=i.properties.textFormat||{},n=i.properties.valueFormat||{},a=bizagi.util.parseBoolean(r.underline)?"underline ":"",o=bizagi.util.parseBoolean(n.underline)?"underline ":"";t=void 0===t&&null==t||t;1==bizagi.util.parseBoolean(e)&&t?i.getFormattingLabel().css("text-decoration",a+"line-through","!important"):t&&i.getFormattingLabel().css("text-decoration",a,"!important"),"value"!=i.properties.displayType&&t||(1==bizagi.util.parseBoolean(e)?i.properties.editable?i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("text-decoration",o+"line-through","!important")}):i.getElementsToStylize(i.getControl()).css("text-decoration",o+"line-through","!important"):i.properties.editable?i.getControl().find("*").each(function(e,t){i.getElementsToStylize(t).css("text-decoration",o,"!important")}):i.getElementsToStylize(i.getControl()).css("text-decoration",o,"!important"))},changeFontSize:function(e,t){var i=this;t=void 0===t&&null==t||t;if("0"!=e){var r=i.getFormattingLabel(),n=100+10*Number(e)+"%";if(t&&r.css("font-size",n,"!important"),"value"==i.properties.displayType||!t){var a=i.getControl();"object"==typeof a.children()&&a.children().length>0?i.getElementsToStylize(a.children()).css("font-size",n,"!important"):(i.getElementsToStylize(a).css("font-size",n,"!important"),-1!=i.properties.type.indexOf("ombo")&&e>4&&a.children(0).height(2*e+20)),i.getElementsToStylize(a.find(".ui-bizagi-render-date")).css("line-height","normal")}}},getElementsToStylize:function(e){return $(e)},changeVisibility:function(e){var t=this,i=t.properties;1==bizagi.util.parseBoolean(e)?"hidden"!==i.type&&(t.element.show(),t.element.css("display",""),i.required&&(t.hasValue()||t.changeRequiredLabel(!0))):t.element&&t.element.hide(),i.visible=e},changeEditability:function(e){var t=this,i=t.properties,r=t.getControl();i.editable=bizagi.util.parseBoolean(e),r.empty(),"function"==typeof t.internalRenderControl&&$.when(t.internalRenderControl()).done(function(e){"function"==typeof t.emptyControlByChangeEditability&&t.emptyControlByChangeEditability(),t.asyncRenderDeferred||r.append(e),t.postRenderElement(t.element)})},changeEditabilityCellControl:function(e,t,i){var r=this,n=r.properties,a=r.getControl(),o=r.grid.getColumn(i),s=o.getDecorated(t);n.editable=bizagi.util.parseBoolean(e),a.empty(),"function"==typeof r.internalRenderControl&&$.when(r.internalRenderControl()).done(function(e){r.asyncRenderDeferred||a.append(e),r.postRenderElement(r.element),n.editable&&(o.bind("rendered",function(){o.readyDeferred.resolve()}),s.unbind("renderchange"),s.bind("renderchange",function(e,i){o.changed=!0,r.grid.onCellChange(o,null,t,i)}))})},changeRequired:function(e){var t=this,i=t.properties,r=i.displayName||"",n=$("label",t.getLabel()),a=t.getControl();i.required=e,"execution"==t.getMode()&&t.checkRequired([])?t.changeRequiredLabel(!1):1==bizagi.util.parseBoolean(e)&&i.editable?"rtl"==t.properties.orientation?a.prepend('<div class="ui-bizagi-render-control-required-rtl"></div>'):(a.addClass("control-required"),a.prepend('<div class="ui-bizagi-render-control-required"></div>')):"rtl"==t.properties.orientation?$(".ui-bizagi-render-control-required-rtl",a).remove():(a.removeClass("control-required"),$(".ui-bizagi-render-control-required",a).remove()),n.html(r),t.triggerRenderValidate()},changeRequiredLabel:function(e){var t=this,i=t.properties,r=i.displayName||"",n=$("label",t.getLabel()),a=t.getControl();1==bizagi.util.parseBoolean(e)&&i.editable?"rtl"==t.properties.orientation?a.prepend('<div class="ui-bizagi-render-control-required-rtl"></div>'):(a.addClass("control-required"),a.append('<div class="ui-bizagi-render-control-required"></div>')):"rtl"==t.properties.orientation?$(".ui-bizagi-render-control-required-rtl",a).remove():(a.removeClass("control-required"),$(".ui-bizagi-render-control-required",a).remove()),n.html(r),t.triggerRenderValidate()},refreshControl:function(e){var t=this,i=t.properties,r=(t.value,t.getFormContainer().properties.id||"");return e=e||{},t.startLoading(),t.beforeToRefresh(),$.when(t.dataService.multiaction().refreshControl({xpath:i.xpath,idRender:i.id,idPageCache:i.idPageCache,xpathContext:i.xpathContext||e.xpathContext,idForm:r})).pipe(function(e){t.control=t.controlFiller=t.label=null;var i=t.element;return t.initializeData(e.render),$.when(t.render()).pipe(function(e){var i=$(e);t.postRenderElement(i);return t.properties.originalValue=t.value,i}).pipe(function(e){i.replaceWith(e),t.grid||t.triggerRenderChange({changed:!1}),t.afterToRefresh()})}).fail(function(e){e=t.processFailMessage(e)}).always(function(){t.endLoading()})},refreshDesignControl:function(e){var t=this,i=t.properties;t.beforeToRefresh(),t.control=t.controlFiller=t.label=null,$.extend(e.render.properties,{xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext||"form",idPageCache:i.idPageCache});var r=t.element;return t.initializeData(e.render),$.when(t.render()).pipe(function(e){var i=$(e);t.postRenderElement(i);return t.properties.originalValue=t.value,i}).pipe(function(e){r.replaceWith(e),t.triggerRenderChange(),t.beforeToRefresh()})},cleanData:function(){this.setValue(""),this.clearDisplayValue()},clearDisplayValue:function(){var e=this.getControl(),t=e.find("input");t.length>0?t.val(this.getValue()):!1===this.properties.editable&&$(e).html("<label class='readonly-control'></label>")},updateOriginalValue:function(){this.properties.originalValue=this.value},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();this.controlValueIsChanged()&&(bizagi.util.isEmpty(i)||(bizagi.util.isEmpty(r)?""!==r&&null!==r||(e[t.xpath]=""):e[t.xpath]=r)),this.validateInputRetype()||(e[t.xpath]="")},hasChanged:function(e){return!!this.controlValueIsChanged()&&(e.push(!0),!0)},configureHandlersQueryForm:function(){var e=this;e.element.find(".ui-bizagi-render-control-included").change(function(){e.properties.included=$(this).is(":checked")})},collectDataQueryForm:function(e){var t=this,i=t.properties,r=i.xpath,n=t.getValue(),a=null;if(!bizagi.util.isEmpty(r)){if(null!=n)a=void 0!==n.id?bizagi.util.isEmpty(n.id)?null:[n]:""!==n?n:null;if((null!==a||i.included)&&("check"!=i.display||0!=i.value)){var o=t.properties.typeSearch||t.properties.rangeQuery||"NONE";o=o.toUpperCase();var s={value:a,included:t.properties.included,xpath:i.xpath,searchType:o,orderType:"NONE"};void 0!==i.displayXpath&&""!==i.displayXpath&&(s.displayXpath=i.displayXpath),e.push(s)}}},canBeSent:function(){var e,t=this.properties,i=bizagi.util.parseBoolean(t.displayOnly)||!1,r=t.editable;if(!i&&r)return!0;if(t.isClone)return!1;if(t.xpath&&1==this.getFormContainer().getRenders(t.xpath).length){if(e=!!$.forceCollectData&&$.forceCollectData.toString(),$.forceCollectData=e?void 0:$.forceCollectData,this.controlValueIsChanged())return $.forceCollectData=e?bizagi.util.parseBoolean(e):$.forceCollectData,!0;$.forceCollectData=e?bizagi.util.parseBoolean(e):$.forceCollectData}return!1},canBeSentQueryForm:function(){return!this.properties.isClone},focus:function(e){var t=this;if(t.properties.visible){this._super();var i=$("#ui-bizagi-wp-app-render-form-content"),r=function(){var e=t.getControl(),r="grid"!=t.properties.type?$("input, select, option, textarea",e):$("input, select, option, textarea",e).first();r.length>0&&$.each(r,function(e){var t=r[e];if("hidden"!=$(t).attr("type")&&"none"!=$(t).css("display")&&"hidden"!=$(t).css("visibility"))try{bizagi.util.isIE()||bizagi.util.autoScrollBottom(i),t.focus()}catch(e){}})};$.when(t.ready()).done(function(){e>0?setTimeout(r,e):r()})}},getDefaultLabelAlign:function(e){return"default"},getDefaultValueAlign:function(e){return"default"},getRTLAlign:function(e){return e},configureSubmitOnChange:function(){var e=this,t=e.properties,i="";if(t.editable){t.dependencies=t.dependencies||"all";var r={conditions:{expressions:[{simple:{xpath:i=t.xpath?t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.xpath:t.xpath:t.submitOnChangexpathContext?t.submitOnChangexpathContext+"."+t.id:t.id,operator:"changes",argumentType:"const"}}]},commands:[{xpath:i,command:"submit-value",argument:t.dependencies}],dependencies:[i],elseCommands:[]};$.when(e.ready()).done(function(){e.getFormContainer().addSubmitAction(i,r)})}},submitOnChange:function(e,t,i){var r=this,n=$.Deferred();return""!=r.properties.contexttype&&e&&(e[r.dataService.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=r.properties.contexttype),$.when(r.isReadyToSave()).done(function(){r.internalSubmitOnChange(e,t,i).done(function(){n.resolve()}).fail(function(){n.reject()})}),n.promise()},getCacheIdCase:function(){var e=this.getParams().idCase;return void 0===bizagi.cache?(bizagi.cache={},bizagi.cache.idCaseObject={idCase:void 0!==e?e:void 0!==bizagi.cache.idCase?bizagi.cache.idCase:void 0}):void 0!==e&&void 0!==bizagi.cache.idCaseObject?bizagi.cache.idCaseObject.idCase=e:void 0!==e&&void 0===bizagi.cache.idCaseObject&&(bizagi.cache.idCaseObject={},bizagi.cache.idCaseObject.idCase=e),e=void 0===e?void 0===bizagi.cache.idCaseObject?void 0:bizagi.cache.idCaseObject.idCase:e},internalSubmitOnChange:function(e,t,i){var r=this.getFormContainer(),n=this.properties,a={data:e,bRefreshForm:t,notCollect:i,properties:{idCase:this.getCacheIdCase(),id:n.id,xpath:n.xpath,idPageCache:n.idPageCache,contexttype:n.contexttype}};return r.internalSubmitOnChange(a)},ready:function(){return $.when(this.parent.ready(),this.isRendered())},getCustomHandlers:function(){var e=this.getFormContainer();return e?e.getCustomHandlers():null},getCustomHandler:function(e){var t=this.getCustomHandlers();return t?t[e]:null},calculateRenderWidth:function(e,t,i){if(e="100"==t&&void 0===e?"0":e?"0"!=e?e:"50":"50%",t=t?"0"!=t?t:"50":"50%","normal"==i||"both"==i||"reversed"==i){if(e&&bizagi.util.percent2Number(e)<5&&t&&bizagi.util.percent2Number(t)<5)return{label:0,control:100};e&&!t?t=100-(e=bizagi.util.percent2Number(e)):!e&&t?e=100-(t=bizagi.util.percent2Number(t)):(e=bizagi.util.percent2Number(e))+(t=bizagi.util.percent2Number(t))!=100&&void 0!==this.properties&&"pixels"!=this.properties.layoutType&&(t=100-e)}else e=100,t=100;return{label:e,control:t}},getIdCase:function(){return this.getFormContainer().params.idCase||bizagi.context.idCase},getIdWorkitem:function(){return this.getFormContainer().params.idWorkitem||bizagi.context.idWorkitem},getidTask:function(){return this.getFormContainer().params.idTask||bizagi.context.idTask},getSessionId:function(){return this.getFormContainer().properties.sessionId},changeCellColor:function(e){var t=this.getControl();t&&("none"!=e?(t.css("color",e),t.find("input, textarea, label").each(function(t,i){$(i).css("color",e)})):(t.css("color",""),t.find("input, textarea, label").each(function(e,t){$(t).css("color","")})))},changeCellBackgroundColor:function(e){var t=this.getControl(),i="",r="";if(t)if("none"!=e&&(i=e,r="none"),this.properties.editable){var n=!1;t.find("input, textarea, .ui-selectmenu").each(function(e,t){"text"!=t.type&&"textarea"!=t.type||$(t).hasClass("ui-select-data")||(n=!0),$(t).css({"background-color":i,"background-image":r})}),n||t.closest("td").each(function(e,t){$(t).css({"background-color":i,"background-image":r})})}else t.each(function(e,n){($(n).hasClass("ui-bizagi-cell-readonly")?t.closest("td"):$(n)).css({"background-color":i,"background-image":r})})},changeCellVisibility:function(e){var t=this.properties,i=this.getControl();i&&(1==bizagi.util.parseBoolean(e)?(i.css("visibility","visible"),i.css("display",""),this.element&&this.element.show()):i.css("visibility","hidden")),t.visible=e},changeCellRequired:function(e){var t=this.properties,i=this.getControl();i&&(1==bizagi.util.parseBoolean(e)&&bizagi.util.isEmpty(this.value)?(i.addClass("control-required"),i.append('<div class="ui-bizagi-render-control-required"></div>')):(i.removeClass("control-required"),$(".ui-bizagi-render-control-required",i).remove()),t.required=e)},startActionExecution:function(){this.startLoading(),this.actionExecutionDeferred=new $.Deferred},endActionExecution:function(){this.endLoading(),this.actionExecutionDeferred&&this.actionExecutionDeferred.resolve(),delete this.actionExecutionDeferred},readyActionExecution:function(){return this.actionExecutionDeferred?this.actionExecutionDeferred.promise():$.when(!0)},isFromCreatedRow:function(){var e=this;if(e.grid)for(var t=e.grid.columns.length;t-- >0;)if(e.grid.columns[t].properties.xpath==e.properties.xpath&&1==e.grid.columns[t].isNewRow)return!0;return!1},submitInvalidatePageCacheRequest:function(e){var t=this.properties,i=e?e.idPageCache:t.idPageCache;this.dataService.invalidatePageCache({idPageCache:i})},isDesignMode:function(){return"design"===this.getMode()},isExecutionMode:function(){return"execution"===this.getMode()},preventDefaultForAnchorTag:function(){bizagi.util.isSharepointContext()&&$("a",this.getControl()).click(function(e){e.preventDefault()})}}),$.Class.extend("bizagi.rendering.render.base",{},{processLayout:function(e,t){var i=this.properties;if("boolean"==typeof e)if(e)this.processLabelLayout(t);else{this.processControlLayout(t),i.required=void 0!==i.required&&bizagi.util.parseBoolean(i.required);var r=void 0===i.visible||bizagi.util.parseBoolean(i.visible);i.required&&this.changeRequired(i.required),r||this.changeVisibility(r)}else console.warm("error calling processLayout, 'isLabelFormat' is not boolean")},processLabelLayout:function(e){var t=this.getLabel();null!=t&&(void 0===(e=e||{}).bold&&(e.bold=!0),this.changeBackgroundColor(e.background).changeFontColor(t,e.color).changeFontBold(t,e.bold).changeFontSize(t,e.size).changeFontItalic(t,e.italic).changeTextDecoration(t,(e.underline?"underline":"")+(e.strikethru?" line-through":"")))},processControlLayout:function(e){var t=this.getControl(),i=this.getElementsToStylize(t);e=e||{},this.changeFontColor(i,e.color).changeFontBold(i,e.bold).changeFontItalic(i,e.italic).changeFontSize(i,e.size).changeTextDecoration(i,(e.underline?"underline":"")+(e.strikethru?" line-through":""))},changeColor:function(e){var t=this.getLabel(),i=this.getControl(),r=this.getElementsToStylize(i);return this.changeFontColor(t,e).changeFontColor(r,e)},changeFontColor:function(e,t){if(void 0===e)return this;if(void 0===t)return this;var i="none"!==t?t:"";return e.css("color",i),this},changeFontSize:function(e,t){if(void 0===t)return this;if(void 0===e)return this;if("0"!==t){var i=100+10*Number(t)+"%";e.css("font-size",i)}return this},changeTextDecoration:function(e,t){return void 0===t?this:void 0===e?this:(t&&e.css("text-decoration",t),this)},changeFontItalic:function(e,t){var i=bizagi.util.parseBoolean(t)?"italic":"normal";return e.css("font-style",i),this},changeFontBold:function(e,t){var i=bizagi.util.parseBoolean(t)?"bold":"normal";return e.css("font-weight",i),this},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.element.css("background-color",e):this.element.css("background-color",""),this)},changeRequiredLabel:function(){},changeCellRequired:function(e){this.changeRequired(e)},getRTLAlign:function(e){return void 0===e||""==e?"default":e},getDefaultLabelAlign:function(){return"default"},getDefaultValueAlign:function(){return"default"}}),$.Class.extend("bizagi.rendering.form",{},{init:function(e){var t=this,i=e.data,r=bizagi.util.detectDevice();t.rendersById={},t.rendersByXpath={},t.rendersByType={},t.idPageCache=i.pageCacheId,t.mode=e.mode||"execution",t.focus=e.focus,t.params=e,this._super(e);var n="";n="desktop"!==r?this.getResource("render-form-user-confirmation-message").replace(/<br(\/| \/)>/g,"\n"):this.getResource("render-form-user-confirmation-message");var a=t.properties;if(a.sessionId=i.sessionId,a.displayAsReadOnly=bizagi.util.parseBoolean(i.displayAsReadOnly)||!1,a.userConfirmationMessage=a.userConfirmationMessage||n,a.orientation=a.orientation||"ltr",a.hasRule=bizagi.util.parseBoolean(a.hasRule)||!1,a.contexttype=e.contexttype||"",a.paramsRender=e.paramsRender||{},a.processPath=e.data.processPath?e.data.processPath.replaceAll("|/|","  &rsaquo;  "):"",a.breadCrumb=e.data.processPath?e.data.processPath.split("|/|"):[],this.validations=i.validations,this.actions=i.actions,t.allowValidateAndSaveAction=bizagi.override&&!0===bizagi.override.enableActionValidateAndSave,t.initializeButtons(i),i.transitions&&(t.transitions=i.transitions),this.originalProcessButton=this.processButton,t.isRoutingDisabled=!1,e.applicationParent)switch(e.applicationParent){case"NEWWORKPORTAL":t.isRoutingDisabled=!0}t.isOfflineFormsV2Supported=bizagi.util.isMobileDevice()&&bizagi.util.isOfflineFormsV2Supported()},initializeButtons:function(e){var t=this;t.buttons=[],e.buttons&&$.each(e.buttons,function(e,i){var r=i.button.properties;r.caption=bizagi.util.isEmpty(r.caption)||t.getResource(r.caption)==r.caption?r.caption:t.getResource(r.caption),r.actions&&$.each(r.actions,function(e,t){r[t]=!0}),r.ordinal=e,r.action=r.next?"next":r.nextWithoutValidations?"nextWithoutValidations":r.submitData?"save":r.cancel?"cancel":r.back?"back":r.createnewcase?"createnewcase":r.validate?"validate":"",r.save="save"===r.action,(r.next||r.back||r.nextWithoutValidations)&&(r.routing=!0),r.hasRule&&(r.executeRule=!0),t.allowValidateAndSaveAction&&r.validate&&(r.submitData=!0,r.refresh=!0,r.save=!0,"next"!==r.action&&"createnewcase"!==r.action||(r.refresh=!1)),r.style=t.buildButtonStyle(r),"rtl"!==t.properties.orientation||t.properties.useCustomButtons?t.buttons.push(r):t.buttons.unshift(r)})},getParams:function(){return this.params},setParam:function(e,t){this.params&&(this.params[e]=t)},getMode:function(){return this.mode},getCustomHandlers:function(){if(this.params)return this.params.customHandlers},registerRender:function(e){var t=this;t.rendersById[e.properties.id]=e,e.properties.xpath&&(t.rendersByXpath[e.properties.xpath]||(t.rendersByXpath[e.properties.xpath]=[]),t.rendersByXpath[e.properties.xpath].push(e)),t.rendersByType[e.properties.type]||(t.rendersByType[e.properties.type]=[]),t.rendersByType[e.properties.type].push(e)},unregisterRender:function(e){var t=this;if(t.rendersById[e.properties.id]&&delete t.rendersById[e.properties.id],e.properties.xpath)if($.isArray(t.rendersByXpath[e.properties.xpath])&&t.rendersByXpath[e.properties.xpath].length>1)for(var i=0,r=t.rendersByXpath[e.properties.xpath].length;i<r;i++){if(t.rendersByXpath[e.properties.xpath][i].properties.id===e.properties.id){t.rendersByXpath[e.properties.xpath].splice(i,1);break}}else delete t.rendersByXpath[e.properties.xpath];if(e.properties.type){var n=t.getRenderByType(e.properties.type),a=n.length,o=e.properties.id||e.properties.xpath;for(i=0;i<a;i++){var s=n[i];if(void 0!==s.properties.id&&s.properties.id==o||void 0!==s.properties.xpath&&s.properties.xpath==o){t.rendersByType[e.properties.type].splice(i,1);break}}}},getRenderById:function(e){return this.rendersById[e]},getGridByColumn:function(e){for(var t=this.getRenderByType("grid"),i=0;i<t.length;i++)if(-1!=t[i].columnsIds.indexOf(e))return t[i];return null},getRenders:function(e){return e&&e.indexOf&&e.indexOf("[")>0&&(e=e.substring(0,e.indexOf("["))),this.rendersByXpath[e]?this.rendersByXpath[e]:[]},getRenderByType:function(e){return"string"==typeof e&&e.length>0&&this.rendersByType[e]?this.rendersByType[e]:[]},renderContainer:function(){var e=this,t=this.properties,i=e.renderFactory.getTemplate("form"),r=$.fasttmpl(i,{buttons:e.buttons,transitions:e.transitions,uniqueId:t.uniqueId,helptext:t.helpText,mode:e.getMode(),queryForm:"queryForm"==e.getFormType(),summaryForm:e.params.summaryForm||!1,globalForm:e.properties.displayAsReadOnly||!1,idCase:"",displayName:e.params.displayName||"",processPath:t.processPath,breadCrumb:t.breadCrumb,orientation:t.orientation});return r=e.replaceChildrenHtml(r,e.renderChildrenHtml())},postRenderContainer:function(e){var t=this.getMode();e.addClass("ui-bizagi-rendering-mode-"+t),this._super(e)},configureHandlers:function(){var e,t=this,i=t.container;i.length>1?$(i).each(function(){$(this).hasClass("ui-bizagi-container-complexgateway")&&(e=this)}):e=$(".ui-bizagi-container-complexgateway",i),t.activeTransitions={},t.processButtons(i),t.bind("ondomincluded",function(e,i){t.validationController=new bizagi.command.controllers.validation(t,t.validations,i),t.actionController=new bizagi.command.controllers.action(t,t.actions),t.readyDeferred.resolve()}),$(e).find(".ui-checkbox").bind("click",function(){var e=$("label",this),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),bizagi.util.parseBoolean(e.data("checked"))?(e.removeClass("ui-checkbox-state-checked"),e.removeClass("bz-check").addClass("bz-full-ball"),e.data("checked",!1),t.activeTransitions[i]=!1):(e.addClass("ui-checkbox-state-checked"),e.addClass("bz-mo-icon").addClass("bz-check").removeClass("bz-full-ball"),e.data("checked",!0),t.activeTransitions[i]=!0)})},configureDesignView:function(){var e=this;e.bind("ondomincluded",function(){e.readyDeferred.resolve()})},buildButtonStyle:function(e){var t={};if(e.format){if(e.format.size&&"0"!=e.format.size){var i=100+10*Number(e.format.size)+"%";t["font-size"]=i+" !important"}if(e.format.bold&&(t["font-weight"]="bold !important",bizagi.util.isIE()&&(t["font-family"]="'Open Sans', 'Helvetica Neue', Arial, Helvetica, sans-serif !important")),e.format.italic&&(t["font-style"]="italic !important"),e.format.underline||e.format.strikethru){var r=bizagi.util.parseBoolean(e.format.strikethru)?"line-through ":"",n=bizagi.util.parseBoolean(e.format.underline)?"underline ":"";t["text-decoration"]=r+n+" !important"}e.format.background&&(t["background-color"]=e.format.background+" !important",t["background-image"]="none !important"),e.format.color&&(t.color=e.format.color+" !important")}var a="";for(key in t)a+=key+":"+t[key]+";";return a},render:function(){return this.readyDeferred||(this.readyDeferred=new $.Deferred),this._super()},ready:function(){return this.readyDeferred.promise()},getXpathContext:function(){return this.properties.xpathContext||""},getContextType:function(){return this.properties.contexttype||""},getEndPointAction:function(){if("startform"==this.properties.formtype)return"LOADSTARTFORM"},getPageCache:function(){return this.idPageCache},getFormContainer:function(){return this},processButtons:function(){var e=this,t=e.getButtons();t&&0!=t.length&&t.on("click",function(t){t.preventDefault(),t.stopImmediatePropagation(),e.startLoading();var i=$(this),r=i.attr("ordinal"),n=e.buttons[r];e.lastActionButton=n,"next"===n.action&&(n.routingDisabled=e.isRoutingDisabled),i.prop("disabled",!0),i.hasOwnProperty("disabled")&&i.button("disable"),e.propagateExternalEvents(t),setTimeout(function(){$.when(e.processButton(n)).always(function(){e.processDefer=void 0,e.endLoading(),$.contains(document.documentElement,i.get(0))&&(i.prop("disabled",!1),i.hasOwnProperty("enable")&&i.button("enable"))})},100)})},preProcessButton:function(e){return!0},postProcessButton:function(e,t){return!0},setLoaderDeferred:function(){this.loaderDeferred=$.Deferred().resolve()},deleteLoaderDeferred:function(){var e=this;e.isLoaderDeferredSet()&&$.when(e.loaderDeferred.promise()).done(function(){delete e.loaderDeferred})},useOrSetLoaderDeferred:function(){this.isLoaderDeferredSet()||this.setLoaderDeferred()},getLoaderPromise:function(){return this.isLoaderDeferredSet()?this.loaderDeferred.promise():void 0},isLoaderDeferredSet:function(){return!!this.loaderDeferred},appendWaitForLoader:function(e){var t=e.promise,i=e.create||!1;if(!this.isLoaderDeferredSet()){if(!i)return;this.setLoaderDeferred()}this.loaderDeferred=this.loaderDeferred.then(function(){return t})},processButton:function(e){var t=this,i=$.Deferred(),r=t.properties;e.routing||bizagi.chrono.initAndStart("submitForm"),bizagi.chrono.init("waiting"),t.validationController.clearValidationMessages();var n=t.getFormContainer(),a=n.getRenderByType("tabItem"),o=a.length;n.innerTabsLoading=!0,t.useOrSetLoaderDeferred();for(var s=0;s<o;s++){var l=a[s];l.loadingDeferred&&l.parent.container&&l.loadingDeferred.resolve()}return delete n.innerTabsLoading,$.when(t.ready(),t.getLoaderPromise()).done(function(){t.deleteLoaderDeferred(),!bizagi.util.parseBoolean(e.validate)||t.validationController.performValidations()?(["save","next","back","createnewcase","nextWithoutValidations"].includes(e.action)&&$(document).data("auto-save",""),bizagi.util.parseBoolean(t.properties.needsUserConfirmation)&&bizagi.util.parseBoolean(e.routing)?(t.endLoading(),$.when(bizagi.showConfirmationBox(r.userConfirmationMessage,null,!1)).done(function(){t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done(function(){i.resolve()}).fail(function(){i.reject(arguments)}))}).fail(function(){i.reject()})):t.preProcessButton(e)&&(t.triggerGlobalHandler("renderActionButton",e),$.when(t.submitForm(e)).done(function(){$(document).trigger("FORMACTION",e),i.resolve()}).fail(function(){i.reject(arguments)}))):(t.endLoading(),e.submitData?$.when(t.submitData()).done(function(){i.reject()}):i.reject(),t.validationController.expandNotificationBox());var n=t.getCustomHandler("afterFormButtonClick");n&&n(e)}),i.promise()},validateForm:function(){return this.validationController.clearValidationMessages(),this.validationController.performValidations()},saveForm:function(){var e=this,t=bizagi.util.isOfflineForm({context:e}),i=e.collectRenderValuesForSubmit(),r=null;return i.deferreds&&(r=$.when.apply($,i.deferreds),delete i.deferreds),$.when(r).pipe(function(){return e.startLoading(),$.when(e.dataService.submitData({action:"SAVE",data:i,idCase:e.params.idCase,idWorkitem:e.params.idWorkitem,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,isOfflineForm:t||!1})).always(function(){e.endLoading()})})},submitForm:function(e){var t=this,i=$.Deferred(),r=bizagi.util.isOfflineForm({context:t});return $.when(t.isReadyToSave()).done(function(){r?t.internalSubmitFormOffline(e):$.when(t.internalSubmitForm(e)).done(function(){i.resolve()}).fail(function(){i.reject(arguments)})}).fail(function(){t.endLoading(),bizagi.log("The form is not saved, no changes were found"),i.reject()}),i.promise()},checkWidgetsData:function(){},isComplexGatewayPainted:function(){return!1},getLastActionButton:function(){return this.lastActionButton},internalSubmitFormOffline:function(e){var t,i=this,r="",n=bizagi.util.isOfflineForm({context:i});if(n&&i.properties&&!i.properties.idPageCache&&(i.properties.idPageCache=""),(e.submitData||e.executeRule)&&(t=i.collectRenderValuesForSubmit()),i.transitions){var a=[];if($.each(this.activeTransitions,function(e,t){t&&a.push(e)}),0==bizagi.util.countProps(a))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),i.endLoading(),""}$.when(i.dataService.submitData({action:e.action,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,idForm:i.properties.id,prepare:!0,transitions:a||"",idCase:i.params.idCase,idWorkitem:i.params.idWorkitem,isOfflineForm:n||!1,offlineType:i.params.offlineType||""})).done(function(t){if(i.postProcessButton(t,e))if(e.routing){var a=!1;if(n&&i.isOfflineFormsV2Supported&&i.params.online){a=!0;var o=new $.Deferred;i.params.responsePromise=o,$(document).trigger("tryPushCase.offline",i.params)}else n&&!i.isOfflineFormsV2Supported&&$(document).trigger("tryPushData.offline");a?$.when(o).then(function(e){i.triggerHandler("routing",{idCase:e.IdCase,caseNumber:e.CaseNumber})}).fail(function(e){i.failHandler(e)}):i.triggerHandler("routing",{offlineAction:e.action,idCase:i.params.idCase,idWorkitem:i.params.idWorkitem})}else r=bizagi.util.isValidResource("workportal-mobile-offline-form-successful")?bizagi.localization.getResource("workportal-mobile-offline-form-successful"):"Saved",bizagi.util.showNotification({text:r,type:"success"})}).fail(function(e){r=bizagi.util.isValidResource("workportal-mobile-offline-successful-fail")?bizagi.localization.getResource("workportal-mobile-offline-successful-fail"):"Not saved",bizagi.util.showNotification({text:r,type:"error"})})},internalSubmitForm:function(e){var t,i=this,r=$.Deferred();(e.submitData||e.executeRule||e.createnewcase)&&(t=i.collectRenderValuesForSubmit()),$.when(i.startLoading()).done(function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")});var n=null,a=null,o=null,s=null,l=null,d=[],u=null;if(e.executeRule&&(t.deferreds&&(u=$.when.apply($,t.deferreds),d.push(u),delete t.deferreds),(n=i.dataService.submitData({action:"SUBMITDATA",data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0})).tag="submitData",s=i.prepareCheckpointAction(e.id),t={},(a=i.dataService.executeButton({idRender:e.id,xpathContext:i.properties.xpathContext||"",idPageCache:i.properties.idPageCache,prepare:!0})).tag="executeRule",l=i.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase||e.nextWithoutValidations){if(i.transitions){var p=[];if($.each(this.activeTransitions,function(e,t){t&&p.push(e)}),0==bizagi.util.countProps(p))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),i.endLoading(),r.reject(),r.promise()}t.deferreds&&(u=$.when.apply($,t.deferreds),d.push(u),delete t.deferreds),(o=i.dataService.submitData({action:i.getButtonAction(e.action),forcePlanCompletion:e.forcePlanCompletion,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0,transitions:p||"",contexttype:i.properties.contextType,surrogatekey:i.properties.surrogateKey})).tag="performAction"}var c=[];a&&(c.push(n),c.push(s),c.push(a),c.push(l)),o&&c.push(o),bizagi.chrono.initAndStart("submitForm-ajax");var g=new $.Deferred;return t&&t.deferreds?$.when.apply(this,t.deferreds).done(function(e){g.resolve(e)}).fail(function(){g.reject(),console.log("Error: It was not possible resolve async actions on form ")}):g.resolve(),d.push(g),$.when.apply($,d).done(function(){$.when(i.dataService.multiaction().execute({actions:c})).done(function(t){var n;bizagi.chrono.stop("submitForm-ajax"),i.endLoading();var a="";if($.each(t,function(e,t){var r=i.validationToDisplayMessages(n,t.result.type,t.result.messages,a);n=r.bHasValidations,a=r.alertMessage}),n)""!==a&&bizagi.modalError.show(a,"workportal-general-word-information",!1),e.executeRule&&i.sendRollbackAction(e.id);else{if(!i.postProcessButton(t,e))return;e.refresh&&i.refreshForm(),e.routing&&(bizagi.jqxhrList.abortAll("rendering_"+i.dataService.guid),i.triggerHandler("routing",{idCase:i.params.idCase,routingDisabled:e.routingDisabled})),e.createnewcase&&t.length>0&&(bizagi.jqxhrList.abortAll("rendering_"+i.dataService.guid),i.triggerHandler("routing",{idCase:t[0].result.IdCase,caseNumber:t[0].result.CaseNumber}))}r.resolve()}).fail(function(t,t,n){e.executeRule&&i.sendRollbackAction(e.id),n&&n.error&&("WaitForCompletionPlanException"===n.error.errorType||"InvalidPlanStateException"===n.error.errorType||"CustomMessageException"===n.error.errorType)?(i.endLoading(),$.when(bizagi.showConfirmationBox(bizagi.localization.getResource(n.error.message),null,!1)).then(function(){return $.when(i.internalSubmitForm($.extend({},e,{forcePlanCompletion:!0})))}).done(function(){r.resolve()}).fail(function(){r.reject()})):(i.failHandler(n),r.reject(n))})}),r.promise()},validationToDisplayMessages:function(e,t,i,r){return"validationMessages"==t&&(this.addValidationMessage(i),e=!0),"desktop"==bizagi.detectDevice()&&"alertMessages"==t&&(r=""===r?i:r+"\n\n"+i,e=!0),{bHasValidations:e,alertMessage:r}},addValidationMessage:function(e,t,i,r,n,a){var o=this;o.validationController||(o.validationController=new bizagi.command.controllers.validation(o)),"string"==typeof e?o.validationController.showValidationMessage(e,t,i,r,a):$.each(e,function(e,n){o.validationController.showValidationMessage(n,t,i,r,a)}),o.validationController.expandNotificationBox(n)},clearValidationMessages:function(e){this.validationController&&this.validationController.clearValidationMessages(e)},addErrorMessage:function(e){this.validationController.showErrorMessage(e),this.validationController.expandNotificationBox()},refreshForm:function(e){var t=this,i=t.properties,r=$.Deferred();(e=e||t.getFocus())&&!e.id&&(e={id:e});var n={idCase:t.params.idCase||"",idWorkitem:t.params.idWorkitem||"",idTask:t.params.idTask||"",focus:e,selectedTabs:t.getSelectedTabs(),xpathContext:i.xpathContext,idPageCache:i.idPageCache,isRefresh:!0,contextType:t.getContextType()||"",action:t.getEndPointAction(),idStartScope:t.properties.idStartScope||""};return t.startLoading(),$.when(t.triggerHandler("refresh",n)).done(function(){t.endLoading(),r.resolve()}).fail(function(){t.endLoading(),r.reject()}),r.promise()},getSelectedTabs:function(){for(var e=this.getElementsByType("tab"),t=$.map(e,function(e){return{tab:e.properties.id,selected:e.activeTab}}),i={},r=0,n=t.length;r<n;r++)i[t[r].tab]=t[r].selected;return i},getButtons:function(){},addSubmitAction:function(e,t){this.actionController.processInternalSubmitAction(e,t)},startLoading:function(){var e=this,t=e.renderFactory.getTemplate("form-waiting");if(!e.waitingOverlay||!e.waitingMessage)if(bizagi.util.isTabletDevice())e.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo("body",$(document)),e.waitingMessage=$.tmpl(t).appendTo("body",$(document));else{var i="sharepoint"===e.params.context,r=e.params.canvas;i&&(r=bizagi.util.scrollTop(r)).context||(r=$("body",$(document)));var n=this.getSize(),a=this.getOffset();n.height==$(window).height()&&(a.top=0),e.waitingOverlay=$('<div class="ui-widget-overlay" />').appendTo(r),e.waitingMessage=$.tmpl(t).appendTo(r),e.waitingOverlay.css({height:"100%",width:"100%","min-height":n.height,"min-width":n.width}),e.waitingMessage.css({top:a.top+Math.ceil((n.height-e.waitingMessage.outerHeight())/2)+"px",left:Math.ceil((n.width-e.waitingMessage.outerWidth())/2)+"px"}),r.css("position","relative")}},endLoading:function(){var e=this;if(e.waitingOverlay&&e.waitingMessage){e.waitingOverlay.remove(),e.waitingMessage.remove(),e.waitingOverlay=null,e.waitingMessage=null;var t=e.params.canvas;null!=t&&t.css("position","")}},getFocusedElement:function(){return this.focus},setFocusedElement:function(e){this.focus=e},triggerGlobalHandler:function(e,t){return this.triggerHandler("globalHandler",{eventType:e,data:t})},failHandler:function(e){try{e=JSON.parse(e)}catch(e){}if(e&e.length&&e.length>1&&(e=e[0]),e.error&&(e=e.error),e.error&&(e=e.error),"object"==typeof e&&e.message)e="WaitForCompletionPlanException"===e.errorType||"InvalidPlanStateException"===e.errorType||"CustomMessageException"===e.errorType?bizagi.localization.getResource(e.message):e.message;else if("string"==typeof e)try{var t=JSON.parse(e);"WaitForCompletionPlanException"!==t.errorType&&"InvalidPlanStateException"!==t.errorType&&"CustomMessageException"!==e.errorType||(t.message=bizagi.localization.getResource(t.message)),e=t.message}catch(e){}this.addErrorMessage(e),this.endLoading()},resize:function(e){this.setSize(e)},setSize:function(e){this.size=e},getSize:function(){if(this.size)return this.size;var e=this.params.canvas?this.params.canvas:this.getFormContainer().container;return{width:e.width(),height:e.height()}},getOffset:function(){return this.getFormContainer().container.offset()},submitData:function(e){var t=this,i=t.collectRenderValuesForSubmit();if(bizagi.util.isOfflineForm({context:t})&&t.properties&&!t.properties.idPageCache&&(t.properties.idPageCache=""),$.each(i,function(e,i){var r=t.getRenders(e);$.each(r,function(e,t){t.updateOriginalValue()})}),!$.isEmptyObject(i))return $.when(t.dataService.multiaction().submitData({action:"SUBMITDATA",data:i,idPageCache:t.properties.idPageCache,xpathContext:t.properties.xpathContext,contexttype:t.properties.contexttype||""})).fail(function(e){e=t.processFailMessage(e)})},executeRule:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeRule({idPageCache:i.idPageCache,rule:e.rule,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(e){t.getFormContainer().clearValidationMessages({clearOnlyServer:!0}),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage.apply(t,[e.messages,void 0,void 0,void 0,!1,"serverMessage"]),"desktop"==bizagi.detectDevice()&&"alertMessages"==e.type&&bizagi.modalError.show(e.messages.join("\n\n"),"workportal-general-word-information",!1)}).fail(function(e){e=t.processFailMessage(e)})},executeInterface:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeInterface({idPageCache:i.idPageCache,interface:e.interface,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)}).fail(function(e){e=t.processFailMessage(e)})},executeSAPConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeSAPConnector({idPageCache:i.idPageCache,guidsap:e.guidsap,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)}).fail(function(e){e=t.processFailMessage(e)})},executeConnector:function(e){var t=this,i=t.properties,r=e.xpathContext;return""!=i.xpathContext&&(r=""!=r?i.xpathContext+"."+r:i.xpathContext),$.when(t.dataService.multiaction().executeConnector({idPageCache:i.idPageCache,guidConnector:e.guidConnector,xpathContext:r,contexttype:t.properties.contexttype||""})).done(function(e){t.getFormContainer().clearValidationMessages(),e&&"validationMessages"==e.type&&t.getFormContainer().addValidationMessage(e.messages)}).fail(function(e){e=t.processFailMessage(e)})},refreshActions:function(e){this.actionController.refreshActions(e)},removeActions:function(){this.actionController.unbindActions()},collectRenderValuesForSubmit:function(e){var t=this;return e=e||{},t.collectRenderValues(e),$.each(e,function(e,i){var r=t.getRenders(e);$.each(r,function(e,t){t.updateOriginalValue()})}),e},internalSubmitOnChange:function(e){var t=this,i=(e=e||{}).properties,r=new $.Deferred,n=e.data||{},a=void 0===e.bRefreshForm||e.bRefreshForm;(e.notCollect?e.notCollect:void 0)&&!$.isEmptyObject(n)||t.collectRenderValuesForSubmit(n),t.startLoading();var o=null;return n.deferreds&&(o=$.when.apply($,n.deferreds),delete n.deferreds),$.when(o).then(function(){t.dataService.submitData({action:"SUBMITONCHANGE",data:n,idRender:i.id,xpath:i.xpath,xpathContext:t.properties.xpathContext,idPageCache:i.idPageCache,contexttype:i.contexttype}).done(function(e){if(t.cancelPreviousRequest(),t.endLoading(),e&&"validationMessages"==e.type)"function"==typeof t.clearValidationMessages&&t.clearValidationMessages(),t.addValidationMessage(e.messages),r.resolve();else if(a){var n={id:i.id,xpath:i.xpath};void 0!==i.idCase&&$.extend(n,{idCaseObject:bizagi.cache.idCaseObject}),e.IdScope&&(t.properties.idStartScope=e.IdScope),$.when(t.refreshForm(n)).done(function(){r.resolve()}).fail(function(){r.resolve()})}else r.resolve()}).fail(function(e){t.endLoading();var i=JSON.parse("object"==typeof e&&e.responseText?e.responseText:{})||{},n=i.message||e;t.validationController.clearValidationMessages(),"alert"==i.type?t.validationController.showAlertMessage(n):t.validationController.showErrorMessage(n),r.resolve()})}),r.promise()},cancelPreviousRequest:function(){if(bizagi.multiactionConnection&&bizagi.multiactionConnection.length)for(var e,t=bizagi.multiactionConnection.length,i=0;i<t;i++)(e=bizagi.multiactionConnection.pop())&&e.abort&&(bizagi.showErrorAlertDialog=!1,e.abort())},prepareCheckpointAction:function(e){var t=this.dataService.sendCheckpoint({url:this.properties.checkpointUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0});return t.tag="checkpoint",t},prepareCommitAction:function(e){var t=this.dataService.commitLinkForm({url:this.properties.commitUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache,prepare:!0});return t.tag="commit",t},sendRollbackAction:function(e){this.dataService.rollbackLinkForm({url:this.properties.rollbackUrl,idRender:e,xpath:"",xpathContext:this.properties.xpathContext,idPageCache:this.properties.idPageCache})},dispose:function(){var e=this;e.endLoading(),setTimeout(function(){e.params&&delete e.params.canvas,delete e.params,delete e.control,e.validationController&&(e.unbind("rendervalidate"),delete e.validationController),e.actionController&&(e.actionController.unbindActions(),delete e.actionController)},bizagi.override.disposeTime||50),e._super()},getButton:function(e){return $(".ui-bizagi-button[data-id='"+e+"']",this.container)},getFloatingButton:function(e){return $("li[data-id='"+e+"']",this.container)},propagateExternalEvents:function(e){$(".bz-overflow-menu")&&$(document).trigger("click.overflow"),$(".jquery-image-zoom")&&"block"==$(".jquery-image-zoom").css("display")&&$("div.jquery-image-zoom a").click()},getButtonAction:function(e){return this.allowValidateAndSaveAction&&"validate"===e?"save":e}}),$.Class.extend("bizagi.rendering.formTemplate",{init:function(e){this._super(e),e.paramsRender&&e.paramsRender.contextEvent&&(self.contextEvent=e.paramsRender.contextEvent)},processTemplate:function(e,t){var i=e.replace(/\{\{(((repeater)\s*(\{["':,-\[\]\w\s]*\}))|([\/repeater]+:item)|(\/repeater)|(repeater)|(separator))\}\}/g,"");return i=(i=i.replace(/\{\{([\w:]*)\s*(\{["':,-\[\]\w\s]*\})\}\}/g,function(e,i,r,n,a){var o=JSON.parse(r);return t[o.id]||""})).replace(/{{([\w:]*)\s*}}/g,function(){return""})},renderContainer:function(){var e=this,t=e.getRenderByType("layout"),i=t.length>0?t[0]:{},r="function"==typeof i.getTemplate?i.getTemplate():"",n="function"==typeof i.getCss?i.getCss():"",a=e.getMode(),o=e.properties.layoutguid||Math.guid(),s={};return i.children&&$.each(i.children,function(t,i){if("execution"!=a||"layoutPlaceholder"!=i.properties.type){var r=i.getElementType();r==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&(s[i.properties.id]=i.renderElement()),r==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&(s[i.properties.id]=i.renderContainerHtml()),e.childrenHash[i.properties.uniqueId]=i}}),bizagi.util.loadStyle(n,o),e.processTemplate(r,s)},getContextEvent:function(){return self.contextEvent}}),$.Class.extend("bizagi.rendering.layout",{},{getTemplate:function(){var e=this.getMode(),t=this.properties.html||"";return"design"==e&&t&&(t="<div class='bz-design-template'>"+t+"</div>"),bizagi.util.stripslashes(t)},getCss:function(){var e=this.properties.css||"";return"design"==this.getMode()&&(e=e&&e.desktop),bizagi.util.stripslashes(e)},postRenderContainer:function(e){var t=this,i=t.getMode();t.renderingDeferred&&t.renderingDeferred.resolve(),t.container=e,t.executeChildrenPostRender(e),"execution"==i&&t.configureHandlers(),"design"==i&&t.configureDesignView(),"layout"==i&&(t.configureDesignView(),t.configureLayoutView())}}),$.Class.extend("bizagi.rendering.accordion",{},{initializeData:function(e){this._super(e),$.each(this.children,function(e,t){t.properties.ordinal=e})},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("accordion"),i=$.fasttmpl(t,{uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())}}),$.Class.extend("bizagi.rendering.accordionItem",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("accordionItem"),i=$.fasttmpl(t,{id:e.id,ordinal:e.ordinal,displayName:e.displayName,orientation:e.orientation,uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},activate:function(){this.active=!0},getFocus:function(){var e=this._super();return bizagi.util.isEmpty(e)&&this.active&&(e=this.properties.id),e}}),$.Class.extend("bizagi.rendering.collectionnavigator",{},{initializeData:function(e){var t=this;t._super(e);var i=t.properties;i.allowAdd=void 0===i.allowAdd||bizagi.util.parseBoolean(i.allowAdd),i.withAddForm=i.withAddForm&&i.allowAdd,i.allowEdit=void 0===i.allowEdit||bizagi.util.parseBoolean(i.allowEdit),i.withEditForm=i.withEditForm&&i.allowEdit,i.allowDetail=void 0!==i.allowDetail&&bizagi.util.parseBoolean(i.allowDetail),i.inlineAdd=void 0===i.inlineAdd||bizagi.util.parseBoolean(i.inlineAdd),i.inlineAdd=i.inlineAdd&&i.allowAdd,i.inlineEdit=void 0===i.inlineEdit||bizagi.util.parseBoolean(i.inlineEdit),i.inlineEdit=i.inlineEdit&&i.allowEdit,i.allowDelete=void 0===i.allowDelete||bizagi.util.parseBoolean(i.allowDelete),t.orientation=t.properties.orientation||"ltr",t.data=t.properties.data,t.keys=t.data?t.getKeys(t.data.rows):[],t.pointer=0,t.totalRows=0,t.inlineAddRecords=[],t.data&&(t.totalRows=t.data.rows.length)},getKeys:function(e){for(var t=[],i=0,r=(e=e||[]).length;i<r;i++){var n=e[i];t.push(n[0])}return t},renderControl:function(){var e=this,t=this.properties,i=e.renderFactory.getTemplate("collectionnavigator"),r=e.getMode(),n=$.fasttmpl(i,{uniqueId:t.uniqueId,displayName:t.displayName?t.displayName:"",id:t.id,guid:t.guid,showPreview:e.showPreview(),mode:r,orientation:e.getFormContainer().properties.orientation});return n=e.drawControls(n)},renderReadOnly:function(){return this.renderControl()},drawControls:function(e){},drawActions:function(e){},drawControl:function(e){},drawForms:function(e){},drawPreview:function(){var e="execution"===this.getMode()?"collectionnavigator-execution":"collectionnavigator-preview",t=this.renderFactory.getTemplate(e),i=$.tmpl(t);this.canvas.append(i)},hasData:function(){return this.getTotalRows()>0},getRow:function(){return this.keys[this.pointer]},getNextRow:function(){return this.getTotalRows()>this.pointer+1&&(this.pointer+=1),this.getRow()},getPreviousRow:function(){return this.pointer>0&&(this.pointer-=1),this.getRow()},getFirstRow:function(){return this.pointer=0,this.getRow()},getLastRow:function(){return this.pointer=this.keys.length-1,this.getRow()},getTotalRows:function(){return this.keys.length},getIndexes:function(){return this.properties.data.rows},setPointer:function(e){this.pointer=e-1},isTherePendingInlineRow:function(){return this.inlineAddRecords.length>0},addKey:function(e){this.keys.push(e)},removeKey:function(){var e=this.pointer;if(e>=0){this.keys.splice(e,1);var t=this.getTotalRows();t>0&&e>=t&&this.setPointer(t)}},showPreview:function(){var e=this.getMode(),t=this.properties;return"execution"==e?!this.hasData():!bizagi.util.parseBoolean(t.navigationform)},getParameters:function(e){var t={},i=this.properties,r=i.xpath+"[id="+e.id+"]";return t.idRender=i.id,t.recordXPath=r,t.xpathContext=i.xpathContext,t.idPageCache=i.idPageCache,t.requestedForm=e.requestedForm,t.contextType=i.contextType||i.contexttype,t.url=e.url,t.editable=e.editable,i.orientation,t},submitAddRequest:function(){var e=this.properties;return this.dataService.addGridRecord({url:e.addUrl,idRender:e.id,xpath:e.xpath,xpathContext:e.xpathContext,contexttype:e.contextType||e.contexttype,idPageCache:e.idPageCache,orientation:e.orientation||"ltr"}).pipe(function(e){return e.idEntity}).promise()},submitEditRequest:function(e){var t=this.properties,i=t.xpath+"[id="+e+"]";return this.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:i,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType||t.contexttype||"",orientation:t.orientation||"ltr"})},submitDeleteRequest:function(e){var t=this,i=t.properties,r=i.xpath+"[id="+e+"]";return t.dataService.deleteGridRecord({url:i.deleteUrl,idRender:i.id,xpath:r,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType||i.contexttype}).pipe(function(e){if("validationMessages"==e.type){var i=t.getFormContainer(),r=e.messages.join(" ");i.failHandler({message:r})}return e})},submitSaveRequest:function(e,t){var i=this,r=i.properties,n=$.Deferred(),a=r.xpathContext.length>0?r.xpathContext+"."+r.xpath+"[id="+e+"]":r.xpath+"[id="+e+"]",o=null;return t.deferreds&&(o=$.when.apply($,t.deferreds),delete t.deferreds),$.when(o).then(function(){i.dataService.saveGridRecord({url:r.saveUrl,idRender:r.id,xpath:r.xpath,xpathContext:a,contexttype:r.contextType||r.contexttype||"",submitData:t}).done(function(e){n.resolve(e)}).fail(function(e){var t=i.getFormContainer(),r=e.responseText?e.responseText:"string"==typeof e?e:e.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=e);t.validateForm(),t.clearValidationMessages(),t.addValidationMessage(r)})}),n.promise()},submitRollbackRequest:function(e){var t=this.properties;return this.dataService.rollbackGridAction({url:t.rollbackUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:e.idPageCache,contexttype:this.properties.contexttype||""})},getRemoteData:function(e){var t=this.properties;return e=e||{},$.extend(e,{url:t.dataUrl,xpath:t.xpath,idRender:t.id,xpathContext:t.xpathContext,contexttype:t.contextType||t.contexttype,idPageCache:t.idPageCache}),this.dataService.getData(e)},isValid:function(e){var t=this.form;return void 0!==t&&(t.children||[]).forEach(function(t){if(t.properties.visible)if(t.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER)t.isValid(e);else if(t.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&!t.isValid(e)){var i=e[e.length-1];e[e.length-1]=$.extend(i,{id:t.properties.id})}}),0===e.length},validateControls:function(e){return!!this.form&&this.form.validationController.performValidations(e)}}),$.Class.extend("bizagi.rendering.group",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.cssclass=t.cssclass||"cssClassContainer",t.collapse=!(void 0===t.collapse||!bizagi.util.parseBoolean(t.collapse))},renderContainer:function(){var e=this,t=this.properties,i=e.renderFactory.getTemplate("group");e.expandedIcon=e.getExpandedIcon(),e.collapsedIcon=e.getCollapsedIcon();var r=$.fasttmpl(i,{expandedClassIcon:e.expandedIcon,displayName:t.displayName,editable:t.editable,orientation:t.orientation,uniqueId:t.uniqueId,collapse:t.collapse,isDesign:"execution"!==e.getMode(),messageValidation:t.messageValidation,cssclass:t.cssclass,guid:t.guid});return r=e.replaceChildrenHtml(r,e.renderChildrenHtml())},getExpandedIcon:function(){},getCollapsedIcon:function(){},toogleContainer:function(e,t){}}),$.Class.extend("bizagi.rendering.horizontal",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("horizontal"),i=$.fasttmpl(t,{uniqueId:e.uniqueId});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())}}),$.Class.extend("bizagi.rendering.panel",{},{initializeData:function(e){this._super(e);var t=this.properties;t.displayName=t.displayName||""},renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("panel"),i=$.fasttmpl(t,{displayName:e.displayName,loading:e.loading,message:e.message,orientation:e.orientation,uniqueId:e.uniqueId,cssClass:e.cssclass});return i=this.replaceChildrenHtml(i,this.renderChildrenHtml())},postRenderContainer:function(e){var t=this.properties;t.height&&e.height(t.height),this._super(e)}}),$.Class.extend("bizagi.rendering.contentPanel",{},{initializeData:function(e){this._super(e);var t=this.properties;t.displayName=t.displayName||""},renderContainer:function(){var e=this,t=this.properties,i=e.renderFactory.getTemplate("contentPanel"),r=$.fasttmpl(i,{displayName:t.displayName,mode:e.getMode(),uniqueId:t.uniqueId,isDesign:"design"===e.getMode(),messageValidation:t.messageValidation,cssClass:t.cssclass,guid:t.guid});return r=e.replaceChildrenHtml(r,e.renderChildrenHtml())},postRenderContainer:function(e){this._super(e)}}),$.Class.extend("bizagi.rendering.searchForm",{},{renderContainer:function(){var e=this,t=this.properties,i=e.renderFactory.getTemplate("searchForm");"entity"!=t.contexttype&&e.parent&&(t.contexttype="function"==typeof e.parent.getContextType?e.parent.getContextType():"");var r=$.fasttmpl(i,{displayName:t.displayName,uniqueId:t.uniqueId});return r=(r=e.replaceChildrenHtml(r,e.renderChildrenHtml())).replace("{{result}}",e.renderResult())},performSearch:function(e){this.properties.searchParams=e,this.submitSearch()},submitSearch:function(){this.refreshResults()},ready:function(){return this.parent.ready()},getRemoteData:function(e){var t=this,i=t.properties,r=new $.Deferred,n=t.collectSearchValues();return bizagi.util.isMapEmpty(n)?(bizagi.showMessageBox(this.getResource("render-search-advanced-no-filters"),this.getResource("render-form-dialog-box-search"),"error"),null):(e.rows=i.searchParams&&i.searchParams.maxRecords&&i.searchParams.maxRecords>0?i.searchParams.maxRecords:e.rows,i.searchParams&&void 0!==i.searchParams.maxRows&&(e.rows=i.searchParams.maxRows||e.rows),t.dataService.submitSearch($.extend(e,{url:i.dataUrl,idRender:i.idRender,idPageCache:i.idPageCache,idSearchForm:i.id,allowFullSearch:i.searchParams.allowFullSearch?i.searchParams.allowFullSearch:null,maxRecords:i.searchParams.maxRecords>0?i.searchParams.maxRecords:null,criteria:n})).done(function(e){i.page=e.page,i.records=e.records,i.totalPages=e.totalPages||0,e.records>1e4?(i.deviceMaxRecordsExceeded=!0,e.deviceMaxRecordsExceeded=!0):delete i.deviceMaxRecordsExceeded,r.resolve(e),t.onSearchFinished()}).fail(function(e){if(bizagi.showErrorAlertDialog=!1,e.responseText)try{var t=JSON.parse(e.responseText).message;bizagi.showMessageBox(t,"","error")}catch(e){}r.reject()}),r.promise())},collectSearchValues:function(){var e={};this.collectRenderValues(e);var t=[];for(key in e){var i=key,r=e[key],n=this.getCriteriaOperation(this.getRender(i)),a={};bizagi.util.isEmpty(r)||(a.xpath=i,a.value=r,a.operation=n,t.push(a))}return t},getCriteriaOperation:function(e){var t=this.properties,i="EQUALS";return"15"==e.properties.dataType&&(void 0!==e.properties.typeSearch&&"approx"!==e.properties.typeSearch||(i=t.allowFullSearch?"FULLLIKE":"LIKE")),i},renderResult:function(){},refreshResults:function(){},parseAdditionalProperties:function(e){return 1==e||2==e||3==e||4==e||6==e||7==e||10==e||11==e?{type:"columnNumber"}:29==e?{type:"columnNumberScientificNotation"}:8==e?{type:"columnMoney"}:12==e||13==e?{type:"columnDate"}:5==e?{type:"columnBoolean"}:{type:"columnText"}},onSearchFinished:function(){}}),$.Class.extend("bizagi.rendering.tab",{},{initializeData:function(e){this._super(e);var t=this.properties;t.helpText=t.helpText||t.displayName,t.cssclass=t.cssclass||""},renderContainer:function(){for(var e=this,t=this.properties,i=$.map(e.children,function(e,t){return e.properties.counter=t,e.properties.tooltip=e.properties.tooltip||e.properties.displayName||"",e.properties}),r=e.renderFactory.getTemplate("tab"),n=e.getMode(),a=$.fasttmpl(r,{id:t.id,tabs:i,mode:n,isDesign:"execution"!==e.getMode(),editable:t.editable,tabOrientation:t.orientation,uniqueId:t.uniqueId,cssclass:t.cssclass}),o=e.activeTab=e.getActiveTab(),s=0,l=e.children.length;s<l;s++)e.children[s].properties.loadOnDemand=s!=o;return a=e.replaceChildrenHtml(a,e.renderChildrenHtml())},getActiveTab:function(){var e=this,t=e.properties,i=this.getFormContainer().getParams();"execution"===e.getMode()&&!i.isRefresh&&t.activeTab&&e.getFormContainer().setFocusedElement(t.activeTab);var r=i&&i.selectedTabs?i.selectedTabs:{};if(r[e.properties.id]>=0)return r[e.properties.id];for(var n=0,a=e.children.length;n<a;n++)if(e.children[n].containsFocusedElement())return n;return 0},setActiveTab:function(e){var t=this;if(t.triggerHandler("selected",{index:e,tab:t.children[e]}),t.children[e]){var i=t.getFormContainer();t.children[e].activate(),t.activeTab=e;var r={};r[t.children[e].parent.properties.id]=e,i.setParam("selectedTabs",r)}}}),$.Class.extend("bizagi.rendering.tabItem",{},{renderContainer:function(){var e=this.properties,t=this.renderFactory.getTemplate("tabItem"),i=$.fasttmpl(t,{id:e.id,uniqueId:e.uniqueId,counter:e.counter,isDesign:"execution"!==this.getMode()});return i=this.renderTabContent(i)},renderTabContent:function(e){return this.replaceChildrenHtml(e,this.renderChildrenHtml())},activate:function(){this.active=!0},getFocus:function(){var e=this._super();return bizagi.util.isEmpty(e)&&this.active&&(e=this.properties.id),e},containsFocusedElement:function(){var e=this,t=e.getFormContainer().getFocusedElement();if(t){if(t.xpath){var i=e.getFormContainer().getRenders(t.xpath);$.each(i,function(e,i){i.properties.id==t.id&&i.properties.editable&&(r=i)})}else var r=e.getFormContainer().getContainer(t)||e.getFormContainer().getRenderById(t);if(r)for(;r.parent;){if(r.properties.id==e.properties.id||r.parent.properties.id==e.properties.id)return!0;r=r.parent}}return!1}}),$.Class.extend("bizagi.rendering.nestedForm",{},{}),$.Class.extend("bizagi.rendering.combo",{},{initializeData:function(e){this._super(e);var t=this.properties;t.hasLocalData=t.data||!1,t.value=t.value&&t.value.length>0?t.value[0]:t.defaultValue&&t.defaultValue.length>0?t.defaultValue[0]:null,void 0===t.enableTyping&&(t.enableTyping=!0),t.value&&void 0===t.value.id&&(t.value=null),this.value=t.value,t.hasLocalData&&(t.data=this.complementData(t.data)),t.loadOnDemand=!1},renderControl:function(){var e=this,t={},i=bizagi.util.normalizeType(e.properties.type);if(e.isDependant&&e.properties&&/^cascadingcombo$/i.test(i)&&e.getParentCombo){var r=e.getParentCombo().getValue();r&&r.id&&(t[e.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=r.id)}return e.renderCombo(t)},renderCombo:function(e){var t=this;if(t.properties.loadOnDemand)return t.renderComboTemplate();var i=new $.Deferred,r=t.getData(e);return $.when(r).done(function(e){var r=t.renderComboTemplate(e);t.properties.data=e,i.resolve(r)}).fail(function(e){var r=t.renderComboTemplate({});i.resolve(r)}),i.promise()},renderComboTemplate:function(e){var t=this,i=t.properties,r=t.renderFactory.getTemplate(t.getTemplateName()),n=bizagi.override.emptyLabelForCombo||t.getResource("render-combo-empty-selection"),a=i.value?"":n;return e=e||t.properties.data||{},"columnCombo"!==t.properties.type||""!==a||"object"!=typeof i.value||""!==i.value.id||""!==i.value.value&&i.value.value!==t.getResource("render-combo-empty-value")||(a=t.getResource("render-combo-empty-selection")),$.fasttmpl(r,$.extend(t.getTemplateParams(),{id:i.id,xpath:i.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:i.idPageCache,items:e,align:i.valueAlign,value:a,editable:i.editable}))},postRenderReadOnly:function(){var e=this;e._super();var t=e.getValue(),i=e.getControl();e.control&&e.control.parent()&&e.control.parent().addClass("ui-bizagi-noneditable-"+e.properties.displayType),t?(null!=t.value&&"boolean"==typeof t.value&&(!0===bizagi.util.parseBoolean(t.value)?t.value=this.getResource("render-boolean-yes"):0==bizagi.util.parseBoolean(t.value)&&(t.value=this.getResource("render-boolean-no"))),e.getResource("render-combo-empty-value")===t.value||e.getResource("render-combo-empty-selection")===t.value?i.text(""):i.html("<label class='readonly-control'>"+e.formatItem(t.value)+"</label>")):i.text("")},getTemplateName:function(){return"combo"},showEmpty:function(){return!0},showCurrentData:function(){return!0},getData:function(e){var t=this,i=t.properties,r=new $.Deferred;if("execution"!==t.getMode())return t.getDummyData();if(i.hasLocalData)r.resolve(i.data);else{var n=bizagi.util.normalizeType(i.type);i.remoteDataLoaded&&!/^cascadingcombo$/i.test(n)?r.resolve(i.data):t.dataService.multiaction().getData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,extra:e,contexttype:t.properties.contexttype||null}).done(function(e){i.recalculate||(i.remoteDataLoaded=!0),i.data=t.complementData(e),r.resolve(i.data)}).fail(function(e){if("not-processed"!==e.type){var i=t.getFormContainer(),n=t.properties.displayName+": ";if("string"==typeof e)var a=JSON&&JSON.parse(e)||$.parseJSON(e);else a=e;n+=a.message,i.addValidationMessage(n),r.reject(e)}})}return r.promise()},getDummyData:function(){var e=this.properties;return e.data?e.data:(e.data=[],e.data=this.complementData(e.data),e.data.push({id:"",value:"Item 1"}),e.data.push({id:"",value:"Item 2"}),e.data)},resetData:function(){var e=this.properties;e.hasLocalData=!1,e.data=null,e.remoteDataLoaded=!1},getDisplayValue:function(){var e=this;if(e.combo&&e.combo.length>0)return e.getSelectedValue();var t="",i=e.getValue();return i&&(t=e.formatItem(i.value)),t},getSelectedValue:function(){},getTemplateParams:function(){return{}},formatItem:function(e){if(null!=e){if($.isArray(e)){for(var t=0,i=e.length;t<i;t++)null!=e[t]&&"boolean"==typeof e[t]&&(!0===bizagi.util.parseBoolean(e[t])?e[t]=this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e[t])&&(e[t]=this.getResource("render-boolean-no")));return e.join(" - ")}return e}return""},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();this.controlValueIsChanged()&&(bizagi.util.isEmpty(i)||null==r||("object"!=typeof r||void 0!==r.id&&""!==r.id?e[t.xpath]=void 0!==r.id?r.id:"":e[t.xpath]=""))},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue,n=!0;return $.forceCollectData?n:(t=t&&void 0!==t.length?t[0]:t,i=i&&void 0!==i.length?i[0]:i,r=r&&void 0!==r.length?r[0]:r,t=t&&void 0!==t.id?t.id:t,i=i&&void 0!==i.id?i.id:i,n=void 0!==(r=r&&void 0!==r.id?r.id:r)?r!=i||r!=t:t!=i)},parseAdditionalValues:function(e){var t=this;return $.map(e,function(e){var i=e.value?t.formatItem(e.value):e,r={id:e.id,value:i};return e.hidden&&(r.hidden=!0),e})},complementData:function(e){var t=this,i=t.properties,r=!1;if($.each(e,function(e,n){void 0!==n.value&&null!==n.value?(n.value=t.formatItem(n.value),i.value&&n.id==i.value.id&&(r=!0)):n.value=""}),t.showEmpty()){for(var n=!1,a=0,o=e.length;a<o;a++)if(""===e[a].id){n=!0;break}if(!n){var s=bizagi.override.emptyLabelForCombo||bizagi.localization.getResource("render-combo-empty-value");e.unshift({id:"",value:s})}}return i.value&&!r&&t.showCurrentData()&&e.unshift({id:i.value.id,value:i.value.value,hidden:!0}),t.parseAdditionalValues(e)},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmpty(e)&&("[object Object]"!==Object.prototype.toString.apply(e)||!bizagi.util.isEmpty(e.id)&&0!=e.id)},cleanData:function(){var e={id:"",label:""};this.setDisplayValue(e),this.setValue(e,!1)},beforeToRefresh:function(){this.column&&!this.column.comboData&&this.getData()},isExtraItem:function(){var e=(this.value||{}).value||"";return""===e||e===this.getResource("render-combo-empty-selection")||e===this.getResource("render-combo-empty-value")},escapeValue:function(e){return bizagi.util.isString(e)?e.replaceAll("<","&lt;").replaceAll(">","&gt;"):e},mapValue:function(e){return e&&e.fromAction?{id:e.value,value:e.label,label:e.label}:e},validateValue:function(e){if(null!=e.id&&("number"==typeof e.id&&null!==e.id||"string"==typeof e.id&&e.id.length>0))if(null!==e.value&&"boolean"==typeof e.value)translated=!0,!0===bizagi.util.parseBoolean(e.value)?e.value=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value)&&(e.value=bizagi.localization.getResource("render-boolean-no"));else if(null!=e.value&&"object"==typeof e.value)for(var t=0,i=e.value.length;t<i;t++)null!=e.value[t]&&"boolean"==typeof e.value[t]&&(!0===bizagi.util.parseBoolean(e.value[t])?e.value[t]=bizagi.localization.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e.value[t])&&(e.value[t]=bizagi.localization.getResource("render-boolean-no")));return e},findDataValueById:function(e){return(this.properties.data||[]).find(function(t){return t.id==e})}}),$.Class.extend("bizagi.rendering.check",{},{initializeData:function(e){this._super(e);var t=this.properties;t.value=void 0!==t.value?bizagi.util.parseBoolean(t.value):null,t.showLetters=bizagi.override&&!0===bizagi.override.enableCheck&&!t.editable},renderControl:function(){var e=this.renderFactory.getTemplate("check"),t=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(e,{id:t,editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()},postRender:function(){this._super()},getDisplayValue:function(){var e=this.getValue();return!0===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-no"):""},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmpty(e)&&!(!1===bizagi.util.parseBoolean(e)&&this.properties.required)}}),$.Class.extend("bizagi.rendering.number",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");t.allowDecimals=void 0!==t.allowDecimals?bizagi.util.parseBoolean(t.allowDecimals):this.getDefaultAllowDecimals(t.dataType),t.numDecimals=t.allowDecimals?t.numDecimals?t.numDecimals:"undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits:2:0,t.symbol="",t.positiveFormat=i.positiveFormat,t.negativeFormat=i.negativeFormat,t.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:i.decimalSymbol,t.digitGroupSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator:i.digitGroupSymbol,t.groupDigits=this.setGroupDigits(),t.colorize=t.colorizeOnNegative||!1,t.dataTypeMinValue=this.calculateMinValue(t.dataType),t.dataTypeMaxValue=this.calculateMaxValue(t.dataType)},renderControl:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{editable:this.properties.editable,value:bizagi.isMobile()?this.getDisplayValue():"",type:bizagi.util.isAndroidDevice()?"tel":"text",isDesign:"execution"!==this.getMode()})},postRender:function(){var e=this;e._super();var t=e.getControl(),i=e.properties;e.numericInput=t.find("input"),e.numericInput.numeric(e.properties.decimalSymbol),"double"===i.retype&&e.attachRetypeDouble()},configureHandlers:function(){this.attachFormatCurrency()},removeValidations:function(){(this.getFormContainer().parent||this.getFormContainer()).clearValidationMessages()},attachRetypeDouble:function(){},attachFormatCurrency:function(){var self=this,properties=self.properties,message=bizagi.localization.getResource("render-number-retype-fail");self.isValidRender=self.isValidRender||!0,null==$.formatCurrency.regions[bizagi.language]&&($.formatCurrency.regions[bizagi.language]=this.getResource("numericFormat")),self.numericInput.blur(function(){void 0===self.getFormContainer().validationController&&(self.getFormContainer().validationController=new bizagi.command.controllers.validation(self.getFormContainer(),self.validations));var e=self.getFormContainer().validationController||self.getFormContainer().parent.validationController,t=".",i=",";"undefined"==typeof BIZAGI_DEFAULT_CURRENCY_INFO?(t=self.getResource("numericFormat").decimalSymbol||".",i=self.getResource("numericFormat").digitGroupSymbol||","):(t=BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator,i=BIZAGI_DEFAULT_CURRENCY_INFO.groupSeparator);var r=self.getMinValue(),n=self.getMaxValue();properties.percentage&&self.numericInput.val(self.numericInput.val().replace("%",""));var a=self.numericInput.val();a=(a=","==t?a.replace(/\,0+$/,""):a.replace(/\.0+$/,"")).replace(properties.symbol,""),-1!=(a=bizagi.util.replaceAll(a,i,"")).toString().indexOf(t)&&(","==t&&(a=a.replace(/([0-9]+(\,[0-9]+[1-9])?)(\,?0+$)/,"$1")),"."==t&&(a=a.replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1"))),null!=a&&a.length>0&&self.numericInput.val(a),/(.+)-$/.test(a)&&(a=a.replace(/(.+)-$/,"-$1"),self.numericInput.val(a));var o=a.replace(/[^0-9]+/g,"").length,s=self.properties.xpath,l=self.numericInput.val();if(null!=self.isInvalidFormat&&1==self.isInvalidFormat||""!=a&&-1!=["$","£","€","¥",properties.symbol].indexOf(a))return self.setValue(""),self.getControl().find("input").val(""),void self.numericInput.val("");if(""!=bizagi.util.trim(a)){var d=parseFloat(a.replace(",","."));if(isNaN(d)&&(d=self.numericInput.asNumber()),message=void 0!==r&&null!=r&&d<r?bizagi.localization.getResource("render-numeric-minimum-validation").replaceAll("#label#",properties.displayName+" ("+l+")").replaceAll("#minValue#",r.toString()):null!=n&&d>n?bizagi.localization.getResource("render-numeric-maximum-validation").replaceAll("#label#",properties.displayName+" ("+l+")").replaceAll("#maxValue#",n.toString()):message+" "+l,null!=r&&d<r||null!=n&&d>n||10==self.properties.dataType&&o>15||1==self.properties.dataType&&o>19||11==self.properties.dataType&&o>7||11==self.properties.dataType&&o>7||l.match(/[^$£€¥,-.()\d]/)){if(void 0!==e&&null!=e){self.removeValidations();var u=message;-1===u.indexOf(l)&&(u=message+" "+l),e.showValidationMessage(u,s),self.isValidRender=!1,self.isValidRenderMessage=u}message=message.replace(l,"")}else self.isValidRender=!0,self.isValidRenderMessage="",this.value.toString().length>0&&!properties.allowDecimals&&!properties.groupDigits?(this.value=this.value.toString().replace(/^0+/,""),properties.symbol.length>0&&(this.value=this.value.toString().replace(properties.symbol+"0",properties.symbol)),this.value=this.value.toString().replace(/^0+/,""),0==this.value.replaceAll("0","").length?this.value=properties.symbol+"0":this.value.toString()==parseInt(this.value)&&(this.value=properties.symbol+this.value)):"money"!==self.properties.type&&"number"!==self.properties.type&&"columnMoney"!==self.properties.type&&"columnNumber"!==self.properties.type||(this.value=this.value.toString().replace(/^0+/,""),""===this.value&&(this.value=0)),self.executeFormatCurrencyPlugin(),self.setValue(self.numericInput.asNumber({symbol:properties.symbol,positiveFormat:properties.positiveFormat,negativeFormat:properties.negativeFormat,decimalSymbol:properties.decimalSymbol,digitGroupSymbol:properties.digitGroupSymbol,groupDigits:properties.groupDigits})),properties.percentage&&self.numericInput&&-1==self.numericInput.val().indexOf("%")&&self.numericInput.val(self.numericInput.val()+"%"),message=message.replace(l,"")}else self.setValue("")}).bind("paste",function(e){try{var tmpData=bizagi.util.isIE()||bizagi.util.isIE11()?window.clipboardData.getData("text"):e.originalEvent.clipboardData.getData("Text"),totalVal="/[^0-9";properties.decimalSymbol.length>0&&(totalVal+=properties.decimalSymbol),8==properties.dataType&&(properties.symbol.length>0&&(totalVal+=properties.symbol),properties.digitGroupSymbol.length>0&&(totalVal+=properties.digitGroupSymbol)),totalVal+="\\-\\s]/gi";try{tmpData.replace(eval(totalVal),"").length!=tmpData.length&&e.preventDefault()}catch(e){}}catch(e){bizagi.log("Error to pasting content"),self.isInvalidFormat=!0}}).keydown(function(e){self.previousValue=this.value;var t=(e=window.event&&window.event.preventDefault?window.event:e).charCode||e.keyCode;if("undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO&&0==BIZAGI_DEFAULT_CURRENCY_INFO.decimalDigits&&(properties.allowDecimals=!1),(properties.dataType<5||8==properties.dataType&&0==properties.allowDecimals)&&(188!=t&&190!=t&&110!=t||e.preventDefault()),this.value&&void 0!==e&&this.value.length>0&&(8==properties.dataType||10==properties.dataType))if(t>47&&t<58){self.formatTimeout&&clearTimeout(self.formatTimeout);var i=this.value+"";properties.digitGroupSymbol&&properties.digitGroupSymbol.length>0&&(i=i.replaceAll(properties.digitGroupSymbol,"")),properties.symbol.length>0&&(i=i.replaceAll(properties.symbol,"")),i=$.trim(i),properties.decimalSymbol&&properties.decimalSymbol.length>0&&(i=i.replaceAll(properties.decimalSymbol,".")),10*i>properties.dataTypeMaxValue&&e.preventDefault()}else if(109==t||189==t)if(0!=this.selectionStart||this.selectionEnd!=this.value.length){var r=this.selectionEnd;this.value=properties.symbol+"-"+this.value.replace(properties.symbol,""),this.selectionStart=this.selectionEnd=r+1}else 0==this.selectionStart&&this.selectionEnd==this.value.length&&(this.value="-",this.selectionStart=this.selectionEnd=this.value.length)}).keyup(function(e){var t=(e=window.event||e).charCode||e.keyCode;if(void 0!==e)switch(t){case 16:case 17:case 13:case 18:break;case 27:this.value=""}}).keypress(function(e){var t=(e=window.event&&window.event.preventDefault?window.event:e).charCode||e.keyCode;if(void 0!==e){35==t||37==t||39==t?e.preventDefault():8!=properties.dataType&&36==t&&e.preventDefault();var i=String.fromCharCode(t);!1===properties.allowDecimals&&0===properties.numDecimals&&i===properties.decimalSymbol&&e.preventDefault()}})},executeFormatCurrencyPlugin:function(){var e=this,t=e.properties;if(e.numericInput&&e.numericInput.formatCurrency({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize}),8!==t.dataType&&!0===bizagi.override.removeTrailingZeros){var i=e.numericInput.val(),r=!0;-1!==i.indexOf(")")&&(r=!1,i=i.replace("(","").replace(")",""));var n=new RegExp("("+t.decimalSymbol+"\\d*?[1-9])0+$","g");i=i.replace(n,"$1"),n=new RegExp("\\"+t.decimalSymbol+"0+$","g"),i=i.replace(n,""),e.numericInput.val(i),r||e.numericInput.val("("+i+")")}t.percentage&&e.numericInput.val(e.numericInput.val()+"%")},getDisplayValue:function(){var e=this.properties,t=this.getControl(),i=void 0!==this.getValue()?this.getValue():$("input",t).val()||"",r=$("<label/>").html(i);if(r.formatCurrency({symbol:e.symbol,positiveFormat:e.positiveFormat,negativeFormat:e.negativeFormat,decimalSymbol:e.decimalSymbol,digitGroupSymbol:e.digitGroupSymbol,groupDigits:e.groupDigits,roundToDecimalPlace:e.numDecimals,colorize:e.colorize}),e.percentage&&(r=$("<label/>").html(r.text()+"%")),!e.editable&&8!==e.dataType&&!0===bizagi.override.removeTrailingZeros){var n=!0;-1!==(i=r.text()).toString().indexOf(")")&&(n=!1,i=i.replace("(","").replace(")",""));var a=new RegExp("("+e.decimalSymbol+"\\d*?[1-9])0+$","g");return i=i.replace(a,"$1"),a=new RegExp("\\"+e.decimalSymbol+"0+$","g"),i=i.replace(a,""),n||(i="("+i+")"),i}return r.text()},isValid:function(e){var t,i=this,r=i.properties,n=this._super(e),a=i.getValue(),o=i.getMinValue(),s=i.getMaxValue();if("string"==typeof a&&""!=a&&(a=Number(a)),i.hasValue()&&(bizagi.util.isEmpty(o)||a<o&&(t=this.getResource("render-numeric-minimum-validation").replaceAll("#label#",r.displayName.toString()+" ("+a+")").replaceAll("#minValue#",o.toString()),e.push({xpath:r.xpath,message:t}),n=!1),bizagi.util.isEmpty(s)||a>s&&(t=this.getResource("render-numeric-maximum-validation").replaceAll("#label#",r.displayName.toString()+" ("+a+")").replaceAll("#maxValue#",s.toString()),e.push({xpath:r.xpath,message:t}),n=!1)),!(!1!==i.isValidRender||n&&bizagi.util.isMobileDevice())){n=!1;var l=i.isValidRenderMessage?i.isValidRenderMessage:"error";e.push({xpath:r.xpath,message:l})}return n},getMinValue:function(){var e=this.properties.minValue;return null!=e?e:this.properties.dataTypeMinValue},getMaxValue:function(){var e=this.properties.maxValue;return null!=e?e:this.properties.dataTypeMaxValue},getDefaultAllowDecimals:function(e){if(e){if(1===e||2===e||3===e||4===e||7===e)return!1;if(6===e||8===e||10===e||11===e)return!0}return!1},getDefaultGroupDigits:function(e){if(e){if(1===e||2===e||3===e||4===e||7===e)return!1;if(6===e||8===e||10===e||11===e)return!0}return!1},setGroupDigits:function(){var e=this;return void 0!==e.properties.thousands?!!e.properties.digitGroupSymbol&&bizagi.util.parseBoolean(e.properties.thousands):!!e.properties.digitGroupSymbol&&this.getDefaultGroupDigits(e.properties.dataType)},calculateMinValue:function(e){return 8===e||10===e?-922337203685477:4===e?0:3===e?-32768:2===e?-2147483648:1===e?-999999999999999:null},calculateMaxValue:function(e){return 8===e||10===e?922337203685477:4===e?255:3===e?32767:2===e?2147483647:1===e?999999999999999:null},changeMinValue:function(e){var t=Number(e);this.properties.minValue=this.properties.dataTypeMinValue=Number.isNaN(t)?this.calculateMinValue(this.properties.dataType):t},changeMaxValue:function(e){var t=Number(e);this.properties.maxValue=this.properties.dataTypeMaxValue=Number.isNaN(t)?this.calculateMaxValue(this.properties.dataType):t},createTooltip:function(e,t,i){e.data("oldValue",t),e.val("");try{e.tooltip("destroy")}catch(e){}e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",function(e,t){t.tooltip.zIndex(r)}),e.tooltip("open"),setTimeout(function(){e.focus()},100)}}),$.Class.extend("bizagi.rendering.numberScientificNotation",{initializeData:function(e){this._super(e),this.properties.decimalSymbol="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.decimalSeparator:format.decimalSymbol},renderControl:function(){var e=this.renderFactory.getTemplate("numberScientificNotation");return $.fasttmpl(e,{})},postRender:function(){var e=this.getControl();this.numericInput=e.find("input"),this.numericInput.numericSN(this.properties.decimalSymbol)},getDisplayValue:function(){return this.getValue().replace(".",this.properties.decimalSymbol)},setValue:function(e){e=(e||"").toString().replace(this.properties.decimalSymbol,"."),this._super(e)},controlValueIsChanged:function(){var e=this.properties,t=this.getValue()||"",i=e.originalValue||"";return!!$.forceCollectData||i.toLowerCase()!=t.toLowerCase()}}),$.Class.extend("bizagi.rendering.date",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("dateFormat"),r=this.getResource("timeFormat");if(t.displayValue="",t.showTime=void 0!==t.showTime&&bizagi.util.parseBoolean(t.showTime),t.dateFormat=t.dateFormat||i,t.timeFormat=t.timeFormat||r,t.fullFormat=t.dateFormat,t.showTime&&-1===t.fullFormat.search(/[h|H]+/gi)&&(t.fullFormat=t.fullFormat+" "+t.timeFormat),t.value){var n=bizagi.util.dateFormatter.getDateFromInvariant(t.value,t.showTime);if(0!=n){this.value=t.value;var a=bizagi.localization.getResource("datePickerRegional");t.displayValue=bizagi.util.dateFormatter.formatDate(n,t.fullFormat,a)}else this.value=null}},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("date"),i=e.dateFormat.substring(0,e.dateFormat.indexOf(":")).lastIndexOf(" "),r=i>0?e.dateFormat.substring(0,i):e.dateFormat;return $.fasttmpl(t,{showTime:e.showTime,value:e.value,editable:e.editable,dateFormat:bizagi.override&&!0===bizagi.override.uppercaseDatePlaceholder?r.toUpperCase():r,timeFormat:e.showTime&&i>0?e.dateFormat.substring(i):"",rtl:"rtl"==e.orientation})},configureHandlers:function(e,t){var i=this,r=i.properties,n=i.getDateControl(),a=i.getTimeControl();r.mask&&n.mask({mask:r.mask}),n.bind("change",function(){i.onChangeHandler()}),r.showTime&&a.bind("change",function(e,t){i.updatingTime?delete i.updatingTime:i.onChangeHandler(t)})},onChangeHandler:function(){},getDisplayValue:function(e){var t,i=this.properties;if(!i.displayValue&&e){var r=bizagi.util.dateFormatter.getDateFromInvariant(e,i.showTime),n=bizagi.localization.getResource("datePickerRegional");t=bizagi.util.dateFormatter.formatDate(r,i.fullFormat,n)}else t="";return i.displayValue||t||""},collectData:function(e){var t=this.properties,i=t.xpath,r=this.getValue();if(this.controlValueIsChanged()&&!bizagi.util.isEmpty(i))if(bizagi.util.isEmpty(r))""===r&&(e[t.xpath]="");else{var n=bizagi.util.dateFormatter.getDateFromInvariant(r,t.showTime);void 0!==n&&0!==n&&(t.showTime||n.setHours(0,0,0,0),e[t.xpath]=bizagi.util.dateFormatter.formatInvariant(n,!0))}},getDateControl:function(){},getTimeControl:function(){},isValid:function(e){var t,i=this,r=i.properties,n=this._super(e),a=i.getValue();if(a&&(!0===bizagi.util.parseBoolean(r.editable)&&0!=(a=bizagi.util.dateFormatter.getDateFromInvariant(a,r.showTime)))){if(a.setSeconds(0),a.setMilliseconds(0),r.minValue&&("string"==typeof r.minValue||"number"==typeof r.minValue)){var o="string"==typeof r.minValue?bizagi.util.dateFormatter.getDateFromInvariant(r.minValue,r.showTime):new Date(r.minValue);o.setSeconds(0),o.setMilliseconds(0),a<o&&(t=this.getResource("render-date-minimum-validation").replaceAll("#label#",r.displayName).replaceAll("#minValue#",bizagi.util.dateFormatter.formatDate(o,r.fullFormat)),e.push({xpath:r.xpath,message:t}),n=!1)}if(r.maxValue&&("string"==typeof r.maxValue||"number"==typeof r.maxValue)){var s="string"==typeof r.maxValue?bizagi.util.dateFormatter.getDateFromInvariant(r.maxValue,r.showTime):new Date(r.maxValue);s.setSeconds(0),s.setMilliseconds(0),a>s&&(t=this.getResource("render-date-maximum-validation").replaceAll("#label#",r.displayName).replaceAll("#maxValue#",bizagi.util.dateFormatter.formatDate(s,r.fullFormat)),e.push({xpath:r.xpath,message:t}),n=!1)}}if(r.showTime&&!0===bizagi.util.parseBoolean(r.editable)&&r.required&&i.hasValue()){var l=i.getDateControl(),d=i.getTimeControl();if(l.length>0&&d.length>0&&l.val().length>0&&0==d.val().length)return t=i.getResource("render-required-text").replaceAll("#label#",r.displayName),e.push({xpath:r.xpath,message:t}),!1}return n}}),$.Class.extend("bizagi.rendering.extendedText",{},{initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.hasMaxLines=!!this.properties.maxLines;var t=this.properties;if(t.maxLines=this.properties.maxLines||6,t.regularExpressionExpression){var i=t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message");t.regularExpression={expression:t.regularExpressionExpression,message:i}}},renderControl:function(){var e=this.renderFactory.getTemplate("extendedText");return $.fasttmpl(e,{isEmptyField:void 0===this.properties.value,editable:this.properties.editable})},postRender:function(){var e=this;e._super();var t=e.getControl();e.textarea=t.find("textarea"),e.textarea?e.textarea.css({resize:"both"}):e.textarea.css({resize:"none"}),"double"===e.properties.retype&&e.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var e=this,t=e.properties;t.maxLength&&e.textarea.prop("maxlength",t.maxLength),t.maxLines?e.textarea.prop("rows",t.maxLines):e.textarea.prop("rows",6),e.textarea.bind("change",function(){e.setValue(e.textarea.val());var i=[];if("duplicate"!==t.retype)if(e.isValid(i)||void 0===t.regularExpression)e.setValue(e.textarea.val(),!0);else{var r=i[0].message;bizagi.showMessageBox(r,"Bizagi","error")}}),e.textarea.bind("blur",function(){e.setValue(e.textarea.val())})},isValid:function(e){var t,i=this.properties,r=this._super(e),n=this.getValue(),a=new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g");return this.isOfflineForm&&bizagi.util.isMobileDevice()&&(n=n&&"object"==typeof n&&n.value?n.value:n),i.regularExpression?n&&(n.match(a)||!n.match(new RegExp(i.regularExpression.expression))&&this.properties&&"userName"===this.properties.xpath)?(t=i.regularExpression.message,e.push({xpath:i.xpath,message:t}),r=!1):!n||!n.match(a)&&n.match(new RegExp(i.regularExpression.expression))||(t=i.regularExpression.message,e.push({xpath:i.xpath,message:t}),r=!1):n&&n.match(new RegExp(".*?eval\\(","g"))&&n.match(new RegExp(".*?eval\\u0028","g"))&&i.editable&&(t=this.getResource("render-text-regular-expression-default-message"),e.push({xpath:i.xpath,message:t}),r=!1),r},setDisplayValue:function(e){var t=this.getControl(),i=bizagi.util.decodeURI(e);if(0==this.properties.editable&&"string"==typeof e){var r=bizagi.util.decodedDisplayValue(this.getDisplayValue());t.html(r)}this.setValue(i,!1)},collectData:function(e){this._super(e)},setValue:function(e){var t=bizagi.util.decodeURI(e);this._super(t)},createTooltip:function(e,t,i){e.data("oldValue",t),e.val("");try{e.tooltip("destroy")}catch(e){}e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",function(e,t){t.tooltip.zIndex(r)}),e.tooltip("open"),setTimeout(function(){e.focus()},100)},validateValue:function(e,t){return t<1||e.length<=t?e:e.substr(0,t)}}),$.Class.extend("bizagi.rendering.grid",{},{initializeData:function(e){var t=this;t.originalData=bizagi.clone(e.properties),this._super(e);var i,r,n=this.properties;t.initProperties(),t.columns=[],t.columnsIds=[],t.enabledChecks={},t.exclusiveChanges={},t.originalEnabledChecks=[],$.each(e.elements,function(a,o){var s=o.render.properties;if(s.groupBy&&(n.groupBy=s.xpath||"",n.allowGrouping=!bizagi.util.isEmpty(n.groupBy)),"columnLabel"===s.type&&t.spliceRowData(e.properties.data,a+1),"columnBoolean"===s.type&&s.isExclusive){s.xpath;if(e.properties.data){t.enabledChecks[s.xpath]=[];for(var l=0;l<e.properties.data.rows.length;l++){var d=e.properties.data.rows[l],u=d[a+1];u&&(t.originalEnabledChecks.push(d[0]),t.enabledChecks[s.xpath].push([d[0],u]))}}}t.properties.inlineEdit||(o.render.properties.editable=!1);var p=t.renderFactory.getColumn({type:s.type,data:o.render,parent:t,singleInstance:n.singleInstance});t.columns.push(p),t.columnsIds.push(o.render.properties.id),s.editable&&(i=!0),s.totalize&&s.totalize.operation&&(r=!0,s.totalize.format=s.totalize.format||{},s.totalize.format.bold=void 0===s.totalize.format.bold||s.totalize.format.bold)}),"rtl"===n.orientation&&(t.columns=t.columns.reverse()),n.inlineEdit&&!i&&(n.inlineEdit=!1,n.allowEdit=!1),r&&(n.showSummary=!0,n.rowsPerPage=0)},initProperties:function(){var e=this,t=e.getFormContainer(),i=e.properties;i.editable=bizagi.util.parseBoolean(i.editable)||!1,i.allowEdit=null==bizagi.util.parseBoolean(i.allowEdit)||bizagi.util.parseBoolean(i.allowEdit),i.inlineEdit=null==bizagi.util.parseBoolean(i.inlineEdit)||bizagi.util.parseBoolean(i.inlineEdit),i.withEditForm=null!=bizagi.util.parseBoolean(i.withEditForm)&&bizagi.util.parseBoolean(i.withEditForm),i.allowAdd=null==bizagi.util.parseBoolean(i.allowAdd)||bizagi.util.parseBoolean(i.allowAdd),i.inlineAdd=!!i.allowAdd&&(null==bizagi.util.parseBoolean(i.inlineAdd)||bizagi.util.parseBoolean(i.inlineAdd)),i.allowDelete=null==bizagi.util.parseBoolean(i.allowDelete)||bizagi.util.parseBoolean(i.allowDelete),i.allowDetail=null!=bizagi.util.parseBoolean(i.allowDetail)&&bizagi.util.parseBoolean(i.allowDetail),i.keyColumn="",i.data=i.data||null,i.displayType="value",i.skipInitialLoad=i.skipInitialLoad||!1,i.allowMore=bizagi.util.parseBoolean(i.allowMore)||!1,i.allowFilter=bizagi.util.parseBoolean(i.allowFilter)||!1,i.allowGrouping=!1,i.groupBy="",i.groupSummary=i.groupSummary||null,i.groupText=this.getResource("render-grid-group-text"),i.groupCollapsed=bizagi.util.parseBoolean(i.groupCollapsed)||!1,i.groupOrder=i.groupOrder||"asc",i.formShowMode=bizagi.util.parseBoolean(i.formShowMode)||"popup",i.floatingHeader=bizagi.util.parseBoolean(i.floatingHeader)||!1,i.sortBy=i.sortBy?i.sortBy:i.data&&i.data.sort?i.data.sort:i.keyColumn,i.sortOrder=void 0!==i.sortOrder&&null!==i.sortOrder?"True"===i.sortOrder?"asc":"desc":i.data&&i.data.order?i.data.order:"asc",i.sort=i.sortBy+" "+i.sortOrder,i.rowsPerPage=i.allowGrouping?1e3:i.rowsPerPage||20,i.page=1,i.records=0,i.totalPages=0,i.addLabel=i.addLabel||this.getResource("render-grid-add-label")+i.displayName,i.editLabel=i.editLabel||$.trim(this.getResource("render-grid-edit-label"))+" "+i.displayName,i.deleteLabel=i.deleteLabel||this.getResource("render-ecm-confirm-bt-delete")+" "+i.displayName,i.exportOptionsLabel=i.exportOptionsLabel||this.getResource("render-grid-export-options-label")+i.displayName,i.detailLabel=i.detailLabel||this.getResource("render-collection-navigator-details-form"),i.tableCssClass=i.cssClass||"",i.alreadySaved=!1,"entity"!=i.contexttype&&(i.contexttype="function"==typeof e.parent.getContextType?e.parent.getContextType():"");try{(e.parent&&"boolean"==typeof e.parent.properties.editable&&!e.parent.properties.editable||!i.editable)&&(i.allowAdd=!1,i.allowEdit=!1,i.allowDelete=!1,i.inlineEdit=!1,i.inlineAdd=!1,i.editable=!1)}catch(e){}i.allowEdit&&(i.inlineEdit||i.withEditForm)||(i.editable=!1),i.labelWidth=0,i.valueWidth="100%",i.overrideGetRemoteData=i.overrideGetRemoteData||void 0,i.singleInstance=!!bizagi.util.isEmpty(i.singleInstance)||i.singleInstance,i.contextType=t.params&&t.params.data&&t.params.data.contextType?t.params.data.contextType:null,e.changes={},e.cellOverrides={},e.isRTL()&&null!=i.data&&(i.data.rows=e.changeOrderData(i.data.rows))},hasValue:function(){return this.properties.data&&this.properties.data.rows.length>0},isRTL:function(){var e=this.properties;return!e||"string"==typeof e.orientation&&"RTL"==e.orientation.toUpperCase()},changeOrderData:function(e){var t,i=[],r=e||[];return $.each(r,function(e,n){t=n.shift(),(i=n.reverse()).unshift(t),r[e]=i}),r},removeRemainingColumns:function(e,t){var i=e||[],r=0;return i.length>0&&(r=i[0].length-t-1),r>0&&$.each(i,function(e,t){for(var i=0;i<r;i++)t.pop()}),i},getColumn:function(e){var t=null;return $.each(this.columns,function(i,r){r.properties.xpath!=e&&r.properties.id!=e||(t=r)}),t},getColumnType:function(e){var t=this.columnsIds.indexOf(e);return-1!=t?this.columns[t].properties.type:null},renderControl:function(){var e=this,t=this.properties,i=new $.Deferred;"execution"!==e.getMode()&&(t.data=e.getDummyData());var r=e.getGridTemplate(),n=e.applyTemplate(r),a=[];return $.each(e.columns,function(e,t){var i=t.initialize();i&&a.push(i)}),$.when.apply($,a).done(function(){i.resolve(n)}),i.promise()},postRender:function(){var e=this.getControl();this._super(),e.addClass("ui-bizagi-render-grid-container").addClass("ui-bizagi-render-display-block")},getGridTemplate:function(){return this.renderFactory.getTemplate("grid")},applyTemplate:function(e){var t=this.properties;return orientation=this.properties.orientation,$.fasttmpl(e,{id:bizagi.util.encodeXpath(t.xpath),displayName:bizagi.util.encodeXpath(t.displayName),allowAdd:t.allowAdd,addLabel:t.addLabel})},renderReadOnly:function(){return this.renderControl()},getRemoteData:function(e){var t=this,i=t.properties;return e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,sort:i.sortBy,order:i.sortType,page:i.page,rows:i.rowsPerPage,searchFilter:i.searchFilter,orientation:i.orientation||"ltr"}),i.overrideGetRemoteData?i.overrideGetRemoteData(e):t.dataService.multiaction().getGridData(e).then(function(e){return t.originalData=t.originalData||{},t.originalData.data=bizagi.clone(e),i.page=e.page,i.records=e.records,i.totalPages=e.totalPages,e})},spliceRowData:function(e,t){"execution"===this.getMode()&&e&&e.rows&&$.each(e.rows,function(i,r){var n=t||e.rows[i].length;e.rows[i].splice(n,0,"")})},spliceRowDataVisible:function(e,t){"execution"===this.getMode()&&e&&e.visible&&$.each(e.visible,function(i,r){var n=t||e.visible[i].length;e.visible[i].splice(n,0,!0)})},spliceRowDataEditable:function(e,t){"execution"===this.getMode()&&e&&e.editable&&$.each(e.editable,function(i,r){var n=t||e.editable[i].length;e.editable[i].splice(n,0,!0)})},getDummyData:function(){var e=this.properties;if(e.data)return e.data;for(var t=["1"],i=0;i<this.columns.length;i++)t.push("");return{page:1,total:1,records:1,rows:[t]}},submitEditRequest:function(e){var t=this.properties,i=t.xpath+this.buildCellXpathFilter(e);return this.dataService.editGridRecord({url:t.editUrl,idRender:t.id,xpath:i,xpathContext:t.xpathContext,idPageCache:t.idPageCache,contexttype:t.contextType})},submitSaveRequest:function(e,t){var i=this,r=i.properties,n=null;t.deferreds&&(n=$.when.apply($,t.deferreds),delete t.deferreds);var a=r.xpathContext.length>0?r.xpathContext+"."+r.xpath+i.buildCellXpathFilter(e):r.xpath+i.buildCellXpathFilter(e);return $.when(n).pipe(function(){return i.startLoading(),i.dataService.saveGridRecord({url:r.saveUrl,idRender:r.id,xpath:r.xpath,xpathContext:a,submitData:t,contexttype:r.contextType,disableServerGridValidations:t.disableServerGridValidations||!1}).pipe(function(e){return i.endLoading(),e}).fail(function(e){var t=i.getFormContainer(),r=e.responseText?e.responseText:"string"==typeof e?e:e.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=e);t.validateForm(),t.clearValidationMessages(),t.addValidationMessage(r)})})},submitDeleteRequest:function(e){var t=this,i=t.properties,r=i.xpath+t.buildCellXpathFilter(e);return t.dataService.deleteGridRecord({url:i.deleteUrl,idRender:i.id,xpath:r,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType}).pipe(function(e){if("validationMessages"==e.type){var i=t.getFormContainer(),r=e.messages.join(" ");i.failHandler({message:r})}return e})},submitAddRequest:function(){var e=this.properties;return this.dataService.addGridRecord({url:e.addUrl,idRender:e.id,xpath:e.xpath,xpathContext:e.xpathContext,contexttype:e.contextType,idPageCache:e.idPageCache}).pipe(function(e){return e.idEntity}).promise()},submitRollbackRequest:function(e){var t=this.properties;return this.dataService.rollbackGridAction({url:t.rollbackUrl,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:e?e.idPageCache:t.idPageCache,contexttype:this.properties.contexttype||""})},collectGridChange:function(e){var t=(e=e||{}).id,i=e.xpath,r=e.value,n=void 0===e.trigger||e.trigger,a=e.pressed||!1;this.changes[t]=this.changes[t]||{},this.changes[t][i]=r,n&&this.triggerRenderChange({key:t,column:i,pressed:a})},configureColumnSubmitOnChange:function(e){var t=this,i=t.properties,r={commands:[{xpath:i.xpath,command:"submit-value",argument:"all"}],conditions:{operator:"and",expressions:[{simple:{operator:"cell-change",xpath:i.xpath+"[]."+e,argumentType:"text",argument:e}}]},dependencies:[i.xpath]};$.when(t.ready()).done(function(){t.getFormContainer().addSubmitAction(e,r)})},collectData:function(e){var t=this,i=t.properties,r=[];for(var n in t.changes){if("summary"!=n)for(var a in t.changes[n])if(t.canColumnBeSent(n,a)){var o=i.xpath+t.buildCellXpathFilter(n)+"."+a,s=(i.xpath,t.buildCellXpathFilter(n),a.substr(a.lastIndexOf(".")+1,a.length),t.changes[n][a]);e[o]=s}r.push(n)}if(t.exclusiveChanges)for(var n in t.exclusiveChanges){var l=t.exclusiveChanges[n],d=t.enabledChecks[n],u=d.length;if(l&&d){for(var p=0;p<u;p++){e[i.xpath+t.buildCellXpathFilter(t.enabledChecks[n].shift()[0])+"."+n]=!1}e[i.xpath+t.buildCellXpathFilter(l.key)+"."+l.xpath]=l.value}}$.each(r,function(e,i){delete t.changes[i]})},hasChanged:function(e){return $.isEmptyObject(this.changes)?!$.isEmptyObject(this.exclusiveChanges)&&(e.push(!0),!0):(e.push(!0),!0)},canColumnBeSent:function(e,t){var i,r;for(i in this.columns)if(this.columns.hasOwnProperty(i)){var n=this.columns[i];if("columnUserfield"!==n.properties.type){if(n.properties.xpath==t){var a=this.getCellOverride(e,n.columnIndex-1);return n.canBeSent(e,a)}}else for(r in n.properties)if(n.properties.hasOwnProperty(r)&&"[object String]"===Object.prototype.toString.apply(n.properties[r])&&n.properties[r].substr(n.properties[r].lastIndexOf(".")+1)===t)return!0}return!1},canBeSent:function(){var e=this.properties;return!(bizagi.util.parseBoolean(e.displayOnly)||!1||!e.inlineEdit&&!e.inlineAdd&&$.isEmptyObject(this.changes))},getCellValue:function(e,t){for(var i=this.properties.data.rows,r=0;r<i.length;r++)if(i[r][0]==e)for(var n=0;n<this.columns.length;n++){if(this.columns[n].properties.xpath==t)return i[r][n+1]}return null},getCellCurrentValue:function(e,t){var i=this.getControlCell(e,t);return i&&"function"==typeof i.getValue?i.getValue():null},getControlCell:function(e,t){var i=this,r=null;if(void 0!==i.columns)for(var n=0;n<i.columns.length;n++)if(i.columns[n].properties.xpath==t||i.columns[n].properties.id==t){r=i.columns[n].getDecorated(e);break}return r},changeRequired:function(e){this.properties.required=e,this.changeRequiredLabel(e)},changeRequiredLabel:function(e){var t=this.getControl();t.length>0&&("execution"!==this.getMode()?1==bizagi.util.parseBoolean(e)&&this.properties.editable?t.addClass("grid-control-required"):t.removeClass("grid-control-required"):1==bizagi.util.parseBoolean(e)&&!this.hasValue()&&this.properties.editable?t.addClass("grid-control-required"):t.removeClass("grid-control-required")),this.triggerRenderValidate()},refresh:function(){},setError:function(e,t){},changeCellBackgroundColor:function(e,t,i){},changeCellColor:function(e,t,i){},changeCellVisibility:function(e,t,i){},changeCellEditability:function(e,t,i){},changeCellRequired:function(e,t,i){},changeCellProperties:function(e,t,i){},changeCellMaxValue:function(e,t,i){},changeCellMinValue:function(e,t,i){},cleanCellData:function(e,t){},changeEditability:function(e){var t=this,i=t.getControl();t.saveGrid().done(function(){var r={properties:$.extend({editable:bizagi.util.parseBoolean(e)},t.originalData)};i.empty(),bizagi.rendering.render.prototype.initializeData.apply(t,[r]),t.initProperties(),t.changeColumnsEditability(e),"function"==typeof t.internalRenderControl&&$.when(t.internalRenderControl()).done(function(e){i.append(e),t.postRenderElement(t.element)})})},saveGrid:function(){var e=$.Deferred(),t=$("[data-bizagi-component=rows]",this.element).find("[data-new-row=true]");return t.length>0?(t=$.map(t,function(e,t){return $(e).data("business-key")}),this.saveInlineAddedRows(t).done(function(){e.resolve()})):e.resolve(),e.promise()},changeColumnsEditability:function(e){var t=this.columns||[];$.each(t,function(t,i){i.properties.editable=e})},refreshCell:function(e){var t=this,i=t.properties,r=e.key,n=e.column,a=""!==e.xpathContext?e.xpathContext+"."+t.properties.xpath+t.buildCellXpathFilter(r):t.properties.xpath+t.buildCellXpathFilter(r),o=t.getControlCell(r,e.column),s=t.getFormContainer().properties.id;if(o)return o.beforeToRefresh(),$.when(t.dataService.multiaction().refreshGridCell({idRender:i.id,column:o.properties.id,idPageCache:i.idPageCache,xpathContext:a,idForm:s,typeRender:o.properties.type})).done(function(e){var i=function(e){return e&&"object"==typeof e&&e.length>=1?e[0].length>=1?e[0][0]:e[0]:""},a=i(e.rows),s=i(e.editable);bizagi.util.isBoolean(s)||(s=s||!0);var l=i(e.visible);bizagi.util.isBoolean(l)||(l=l||!0),t.changeCellVisibility(r,n,l),t.changeCellEditability(r,n,s),o.setValue(a),o.setDisplayValue(a),t.triggerRenderChange({key:r,column:n,changed:!1}),null!=o.column&&"desktop"==bizagi.util.detectDevice()&&t.updateAffectedCellManually(r,a,o.column.columnIndex),o.afterToRefresh()})},triggerRenderChange:function(e){e=e||{},bizagi.util.isEmpty(e)||0==e.changed||(this.properties.canBeExported=!1),this.triggerHandler("renderchange",{render:this,surrogateKey:e.key,column:e.column,changed:e.changed,rowDeleted:e.rowDeleted,pressed:e.pressed})},validate:function(){this.isValid([])},isValid:function(e){var t=this,i=!0;if(t.hasErrors=!1,t.setValidationMessage(""),t.properties.data&&t.properties.data.rows){var r=t.getDataNewRows();0==r.length&&bizagi.util.parseBoolean(t.properties.required)&&(t.hasValue()||(message=t.getResource("render-required-text").replaceAll("#label#",t.properties.displayName),e.push({xpath:t.properties.xpath,message:message}),i=!1));for(var n=$.merge($.merge([],t.properties.data.rows),r),a=0;a<t.columns.length;a++){for(var o=[],s={},l=0;l<n.length;l++){var d=n[l][a+1],u=n[l][0];t.columns[a].properties.xpath;void 0!==t.changes[u]&&void 0!==t.changes[u][t.columns[a].properties.xpath]&&(d=t.changes[u][t.columns[a].properties.xpath]),t.columns[a].isValueValid(u,d,o,t.getCellOverride(u,a))||(i=!1,t.hasErrors=!0,t.setError(u,t.columns[a].properties.xpath))}for(var p=0,c=o.length;p<c;p++)null==s[o[p]]&&(s[o[p]]=o[p]);if(o.length>0){var g=t.getResource("render-grid-validation").replaceAll("#grid#",t.properties.displayName);for(u in s)e.push({xpath:t.properties.xpath,message:g+" "+u})}}}return i},configureSubmitOnChange:function(){},getCellOverride:function(e,t){var i=this;e=Number(e),t=Number(t);var r=i.columns[t].properties;return i.cellOverrides[e]||(i.cellOverrides[e]={}),i.cellOverrides[e][t]||(i.cellOverrides[e][t]={visible:r.visible,editable:r.editable,required:r.required}),i.cellOverrides[e][t]},setCellOverrides:function(e,t){var i;if(e.visible)for(var r=0,n=e.visible.length;r<n;r++){i=e.visible[r][0];for(var a=0,o=e.visible[r].length;a<o;a++)a>0&&(this.getCellOverride(i,a-1).visible=bizagi.util.parseBoolean(e.visible[r][a]))}if(e.editable)for(r=0,n=e.editable.length;r<n;r++){i=e.editable[r][0];for(a=0,o=e.editable[r].length;a<o;a++)if(a>0){var s=!t||bizagi.util.parseBoolean(t[a-1].properties.editable);this.getCellOverride(i,a-1).editable=!!s&&bizagi.util.parseBoolean(e.editable[r][a])}}if(e.required)for(r=0,n=e.required.length;r<n;r++){i=e.required[r][0];for(a=0,o=e.required[r].length;a<o;a++)a>0&&(this.getCellOverride(i,a-1).required=bizagi.util.parseBoolean(e.required[r][a]))}},getIndexes:function(){var e=$.merge(this.properties.data.rows,this.getDataNewRows());return $.map(e,function(e,t){return e[0]})},getDataNewRows:function(){var e=this,t=[];return"object"!=typeof e.newRecords||$.isEmptyObject(e.newRecords)||$.each(e.newRecords,function(i){var r=[];r.push(Number(i));for(var n=0,a=e.columns.length;n<a;n++)r.push(e.getCellCurrentValue(i,e.columns[n].properties.xpath));t.push(r)}),t},getGridExportUrl:function(e){var t=this.properties;return this.dataService.getGridExportUrl({idRender:t.id,xpathContext:t.xpathContext||"",idPageCache:t.idPageCache,disposition:e.disposition,exportType:e.exportType,sort:t.sort,sessionId:this.getSessionId(),idForm:this.getFormContainer().properties.id})},submitForGridChange:function(){return this.submitOnChange(null,!1)},dispose:function(){var e=this;setTimeout(function(){e.columns&&$.each(e.columns,function(e,t){t.dispose()})},bizagi.override.disposeTime||50),e._super()},getEnabledChecks:function(e){var t=this,i=t.properties;e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,rows:i.rowsPerPage,xpathfilter:e.xpath});var r=new $.Deferred;return t.dataService.multiaction().getGridDataExclusivesSelected(e).done(function(e){i.page=e.page,i.records=e.records,i.totalPages=e.totalPages,t.isRTL()&&(e.rows=t.changeOrderData(e.rows)),r.resolve(e)}),r.promise()},buildCellXpathFilter:function(e){return bizagi.util.isNumeric(e)?"[id="+e+"]":"[id='"+e+"']"},cleanNewRecords:function(){this.newRecords={}},changeBackgroundColor:function(e){this._super(e);var t=this.getControl();return t.find(".bz-rn-grid-header-title").css("background-color",e,"!important"),t.find(".bz-rn-grid-container-foother").css("background-color",e,"!important"),this},hasColorHeader:function(){var e=this.properties.headerFormat||{};return!!e&&!bizagi.util.isEmpty(e.color)}}),$.Class.extend("bizagi.rendering.hidden",{},{renderControl:function(){return"design"===this.getMode()?"<div>"+bizagi.localization.getResource("render-hidden-displayName")+"</div>":"<div />"},postRender:function(){var e=this.properties;this._super(),void 0!==e.value&&this.setDisplayValue(e.value)}}),$.Class.extend("bizagi.rendering.label",{},{initializeData:function(e){var t=this;t._super(e),t.properties.required=!1,t.properties.displayType="label",t.properties.displayName=e.properties.displayName||"",bizagi.util.parseBoolean(t.properties.allowDinamiclabel)&&(this.properties.displayName=e.properties.displayName||bizagi.localization.getResource("render-label-default-display-name")),t.bindingValue(),t.calculateInitialLayoutProperties()},postRender:function(){this._super(),this.changeDisplayOption("label"),"function"==typeof this.configureHelpText&&this.configureHelpText()},postRenderReadOnly:function(){this._super(),this.changeDisplayOption("label"),this.changeLabelAlign(this.properties.labelAlign||"left")},isValid:function(e){},canBeSent:function(){return!1},bindingValue:function(){var e=this;e.properties.allowDinamiclabel&&e.properties.value&&("object"==typeof e.properties.value&&e.properties.value[0]?e.properties.displayName=e.properties.value[0].value:"string"==typeof e.properties.value&&""!==e.properties.value&&(e.properties.displayName=e.properties.value))},controlValueIsChanged:function(){return!1}}),$.Class.extend("bizagi.rendering.search",{},{initializeData:function(e){this._super(e);var t=this.properties;t.searchForms=t.searchForms||[],t.maxRecords=Number(t.maxRecords)||20,t.advancedSearch=null!==bizagi.util.parseBoolean(t.advancedSearch)&&bizagi.util.parseBoolean(t.advancedSearch),t.allowSuggest=null!==bizagi.util.parseBoolean(t.allowSuggest)&&bizagi.util.parseBoolean(t.allowSuggest),t.allowFullSearch=t.allowFullSearch||!1,t.allowAdd=bizagi.util.parseBoolean(t.allowAdd)||!1,t.allowTyping=null!==bizagi.util.parseBoolean(t.allowTyping)&&bizagi.util.parseBoolean(t.allowTyping),t.allowTyping=!!bizagi.util.parseBoolean(t.allowSuggest)||t.allowTyping,t.allowClear=null!==bizagi.util.parseBoolean(t.allowClear)&&bizagi.util.parseBoolean(t.allowClear),t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),t.searchLength=t.searchLength||2,t.enableLocalStorage=!1,t.expireCache=9e5,t.advancedSearch&&"execution"===this.getMode()&&(t.submitOnChange=bizagi.util.parseBoolean(t.submitOnChange)||!1,t.submitOnChange=!((t.submitVersion||1)>1)||t.submitOnChange)},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("search");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,allowTyping:e.allowTyping,advancedSearch:e.advancedSearch,allowSuggest:e.allowSuggest,editable:e.editable,allowClear:e.allowClear,hasValue:this.hasValue()})},getData:function(e){var t=this,i=t.properties,r=new $.Deferred,n=t.getFormContainer(),a=n.getContextType()||n.params.contexttype||!1;if(e=e||{},t.properties.contexttype?e.h_contexttype=t.properties.contexttype:a&&(e.h_contexttype=a),e.h_contexttype=t.properties.enableQuerySuggestBehavior?"metadata":e.h_contexttype,e&&e.h_contexttype&&"metadata"===e.h_contexttype&&(i.xpathContext=""),i.term.indexOf("'")>-1){var o=new RegExp("'","g");i.term=i.term.replace(o,"\\'\\'")}if(i.term.indexOf('"')>-1){o=new RegExp('"',"g");i.term=i.term.replace(o,'"')}return t.dataService.multiaction().getSearchData({url:i.dataUrl,contexttype:e.h_contexttype,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.allowFullSearch?"%"+i.term:i.term,extra:e}).done(function(e){i.data=e,r.resolve(i.data)}).fail(function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)}),r.promise(r)},setValue:function(e,t){t=void 0===t||t,this._super(e,t),null!=e?(this.value=e,this.selectedValue=e.label):(this.value=null,this.selectedValue=null)},mapValue:function(e){return e&&e.fromAction?{id:e.value,value:e.label,label:e.label}:e},collectData:function(e){var t=this.properties.xpath,i=this.getValue();if(this.controlValueIsChanged()&&!bizagi.util.isEmpty(t)&&null!=i){if("object"==typeof i&&void 0===i.id)return;e[t]=i}},submitData:function(){var e={};this.grid||(e[this.properties.xpath]=this.getValue()),this.submitOnChange(e,void 0,!1)},isValid:function(e){return this._super(e)},hasValue:function(){var e=this.getValue();return void 0!==e&&null!=e&&("object"==typeof e&&""!==e.id&&void 0!==e.id||!bizagi.util.isEmpty(e))},formatItem:function(e){return bizagi.util.formatItem(e)}}),$.Class.extend("bizagi.rendering.text",{},{initializeData:function(e){this._super(e);var t=this.properties;if(t.regularExpressionExpression){var i=t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message");t.regularExpression={expression:t.regularExpressionExpression,message:i}}},renderControl:function(){var e=this.renderFactory.getTemplate("text");return $.fasttmpl(e,{value:this.properties.value,isEmptyField:void 0===this.properties.value,helpText:this.properties.helpText,editable:this.properties.editable})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("text-read-only"),t=this.getValue();return bizagi.util.isString(t)&&(t=t.replaceAll("`","&#96;")),$.fasttmpl(e,{value:t,editable:this.properties.editable})},postRender:function(){this._super(),this.input=this.getControl().find("input"),"double"===this.properties.retype&&this.attachRetypeDouble()},attachRetypeDouble:function(){},configureHandlers:function(){var e=this,t=e.properties;t.mask&&e.input.mask({mask:t.mask}),e.input.bind("change",function(){e.setValue(e.input.val(),!1);"duplicate"!==t.retype&&(e.isValid([])||void 0===t.regularExpression)&&e.setValue(e.input.val(),!0)}).keypress(function(e){var t=(e=window.event||e).charCode||e.keyCode;void 0!==e&&13==t&&$(this).trigger("change")})},isValid:function(e){var t=this.properties,i=this._super(e),r=this.getValue();if("string"==typeof r)if(t.regularExpression){var n=new RegExp("");try{n=new RegExp(t.regularExpression.expression)}catch(r){bizagi.override.showDesignValidations&&(bizagi.log(r),e.push({xpath:t.xpath,message:r.message}),i=!1)}if(r&&(r.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!r.match(n)&&this.properties&&"userName"===this.properties.xpath)){var a=t.regularExpression.message;e.push({xpath:t.xpath,message:a}),i=!1}else if(r&&(r.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!r.match(n))){a=t.regularExpression.message;e.push({xpath:t.xpath,message:a}),i=!1}}else if(r&&r.match(new RegExp(".*?eval\\(","g"))&&r.match(new RegExp(".*?eval\\u0028","g"))&&t.editable){a=this.getResource("render-text-regular-expression-default-message");e.push({xpath:t.xpath,message:a}),i=!1}return i},setDisplayValue:function(e){var t=this.getControl(),i=bizagi.util.decodeURI(e);if(!bizagi.util.parseBoolean(this.properties.editable))if("string"==typeof e){var r=bizagi.util.decodedDisplayValue(this.getDisplayValue());t.html("<label class='readonly-control'>"+r+"</label>")}else bizagi.util.isNull(e)&&t.html("");this.setValue(i,!1)},setValue:function(e){this._super(e)},createTooltip:function(e,t,i){e.data("oldValue",t),e.val("");try{e.tooltip("destroy")}catch(e){}e.attr("title",i),e.tooltip();var r=$.getMaxZindex();e.tooltip().on("tooltipopen",function(e,t){t.tooltip.zIndex(r)}),e.tooltip("open"),setTimeout(function(){e.focus()},100)},validateValue:function(e,t){return t<1||e.length<=t?e:e.substr(0,t)}}),$.Class.extend("bizagi.rendering.button",{},{initializeData:function(e){this._super(e);var t=this.properties;t.caption=t.caption||"",t.displayType="value",t.required=!1,t.preventDefault=t.preventDefault||!1},renderControl:function(){var e=this.renderFactory.getTemplate("button");return $.fasttmpl(e,{caption:this.properties.caption,cssClass:this.properties.cssclass||"",editable:this.properties.editable})},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},saveForm:function(){return this.getFormContainer().saveForm()},executeButton:function(){var e=this,t=e.properties,i=t.xpathContext||"";return t.submitOnChangexpathContextRow&&(i=i?i+"."+t.submitOnChangexpathContextRow:t.submitOnChangexpathContextRow),e.getFormContainer().startLoading(),e.dataService.multiaction().executeButton({idRender:t.id,xpath:t.xpath||"",xpathContext:i||"",idPageCache:t.idPageCache}).always(function(){return e.getFormContainer().endLoading(),arguments?arguments[0]:void 0})},refreshForm:function(){this.getFormContainer().refreshForm(this.properties.id)},processButton:function(){this.properties.editable&&this.runButtonAction()},triggerRenderChange:function(e){var t=(e=e||{}).pressed||!1;this.triggerHandler("renderchange",{render:this,pressed:t})},runButtonAction:function(){var e=this;e.getFormContainer().clearValidationMessages(),e.saveForm().pipe(function(){return e.executeButton()}).done(function(t){if(null==t||1==t||"success"===t.result||"success"===t.type)return e.refreshForm();if("validationMessages"===t.type)try{e.getFormContainer().addValidationMessage(t.messages)}catch(e){}}).fail(function(t,i,r){try{e.getFormContainer().addErrorMessage(r)}catch(e){}})},processLayout:function(e,t){e&&(this.changeBackgroundColor(t.background),this._super(!e,t))},changeBackgroundColor:function(e){return void 0===e?this:("none"!==e?this.getElementsToStylize(this.getControl()).style("background",e,"important"):this.getElementsToStylize(this.getControl()).css("background",""),this)},getElementsToStylize:function(e){return $("input",e)},canBeSent:function(){return!1}}),$.Class.extend("bizagi.rendering.fileprint",{},{initializeData:function(e){this._super(e);var t=this.properties;t.caption=t.caption&&" "!=t.caption?t.caption:"render-fileprint-property-caption",t.filesCount=t.filesCount?t.filesCount:0,t.displayType="value",this.calculateInitialLayoutProperties(),t.required=!1},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("fileprint");return $.fasttmpl(t,{caption:e.caption})},renderReadOnly:function(){return this.renderControl()},getFilePrintUrl:function(e){var t=this.properties;return this.dataService.getFilePrintUrl({idRender:t.id,xpathContext:t.xpathContext||"",idPageCache:t.idPageCache,disposition:e,sessionId:this.getSessionId()})},refreshForm:function(){var e=this.properties;this.getFormContainer().refreshForm(e.id)},saveForm:function(){return this.getFormContainer().saveForm()}}),$.Class.extend("bizagi.rendering.link",{},{initializeData:function(e){this._super(e);var t=this.properties;t.required=!1,t.displayType="value",this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.renderFactory.getTemplate("link");return $.fasttmpl(e,{displayName:this.properties.displayName,align:this.properties.valueAlign,editable:this.properties.editable})},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},isValid:function(e){},setDisplayValue:function(e){},canBeSent:function(){return!1}}),$.Class.extend("bizagi.rendering.geolocation",{},{init:function(e){this._super(e),this.geolocation=window.navigator.geolocation;var t=this.properties;t.allowUpdate=!0===bizagi.util.parseBoolean(t.allowUpdate)},renderControl:function(){var e=this.renderFactory.getTemplate("geolocation");return $.fasttmpl(e,this.properties)},isValid:function(e){return this._super(e)},setDisplayValue:function(e){this.setValue(e,!1)},configureHandlers:function(){},getCurrentPosition:function(e,t){var i=this;if(void 0!==i.geolocation){return i.geolocation.getCurrentPosition(function(t){e&&e(t)},function(e){var r=i.getErrorMessage(e);t&&t(r)})}t&&t(bizagi.localization.getResource("render-control-unsuported-by-browser").replace("{0}",i.properties.type))},getErrorMessage:function(e){var t="";switch(e.code){case e.PERMISSION_DENIED:case 1:t=bizagi.localization.getResource("render-geolocation-permission-denied");break;case e.POSITION_UNAVAILABLE:case 2:t=bizagi.localization.getResource("render-geolocation-position-unavailable");break;case e.TIMEOUT:case 3:t=bizagi.localization.getResource("render-geolocation-timeout");break;default:t="WD: "+bizagi.localization.getResource("render-geolocation-permission-denied")}return t},performPrecision:function(e){var t=e.split(" ")||"";if(!t)return e;try{var i=parseFloat(t[0].trim()),r=parseFloat(t[1].trim());return i.toPrecision(10)+" "+r.toPrecision(10)}catch(t){return e}}}),$.Class.extend("bizagi.rendering.association",{},{initializeData:function(e){this._super(e);var t=this.properties;t.property="flipped",t.idRender=this.properties.id,t.allowFlip=void 0===t.allowFlip||bizagi.util.parseBoolean(t.allowFlip),t.flipped=void 0!==t.flipped&&bizagi.util.parseBoolean(t.flipped),t.flipstate=t.flipped,t.leftData=t.leftData||[],t.rightData=t.rightData||[],t.value&&this.processPropertyValue()},renderControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=new $.Deferred;return e.properties.property="flipped",e.properties.idRender=e.properties.id,$.when(e.getFlipAssociation()).done(function(r){e.makeJsonBase(),e.properties.flipped=bizagi.util.parseBoolean(r)||!1;var n=$.fasttmpl(t,e.properties,{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation});e.setValue(JSON.encode(e.properties.formatJson)),i.resolve(n)}),i.promise()},getFlipAssociation:function(){return"execution"==this.getMode()&&this.dataService.getFlipAssociation(this.properties)},getDisplayValue:function(){return this.getValue()},getTemplateName:function(){return"association"},getColumnData:function(){var e=this.data,t=[],i=e.flipped?e.rightData:e.leftData;return $.each(i,function(e,i){t.push({id:i.id,value:i.value})}),t},getRightAssociation:function(e){var t=this.data,i=[],r=function(e,i){var r=!1;return $.each(t.formatJson.value,function(t,n){!r&&n.id==e&&n.value.indexOf(i)>=0&&(r=!0)}),r};return t.flipped?$.each(t.leftData,function(t,n){i.push({id:n.id,name:n.value,checked:r(n.id,e)})}):$.each(t.rightData,function(t,n){i.push({id:n.id,name:n.value,checked:r(e,n.id)})}),i},removeElement:function(e,t){var i=this;$.each(i.properties.formatJson.value,function(r,n){i.properties.flipped?n.id==t&&$.each(i.properties.formatJson.value[r].value,function(t,n){e==n&&i.properties.formatJson.value[r].value.splice(t,1)}):n.id==e&&$.each(i.properties.formatJson.value[r].value,function(e,n){t==n&&i.properties.formatJson.value[r].value.splice(e,1)})}),i.setValue(JSON.encode(i.properties.formatJson))},addElement:function(e,t){var i=this;$.each(i.properties.formatJson.value,function(r,n){i.properties.flipped?n.id==t&&i.properties.formatJson.value[r].value.push(e):n.id==e&&i.properties.formatJson.value[r].value.push(t)}),i.setValue(JSON.encode(i.properties.formatJson))},makeJsonBase:function(){var e=this;e.properties.formatJson=e.properties.formatJson||{leftXpath:e.properties.leftXpath,rightXpath:e.properties.rightXpath,leftFactName:e.properties.leftFactName,rightFactName:e.properties.rightFactName,value:e.properties.value}},hasValue:function(){if(this.properties.formatJson)var e=this.properties.formatJson.value;else e=this.properties.value;for(var t=0,i=e.length;t<i;t++){var r=e[t];if(r&&r.value.length>0)return!0}return!1},processPropertyValue:function(){for(var e=this.properties,t=e.value,i=[],r=0,n=t.length;r<n;r++){var a=t[r];i.push({id:a[0],value:a[1]})}e.value=i}}),$.Class.extend("bizagi.rendering.upload",{},{initializeData:function(e){var t=this;t._super(e);var i=t.getFormContainer(),r=this.properties,n=Number(r.maxSize)||0,a="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):4091904;if(r.maxSize=n||a,r.maxfiles=Number(r.maxfiles)||999,r.validExtensions=r.validExtensions||"",r.validExtensions.length>0&&r.validExtensions.indexOf(".")<0){for(var o=r.validExtensions.replace(/\ /gi,"").split(";"),s=[],l=0;l<o.length;l++)if(o[l].length>0)s.push("*."+o[l]);else{o.indexOf(o[l]);o.splice(l,1)}r.validExtensions=s.join(";")}r.addUrl=r.addUrl||t.dataService.getUploadAddUrl(),r.deleteUrl=r.deleteUrl||void 0,r.editable=bizagi.util.parseBoolean(r.editable)||!1,r.allowDelete=!(null===bizagi.util.parseBoolean(r.allowDelete)||!r.editable)&&bizagi.util.parseBoolean(r.allowDelete),r.contexttype=i.params&&i.params.data&&i.params.data.contextType?i.params.data.contextType:"",r.allowSendInMail=r.allowSendInMail||!1,t.files=r.value||[],t.filesCount=t.files.length},renderControl:function(){for(var e=this,t=e.properties,i=e.renderFactory.getTemplate("upload"),r=$.fasttmpl(i,{xpath:bizagi.util.encodeXpath(e.getUploadXpath()),editable:t.editable,haveFiles:0!==e.filesCount,noFiles:0===e.filesCount,allowSendInMail:t.allowSendInMail}),n="",a=0;a<e.filesCount;a++){var o={id:e.files[a][0],fileName:e.files[a][1]};n+=e.renderUploadItem(o)}return r=e.replaceFilesHtml(r,n)},renderReadOnly:function(){return this.renderControl()},renderUploadItem:function(e){var t=this,i=t.getMode(),r=t.getTemplateItemName(),n=t.renderFactory.getTemplate(r),a=t.isExecutionMode()?t.buildItemUrl(e):"";return $.fasttmpl(n,{id:e.id,mode:i,url:a,allowDelete:t.properties.allowDelete,filename:e.fileName,editable:t.properties.editable})},buildItemUrl:function(e){var t=this.properties,i=this.getFormContainer();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:this.getUploadXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},deleteUploadItem:function(e,t){var i=this,r=i.properties,n=i.getUploadXpath()+(bizagi.util.isNumeric(t)?"[id="+t+"]":"[id='"+t+"']");return i.dataService.deleteUploadFile({url:r.deleteUrl,idRender:r.id,xpath:n,xpathContext:r.xpathContext,idPageCache:r.idPageCache,contexttype:r.contexttype}).pipe(function(){i.filesCount=i.filesCount-1,i.files=$.grep(i.files,function(e){return e[0]!=t})})},canBeSent:function(){return!1},setValue:function(e,t){this.files=e||[],this.filesCount=this.files.length,this._super(e,t)},getValue:function(){return this.files},isValid:function(e){var t,i=this,r=i.properties,n=!0;if(i.setValidationMessage(""),r.required&&r.editable){var a=i.grid&&i.grid.isFromCreatedRow.apply(i);if(i.filesCount<=0&&!a)(!i.grid||i.grid.properties.inlineEdit)&&(t=i.getResource("render-required-upload").replaceAll("#label#",r.displayName),e.push({xpath:r.xpath,message:t}),n=!1)}return n},buildAddParams:function(){var e=this,t=e.properties,i=e.getFormContainer(),r={},n=e.Class.BA_CONTEXT_PARAMETER_PREFIX;r[n+"xpath"]=e.getUploadXpath(),r[n+"idRender"]=t.id,r[n+"xpathContext"]=t.xpathContext,r[n+e.Class.BA_PAGE_CACHE]=t.idPageCache,r[e.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=i.properties.sessionId,r[n+"contexttype"]=t.contexttype;try{"undefined"!=typeof BIZAGI_SESSION_NAME?r[BIZAGI_SESSION_NAME]=i.properties.sessionId:r.JSESSIONID=i.properties.sessionId}catch(e){r.JSESSIONID=i.properties.sessionId}return r},getUploadXpath:function(){return this.properties.xpath},checkRequired:function(e){var t=this,i=t.properties;if(bizagi.util.parseBoolean(i.required))if(t.grid&&!0===t.grid.properties.inlineAdd){if(!t.hasValue()&&!t.getControl().parents("tr").data("new-row"))return t.setRenderRequired(e,i),!1}else if(!t.hasValue())return t.setRenderRequired(e,i),!1;return!0},setRenderRequired:function(e,t){var i=this.getResource("render-required-text").replaceAll("#label#",t.displayName);e.push({xpath:t.xpath,message:i})},getTemplateItemName:function(){return"uploadItem"}}),$.Class.extend("bizagi.rendering.ecm",{},{initializeData:function(e){var t=this;this._super(e);var i=(t=this).properties;if(i.maxSize=Number(i.maxSize)||("undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):i.maxSize=Number(i.maxSize)||4091904),i.maxFiles=Number(i.maxfiles)||999,i.validExtensions=i.validExtensions||"",i.validExtensions.length>0&&i.validExtensions.indexOf(".")<0){for(var r=i.validExtensions.split(";"),n=0;n<r.length;n++)r[n]="*."+r[n];i.validExtensions=r.join(";")}i.addUrl=t.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=uploadECMFile",i.editUrl=t.dataService.serviceLocator.getUrl("render-ecm-upload-url")+"?action=updateECMFileContent",i.deleteUrl=i.deleteUrl||void 0,i.allowDelete=null===bizagi.util.parseBoolean(i.allowDelete)||bizagi.util.parseBoolean(i.allowDelete),i.q_xpath=bizagi.util.encodeXpath(i.xpath),i.showMetadata=void 0===i.showMetadata||null===i.showMetadata||bizagi.util.parseBoolean(i.showMetadata);var a=this.getResource("dateFormat"),o=this.getResource("timeFormat");i.displayValue="",i.showTime=void 0!==i.showTime&&bizagi.util.parseBoolean(i.showTime),i.dateFormat=i.dateFormat||a,i.timeFormat=i.timeFormat||o,i.fullFormat=i.dateFormat,t.files=i.value||[],t.filesCount=t.files.length,i.xpathContext=this.parent.properties.xpathContext||i.xpathContext||""},renderControl:function(e,t){var i=this,r=i.properties,n=i.renderFactory.getTemplate("ecm"),a=i.getMode(),o=new $.Deferred;r.value=t?[[t.idFileUpload,t.fileName]]:i.value;var s=$.fasttmpl(n,r,{getFileExtension:i.getFileExtension,isImage:i.isImage});if(null!=i.properties.value){var l=i.properties.value.length;0===l&&o.resolve(s),$.each(i.properties.value,function(e,r){var n={};n.idFileUpload=r[0],n.fileName=r[1],n.idPageCache=i.properties.idPageCache,n.xpathContext=i.getXpathContext(),n.xPath=i.properties.xpath,n.editable=i.properties.editable,n.idAttrib=i.properties.idAttrib;var d=i.getFormContainer();d&&d.properties&&d.properties.sessionId&&(n.sessionId=d.properties.sessionId),"execution"===a&&$.when(i.renderFileLayout(n,t)).done(function(e){l--,bizagi.loader.productBuildToAbout&&0===bizagi.loader.productBuildToAbout.indexOf("10.4")&&(e=e.replaceAll("Handlers/MetadataFile","Handlers/Metadata")),s=i.replaceItemHtml(s,i.properties.id+"-"+n.idFileUpload,e),0===l&&o.resolve(s)})})}else o.resolve(s);return o.promise()},replaceItemHtml:function(e,t,i){return e.replace("{{"+t+"}}",i)},renderFileLayout:function(e,t){var i=this,r=i.getFormContainer(),n=i.renderFactory.getTemplate("ecm-metadata"),a=$.Deferred();return $.when(i.dataService.getECMMetadata(e),t?[t]:i.dataService.getFileProperties(e)).done(function(t,o){o[0].data=e,o[0].xpathContext=o[0].xpathContext||r.properties.xpathContext||"",o[0].xpath=i.properties.xpath,t[0].filename=e.fileName,t[0].url=i.buildItemUrl(o[0]),t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].ecm_isVisible=o[0].isVisible,t[0].ecm_allowUpdateMetadata=o[0].allowUpdateMetadata,t[0].ecm_allowDelete=o[0].allowDelete,t[0].ecm_allowUpdateContent=o[0].allowUpdateContent,t[0].ecm_allowView=o[0].allowView,t[0].ecm_allowCheckOut=o[0].allowCheckOut,t[0].ecm_allowCancelCheckOut=o[0].allowCancelCheckOut,t[0].ecm_allowEdit=e.editable&&o[0].allowEdit,t[0].ecm_ecmStatus=o[0].ecmStatus,t[0].idFileUploads=o[0].idFileUpload,t[0].xpath=o[0].xpath,t[0].value=bizagi.util.parseBoolean(o[0].value),t[0].deviceType=bizagi.detectDevice();var s=$.fasttmpl(n,t[0]);a.resolve(s)}),a.promise()},isImage:function(e){var t=this.getFileExtension(e);return["JPG","JPEG","GIF","PNG","BMP"].indexOf(t.toUpperCase())>-1},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},renderReadOnly:function(){return this.renderControl()},canBeSent:function(){return!1},buildItemUrl:function(e){var t=bizagi.cookie("JSESSIONID");return e.data||(e.data={fileName:e.fileName,idAttrib:e.idAttrib}),this.dataService.getECMFileUrl({idFileUpload:e.idFileUpload,xPath:e.xpath||e.xPath,xpathContext:e.xpathContext,idAttrib:e.data.idAttrib,idPageCache:this.properties.idPageCache,fileName:e.data.fileName.replace(/ /g,"_"),p_sessionId:t,sessionId:e.data.sessionId||""})},buildAddParams:function(){var e=this.properties,t={};return t.xPath=e.xpath,t.idAttrib=e.idAttrib,t.xpathContext=e.xpathContext,t.metaValues=[],t[this.Class.BA_CONTEXT_PARAMETER_PREFIX+this.Class.BA_PAGE_CACHE]=e.idPageCache,t},getFileExtension:function(e){return(e=e||"").split(".").pop()},setValue:function(e,t){var i=this,r=i.properties;i._super(e,t),i.files=r.value||[],i.filesCount=i.files.length?i.files.length:r.value},getXpathContext:function(){return this.properties.xpathContext||""},getUploadXpath:function(){return this.properties.xpath},deleteUploadItem:function(e,t){var i=this,r=i.properties,n={idFileUpload:t,xPath:r.xpath,idAttrib:r.idAttrib,idPageCache:r.idPageCache,xpathContext:i.getXpathContext()};return i.dataService.deleteECMFile(n).pipe(function(){i.filesCount=i.filesCount-1,i.files=$.grep(i.files,function(e){return e[0]!=t})})},lockUploadItem:function(e){var t=this.properties,i={idFileUpload:e,xPath:t.xpath,idAttrib:t.idAttrib,idPageCache:t.idPageCache,xpathContext:this.getXpathContext()};return this.dataService.checkOutFile(i)},unlockUploadItem:function(e){var t=this.properties,i={idFileUpload:e,xPath:t.xpath,idAttrib:t.idAttrib,idPageCache:t.idPageCache,xpathContext:this.getXpathContext()};return this.dataService.cancelCheckOut(i)}}),$.Class.extend("bizagi.rendering.yesno",{},{initializeData:function(e){this._super(e);var t=this.properties;t.value=void 0!==t.value?bizagi.util.parseBoolean(t.value):null},renderControl:function(){var e=this.renderFactory.getTemplate("yesno"),t=bizagi.util.randomNumber(100,1e7);return $.fasttmpl(e,{id:t,editable:this.properties.editable})},getDisplayValue:function(){var e=this.getValue();return!0===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-yes"):!1===bizagi.util.parseBoolean(e)?this.getResource("render-boolean-no"):""},hasValue:function(){var e=this.getValue();return!bizagi.util.isEmptyValue(e)&&null!==bizagi.util.parseBoolean(e)}}),$.Class.extend("bizagi.rendering.letter",{},{initializeData:function(e){this._super(e),this.letterOpened=!1},renderControl:function(){var e=this.renderFactory.getTemplate("letter");return $.fasttmpl(e)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("letter.readonly");return $.fasttmpl(e)},getLetterContent:function(){return this.letterOpened=!0,this.dataService.getLetterContent({url:this.properties.getUrl,idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache})},saveLetterContent:function(e){return this.dataService.saveLetterContent({url:this.properties.saveUrl,idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache,content:e})},getCanGenerateLetter:function(){return this.dataService.getCanGenerateLetter({idRender:this.properties.id,xpath:this.getXpath(),xpathContext:this.getContextXpath(),idPageCache:this.properties.idPageCache})},saveForm:function(){return this.getFormContainer().saveForm()},isValid:function(e){var t,i=this.properties;return 0==bizagi.util.parseBoolean(i.visible)||(0==bizagi.util.parseBoolean(i.editable)||(this.setValidationMessage(""),!i.required||0!=this.letterOpened||(t=this.getResource("render-letter-required-text").replaceAll("#label#",i.displayName),e.push({xpath:i.xpath,message:t}),!1)))},getXpath:function(){return this.properties.xpath},getContextXpath:function(){return this.properties.xpathContext}}),$.Class.extend("bizagi.rendering.formLink",{},{initializeData:function(e){this._super(e);var t=this.properties;t.displayType="value",t.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties()},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("formLink");return $.fasttmpl(t,{id:e.id,align:e.valueAlign,displayName:e.displayName,value:e.value,editable:e.editable,likeButton:bizagi.util.parseBoolean(e.likeButton)||!1})},renderReadOnly:function(){return this.renderControl()},postRender:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},postRenderReadOnly:function(){this._super(),this.getLabel().addClass("bz-form-label--hidden")},submitEditRequest:function(){var e=this.properties;return e.editable||e.value?this.dataService.editLinkForm({url:e.editUrl,idRender:e.id,xpath:this.getFormLinkXpath(),xpathContext:e.xpathContext,idPageCache:e.idPageCache}):null},submitSaveRequest:function(e){var t=this,i=t.properties;if(!i.editable&&!i.value)return null;var r=t.getFormLinkXpath(),n=r;return void 0!==i.xpathContext&&""!==i.xpathContext&&(n=r?i.xpathContext+"."+r:i.xpathContext),t.dataService.saveLinkForm({url:i.saveUrl,idRender:i.id,xpathContext:n,submitData:e}).done(function(e){var i=!0;e&&"validationMessages"===e.type&&(i=!1),i&&t.submitOnChange({})})},submitRollbackRequest:function(e){var t=this,i=t.properties;return $.when(i.editable||i.value?t.dataService.rollbackLinkForm({url:i.rollbackUrl,idRender:i.id,xpath:t.getFormLinkXpath(),xpathContext:i.xpathContext,idPageCache:e?e.idPageCache:i.idPageCache}):null)},submitCommitRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.commitLinkForm({url:t.commitUrl,idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},submitCheckpointRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.sendCheckpoint({url:t.checkpointUrl,idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},submitDataRequest:function(){var e=this,t=e.properties;return $.when(t.editable||t.value?e.dataService.submitData({url:t.checkpointUrl,action:"SUBMITDATA",idRender:t.id,xpath:e.getFormLinkXpath(),xpathContext:t.xpathContext,idPageCache:t.idPageCache}):null)},isValid:function(e){},getFormLinkXpath:function(){return this.properties.xpath},canBeSent:function(){return!1},setDisplayValue:function(e){}}),$.Class.extend("bizagi.rendering.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{init:function(e){this._super(e),this.dependants=[],this.isDependant=!1},initializeData:function(e){this._super(e);var t=this.properties;t.hasLocalData=!!bizagi.util.isEmpty(t.parentCombo)&&t.hasLocalData,t.value&&void 0===t.value.id&&(t.value=null),this.value=t.value,t.hasLocalData&&(t.data=this.complementData(t.data))},renderControl:function(){var e=this,t=e.getMode(),i=e.parentCombo=e.getParentCombo();if(null!=i){var r=bizagi.util.normalizeType(i.properties.type);/^cascadingcombo$/i.test(r)&&(e.isDependant=!0)}e.initializingCascadingCombo=!0;var n=this._super();return"execution"!==t&&(e.initializingCascadingCombo=!1),n},configureHandlers:function(){this.initializingCascadingCombo=!1,this.isDependant&&this.parentCombo.bindDependantCombo(this)},configureReadOnlyHandlers:function(){this.initializingCascadingCombo=!1,this.isDependant&&this.parentCombo.bindDependantCombo(this)},refresh:function(e,t){var i=this;$.when(i.isRendered()).done(function(){var r=i.getControl(),n=i.getMode();r.empty(),$.when(i.renderCombo(e)).then(function(e){r.html(e),i.postRender(),"execution"==n&&i.configureHandlers(),void 0!==i.getValue()&&i.setDisplayValue(i.getValue()),i.deferredVisible&&i.deferredVisible.resolve(),i.trigger("select",[i.value,t])})})},getData:function(e){var t=this;return"execution"!=t.getMode()?t.getDummyData():t.isDependant?(t.parentCombo&&e&&(t.properties.remoteDataLoaded=!1),""!=(t.parentCombo.selectedValue?t.parentCombo.selectedValue.id:"")?this._super(e):[]):this._super(e)},bindDependantCombo:function(e){var t=this,i=bizagi.util.normalizeType(e.properties.type);/^cascadingcombo$/i.test(i)&&(t.dependants.push(e),e.onChangeFunction=function(i,r,n){t.refreshDependantCombo(e,r.id,t.focusDependant,n),n||e.cleanInput()},t.isEventBinded("select")||t.bind("select",e.onChangeFunction),bizagi.util.isEmpty(t.getValue())||t.properties.hasLocalData&&t.refreshDependantCombo(e,t.getValue().id))},isEventBinded:function(e){return void 0!==$._data(this.observableElement.get(0),"events")&&void 0!==$._data(this.observableElement.get(0),"events")[e]},unbindDependantCombo:function(e){this.unbind("select",e.onChangeFunction)},refreshDependantCombo:function(e,t,i,r){var n={};n[this.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=t,e.deferredVisible=$.Deferred(),r||e.setValue("",!1),e.refresh(n,r),i&&$.when(e.deferredVisible.promise()).done(function(){e.inputCombo.trigger("click")})},emptyControlByChangeEditability:function(){this.getControl().empty()},cleanInput:function(){this.triggerHandler("select",{id:0})},getParentCombo:function(){var e=this.properties;if(void 0===e.parentCombo)return null;for(var t=this.getFormContainer(),i=bizagi.util.normalizeType(this.properties.type),r=/^cascadingcombo$/i.test(i)?t.getRenderByType(e.type):[],n=0,a=0,o=[],s=null;n<r.length;n++)e.parentCombo===r[n].properties.id&&o.push({control:r[n],index:n});if(o.length>1){for(var l,d;a<o.length;a++)if(l=(d=o[a].control.properties.xpath.split(".")).length,d.slice(0,l-1).join(".")===e.xpath){s=r[o[a].index];break}}else s=t.getRenderById(e.parentCombo);return s},canBeSent:function(){return this._super()&&bizagi.util.isMapEmpty(this.dependants)},showCurrentData:function(){return"execution"!=this.getMode()},configureSubmitOnChange:function(){this.configured||(this._super(),this.configured=!0)},internalSubmitOnChange:function(e,t){var i=new $.Deferred;return this.isDependant&&this.canBeSent()&&void 0!==this.itemSelected?this._super(e,t):i.resolve()},internalSetInitialValue:function(){var e=this;e._super(),e.value&&0==e.isDependant&&(e.internalSetInitialValueFlag=!0,e.trigger("select",[e.value,!0])),e.internalSetInitialValueFlag=!1}}),$.Class.extend("bizagi.rendering.list",{},{initializeData:function(e){this._super(e);var t=this.properties;t.listSize=t.listSize||0},getTemplateName:function(){return"list"},showCurrentData:function(){return!1}}),$.Class.extend("bizagi.rendering.multiSelect",{},{initializeData:function(e){this._super(e);var t=this.properties;t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),t.maxRecords=Number(t.maxRecords)||20},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("list-multiselect");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,align:e.valueAlign},{formatItem:this.formatItem})},renderReadOnly:function(){var e=this.properties,t=this.renderFactory.getTemplate("list-multiselect");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,editable:e.editable,align:e.valueAlign},{formatItem:this.formatItem})},getData:function(){var e=this,t=new $.Deferred,i=this.properties;return e.dataService.multiaction().getData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contexttype||null,idPageCache:i.idPageCache}).done(function(e){i.data=e,t.resolve(i.data)}).fail(function(i){if("not-processed"!==i.type){var r=e.getFormContainer(),n=e.properties.displayName+": ";n+=("string"==typeof i?JSON&&JSON.parse(i)||$.parseJSON(i):i).message,r.addValidationMessage(n),t.reject(i)}}),t.promise()},setValue:function(e,t){t=void 0===t||t,e=JSON.encode({value:e}),this._super(e,t)},setDisplayValue:function(e){this.setValue(e,!1)},canBeSent:function(){return!0},getValue:function(){return this.value||[]},getDataValue:function(){try{return JSON.parse(this.value).value||[]}catch(e){return[]}},hasValue:function(){var e=this.getDataValue();return e&&e.length>0},getElementsToStylize:function(e){return $(".bz-multiselect .bz-multiselect__tag:not(.bz-multiselect__plus)",e)},addElement:function(e){var t=this.getDataValue();t.push(e),this.setValue(t)},removeElement:function(e){var t=e.id,i=this.getDataValue().filter(function(e){return e.id!==t});this.setValue(i)},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.submitOnChange(e)},markAsChecked:function(e){var t=this;return t.selected.some(function(i,r){var n=i.id===e;return n&&t.selected.splice(r,1),n})},isChecked:function(e,t){return e.some(function(e){return e.id==t})},canAddMoreItems:function(e){var t=this;return parseInt(e.css("width"))>e.children().toArray().reduce(function(e,i){return e+=t.getElementWidth(i)},0)+t.Class.MORE_OPTION_WIDTH},getElementWidth:function(e){var t=window.getComputedStyle(e);return $(e).outerWidth()+["padding-left","padding-right","margin-left","margin-right"].reduce(function(e,i){return e+=parseInt(t[i])},0)},filterList:function(e,t){t.filter(function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()}).show()},addSelectedElements:function(){},findItemById:function(e){return(this.properties.data||[]).find(function(t){return t.id==e})},formatItem:function(e){return bizagi.util.formatItem(e)}}),$.Class.extend("bizagi.rendering.searchList",{},{initializeData:function(e){this._super(e);var t=this.properties;t.maxRecords=Number(t.maxRecords)||20,t.editable=null===bizagi.util.parseBoolean(t.editable)||bizagi.util.parseBoolean(t.editable),this.setValue(t.value)},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("searchList");return $.fasttmpl(t,{id:e.id,xpath:e.xpath,value:e.value,allowTyping:e.allowTyping,items:e.value,hasSearchForm:!!e.searchForms,editable:e.editable},{formatItem:this.formatItem})},renderReadOnly:function(){return this.renderControl()},setValue:function(e){this.value=JSON.encode({value:e}),this.triggerRenderChange()},addElement:function(e){var t=JSON.parse(this.value);t.value.push(e),this.setValue(t.value)},removeElement:function(e){var t=JSON.parse(this.value),i=[];$.each(t.value,function(t,r){r.id!=e.id&&i.push({id:r.id,value:r.value})}),this.setValue(i)},removeLastElement:function(){var e=JSON.parse(this.value);e.value.length>0&&(e.value.pop(),this.setValue(e.value))},getData:function(e){var t=this,i=t.properties,r=new $.Deferred;return t.dataService.getSearchData({url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,term:i.term,extra:e}).done(function(e){i.data=e,r.resolve(i.data)}).fail(function(e){var i=e.hideStatus||!1;r.resolve({}),i||t.trigger("onSearchError",e)}),r.promise()},submitData:function(){var e={};e[this.properties.xpath]=this.getValue(),this.submitOnChange(e)},canBeSent:function(){return!0},hasValue:function(){return this.getListItems().length>0},getListItems:function(){var e=this.getValue();return("string"==typeof e?JSON.parse(e).value:e.value)||[]},formatItem:function(e){return bizagi.util.formatItem(e)}}),$.Class.extend("bizagi.rendering.money",{},{initializeData:function(e){this._super(e);var t=this.properties,i=this.getResource("numericFormat");if(t.showsymbol=void 0===t.showsymbol||t.showsymbol,t.showsymbol){var r="undefined"!=typeof BIZAGI_DEFAULT_CURRENCY_INFO?BIZAGI_DEFAULT_CURRENCY_INFO.symbol:i.symbol;t.symbol=t.currencySymbol?t.currencySymbol:r}else t.symbol="";t.groupDigits=!0}}),$.Class.extend("bizagi.rendering.radio",{},{initializeData:function(e){this._super(e);var t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1,t.unique=bizagi.util.randomNumber(1e3,1e6)},getTemplateName:function(){return"radio"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){var e=this.properties;return{vertical:!e.horizontal,horizontal:e.horizontal}},cleanData:function(){var e={id:"",label:""};this.element.find(".ui-radio-state-checked").removeClass("ui-radio-state-checked"),this.setDisplayValue(e),this.setValue(e,!1),this.clearDisplayValue()},controlValueIsChanged:function(){var e=this.properties,t=this.getValue(),i=e.originalValue,r=e.defaultValue;return t&&void 0!==t.length&&(t=t[0]),i&&void 0!==i.length&&(i=i[0]),r&&void 0!==r.length&&(r=r[0]),t=t&&void 0!==t.id?t.id:t,i=i&&void 0!==i.id?i.id:i,void 0!==(r=r&&void 0!==r.id?r.id:r)?(r!=t||t!=i)&&((null!==t&&""!==t||null!==i&&""!==i)&&i!=t):(null!==t&&""!==t||null!==i&&""!==i)&&i!=t}}),$.Class.extend("bizagi.rendering.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},{initializeData:function(e){this._super(e);var t=this.properties,i=4091904;if(t.maxSize?i=Number(t.maxSize):"undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize&&(i=Number(BIZAGI_SETTINGS.UploadMaxFileSize)),t.maxSize=i,t.editable=!0===bizagi.util.parseBoolean(t.editable),t.validExtensions=t.validExtensions||"",t.validExtensions.length>0&&t.validExtensions.indexOf(".")<0){for(var r=t.validExtensions.replace(/\ /gi,"").split(";"),n=0;n<r.length;n++)if(0!=r[n].length)r[n]="*."+r[n].replaceAll(" ","");else{r.indexOf(r[n]);r.splice(n,1)}t.validExtensions=r.join(";")}t.addUrl=t.addUrl||this.dataService.getUploadAddFileUrl(t.isUserPreference),t.allowDelete=null!==bizagi.util.parseBoolean(t.allowDelete),t.isAutoWidth=!1,t.isAutoHeight=!1,-1===t.width?(t.width="100%",t.isAutoWidth=!0):t.width=t.width+"px",-1===t.height?(t.height="auto",t.isAutoHeight=!0):t.height=t.height+"px"},renderControl:function(){var e=this,t=new $.Deferred,i=e.renderFactory.getTemplate("image");return $.when(e.buildItemUrl()).done(function(r){if(!e.isDisposed()){e.properties.url=""!==r?r:"",e.properties.value=e.value=e.properties.url.length>0?[e.properties.url]:null,e.setValue(e.properties.value);var n=$.fasttmpl(i,{url:e.properties.url});t.resolve(n)}}),t.promise()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("image-readonly");return $.fasttmpl(e)},getTemplateItem:function(){return this.renderFactory.getTemplate("image-item")},renderUploadItem:function(e){var t=this,i=t.getMode(),r=new $.Deferred,n=t.getTemplateItem();return $.when(t.buildItemUrl()).done(function(e){var a=e||"",o=$.fasttmpl(n,{url:a,allowDelete:t.properties.allowDelete,editable:t.properties.editable,mode:i});t.properties.url=a,t.properties.value=a.length>0?[a]:null,r.resolve(o)}),r.promise()},buildItemUrl:function(e){var t=this,i=t.properties,r=new $.Deferred,n="";if(this.isExecutionMode()){var a={url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,property:e&&e.property?e.property:"fileContent",dataType:"text"};i.contexttype&&(a.contexttype=i.contexttype),i.isUserPreference&&(t.currentUser=bizagi.currentUser.idUser,a.xpathContext="@Context.Users[id == "+t.currentUser+"]",a.contexttype="entity",a.surrogatekey=t.currentUser),t.dataService.multiaction().getPropertyData(a,"text").done(function(e){'"'===e.charAt(0)&&(e=e.slice(1,-1)),""!==e&&(n="data:image/png;base64,"+e),r.resolve(n)})}else n="",r.resolve(n);return r.promise()},buildItemUrlOffline:function(e){var t=new $.Deferred,i=this.properties,r=this.getFormParams();e={idCase:r.idCase,idWorkitem:r.idWorkitem,id:i.xpath,offlineType:r.offlineType};return $.when(this.dataService.getOfflineImage(e,"base64")).done(function(e){i.value=e,t.resolve(bizagi.util.getDataUrl(i))}),t.promise()},saveImageOffline:function(e,t){var i=this,r=new $.Deferred;if(i.isNative){var n=i.fileProperties.name;e=bizagi.util.isAndroidDevice()?bizagi.util.media.getImagePath(e):bizagi.util.media.normalizeIOSFilePath(e);var a=function(e){bizagi.log("error converting path to blob",e),r.reject(e)};window.resolveLocalFileSystemURL(e,function(e){e.file(function(e){var t=new FileReader;t.onloadend=function(){var t=new Blob([this.result],{type:e.type});t.name=n,r.resolve(t)},t.readAsArrayBuffer(e)},a)},a)}else r.resolve(e);$.when(r).done(function(e){var r=i.getFormParams(),n={idCase:r.idCase,idWorkitem:r.idWorkitem,id:i.properties.xpath,operationType:"edition",offlineType:r.offlineType};$.when(i.dataService.saveOfflineImage(n,e)).done(function(){t.resolve()})})},buildFullItemUrl:function(){var e=new $.Deferred;return $.when(this.buildItemUrl({property:"fileFullContent"})).done(function(t){e.resolve(t)}),e.promise()},canBeSent:function(){return!1},setValue:function(e,t){this._super(e,t)},getValue:function(){return this.properties.value||[]},isValid:function(e){var t=this;if(!1===bizagi.util.parseBoolean(t.properties.visible))return!0;if(!1===bizagi.util.parseBoolean(t.properties.editable))return!0;if((t.setValidationMessage(""),t.properties.required)&&(!(t.grid&&t.grid.isFromCreatedRow.apply(t))&&0===t.getValue().length)){var i=t.getResource("render-required-text").replaceAll("#label#",t.properties.displayName);return e.push({xpath:t.properties.xpath,message:i}),!1}return!0},buildAddParams:function(){var e=this,t=e.properties,i=e.getFormContainer(),r={};r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpath"]=e.getUploadXpath(),r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"idRender"]=t.id,r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"xpathContext"]=t.xpathContext,r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+e.Class.BA_PAGE_CACHE]=t.idPageCache,r[e.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId"]=i.properties.sessionId,r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"action"]="savefile",t.contexttype&&(r[e.Class.BA_CONTEXT_PARAMETER_PREFIX+"contexttype"]=t.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?r[BIZAGI_SESSION_NAME]=i.properties.sessionId:r.JSESSIONID=i.properties.sessionId}catch(e){r.JSESSIONID=i.properties.sessionId}return r},getUploadXpath:function(){return this.properties.xpath},emptyControlByAsyncRenderDeferred:function(){this.getControl().empty()}}),$.Class.extend("bizagi.rendering.userfieldDefinition",{},{getFileDependencies:function(){return null},postRender:function(){var e=this;e._super();var t=$.Deferred(),i=e.getFileDependencies();return i&&i.length>0?bizagi.loader.loadFile(i).then(function(){e.internalRenderControl(),t.resolve()}):$.when(e.renderUserfieldControl()).done(function(){t.resolve()}),t.promise()},renderUserfieldControl:function(){var e=this,t=e.getControl(),i=e.properties,r=new $.Deferred;i.extendedData&&i.extendedData.length>0?e.extendedData=bizagi.services.ajax.parseJSON(i.extendedData):e.extendedData={};var n;return(n=e.getEditableControl())&&(e.input=t.html(n)),e.renderComplex(),r.resolve(),r.promise()},postRenderReadOnly:function(){var e=this,t=e.getControl(),i=e.properties;i.extendedData&&i.extendedData.length>0?e.extendedData=bizagi.services.ajax.parseJSON(i.extendedData):e.extendedData={};var r=function(){try{var i=e.getReadonlyControl();i&&(e.input=t.html(i)),e.renderComplex()}catch(i){var r=e.properties.displayName||"Widget";t.html("<h6>"+r+"</h6>")}};e.ready?e.ready().done(function(){r()}):r()},getDisplayValue:function(){return this.getReadonlyValue()},setDisplayValue:function(e){this.setValue(e),this.setEditableValue(e)},getValue:function(){return this.getEditableValue()},getPropertyValue:function(e,t){var i=this,r=i.properties,n=new $.Deferred;return i.dataService.multiaction().getPropertyData({url:r.dataUrl,xpath:r.xpath,idRender:r.id,xpathContext:r.xpathContext,idPageCache:r.idPageCache,property:e,extra:t,dataType:t?t.dataType:null}).done(function(e){"error"==e.type?(i.getFormContainer().addErrorMessage(e.message),n.reject(e)):n.resolve(e)}).fail(function(e,t,i){n.reject(e,t,i)}),n.promise()},saveForm:function(){return this.getFormContainer().saveForm()},getRenderElements:function(e){var t=$(),i=this.getFormContainer().getRenders(e);return $.each(i,function(e,i){t=t.add($(i.element))}),t},getServerResourceURL:function(e){var t="Rest/Userfields/{0}/resource/{1}/{2}";t=t.replace("{0}",this.properties.userfieldGuid),e=e.replace("\\","__").replace("/","__");var i=bizagi.util.detectDevice();return t=(t=t.replace("{1}",i)).replace("{2}",e)},getRenderValue:function(e){var t,i=this.getFormContainer().getRenders(e);return $.each(i,function(e,i){t&&!i.properties.editable||(t=i)}),t?t.getValue():null},refreshForm:function(){var e=this.properties;this.getFormContainer().refreshForm(e.id)},showDialog:function(e,t){bizagi.util.mustImplement("Must implement the showDialog method")},showPopup:function(e,t){bizagi.util.mustImplement("Must implement the showPopup method")},updateOriginalValue:function(){this.properties.originalValue=this.value=this.properties.value}}),$.Class.extend("bizagi.rendering.basicUserField",{},{getEditableControl:function(){},renderComplex:function(){},getEditableValue:function(){return bizagi.rendering.render.prototype.getValue.apply(this,arguments)},setEditableValue:function(e){return bizagi.rendering.render.prototype.setValue.apply(this,arguments)},getReadonlyControl:function(){},getReadonlyValue:function(){return bizagi.rendering.render.prototype.getDisplayValue.apply(this,arguments)},dispose:function(){this._super()}}),$.Class.extend("bizagi.rendering.userfieldWrapper",{},{init:function(e){this._super(e),this.initialParams=e,this.userfieldGuid=this.properties.userfieldGuid,this.userfieldName=this.properties.control},internalPostRender:function(){var e=this;$.when(e.getUserfieldControl()).done(function(t){return t.element=e.element,e.column&&(t.isColumn=!0,t.grid=e.grid,t.surrogateKey=e.surrogateKey,t.properties.xpathContext=e.getControlXpathContext(t),t.getControl=e.column.getControl),t.internalPostRender()})},getControlXpathContext:function(e){var t=e.properties;return e.isColumn?t.xpathContext.length>0?t.xpathContext+"."+e.grid.properties.xpath+"[id="+e.surrogateKey+"]":e.grid.properties.xpath+"[id="+e.surrogateKey+"]":t.xpathContext},getUserFieldInstance:function(e){console.log("not implemented")},replicateUserfieldMethods:function(control){var self=this;for(var key in control.Class.prototype)"init"!=key&&"constructor"!=key&&"Class"!=key&&"subscribe"!=key&&"unsubscribe"!=key&&"publish"!=key&&"render"!=key&&"triggerHandler"!=key&&"dispose"!=key&&(self[key]=eval("var tmp = function(){ if (this.userfieldInstance) return this.userfieldInstance."+key+".apply(this.userfieldInstance, arguments); return null;};tmp"));control.properties=self.properties,control.value=self.value},dispose:function(){var e=this;setTimeout(function(){e.userfieldInstance&&(e.userfieldInstance.unbind("renderchange"),e.userfieldInstance.dispose())},bizagi.override.disposeTime||50),e._super()}}),$.Class.extend("bizagi.rendering.document",{},{initializeData:function(e){this._super(e);var t=this.properties;t.validate=null!=bizagi.util.parseBoolean(t.validate)&&bizagi.util.parseBoolean(t.validate),t.downloadalldocuments=!!t.downloadalldocuments&&t.downloadalldocuments,t.allowGenerate=void 0===t.allowGenerate||t.allowGenerate,t.append=!!t.append&&t.append,t.caption?(t.caption=bizagi.util.trim(t.caption),0===t.caption.length&&(t.caption=this.getResource("render-documentgenerator-button-label"))):t.caption=this.getResource("render-documentgenerator-button-label")},renderControl:function(){var e=this;e.preRenderControl();var t=e.properties,i=e.getMode(),r=t.downloadalldocuments,n=t.allowGenerate,a=e.renderFactory.getTemplate(e.getTemplate()),o=t.value||[],s=!o||0===o.length,l=e.getControlHtml(a,i,r,n,t,s),d=this.renderDocumentsHtml(o);return d+=this.renderActionsHtml(o,s,r),l=e.replaceFilesHtml(l,d)},getControlHtml:function(e,t,i,r,n,a){return $.fasttmpl(e,{noActivateButton:!1,editable:"execution"!==t,mode:t,downloadalldocuments:i,required:n.required,allowgenerate:r,xpath:this.getXpath(n.xpath),append:n.append,caption:n.caption,noFiles:a,allowSendInMail:n.allowSendInMail})},getXpath:function(e){return e},preRenderControl:function(){},activateButton:function(){return!0},getDocumentXpath:function(e){return e},getContextXpath:function(){return this.properties.xpathContext},renderDocumentItem:function(e){var t=this,i=t.getMode(),r=t.renderFactory.getTemplate(t.getTemplateItem()),n=t.buildItemUrl(e);return"execution"!==i&&(n="javascript:void(0);"),$.fasttmpl(r,{url:n,allowDelete:t.properties.allowDelete,filename:e.fileName,mode:i,editable:t.properties.editable,joined:!1})},buildItemUrl:function(e){var t=this,i=t.properties;return t.dataService.getUploadFileUrl({idRender:i.id,xpath:t.getDocumentXpath(i.xpath),xpathContext:t.getContextXpath(),idPageCache:i.idPageCache,fileId:e.id,sessionId:t.getSessionId()})},buildAllDocumentsUrl:function(){var e=this,t=e.properties;return e.dataService.getAllDocumentsDownloadUrl({xpath:e.getDocumentXpath(t.xpath),xpathContext:e.getContextXpath(),idPageCache:t.idPageCache,idCase:t.caseId,idWorkItem:t.workitemId,sessionId:e.getSessionId()})},postRender:function(){return this._super(),"<div></div>"},postRenderReadOnly:function(){var e=this;if("design"!==e.getMode()){var t=e.getControl(),i=e.renderControl();t.append(i),e.updateControlForPrintMode(t),e.postRender()}},validateContainer:function(){return this.getFormContainer().validateForm()},save:function(){return this.getFormContainer().saveForm()},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},replaceActionsHtml:function(e,t){return e.replace("{{actions}}",t)},canBeSent:function(){return!1},isValid:function(e){var t,i=this,r=i.properties;return!1===bizagi.util.parseBoolean(r.visible)||(!1===bizagi.util.parseBoolean(r.editable)||(i.setValidationMessage(""),!(r.required&&!r.buttonExecuted&&i.value)||(i.value.length>0||(t=i.getResource("render-document-required-text"),e.push({xpath:r.xpath,message:t}),!1))))},configureHandlers:function(){var e=this,t=e.getControl(),i=e.getMode();e._super();var r=$(".ui-bizagi-button-documentgenerator",t);"execution"===i&&r.click(function(t){if(!t.isPropagationStopped()){if(t.stopPropagation(),e.properties.buttonExecuted=!0,e.properties.validate)e.validateContainer()&&e.documentTemplateGenerate();else e.documentTemplateGenerate();e.properties.buttonExecuted=!1}}),$(".ui-bizagi-document-preview",t).click(function(t){t.isPropagationStopped()||(t.stopPropagation(),e.showDocumentPreview($(this).data("url"),$(this).data("filename")))}),$(".ui-bizagi-container-documents-item-delete",t).click(function(t){t.isPropagationStopped()||(t.stopPropagation(),e.deleteDocumentTemplate($(this).data("filename")))})},deleteDocumentTemplate:function(e){var t=this,i={xpath:t.properties.xpath+"[fileName='"+e+"']",idRender:t.properties.id,xpathContext:t.getContextXpath(),idPageCache:t.properties.idPageCache};t.startLoading(),$.when(t.dataService.deleteUploadFile(i)).done(function(){$.when(t.dataService.multiaction().getPropertyData({xpath:t.properties.xpath,idRender:t.properties.id,xpathContext:t.getContextXpath(),idPageCache:t.properties.idPageCache,property:"value"})).done(function(e){t.resolveDeleteDocumentTemplate(e,!1,t.properties.downloadalldocuments),t.endLoading()})})},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath),e.save().done(function(){bizagi.showErrorAlertDialog=!1,$.when(e.dataService.generateDocumentTemplate(t)).done(function(){$.when(e.dataService.multiaction().getPropertyData({xpath:t.xpath,idRender:t.id,xpathContext:e.getContextXpath(),idPageCache:t.idPageCache,property:"value"})).done(function(i){e.resolveDocumentTemplateGenerate(i,!1,t.downloadalldocuments),e.endLoading()})}).fail(function(t){e.endLoading(),e.showErrorMessage(t)})}).fail(function(t){e.endLoading(),e.showErrorMessage(error)})},showErrorMessage:function(e){var t=this.getFormContainer(),i=this.resources.getResource("render-upload-alert-maxsize").replace("{0}",BIZAGI_SETTINGS.UploadMaxFileSize);try{i=e&&void 0!==e.responseText?JSON.parse(e.responseText).message:e}catch(e){}t.addErrorMessage(i),t.endLoading()},autoOpenDocuments:function(){},showDocumentPreview:function(e,t){},returnCssTypeFile:function(e){if(null==e||0===e.lenght)return"ui-bizagi-document-upload-item-generic-file";switch(e.substr(e.lastIndexOf(".")+1)){case"docx":return"ui-bizagi-document-upload-item-doc";case"pdf":return"ui-bizagi-document-upload-item-pdf";case"xlsx":return"ui-bizagi-document-upload-item-xls";default:return"ui-bizagi-document-upload-item-generic-file"}},redrawDocuments:function(e,t,i){var r=this.getControl(),n="",a=$("[data-component='files']",r);a.empty(),n+=this.renderDocumentsHtml(e),n+=this.renderActionsHtml(e,t,i),a.append(n),this.setValue(e)},renderAllDocumentDownload:function(e){var t=this,i=t.properties,r=t.getMode(),n=t.renderFactory.getTemplate(t.getTemplateItem()),a=t.buildAllDocumentsUrl();"execution"!==r&&(a="javascript:void(0);");var o=$.fasttmpl(n,{url:a,allowDelete:i.allowDelete,filename:e.fileName,mode:r,joined:!0});return t.removeDeleteButton(o)},removeDeleteButton:function(e){var t=e.indexOf('<span class="ui-bizagi-container-documents-item-delete');if(t>0){var i=e.substring(t),r=i.indexOf("</span>")+7;return e.substring(0,t)+i.substring(r)}return e},resolveDocumentTemplateGenerate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e,this.autoOpenDocuments(),this.configureHandlers()},resolveDeleteDocumentTemplate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e,this.configureHandlers()},renderDocumentsHtml:function(e){for(var t="",i=0;i<e.length;i++){var r={id:e[i][0],fileName:e[i][1]};t+=this.renderDocumentItem(r)}return t},renderActionsHtml:function(e,t,i){var r="";if(i&&!t&&e.length>0){var n={fileName:this.getResource("render-document-downloadalldocuments")};r+=this.renderAllDocumentDownload(n)}return r},getTemplate:function(){return"document"},getTemplateItem:function(){return"document-item"},getErrorTemplate:function(){return"form-error"},getTemplateDownload:function(){return"document-download"},getTemplateReadonly:function(){return"document-readonly"}}),$.Class.extend("bizagi.rendering.range",{},{init:function(e){this._super(e)},initializeData:function(e){this._super(e)},renderControl:function(){var e;this.properties;return e=this.renderFactory.getTemplate("render-range"),$.fasttmpl(e,{})},setRanageControls:function(e,t){var i=this;i.minControl=e||null,i.maxControl=t||null;var r=i.getControl(),n=$(".bz-range-maximum",r),a=$(".bz-range-minimum",r);i.renderRangeControl(a,e),i.renderRangeControl(n,t)},getValue:function(){return{min:this.minControl.getValue(),max:this.maxControl.getValue()}},renderRangeControl:function(e,t){$.when(t.render("render")).done(function(i){e.empty().append(i),t.postRenderElement(e)})}}),$.Class.extend("bizagi.rendering.rangeDate",{},{defineRangeControl:function(e){var t=bizagi.rendering.date.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=bizagi.rendering.date.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),r=new t(this.getRenderProperties("min")),n=new i(this.getRenderProperties("max"));r.suscribe(n),n.suscribe(r),this.setRanageControls(r,n)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,r={data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return r.data.properties.displayName="min"===e?"From":"To",r}}),$.Class.extend("bizagi.rendering.rangeMoney",{},{defineRangeControl:function(){var e=bizagi.rendering.money.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),t=bizagi.rendering.money.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=new e(this.getRenderProperties("min")),r=new t(this.getRenderProperties("max"));i.suscribe(r),r.suscribe(i),this.setRanageControls(i,r)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService}}}),$.Class.extend("bizagi.rendering.rangeNumber",{},{defineRangeControl:function(){var e=bizagi.rendering.number.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMinValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),t=bizagi.rendering.number.extend({suscribe:function(e){this.observer=this.observer||[],this.observer.push(e)},notify:function(e){for(var t=this.observer.length-1;t>=0;t--)this.observer[t].changeMaxValue(e)},setValue:function(e){e=e||"",this._super(e),this.notify(e)}}),i=new e(this.getRenderProperties("min")),r=new t(this.getRenderProperties("max"));i.suscribe(r),r.suscribe(i),this.setRanageControls(i,r)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties;return{data:{properties:{id:i.id,xpath:i.xpath+"_"+e,displayType:"value"}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService}}}),$.Class.extend("bizagi.rendering.checkList",{},{initializeData:function(e){this._super(e);var t=this.properties;t.horizontal=bizagi.util.parseBoolean(t.horizontal)||!1,this.setValue(t.items),this.updateOriginalValue()},postRender:function(){var e=this.getControl();this._super(),this.checkListGroup=$(".ui-bizagi-render-checkList .ui-bizagi-render-checkList-item",e)},renderControl:function(){var e=this,t=e.properties,i=e.renderFactory.getTemplate(e.getTemplateName()),r=e.properties.items||[];return $.fasttmpl(i,$.extend(e.getTemplateParams(),{id:t.id,xpath:t.xpath,unique:bizagi.util.randomNumber(1e4,1e6),idPageCache:t.idPageCache,items:r}))},getTemplateName:function(){return"checkList"},showEmpty:function(){return!1},showCurrentData:function(){return!1},getTemplateParams:function(){return{vertical:!this.properties.horizontal}},cleanData:function(){},setValue:function(e){this.value=bizagi.clone(e)},getValue:function(e){return this.value||[]}}),$.Class.extend("bizagi.rendering.actionLauncher",{},{initializeData:function(e){var t=this;this._super(e);var i=t.getFormContainer();this.typeForm=i.properties.typeForm||"";var r=t.getMode(),n=t.properties;t.deferredActions=new $.Deferred,t.deferredActions.promise(),"execution"==r&&(t.engine=new bizagi.templateEngine({renderFactory:t.renderFactory,cache:!0,autoGenerateData:!1,templateGuid:n.selecttemplate})),t.processPropertyValueArgs={pcaseId:t.getIdCase(),pguidEntity:t.properties.guidEntity,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"data",psurrogatedKey:t.properties.surrogatedKey,ptags:t.properties.tagslist||[],pmaxitems:t.properties.maxItems,pactionXpath:t.properties.xpathActions},t.processPropertyValueDataTmplArgs={pactionXpath:t.properties.xpathActions,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,ptemplateGuid:n.selecttemplate,property:"dataTemplate",xpathActions:t.properties.xpathActions},t.properties.valueWidth=100,t.properties.displayType="value";var a="entityTemplate"!==e.properties.type;t.properties.allowactions=void 0===e.properties.allowactions?a:e.properties.allowactions,t.properties.isHorizontal=void 0===e.properties.isHorizontal||e.properties.isHorizontal,t.properties.allowSearch=void 0!==e.properties.allowSearch&&e.properties.allowSearch,t.properties.selecttemplate=void 0===e.properties.selecttemplate?"":e.properties.selecttemplate,t.properties.templatetype=void 0!==n.templatetype?n.templatetype:"none",t.properties.sessionId=i.params.data.sessionId,t.properties.value?"string"==typeof t.properties.value&&(t.properties.value=t.value=JSON.parse(t.properties.value)):(t.properties.value=t.value=[],t.properties.originalValue=[])},executeActionImmediately:function(e){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeAction",psurrogatedKey:t.properties.surrogatedKey,pguidAction:e.guidAction,pparameters:JSON.encode({idStartScope:e.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:e.idPageCache})};t.dataService.executeActions(r).done(function(i){t.notifyExecution(i,e)}).fail(function(i){t.notifyExecution("Error",e)})},notifyExecution:function(e,t){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0,this.postRender()},renderControl:function(){var e,t=this,i=t.properties,r="";if("design"==t.getMode()){e=t.renderFactory.getTemplate("render-actionLauncher-design");var n={type:i.type,isHorizontal:i.isHorizontal,allowSearch:i.allowSearch,templateDefined:"none"!=i.templatetype,allowactions:i.allowactions};r=$.fasttmpl(e,n)}else i.surrogatedKey&&(e=t.renderFactory.getTemplate("render-actionLauncher"),r=$.fasttmpl(e,{allowactions:t.properties.allowactions}));return r},isValid:function(e){var t=this,i=t.properties;t.getValue();return 0==bizagi.util.parseBoolean(i.visible)||(0==bizagi.util.parseBoolean(i.editable)||!(!i.required||!t.value)&&(t.value.length>0||(message=t.getResource("render-required-register-action"),e.push({xpath:i.xpath,message:message}),!1)))},setDisplayValue:function(e){this.getControl();this.setValue(e,!1)},actionManager:function(e){var t=this,i=e.guidProcess||"",r=new $.Deferred;switch(e.recordXpath=t.getFormContainer().properties.recordXpath,e.actionType){case"Process":var n={guidWFClass:i};$.when(t.dataService.hasStartForm(n)).done(function(n){n.hasStartForm?$.when(t.processStartForm({guidprocess:i,title:e.displayName,recordXpath:e.recordXpath})).done(function(t){e.idStartScope=t,r.resolve(e)}):r.resolve(e)});break;case"Rule":r.resolve(e);break;case"Form":e.xpathContext?$.when(t.processActionFormCollection(e)).done(function(t){e.idStartScope=t,r.resolve(e)}):("Form"===e.actionType&&(e.xpathContext=void 0,e.contextType="entitytemplate",e.guidEntity=e.guidEntity||t.properties.guidEntity),$.when(t.processActionForm(e)).done(function(t){e.idStartScope=t,r.resolve(e)}))}return r.promise()},addActionToQueue:function(e){var t=this,i=t.getValue(),r=t.getFormContainer().getParams();e.params=e.params||{};var n=t.properties.xpathContext;switch(e.actionType){case"Process":e.params={idStartScope:e.idStartScope,additionalXpaths:t.properties.additionalXpath.join(","),idParentWorkitem:r.idWorkitem||bizagi.context.idWorkItem,recordXpath:n};break;case"Form":e.params={idStartScope:e.idStartScope,additionalXpaths:t.properties.additionalXpath.join(","),entityXpath:t.properties.xpathActions,idParentWorkitem:r.idWorkitem||bizagi.context.idWorkItem,idEntity:e.idEntity};break;case"Rule":e.params={xpathActions:e.xpathActions||"",recordXpath:n}}var a=bizagi.clone(i);a.push(e),t.setValue(a),t.setDisplayValue(a)},removeActionToQueue:function(e){var t=bizagi.clone(this.getValue());t.splice(e,1),this.setValue(t),this.setDisplayValue(t)},collectData:function(e){if(this.controlValueIsChanged()){var t=this.properties.xpath,i=this.getValue(),r=[];$.each(i,function(e,t){var i={};i.params=t.params||{},i.guidAction=t.guidAction,r.push(i)}),e[t]=0==r.length?"":JSON.encode(r)}},countSameActions:function(e){var t=this.getValue(),i=0;return $.each(t,function(t,r){r.guidAction==e.guidAction&&i++}),i},getPropertiesActionLaucher:function(e){for(var t=this.getFormContainer(),i=0,r=e.length;i<r;i+=1)6===e[i].length&&(e[i].splice(5,0,""),"Process"==e[i][3]&&t.properties.xpathContext&&(e[i][5]=t.properties.xpathContext));return e}}),$.Class.extend("bizagi.rendering.entityTemplate",{},{init:function(e){this._super(e)},initializeData:function(e){var t=this;this._super(e);var i=t.getFormContainer();t.deferredActions=new $.Deferred,t.deferredActions.promise(),t.processPropertyValueArgs={pcaseId:t.getIdCase(),pguidEntity:t.properties.guidEntity,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"data",psurrogatedKey:t.properties.surrogatedKey},t.properties.valueWidth=100,t.properties.displayType="value",t.properties.allowactions=void 0===e.properties.allowactions||e.properties.allowactions,t.properties.value?"string"==typeof t.properties.value&&(t.properties.value=t.value=JSON.parse(t.properties.value)):t.properties.value=t.value=[]},renderControl:function(){var e,t=this,i="";return"design"==t.getMode()?(e=t.renderFactory.getTemplate("render-entityTemplate-design"),i=$.fasttmpl(e,{})):t.properties.surrogatedKey&&(e=t.renderFactory.getTemplate("render-entityTemplate"),i=$.fasttmpl(e,{allowactions:t.properties.allowactions})),i},isValid:function(e){this.properties;var t=this._super(e);this.getValue();return t},setDisplayValue:function(e){this.getControl();this.setValue(e,!1)}}),$.Class.extend("bizagi.rendering.polymorphicLauncher",{},{init:function(e){this._super(e)},initializeData:function(e){var t=this;this._super(e);var i=t.getFormContainer();this.typeForm=i.properties.typeForm||"";t.getMode();t.deferredActions=new $.Deferred,t.deferredActions.promise(),t.properties.valueWidth=100,t.properties.displayType="value",t.properties.allowSearch=void 0!==e.properties.allowSearch&&e.properties.allowSearch,t.properties.additionalXpath=t.properties.additionalXpath||[],t.properties.value?"string"==typeof t.properties.value&&(t.properties.value=t.value=JSON.parse(t.properties.value)):(t.properties.value=t.value=[],t.properties.originalValue=[]),t.processPropertyValueArgs={pcaseId:t.getIdCase(),pguidEntity:t.properties.guidEntity,idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"data",ptags:t.getTagList(t.properties.tagslist),additionalXpaths:t.properties.additionalXpath}},executeActionImmediately:function(e){var t=this,i=t.getFormContainer(),r={idRender:t.properties.id,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,property:"executeConstructor",psurrogatedKey:t.properties.surrogatedKey,pguidConstructor:e.guidConstructor,pparameters:JSON.encode({idStartScope:e.idStartScope,pactionXpath:t.properties.xpathActions,idPageCache:e.idPageCache})};t.dataService.executeActions(r).done(function(i){t.notifyExecution(i.response,e)}).fail(function(i){t.notifyExecution("Error",e)})},notifyExecution:function(e,t){},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.properties.readOnly=!0,this.postRender()},renderControl:function(){var e,t=this.properties,i="";if("design"==this.getMode()){e=this.renderFactory.getTemplate("render-polymorphicLauncher-design");var r={type:t.type,allowSearch:t.allowSearch};i=$.fasttmpl(e,r)}else t.surrogatedKey&&(e=this.renderFactory.getTemplate("render-polymorphicLauncher"),i=$.fasttmpl(e));return i},isValid:function(e){this.properties;var t=this._super(e);this.getValue();return t},setDisplayValue:function(e){this.setValue(e,!1)},actionManager:function(e){var t=this,i=e.guidObject||"",r=new $.Deferred;switch(e.recordXpath=t.getFormContainer().properties.recordXpath,e.actionType){case"Process":var n={guidWFClass:i};$.when(t.dataService.hasStartForm(n)).done(function(n){n.hasStartForm?$.when(t.processStartForm({guidprocess:i,title:e.displayNamee,recordXpath:e.recordXpath})).done(function(t){e.idStartScope=t,r.resolve(e)}):r.resolve(e)});break;case"Rule":r.resolve(e);break;case"Form":$.when(t.processActionForm(e)).done(function(t){e.idStartScope=t,r.resolve(e)})}return r.promise()},addActionToQueue:function(e){var t=this,i=t.getValue(),r=t.getFormContainer().getParams();e.params=e.params||{};var n=t.properties.xpathContext;switch(e.actionType){case"Process":e.params={additionalXpaths:t.properties.additionalXpath.join(","),idParentWorkitem:r.idWorkitem||bizagi.context.idWorkItem,recordXpath:n},void 0!==e.idStartScope&&(e.params.idStartScope=e.idStartScope);break;case"Form":e.params={idStartScope:e.idStartScope,additionalXpaths:t.properties.additionalXpath.join(","),entityXpath:t.properties.xpathActions,idParentWorkitem:r.idWorkitem||bizagi.context.idWorkItem,idEntity:e.idEntity,guidEntity:e.guidEntity}}i.push(e),t.setValue(i),t.setDisplayValue(i)},removeActionToQueue:function(e){var t=this.getValue();t.splice(e,1),this.setValue(t),this.setDisplayValue(t)},collectData:function(e){if(this.controlValueIsChanged()){var t=this.properties.xpath,i=this.getValue(),r=[];$.each(i,function(e,t){var i={};i.params=t.params||{},i.guidAction=t.guidObject||t.guidAction,i.displayName=t.displayName,i.guidConstructor=t.guidConstructor,i.actionType=t.actionType,i.xpathContext=t.xpathContext,i.guidEntity=t.guidEntity,r.push(i)}),e[t]=0==r.length?"":JSON.encode(r)}},countSameActions:function(e){var t=this.getValue(),i=0;return $.each(t,function(t,r){r.guidAction==e.guidAction&&i++}),i},getTagList:function(e){for(var t=[],i=(e=e||[]).length;i>0;i--)t.push(e[i-1].value);return t.length>0?t:""}}),bizagi.rendering.element.extend("bizagi.rendering.columns.column",{},{init:function(e){this._super(e),this.decoratedClass=e.decorated,this.data=e.data,e.singleInstance?(this.decorated=new this.decoratedClass({data:this.data,parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService}),this.decorated.getControl=this.getControl,e.decorated=this.decorated,this.decorated.properties.isColumn=!0):this.decorateRenders=[],this.grid=e.parent;var t=this.properties;t.columnVisible=null==bizagi.util.parseBoolean(t.columnVisible)||bizagi.util.parseBoolean(t.columnVisible),t.align=t.align||"center",t.textFormat=t.textFormat||{},t.submitOnChange=void 0!==t.submitOnChange&&bizagi.util.parseBoolean(t.submitOnChange),t.singleInstance=e.singleInstance,t.editable=void 0===t.editable||bizagi.util.parseBoolean(t.editable),t.visible=void 0===t.visible||bizagi.util.parseBoolean(t.visible),t.required=void 0!==t.required&&bizagi.util.parseBoolean(t.required),t.showColumn=void 0===t.showColumn||bizagi.util.parseBoolean(t.showColumn);try{e.parent&&"boolean"==typeof e.parent.properties.editable&&!e.parent.properties.editable&&(t.editable=!1)}catch(e){}this.readonly=void 0!==t.readonly&&t.readonly,this.readonly&&(t.editable=required=!1),this.originalProperties=JSON.parse(JSON.encode(t))},isReadonly:function(){return!1},getControl:function(){return $(".ui-bizagi-render-control",this.element||this.observableElement)},getDecorated:function(e){var t=this;if(t.properties.singleInstance)return t.decorated;var i=t.decorateRenders[e];if(null==i){"object"!=typeof t.decorateRenders&&(t.decorateRenders=[]);var r=new this.decoratedClass({data:bizagi.clone(this.data),parent:this.parent,renderFactory:this.renderFactory,dataService:this.dataService});i=r,t.decorateRenders[e]=r,i.surrogateKey=e,t.applyOverrides(i),"summary"==e&&"columnMoney"!=i.properties.type&&"columnNumber"!=i.properties.type&&(i.setDisplayValue=function(e){this.getControl().html(e)})}return i},ready:function(){return this.readyDeferred.promise()},initialize:function(){},canBeSent:function(e,t){var i=this.getDecorated(e);return t&&(i.properties.visible=t.visible,i.properties.editable=t.editable),i.canBeSent()||!this.properties.editable&&this.hasChanged()||!i.properties.editable&&this.hasChanged()},isValueValid:function(e,t,i,r){var n=this.getDecorated(e),a=[];return r.visible&&(this.setValue(e,t),n.properties=$.extend(n.properties,r),this.grid&&void 0===n.grid&&(n.grid=this.grid),n.isValid(a)),!(a.length>0)||($.each(a,function(e,t){i.push(t.message)}),!1)},applyOverrides:function(e){},render:function(e,t){var i=this,r=i.properties,n=i.getDecorated(e);if(n.grid=i.grid,n.column=this,n.surrogateKey=e,i.setValue(e,t),i.overrideDecoratedRenderProperties(e),i.changed=!1,!r.editable&&"CALLER_RENDER_READ_ONLY_COLUMNSLINK"!==arguments[3])return i.renderReadOnly.apply(i,arguments);i.readyDeferred=new $.Deferred;var a=n.render("cell");return n.bind("renderchange",function(){i.changed=!0}),i.bind("rendered",function(){i.readyDeferred.resolve()}),a},postRender:function(e,t){this.getDecorated(e).postRenderElement(t)},renderReadOnly:function(e,t){var i=this,r=i.getDecorated(e);r.grid=i.grid,r.column=this,r.surrogateKey=e,i.setValue(e,t),i.overrideDecoratedRenderProperties(e),r.properties.editable=!1,i.readyDeferred=new $.Deferred;var n=r.render("cell.readonly");return i.bind("rendered",function(){i.readyDeferred.resolve()}),n},renderSummary:function(e,t){var i=this.renderFactory.getTemplate("cell.summary");return $.tmpl(i).html()},postRenderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties.editable;i.properties.editable=!1,this.properties.singleInstance&&(i.element=t),i.postRenderElement(t),i.properties.editable=r},postRenderSummary:function(){return!1},getCell:function(){return this.decorated.getDisplayValue()},setSurrogateKey:function(e){this.surrogateKey=e},setValue:function(e,t){var i=this.getDecorated(e);"undefined"!=i&&null!=i&&(i.properties.originalValue=t,i.properties.previousValue=t,null==t&&void 0!==this.properties.defaultvalue&&null!=i.grid&&(t=this.setDefaultValue(e,i)),i.properties.value=t,i.setValue(t,!1))},setDefaultValue:function(e,t){var i=this.properties.defaultvalue;return t.grid.changes[e]=t.grid.changes[e]||{},t.grid.changes[e][this.properties.xpath]=i,i},getValue:function(e){return this.getDecorated(e).getValue()},getCompositeValue:function(e){return this.getValue(e)},getElementType:function(){return bizagi.rendering.element.ELEMENT_TYPE_COLUMN},hasChanged:function(){return this.changed},trigger:function(e,t){this.decorated&&this.decorated.trigger(e,t)},triggerHandler:function(e,t){this.decorated&&this.decorated.triggerHandler(e,t)},bind:function(e,t){this.decorated&&this.decorated.bind(e,t)},unbind:function(e,t){this.decorated&&this.decorated.unbind(e,t)},overrideDecoratedRenderProperties:function(e){var t=this.getDecorated(e);t.properties.editable=this.properties.editable,t.properties.visible=this.properties.visible,t.properties.required=this.properties.required},overrideProperties:function(e){var t=this;t.properties.editable=e.editable||t.properties.editable,t.properties.visible=e.visible||t.properties.visible,t.properties.required=e.required||t.properties.required},getSortName:function(){var e=this.getAnyDecoratedInstance();return e&&e.getSortColumn?e.getSortColumn():this.properties.xpath},getAnyDecoratedInstance:function(){var e;for(e in this.decorateRenders)break;return e?this.decorateRenders[e]:null},dispose:function(){var e=this;setTimeout(function(){e.decorated&&(e.decorated.unbind("renderchange"),e.decorated.dispose()),e.decorateRenders&&bizagi.util.arrayEach(e.decorateRenders,function(e,t){t&&(t.unbind("renderchange"),t.dispose())})},bizagi.override.disposeTime||50),e._super()}}),$.Class.extend("bizagi.rendering.columns.readonly",{},{init:function(e){this._super(e),this.properties.editable=required=!1},isReadonly:function(){return!0},render:function(e,t){if("string"==typeof t){var i=t.replaceAll("\\n","<br/>");return i=i.replaceAll("\n","<br/>")}return null===t?"":t},postRender:function(e,t){},renderReadOnly:function(e,t){return this.render(e,t)},postRenderReadOnly:function(e,t){},isValueValid:function(){return!0}}),$.Class.extend("bizagi.rendering.columns.combo",{},{init:function(e){this._super(e);var t=this.properties;t.recalculate=bizagi.util.parseBoolean(t.recalculate)||!1},applyOverrides:function(e){var t=this.properties;this._super(e),t.recalculate||(e.originalGetData=e.getData,e.getData=this.getDataForAllCells,e.findDataById=this.findDataById)},findDataById:function(e){var t={};return this.column&&this.column.comboData&&$.each(this.column.comboData,function(i,r){r.id==e&&(t=r)}),t},getDataForAllCells:function(e){var t=this.column;return t.comboData?t.comboData:t.fetchingData?t.dataPromise:(t.fetchingData=!0,t.dataPromise=$.when(this.originalGetData(e)).pipe(function(e){return t.comboData=e,t.fetchingData=!1,e}),t.dataPromise)},setValue:function(e,t){var i=this,r=i.getDecorated(e);if(null!==r){if("summary"==e)return i._super(e,t);if(t&&bizagi.util.isString(t))i._super(e,t);else if(t&&t.length>0){var n={id:t[0][0],value:t[0].length>2?$.grep(t[0],function(e,t){return 0!=t}):t[0][1]};i._super(e,n),r.selectedValue=n.value}else t&&t.id&&t.value?(i._super(e,t),r.selectedValue=t.value):"columnRadio"==i.properties.type?(i._super(e,null),r.selectedValue=t):t&&"number"==typeof t?i._super(e,t):(i._super(e,null),r.selectedValue="")}},getCompositeValue:function(e){var t=this.getDecorated(e),i=t.getValue(),r=t.getSelectedValue(),n=[];return i&&(i.id>0||bizagi.util.isString(i.id))?(n.push([]),n[0].push(i.id),n[0].push(r)):n.push([]),n},getValue:function(e){var t=this.getDecorated(e).getValue();return t?t.id:t},render:function(e,t,i){var r=this.getDecorated(e),n=this.properties;n.recalculate&&r.resetData();var a=n.xpathContext.length>0?n.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return r.properties.xpathContext=a,this._super(e,t,i)},renderReadOnly:function(e,t){var i=this.getDecorated(e),r=this.properties,n=r.xpathContext.length>0?r.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return i.properties.xpathContext=n,this._super(e,t)}}),$.Class.extend("bizagi.rendering.columns.date",{},{setValue:function(e,t){var i=this,r=i.getDecorated(e);if(null!==r){if(i._super(e,t),null==t&&void 0!==i.properties.defaultvalue&&(t=i.setDefaultValue(e,r)),"summary"===e)return i._super(e,t);null==t&&(r.setValue(t,!1),r.properties.displayValue="");var n=bizagi.util.dateFormatter.getDateFromInvariant(t,r.properties.showTime);if(0===n&&(n=bizagi.util.dateFormatter.getDateFromInvariant(t,!r.properties.showTime)),0!==n){var a=bizagi.localization.getResource("datePickerRegional"),o=bizagi.util.dateFormatter.formatDate(n,r.properties.fullFormat,a);r.properties.displayValue=o,r.setValue(t,!1)}}},setDefaultValue:function(e,t){var i=this.properties.defaultvalue;return t.grid.changes[e]=t.grid.changes[e]||{},i=bizagi.util.dateFormatter.getDateFromInvariant(i,t.properties.showTime||!1),i=bizagi.util.dateFormatter.formatInvariant(i,!0),t.grid.changes[e][this.properties.xpath]=i,i}}),$.Class.extend("bizagi.rendering.columns.search",{},{init:function(e){this._super(e);var t=this.properties;t.advancedSearch&&"execution"===this.getMode()&&(t.submitOnChange=bizagi.util.parseBoolean(t.submitOnChange)||!1,t.submitOnChange=!((t.submitVersion||1)>1)||t.submitOnChange)},render:function(e,t,i){var r=this.getDecorated(e),n=this.properties;n.recalculate&&r.resetData();var a=n.xpathContext.length>0?n.xpathContext+"."+this.grid.properties.xpath+"[id="+e+"]":this.grid.properties.xpath+"[id="+e+"]";return r.properties.xpathContext=a,this._super(e,t,i)},getValue:function(e){var t=this.getDecorated(e).getValue();return t&&"object"==typeof t?t.id:t},setValue:function(e,t){var i=this,r=i.getDecorated(e);if(null!==r){if("summary"==e)return i._super(e,t);if(t&&t.length>0){var n={id:t[0][0],value:t[0].length>2?$.grep(t[0],function(e,t){return 0!=t}):t[0][1]};i._super(e,n),r.selectedValue=n.value}else t&&t.id&&t.value?(i._super(e,t),r.selectedValue=t.value):t&&t.id&&t.label?(i._super(e,t),r.selectedValue=t.label):(i._super(e,t),r.selectedValue="")}}}),$.Class.extend("bizagi.rendering.base.factory",{},{init:function(e){this.templates={},this.dataService=e},loadOverrides:function(){},initAsyncStuff:function(){return $.when.apply($,[this.loadOverrides(),this.loadTemplates()])},loadTemplates:function(){},loadTemplate:function(e,t){var i=this;return bizagi.templateService.getTemplate(t,e).done(function(t){i.templates[e]=t})},getCommonTemplate:function(e){return this.templates[e]},getContainer:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"form"==t?new bizagi.rendering.form(r):"mobileform"==t?new bizagi.rendering.mobileform(r):"template"==t?new bizagi.rendering.formTemplate(r):"queryForm"==t?new bizagi.rendering.queryForm(r):"layout"==t?new bizagi.rendering.layout(r):"usersForm"==t?new bizagi.rendering.usersForm(r):"panel"==t?new bizagi.rendering.panel(r):"contentPanel"==t||"contentpanel"==t?new bizagi.rendering.contentPanel(r):"nestedform"==t.toLowerCase()?new bizagi.rendering.nestedForm(r):"tab"==t?new bizagi.rendering.tab(r):"tabItem"==t||"tabitem"==t?new bizagi.rendering.tabItem(r):"horizontal"==t?new bizagi.rendering.horizontal(r):"accordion"==t?new bizagi.rendering.accordion(r):"accordionItem"==t?new bizagi.rendering.accordionItem(r):"group"==t?new bizagi.rendering.group(r):"mobilegroup"==t?new bizagi.rendering.mobilegroup(r):"searchForm"==t?(r.context="search",r.contexttype="metadata",new bizagi.rendering.searchForm(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return t||(t="label"),"text"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.extendedText(r):new bizagi.rendering.text(r):"mobiletext"==t?new bizagi.rendering.mobiletext(r):"association"==t?new bizagi.rendering.association(r):"label"==t?new bizagi.rendering.label(r):"hidden"==t?new bizagi.rendering.hidden(r):"number"==t?new bizagi.rendering.number(r):"money"==t?new bizagi.rendering.money(r):"date"==t?new bizagi.rendering.date(r):"boolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.check(r):new bizagi.rendering.yesno(r):"combo"==t?new bizagi.rendering.combo(r):/^cascadingcombo$/i.test(t)?new bizagi.rendering.cascadingCombo(r):"list"==t?new bizagi.rendering.list(r):"multiSelect"==t?new bizagi.rendering.multiSelect(r):"radio"==t?new bizagi.rendering.radio(r):"image"==t?new bizagi.rendering.image(r):"uploadecm"==t?new bizagi.rendering.ecm(r):"upload"==t?new bizagi.rendering.upload(r):"grid"==t?new bizagi.rendering.grid(r):"groupedgrid"==t?new bizagi.rendering.grid(r):"search"==t?new bizagi.rendering.search(r):"suggest"==t?(r.data.properties.enableQuerySuggestBehavior=!0,new bizagi.rendering.search(r)):"searchList"==t?new bizagi.rendering.searchList(r):"letter"==t?new bizagi.rendering.letter(r):"button"==t?new bizagi.rendering.button(r):"formLink"==t?new bizagi.rendering.formLink(r):"link"==t?new bizagi.rendering.link(r):"layoutImage"==t?new bizagi.rendering.layoutImage(r):"layoutLink"==t?new bizagi.rendering.layoutLink(r):"layoutLabel"==t?new bizagi.rendering.layoutLabel(r):"layoutText"==t?new bizagi.rendering.layoutText(r):"layoutDateTime"==t?new bizagi.rendering.layoutDateTime(r):"layoutNumber"==t?new bizagi.rendering.layoutNumber(r):"layoutMoney"==t?new bizagi.rendering.layoutMoney(r):"layoutPlaceholder"==t?new bizagi.rendering.layoutPlaceholder(r):"actionLauncher"==t?new bizagi.rendering.actionLauncher(r):"layoutBoolean"==t?new bizagi.rendering.layoutBoolean(r):"layoutUpload"==t?new bizagi.rendering.layoutUpload(r):"entityTemplate"==t?new bizagi.rendering.entityTemplate(r):"polymorphicLauncher"==t?new bizagi.rendering.polymorphicLauncher(r):"userfield"==t?new bizagi.rendering.userfieldWrapper(r):0==t.indexOf("search")?this.getSearchRender(e):0==t.indexOf("query")?this.getQueryRender(e):"document"==t?new bizagi.rendering.document(r):"image"==t?new bizagi.rendering.image(r):"fileprint"==t?new bizagi.rendering.fileprint(r):"geolocation"==t?new bizagi.rendering.geolocation(r):"collectionnavigator"==t?new bizagi.rendering.collectionnavigator(r):"getUser"==t?new bizagi.rendering.getUser(r):"rangeDate"==t?new bizagi.rendering.rangeDate(r):"rangeMoney"==t?new bizagi.rendering.rangeMoney(r):"rangeNumber"==t?new bizagi.rendering.rangeNumber(r):"activityCheckList"==t?new bizagi.rendering.activityCheckList(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getColumn:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance});if("columnText"==t){var n=bizagi.util.parseBoolean(i.properties.isExtended)||!1;return r.decorated=n?bizagi.rendering.extendedText:bizagi.rendering.text,new bizagi.rendering.columns.text(r)}if("columnSearchList"==t)return r.decorated=bizagi.rendering.searchList,new bizagi.rendering.columns.searchList(r);if("columnNumber"==t)return r.decorated=bizagi.rendering.number,new bizagi.rendering.columns.number(r);if("columnMoney"==t)return r.decorated=bizagi.rendering.money,new bizagi.rendering.columns.number(r);if("columnDate"==t)return r.decorated=bizagi.rendering.date,new bizagi.rendering.columns.date(r);if("columnBoolean"==t){if("check"==(i.properties.display||"option")){if(r.decorated=bizagi.rendering.check,e.data.properties.isExclusive)return new bizagi.rendering.columns.exclusiveCheck(r)}else r.decorated=bizagi.rendering.yesno;return new bizagi.rendering.columns.column(r)}return"columnCombo"==t?(r.decorated=bizagi.rendering.combo,new bizagi.rendering.columns.combo(r)):"columnRadio"==t?(r.decorated=bizagi.rendering.radio,new bizagi.rendering.columns.radio(r)):"columnList"==t?(r.decorated=bizagi.rendering.list,new bizagi.rendering.columns.list(r)):"columnHidden"==t?(r.decorated=bizagi.rendering.hidden,new bizagi.rendering.columns.column(r)):"columnUpload"==t?(r.decorated=bizagi.rendering.upload,new bizagi.rendering.columns.upload(r)):"columnImage"==t?(r.decorated=bizagi.rendering.image,new bizagi.rendering.columns.image(r)):"columnUploadEcm"==t?(r.decorated=bizagi.rendering.ecm,new bizagi.rendering.columns.uploadecm(r)):"columnLink"==t?(r.decorated=bizagi.rendering.link,new bizagi.rendering.columns.link(r)):"columnFormLink"==t?(r.decorated=bizagi.rendering.formLink,new bizagi.rendering.columns.link(r)):"columnUserfield"==t?(r.decorated=bizagi.rendering.userfieldWrapper,new bizagi.rendering.columns.column(r)):"columnSearch"==t?(r.decorated=bizagi.rendering.search,new bizagi.rendering.columns.search(r)):"columnLabel"==t?(r.decorated=bizagi.rendering.label,new bizagi.rendering.columns.column(r)):"columnReadonly"==t?(r.decorated=bizagi.rendering.label,new bizagi.rendering.columns.readonly(r)):"columnDocument"==t?(r.decorated=bizagi.rendering.document,new bizagi.rendering.columns.document(r)):"columnLetter"==t?(r.decorated=bizagi.rendering.letter,new bizagi.rendering.columns.letter(r)):"columnButton"==t?(r.decorated=bizagi.rendering.button,new bizagi.rendering.columns.button(r)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getSearchRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"searchText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.extendedText(r):new bizagi.rendering.text(r):"searchBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.check(r):new bizagi.rendering.yesno(r):"searchNumber"==t?29==i.properties.dataType?new bizagi.rendering.numberScientificNotation(r):new bizagi.rendering.number(r):"searchMoney"==t?new bizagi.rendering.money(r):"searchDate"==t?new bizagi.rendering.date(r):"searchCombo"==t?new bizagi.rendering.combo(r):"searchSuggest"==t?new bizagi.rendering.search(r):"searchLabel"==t?new bizagi.rendering.label(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getQueryRender:function(e){var t=e.type,i=e.data,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"queryText"==t?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.queryExtendedText(r):new bizagi.rendering.queryText(r):"queryBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.queryCheck(r):new bizagi.rendering.queryYesNo(r):"queryNumber"==t?new bizagi.rendering.queryNumber(r):"queryMoney"==t?new bizagi.rendering.queryMoney(r):"queryDate"==t?new bizagi.rendering.queryDate(r):"queryCombo"==t?new bizagi.rendering.queryCombo(r):"queryCascadingCombo"==t?new bizagi.rendering.queryCascadingCombo(r):"querySuggest"==t?new bizagi.rendering.querySuggest(r):"queryLabel"==t?new bizagi.rendering.queryLabel(r):"queryList"==t?new bizagi.rendering.queryList(r):"queryMultiSelect"==t?new bizagi.rendering.queryMultiSelect(r):"querySearch"==t?new bizagi.rendering.querySearch(r):"queryRadio"==t?new bizagi.rendering.queryRadio(r):"queryState"==t?new bizagi.rendering.queryState(r):"queryCaseState"==t?new bizagi.rendering.queryCaseState(r):"queryProcess"==t?new bizagi.rendering.queryProcess(r):"querySearchUser"==t?new bizagi.rendering.querySearchUser(r):"queryHidden"==t?new bizagi.rendering.hidden(r):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getTemplate:function(e){return this.templates[e]}}),$.Class.extend("bizagi.rendering.device.factory",{},{init:function(e){this.execution_device=bizagi.util.detectDevice(),this.cachedFactory={}},getRenderFactory:function(e,t){var i=this;t=t||"desktop";var r=new $.Deferred;return void 0!==i.cachedFactory[t]?(i.cachedFactory[t].printVersion=!1,r.resolve(i.cachedFactory[t])):"print"===t?(i.cachedFactory[t]=new bizagi.rendering.print.factory(e),i.cachedFactory[t].initAsyncStuff().done(function(){r.resolve(i.cachedFactory[t])})):"desktop"===t?(i.cachedFactory[t]=new bizagi.rendering.desktop.factory(e),i.cachedFactory[t].initAsyncStuff().done(function(){r.resolve(i.cachedFactory[t])})):bizagi.util.isTabletDevice(t)?(i.cachedFactory[t]=new bizagi.rendering.tablet.factory(e),i.cachedFactory[t].initAsyncStuff().done(function(){r.resolve(i.cachedFactory[t])})):bizagi.util.isSmartphoneDevice(t)?(i.cachedFactory[t]=new bizagi.rendering.smartphone.factory(e),i.cachedFactory[t].initAsyncStuff().done(function(){r.resolve(i.cachedFactory[t])})):(bizagi.showMessageBox("Not supported device: "+t),r.reject("Not supported device: "+t)),r.promise()},getDataService:function(){return this.dataService}}),bizagi.rendering=bizagi.rendering||{},$.Class.extend("bizagi.rendering.facade",{form:void 0,executionDeferred:new $.Deferred},{init:function(e){e=e||{},this.observableElement=$({});var t=e.device||"";this.deviceFactory=new bizagi.rendering.device.factory,this.dataService=new bizagi.render.services.service(e),this.renderFactory=this.deviceFactory.getRenderFactory(this.dataService,t)},getFactory:function(){return{deviceFactory:this.deviceFactory,dataService:this.dataService,renderFactory:this.renderFactory}},subscribe:function(){this.observableElement.bind.apply(this.observableElement,arguments)},unsubscribe:function(){this.observableElement.unbind.apply(this.observableElement,arguments)},publish:function(){return this.observableElement.triggerHandler.apply(this.observableElement,arguments)},update:function(e){return e.mode&&(this.mode=e.mode),this.execute($.extend({canvas:this.canvas,mode:this.mode},e))},execute:function(e){var t=this,i=this.ownerDocument,r=$("body",i);if(e=e||{},t.executionDeferred&&t.executionDeferred.state?"resolved"==t.executionDeferred.state()&&(t.executionDeferred=$.Deferred()):t.executionDeferred=$.Deferred(),bizagi.chrono.initAndStart("rendering+data",!0),bizagi.rendering.render.startOptimization(),void 0===e.mode&&!bizagi.util.isEmpty(window.location.search)){var n=bizagi.util.getQueryString();e.mode=n.mode}var a=t.canvas=e.canvas=e.canvas||$("<div />").appendTo(r);return t.mode=e.mode,t.process(e).done(function(i){e.refreshing||a.empty(),a.append(i.container),$(i.pathProcess).insertBefore(i.container),t.form=i,t.form.setSize({width:t.lastWidth,height:t.lastHeight}),setTimeout(function(){t.lastWidth=$(window).width(),t.lastHeight=$(window).height(),window.self!==window.top&&t.resizeInPopUpHTML()},2e3),i.triggerHandler("ondomincluded"),t.publish("rendering-formRendered",{}),t.configureRefresh(i,a),t.configureRouting(i,a),t.configureRenderError(i,a),t.configureResize(i),t.configureGlobalHandlers(i),e.summaryForm&&i.container.addClass("ui-bizagi-summary-form"),bizagi.chrono.stopAndLog("rendering"),bizagi.chrono.stopAndLog("rendering+data"),bizagi.chrono.stopAndLog("submitForm"),bizagi.chrono.stopAndLog("submitForm-ajax"),bizagi.chrono.stopAndLog("waiting"),bizagi.rendering.render.stopOptimization(),bizagi.override.enableE2EInterface&&(t.Class.form=t.form,t.Class.executionDeferred.resolve(t.form)),t.executionDeferred.resolve(t.form)}).fail(function(e,i){$.when(t.renderFactory).done(function(i){void 0!==e&&""!==e||(e=bizagi.localization.getResource("render-error-unknown"));var r=i.getCommonTemplate("form-error");a.empty(),a.append($.tmpl(r,{message:e})),t.publish("rendering-formRenderedError",e),t.canvas.triggerHandler("errorform",e),bizagi.chrono.stopAndLog("rendering"),bizagi.chrono.stopAndLog("rendering+data"),t.executionDeferred.reject()})}),t.executionDeferred.promise()},ready:function(){return this.executionDeferred.promise()},process:function(e){var t=this,i=new $.Deferred,r=t.dataService.getFormData(e),n=t.canvas||e.canvas;return bizagi.showErrorAlertDialog=!1,$.when(r,t.renderFactory).done(function(r,a){if(bizagi.showErrorAlertDialog=!0,bizagi.util.isEmpty(r))return t.publish("no-data-found"),void i.fail();if(r&&"reload"==r.type)(l=t.form)&&(l.endLoading(),l.dispose()),n.triggerHandler("routing");else if(r&&"suspended"==r.type){var o=a.getTemplate("info-message"),s=bizagi.localization.getResource("render-case-suspended");$.tmpl(o,{message:s}).appendTo(n),i.fail()}else if(r&&"error"!=r.type){e.hasOwnProperty("printversion")&&((r=t.transformGridControl(r)).form.properties.editable="False"),bizagi.chrono.initAndStart("rendering"),e.type=r.form&&r.form.properties.type||e.type;var l=t.processForm(r.form,a,e);i.resolve(l)}else t.getFailDeferred(r,i)}).fail(function(e){t.getFailDeferred(e,i)}),i.promise()},transformGridControl:function(e){var t=this;return null==e?e:(e.hasOwnProperty("type")&&"grid"==e.type?(e.id=e.id+"-print",e.allowAdd="False",e.allowDelete="False",e.allowEdit="False",e.allowGrouping="False",e.allowMore="False",e.allowSearch="False"):$.each(e,function(i,r){"object"==typeof r&&(e[i]=t.transformGridControl(e[i]))}),e)},getFailDeferred:function(e,t){var i="",r={};try{r=JSON.parse(e.responseText)}catch(t){r={message:e.responseText,errorType:"ERRORUNKNOWN"}}r.message?(i+="<br>Error Type: "+r.errorType,i+="<br>Error Message: "+r.message):"JSharpNotSupportedException"==r.errorType&&(i+="<br>Error Message: "+bizagi.localization.getResource("jsharp-required")),"ERRORUNKNOWN"==r.errorType?t.reject(i,r.errorType):t.reject(i)},processForm:function(e,t,i){var r=t.getContainer($.extend(i,{type:i.type||"form",data:e}));if("undefined"!=typeof BIZAGI_ORIENTATION&&("rtl"==r.properties.orientation||"rtl"==BIZAGI_ORIENTATION)&&r.buttons.length>0){var n=r.buttons[0];r.buttons.splice(0,1),r.buttons.push(n)}return r.render(),r},resize:function(e){this.form&&this.form.trigger("renderresize",e)},configureRefresh:function(e,t){var i=this;e.bind("refresh",function(r,n){var a=e.container.parent(),o=(a=bizagi.util.scrollTop(a)).scrollTop();$(i.form).trigger("onRefreshStarted"),e.dispose(n),t.fastEmpty();var s=t.parent();s.find(".ui-bizagi-button-container").length>0&&s.find(".ui-bizagi-button-container").remove(),i.executionDeferred&&i.executionDeferred.state&&"resolved"==i.executionDeferred.state()&&(i.executionDeferred=$.Deferred());var l=i.form.getParams();return $.when(i.execute($.extend(n,{canvas:t,refreshing:!0,idCase:l.idCase,displayName:l.displayName}))).done(function(){setTimeout(function(){a.scrollTop(o),$(i.form).trigger("onRefreshFinished")},100)}),i.executionDeferred.promise()})},configureResize:function(e){var t=this;e.bind("renderresize",function(i,r){if(r=r||{},!t.resizeTimeout){t.resizeTimeout=setTimeout(function(){var i=$(window).width(),n=$(window).height();(r.forceResize||i!=t.lastWidth)&&(bizagi.chrono.initAndStart("resize"),e.resize({width:i,height:n}),t.lastWidth=i,t.lastHeight=n,bizagi.chrono.stopAndLog("resize"),bizagi.chrono.log("resize")),t.resizeTimeout=null},0)}}),t.resize()},configureRouting:function(e,t){e.bind("routing",function(i,r){e.dispose(),t.triggerHandler("routing",r)})},configureGlobalHandlers:function(e){var t=this;e.bind("globalHandler",function(e,i){return t.publish(i.eventType,i.data)})},configureRenderError:function(e,t){var i=this;e.bind("formRenderingError",function(e,r){$.when(i.renderFactory).done(function(e){var n="<br>Error: ";r=r.replace(/(\r\n|\n|\r)/gm,"");var a=JSON.parse(r);a.message&&(n+=a.message,n+="<br>Error Type: "+a.errorType);var o=e.getCommonTemplate("form-error");t.empty(),t.append($.tmpl(o,{message:n})),i.canvas.triggerHandler("errorform","renderItemError"),bizagi.chrono.stopAndLog("rendering+data"),bizagi.chrono.stopAndLog("rendering")})})},dispose:function(){this.form&&this.form.dispose(),bizagi.util.dispose(this)},resizeInPopUpHTML:function(){if($(".activitiFormContainer").length>0&&"cases"!=bizagi.util.getQueryString().type){var e=$(".activitiFormContainer").height()||0,t=$(".activitiFormContainer #ui-bizagi-webpart-render-container"),i=$(".ui-bizagi-button-container",".activitiFormContainer"),r=i.outerHeight()||0,n=bizagi.util.getQueryString().renderBehavior||"";if("PopUp"==(n=n.replace("#",""))){if(void 0===self.postMessageSocket){var a=$(".activitiFormContainer").height()-50||396;$("#render-canvas").height(a),$("#render-canvas").css("overflowY","scroll")}else $(".activitiFormContainer").height($(".activitiFormContainer").height()+$(".ui-bizagi-button-container").height()+30);$(".ui-bizagi-button-container").css("position","absolute"),$(".ui-bizagi-button-container").appendTo(".activitiFormContainer"),$(".ui-bizagi-button-container").length>1&&($(".ui-bizagi-button-container:first").hide(),t.css("marginTop","-17px"))}i.length>0&&t.height(e-97-r),0==$(".ui-bizagi-button-container").children().length?$("#render-canvas").height($("#render-canvas").height()+r):(i.width("100%"),i.css("marginLeft",0),i.css("bottom",0))}else"render"==bizagi.util.getQueryString().type&&($("html").css("overflowX","hidden"),$("#render").height()<=window.innerHeight+5?$("html").css("overflowY","hidden"):$("html").css("overflowY","scroll"),$(".ui-widget-overlay").height(650))}});
//# sourceMappingURL=../../../../Maps/tablet_android/forms_base.tablet.production.js.map
