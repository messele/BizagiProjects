$.Class.extend("bizagi.rendering.tablet.slide.view",{},{init:function(e,t,i){var a=this;a.dataService=e,a.renderFactory=t,a.slideFormParams=i||{},a.slideFormDeferred=new $.Deferred,a.container=a.slideFormParams.navigation.createRenderContainer({title:a.slideFormParams.title})},buttons:[],processButtons:function(e){var t=this;e.buttons=[$.extend(e.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){if(e&&e.validateForm()){var i={};e.collectRenderValues(i),t.slideFormParams.allowGetOriginalFormValues&&(i.formValues=e.children),i.idPageCache=e.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(i)).done(function(a){a&&!0!==a&&"success"!==a.type?"validationMessages"===a.type?e.addValidationMessage(a.messages):"error"===a.type&&e.addErrorMessage(a.message):(t.goBack(),t.slideFormDeferred.resolve(i))}).fail(function(a){var r=a.responseText?a.responseText:"string"==typeof a?a:a.toString();if("string"==typeof r)try{r=JSON.parse(r).message}catch(e){r=(r=r.match(/"message":(.*)",/)[0]).substr(11,r.length-13)}else r.message||(r=a);e.validateForm(),e.clearValidationMessages(),e.addValidationMessage(r),t.goBack(),t.slideFormDeferred.resolve(i)}):(t.goBack(),t.slideFormDeferred.reject())}}}),$.extend(e.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){t.goBack(),t.slideFormDeferred.reject()}})],t.slideFormParams.showSaveButton||e.buttons.shift()},render:function(e){var t=this;return t.renderSlideForm(t.slideForm,e),t.slideFormDeferred.promise()},renderSlideForm:function(e,t){var i=this,a=new $.Deferred;return bizagi.loading.start(),$.when(i.dataService.getFormData(t)).then(function(e){return t.recordXPath&&(e.form.properties.recordXpath=t.recordXPath),i.slideFormParams.showSaveButton&&!1!==t.editable||(e.form.properties.editable=!1),void 0!==e.form.properties&&(e.form.properties.orientation=i.slideFormParams.orientation||"ltr"),i.form=i.renderFactory.getContainer({type:"form",data:e.form,navigation:i.slideFormParams.navigation,view_container:i.container}),i.form.params=t.formParams,i.processButtons(i.form),i.form.render()}).done(function(e){i.container.element.html(e),t.isRefresh||i.slideFormParams.navigation.navigate(i.container.id),i.container.setNavigationButtons(i.form),$(".ui-bizagi-button-container .action-button",i.form.container).remove(),$(".ui-bizagi-button-container",i.form.container).append(i.buttonContainer),i.form.triggerHandler("ondomincluded"),i.form.bind("refresh",function(e,t){t.formParams=t.params||i.form.params,i.render(t)})}).fail(function(e){var t=i.renderFactory.getCommonTemplate("form-error"),a=e.message||"Error";$.fasttmpl(t,{message:a}).appendTo(i.container.element),i.slideFormParams.navigation.navigate(i.container.id)}).always(function(){bizagi.loading.stop()}),a.promise()},goBack:function(){this.container.destroy()},_renderButtons:function(e){var t=$("<div class='bz-slide-button-container'></div>");$.each(e.buttons,function(e,i){$("<div class='action-button'>"+i.caption+"</div>").click(i.callback).appendTo(t)}),this.buttonContainer=t}}),$.Class.extend("bizagi.rendering.tablet.slide.form",{},{init:function(e,t,i){var a=this;a.dataService=e,a.renderFactory=t,a.slideFormParams=i||{},a.slideContainer&&a.slideContainer.destroy&&a.slideContainer.destroy(),a.slideContainer=a.slideFormParams.navigation.createRenderContainer({title:a.slideFormParams.title}),a.configureViewHandlers()},goBack:function(){this.slideContainer.destroy()},configureViewHandlers:function(){},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getFormData(e)).then(function(a){!1===e.editable&&(a.form.properties.editable=!1);var r=bizagi.rendering.tablet.form.extend({submitForm:function(){if(t.form&&(this.endLoading(),t.form.validateForm())){var e={};t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(e)).done(function(a){null===a||!0===a||"success"===a.type?(i.resolve(),t.goBack()):"validationMessages"===a.type?(t.form.addValidationMessage(a.messages),$.each(e,function(e,i){var a=t.form.getRenders(e);$.each(a,function(e,t){t.updateOriginalValue()})})):"error"===a.type&&t.form.addErrorMessage(a.message)}):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:a.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form||(t.form=new r(n)),t.form.render()}).done(function(i){t.slideContainer.element.html(i),t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="0" id="formButton0" class="action-button ui-bizagi-form-button">Save</div>').delegate('div[ordinal="0"]',"click",function(){t.form.submitForm()}),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="1" id="formButton1" class="action-button ui-bizagi-form-button">'+bizagi.localization.getResource("render-form-dialog-box-cancel")+"</div>").delegate('div[ordinal="1"]',"click",function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()}),t.form.triggerHandler("ondomincluded"),t.form.bind("refresh",function(){t.renderSlideForm(e)})}).fail(function(e,i,a){var r=t.renderFactory.getCommonTemplate("form-error"),n=a.message||"Error";$.fasttmpl(r,{message:n}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)}),i.promise()}}),$.Class.extend("bizagi.rendering.tablet.slide.grid",{},{init:function(e,t,i){this.dataService=e,this.renderFactory=t,this.slideFormDeferred=new $.Deferred,this.slideFormParams=i||{},this.container=this.slideFormParams.navigation.createRenderContainer({title:this.slideFormParams.title})},render:function(e){return this.renderSlideForm(this.slideForm,e),this.slideFormDeferred.resolve(),this.slideFormDeferred.promise()},renderSlideForm:function(e,t){var i=this,a=i.transformData(t);i.form=i.renderFactory.getContainer({type:"form",data:a.form,navigation:i.slideFormParams.navigation,view_container:i.container}),i.form.buttons=[$.extend(i.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){i.goBack();var e={};i.form.collectRenderValues(e),i.slideFormDeferred.resolve(e)}}),$.extend(i.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){i.goBack(),i.slideFormDeferred.reject()}})],i.slideFormParams.allowEdition||i.form.buttons.shift(),$.when(i.form.render()).done(function(e){i.container.element.html(e),i.slideFormParams.navigation.navigate(i.container.id),i.container.setNavigationButtons(i.form),$(".ui-bizagi-button-container .action-button",i.form.container).remove(),$(".ui-bizagi-button-container",i.form.container).append(i.buttonContainer),i.form.triggerHandler("ondomincluded")})},transformData:function(e){var t=this,i=e.row,a=e.columns,r=e.xpathContext.length>0?e.xpathContext+"."+e.xpath+"["+e.row[0]+"]":e.xpath+"[id="+e.row[0]+"]",n={type:"form",form:{elements:[],pageCacheId:e.pageCacheId,sessionId:e.sessionId,properties:{xpathContext:r},actions:t.transformActions(e.xpath,e.actions),validations:t.transformValidations(e.xpath,e.validations)}};return $.each(i,function(e,i){if(e>0){var r={render:{properties:$.extend({},a[e-1].properties)}};if(r.render.properties.type=t.mapRenderType(r.render.properties.type),r.render.properties.displayType="both",0==t.slideFormParams.allowEdition&&(r.render.properties.editable=!1),r.render.properties.value=t.mapValue(r.render.properties.type,i),r.render.properties.recalculate&&(r.render.properties.data=null),void 0!==r.render.properties.columnVisible&&(r.render.properties.visible=r.render.properties.columnVisible),"upload"==r.render.properties.type&&(r.render.properties.isColumn=!0),"search"==r.render.properties.type){var o=r.render.properties.value;o.length>0&&(o=[].concat(o[0]),r.render.properties.value={id:o[0],label:o[1],additionallabel:o[2]||void 0})}n.form.elements.push(r)}}),n},mapRenderType:function(e){return"FormLink"===(e=e.replaceAll("tablet","").replaceAll("column",""))?"formLink":e=e.toLowerCase()},mapValue:function(e,t){return["combo","radio","list"].includes(e)?t&&t.length>0?[{id:t[0][0],value:t[0].length>2?$.grep(t[0],function(e,t){return 0!==t}):t[0][1]}]:null:t},transformActions:function(e,t){var i=this,a=[];return bizagi.util.isEmpty(t)?a:($.each(t,function(t,r){var n=!1;for(t=0;t<r.dependencies.length;t++)-1!=r.dependencies[t].indexOf(e)&&(n=!0);if(n){var o=JSON.parse(JSON.encode(r));for(t=0;t<o.dependencies.length;t++)o.dependencies[t]=o.dependencies[t].replaceAll(e+"[].","");i.transformConditions(e,o.conditions),i.transformCommands(e,o.commands),i.transformCommands(e,o.elseCommands),a.push(o)}}),a)},transformValidations:function(e,t){var i=this,a=[];return bizagi.util.isEmpty(t)?a:($.each(t,function(t,r){var n=JSON.parse(JSON.encode(r));i.transformConditions(e,n.conditions),a.push(n)}),a)},transformConditions:function(e,t){if(t.expressions)for(i in t.expressions)this.transformConditions(e,t.expressions[i]);else t.simple?this.transformConditions(e,t.simple):t.complex?this.transformConditions(e,t.complex):t.xpath&&(t.xpath=t.xpath.replaceAll(e+"[].",""),"xpath"==t.argumentType&&(t.argument=t.argument.replaceAll(e+"[].","")))},transformCommands:function(e,t){var i=null;if(null!=t&&0!==t.length){for(var a=0;a<t.length;a++)"refresh"===t[a].command?i=a:(t[a].xpath&&(t[a].xpath=t[a].xpath.replaceAll(e+"[].","")),"xpath"===t[a].argumentType&&(t[a].argument=t[a].argument.replaceAll(e+"[].","")));null!=i&&t.splice(a,1)}},goBack:function(){this.container.destroy()},_renderButtons:function(e){var t=$("<div class='bz-slide-button-container'></div>");$.each(e.buttons,function(e,i){$("<div class='action-button'>"+i.caption+"</div>").click(i.callback).appendTo(t)}),this.buttonContainer=t}}),$.Class.extend("bizagi.rendering.tablet.slide.searchForm",{},{init:function(e,t,i,a,r){var n=this;n.dataService=e,n.renderFactory=t,n.searchForms=i,n.searchParams=a,n.slideParams=r,n.slideDeferred=new $.Deferred,n.extraButtons=!!r.hasOwnProperty("buttons")&&r.buttons,n.container=n.slideParams.navigation.createRenderContainer({title:n.slideParams.title}),n.processButtons().done(function(e){n.slideDeferred.resolve(e)}).fail(function(){n.slideDeferred.reject()}),n.configureViewHandlers()},render:function(e){return this.properties=e,this.renderSearchDialog(e),this.slideDeferred.promise()},renderSearchDialog:function(e){var t=this;bizagi.util.tablet.startLoading(),$.when(t.getSearchContainerData(e)).pipe(function(e){e.form.properties&&(e.form.properties.orientation=t.searchParams.orientation||"ltr");var i=t.renderFactory.getContainer({type:"form",data:e.form,navigation:t.slideParams.navigation,view_container:t.container});return i.buttons=[{ordinal:1,action:"search",caption:bizagi.localization.getResource("render-form-dialog-box-search"),callback:function(){t.currentSearchForm.performSearch(t.searchParams)}},{ordinal:2,action:"cancel",caption:"cancel",callback:function(){t.goBack()}},{ordinal:3,action:"add",caption:bizagi.localization.getResource("render-form-dialog-box-add"),callback:function(){var e={idCase:t.slideParams.idCase,idRender:t.properties.idRender,displayName:t.properties.displayName,idPageCache:t.properties.idPageCache};t.renderAddForm(e)}}],t.slideParams.allowNew||i.buttons.pop(),t.form=i,i.render()}).done(function(e){t.container.element.html(e),t.slideParams.navigation.navigate(t.container.id),$(".ui-bizagi-button-container",t.form.container).append(t.buttonContainer),t.searchResultContainer=$(".bz-container__search-results",e),t.searchResultContainer.hide(),t.form.triggerHandler("ondomincluded"),t.currentSearchForm=t.form.firstChild(),t.currentSearchForm.triggerHandler("ondomincluded"),t.currentSearchForm.bind("instancerefresh",function(){t.searchResultContainer.show()}),t.form.bind("refresh",function(e,i){return i.scrollTop=t.form.container.parent().scrollTop(),i=$.extend({focus:focus,selectedTabs:t.form.getSelectedTabs(),isRefresh:!0,contextType:t.properties.contextType||"",navigation:t.searchFormParams.navigation,view_container:t.container},i),t.renderSearchDialog(i)}),t.currentSearchForm.bind("instanceSelected",function(e,i){t.goBack(),t.slideBoxDeferred.resolve({id:i.id,label:""})}),t.handleSearchFormZindex("show"),t.containerSearchCriteria=t.currentSearchForm.container.find(".bz-container__search-criteria")}).always(function(){bizagi.util.tablet.stopLoading()})},renderAddForm:function(e){var t=this;e=e||{};var i=t.properties;void 0===t.addContainer&&(t.addContainer=t.slideParams.navigation.createRenderContainer({title:bizagi.localization.getResource("render-dialog-entity")}));var a=e.isRefresh||!1,r={idPageCache:e.idPageCache,guidEntity:i.entity,contextType:"entity"};a?(r.isRefresh=!0,r.idStartScope=e.idStartScope):(r.idRender=i.idRender,r.requestedForm="addForm"),bizagi.util.tablet.startLoading(),$.when(t.dataService.getFormData(r)).pipe(function(i){!1===e.editable&&(i.form.properties.editable=!1),i.form.properties&&(i.form.properties.orientation=t.searchParams.orientation||"ltr"),i.form.contextType="entity";var r=t.renderFactory.getContainer($.extend({},t.addFormParams,{type:"form",data:i.form,focus:e.focus||!1,selectedTabs:e.selectedTabs,isRefresh:a,requestedForm:e.requestedForm,navigation:t.slideParams.navigation,view_container:t.addContainer}));for(var n in r.buttons=[$.extend(t.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""},{callback:function(){t.saveDataAddForm(r).done(function(){t.addContainer.destroy(),delete t.addContainer,t.currentSearchForm.performSearch(t.searchParams)})}}),$.extend(t.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:""},{callback:function(){t.addContainer.destroy(),delete t.addContainer}})],$.extend(r,{processButtons:function(){$.each(r.buttons,function(e,i){switch(i.ordinal){case 1:$(r.getButtons()[e]).click(function(){t.addContainer.destroy(),delete t.addContainer}),r.getButtons()[e].innerHTML=bizagi.localization.getResource("render-form-dialog-box-close"),r.buttons[e].caption=bizagi.localization.getResource("render-form-dialog-box-close"),r.buttons[e].action="back";break;default:$(r.getButtons()[e]).click(function(){t.saveDataAddForm(r),t.addContainer.destroy(),delete t.addContainer})}})}}),r.children)r.children[n].params=$.extend({},r.children[n].params,t.addFormParams);return $.when(r.render()).done(function(e){t.currentAddForm=r.firstChild(),t.addContainer.element.html(e),a||t.slideParams.navigation.navigate(t.addContainer.id,"overlay:up"),t.addContainer.setNavigationButtons(r),r.triggerHandler("ondomincluded"),t.handleSearchFormZindex("show"),r.bind("refresh",function(e,i){return i.scrollTop=t.form.container.parent().scrollTop(),i=$.extend({focus:focus,selectedTabs:t.form.getSelectedTabs(),isRefresh:!0,contextType:t.properties.contextType||"",navigation:t.slideParams.navigation,view_container:t.addContainer},i),t.renderAddForm(i)})})}).fail(function(){t.addContainer.destroy(),delete t.addContainer}).always(function(){bizagi.util.tablet.stopLoading()})},saveDataAddForm:function(e){var t=this,i=$.Deferred();if(e.validateForm()){var a={};$.forceCollectData=!0,e.collectRenderValues(a),a.idPageCache=e.idPageCache;var r={action:"SAVE",data:a,idPageCache:a.idPageCache,guidEntity:e.properties.entity,contexttype:"entity"},n={};e.collectRenderValuesForSubmit(n),$.forceCollectData=!1,bizagi.util.isMapEmpty(n)?(bizagi.showMessageBox(bizagi.localization.getResource("render-search-advanced-no-filters")),i.reject()):(bizagi.util.tablet.startLoading(),$.when(t.dataService.submitData(r)).done(function(){for(var a in n){var r=(o=a,void 0,"object"==typeof(l=t.currentSearchForm.getRender(o))&&null!==l?{found:!0,obj:l}:{found:!1,obj:{}});r.found&&(r.obj.setValue(n[a]),t.setDisplayValueToControl(r.obj,e,a,n))}var o,l;i.resolve()}).fail(function(t,a,r){e.addValidationMessage(r.message),i.reject()}).always(function(){bizagi.util.tablet.stopLoading()}))}else i.reject();return i},setDisplayValueToControl:function(e,t,i,a){"searchSuggest"===e.properties.type?e.setDisplayValue(t.getRender(i).getDisplayValue()):e.setDisplayValue(a[i])},processButtons:function(){var e=this;e.slideBoxDeferred=new $.Deferred;var t={buttons:[]};return t.buttons.push({text:bizagi.localization.getResource("render-form-dialog-box-search"),click:function(){e.currentSearchForm.performSearch(e.searchParams)}}),e.slideParams.allowNew&&t.buttons.push({text:bizagi.localization.getResource("render-form-dialog-box-add"),click:function(){var t={idCase:e.slideParams.idCase,idRender:e.properties.idRender,displayName:e.properties.displayName,idPageCache:e.properties.idPageCache};e.renderAddForm(t)}}),t.buttons.push({text:bizagi.localization.getResource("render-form-dialog-box-cancel"),click:function(){e.goBack()}}),t=$.extend(t,e.slideParams),e._renderButtons(t),e.slideBoxDeferred.promise()},getSearchContainerData:function(e){var t=this,i=new $.Deferred,a={form:{properties:{},elements:[]}},r=a.form,n=t.searchForms[0];if(t.searchForms.length>1){var o={properties:{type:"tab"},elements:[]},l=[];$.each(t.searchForms,function(e,i){var a=i.default||!1,s={};s.properties={id:e,type:"tabItem",displayName:i.caption},s.elements=[],a?(o.elements.push({container:s}),r=s,n=t.searchForms[0]):l.push({container:s})}),$.each(l,function(e,t){o.elements.push(t)}),a.form.elements.push({container:o})}return bizagi.util.tablet.startLoading(),$.when(t.getSearchFormData(e,n)).done(function(e){r.elements.push(e),r.properties.id=Math.guid(),i.resolve(a)}).always(function(){bizagi.util.tablet.stopLoading()}),i.promise()},getSearchFormData:function(e,t){return this.dataService.getSearchFormData($.extend(e,{idSearchForm:t.id,url:t.url})).pipe(function(t){return t.form.properties.idRender=e.idRender,t})},goBack:function(){this.handleSearchFormZindex("hide"),this.container.destroy()},configureViewHandlers:function(){},_renderButtons:function(e){var t=$("<div class='bz-slide-button-container'></div>");$.each(e.buttons,function(e,i){$("<div class='action-button'>"+i.text+"</div>").click(i.click).appendTo(t)}),this.buttonContainer=t},handleSearchFormZindex:function(e){var t=jQuery.grep($(".km-modalview-root"),function(e){return"block"==$(e).css("display")});t.length>0&&("show"==e?$(t).css("z-index",0):$(t).css("z-index",10001))}}),$.Class.extend("bizagi.rendering.tablet.slide.upload",{},{init:function(e,t,i){var a=this;this.dataService=e,this.renderFactory=t,this.slideFormDeferred=new $.Deferred,this.slideFormParams=i||{},a.slideContainer=a.slideFormParams.navigation.createRenderContainer({title:a.slideFormParams.title}),a.processButtons().done(function(e){a.slideFormDeferred.resolve(e)}).fail(function(){a.slideFormDeferred.reject()})},processButtons:function(){var e=this,t=new $.Deferred,i={buttons:[]},a=function(){e.goBack(),t.reject()};return i.buttons.push({text:bizagi.localization.getResource("workportal-case-dialog-box-close"),caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!1,refresh:!1,ordinal:0,action:"back",save:!0,style:"",callback:a,click:a}),this.slideFormParams=$.extend(i,this.slideFormParams),e._renderButtons(this.slideFormParams),t.promise()},render:function(e){return this.renderUploadFile(this.slideForm,e),this.slideFormDeferred.promise()},renderUploadFile:function(e,t){var i=this,a=i.renderFactory.getCommonTemplate("uploadSlide"),r=$.fasttmpl(a,{url:t.url});i.slideContainer.element.html(r),i.slideFormParams.navigation.navigate(i.slideContainer.id);var n=$.extend({originalProperties:{uniqueId:101,id:101}},i.slideFormParams);n.container=i.slideContainer.element,i.slideFormParams.navigation.setNavigationButtons(n),r.find(".ui-slide-upload-link").click(function(){$.when(bizagi.showConfirmationBox(bizagi.localization.getResource("render-tablet-slide-upload-confirmation"))).done(function(){window.location.href=t.url})})},goBack:function(){this.slideContainer.destroy()},_renderButtons:function(e){var t=$('<div class="bz-slide-button-container"></div>');$.each(e.buttons,function(e,i){$('<div class="action-button">'+i.text+"</div>").click(i.click).appendTo(t)}),this.buttonContainer=t}}),$.Class.extend("bizagi.rendering.tablet.startForm",{},{init:function(e,t,i){var a=this;a.dataService=e,a.renderFactory=t,a.slideFormParams=i||{},a.slideContainer=a.slideFormParams.navigation.createRenderContainer({title:a.slideFormParams.title}),a.configureViewHandlers()},configureViewHandlers:function(){},goBack:function(){this.slideContainer.destroy()},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getStartForm(e)).then(function(a){!1===e.editable&&(a.form.properties.editable=!1);var r=bizagi.rendering.tablet.form.extend({submitForm:function(){if(t.form&&(this.endLoading(),t.form.validateForm())){var e={};t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(e)).done(function(a){null==a||1==a||"success"==a.type?(i.resolve(),t.goBack()):"validationMessages"==a.type?(t.form.addValidationMessage(a.messages),$.each(e,function(e,i){var a=t.form.getRenders(e);$.each(a,function(e,t){t.updateOriginalValue()})})):"error"==a.type&&t.form.addErrorMessage(a.message)}):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:a.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form=new r(n),t.form.bind("refresh",function(i,a){a=$.extend({selectedTabs:t.form.getSelectedTabs(),isRefresh:!0},e,a,{idStartScope:t.form.properties.idStartScope}),t.renderSlideForm(a)}),t.form.buttons=[$.extend(t.form.buttons[0]||{},{caption:t.slideFormParams.saveButtonLabel,actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""})],t.form.render()}).done(function(i){t.slideContainer.element.html(i),e.isRefresh||t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="0" id="formButton0" class="action-button ui-bizagi-form-button">'+(t.slideFormParams.saveButtonLabel?t.slideFormParams.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"))+"</div>").delegate('div[ordinal="0"]',"click",function(){t.form.submitForm()}),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="1" id="formButton1" class="action-button ui-bizagi-form-button">'+bizagi.localization.getResource("render-form-dialog-box-cancel")+"</div>").delegate('div[ordinal="1"]',"click",function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()}),t.form.triggerHandler("ondomincluded")}).fail(function(e,i,a){var r=t.renderFactory.getCommonTemplate("form-error"),n=a.message||"Error";$.fasttmpl(r,{message:n}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)}),i.promise()}}),$.Class.extend("bizagi.rendering.tablet.slide.ecm",{},{init:function(e,t,i){var a=this;a.dataService=e,a.renderFactory=t,a.slideFormParams=i||{},a.slideFormDeferred=new $.Deferred,a.container=a.slideFormParams.navigation.createRenderContainer({title:a.slideFormParams.title})},render:function(e){return this.renderSlideForm(e),this.slideFormDeferred.promise()},renderSlideForm:function(e){var t=this,i=t.getMetadataForm(e);t.form=t.renderFactory.getContainer({type:"form",data:i.form,navigation:t.slideFormParams.navigation,view_container:t.container}),$.when(t.form.render()).done(function(i){t.container.element.html(i),t.slideFormParams.navigation.navigate(t.container.id),t.processButtons(t.form,e),t.container.setNavigationButtons(t.form),t.form.triggerHandler("ondomincluded")}).always(function(){t.slideFormDeferred.resolve()})},processButtons:function(e,t){var i=this;e.buttons=[{ordinal:0,action:"save",caption:bizagi.localization.getResource("render-form-dialog-box-save"),callback:i.onSaveDataMetadataForm.bind(i,t.fileData)},{ordinal:1,action:"back",caption:bizagi.localization.getResource("render-form-dialog-box-close"),callback:function(){i.slideFormParams.onCancel({}),i.goBack()}}],i.slideFormParams.editable||e.buttons.shift()},getMetadataForm:function(e){var t=this,i={type:"form",form:{elements:[],pageCacheId:e.pageCacheId,sessionId:e.sessionId,properties:{id:101,xpathContext:e.xpathContext,editable:t.slideFormParams.editable,orientation:t.slideFormParams.orientation||"ltr"}}};return $.each(e.metadata,function(e,a){var r=t.getRenderType(a.metadataType),n=Object.assign({id:e+1,xpath:a.metadataId,displayName:a.description,required:!0===bizagi.util.parseBoolean(a.required),editable:!1===bizagi.util.parseBoolean(a.readOnly),value:a.value},r);i.form.elements.push({render:{properties:n}})}),i},getRenderType:function(e){switch(e.toUpperCase()){case"INTEGER":return{type:"number",dataType:2,allowDecimals:!1,thousands:!1};case"DECIMAL":return{type:"number",dataType:10,allowDecimals:!0,thousands:!0};case"DATETIME":return{type:"date",dataType:12};case"BOOL":return{type:"boolean",dataType:5};case"STRING":default:return{type:"text",dataType:15,maxLength:50,autoExtend:!1}}},onSaveDataMetadataForm:function(e){var t=this,i=$.Deferred();if(t.form.validateForm()){var a={};if(t.form.collectRenderValuesForSubmit(a),$.forceCollectData=!1,bizagi.util.isMapEmpty(a))t.slideFormParams.onSave({update:!1}),i.resolve({update:!1}),t.goBack();else{var r=Object.keys(a).map(function(e,t){return{idMetadata:e,value:a[e]}}),n={idFileUpload:e.idFileUpload,fileName:e.fileName,idPageCache:e.idPageCache,xpathContext:e.xpathContext,xPath:e.xpath,idAttrib:e.idAttrib};n.metaValues=JSON.encode({metadataValues:r}),bizagi.loading.start(),$.when(t.dataService.updateECMMetadata(n)).done(function(a){a&&a.idFileUpload&&(t.slideFormParams.onSave({update:!0,idFileUpload:a.idFileUpload,fileName:e.fileName}),i.resolve({update:!0})),t.goBack()}).fail(function(e){t.form.addValidationMessage(e.message),i.reject()}).always(function(){bizagi.loading.stop()})}}i.promise()},goBack:function(){this.container.destroy()}}),bizagi.rendering.container.extend("bizagi.rendering.tablet.container",{},{startLoading:function(){},endLoading:function(){}}),bizagi.rendering.render.extend("bizagi.rendering.tablet.render",bizagi.rendering.render.base.prototype),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.render",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer();this.formParams=t.getParams()},getLabel:function(){return this.label||(this.label=$(".bz-form-label label",this.element||this.observableElement)),this.label},getFormattingLabel:function(){return this.getLabel()},getControl:function(){return this.control&&0!==this.control.length||(this.control=$(".bz-control",this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},getControlFiller:function(){return this.controlFiller||(this.controlFiller=$(".bz-form-item__control",this.element||this.observableElement)),this.controlFiller},getContainerMessage:function(){return this.containerMessage||(this.containerMessage=$(".bz-form-message__text",this.element||this.observableElement)),this.containerMessage},getColumnContainerMessage:function(){return this.containerMessage||(this.containerMessage=$(".bz-form-cell-message__text",this.element||this.observableElement)),this.containerMessage},startLoading:function(){},endLoading:function(){},getDisplayOptionClass:function(e){return"normal"===e||"both"===e?"bz-form-item--display-normal":"vertical"===e?"bz-form-item--display-vertical":"reversed"===e?"bz-form-item--display-reversed":"label"===e?"bz-form-item--display-label":"value"===e?"bz-form-item--display-value":void 0},changeDisplayOption:function(e){},getAlignClass:function(e){return e},changeLabelAlign:function(e){},changeValueAlign:function(e){},customizeRenderWidth:function(){var e=this.getLabel(),t=this.properties,i=this.getControlFiller(),a=t.labelWidth?"0"!=t.labelWidth?t.labelWidth:"50%":null,r=t.valueWidth?"0"!=t.valueWidth?t.valueWidth:"50%":null;a&&!r?r=100-(a=bizagi.util.percent2Number(a)):!a&&r?a=100-(r=bizagi.util.percent2Number(r)):(a=bizagi.util.percent2Number(a))+(r=bizagi.util.percent2Number(r))!=100&&(r=100-a),e.width(a+"%"),i.width(r-.01+"%")},setValidationMessage:function(e){this._super(e);var t="grid"===this.properties.type,i=this.grid&&this.column&&/column/.test(this.properties.type)?this.getColumnContainerMessage():this.getContainerMessage();e&&e.length>0?(e=e.replace(/<\w+>([^<]*)<\/\w+>/g,"$1"),i.attr("data-error",e),i.text(e),this.element&&(t?this.element.addClass("bz-form-item-grid--error"):this.element.addClass("bz-form-item--error"))):(i.text(""),this.element&&(t?this.element.removeClass("bz-form-item-grid--error"):this.element.removeClass("bz-form-item--error")))},setDisplayValue:function(e){var t=this,i=t.getControl();if(t.setValue(e,!1),!t.properties.editable&&"check"!==t.properties.display){var a=t.getDisplayValue(e);"string"!=typeof a&&"number"!=typeof a||$(i).html("<label class='bz-form-label'>"+a+"</label>")}},getElementsToStylize:function(e){return $(".bz-input",e)},getFormParams:function(){return this.formParams||{}},changeRequired:function(e){this.properties.required=e,bizagi.util.parseBoolean(e)&&this.properties.editable?this.element.addClass("bz-form-item--required"):this.element.removeClass("bz-form-item--required"),this.triggerRenderValidate()},changeRequiredLabel:function(e){},clearDisplayValue:function(){var e=this.getControl().find("input").filter(function(e,t){return"file"!==t.type&&"radio"!==t.type&&"checkbox"!==t.type});e.length>0?e.val(this.getValue()):this.setDisplayValue("")}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.form",bizagi.rendering.form.prototype),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.form",{},{init:function(e){e=e||{},this.warnings={},this.errors={},this._super(e)},configureHandlers:function(){var e=this,t=e.container;e.configureComplexGateway(),e.processButtons(t),e.bind("ondomincluded",function(){e.validationController=new bizagi.command.controllers.validation(e,e.validations),e.actionController=new bizagi.command.controllers.action(e,e.actions),e.readyDeferred.resolve()}),e.bind("modalViewDidAppear",function(){e.params.navigation.modalViewDidAppear()}),e.bind("modalViewDidDisappear",function(){e.params.navigation.modalViewDidDisappear()})},postRenderContainer:function(e){var t=this,i=t.properties;t._super(e);var a=t.getButtons();if("tablet_android"!=bizagi.util.detectDevice()&&$(".km-native-scroller").css("-webkit-overflow-scrolling","inherit"),!bizagi.util.isObjectEmpty(t.warnings)){var r=$('<ul class="ui-bizagi-form-warnings"></ul>');for(var n in t.warnings)r.append($("<li>"+n+"</li>"));$("<button>X</button>").appendTo(r),r.prependTo(t.container),r.click(function(){r.detach()})}if(!bizagi.util.isObjectEmpty(t.errors)){var o=$('<ul class="ui-bizagi-form-errors"></ul>');for(var l in t.errors)o.append($("<li>"+l+"</li>"));$("<button>X</button>").prependTo(o),o.appendTo(t.container),o.click(function(){o.detach()}),$.each(i.buttons,function(e,i){i.routing&&t.getButtons().eq(e).prop("disabled",!0)})}(a?a.length:0)&&($(document).data("auto-save","auto-save"),$(document).unbind("save-form").bind("save-form",function(e,i){t.autoSaveEvents(i)}),$(window).unbind("beforeunload").bind("beforeunload",function(e){var i={};if(t.collectRenderValues(i),!$.isEmptyObject(i)&&$(document).data("auto-save"))return bizagi.localization.getResource("confirmation-savebox-message2")})),"tablet_android"!=bizagi.util.detectDevice()&&setTimeout(function(){$(".km-native-scroller").css("-webkit-overflow-scrolling","touch")},1e3)},autoSaveEvents:function(e,t){var i=this,a={};i.collectRenderValues(a),$.isEmptyObject(a)?e.resolve():$.when(bizagi.showSaveBox(bizagi.localization.getResource("confirmation-savebox-message1"),"Bizagi","warning")).done(function(){i.saveForm(),e.resolve()}).fail(function(){e.resolve()})},internalSubmitForm:function(e){var t,i=this,a=[],r=$.Deferred(),n=null,o=null,l=null,s=null,d=null;if((e.submitData||e.executeRule||e.createnewcase)&&(t=i.collectRenderValuesForSubmit()),$.when(i.startLoading()).done(function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")}),e.executeRule&&((n=i.dataService.submitData({action:"SUBMITDATA",data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0})).tag="submitData",s=i.prepareCheckpointAction(e.id),t={},(o=i.dataService.executeButton({idRender:e.id,xpathContext:i.properties.xpathContext||"",idPageCache:i.properties.idPageCache,prepare:!0})).tag="executeRule",d=i.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase){if(i.transitions){var c=[];if($.each(this.activeTransitions,function(e,t){t&&c.push(e)}),0==bizagi.util.countProps(c))return bizagi.showMessageBox(bizagi.localization.getResource("render-widget-complexgateway-path"),bizagi.localization.getResource("render-widget-complexgateway-error"),"info",!1),i.endLoading(),r.reject(),r.promise()}(l=i.dataService.submitData({action:e.action,forcePlanCompletion:e.forcePlanCompletion,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0,transitions:c||"",contexttype:i.properties.contextType,surrogatekey:i.properties.surrogateKey})).tag="performAction"}o&&(a.push(n),s&&a.push(s),a.push(o),d&&a.push(d),a.push(o)),l&&a.push(l),bizagi.chrono.initAndStart("submitForm-ajax");var p=new $.Deferred;return t&&t.deferreds?$.when.apply(this,t.deferreds).done(function(e){p.resolve(e)}).fail(function(){p.reject(),console.log("Error: It was not possible resolve async actions on form ")}):p.resolve(),$.when(p).done(function(){bizagi.util.tablet.startLoading(),$.when(i.dataService.multiaction().execute({actions:a})).done(function(t){var a;if(bizagi.chrono.stop("submitForm-ajax"),$.each(t,function(e,t){"validationMessages"==t.result.type&&(i.addValidationMessage(t.result.messages),a=!0)}),a)e.executeRule&&i.sendRollbackAction(e.id);else{if(!i.postProcessButton(t,e))return;e.refresh&&i.refreshForm(),e.routing&&i.triggerHandler("routing",{idCase:i.params.idCase}),e.createnewcase&&t.length>0&&i.triggerHandler("routing",{idCase:t[0].result.IdCase,caseNumber:t[0].result.CaseNumber})}delete i.nonSupportedMethods,r.resolve()}).fail(function(t,t,a){e.executeRule&&i.sendRollbackAction(e.id),a&&a.error&&("WaitForCompletionPlanException"===a.error.errorType||"InvalidPlanStateException"===a.error.errorType||"CustomMessageException"===a.error.errorType)?(i.endLoading(),$.when(bizagi.showConfirmationBox(bizagi.localization.getResource(a.error.message),null,!1)).then(function(){return $.when(i.internalSubmitForm($.extend({},e,{forcePlanCompletion:!0})))}).done(function(){r.resolve()}).fail(function(){r.reject()})):(i.failHandler({error:void 0===a?bizagi.localization.getResource("workportal-general-error"):a}),r.reject(a))}).always(function(){bizagi.util.tablet.stopLoading()})}).always(function(){bizagi.util.tablet.stopLoading()}),r.promise()},prepareCheckpointAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},prepareCommitAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},getPane:function(){return this.pane},getButtons:function(){return this.getParams()&&(handler=this.getParams().getButtons)&&handler(this),$(".ui-bizagi-button-container :button",this.container)},processButtons:function(){var e=this,t=e.getParams();t&&t.processButtons&&(0,t.processButtons)(e);var i=e.properties,a=e.getButtons();i.buttons=e.buttons||a,e.saveButton=null,e.nextButton=null;for(var r=0,n=i.buttons.length;r<n;r++)"save"==i.buttons[r].action?e.saveButton=i.buttons[r]:"next"==i.buttons[r].action&&(e.nextButton=i.buttons[r]);var o=e.getNavigation();if(void 0!==o){var l=e.getViewContainer();void 0!==l?l.setNavigationButtons(e):o.setNavigationButtons(e)}e._super()},refreshForm:function(e){var t,i=this,a=i.properties,r=i.getParams(),n=$.Deferred();return(e=e||i.getFocus())&&!e.id&&(e={id:e}),t={idCase:i.params.idCase||"",idWorkitem:i.params.idWorkitem||"",idTask:i.params.idTask||"",focus:e,selectedTabs:i.getSelectedTabs(),xpathContext:a.xpathContext,idPageCache:a.idPageCache,isRefresh:!0,action:i.getEndPointAction(),idStartScope:i.properties.idStartScope||"",navigation:r.navigation,view_container:r.view_container},(r.postRenderEdit||r.processButtons)&&(t.isOfflineForm=i.params.isOfflineForm||!1,t.formsRenderVersion=i.params.formsRenderVersion||0,t.postRenderEdit=r.postRenderEdit,t.processButtons=r.processButtons,t.originalParams=r.originalParams||{},t.getButtons=r.getButtons),$(".km-native-scroller").css("-webkit-overflow-scrolling","inherit"),i.startLoading(),$.when(i.triggerHandler("refresh",t)).done(function(){i.endLoading(),setTimeout(function(){$(".km-native-scroller").css("-webkit-overflow-scrolling","touch")},1e3),n.resolve()}).fail(function(){i.endLoading(),n.reject()}),n.promise()},checkWidgetsData:function(){var e=null;if(bizagi.workportal.tablet.popup&&bizagi.workportal.tablet.popup.instance&&bizagi.workportal.tablet.popup.instance.getResponseValues){if(null===(e=bizagi.workportal.tablet.popup.instance.getResponseValues(bizagi.workportal.tablet.popup.instance.getResponseValuesParams)))return bizagi.showMessageBox(bizagi.localization.getResource("workportal-widget-complexgateway-path"),bizagi.localization.getResource("workportal-widget-complexgateway-error")),-1;bizagi.workportal.tablet.popup.instance.dontClose=!1,bizagi.workportal.tablet.popup.instance.close()}return e},repaintComplexGateway:function(){var e=this;void 0!==e.focus&&void 0!==e.focus.idCaseObject&&void 0!==e.focus.idCaseObject.isComplex&&e.dataService.getWorkitems({idCase:e.focus.idCaseObject.idCase}).done(function(t){if(1==t.workItems.length&&"ComplexGateway"==t.workItems[0].taskType){var i=t.workItems[0].transitions;e.currentPopup="complexgateway",$(document).triggerHandler("popupWidget",{widgetName:bizagi.workportal.widgets.widget.BIZAGI_WORKPORTAL_WIDGET_COMPLEXGATEWAY,options:{transitions:i,sourceElement:".ui-bizagi-form",insertAfter:".ui-bizagi-form .ui-bizagi-button-container",height:"auto",offset:"8 0",activeScroll:!1,dontClose:!0,closed:function(){e.currentPopup=null}}})}})},addWarning:function(e){this.warnings[e]=e},addError:function(e){this.errors[e]=e},processButton:function(e){var t=$.Deferred();return!bizagi.util.isObjectEmpty(this.errors)&&(t.resolve(),bizagi.util.parseBoolean(e.routing))?t.promise():this._super(e)},getNavigation:function(){return this.getFormContainer().getParams().navigation},getViewContainer:function(){return this.getFormContainer().getParams().view_container},isFloatingButtonsEnabled:function(){var e=this.getNavigation();return e&&e.isFloatingButtonsEnabled()},isFormButtonsEnabled:function(){var e=this.getNavigation();return e&&e.isFormButtonsEnabled()},startLoading:function(){bizagi.loading.start()},endLoading:function(){bizagi.loading.stop()},dispose:function(e){void 0!==e&&void 0!==e.isRefresh&&0!=e.isRefresh||this._super()},failHandler:function(e){var t=this;t._super(e);var i={};try{i=JSON.parse(e)||{}}catch(t){i=e.length&&e.length>1?e[0]:e}finally{i.error&&(i=i.error),i.error&&(i=i.error),void 0!==i.code&&"AUTH_ERROR"===i.code&&setTimeout(function(){t.triggerHandler("routing",{idCase:t.params.idCase,idWorkitem:t.params.idWorkitem})},5e3)}},renderContainer:function(){var e=this,t=this.properties,i=e.renderFactory.getTemplate("form"),a=$.fasttmpl(i,{buttons:e.buttons,transitions:e.transitions,uniqueId:t.uniqueId,helptext:t.helpText,mode:e.getMode(),queryForm:"queryForm"==e.getFormType(),summaryForm:e.params.summaryForm||!1,globalForm:e.properties.displayAsReadOnly||!1,idCase:"",displayName:e.params.displayName||"",processPath:t.processPath,breadCrumb:t.breadCrumb,orientation:t.orientation});return a=e.replaceChildrenHtml(a,e.renderChildrenHtml())},configureComplexGateway:function(){var e,t=this,i=t.container;i.length>1?$(i.children()).each(function(){$(this).hasClass(".bz-complex-gateway")&&(e=this)}):e=$(".bz-complex-gateway",i),t.activeTransitions={},$(".bz-checkbox__input",e).on("click",function(){var e=$(this),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),t.activeTransitions[i]=e.is(":checked")||!1})}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.panel",bizagi.rendering.panel.prototype),bizagi.rendering.tablet.panel.extend("bizagi.rendering.tablet.panel",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.contentPanel",bizagi.rendering.contentPanel.prototype),bizagi.rendering.tablet.contentPanel.extend("bizagi.rendering.tablet.contentPanel",{},{}),bizagi.rendering.tablet.panel.extend("bizagi.rendering.tablet.nestedForm",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.tab",bizagi.rendering.tab.prototype),bizagi.rendering.tablet.tab.extend("bizagi.rendering.tablet.tab",{},{postRenderContainer:function(e){var t=this;this._super(e),e.material_bizagi_tabs({direction:this.properties.orientation,active_index_tab:this.activeTab}).on("updateActive",function(e,i){e.stopPropagation(),t.setActiveTab(i.index)}),$("> .bz-tabs > .bz-tab",e).rippleEffect()}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.tabItem",bizagi.rendering.tabItem.prototype),bizagi.rendering.tablet.tabItem.extend("bizagi.rendering.tablet.tabItem",{},{setAsActiveContainer:function(e){var t=this;$.when(t.ready()).done(function(){var e=$("[data-reference='#ui-bizagi-tab-"+t.properties.id+"']",t.parent.tabs);e.css("display",""),e.click()})},focus:function(){this.activate(),this.setAsActiveContainer(),this._super()},changeVisibility:function(e){var t=this;t.properties.visible=bizagi.util.parseBoolean(e),$.when(t.ready()).done(function(){var e=$("[data-reference='#ui-bizagi-tab-"+t.properties.id+"']",t.parent.tabs),i=t.parent.container.material_bizagi_tabs("getActiveTab");t.properties.visible?(t.container.css("display",""),e.css("display",""),t.properties.counter===i.index?(e.css("display",""),t.setAsActiveContainer()):t.container.css("display","none")):(t.container.css("display","none"),e.css("display","none"),i=t.parent.container.material_bizagi_tabs("getActiveTab"),t.properties.counter===i.index?t.parent.container.material_bizagi_tabs("moveToNextTab"):t.parent.container.material_bizagi_tabs("refreshPositions"))})}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.horizontal",bizagi.rendering.horizontal.prototype),bizagi.rendering.tablet.horizontal.extend("bizagi.rendering.tablet.horizontal",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.layout",bizagi.rendering.layout.prototype),bizagi.rendering.tablet.layout.extend("bizagi.rendering.tablet.layout",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.accordion",bizagi.rendering.accordion.prototype),bizagi.rendering.tablet.accordion.extend("bizagi.rendering.tablet.accordion",{},{}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.accordionItem",bizagi.rendering.accordionItem.prototype),bizagi.rendering.tablet.accordionItem.extend("bizagi.rendering.tablet.accordionItem",{},{setAsActiveContainer:function(e){},focus:function(){this.setAsActiveContainer(),this._super()}}),bizagi.rendering.tablet.container.extend("bizagi.rendering.tablet.group",bizagi.rendering.group.prototype),bizagi.rendering.tablet.group.extend("bizagi.rendering.tablet.group",{},{configureHandlers:function(){var e=this;$(">h5.bz-collapsible__header",e.container).bind("click",function(){$(e.container).toggleClass("bz-collapsible--collapsed")})},postRenderContainer:function(e){this._super(e),this.properties.collapse&&this.collapse()},isOpen:function(){return!this.container.hasClass("bz-collapsible--collapsed")},focus:function(){this.expand(),this._super()},expand:function(){this.isOpen()||$(">h5.bz-collapsible__header",this.container).trigger("click")},collapse:function(){this.isOpen()&&$(">h5.bz-collapsible__header",this.container).trigger("click")},toogleContainer:function(e){e?this.expand():this.collapse()}}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.searchForm",bizagi.rendering.searchForm.prototype),bizagi.rendering.tablet.searchForm.extend("bizagi.rendering.tablet.searchForm",{},{renderResult:function(){var e=this,t=e.properties,i={};i.properties={displayName:e.getResource("render-search-advanced-results-label"),type:"grid",xpath:"searchForm"+t.id,id:t.id,skipInitialLoad:!0,rowsPerPage:10,visible:!1,sortBy:t.sortBy,sortOrder:t.sortOrder,overrideGetRemoteData:function(t){return e.getRemoteData(t)}},i.elements=[];var a=t.columns;$.each(a,function(t){var r={render:{}};r.render.properties={displayName:a[t].caption,xpath:a[t].xpath,editable:!1},$.extend(r.render.properties,e.parseAdditionalProperties(a[t].dataType)),0==a[t].dataType&&(r.render.properties.columnVisible=!1),7!=a[t].dataType&&8!=a[t].dataType||(r.render.properties.allowDecimals=a[t].allowDecimals),10!=a[t].dataType&&11!=a[t].dataType||(r.render.properties.allowDecimals=!0),12==a[t].dataType&&(r.render.properties.showTime=a[t].showTime),i.elements.push(r)});var r=e.renderFactory.getRender({type:"grid",data:i,parent:e,mode:e.getMode()});return r.properties.inlineAdd=!1,r.properties.allowDelete=!1,r.properties.allowAdd=!1,r.properties.allowEdit=!1,e.resultsGrid=r,r.render()},postRenderContainer:function(e){var t=this,i=e.find(".bz-container__search-criteria"),a=e.find(".bz-container__search-results"),r=i.children(),n=t.getMode();t.container=e,$.each(r,function(e,i){i=$(i);var a=Number(i.data("unique-id"));if(a){var r=t.childrenHash[a];if(r){var n=r.getElementType();n==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&r.postRenderElement(i),n==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER&&r.postRenderContainer(i)}}});var o=$(a.children()[0]);t.resultsGrid.postRenderElement(o),"execution"==n&&t.configureHandlers(),"design"==n&&t.configureDesignView(),"layout"==n&&(t.configureDesignView(),t.configureLayoutView())},configureHandlers:function(){var e=this;e.criteriaContainer=$(".bz-container__search-criteria",e.container),e.resultsContainer=$(".bz-container__search-results",e.container),e.resultsGrid.bind("rowSelected",function(t,i){e.properties.searchParams.hasOwnProperty("multiSelect")?e.trigger("multiSelect",i):e.trigger("instanceSelected",i)})},refreshResults:function(){this.trigger("instancerefresh"),this.resultsGrid.refresh()},onSearchFinished:function(){var e=this;e.properties.deviceMaxRecordsExceeded||(e.resultsGrid.changeVisibility(!0),e.properties&&(0==e.properties.records?$(".bz-container__search-results label",e.container).hide():$(".bz-container__search-results label",e.container).show()))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.text",bizagi.rendering.text.prototype),bizagi.rendering.tablet.text.extend("bizagi.rendering.tablet.text",{},{postRender:function(){this._super(),this.properties.maxLength>0&&this.input.attr("maxlength",this.properties.maxLength)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("text-readOnly"),t=this.getValue(),i={value:t=null!=t?bizagi.util.sanitizeHTML(t):"",editable:this.properties.editable};return $.fasttmpl(e,i)},setDisplayValue:function(e){var t=this,i=bizagi.util.decodeURI(e);e=this.validateValue("string"==typeof i?i:"",t.properties.maxLength),t.setValue(e,!1),e&&(e=$.br2nl(e).replaceAll("\\n","\n")),t.properties.editable?t.input.val(e):$(".bz-text-readonly",t.getControl()).html(bizagi.util.sanitizeHTML(e))},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur(function(){var t=$(this);e.retypeDouble(t)})},retypeDouble:function(e){var t=this,i=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===i)return;i!==e.data("oldValue")?(t.setValue(""),t.createTooltip(e,"",t.getResource("render-text-retype-error"))):(e.data("newValue",i),e.data("oldValue",""),e.tooltip("destroy"))}else{if(""===i||i===e.attr("newValue"))return;t.createTooltip(e,i,t.getResource("render-number-retype"))}},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".bz-text-readonly",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.extendedText",bizagi.rendering.extendedText.prototype),bizagi.rendering.tablet.extendedText.extend("bizagi.rendering.tablet.extendedText",{minLines:2,maxLines:8,maxCharactersToShow:200},{postRender:function(){var e=this;e._super(),e.textarea=e.getControl().find("textarea"),e.textarea&&e.textarea.css({resize:"vertical"})},initializeData:function(e){this._super(e);var t=this.properties.maxLines;this.properties.maxLines=t>this.Class.maxLines?this.Class.maxLines:t<this.Class.minLines?this.Class.minLines:t,this.isOfflineForm=bizagi.util.isOfflineForm({context:this})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("extendedText-readOnly"),t=this.getValue();t=null!=t?bizagi.util.sanitizeHTML(t):"";var i=this.Class.maxCharactersToShow,a={value:t,startString:t.substr(0,i),endString:t.substr(i-1,t.length-i)};return $.fasttmpl(e,a)},setDisplayValue:function(e){var t=this,i=bizagi.util.decodeURI(e);e=t.validateValue("string"==typeof i?i:"",t.properties.maxLength),t.setValue(e,!1),e&&(e=$.br2nl(e).replaceAll("\\n","\n")),t.properties.editable?t.textarea.val(e):$(".bz-textarea-readonly",t.getControl()).html(bizagi.util.sanitizeHTML(e))},configureHandlers:function(){var e=this;e._super(),e.properties.maxLength>0&&(e.textarea.attr("maxlength",e.properties.maxLength),e.actualMaxLength=e.properties.maxLength),$(e.textarea).bind("focus keyup paste",function(t){8!==t.which&&46!==t.which||e.textarea.prop("rows")>e.properties.maxLines&&e.textarea.prop("rows",e.properties.maxLines);e.updateTextareaSize(this)}),$(e.textarea).bind("blur",function(t){e.textarea.prop("rows",e.properties.maxLines)})},configureHandlersReadOnly:function(){var e=this,t=this.getControl();$(".bz-textarea-readonly",t).on("click",".bz-read-more",function(t){return $(t.delegateTarget).hasClass("bz-textarea-readonly--active")?($(t.delegateTarget).removeClass("bz-textarea-readonly--active"),$(this).html(e.getResource("workportal-project-discussion-comment-viewmore"))):($(t.delegateTarget).addClass("bz-textarea-readonly--active"),$(this).html(e.getResource("workportal-project-discussion-comment-viewless"))),!1})},updateTextareaSize:function(e){if(this.properties.autoExtend){var t=$(e).prop("rows");e.scrollHeight>e.offsetHeight&&t>=this.Class.minLines&&t<this.Class.maxLines&&($(e).prop("rows",t+1),this.updateTextareaSize(e))}},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input, textarea",t);i&&0!==i.length&&i.blur(function(){var t=$(this),i=e.previousValue,a=e.value;null!=i&&a!=i&&null!=$(this).data("newValue")&&t.val()!=$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)})},retypeDouble:function(e){var t=this,i=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""==i)return;i!==e.data("oldValue")?(t.setValue(""),t.createTooltip(e,"",t.getResource("render-text-retype-error"))):(e.data("newValue",i),e.data("oldValue",""),e.tooltip("destroy"))}else{if(""===i||i===e.attr("newValue"))return;t.createTooltip(e,i,t.getResource("render-number-retype"))}},getElementsToStylize:function(e){return this.properties.editable?$("textarea",e):$(".bz-textarea-readonly",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.label",bizagi.rendering.label.prototype),bizagi.rendering.tablet.label.extend("bizagi.rendering.tablet.label",{},{}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.number",bizagi.rendering.number.prototype),bizagi.rendering.tablet.number.extend("bizagi.rendering.tablet.number",{},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{value:this.getDisplayValue(),editable:this.properties.editable,type:"text",isDesign:"execution"!==this.getMode()})},setDisplayValue:function(e){var t=this;t.setValue(e,!1),null!=e&&t.properties.editable&&(t.numericInput.val(e),t.value=t.properties.value=e,t.executeFormatCurrencyPlugin())},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur(function(){var t=$(this),i=e.previousValue,a=e.value;"grid"===e.parent.properties.type?(null!=i&&a!==i&&void 0!==$(this).data("newValue")&&t.val()!==$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)):e.retypeDouble(t)})},retypeDouble:function(e){var t=this,i=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility")&&null==$(this).data("newValue"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===i)return;i!==e.data("oldValue")?(t.setValue(""),t.createTooltip(e,"",t.getResource("render-text-retype-error"))):(e.data("newValue",i),e.data("oldValue",""),e.tooltip("destroy"))}else{if(""===i||i===e.attr("newValue"))return;t.createTooltip(e,i,t.getResource("render-number-retype"))}},getElementsToStylize:function(e){return $("input",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.money",bizagi.rendering.number.prototype),bizagi.rendering.tablet.money.extend("bizagi.rendering.tablet.money",bizagi.rendering.money.prototype),bizagi.rendering.tablet.money.extend("bizagi.rendering.tablet.money",{},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{value:this.getDisplayValue(),editable:this.properties.editable,type:"text",isDesign:"execution"!==this.getMode()})},setDisplayValue:function(e){this.setValue(e,!1),null!=e&&this.properties.editable&&(this.numericInput.val(e),this.executeFormatCurrencyPlugin())},getElementsToStylize:function(e){return $("input",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.numberScientificNotation",bizagi.rendering.numberScientificNotation.prototype),bizagi.rendering.tablet.numberScientificNotation.extend("bizagi.rendering.tablet.numberScientificNotation",{},{postRender:function(){var e=this,t=e.getControl();e.inputDisplay=$("input",t).first(),e.numericInput=e.input=$("input",t).last(),e.numericInput.numericSN(e.properties.decimalSymbol),e.attachFormatSientificNotation()},setDisplayValue:function(e){var t=this.properties,i=(e=bizagi.util.scientificNotationFormat(e,t.decimalSymbol,38),bizagi.util.scientificNotationFormat(e,t.decimalSymbol,20));this._super(i),null!=e&&t.editable&&(this.numericInput.val(e),this.inputDisplay.val(i))},attachFormatSientificNotation:function(){var e=this;e.inputDisplay.focus(function(){$(this).val(e.getDisplayValue())}),e.inputDisplay.blur(function(){void 0===e.getFormContainer().validationController&&(e.getFormContainer().validationController=new bizagi.command.controllers.validation(e.getFormContainer(),e.validations));var t=bizagi.util.scientificNotationFormat(e.inputDisplay.val(),e.properties.decimalSymbol,38),i=bizagi.util.scientificNotationFormat(e.inputDisplay.val(),e.properties.decimalSymbol,20);e.numericInput.val(t),e.inputDisplay.val(i),e.setValue(t)})}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.date",bizagi.rendering.date.prototype),bizagi.rendering.tablet.date.extend("bizagi.rendering.tablet.date",{MAX_YEARS_DISPLAY:100},{initializeData:function(e){this._super(e)},renderReadOnly:function(){var e=this.getFormattedDate(this.getValue(),this.properties.showTime,!0),t={value:e=bizagi.util.dateFormatter.formatDate(e,this.properties.fullFormat),editable:this.properties.editable},i=this.renderFactory.getTemplate("readonly");return $.fasttmpl(i,t)},postRenderReadOnly:function(){this.input=$("input",this.getDateControl())},postRender:function(){this._super(),this.input=$("input",this.getDateControl())},configureHandlers:function(){var e=this,t=e.properties.showTime?["calendar","time"]:["calendar"],i=e.getFormattedDate(e.properties.value,e.properties.showTime,!0),a=e.getFormattedDate(e.properties.minValue,e.properties.showTime,!1),r=e.getFormattedDate(e.properties.maxValue,e.properties.showTime,!1),n=e.properties.showTime?e.getTimeFormat():"";if(isNaN(Date.parse(a))&&((a=new Date).setFullYear(a.getFullYear()-e.Class.MAX_YEARS_DISPLAY),a.setHours(0,0,0,0)),isNaN(Date.parse(r))&&((r=new Date).setFullYear(r.getFullYear()+e.Class.MAX_YEARS_DISPLAY),r.setHours(23,59,59)),$(".bz-input-icon",this.getControl()).mobiscroll().calendar({mode:"mixed",display:"bottom",controls:t,min:a,max:r,defaultValue:i,timeFormat:n,showScrollArrows:!0,lang:bizagi.util.languages[BIZAGI_LANGUAGE]||"en",headerText:"{value}",buttons:["set",{text:this.getResource("render-plugin-search-users-clear-button-name"),handler:function(t,i){e.date=void 0,e.time=void 0,e.timeS=void 0,e.onChangeHandler(!0),i.clear()}},"cancel"],onSet:function(t,i){var a=i.getVal();e.date={day:a.getDate(),month:a.getMonth(),year:a.getFullYear()},e.properties.showTime&&(e.time={hours:a.getHours(),minutes:a.getMinutes()},e.is24h||(e.timeS=a.getHours()<12?"am":"pm")),e.onChangeHandler()},onBeforeShow:function(t,i){e.triggerGlobalHandler("modalViewDidAppear",{}),e.changeMinValue(e.properties.minValue),e.changeMaxValue(e.properties.maxValue),bizagi.util.isiOSDevice()&&$(".ui-bizagi-notifications-container").css("display","none")},onClose:function(t,i){e.triggerGlobalHandler("modalViewDidDisappear",{}),$(".mbsc-fr-scroll").css("overflow-y","auto")},onShow:function(e,t){$(".mbsc-fr-scroll").css("overflow-y","hidden")}}),this.input.on("focus",function(e){e.preventDefault(),e.stopPropagation(),bizagi.util.isCordovaSupported()&&bizagi.util.isAndroidDevice()&&(cordova.plugins.Keyboard.disableScroll(!0),cordova.plugins.Keyboard.close())}),""===e.properties.displayValue&&e.properties.value){var o=e.getFormattedDate(e.properties.value,e.properties.showTime,!0,!1);if(void 0!==o){var l=bizagi.util.dateFormatter.formatDate(o,e.properties.fullFormat);this.input.prop("value",l)}}this.input.attr("keyboard","disable")},getTimeFormat:function(){return-1!==this.properties.timeFormat.indexOf("H")||-1!==this.properties.timeFormat.indexOf("HH")?(this.is24h=!0,"HH:ii"):(this.is24h=!1,"hh:ii A")},getFormattedDate:function(e,t,i){if(e&&!bizagi.util.isObjectEmpty(e)){e="string"!=typeof e?e.toString():e;var a=t&&("0:0"===this.getTime()||i)?" "+e.substr(e.length-8,e.length):"",r=i&&t&&a.split("/").length>1||1===e.split(":").length?e+=" 00:00:00":e;e=bizagi.util.dateFormatter.getDateFromInvariant(r,t);var n=t?""!==a?a:" "+this.getTime():" 00:00",o=this.setHour(this.getFullFormatedDate(e,n));return o=bizagi.util.dateFormatter.getDateFromISO(o,!0)}},changeMinValue:function(e){var t=this.properties,i=this.getDateControl();e&&this.properties.editable&&("number"==typeof e?(e=new Date(e),i.mobiscroll("option",{min:e}),e=bizagi.util.dateFormatter.formatInvariant(e,t.showTime)):i.mobiscroll("option",{min:bizagi.util.dateFormatter.getDateFromInvariant(e,!0)}),t.minValue=e)},changeMaxValue:function(e){var t=this.properties,i=this.getDateControl();e&&this.properties.editable&&("number"==typeof e?(e=new Date(e),i.mobiscroll("option",{max:e}),e=bizagi.util.dateFormatter.formatInvariant(e,t.showTime)):i.mobiscroll("option",{max:bizagi.util.dateFormatter.getDateFromInvariant(e,!0)}),t.maxValue=e)},setDisplayValue:function(e){var t=this,i=t.getFormattedDate(e,t.properties.showTime,!1),a=t.preprocessDateValue(i);t.input=t.input?t.input:t.getDateControl(),!1===t.properties.editable?"string"!=typeof a&&"number"!=typeof a||t.input.html(a):t.input.prop("value",a)},getDateControl:function(){return $(".bz-input-icon",this.getControl())},getTime:function(){var e=this;if(e.properties.showTime&&e.time&&""!==e.time.minutes){var t=e.time.hours+":"+e.time.minutes;return-1!=(t+=e.timeS).indexOf("am")&&12==e.time.hours&&(t=t.replace("12","0")),-1!=t.indexOf("pm")&&e.time.hours<12&&(t=t.replace(e.time.hours,parseInt(e.time.hours)+12)),t.replace(/(am|pm)/,"")}return""},getDate:function(){return this.date&&""!==this.date.month?this.date.year+"-"+(parseInt(this.date.month)+1)+"-"+this.date.day:""},onChangeHandler:function(e){var t=this,i=t.properties,a=t.getDate(),r=i.showTime?" "+t.getTime():" 0:00";if(""===a&&!i.showTime||""===a&&""===r||e)t.setValue(""),t.input.prop("value",""),i.displayValue="";else{var n=t.setHour(t.getFullFormatedDate(a,r));if(!(n=bizagi.util.dateFormatter.getDateFromISO(n,!0))||0==n)return;t.setNewDateValue(n,i.showTime);var o=t.preprocessDateValue(n);i.displayValue=o,t.input.prop("value",t.properties.displayValue)}},getFullFormatedDate:function(e,t){var i="";i=e.length>0?e:void 0!==e?bizagi.util.dateFormatter.formatISO(e,!1):bizagi.util.dateFormatter.formatISO(new Date,!1),i+=t;var a=bizagi.util.dateFormatter.getDateFromFormat(i,"yyyy-MM-dd H:m");return bizagi.util.dateFormatter.formatDate(0!==a?a:e,"yyyy-MM-dd H:mm:ss")},setNewDateValue:function(e,t){var i="";""!=e&&(i=bizagi.util.dateFormatter.formatInvariant(e,t)),this.setValue(i)},applyDateFormat:function(e,t){if(!t){var i=null,a=(i=-1!=e.indexOf("00:00")?e.indexOf("00:00"):-1!=e.indexOf("0:00")?e.indexOf("0:00"):-1!=e.indexOf("12:00")?e.indexOf("12:00"):"-1")+8;e=-1===i?e:e.replace(e.substring(i,a),"").replace(" am","").replace(" pm","")}return e},preprocessDateValue:function(e){return bizagi.util.dateFormatter.formatDate(e,this.properties.fullFormat)},isValid:function(e){var t=this,i=t.properties,a=!0,r=t.getValue();return r&&bizagi.util.parseBoolean(i.editable)&&0!=(r=bizagi.util.dateFormatter.getDateFromInvariant(r))&&(r.setHours(0,0,0,0),i.minValue&&"string"==typeof i.minValue&&(a=!t.validateMinAndMaxValue(r,!0,i,e)&&a),i.maxValue&&"string"==typeof i.maxValue&&(a=!t.validateMinAndMaxValue(r,!1,i,e)&&a)),bizagi.util.parseBoolean(i.editable)&&i.required&&!t.hasValue()&&t.showMandatoryMessage(i,e),a&&t.setValidationMessage(""),a},validateMinAndMaxValue:function(e,t,i,a){var r=bizagi.util.dateFormatter.getDateFromInvariant(t?i.minValue:i.maxValue);if(0==r){var n="";-1==i.timeFormat.indexOf(":ss")&&(n=t?i.minValue+":00":i.maxValue+":00"),r=bizagi.util.dateFormatter.getDateFromFormat(n,i.fullFormat+":ss")}if(r.setHours(0,0,0,0),t&&e<r||!t&&e>r){var o=bizagi.util.dateFormatter.formatDate(r,i.fullFormat),l="";return l=t?this.getResource("render-date-minimum-validation").replaceAll("#label#",i.displayName).replaceAll("#minValue#",o):this.getResource("rendr-date-maximum-validation").replaceAll("#label#",propertiee).replaceAll("#maxValue#",o),a.push({xpath:i.xpath,message:l}),!0}return!1},showMandatoryMessage:function(e,t){var i=this.getResource("render-required-text").replaceAll("#label#",e.displayName);return t.push({xpath:e.xpath,message:i}),!1},setHour:function(e){return e.replace(" 0:"," 00:").replace(" 1:"," 01:").replace(" 2:"," 02:").replace(" 3:"," 03:").replace(" 4:"," 04:").replace(" 5:"," 05:").replace(" 6:"," 06:").replace(" 7:"," 07:").replace(" 8:"," 08:").replace(" 9:"," 09:")},clearDisplayValue:function(){var e=this;e.date=void 0,e.time=void 0,e.timeS=void 0,e.onChangeHandler(!0),e.setDisplayValue("")},isValidMinMaxValue:function(){var e=this,t=!0,i=e.getValue();return i&&0!==(i=bizagi.util.dateFormatter.getDateFromInvariant(i))&&(i.setHours(0,0,0,0),e.properties.minValue&&"string"==typeof e.properties.minValue&&(t=e.validateMinAndMaxValue(i,!0)),e.properties.maxValue&&"string"==typeof e.properties.maxValue&&(t=e.validateMinAndMaxValue(i,!1))),t},validateMinAndMaxValue:function(e,t){var i=t?this.properties.minValue:this.properties.maxValue,a=bizagi.util.dateFormatter.getDateFromInvariant(i);return a.setHours(0,0,0,0),!(t&&e<a||!t&&e>a)},getElementsToStylize:function(e){return $("input",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.yesno",bizagi.rendering.yesno.prototype),bizagi.rendering.tablet.yesno.extend("bizagi.rendering.tablet.yesno",{},{postRender:function(){var e=this.getControl();this.radio=e.find("input[type=radio]"),!this.properties.editable||null!=this.value&&void 0!==this.value||null==this.properties.value||(this.value=this.properties.value)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.radio=e.find("input"),this._super()},setDisplayValue:function(e){var t=this.getControl(),i=bizagi.util.parseBoolean(e);this.setValue(i,!1),this.properties.editable?i?(t.find("input[value=true]").prop("checked",!0),t.find("input[value=false]").prop("checked",!1)):(t.find("input[value=false]").prop("checked",!0),t.find("input[value=true]").prop("checked",!1)):this.radio.val(this.getDisplayValue())},configureHandlers:function(){var e=this;e.radio.change(function(){var t=$(this).prop("value");e.value!==t&&e.setValue(t)})},getElementsToStylize:function(e){return $("label.bz-radio__label",e)},cleanData:function(){this.setValue({id:"",label:""},!1),this.clearDisplayValue()},clearDisplayValue:function(){this.properties.editable?this.radio.prop("checked",!1):this.radio.val(this.getDisplayValue())}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.check",bizagi.rendering.check.prototype),bizagi.rendering.tablet.check.extend("bizagi.rendering.tablet.check",{},{postRender:function(){var e=this.getControl();this.check=e.find("input"),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.check=e.find("input"),this._super()},setDisplayValue:function(e){var t=bizagi.util.parseBoolean(e);this.setValue(t,!1),this.properties.editable?t?this.check.attr("checked","checked"):this.check.removeAttr("checked"):this.check.val(this.getDisplayValue())},configureHandlers:function(){var e=this;this.check.on("click",function(t){var i=$(this).is(":checked");e.setValue(i,!0)})},cleanData:function(){this.setDisplayValue(!1),this.setValue(!1,!1)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.combo",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.combo.extend("bizagi.rendering.tablet.combo",{renderControl:function(){var e=this.renderFactory.getTemplate("combo");return $.fasttmpl(e,{editable:this.properties.editable,value:this.getDisplayValue()})},postRender:function(){this._super(),this.itemSelected=void 0},configureHandlers:function(){var e=this,t=e.getControl();"execution"===e.getMode()&&$(".bz-form-combo",t).bind("click",function(){$(this).mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),displayName:e.properties.displayName||"",orientation:e.properties.orientation||"",contentTemplate:"",style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},open:function(){e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){var i={};if(e.isDependant&&e.properties&&/cascadingcombo/i.test(e.properties.type)&&e.getParentCombo){var a=e.getParentCombo().getValue();a&&a.id&&(i[e.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=a.id)}$.when(e.renderCombo(i)).done(function(i){$(".bz-modal-view__content",t.content).html(i),e.configureModalViewHandlers(t)})}})})},processComboData:function(e){var t=this;e.forEach(function(e){t.validateValue(e)})},setDisplayValue:function(e){var t;if((e=this.mapValue(e))&&"object"==typeof e&&void 0!==e.label){if(""===e.label||bizagi.util.isNumeric(e.label)){var i=this.findDataValueById(e.value);t=i?i.value:""}else t=e.label;$.isArray(t)&&(t=t.join(" - ")),e={id:e.id,value:t}}var a=this.getControl();this.properties.editable?$("input",a).val(this.formatItem(e.value)):$(a).html(this.formatItem(e.value)),this.selectedValue=e,this.setValue(e)},configureModalViewHandlers:function(e){var t=this;$(".bz-list__item",e.content).on("click",function(){var i={id:$(this).data("value"),value:$(this).text()};""==i.id&&(i.value=""),t.itemSelected=!0,t.setDisplayValue(i),t.trigger("select",[i,!1]),e.close()});var i=$(".bz-list li",e.content),a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);$("[data-action=close]",e.header).bind("click",function(){e.close()}),a.bind("click",function(){r.val("").trigger("change")}),r.bind("change keyup",function(){""==this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)}).focus()},cleanData:function(){this.setDisplayValue({id:"",label:""})},filterList:function(e,t){t.filter(function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()}).show()},renderComboTemplate:function(e){var t=this.renderFactory.getTemplate("combo-list"),i=this.getValue();return i=null!=i?i:{id:"",value:""},$.fasttmpl(t,{items:e,selectedId:i.id,hasItems:e.length>0},{validateItem:this.validateValue})},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".readonly-control",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.collectionnavigator",bizagi.rendering.collectionnavigator.prototype),bizagi.rendering.tablet.collectionnavigator.extend("bizagi.rendering.tablet.collectionnavigator",{},{postRender:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")},postRenderReadOnly:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.upload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.upload.prototype),bizagi.rendering.tablet.upload.extend("bizagi.rendering.tablet.upload",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{isNative:!1,isOfflineForm:!1,initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported()},renderControl:function(){var e=this.renderFactory.getTemplate("upload");return this.renderItem(e,{})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("upload-readonly"),t={noFiles:0===this.filesCount};return this.renderItem(e,t)},renderItem:function(e,t){for(var i=this,a="",r=$.fasttmpl(e,t),n=0;n<i.filesCount;n++){var o={id:i.files[n][0],fileName:i.files[n][1]};a+=i.renderUploadItem(o)}return r=i.replaceFilesHtml(r,a)},postRender:function(){var e=this.getControl();this.$contentFile=$(".bz-file-upload__container",e),this.$inputFile=$(".bz-file-upload__input",e),this.$nativeFile=$(".bz-file-upload__native",e)},configureHandlers:function(){this.checkFileExtensions(),this.attachEvents()},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-readonly-lists",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})})},attachEvents:function(){var e=this,t=e.getControl();this.$contentFile.off("click").on("click",function(t){e.chooseFile()}),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})}),$("ul.bz-files",t).on("click",".bz-file .bz-icn",function(){var t=$(this).parent(".bz-file"),i=t.data();e.removeFile(t,i.id)}),e.isNative?(this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-file-upload__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),$.when(e.handlerResolutionUpload(t.guid)).always(function(){bizagi.loading.stop()})},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})):(this.$inputFile.off("change").on("change",function(){e.addFile(),this.value=""}),this.$inputFile.off("click").on("click",function(e){e.stopPropagation()}))},handlerUploadFile:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture(function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then(function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i)){bizagi.util.getAndroidVersion();if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then(function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.handlerResolutionUpload(e)});$(".bz-file-upload__resolution",t.getControl()).click()}})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,correctOrientation:!0});break;case 1:navigator.camera.getPicture(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then(function(i){return t.fileProperties=i,t.saveImage(e)})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;case 3:navigator.device.capture.captureVideo(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSizeVideo(e,t.properties)).then(function(){return t.saveVideo(e)}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{limit:t.Class.LIMIT})}},handlerResolutionUpload:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.saveImage(t.dataImage);var a=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,a)).then(function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.saveImage(t.dataImage)})},saveImage:function(e){var t=this,i="";t.editedImageURL?i=t.editedImageURL:t.fileProperties&&(i=t.fileProperties.url);var a={dataFile:bizagi.util.media.getImagePath(i),fileName:t.fileProperties.name,mimeType:"image/jpeg"};return t.editedImageURL=null,t.fileProperties=null,this.uploadFile(a)},saveVideo:function(e){var t={dataFile:e[0].fullPath,fileName:e[0].name,mimeType:"video/quicktime"};return this.uploadFile(t)},uploadFile:function(e){var t=this,i={},a=t.buildAddParams();return a.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),i.data=a,i.options=new FileUploadOptions,i.options.fileKey="file",i.options.fileName=e.fileName,i.options.uploadKey={key:a.h_xpath},i.options.addUrl=t.properties.addUrl,i.dataFile=e.dataFile,e.mimeType&&(i.options.mimeType=e.mimeType),$.when(bizagi.util.media.uploadFile(i)).then(function(e){var i=JSON.parse(decodeURIComponent(e.response));"error"===i.type?bizagi.showMessageBox(i.message,i.errorType):t.onUploadFileCompleted(i)}).fail(function(e){t.executeFormFailHandler(e)})},onFail:function(e){var t=bizagi.util.processFailMessage(e);if(bizagi.loading.stop(),t&&"string"==typeof t&&-1!==t.indexOf("No Activity found to handle Intent")){var i=bizagi.util.isValidResource("render-upload-error-media-app")?bizagi.localization.getResource("render-upload-error-media-app"):"Your device does not have an app to execute this action.";bizagi.showMessageBox(i)}},onUploadFileCompleted:function(e){var t=this,i=$(".bz-files",t.getControl());if(e.id&&e.fileName){var a=t.renderUploadItem(e);i.append(a),t.filesCount=t.filesCount+1;var r=t.files.slice();r.push([e.id,e.fileName]),t.setValue(r,!0),t.checkMaxFiles(),t.editedImageURL=null}else bizagi.showMessageBox(e.message,"Error")},checkMaxFiles:function(){this.isMaxFilesReached()?$(this.$contentFile).addClass("bz-file-upload__container--hidden"):$(this.$contentFile).removeClass("bz-file-upload__container--hidden")},isMaxFilesReached:function(){var e=this.properties.maxfiles,t=this.properties.value?this.properties.value.length:0;return 0!==e&&this.filesCount>=e&&t>=e},checkFileExtensions:function(){var e=this,t=e.properties.validExtensions||"";if(e.validOptions={video:!1,image:!1,file:!1},void 0===(t=t.replace(/\s+/g,"").toLowerCase())||""===t)e.validOptions={video:!0,image:!0,file:!0};else if(1===(t=t.split(";")).length&&-1!==t[0].indexOf("*.*"))e.validOptions.video=!0,e.validOptions.image=!0;else for(var i=0,a=t.length;i<a;i++)t[i]=t[i].replace("*.",""),e.Class.EXTENSIONSFILE.toString().indexOf(t[i])>=0?e.validOptions.file=!0:e.Class.EXTENSIONSIMG.toString().indexOf(t[i])>=0?e.validOptions.image=!0:e.Class.EXTENSIONSVIDEO.toString().indexOf(t[i])>=0&&(e.validOptions.video=!0);e.validOptions.file||e.validOptions.image||e.validOptions.video||$(e.$contentFile).addClass("bz-file-upload__container--hidden"),!e.isMaxFilesReached()&&(e.isNative||bizagi.util.media.fileAPISupported()&&!e.isOfflineForm)||$(this.$contentFile).addClass("bz-file-upload__container--hidden")},buildAddFileParams:function(e){var t=this,i=t.Class.BA_CONTEXT_PARAMETER_PREFIX,a=new FormData,r=t.getFormContainer();a.append(i+"xpath",t.getUploadXpath()),a.append(i+"idRender",t.properties.id),a.append(i+"xpathContext",t.properties.xpathContext),a.append(i+t.Class.BA_PAGE_CACHE,t.properties.idPageCache),a.append(t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",r.properties.sessionId),a.append(t.properties.xpath,e),t.properties.contexttype&&a.append(i+"contexttype",t.properties.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?a.append(BIZAGI_SESSION_NAME,r.properties.sessionId):a.append("JSESSIONID",r.properties.sessionId)}catch(e){a.append("JSESSIONID",r.properties.sessionId)}return a},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},clearDisplayValue:function(){var e=this,t=$(".bz-files",e.getControl());$(".bz-file",t).each(function(t,i){var a=(i=$(i)).data();e.removeFile(i,a.id)})},getUploadChoices:function(){var e=[];return this.validOptions.image&&(e.push({guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}),e.push({guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")})),this.validOptions.video&&e.push({guid:3,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-video")}),[].concat(e)},executeFormFailHandler:function(e){var t="";t=e&&e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error"),this.getFormContainer().failHandler(t)},chooseFile:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&!this.isOfflineForm&&this.$inputFile.click()},addFile:function(){var e=this,t=this.$inputFile[0].files[0],i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSFILE,e.Class.EXTENSIONSVIDEO);t.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.processUploadFile(t)).then(function(t){e.onUploadFileCompleted(JSON.parse(decodeURIComponent(t)))}).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()}):bizagi.loading.stop()},removeFile:function(e,t){var i=this;$.when(i.deleteUploadItem(e,t)).done(function(){e.hide(),e.remove(),i.setValue(i.files,!1),i.checkMaxFiles(),i.triggerRenderChange()})},getTemplateItemName:function(){return"upload-item"},getElementsToStylize:function(e){return $(".bz-input-icon__input",e)}}),bizagi.rendering.tablet.upload.extend("bizagi.rendering.tablet.upload.offline",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{initializeData:function(e){this._super(e);var t=Number(this.properties.maxSize)||1048576,i="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;this.properties.maxSize=t<i?t:i,this.updateFilesCount()},renderItem:function(e,t){for(var i="",a=$.fasttmpl(e,t),r=0;r<this.files.length;r++){var n=this.files[r];if(n.status&&"deleted"!==n.status&&"new-deleted"!==n.status)i+=this.renderUploadItem(n,r)}return a=this.replaceFilesHtml(a,i)},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-files",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file");e.openOfflineFile(t)})},attachEvents:function(){var e=this,t=e.getControl();this.$contentFile.off("click").on("click",function(t){e.isNative?e.$nativeFile.click():e.$inputFile.click(),e.$inputFile.off("change").on("change",function(){e.handlerWebUploadFile()})}),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file");e.openOfflineFile(t)}),$("ul.bz-files",t).on("click",".bz-file .bz-icn",function(){var t=$(this).parent(".bz-file");e.removeOfflineFile(t)}),e.isNative&&this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})},handlerWebUploadFile:function(){var e,t,i=this,a=i.$inputFile[0].files[0],r=bizagi.util.randomNumber();$.when(i.getBlobFromPath(a)).then(function(a){return bizagi.loading.start(),t=a.type,e=a.name,i.saveOfflineFile(a,r,t)}).then(function(a){i.onUploadOfflineFileCompleted(e,t,r)}).always(function(){bizagi.loading.stop()}),i.$inputFile[0].value=""},handlerUploadFile:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture(function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then(function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i))return t.saveImage(t.dataImage)})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,correctOrientation:!0});break;case 1:navigator.camera.getPicture(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then(function(i){return t.fileProperties=i,t.saveImage(e)})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;default:console.log("The option is not supported!")}},addInteractions:function(){var e=this,t=e.getControl();$("ul.bz-files",t).on("click",".bz-file .bz-file__delete",function(){var t=$(this).parent(".bz-file");e.removeOfflineFile(t)})},collectData:function(e){var t=this;t.filesCount>0?e[t.properties.xpath]=t.files:"delete"===t.properties.method&&(e[t.properties.xpath]=[],delete t.properties.method)},saveImage:function(e){var t=this;bizagi.loading.start();var i,a=bizagi.util.randomNumber(),r=t.fileProperties.name;$.when(t.getBlobFromPath(e)).always(function(){bizagi.loading.stop()}).then(function(e){return i=e.type,r=e.name,t.saveOfflineFile(e,a,i)}).then(function(e){t.onUploadOfflineFileCompleted(r,i,a)}),t.$inputFile[0].value=""},checkFileExtensions:function(){var e=this,t=e.properties.validExtensions||"";if(e.validOptions={video:!1,image:!1,file:!1},void 0===(t=t.replace(/\s+/g,"").toLowerCase())||""===t)e.validOptions.image=!0;else if(1===(t=t.split(";")).length&&-1!==t[0].indexOf("*.*"))e.validOptions.image=!0;else for(var i=0,a=t.length;i<a;i++)t[i]=t[i].replace("*.",""),e.Class.EXTENSIONSIMG.toString().indexOf(t[i])>=0&&(e.validOptions.image=!0);e.validOptions.image||$(e.$contentFile).addClass("bz-file-upload__container--hidden"),!e.isMaxFilesReached()&&bizagi.util.media.fileAPISupported()||$(this.$contentFile).addClass("bz-file-upload__container--hidden")},onUploadOfflineFileCompleted:function(e,t,i){var a=this,r=$(".bz-files",a.getControl()),n={id:i,fileName:e,mimeType:t,status:"new"},o=a.renderUploadItem(n,a.files.length);r.append(o),a.filesCount=a.filesCount+1;var l=a.files.slice();l.push(n),a.setValue(l,!1),a.checkMaxFiles()},renderUploadItem:function(e,t){var i=this.getTemplateItemName(),a=this.renderFactory.getTemplate(i);return $.fasttmpl(a,{url:"javascript:void(0);",id:e.id,allowDelete:this.properties.allowDelete||!1,filename:e.fileName,index:t})},canBeSent:function(){return!0},failReadFile:function(e){try{bizagi.log("Error code: "+e.target.error.code)}catch(e){}},onFail:function(e){this._super(e)},removeOfflineFile:function(e){var t=this,i=e.data().index,a=t.files[i];a&&("new"!==a.status?a.status="deleted":a.status="new-deleted",e.hide(),e.remove(),t.setValue(t.files,!1),t.checkMaxFiles(),t.triggerRenderChange())},updateFilesCount:function(){for(var e=this.properties.value,t=0;t<e.length;t++){var i=e[t].status;i&&i.includes("deleted")&&(this.filesCount=this.filesCount-1)}},setValue:function(e,t){this._super(e,t),this.updateFilesCount(),0===this.filesCount&&(this.properties.method="delete")},isMaxFilesReached:function(){var e=this.properties.maxfiles;return 0!==e&&this.filesCount>=e},openOfflineFile:function(e){var t=e.data(),i=t.index,a="number"==typeof i?this.properties.value[i]:null;if(a){var r=this.getFormParams(),n={idCase:r.idCase,idWorkitem:r.idWorkitem,id:this.properties.xpath+"."+a.id,offlineType:r.offlineType};bizagi.loading.start(),$.when(this.dataService.getOfflineFile(n,"blob",a.mimeType)).done(function(e){var i=t.title;bizagi.util.media.handleBinaryFile(e,i)}).fail(function(e){console.log("Error opening offline file",e)}).always(function(){bizagi.loading.stop()})}},getBlobFromPath:function(e){var t=new $.Deferred;if(this.isNative){var i=this.fileProperties.name;e=bizagi.util.isAndroidDevice()?bizagi.util.media.getImagePath(e):bizagi.util.media.normalizeIOSFilePath(e);var a=function(e){console.log("Error converting path to blob",e),t.reject(e)};window.resolveLocalFileSystemURL(e,function(e){e.file(function(e){var a=new FileReader;a.onloadend=function(){var a=new Blob([this.result],{type:e.type});a.name=i,t.resolve(a)},a.readAsArrayBuffer(e)},a)},a)}else t.resolve(e);return t},saveOfflineFile:function(e,t,i){var a=this.getFormParams(),r={idCase:a.idCase,idWorkitem:a.idWorkitem,id:this.properties.xpath+"."+t,operationType:"edition",offlineType:a.offlineType};return this.dataService.saveOfflineFile(r,e,i)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.grid",bizagi.rendering.grid.prototype),bizagi.rendering.tablet.grid.extend("bizagi.rendering.tablet.grid",{GRID_PAGE_SIZE:10},{init:function(e){var t=this;e.data.properties.singleInstance=!1,this._super(e),this.cellMetadata={},this.isOfflineForm=bizagi.util.isOfflineForm({context:t});var i=this.properties,a=t.getFormContainer();t.properties.helpText&&null!=t.properties.helpText&&""!=t.properties.helpText?i.displayType="value":i.displayType="vertical",i.labelAlign="left",(i.groupBy||i.groupSummary)&&a.addWarning(t.getResource("render-tablet-warning-grid"))},initializeData:function(e){e.properties.singleInstance=!1,this._super(e)},updateAffectedCellManually:function(){},getRowIndexByKey:function(){},postRender:function(){var e=this,t=e.properties,i=e.getControl();for(var a in e.initialLoadDone=!1,e.isPaginatorActive=!1,e._super(),e.grid=$(">div",i),e.getLabel().hide(),e.applyGridPlugin(),t.data&&(e.updateData(t.data),$.when(e.ready()).done(function(){e.triggerRenderChange({changed:!1})})),e.initialLoadDone=!0,e.pendingActions)e.pendingActions.hasOwnProperty(a)&&e.pendingActions[a].method.apply(e,e.pendingActions[a].arguments)},applyGridPlugin:function(){var e=this,t=e.properties,i=e.getMode(),a=e.grid,r=e.buildColumnModel(),n=$.grep(r,function(e){return e.summarizeBy});a.bizagi_grid_tablet({columns:r,maxColumns:4,title:t.displayName,isOfflineForm:e.isOfflineForm||!1,mode:i,template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),specialCell:e.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),buttons:e.renderFactory.getTemplate("bizagi.grid.buttons"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),totalizer:e.renderFactory.getTemplate("bizagi.grid.totalizer")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&null!=t.data,details:t.allowDetail,remove:t.allowDelete,inlineAdd:!1,allowMore:t.allowMore,enableXlsExport:!1,enablePdfExport:!1,hasTotalizer:n.length>0&&t.data.rows.length>0},pageRequested:function(t){"execution"==i&&e.fetchData(t.page,t.sortBy,t.sortType)},sortRequested:function(t){"execution"==i&&e.fetchData(t.page,t.sortBy,t.sortType)},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){"execution"==i&&e.triggerHandler("rowSelected",{id:t.key,data:t})},addRow:function(t){"execution"==i&&e.addRow()},editRow:function(t){"execution"==i&&e.editRow(t.key)},deleteRow:function(t){"execution"==i&&e.deleteRow(t.key)},moreRows:function(t){"execution"==i&&e.moreRows(t)},showFormDetails:function(t){e.showDetailForm(t.key)},showMore:function(t){"execution"==i&&e.showMore(t.key)},totalData:function(t){"execution"==i&&e.onTotalData()}})},postRenderReadOnly:function(){this.postRender()},buildColumnModel:function(){var e=this.columns,t=[];return t.push({name:"id",index:0,label:"id",hidden:!0,align:"center",required:!1,key:!0}),$.each(e,function(e,i){i.columnIndex=e+1;var a=bizagi.util.isEmpty(i.properties.displayName)?" ":i.properties.displayName,r={name:i.properties.xpath,index:e+1,label:a,required:i.properties.required||!1,key:!1,hidden:!i.properties.visible||"columnHidden"==i.properties.type||0==i.properties.columnVisible,summarizeBy:i.properties.totalize&&i.properties.totalize.operation?i.properties.totalize.operation:void 0,bizAgiProperties:i.properties};t.push(r)}),t},refresh:function(){this.fetchData()},dataReady:function(){return null!=this.dataReadyDeferred?this.dataReadyDeferred.promise():null},loadChanges:function(e){var t,i=[];for(t=0,length=e.length;t<length;t++)i.push([e[t][0],t]);for(t=0,idRowLength=i.length;t<idRowLength;t++){var a,r,n,o=this.changes[i[t][0]];if(void 0!==o)for(r in a=i[t][1],o)o.hasOwnProperty(r)&&(n=this.getColumn(r).columnIndex,e[a][n]=o[r])}},updateData:function(e){var t=this,i=t.grid,a=t.columns;e&&(t.properties.data=e,t.setCellOverrides(e,a),i.bizagi_grid_tablet("setData",e),t.properties.data&&t.properties.data.total>t.Class.GRID_PAGE_SIZE&&(t.alternativePaginator(),t.isPaginatorActive=!0))},fetchData:function(e,t,i){var a=this,r=a.properties;a.dataReadyDeferred=new $.Deferred,e=e||r.page||1,t=t||r.sortBy||"",i=i||r.sortOrder||"asc",r.page=e,r.sortBy=t,r.sortType=i,r.sort=t+" "+i,a.startLoading(),$.when(a.getRemoteData()).then(function(e){e&&(e.deviceMaxRecordsExceeded?bizagi.showMessageBox(bizagi.localization.getResource("render-search-maximum-records-allowed")):(a.isRTL()&&(e.rows=a.changeOrderData(e.rows)),a.loadChanges(e.rows),a.updateData(e),a.triggerRenderChange(),a.dataReadyDeferred.resolve()))}).always(function(){a.endLoading()})},collectData:function(e){var t=this,i=t.grid;if(t.grid&&(t.properties.inlineAdd||t.properties.inlineEdit)){var a=i.bizagi_grid_tablet.hasOwnProperty("getNewRowKeys")?i.bizagi_grid_tablet("getNewRowKeys"):[];if(a.length>0&&!t.properties.alreadySaved&&t.isValid()){var r=t.saveInlineAddedRows(a,!0);e.deferreds=e.deferreds||[],e.deferreds.push(r)}for(var n=0;n<a.length;n++)t.changes[a[n]]&&delete t.changes[a[n]]}t._super(e)},drawCell:function(e,t,i,a){var r=this;if(e.key)return i;r.newRecords=r.newRecords||{};var n=e.index-1,o=r.columns[n];r.cellMetadata[t]||(r.cellMetadata[t]={}),r.cellMetadata[t][n]||(r.cellMetadata[t][n]={});var l=r.cellMetadata[t][n].properties||o.originalProperties;void 0===l.visible||l.visible,void 0===l.editable||l.editable;if(l.editable=!1,a&&!0,o.properties.displayType="value","summary"==t&&!1,l.visible){var s=new $.Deferred;return $.when(o.renderReadOnly(t,i)).done(function(e){for(var i=0;i<r.columns.length;i++)r.cellOverrides[t]=r.cellOverrides[t]||{},r.getCellOverride(t,i).visible=!0;s.resolve(e)}),s.promise()}return""},onCellReady:function(e,t,i,a){var r=e.index-1,n=this.columns[r],o=(null!=this.cellMetadata[t][r]?this.cellMetadata[t][r].properties:void 0)||n.originalProperties,l=void 0===o.visible||o.visible,s=void 0===o.editable||o.editable;if(s=!!a,l)if(s){var d=n.properties.editable;if(n.properties.editable=s,n.properties.submitOnChange){var c=n.getDecorated(t);c&&(c.properties.submitOnChangexpathContext=this.properties.xpath+"[]")}n.postRender(t,i),n.properties.editable=d}else n.postRenderReadOnly(t,i)},addRow:function(){var e=this,t=e.properties,i=e.getFormContainer(),a=e.getFormParams();e.startLoading(),$.when(e.submitAddRequest()).done(function(r){var n=new bizagi.rendering.tablet.slide.view(e.dataService,e.renderFactory,{title:e.properties.displayName||"",container:i.container,formParams:a,navigation:a.navigation,showSaveButton:!0,onSave:function(t){return e.submitSaveRequest(r,t)}});e.endLoading();var o=t.xpath+"[id="+r+"]";n.render({idRender:t.id,recordXPath:o,xpathContext:t.xpathContext,idPageCache:t.idPageCache,requestedForm:"addForm",url:t.addPage,formParams:a,navigation:a.navigation}).done(function(){e.endLoading(),t.submitOnChange?e.submitOnChange():e.fetchData()}).fail(function(){e.endLoading(),e.submitRollbackRequest()})})},editRow:function(e){if(0!=e){var t=this,i=t.properties;if(1!=i.inlineEdit||0!=i.allowEdit)if(t.cleanActionChanges&&void 0!==t.cleanActionChanges[e]){t.changes=t.cleanActionChanges;var a=$.extend(t.changes[e],{});a.idPageCache=i.idPageCache,$(".ui-tooltip").remove(),$.when(t.submitSaveRequest(e,a)).done(function(){t.startLoading(),i.submitOnChange?t.submitForGridChange().always(function(){t.endLoading(),t.executeSubmitEditRequest(e)}):(t.endLoading(),t.fetchData())})}else t.executeSubmitEditRequest(e);else t.editInline(e)}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},executeSubmitEditRequest:function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=t.getFormParams(),n=new bizagi.rendering.tablet.slide.view(t.dataService,t.renderFactory,{title:t.properties.displayName||"",container:a.container,formParams:r,navigation:r.navigation,showSaveButton:!0,onSave:function(i){return t.submitSaveRequest(e,i)}});t.startLoading(),$.when(t.submitEditRequest(e)).done(function(){var a=i.xpath+"[id="+e+"]";n.render({idRender:i.id,recordXPath:a,xpathContext:i.xpathContext,idPageCache:i.idPageCache,requestedForm:"editForm",url:i.editPage,formParams:r,navigation:r.navigation}).done(function(){i.submitOnChange?t.submitOnChange():t.fetchData()}).fail(function(){t.startLoading(),$.when(t.submitRollbackRequest()).always(function(){t.endLoading()})})}).always(function(){t.endLoading()})},showDetailForm:function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=t.getFormParams(),n=new bizagi.rendering.tablet.slide.view(t.dataService,t.renderFactory,{title:t.properties.displayName||"",container:a.container,formParams:r,navigation:r.navigation,showSaveButton:!1}),o=i.xpath+"[id="+e+"]";n.render({idRender:i.id,recordXPath:o,xpathContext:i.xpathContext,idPageCache:i.idPageCache,requestedForm:"detailForm",url:i.editPage,formParams:r,navigation:r.navigation})},deleteRow:function(e){if(0!==e){var t=this;bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done(function(){$.when(t.submitDeleteRequest(e)).done(function(i){t.fetchData(),"success"===i.type&&t.triggerRenderChange({rowDeleted:!0,changed:!1,key:e})})})}else bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},moreRows:function(e){var t=this,i=t.properties;void 0===i.originalrowsPerPage&&(i.originalrowsPerPage=i.rowsPerPage),i.rowsPerPage+=i.originalrowsPerPage;var a={};t.collectData(a),t.startLoading(),jQuery.isEmptyObject(a)?t.moreRowsCommon(e):t.dataService.submitData({action:"SUBMITONCHANGE",data:a,idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,idPageCache:i.idPageCache}).done(function(){t.endLoading(),t.moreRowsCommon(e)})},moreRowsCommon:function(e){var t=this,i=t.properties;t.fetchData(e.page,e.sortBy,e.sortType),$.when(t.dataReadyDeferred).done(function(){0!=i.records&&i.records+1<=i.rowsPerPage&&$(".ui-bizagi-grid-dynamic-pager",t.getControl()).hide()})},showMore:function(e){for(var t=this,i=t.properties.data,a=t.properties,r=t.getFormContainer(),n=t.getFormParams(),o=[],l=0,s=i.rows.length;l<s;l++)if(i.rows[l][0]==e){o=i.rows[l];break}var d=new bizagi.rendering.tablet.slide.grid(t.dataService,t.renderFactory,{title:t.properties.displayName||"",container:r.container,allowEdition:!1,formParams:n,navigation:n.navigation});t.startLoading(),d.render({row:o,columns:t.columns,pageCacheId:a.idPageCache,xpath:a.xpath,xpathContext:a.xpathContext,sessionId:r.properties.sessionId,actions:r.actions,formParams:n,navigation:n.navigation}).done(function(){t.endLoading()})},editInline:function(e){for(var t=this,i=t.properties.data,a=t.properties,r=t.getFormContainer(),n=t.getFormParams(),o=[],l=0,s=i.rows.length;l<s;l++)if(i.rows[l][0]==e){o=i.rows[l];break}var d=new bizagi.rendering.tablet.slide.grid(t.dataService,t.renderFactory,{title:t.properties.displayName||"",container:r.container,formParams:n,navigation:n.navigation,allowEdition:!0});$.when(d.render({row:o,columns:t.columns,pageCacheId:a.idPageCache,xpath:a.xpath,xpathContext:a.xpathContext,sessionId:r.properties.sessionId,actions:r.actions,validations:r.validations,formParams:n,navigation:n.navigation})).done(function(i){for(xpath in i)t.collectGridChange({id:e,xpath:xpath,value:i[xpath],trigger:!1});var r={};t.collectData(r),t.dataService.submitData({action:"SUBMITONCHANGE",data:r,idRender:a.id,xpath:a.xpath,xpathContext:a.xpathContext,idPageCache:a.idPageCache}).done(function(){t.fetchData()})})},changeCellBackgroundColor:function(e,t,i){var a=this;if(a.initialLoadDone)for(var r=0;r<a.columns.length;r++){var n=a.getCellOverride(e,r).visible;if(a.columns[r].properties.xpath==t&&n){var o=a.grid.bizagi_grid_tablet("getCell",e,t,r);a.properties.editable&&(o=o.find("input")),o.css("background-color",i);break}}else a.pendingActions&&a.pendingActions.push({method:sel*f.changeCellBackgroundColor,arguments:arguments})},changeCellColor:function(e,t,i){var a=this;if(a.initialLoadDone){for(var r=0;r<a.columns.length;r++)if(a.columns[r].properties.xpath==t){var n=a.grid.bizagi_grid_tablet("getCell",e,t,r);a.properties.editable&&(n=n.find("input")),n.css("color",i);break}}else a.pendingActions&&a.pendingActions.push({method:a.changeCellColor,arguments:arguments})},changeCellVisibility:function(e,t,i){var a=this;if(a.initialLoadDone){for(var r=0;r<a.columns.length;r++)if(a.columns[r].properties.xpath==t){var n=a.grid.bizagi_grid_tablet("getCell",e,t,r);1==i?n.show():n.hide(),a.cellOverrides[e]=a.cellOverrides[e]||{},a.getCellOverride(e,r).visible=i;break}}else a.pendingActions&&a.pendingActions.push({method:a.changeCellVisibility,arguments:arguments})},changeCellValue:function(e,t,i){var a=this;if(a.initialLoadDone){var r=a.getControlCell(e,t);if(r){r.setDisplayValue(i);var n=r.column;if(n){var o=n.getValue(e),l=n.getCompositeValue(e);r.setDisplayValue(i);r.triggerHandler("renderchange",{render:a,changed:!0}),a.collectGridChange({id:e,xpath:t,value:o,compositeValue:l,columnIndex:n,trigger:!1})}}}else a.pendingActions&&a.pendingActions.push({method:a.setDisplayValue,arguments:arguments})},setError:function(e,t){var i=this;if(i.initialLoadDone)for(var a=0;a<i.columns.length;a++){var r=i.getCellOverride(e,a).visible;if(i.columns[a].properties.xpath==t&&r){i.grid.bizagi_grid_tablet("getCell",e,t,a).parent().addClass("ui-bizagi-render-grid-cell-error");break}}else i.pendingActions&&i.pendingActions.push({method:i.setError,arguments:arguments})},ready:function(){var e=this._super(),t=this.inlineAddDeferred?this.inlineAddDeferred.promise():null;return $.when(e,t)},startLoading:function(e){bizagi.loading.start(),this._super(e)},endLoading:function(){bizagi.loading.stop(),this._super()},cleanCellData:function(e,t){var i=this;if(i.initialLoadDone){var a=i.getControlCell(e,t);if(a){a.cleanData();for(var r=0;r<i.columns.length&&i.columns[r].properties.xpath!=t;r++);for(var n=i.properties.data.rows,o=0,l=n.length;o<l;o++)if(Number(e)===n[o][0]){n[o][r+1]=[["",""]];break}i.cellOverrides[e]=i.cellOverrides[e]||{},i.getCellOverride(e,r).value=null,i.cleanActionChanges||(i.cleanActionChanges={}),i.cleanActionChanges[e]||(i.cleanActionChanges[e]={}),i.cleanActionChanges[e][t]=""}}else i.pendingActions.push({method:i.cleanData,arguments:""})},onTotalData:function(e){var t,i=this,a=(i.properties.data||{}).rows,r=(a.length,[]),n=i.buildColumnModel();bizagi.util.tablet.startLoading(),n.forEach(function(e,n){if(e.bizAgiProperties){switch(operationState=e.bizAgiProperties.totalize.operation,operationState){case"sum":t=a.sum(function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)},n);break;case"count":t=a.count(function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return bizagi.util.isArray(i)?bizagi.util.isArray(i)&&i.length>0?i:void 0:i},e,n);break;case"max":t=a.max(function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)},n);break;case"min":t=a.min(function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)},n);break;case"avg":t=(t=a.avg(function(t){var i=null!==t[n]?t[n]:e.bizAgiProperties.defaultvalue;return Number(i)},n)).toFixed(2)}operationState&&(t=i.formatTotalizedResult(operationState,e.bizAgiProperties.type,t),r.push({label:e.label,total:t}))}}),i.showTotals(r),bizagi.loading.stop()},formatTotalizedResult:function(e,t,i){switch(e){case"sum":case"avg":case"min":case"max":if("columnMoney"==t||"money"==t)return bizagi.util.formatMonetaryCell(i)}return i||0},showTotals:function(e){var t=$.fasttmpl(this.renderFactory.getTemplate("bizagi.grid.totalizer"),{items:e});this.grid.mobileView({displayName:bizagi.localization.getResource("render-grid-totalizer"),orientation:this.properties.orientation,style:"width: 80%; height: 70%",transition:"fade:in",cssClass:"bz-modal-view--totalizer",showBorder:!0,contentTemplate:t})},changeBackgroundColor:function(e){var t=this.getControl();return t&&("none"!=e?$(".bz-tablet-grid",t).css("background-color",e):$(".bz-tablet-grid",t).css("background-color","")),this},alternativePaginator:function(){}}),bizagi.rendering.tablet.grid.extend("bizagi.rendering.tablet.grid.offline",{MAX_ROWS_SUPPORTED:4},{init:function(e){var t=this;this._super(e);var i=t.getFormContainer(),a=this.properties;if(a.data.originalRows=bizagi.clone(a.data.rows),a.isTaskForm=i.properties.isTaskForm,t.newRecords={},a["new-records"])for(var r=Object.keys(a["new-records"]),n=0;n<r.length;n++)t.newRecords[r[n]]={},t.changes[r[n]]=a["new-records"][r[n]],t.newRecords[r[n]].createdOffline=!0;t["deleted-records"]=a["deleted-records"]?a["deleted-records"]:{},a.displayType="vertical",a.labelAlign="left",(a.groupBy||a.groupSummary)&&i.addWarning(t.getResource("render-tablet-warning-grid"))},postRender:function(){var e=this,t=e.properties,i=e.getControl();for(var a in e.initialLoadDone=!1,e.grid=$(">div",i),e.getLabel().hide(),e.applyGridPlugin(),t.data&&(e.updateData(t.data),$.when(e.ready()).done(function(){e.triggerRenderChange({changed:!1})})),e.initialLoadDone=!0,e.pendingActions)e.pendingActions[a].method.apply(e,e.pendingActions[a].arguments)},postRenderReadOnly:function(){this.postRender()},applyGridPlugin:function(){var e=this,t=e.properties,i=e.grid,a=e.getMode(),r=e.buildColumnModel();i.bizagi_grid_tablet({columns:r,maxColumns:e.Class.MAX_ROWS_SUPPORTED,title:t.displayName,isOfflineForm:this.isOfflineForm||!1,mode:e.getMode(),template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),dynamicPager:e.renderFactory.getTemplate("bizagi.grid.dynamicpager"),buttons:e.renderFactory.getTemplate("bizagi.grid.offline.buttons"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.offline.row.buttons"),specialCell:e.renderFactory.getTemplate("bizagi.grid.offline.cell.special")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&null!=t.data,remove:t.allowDelete,details:!1,inlineAdd:!!t.editable||t.inlineAdd,allowMore:!1,enableXlsExport:!1,enablePdfExport:!1,hasTotalizer:!1},isValid:function(){return e.isValidGrid()},pageRequested:function(t){"execution"===a&&e.fetchData(t.page,t.sortBy,t.sortType)},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(t){"execution"===a&&e.triggerHandler("rowSelected",{id:t.key,data:t})},addRow:function(t){"execution"===a&&e.addRow()},editRow:function(t){"execution"===a&&e.editRow(t.key)},deleteRow:function(t){"execution"===a&&e.deleteRow(t.key)},saveAddedRows:function(t){e.saveInlineAddedRows(t.keys)},beforeInlineAdd:function(){e.inlineAddDeferred=new $.Deferred},afterInlineAdd:function(){e.inlineAddDeferred&&e.inlineAddDeferred.resolve()},cancelEdition:function(t){e.removeNewRecords(t)},removeNewRecords:function(t){e.removeNewRecords(t)}})},fetchData:function(e,t,i){var a=this;a.dataReadyDeferred=new $.Deferred,a.startLoading(),$.when(a.getRemoteData()).then(function(e){a.endLoading(),e&&(a.updateData(e),a.triggerRenderChange(),a.dataReadyDeferred.resolve())})},processChanges:function(){return[]},collectOfflineTaskData:function(e){var t=this,i=t.properties,a=[],r=t.properties.data,n={};if(t.isValid([]))for(var o in t.changes){var l=[],s={};for(var d in t.changes[o])if(t.canColumnBeSent(o,d)){var c=t.getColumn(d).columnIndex-1;"string"==typeof(u=t.changes[o][d])&&null!==u.match(/\n/gm)&&(u=u.replaceAll("\n","\\n")),l[c]=u;var p=i.xpath+t.buildCellXpathFilter(o)+"."+d,u=t.changes[o][d].value?t.changes[o][d].value:t.changes[o][d];e[p]=u,s[p]=u}if(t.newRecords[o]){var g={url:i.addUrl,idRender:i.id,xpath:i.xpath,xpathContext:i.xpathContext,contexttype:i.contexttype,idPageCache:i.idPageCache,submitData:t.changes[o],prepare:!0,idRow:parseInt(o+"")};for(change in n[o]=g,s)delete e[change];var m={};m.idRow=parseInt(o+""),m.isNew=!0,m.changes=t.changes[o],l.push(m),t.newRecords[o].createdOffline||(a[a.length]=l)}}(JSON.stringify(r.rows)!==JSON.stringify(r.originalRows)||a.length>0)&&(e[i.xpath]=e[i.xpath]?e[i.xpath]:{},void 0!==r.rows&&a.length>0?e[i.xpath].rows=$.merge($.merge([],t.processOldRows(r.rows)),a):void 0!==r.rows&&r.rows.length>0?e[i.xpath].rows=t.processOldRows(r.rows):e[i.xpath].rows=a,t["deleted-records"]&&Object.keys(t["deleted-records"]).length>0&&(e[i.xpath]["deleted-records"]=t["deleted-records"]),n&&Object.keys(n).length>0&&(e[i.xpath]["new-records"]=n))},collectOfflineStartData:function(e){var t=this,i=[],a=t.properties,r=t.properties.data;if(t.isValid([]))for(var n in t.changes){var o=[];for(var l in t.changes[n])if(t.canColumnBeSent(n,l)){var s=t.getColumn(l).columnIndex-1,d=t.changes[n][l];"string"==typeof d&&null!==d.match(/\n/gm)&&(d=d.replaceAll("\n","\\n")),o[s]={value:d,xpath:l,DataType:t.getColumn(l).properties.dataType}}if(void 0!==t.properties.data.rows&&t.properties.data.rows.length>0)for(var c=[],p=0;p<r.rows.length;p++)if(r.rows[p][0]==n){c=r.rows[p],r.rows.splice(p,1),p--,c=t.processRow(c),o=$.extend(!0,c,o);break}i[i.length]=o}(JSON.stringify(r.rows)!==JSON.stringify(r.originalRows)||i.length>0)&&(void 0!==r.rows&&i.length>0?e[a.xpath].rows=$.merge($.merge([],t.processOldRows(r.rows)),i):void 0!==r.rows&&r.rows.length>0?e[a.xpath].rows=t.processOldRows(r.rows):e[a.xpath].rows=i)},collectData:function(e){this.collectOfflineTaskData(e)},processOldRows:function(e){for(var t=[],i=e,a=0,r=i.length;a<r;a++){var n=i[a];t[a]=$.grep(n,function(e,t){return t>0});var o={};o.idRow=parseInt(n[0]+""),o.isNew=!!this.newRecords[n[0]],o.changes=this.changes[n[0]]?this.changes[n[0]]:{},t[a].push(o)}return t},processRow:function(e){return $.grep(e,function(e,t){return t>0})},drawCell:function(e,t,i,a){var r=this;if(e.key)return i;"object"!=typeof i||null===i||a||(i=i.hasOwnProperty("value")?i.value:i);var n=e.index-1,o=r.columns[n],l=r.getCellOverride(t,e.index-1);r.newRecords=r.newRecords||{},r.cellMetadata[t]||(r.cellMetadata[t]={}),r.cellMetadata[t][n]||(r.cellMetadata[t][n]={});var s=r.cellMetadata[t][n].properties||o.originalProperties,d=void 0===s.visible||s.visible,c=void 0===s.editable||s.editable;if(d=l.visible,c=!!s.editable&&l.editable,a&&(c=!0),"summary"===t&&(c=!1),o.properties.displayType="value",o.setValue(t,i),o.setSurrogateKey(t),o.properties.data=o.properties.data||[],"columnSearch"===o.properties.type&&null!=i)for(var p=0,u=o.properties.data.length;p<u;p++)o.properties.data[p].id==i&&(i={id:o.properties.data[p].id,label:o.properties.data[p].value});if(("columnCombo"===o.properties.type||"columnList"===o.properties.type)&&null!=i)for(p=0,u=o.properties.data.length;p<u;p++)o.properties.data[p].id==i&&(i=[[o.properties.data[p].id,o.properties.data[p].value]]);return d?c?r.drawEditableCell(o,s,t,i,a):r.drawReadonlyCell(o,s,t,i):""},drawEditableCell:function(e,t,i,a,r){var n=this,o=new $.Deferred,l=e.properties.editable;return e.properties.editable=!0,e.overrideProperties({required:t.required}),$.when(e.render(i,a)).done(function(t){r&&!n.newRecords[i]&&(n.newRecords[i]={});for(var a=0;a<n.columns.length;a++)n.cellOverrides[i]=n.cellOverrides[i]||{},n.getCellOverride(i,a).visible=null==n.getCellOverride(i,a).visible||n.getCellOverride(i,a).visible;e.getDecorated(i).bind("renderchange",function(a){n.onCellChange(e,t,i)}),o.resolve(t)}),e.properties.editable=l,o.promise()},drawReadonlyCell:function(e,t,i,a){var r="";if("summary"===i){var n=e.properties.textFormat;e.properties.totalize&&(e.properties.textFormat=e.properties.totalize.format),r=e.renderSummary(i,a),e.properties.textFormat=n}else r=e.renderReadOnly(i,a);return r},onCellChange:function(e,t,i){var a=this,r=e.getValue(i),n=e.getCompositeValue(i);if("columnDate"===e.properties.type&&1==e.data.properties.showTime)if(bizagi.util.isEmpty(r))""===r&&(r="");else{var o=bizagi.util.dateFormatter.getDateFromInvariant(r,!0);r=bizagi.util.dateFormatter.formatInvariant(o,!0)}else if("columnDate"===e.properties.type){if(bizagi.util.isEmpty(r))""===r&&(r="");else(o=bizagi.util.dateFormatter.getDateFromInvariant(r,!1)).setHours(0,0,0,0),r=bizagi.util.dateFormatter.formatInvariant(o,!0)}if(a.properties.allowEdit||a.grid.bizagi_grid_tablet("isNewRecord",i)){var l=!a.grid.bizagi_grid_tablet("isNewRecord",i);a.collectGridChange({id:i,xpath:e.properties.xpath,value:r,compositeValue:n,columnIndex:e.columnIndex,trigger:l})}a.grid.bizagi_grid_tablet("changeCellValue",i,e.columnIndex,r),e.properties.totalize&&e.properties.totalize.operation&&a.grid.bizagi_grid_tablet("refreshSummary",e.columnIndex)},collectGridChange:function(e){var t=(e=e||{}).id,i=e.xpath,a=e.value,r=void 0===e.trigger||e.trigger;this.changes[t]=this.changes[t]||{},this.changes[t][i]=a,r&&this.triggerRenderChange({key:t,column:i})},onCellReady:function(e,t,i,a){bizagi.rendering.tablet.grid.prototype.onCellReady.apply(this,arguments)},addRow:function(){bizagi.showMessageBox(bizagi.localization.getResource("render-tablet-error-userfield"),bizagi.localization.getResource("render-tablet-error-userfield"))},editRow:function(e){},deleteRow:function(e){var t=this;e&&0!=e?bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done(function(){$.when(t.submitDeleteRequest(e)).done(function(){t.fetchData()})}):bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},editInline:function(e){},saveInlineAddedRows:function(e,t){var i=this.processChanges();bizagi.util.isEmpty(i)||(this.properties.data.rows=$.merge(this.properties.data.rows,i))},removeNewRecords:function(e){var t=this;e&&e.keys&&$.each(e.keys,function(e,i){t.newRecords[i]&&(delete t.newRecords[i],delete t.changes[i])})},getRemoteData:function(e){var t=this.properties;if(e=e||{},t.overrideGetRemoteData){var i=t.overrideGetRemoteData(e);return null!=i?i.promise():null}var a=new $.Deferred,r=t.data;return t.page=r.page,t.records=r.records,t.totalPages=r.totalPages,this.isRTL()&&(r.rows=this.changeOrderData(r.rows)),a.resolve(r),a.promise()},submitDeleteRequest:function(e){for(var t=this,i=t.properties,a=t.properties.data,r=0,n=a.rows.length;r<n;r++)if(a.rows[r][0]==e){if(a.rows[r],a.rows.splice(r,1),r--,a.records--,!0,t.newRecords[e])delete t.newRecords[e];else{var o=i.xpath+t.buildCellXpathFilter(e),l={url:i.deleteUrl,idRender:i.id,xpath:o,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType,prepare:!0};t["deleted-records"][e]=l}delete t.changes[e];break}return a.rows},isValidGrid:function(){var e=[],t=this.getFormContainer();if(void 0!==t.validationController&&t.validationController.clearValidationMessages(),this.isValid(e),e.length>0){if(void 0!==t.validationController)for(var i=0;i<e.length;i++)t.validationController.showValidationMessage(e[i].message,e[i].xpath);return!1}return!0}}),bizagi.rendering.tablet.grid.extend("bizagi.rendering.tablet.grid.grouped",{},{postRender:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")},postRenderReadOnly:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.search",bizagi.rendering.search.prototype),bizagi.rendering.tablet.search.extend("bizagi.rendering.tablet.search",{ADVANCED_SEARCH_ID:-1,ADVANCED_ADDITION_ID:-2,CLEAR_SEARCH_ID:-3,NO_RESULTS_SEARCH_ID:-4,DEFAULT_SEARCH_ID:"",SEARCH_MIN_LENGTH:3,SEARCH_DELAY:250,SEARCH_MAX_RECORDS:50},{initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.properties.submitOnChange=!this.isOfflineForm&&this.properties.submitOnChange,this.deferredReference=null},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly"),t=this.getDisplayValue(),i=t.label||t.value;return void 0!==i?"object"==typeof i&&(i=i.join(" - ")):i="","string"==typeof i&&(t.additionallabel&&(i+=" - "+t.additionallabel),i=bizagi.util.sanitizeHTML(i)),$.fasttmpl(e,{value:i,editable:this.properties.editable})},postRender:function(){this.searchInput=$(".bz-input-icon",this.getControl())},postRenderReadOnly:function(){this.searchInput=$(".bz-input-icon",this.getControl())},configureHandlers:function(){var e=this,t=e.getControl();$(".bz-input-icon",t).on("click",function(){!e.properties.advancedSearch||e.isOfflineForm?e._simplySearchView():e._advanceSearchView()}),$(".bz-icn--clear",t).bind("click",function(i){$(".bz-input-icon",t).addClass("bz-input-icon--empty"),e.cleanData(),e.readyActionExecution().done(function(){e.properties.submitOnChange&&e.submitData()}),i.stopPropagation()})},configureModalViewHandlers:function(e){var t=this;t.modalViewList=$(".bz-list",e.content);var i=bizagi.util.debounce(function(e){t.autoCompleteSearchResults($.trim(e))},t.Class.SEARCH_DELAY);$("[data-action=close]",e.header).bind("click",function(){e.close()});var a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);a.bind("click",function(){r.val("").trigger("clean")}),$(".bz-list",e.content).on("click","li",function(){var i=$.data(this).item;!i||i&&i.id==t.Class.NO_RESULTS_SEARCH_ID||(t.selectItem(i),e.close())}),r.bind("clean keyup",function(){""==this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),i(this.value)}).on("focus",function(){e.header.addClass("bz-modal-view__header--active")}).on("blur",function(){e.header.removeClass("bz-modal-view__header--active")})},_advanceSearchView:function(){var e=this,t=e.properties,i=$.extend({},e.getParams(),{container:e.getFormContainer().container,title:t.displayName||"",allowNew:t.allowNew});new bizagi.rendering.tablet.slide.searchForm(e.dataService,e.renderFactory,t.searchForms,{allowFullSearch:t.allowFullSearch,maxRecords:t.maxRecords,idRender:t.id,navigation:e.getParams().navigation,idPageCache:t.idPageCache,orientation:t.orientation||"ltr",editable:t.editable},i).render({idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:t.idPageCache}).done(function(t){e.setValue(t),e.readyActionExecution().done(function(){var t=e.getFormContainer();e.properties.submitOnChange||$.when(t.submitData()).done(function(){e.refreshControl()})})})},_simplySearchView:function(){var e=this,t=e.getContentTemplate();e.searchInput.mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),orientation:e.properties.orientation||"",contentTemplate:t,style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.configureModalViewHandlers(t)}})},autoCompleteSearchResults:function(e){var t=this;$.when(t.processRequest({term:e})).done(function(e){t.modalViewList.find("li").remove();for(var i=0,a=e.length;i<a;i++){t.renderSearchItem(e[i]).appendTo(t.modalViewList)}})},renderSearchItem:function(e){var t=this.renderFactory.getTemplate("search.item"),i=$.tmpl(t,{id:e.id,label:e.label,value:e.value});return i.data("item",e),i},processRequest:function(e){var t=this,i=t.properties,a=new $.Deferred,r=[];if(t.properties.allowSuggest&&e.term.length>=t.properties.searchLength){i.term=e.term;var n=t.isOfflineForm?t.getOfflineData():t.getData();t.deferredReference&&"function"==typeof t.deferredReference.reject&&"resolved"!==t.deferredReference.state()&&t.deferredReference.reject({hideStatus:!0}),t.deferredReference=n.done(function(n){n&&n.length>0?((n=n.slice(0,i.maxRecords)).length>t.Class.SEARCH_MAX_RECORDS?(n=n.slice(0,t.Class.SEARCH_MAX_RECORDS),r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-search-maximum-records-allowed"),value:""})):n=n.slice(0,i.maxRecords),r.push({id:t.Class.DEFAULT_SEARCH_ID,label:t.getResource("render-combo-empty-value"),value:""}),$.each(n,function(t,a){if(0===i.maxRecords||t<i.maxRecords){var n=bizagi.util.highlightMatches(a,e.term);r.push({id:a.id,label:n,value:a.value})}})):r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-grid-no-records"),value:""}),a.resolve(r)}).fail(function(){a.reject()})}else a.resolve(r);return a.promise()},setDisplayValue:function(e){var t=this,i="";if(null!=(e=t.mapValue(e))&&void 0!==e.id){i=e.additionallabel&&e.label?e.label+" - "+e.additionallabel:e.label?e.label:"";var a=t.searchInput.find("input");a.val(i),a.attr("id",e.id),""!==e.id&&t.properties.allowClear&&$(".bz-input-icon",t.getControl()).removeClass("bz-input-icon--empty"),t.properties.editable&&t.setValue(e,!0)}},submitData:function(){var e=this,t={};t[e.properties.xpath]=e.getValue(),e.properties.submitOnChange&&null!=t[e.properties.xpath].id&&e.submitOnChange(t,!0)},cleanData:function(){var e={id:"",value:""};bizagi.util.isEmpty(this.value)&&(e={}),this.setValue(e),this.setDisplayValue(e)},getContentTemplate:function(){var e=this.renderFactory.getTemplate("search.items"),t=$.fasttmpl(e,{});return $.trim(t)},selectItem:function(e){var t=this,i=t.hasValue(),a=Array.isArray(e.value)?e.value.join(" - "):e.value;t.setDisplayValue({id:e.id,label:a}),t.properties.allowClear&&(e.id===t.Class.DEFAULT_SEARCH_ID?(t.searchInput.find(".gn-bz-search__clear").addClass("gn-bz-search--hidden"),t.searchInput.find(".gn-bz-search__icon").removeClass("gn-bz-search--hidden")):i||e.id===t.Class.DEFAULT_SEARCH_ID||(t.searchInput.find(".gn-bz-search__clear").removeClass("gn-bz-search--hidden"),t.searchInput.find(".gn-bz-search__icon").addClass("gn-bz-search--hidden")))},getOfflineData:function(){var e=this.properties.data||[],t=(this.properties.term||"").toLowerCase();return $.when(t.startsWith("%%")?e:e.filter(function(e){var i=e&&e.value?e.value:"";return"object"==typeof i&&(i=i.toString()),i.toLowerCase().indexOf(t)>-1}))}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.letter",bizagi.rendering.letter.prototype),bizagi.rendering.tablet.label.extend("bizagi.rendering.tablet.letter",{},{}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.button",bizagi.rendering.button.prototype),bizagi.rendering.tablet.button.extend("bizagi.rendering.tablet.button",{},{configureHandlers:function(){var e=this;$(":button",e.getControl()).on("click",function(){e.processButton()})},processButton:function(){var e=this;e.properties.editable&&(e.properties.needsUserConfirmation?$.when(bizagi.showConfirmationBox(e.properties.userConfirmationMessage,"Bizagi","warning")).done(function(){e.triggerRenderChange({pressed:!0})}):(e.properties.preventDefault||e.runButtonAction(),e.triggerRenderChange({pressed:!0})))},getElementsToStylize:function(e){return $("button",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.fileprint",bizagi.rendering.fileprint.prototype),bizagi.rendering.tablet.fileprint.extend("bizagi.rendering.tablet.fileprint",{},{postRender:function(){this.getControl().parent().hide()}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.link",bizagi.rendering.link.prototype),bizagi.rendering.tablet.link.extend("bizagi.rendering.tablet.link",{},{postRender:function(){var e=this.getControl();this.link=e.find(".bz-link"),this._super(),this.preventDefaultForAnchorTag()},postRenderReadOnly:function(){var e=this.getControl();this.link=e.find(".bz-link"),this._super()},setDisplayValue:function(e){this.setValue(e,!1),this.isValidValue()&&(e=getFullyDecodedURI($.trim(e)),this.link.attr("href",e))},configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},attachEvents:function(){var e=this;e.isValidValue()&&e.link.on("click",function(t){t.preventDefault(),t.stopPropagation();var i=encodeURI(this.getAttribute("href"));e.linkSolver(i,e.properties.linktarget)})},isValidValue:function(){return this.hasValue()&&null!==$.trim(this.getValue()||"").toLowerCase().match(/^(http|https):\/\//)||!1},linkSolver:function(e,t){"newwindow"===t||bizagi.util.isCordovaSupported()?window.open(e,"_system","location=yes"):window.open(e,"_system")},processLayout:function(e){e?void 0!==this.properties.textFormat.background&&this._super(e,{background:this.properties.textFormat.background}):this._super(e,this.properties.textFormat)},getElementsToStylize:function(e){return $(".bz-link",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.formLink",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},bizagi.rendering.formLink.prototype),bizagi.rendering.tablet.formLink.extend("bizagi.rendering.tablet.formLink",{},{configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},openLink:function(){var e=this;$.when(e.submitEditRequest()).done(function(){bizagi.loading.start(),$.when(e.paintFormLink()).done(function(){bizagi.loading.stop()}).fail(function(){bizagi.loading.start(),e.rollbackForm()}).always(function(){bizagi.loading.stop()})}).always(function(){bizagi.loading.stop()})},openLinkRule:function(e){var t=this,i=new $.Deferred;return bizagi.loading.start(),t.getPropertyValue(e,{}).done(function(a){if(void 0!==(a=a||{}).messages&&null!==a.messages){var r=a.messages[0];t.getFormContainer().validationController.showErrorMessage(r),i.reject()}else"entryrule"===e&&t.openLink();i.resolve()}).fail(function(){i.reject()}).always(function(){bizagi.loading.stop()}),i.promise()},paintFormLink:function(){var e=this,t=e.properties,i=e.getFormContainer(),a=e.getFormParams(),r=$.Deferred();return new bizagi.rendering.tablet.slide.view(e.dataService,e.renderFactory,{title:e.properties.displayName||"",container:i.container,navigation:e.getParams().navigation,showSaveButton:t.editable,orientation:t.orientation||"ltr",onSave:function(t){return e.actionSave(t).then(function(t){return e.submitForm(t).done(function(){r.resolve(t)}).fail(function(){r.reject()})}).fail(function(e){r.reject(e)})},goBack:function(){e.rollbackForm()}}).render({idRender:t.id,xpathContext:t.xpathContext,idPageCache:t.idPageCache,recordXPath:e.getFormLinkXpath(),requestedForm:"linkform",editable:t.editable,formParams:a,url:t.editPage}).fail(function(){r.reject()}),r.promise()},getPropertyValue:function(e,t){var i=this,a=i.properties,r=new $.Deferred;return i.dataService.multiaction().getPropertyData({url:a.dataUrl,xpath:a.xpath,idRender:a.id,xpathContext:a.xpathContext,idPageCache:a.idPageCache,property:e,extra:t,dataType:t?t.dataType:null}).done(function(e){"error"===e.type?(i.getFormContainer().validationController.showErrorMessage(e.message),r.reject(e)):r.resolve(e)}).fail(function(e,t,a){i.getFormContainer().validationController.showErrorMessage(e.message),r.reject(e,t,a)}),r.promise()},actionSave:function(e){var t=this,i=$.Deferred();return $.when(t.submitSaveRequest(e)).done(function(e){try{"validationMessages"===e.type?t.form.addValidationMessage(e.messages):"error"===e.type&&i.reject(e),i.resolve(e)}catch(e){i.reject({noAction:!0})}}).fail(function(e){i.reject(e)}),i.promise()},submitSaveRequest:function(e){var t=this.properties;if(!1===t.editable&&!t.value)return null;var i=this.getFormLinkXpath(),a=i;return void 0!==t.xpathContext&&""!==t.xpathContext&&(a=i?t.xpathContext+"."+i:t.xpathContext),this.dataService.saveLinkForm({url:t.saveUrl,idRender:t.id,xpathContext:a,submitData:e})},submitForm:function(e){var t=this,i=$.Deferred(),a=!0;return e&&"validationMessages"===e.type&&(a=!1),t.properties.hasexitrule?t.closeExitRule().done(function(){a&&t.submitCommitRequest().done(function(){t.properties.hasentryrule?t.submitCommitRequest().done(function(){$.when(t.submitOnChange()).done(function(){i.resolve(e)})}):$.when(t.submitOnChange()).done(function(){i.resolve(e)})})}).fail(function(){i.reject()}):a&&a&&t.submitCommitRequest().done(function(){t.properties.hasentryrule?t.submitCommitRequest().done(function(){$.when(t.submitOnChange()).done(function(){i.resolve(e)})}):$.when(t.submitOnChange()).done(function(){i.resolve(e)})}).fail(function(){i.reject()}),i.promise()},closeExitRule:function(){var e=this.properties,t=new $.Deferred;return e.hasexitrule&&$.when(this.openLinkRule("exitrule")).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},rollbackForm:function(){var e=this,t=e.form||e.getFormContainer();$.when(e.submitRollbackRequest({idPageCache:t.idPageCache})).done(function(){e.properties.hasentryrule&&e.submitRollbackRequest({idPageCache:t.idPageCache})})},getFormLinkXpathContext:function(){var e=this.properties.xpathContext,t=this.getXpathContext();return t&&e?0===e.indexOf(t)?e:t+"."+e:e},attachEvents:function(){var e=this,t=e.getControl();$("[data-action=open]",t).on("click",function(){if(e.properties.hasentryrule){var t=e.getFormContainer();$.when(t.saveForm()).done(function(){e.submitCheckpointRequest().done(function(){return e.openLinkRule("entryrule")})})}else e.openLink()})},processLayout:function(e){e?void 0!==this.properties.textFormat.background&&this._super(e,{background:this.properties.textFormat.background}):this._super(e,this.properties.textFormat)},getElementsToStylize:function(e){return $(".bz-link",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.hidden",bizagi.rendering.hidden.prototype),bizagi.rendering.tablet.hidden.extend("bizagi.rendering.tablet.hidden",{},{}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.radio",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.radio.extend("bizagi.rendering.tablet.radio",bizagi.rendering.radio.prototype),bizagi.rendering.tablet.radio.extend("bizagi.rendering.tablet.radio",{},{postRender:function(){var e=this.getControl();this.radio=e.find("input[type=radio]"),!this.properties.editable||null!=this.value&&void 0!==this.value||null==this.properties.value||(this.value=this.properties.value)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.radio=e.find("input")},setDisplayValue:function(e){var t=this,i=t.getControl();(e=t.mapValue(e),t.setValue(e,!1),void 0!==e&&null!=e.id&&""!==e.id)&&(this.properties.editable?i.find('input[type="radio"][value="'+e.id+'"]').prop("checked","checked"):(t.radio.val(this.getDisplayValue()),t.radio.attr("id",e.id)))},configureHandlers:function(){var e=this;this.radio.change(function(){var t=$(this),i={id:t.prop("value"),value:$.trim(t.siblings("label").text())};e.setValue(i)})},getElementsToStylize:function(e){return $("label.bz-radio__label",e)},cleanData:function(){this.setValue({id:"",label:""},!1),this.clearDisplayValue()},clearDisplayValue:function(){this.properties.editable?this.radio.prop("checked",!1):this.radio.val(this.getDisplayValue())}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.cascadingCombo",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.cascadingCombo.extend("bizagi.rendering.tablet.cascadingCombo",bizagi.rendering.cascadingCombo.prototype),bizagi.rendering.tablet.cascadingCombo.extend("bizagi.rendering.tablet.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{renderControl:function(){var e=this.getMode();return this.parentCombo=this.getParentCombo(),null!=this.parentCombo&&/cascadingcombo/i.test(this.parentCombo.properties.type)&&(this.isDependant=!0),this.initializingCascadingCombo=!0,"execution"!=e&&(this.initializingCascadingCombo=!1),bizagi.rendering.tablet.combo.prototype.renderControl.apply(this,arguments)},postRender:function(){bizagi.rendering.tablet.combo.prototype.postRender.apply(this,arguments)},configureHandlers:function(){this._super(),bizagi.rendering.tablet.combo.prototype.configureHandlers.apply(this,arguments)},cleanData:function(){bizagi.rendering.tablet.combo.prototype.cleanData.apply(this,arguments)},refresh:function(e,t){var i=this;$.when(i.isRendered()).done(function(){var e=i.getControl(),a=i.getMode();e.empty(),$.when(i.renderControl()).then(function(r){e.html(r),i.postRender(),"execution"==a&&i.configureHandlers(),t?i.setDisplayValue(i.getValue()):i.setDisplayValue({id:"",value:""}),i.deferredVisible&&i.deferredVisible.resolve(),i.trigger("select",[i.getValue(),t])})})},setDisplayValue:function(e){bizagi.rendering.tablet.combo.prototype.setDisplayValue.apply(this,arguments)},processComboData:function(){bizagi.rendering.tablet.combo.prototype.processComboData.apply(this,arguments)},validateValue:function(){return bizagi.rendering.tablet.combo.prototype.validateValue.apply(this,arguments)},renderComboTemplate:function(){return bizagi.rendering.tablet.combo.prototype.renderComboTemplate.apply(this,arguments)},configureModalViewHandlers:function(){bizagi.rendering.tablet.combo.prototype.configureModalViewHandlers.apply(this,arguments)},configureCombo:function(){bizagi.rendering.tablet.combo.prototype.configureCombo.apply(this,arguments)},changeCombo:function(e,t){bizagi.rendering.tablet.combo.prototype.changeCombo.apply(this,arguments)},getSelectedValue:function(){return bizagi.rendering.tablet.combo.prototype.getSelectedValue.call(this,arguments)},getTemplateName:function(){return"combo"},filterList:function(e,t){return bizagi.rendering.tablet.combo.prototype.filterList.call(this,e,t)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.list",bizagi.rendering.combo.prototype),bizagi.rendering.tablet.list.extend("bizagi.rendering.tablet.list",bizagi.rendering.list.prototype),bizagi.rendering.tablet.list.extend("bizagi.rendering.tablet.list",{},{renderControl:function(){var e=this.renderFactory.getTemplate("list");return $.fasttmpl(e,{editable:this.properties.editable,value:this.getDisplayValue()})},postRenderReadOnly:function(){},configureHandlers:function(){var e=this,t=e.getControl();"execution"===e.getMode()&&$(".bz-form-list",t).bind("click",function(){$(this).mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),displayName:e.properties.displayName||"",orientation:e.properties.orientation||"",contentTemplate:"",style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},open:function(){e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){$.when(e.renderCombo({})).done(function(i){$(".bz-modal-view__content",t.content).html(i),e.configureModalViewHandlers(t)})}})})},processComboData:function(e){var t=this;e.forEach(function(e){t.validateValue(e)})},setDisplayValue:function(e){var t,i=this.getControl();if((e=this.mapValue(e))&&"object"==typeof e&&void 0!==e.label){if(""===e.label||bizagi.util.isNumeric(e.label)){var a=this.findDataValueById(e.value);t=a?a.value:""}else t=e.label;$.isArray(t)&&(t=t.join(" - ")),e={id:e.id,value:t}}$("input",i).val(this.formatItem(e.value)),this.selectedValue=e,this.setValue(e)},configureModalViewHandlers:function(e){var t=this;$(".bz-list__item",e.content).on("click",function(){var i={id:$(this).data("value"),value:$(this).text()};""==i.id&&(i.value=""),t.setDisplayValue(i),t.trigger("select",[i,!1]),e.close()});var i=$(".bz-list li",e.content),a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);$("[data-action=close]",e.header).bind("click",function(){e.close()}),a.bind("click",function(){r.val("").trigger("change")}),r.bind("change keyup",function(){""==this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)}).focus()},filterList:function(e,t){t.filter(function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()}).show()},renderComboTemplate:function(e){var t=this.renderFactory.getTemplate("list-items"),i=this.getValue();return i=null!=i?i:{id:"",value:""},$.fasttmpl(t,{items:e,selectedId:i.id,hasItems:e.length>0},{validateItem:this.validateValue})},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".readonly-control",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.multiSelect",bizagi.rendering.multiSelect.prototype),bizagi.rendering.tablet.multiSelect.extend("bizagi.rendering.tablet.multiSelect",{MORE_OPTION_WIDTH:40,SEARCH_MIN_LENGTH:1},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("searchList.readonly");return $.fasttmpl(e,{items:this.properties.value||{},editable:this.properties.editable||!0},{formatItem:this.formatItem})},postRender:function(){var e=this;this.isExecutionMode()&&this.getData().done(function(t){e.properties.data=t}),this._super()},configureHandlers:function(){var e=this,t=e.getControl();$("[data-action=modal]",t).bind("click",function(){e.openModalView()})},setDisplayValue:function(e){var t=this;this._super(e),void 0!==e&&$(".bz-input-icon__input",this.getControl()).html(e.map(function(e){return t.formatItem(e.value)}).join(", "))},openModalView:function(){var e=this;e.getData().done(function(t){var i=e.renderFactory.getTemplate("multiselect-list"),a=e.getValue();$.isArray(a)||(a="string"==typeof a?JSON.parse(a).value:a.value);var r={values:t,isChecked:function(t){return e.isChecked(a,t)}},n=$.fasttmpl(i,r,{formatItem:e.formatItem}),o=e.renderFactory.getTemplate("modal-footer-done"),l=$.fasttmpl(o,{});e.getControl().mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),orientation:e.properties.orientation||"",contentTemplate:n,footerTemplate:l,style:"width: 80%; height: 70%",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(){e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.configureModalViewHandlers(t)}})})},configureModalViewHandlers:function(e){var t=this,i=$(".bz-checkbox-list li",e.content),a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);r.on("change keyup",function(){""==this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)}).on("focus",function(){e.header.addClass("bz-modal-view__header--active")}).on("blur",function(){e.header.removeClass("bz-modal-view__header--active")}),a.on("click",function(){r.val("").trigger("change")}),$("[data-action=close]",e.header).on("click",function(){e.close()}),$(e.footer).on("click","[data-action=save]",function(a){var r=[];$.each.call(this,i,function(e,t){var i=t.querySelector("input");if(i.checked){var a=i.getAttribute("data-id"),n=this.findItemById(a).value;r.push({id:a,value:n})}}.bind(t)),t.setDisplayValue(r),e.close()})}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.association",bizagi.rendering.association.prototype),bizagi.rendering.tablet.association.extend("bizagi.rendering.tablet.association",{},{renderControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=new $.Deferred;return e.properties.property="flipped",e.properties.idRender=e.properties.id,$.when(e.getFlipAssociation()).done(function(a){e.makeJsonBase(),e.properties.flipped=bizagi.util.parseBoolean(a)||!1;var r=e.getColumnData(),n=$.fasttmpl(t,$.extend(e.properties,{columnData:r}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation});e.setValue(JSON.encode(e.properties.formatJson)),i.resolve(n)}),i.promise()},getColumnData:function(){var e=this,t=e.properties,i=[];e.data=t;var a=t.flipped?t.rightData:t.leftData;return $.each(a,function(t,a){i.push({id:a.id,value:a.value,association:e.getRightAssociation(a.id)})}),i},postRender:function(){var e=this,t="execution"===e.getMode(),i=e.getControl();e.association=$(".bz-association",i),t&&e.addEventControl(),e.showDefaultGroupList()},showDefaultGroupList:function(){var e=this.getControl(),t=$(".bz-association-group",e);t.length>0&&($("[data-action='collapse']",t[0]).toggleClass("bz-icn--expanded"),$(".bz-association-group__list",t[0]).slideDown(300,function(){$(this).toggleClass("bz-association-group__list--hidden")}))},addEventControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=e.getControl();e.association.on("change","input:checkbox",function(){var t=$(this),i=t.data("parent-id"),a=t.data("id");t.prop("checked")?e.addElement(i,a):e.removeElement(i,a)}),e.association.find("[data-action='flip']").click(function(){$(i).empty(),e.properties.flipped=!e.properties.flipped,e.properties.flipstate=e.properties.flipped,e.dataService.getFlipAssociation(e.properties);var a=e.getColumnData();$($.fasttmpl(t,$.extend(e.properties,{columnData:a}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation})).appendTo(i),e.postRender()}),e.association.on("click","[data-action='collapse']",function(){var t=$(this),i=t.parents(".bz-association-group").find(".bz-association-group__list");e.closeAccordionSection(),i.hasClass("bz-association-group__list--hidden")&&(t.toggleClass("bz-icn--expanded"),i.slideDown(300,function(){$(this).toggleClass("bz-association-group__list--hidden")}))})},closeAccordionSection:function(e){var t=this.getControl();$("[data-action='collapse']",t).removeClass("bz-icn--expanded"),$(".bz-association-group__list",t).slideUp(300,function(){$(this).addClass("bz-association-group__list--hidden")})},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.postRender()},setDisplayValue:function(e){this.setValue(e,!1)},getLabel:function(){if(!this.label){var e=$("> .bz-form-label",this.element||this.observableElement);return e.length>0&&(this.label=e),e}return this.label}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.ecm",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.ecm.prototype),bizagi.rendering.tablet.ecm.extend("bizagi.rendering.tablet.ecm",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"],ERROR_ECM_NO_AVAILABLE:3,ACTION_DETAILS:"details",ACTION_EDIT:"edit"},{isNative:!1,initializeData:function(e){this._super(e),this.isNative=bizagi.util.isCordovaSupported(),this.fileData=[]},renderControl:function(){var e=this.renderFactory.getTemplate("ecm");return this.files=this.properties.value||[],this.filesCount=this.files.length,this.renderItem(e,{})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("ecm-readonly"),t={noFiles:0===this.filesCount};return this.renderItem(e,t)},renderItem:function(e,t){for(var i="",a=$.fasttmpl(e,t),r=0;r<this.filesCount;r++){i+=this.renderUploadItem(this.files[r])}return a=this.replaceFilesHtml(a,i)},renderUploadItem:function(e){var t=this,i=t.renderFactory.getTemplate("ecm-item"),a=t.getFormContainer(),r={id:t.properties.id,idFileUpload:e[0],fileName:e[1],editable:t.properties.editable,xPath:t.properties.xpath,xpathContext:t.getXpathContext()||a.properties.xpathContext||"",idPageCache:t.properties.idPageCache,idAttrib:t.properties.idAttrib,sessionId:a.properties.sessionId},n=$.extend({},r);return r.url=t.buildItemUrl(n),e.getFileProperties=$.when(t.renderFileLayout(r)),$.fasttmpl(i,r)},renderFileLayout:function(e){var t=this,i=t.getFormContainer(),a=new $.Deferred,r=$.extend({},e);return $.when(t.dataService.metadataECMMultiaction().getECMMetadata(e),t.dataService.metadataECMMultiaction().getFileProperties(r)).done(function(n,o){Array.isArray(o)&&(o=o[0]),Array.isArray(n)&&(n=n[0]),o.idAttrib=t.properties.idAttrib,o.showMetadata=t.properties.showMetadata,o.xpathContext=t.getXpathContext()||i.properties.xpathContext||"",o.xpath=t.properties.xpath,o.fileName=e.fileName,o.idPageCache=t.properties.idPageCache,o.fileData=r;var l=$.extend({},o,n);a.resolve(l)}),a.promise()},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},postRender:function(){var e=this.getControl();this.$contentFile=$(".bz-file-upload__container",e),this.$inputFile=$(".bz-file-upload__input",e),this.$nativeFile=$(".bz-file-upload__native",e)},configureHandlers:function(){this.checkFileExtensions(),this.attachEvents()},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-readonly-lists",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})})},saveImage:function(){var e=this,t="";e.editedImageURL?t=e.editedImageURL:e.fileProperties&&(t=e.fileProperties.url);var i={dataFile:bizagi.util.media.getImagePath(t),fileName:e.fileProperties.name,mimeType:"image/jpeg"};return e.editedImageURL=null,e.fileProperties=null,this.uploadFile(i)},saveVideo:function(e){var t={dataFile:e[0].fullPath,fileName:e[0].name,mimeType:"video/quicktime"};return this.uploadFile(t)},uploadFile:function(e){var t=this,i={},a=t.buildAddParams();return a.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),a.xPath=a.xPath,a.Filename=e.fileName,i.data=a,i.options=new FileUploadOptions,i.options.fileKey="file",i.options.fileName=e.fileName,i.options.uploadKey={key:"Filedata"},i.options.addUrl=t.properties.addUrl,i.dataFile=e.dataFile,e.mimeType&&(i.options.mimeType=e.mimeType),$.when(bizagi.util.media.uploadFile(i)).then(function(e){t.onUploadFileCompleted(JSON.parse(decodeURIComponent(e.response)))}).fail(function(e){t.executeFormFailHandler(e)})},attachEvents:function(){var e=this,t=e.getControl();$.each(e.files,function(t,i){e.attackMenuEvents(i)}),this.$contentFile.off("click").on("click",function(t){e.chooseFile()}),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})}),e.isNative?(this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-file-upload__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),$.when(e.handlerResolutionUpload(t.guid)).always(function(){bizagi.loading.stop()})},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})):(this.$inputFile.off("change").on("change",function(){e.addFile(),this.value=""}),this.$inputFile.off("click").on("click",function(e){e.stopPropagation()}))},addMenuEvents:function(e,t){var i=this,a=e.find(".bz-file-menu"),r=[];t.showMetadata&&r.push({name:i.getResource("render-collection-navigator-details-form"),fn:function(){i.processActionByType(i.Class.ACTION_DETAILS,t,e)}}),t.showMetadata&&t.allowUpdateMetadata&&r.push({name:i.getResource("render-collection-navigator-edit-form"),fn:function(){i.processActionByType(i.Class.ACTION_EDIT,t,e)}}),t.allowCheckOut&&r.push({name:i.getResource("render-ecm-bt-lock"),fn:function(){i.lockECMFile(e,t)}}),t.allowCancelCheckOut&&r.push({name:i.getResource("render-ecm-bt-unlock"),fn:function(){i.unlockECMFile(e,t)}}),t.allowDelete&&r.push({name:i.getResource("render-ecm-bt-delete"),fn:function(){i.deleteECMFile(e,t.idFileUpload)}}),a.overflowMenu({items:r})},deleteECMFile:function(e,t){var i=this;bizagi.showConfirmationBox(this.getResource("render-ecm-confirm-message")).done(function(){$.when(i.deleteUploadItem(e,t)).done(function(){e.hide(),e.remove(),i.setValue(i.files,!1),i.checkMaxFiles(),i.triggerRenderChange()})})},checkMaxFiles:function(){this.isMaxFilesReached()?$(this.$contentFile).addClass("bz-file-upload__container--hidden"):$(this.$contentFile).removeClass("bz-file-upload__container--hidden")},isMaxFilesReached:function(){var e=this.properties.maxfiles,t=this.properties.value?this.properties.value.length:0;return 0!==e&&this.filesCount>=e&&t>=e},executeFormFailHandler:function(e){var t="";t=e&&e.code===this.Class.ERROR_ECM_NO_AVAILABLE?this.getResource("render-ecm-service-not-available"):e&&e.responseText?e.responseText:this.getResource("render-ecm-service-general-error"),this.getFormContainer().failHandler(t)},lockECMFile:function(e,t){var i=this;$.when(i.lockUploadItem(t.idFileUpload)).done(function(a){var r=[a.idFileUpload,t.fileName],n=i.renderUploadItem(r);e.replaceWith(n),i.attackMenuEvents(r)})},unlockECMFile:function(e,t){var i=this;$.when(i.unlockUploadItem(t.idFileUpload)).done(function(a){var r=[a.idFileUpload,t.fileName],n=i.renderUploadItem(r);e.replaceWith(n),i.attackMenuEvents(r)})},chooseFile:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&this.$inputFile.click()},checkFileExtensions:function(){var e=this,t=e.properties.validExtensions||"";if(e.validOptions={video:!1,image:!1,file:!1},void 0===(t=t.replace(/\s+/g,"").toLowerCase())||""===t)e.validOptions={video:!0,image:!0,file:!0};else if(1===(t=t.split(";")).length&&-1!==t[0].indexOf("*.*"))e.validOptions.video=!0,e.validOptions.image=!0;else for(var i=0,a=t.length;i<a;i++)t[i]=t[i].replace("*.",""),e.Class.EXTENSIONSFILE.toString().indexOf(t[i])>=0?e.validOptions.file=!0:e.Class.EXTENSIONSIMG.toString().indexOf(t[i])>=0?e.validOptions.image=!0:e.Class.EXTENSIONSVIDEO.toString().indexOf(t[i])>=0&&(e.validOptions.video=!0);e.validOptions.file||e.validOptions.image||e.validOptions.video||$(e.$contentFile).addClass("bz-file-upload__container--hidden"),(e.isMaxFilesReached()||!e.isNative&&!bizagi.util.media.fileAPISupported())&&$(this.$contentFile).addClass("bz-file-upload__container--hidden")},getUploadChoices:function(){var e=[];return this.validOptions.image&&(e.push({guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}),e.push({guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")})),this.validOptions.video&&e.push({guid:3,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-video")}),[].concat(e)},handlerUploadFile:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture(function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then(function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i)){if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then(function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.handlerResolutionUpload(e)});$(".bz-file-upload__resolution",t.getControl()).click()}})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY});break;case 1:navigator.camera.getPicture(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then(function(i){return t.fileProperties=i,t.saveImage(e)})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;case 3:navigator.device.capture.captureVideo(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSizeVideo(e,t.properties)).then(function(){return t.saveVideo(e)}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{limit:t.Class.LIMIT})}},onFail:function(e){var t=bizagi.util.processFailMessage(e);if(bizagi.loading.stop(),t&&"string"==typeof t&&-1!==t.indexOf("No Activity found to handle Intent")){var i=bizagi.util.isValidResource("render-upload-error-media-app")?bizagi.localization.getResource("render-upload-error-media-app"):"Your device does not have an app to execute this action.";self.performValidationMessage(i)}},performValidationMessage:function(e){var t=bizagi.util.processFailMessage(e);bizagi.showMessageBox(t)},handlerResolutionUpload:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.saveImage(t.dataImage);var a=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,a)).then(function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.saveImage(t.dataImage)})},addFile:function(){var e=this,t=this.$inputFile[0].files[0],i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSFILE,e.Class.EXTENSIONSVIDEO);t.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.processUploadFile(t)).done(function(t){bizagi.util.isFailResponse(t)?e.performValidationMessage(t):e.onUploadFileCompleted(JSON.parse(decodeURIComponent(t)))}).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()}):bizagi.loading.stop()},buildAddFileParams:function(e){var t=this,i=t.Class.BA_CONTEXT_PARAMETER_PREFIX,a=new FormData,r=t.getFormContainer(),n=t.buildAddParams();Object.keys(n).map(function(e){a.append(e,n[e])}),a.append("Filedata",e),a.append("Filename",e.name.substr(e.name.replace(/([\\\/]+)/g,"/").lastIndexOf("/")+1)),a.append(t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",r.properties.sessionId),t.properties.contexttype&&a.append(i+"contexttype",t.properties.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?a.append(BIZAGI_SESSION_NAME,r.properties.sessionId):a.append("JSESSIONID",r.properties.sessionId)}catch(e){a.append("JSESSIONID",r.properties.sessionId)}return a},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},onUploadFileCompleted:function(e){var t=this,i=$(".bz-files",t.getControl());if(e.idFileUpload&&e.fileName){var a=[e.idFileUpload,e.fileName],r=t.renderUploadItem(a);i.append(r);var n=t.files.slice();n.push(a),t.setValue(n,!0),t.checkMaxFiles(),t.attackMenuEvents(a),t.editedImageURL=null}else t.performValidationMessage(e.message)},attackMenuEvents:function(e){var t=this,i=t.getControl();e&&e.getFileProperties&&$.when(e.getFileProperties).done(function(e){var a=$("."+t.properties.id+"-"+e.idFileUpload,i);t.fileData[e.idFileUpload]=e.metadata||[],t.addMenuEvents(a,e)})},processActionByType:function(e,t,i){var a=this,r=a.properties,n=a.getFormContainer();bizagi.loading.start(),new bizagi.rendering.tablet.slide.ecm(a.dataService,a.renderFactory,{title:a.properties.displayName||"",container:n.container,navigation:a.getParams().navigation,editable:r.editable&&e!==a.Class.ACTION_DETAILS,orientation:r.orientation||"ltr",onSave:function(e){if(e.update){var t=[e.idFileUpload,e.fileName],r=a.renderUploadItem(t);i.replaceWith(r),a.attackMenuEvents(t)}},onCancel:function(){}}).render({metadata:t.metadata,fileData:t}).always(function(){bizagi.loading.stop()})}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.searchList",bizagi.rendering.searchList.prototype),bizagi.rendering.tablet.searchList.extend("bizagi.rendering.tablet.searchList",{SEARCH_MIN_LENGTH:2,SEARCH_MAX_RECORDS:50,SEARCH_DELAY:250,SEARCH_ELEMENTS:{}},{renderControl:function(){var e=this,t=e.properties,i=e.renderFactory.getTemplate("searchList");return $.fasttmpl(i,{id:t.id,value:t.value.map(function(t){return e.formatItem(t.value)}).join(", ")})},postRender:function(){this.searchListInput=$(".bz-search-list__input",this.getControl())},postRenderReadOnly:function(){this.searchListInput=$(".bz-search-list__input",this.getControl())},renderReadOnly:function(){var e=this.renderFactory.getTemplate("searchList.readonly");return $.fasttmpl(e,{items:this.properties.value||{},editable:this.properties.editable||!0},{formatItem:this.formatItem})},configureHandlers:function(){var e=this;e.searchListInput.on("click",function(t){($(t.target).parent()||{}).hasClass("bz-pill")||e._searchListViewModal()})},_searchListViewModal:function(){var e=this,t=e.getHeaderTemplate(),i=e.getContentTemplate(),a=e.getFooterTemplate();e.searchListInput.mobileView({customHeader:t,orientation:e.properties.orientation||"",cssClassHeader:"bz-modal-view__header-multiple",contentTemplate:i,footerTemplate:a,style:"width: 80%; height: 70%",close:function(){$(window).unbind("resize"),e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(){e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.adjustResize(),e.configureModalViewHandlers(t)}})},setDisplayValue:function(e){var t=this,i="string"==typeof e?JSON.parse(e).value:e.value;t.setValue(i),void 0!==e&&t.properties.editable&&t.searchListInput.html(i.map(function(e){return t.formatItem(e.value)}).join(", "))},deleteItem:function(e){var t=e.parent("div");this.removeElement({id:t.data("id")}),t.remove()},selectItem:function(e){var t=this.getTagTemplate(e,this.properties.editable);this.modalViewTagList.append(t)},configureModalViewHandlers:function(e){var t=this,i=e.footer,a=e.header,r={};if(t.hasValue()){var n=t.getListItems();$.each(n,function(e,t){r[t.id]=t})}t.modalViewList=$(".bz-list",e.content),t.modalViewTagList=$(".bz-search-pill__results",a);var o=$(".bz-modal-view__clear",a),l=$(".bz-modal-view__search",a),s=bizagi.util.debounce(function(){""===this.value?o.removeClass("bz-modal-view__clear--visible"):o.addClass("bz-modal-view__clear--visible"),t.autoCompleteSearchResults($.trim(this.value))},this.Class.SEARCH_DELAY);l.on("change keyup",s).on("focus",function(){e.header.addClass("bz-modal-view__header--active")}).on("blur",function(){e.header.removeClass("bz-modal-view__header--active")}),o.bind("click",function(){l.val("").trigger("change")}),$("[data-action=close]",e.header).bind("click",function(){e.close()}),t.modalViewList.on("click","li",function(){var e=$.data(this).item;!e||e&&r[e.id]||(r[e.id]=e,$(i).find(".bz-btn").removeClass("bz-btn--secundary"),$(i).find(".bz-btn").addClass("bz-btn--primary"),1===(Object.keys(r)||[]).length&&$(a).find(".bz-search-pill__selected ").removeClass("bz-search-pill__selected--hidden"),t.selectItem(e))}),t.modalViewTagList.on("click",".bz-pill > .bz-btn-icn",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parent("div");$(i).find(".bz-btn").removeClass("bz-btn--secundary"),$(i).find(".bz-btn").addClass("bz-btn--primary"),delete r[t.data("id")],t.remove(),0===(Object.keys(r)||[]).length&&$(a).find(".bz-search-pill__selected ").addClass("bz-search-pill__selected--hidden")}),$(i).delegate("[data-action=save]","click",function(i){var a=[];$.each(r,function(e,t){a.push(t)}),t.setDisplayValue({value:a}),e.close()})},autoCompleteSearchResults:function(e){var t=this;$.when(t.processRequest({term:e})).done(function(e){t.modalViewList.find("li").remove();for(var i=0,a=e.length;i<a;i++){t.renderSearchItem(e[i]).appendTo(t.modalViewList)}})},renderSearchItem:function(e){var t=this.renderFactory.getTemplate("searchList.item"),i=$.tmpl(t,{id:e.id,label:e.label,value:this.formatItem(e.value)});return i.data("item",e),i},processRequest:function(e){var t=this,i=t.properties,a=new $.Deferred,r=[];return e.term.length>=this.Class.SEARCH_MIN_LENGTH?(i.term=e.term,t.deferredReference&&"function"==typeof t.deferredReference.reject&&"resolved"!==t.deferredReference.state()&&t.deferredReference.reject({hideStatus:!0}),t.deferredReference=t.getData().done(function(n){n&&n.length>0?((n=n.slice(0,i.maxRecords)).length>t.Class.SEARCH_MAX_RECORDS?(n=n.slice(0,t.Class.SEARCH_MAX_RECORDS),r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-search-maximum-records-allowed"),value:""})):n=n.slice(0,i.maxRecords),$.each(n,function(t,a){if(0===i.maxRecords||t<i.maxRecords){var n=bizagi.util.highlightMatches(a,e.term);r.push({id:a.id,label:n,value:a.value})}})):r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-grid-no-records"),value:""}),a.resolve(r)}).fail(function(){a.reject()})):a.resolve(r),a.promise()},getContentTemplate:function(){var e=this.getValue(),t="string"==typeof e?JSON.parse(e).value:e.value,i=this.renderFactory.getTemplate("searchList.items"),a=$.fasttmpl(i,{items:t||{},editable:this.properties.editable||!0},{formatItem:this.formatItem});return $.trim(a)},getFooterTemplate:function(){var e=this.renderFactory.getTemplate("searchList.actions"),t=$.fasttmpl(e,{items:this.properties.value||{},editable:this.properties.editable||!0});return $.trim(t)},getTagTemplate:function(e,t){var i=this.renderFactory.getTemplate("searchList.tag"),a=$.fasttmpl(i,{id:e.id,label:e.label,value:this.formatItem(e.value),editable:t});return $.trim(a)},adjustResize:function(){var e=window.innerHeight;$(window).off("resize").on("resize",bizagi.util.debounce(function(){$(this).height()<e?$(".bz-mobile-view__footer_content").addClass("bz-hidden"):$(".bz-mobile-view__footer_content").removeClass("bz-hidden")},this.Class.SEARCH_DELAY))},getHeaderTemplate:function(){var e=this.getValue(),t="string"==typeof e?JSON.parse(e).value:e.value,i=this.renderFactory.getTemplate("searchList-modal-header"),a=$.fasttmpl(i,{items:t||{},editable:this.properties.editable||!0,emptyItems:0===(t||[]).length},{formatItem:this.formatItem});return $.trim(a)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.userfieldWrapper",bizagi.rendering.userfieldWrapper.prototype),bizagi.rendering.tablet.userfieldWrapper.extend("bizagi.rendering.tablet.userfieldWrapper",{},{getUserfieldControl:function(){var self=this,sControl=self.userfieldName,mode=self.getMode(),exists="execution"!==mode||eval("bizagi.rendering.tablet."+sControl+" !== undefined"),def=new $.Deferred;return exists?$.when(self.parent.ready()).done(function(){def.resolve(self.createUserfieldInstance(sControl))}):$.when(self.dataService.getUserfieldDefinition({userfield:self.userfieldGuid,device:"tablet"})).pipe(function(e){self.loadUserfield(e),def.resolve(self.createUserfieldInstance(sControl))}),def.promise()},createUserfieldInstance:function(sControl){var self=this,control;try{var dynamicFunction="var baDynamicFn = function(renderParams){ \r\n";dynamicFunction+="return new bizagi.rendering.tablet."+sControl+"(renderParams);\r\n",dynamicFunction+="}\r\n",dynamicFunction+="baDynamicFn",dynamicFunction=eval(dynamicFunction),control=dynamicFunction(self.initialParams)}catch(e){control=self.getUserFieldInstance(self.initialParams)}return control.properties.isUserField=!0,self.userfieldInstance=control,self.replicateUserfieldMethods(control),self.userfieldInstance.bind("renderchange",function(){self.triggerHandler("renderchange",arguments)}),control},loadUserfield:function(data){var self=this;self.properties.styleGuid=self.properties.styleGuid||Math.guid();try{try{data=eval(data)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}$.each(data,function(e,t){if("js"==t.type)try{t.content=t.content.replace(/bizagi\.rendering\.[^\s]+\.extend(\s|\n|\s)*\((\s|\n|\s)*\"bizagi\.rendering\.[^\s]+\"/gim,function(e){return e.replace(/bizagi.rendering/gi,"bizagi.rendering.tablet")}),window.eval(t.content)}catch(e){bizagi.log("Could not parse result userfield3 "+self.userfieldName,e.message)}"css"==t.type&&bizagi.util.loadStyle(t.content,self.properties.styleGuid)});var control=eval("bizagi.rendering."+self.userfieldName)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}},getUserFieldInstance:function(e){return"execution"===this.getMode()?new bizagi.rendering.tablet.defaultUserField(e):new bizagi.rendering.tablet.designUserField(e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.basicUserField",bizagi.rendering.userfieldDefinition.prototype),bizagi.rendering.tablet.basicUserField.extend("bizagi.rendering.tablet.basicUserField",bizagi.rendering.basicUserField.prototype),bizagi.rendering.tablet.basicUserField.extend("bizagi.rendering.tablet.basicUserField",{},{init:function(e){(this._super(e),this.isSupported())||this.getFormContainer().addError(this.getResource("render-tablet-error-userfield"))},getEditableControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getEditableControl.apply(this,arguments)},getReadonlyControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getReadonlyControl.apply(this,arguments)},isSupported:function(){return!0}}),bizagi.rendering.tablet.basicUserField.extend("bizagi.rendering.tablet.defaultUserField",{},{getEditableControl:function(){var e=this,t=e.getControl(),i=e.properties.control.replace(/column/g,"");return e.input=$("<label>Userfield: "+i+" not found</label>").appendTo(t),e.input.addClass("ui-bizagi-render-userfield-notSupported"),e.input},getReadonlyControl:function(){return this.getEditableControl()},collectData:function(e){}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.image.prototype),bizagi.rendering.tablet.image.extend("bizagi.rendering.tablet.image",{QUALITY_PICTURE:80,EXTENSIONSIMG:["jpeg","jpg","png"]},{$inputFile:null,isNative:!1,isOfflineForm:!1,initializeData:function(e){if(this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported(),this.isOfflineForm){var t=Number(this.properties.maxSize)||1048576,i="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;this.properties.maxSize=t<i?t:i}},renderControl:function(){var e=this.renderFactory.getTemplate("image");return $.fasttmpl(e,{url:""})},getElementsToStylize:function(e){return $({})},renderReadOnly:function(){var e=this,t=this.renderFactory.getTemplate("image-readonly"),i=new $.Deferred;return $.when(e.buildItemUrl()).done(function(a){var r=a||"";if(!e.isDisposed()){e.properties.url=r,e.properties.value=r.length>0?[r]:null,e.setValue(e.properties.value);var n=$.fasttmpl(t,{url:e.properties.url});i.resolve(n)}}),i.promise()},postRender:function(){var e=this.getControl();this.$inputFile=$(".bz-image__input",e),this.$nativeFile=$(".bz-image__native",e),this.isDesignMode()||this.showAsyncImage()},configureHandlers:function(){var e=this,t=this.getControl();t.on("click","[data-action=upload]",function(t){e.choosePhoto()}),this.isNative?(this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){switch(t.guid){case 1:e.imageAdd();break;case 2:e.imageAdd(!0)}},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-image__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),$.when(e.resolutionButtonHandler(t.guid)).always(function(){bizagi.loading.stop()})},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})):(this.$inputFile.off("change").on("change",function(){e.imageAdd(),this.value=""}),this.$inputFile.off("click").on("click",function(e){e.stopPropagation()}))},configureHandlersReadOnly:function(){var e=this;this.getControl().on("click",".bz-image",function(){e.imagePreview()})},imageAdd:function(e){var t=this;if(this.isNative){var i={quality:t.Class.QUALITY_PICTURE,targetWidth:1280,targetHeight:960,correctOrientation:!0};if(!e){var a=t.getControl()[0].getBoundingClientRect();i={quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,popoverOptions:new CameraPopoverOptions(a.left,a.top-20,200,100,4),destinationType:navigator.camera.DestinationType.FILE_URI,correctOrientation:!0}}navigator.camera.getPicture(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then(function(i){if(bizagi.util.media.checkFileTypes(i,t.properties,t.Class.EXTENSIONSIMG)){t.dataImage=e,t.fileProperties=i;var a=bizagi.util.getAndroidVersion();if(a&&a<=4.2||t.isOfflineForm)return $.when(t.performUploadFile(t.dataImage)).always(function(){bizagi.loading.stop()});if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then(function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.resolutionButtonHandler(e)});$(".bz-image__resolution",t.getControl()).click()}})}).always(function(){bizagi.loading.stop()})},t.onFail,i)}else{var r=this.Class.EXTENSIONSIMG,n=this.$inputFile[0].files[0];n.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(n,t.properties)&&bizagi.util.media.checkFileTypes(n,t.properties,r)?$.when(t.performUploadFile(n)).always(function(){bizagi.loading.stop()}):bizagi.loading.stop()}},onFail:function(e){bizagi.loading.stop()},imageDelete:function(){var e=this;bizagi.showConfirmationBox(e.getResource("render-grid-delete-confirmation")).done(function(){bizagi.loading.start(),$.when(e.dataService.deleteImage({url:e.properties.deleteUrl,idRender:e.properties.id,xpath:e.properties.xpath,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,contexttype:e.properties.contexttype})).done(function(){e.uploadFileCompleted()}).fail(function(t){var i,a=t.responseText;try{i=(i=JSON.parse(a)).message||a}catch(e){i=a}e.setValidationMessage(i)}).always(function(){bizagi.loading.stop()})})},uploadFile:function(e){var t=this,i=new $.Deferred;if(this.isOfflineForm)t.saveImageOffline(e,i),t.canBeSent=function(){return $.forceCollectData=!0,!0};else if(this.isNative){var a={},r=t.buildAddParams(),n=t.fileProperties.name;t.editedImageURL?a.dataFile=t.editedImageURL:t.fileProperties&&(a.dataFile=t.fileProperties.url),r.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),a.data=r,a.options=new FileUploadOptions,a.options.fileKey="file",a.options.fileName=n,a.options.mimeType="image/jpeg",a.options.uploadKey={key:r.h_xpath},a.options.addUrl=t.properties.addUrl,t.editedImageURL=null,t.fileProperties=null,a.dataFile=bizagi.util.media.getImagePath(a.dataFile),$.when(bizagi.util.media.uploadFile(a)).done(function(e){"error"===(e=JSON.parse(decodeURIComponent(e.response))).type?i.reject(e):i.resolve(e)}).fail(function(e){i.reject(e)})}else bizagi.util.media.checkMaxSizeFile(e,t.properties)&&bizagi.util.media.checkFileTypes(e,t.properties,t.Class.EXTENSIONSIMG)?t.dataService.processUploadFile({url:t.properties.addUrl,formData:t.buildAddFileParams(e)}).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)}):i.reject();return i.promise()},uploadFileCompleted:function(){try{this.showAsyncImage(),this.editedImageURL=null}catch(e){this.getFormContainer().refreshForm()}},showAsyncImage:function(){var e=this,t=e.getControl(),i=$(".bz-input-icon",t);$.when(e.renderUploadItem()).done(function(t){if(!e.isDisposed()){i.empty(),i.append(t);var a=e.hasValue()?"update":"upload";i.attr("data-action",a),e.setValue(e.properties.value),e.hasValue()&&e.configureMenu()}})},resolutionButtonHandler:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.performUploadFile(t.dataImage);var a=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,a)).then(function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.performUploadFile(t.dataImage)})},imagePreview:function(){var e=this,t=e.getParams(),i=t.navigation.createRenderContainer({title:e.properties.displayName,view:{zoom:!0,useNativeScrolling:!1}}),a=e.renderFactory.getTemplate("image-preview"),r={url:e.value&&""!==e.value[0]?e.value[0]:""},n=$.fasttmpl(a,r);i.element.css("display","none"),e.inputEdition=i.element.html(n),t.navigation.navigate(i.id),e.isOfflineForm&&i.element.on("close",e.onPreviewActionBack.bind(e)),bizagi.loading.start(),$.when(e.buildFullItemUrl()).done(function(t){if(i.element.css("display","block"),t.indexOf("error")<0){var a=$(".bz-image__preview-item:first",i.element).attr("src",t),r=a.css("width");r=Number(r.substring(0,r.length-2)),-1!==e.properties.width&&e.properties.width<r&&a.css("width","100%")}}).always(function(){bizagi.loading.stop()})},buildAddFileParams:function(e){var t=this,i=t.properties,a=t.Class.BA_CONTEXT_PARAMETER_PREFIX,r=new FormData,n=t.getFormContainer();r.append(a+"xpath",i.xpath),r.append(a+"idRender",i.id),r.append(a+"xpathContext",i.xpathContext),r.append(a+t.Class.BA_PAGE_CACHE,i.idPageCache),r.append(t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",n.properties.sessionId),r.append(a+"action","savefile"),r.append(t.properties.xpath,e),i.contexttype&&r.append(a+"contexttype",i.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?r.append(BIZAGI_SESSION_NAME,n.properties.sessionId):r.append("JSESSIONID",n.properties.sessionId)}catch(e){r.append("JSESSIONID",n.properties.sessionId)}return r},executeFormFailHandler:function(e){var t=e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error");this.getFormContainer().failHandler(t)},performUploadFile:function(e){var t=this;return $.when(t.uploadFile(e)).done(function(e){t.uploadFileCompleted()}).fail(function(e){t.executeFormFailHandler(e)})},choosePhoto:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&this.$inputFile.click()},configureMenu:function(){var e=this,t=[],i=this.getControl(),a=$(".bz-input-icon__input + .bz-icn",i),r=!e.isOfflineForm&&(e.properties.allowDelete&&e.properties.editable);t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-image-preview"),fn:function(){e.imagePreview()}}),t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo"),fn:function(){e.choosePhoto()}}),r&&t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-remove-photo"),fn:function(){e.imageDelete()}}),a.overflowMenu({items:t})},getUploadChoices:function(){return[{guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")},{guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}]},buildItemUrl:function(e){var t=this;if(t.isOfflineForm)return t.buildItemUrlOffline(e);var i=t.properties,a=new $.Deferred,r="";if(this.isExecutionMode()){var n={url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,property:e&&e.property?e.property:"fileContent",dataType:"text"};i.contexttype&&(n.contexttype=i.contexttype),i.isUserPreference&&(t.currentUser=bizagi.currentUser.idUser,n.xpathContext="@Context.Users[id == "+t.currentUser+"]",n.contexttype="entity",n.surrogatekey=t.currentUser),t.dataService.multiaction().getPropertyData(n,"text").done(function(e){'"'===e.charAt(0)&&(e=e.slice(1,-1)),""!==e&&(r="data:image/png;base64,"+e),a.resolve(r)})}else r="",a.resolve(r);return a.promise()},onPreviewActionBack:function(e){var t=$(".bz-image__preview-item",e.target).attr("src")||"",i=t.length>0?[].concat(t):null;this.setValue(i)},collectData:function(e){if(this.isOfflineForm&&bizagi.util.isOfflineFormsV2Supported()&&this.controlValueIsChanged()){var t=this.properties.xpath;this.getValue();bizagi.util.isEmpty(t)||(e[t]="*")}else this._super(e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.document",bizagi.rendering.document.prototype),bizagi.rendering.tablet.document.extend("bizagi.rendering.tablet.document",{ACTION_SHOW:"show",ACTION_DOWNLOAD:"download",ACTION_DELETE:"delete"},{renderControl:function(){var e=this.renderFactory.getTemplate(this.getTemplate()),t=this.properties.value||[],i={downloadalldocuments:this.properties.downloadalldocuments,allowgenerate:this.properties.allowGenerate,noFiles:!t||0===t.length,append:this.properties.append,caption:this.properties.caption},a=$.fasttmpl(e,i),r=this.renderDocumentsHtml(t);a=this.replaceFilesHtml(a,r);var n=this.renderActionsHtml(t,i.noFiles,i.downloadalldocuments);return a=this.replaceActionsHtml(a,n)},postRender:function(){var e=this.getControl();this.$inputDocument=$(".bz-document-template__container",e),this.$listDocuments=$("[data-component=files]",e),this.$listActions=$("[data-component=actions]",e),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate(this.getTemplateReadonly()),t=this.properties.value||[],i=!t||0===t.length,a=$.fasttmpl(e,{noFiles:i}),r=this.renderDocumentsHtml(t);return a=this.replaceFilesHtml(a,r)},postRenderReadOnly:function(){var e=this.getControl();this.$listDocuments=$("[data-component=files]",e)},configureHandlers:function(){var e=this;this.$inputDocument.on("click",function(t){e.properties.buttonExecuted=!0,e.properties.validate?e.validateContainer()&&e.documentTemplateGenerate():e.documentTemplateGenerate(),e.properties.buttonExecuted=!1}),this.$listDocuments.on("click","[data-action]",function(t){var i=$(this),a=i.parent(".bz-document").data(),r=i.data("action");e.processAction(r,a)}),e.$listActions.on("click","[data-action]",function(t){var i=$(this),a=i.parent(".bz-document__download").data(),r=i.data("action");e.processAction(r,a)})},configureHandlersReadOnly:function(){var e=this;this.$listDocuments.on("click","[data-action]",function(t){var i=$(this),a=i.parent(".bz-document").data(),r=i.data("action");e.processAction(r,a)})},renderAllDocumentDownload:function(e){var t=this.renderFactory.getTemplate(this.getTemplateDownload()),i=this.buildAllDocumentsUrl();return this.isExecutionMode()||(i="javascript:void(0);"),$.fasttmpl(t,{url:i,filename:e.fileName,joined:!0})},redrawDocuments:function(e,t,i){var a=this.getControl(),r=$("[data-component='files']",a),n=$("[data-component='actions']",a);r.empty(),n.empty();var o=this.renderDocumentsHtml(e);r.append(o);var l=this.renderActionsHtml(e,t,i);n.append(l),this.setValue(e)},showDocumentPreview:function(e,t){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(e,t)).fail(function(e){e.responseText&&self.getFormContainer().failHandler(e.responseText)}).always(function(){bizagi.loading.stop()})},resolveDocumentTemplateGenerate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e},resolveDeleteDocumentTemplate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e},processAction:function(e,t){e===this.Class.ACTION_DELETE?this.deleteDocumentTemplate(t.filename):e===this.Class.ACTION_SHOW?this.showDocumentPreview(t.url,t.filename):e===this.Class.ACTION_DOWNLOAD&&this.showDocumentPreview(t.url,t.filename)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.geolocation",bizagi.rendering.geolocation.prototype),bizagi.rendering.tablet.geolocation.extend("bizagi.rendering.tablet.geolocation",{ALLOW_UPDATE:"update"},{postRender:function(){var e=this.getControl();this.coordinate=e.find("input"),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.coordinate=e.find("input"),this._super()},configureHandlers:function(){var e=this,t=e.getControl();null==e.value&&e.updateDisplayValue(),t.on("click","[data-action="+e.Class.ALLOW_UPDATE+"]",e.processAction.bind(e))},setDisplayValue:function(e){var t=this,i=new $.Deferred;if(null!=e&&""!==e)t.coordinate&&t.coordinate.val(t.performPrecision(e)),t.setValue(e,!1),i.resolve();else{var a=function(e){var a=e.coords.latitude+" "+e.coords.longitude;t.coordinate.val(t.performPrecision(a)),t.setValue(a,!1),i.resolve()},r=function(e){i.reject(e)};bizagi.util.isCordovaSupported()&&bizagi.util.isiOSDevice()?navigator.geolocation.getCurrentPosition(a,r):t.getCurrentPosition(a,r)}return i.promise()},updateDisplayValue:function(){var e=this;e.setDisplayValue().then(function(){e.setValidationMessage("")}).fail(function(t){e.coordinate.val(""),e.setValidationMessage(t)})},processAction:function(){this.coordinate.empty(),this.updateDisplayValue()},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".readonly-control",e)}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.actionLauncher",bizagi.rendering.actionLauncher.prototype),bizagi.rendering.tablet.actionLauncher.extend("bizagi.rendering.tablet.actionLauncher",{},{postRender:function(){if("design"!=this.getMode()){var e=this,t=e.properties,i=e.getControl();e.actions=[],e.startLoading(),$.when(e.dataService.multiaction().getActions(e.processPropertyValueArgs)).then(function(a){return a=e.getPropertiesActionLaucher(a),e.actions=a,e.deferredActions.resolve(a),e.actions.length>0?$("[data-element='actions-add-btn']",i).show():$("[data-element='actions-add-btn']",i).hide(),t.isHorizontal?"none"!=t.templatetype?e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs).then(function(i){return e.engine.render($.extend(i,{isDefaultTemplate:"default"===t.templatetype,sessionId:e.properties.sessionId}),e.processPropertyValueDataTmplArgs)}).then(function(t){template=e.renderFactory.getTemplate("render-actionLauncher-horizontal");var i=$($.fasttmpl(template,{template:!0}));return $(".bz-template",i.wrap("<div>").parent()).append(t),i}):void 0:(template=e.renderFactory.getTemplate("render-actionLauncher-horizontal"),$.fasttmpl(template,{template:!1}))}).done(function(t){$("[data-element='template-container']",i).append(t),e.configureActionsHandlers(),e.configureTemplateHandlers()}).always(function(){e.endLoading()})}},hasValue:function(){var e=this.getValue();return null!=e&&e.length>0},configureActionsHandlers:function(){var e=this,t=e.getControl();$(".action-launcher-control",t).on("click",function(){var t=e.actions[parseInt($(this).data("index"))],i={guidProcess:t[0],guidAction:t[4],displayName:t[1],actionType:t[3],xpathContext:void 0!==t[5]&&"true"===t[5],readOnlyForm:t[6]||!1,guidEntity:e.properties.guidEntity,xpathActions:e.properties.xpathActions||""};e.processAction(i)});for(var i=[],a=0,r=e.actions.length;a<r;a++)i.push({guid:e.actions[a][0],displayName:e.actions[a][1]});$("[data-element='actions-add-btn']",t).actionSheet({actions:i,actionClicked:function(t){var i=e.actions.find(function(e){return e[0]==t.guid});e.processAction({guidProcess:i[0],guidAction:i[4],displayName:i[1],actionType:i[3],xpathContext:void 0!==i[5]&&"true"===i[5],readOnlyForm:i[6]||!1,xpathActions:e.properties.xpathActions||""})}}),$.expr[":"].FilterAction=function(e,t,i){var a=i[3];return!!a&&new RegExp(a,"i").test($(e).text())},$("input#ui-bizagi-render-action-launcher-filter-input",t).keyup(function(){var e=$(this).val();$(".action-launcher-control",t).show(),e&&$(".action-launcher-control",t).not(":FilterAction("+e+")").hide()})},configureTemplateHandlers:function(){var e=this,t=e.getControl();e.engine.subscribe("onLoadDataNavigation",function(t,i){i.filters=[],e.triggerGlobalHandler("dataNavigation",i)}),$(".bz-template-more-or-less",t).bind("click",function(){$(".bz-template",t).toggleClass("bz-template--collapsed")})},processAction:function(e){var t=this,i=t.getControl(),a=t.properties;void 0===a.multipleSelection||a.multipleSelection?"Form"==e.actionType&&t.countSameActions(e)>=1&&!e.xpathContext?$(".action-to-execute-control[data-guidaction='"+e.guidAction+"'] label",i).click():$.when(t.actionManager(e)).done(function(e){t.executeAction(e)}):t.getValue().length>0?t.showConfirmationDialog(e):$.when(t.actionManager(e)).done(function(e){t.executeAction(e)})},notifyExecution:function(e,t){"success"==e.response?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,a=t.getParams(),r=t.properties.additionalXpath.join(","),n=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,o=new $.Deferred,l=new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:a.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){return t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:l.form.properties.xpathContext,idPageCache:i.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(i){e.editMode||0!==t.countSameActions(e)||(e.idStartScope=i.IdScope),o.resolve(i.IdScope)})},onCancel:function(e){}}),s={idForm:e.guidProcess,contextType:"start",idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?a.idWorkitem:void 0,additionalXpaths:r,xpathContext:n,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath};return"Form"===e.actionType&&(s.contextType="entitytemplate",s.xpathContext=void 0,s.guidEntity=e.guidEntity,s.rewriteContextType=!0),l.render(s),o.promise()},processActionFormCollection:function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=t.properties.additionalXpath.join(","),n=new $.Deferred,o=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,l=""!==o?printf("%s[id=%s]",o,e.idEntity):o,s=""!==o?printf("%s[]",o):o,d=a.getParams();return new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:d.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(a){return e.editMode?t.dataService.multiaction().submitData({action:"SAVE",data:a,xpathContext:l,idPageCache:a.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(e){n.resolve(e.IdScope)}):t.dataService.addGridRecordData({idRender:i.id,xpathContext:o,contexttype:"start",idPageCache:a.idPageCache,submitData:a}).done(function(i){e.idStartScope=i.IdScope,e.idEntity=i.IdEntity,t.addActionToQueue(e),n.resolve(i.IdScope)})},onCancel:function(e){}}).render({idForm:e.guidProcess,contextType:"start",idCase:d.idCase,additionalXpaths:r,xpathContext:e.editMode?l:s,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath}),n.promise()},processStartForm:function(e){var t=this,i=new $.Deferred;e=e||{};var a=t.getFormContainer().getParams();return new bizagi.rendering.tablet.startForm(t.dataService,t.renderFactory,{title:e.title||"",navigation:a.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(e){i.resolve(e.IdScope)})}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?a.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),i.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.executeActionImmediately(e)})}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.setValue([]),$.when(t.actionManager(e)).done(function(e){t.executeAction(e)})})},setDisplayValue:function(e){var t=this,i=t.getControl(),a=$("[data-element='actions-container']",i),r=t.renderFactory.getTemplate("render-actionLauncher-actions-to-execute");t.configureQueueVisibility(),$.when(t.deferredActions).done(function(i){$.each(e,function(t,a){var r,n,o=(r=a.guidAction,n=[],$.each(i,function(e,t){t[4]==r&&(n=t)}),n);e[t].displayName=o[1],e[t].guidProcess=o[0],e[t].actionType=o[3],e[t].xpathContext=o[5],e[t].readOnlyForm=o[6],e[t].params&&e[t].params.idStartScope&&(e[t].idStartScope=e[t].params.idStartScope),e[t].params&&e[t].params.idPageCache&&(e[t].idPageCache=e[t].params.idPageCache),e[t].params&&e[t].params.idEntity&&(e[t].idEntity=e[t].params.idEntity)}),e.length>0?$.when($.fasttmpl(r,{actions:e})).done(function(e){a.empty(),a.append(e);var i=$(".bz-actions-to-execute .bz-btn-icn",a),r=$("label",a);i.on("click",function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)}),r.on("click",function(){var e=$(this).parent(),i=e.data("actiontype"),a=e.data("guidprocess"),r=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),l=e.data("readonlyform")||!1,s=e.data("identity")||"",d=e.data("guidaction"),c=o||t.properties.xpathContext;switch(i){case"Process":r&&t.processStartForm({guidprocess:a,idStartScope:r,title:n,xpathContext:o,recordXpath:c});break;case"Form":var p={guidProcess:a,idStartScope:r,editMode:!0,xpathContext:o,readOnlyForm:l,idEntity:s,recordXpath:c};if(p.xpathContext)t.processActionFormCollection(p);else{p.xpathContext=void 0;var u={},g=t.value.filter(function(e){return e.guidAction==d});g.length>0&&(u={actionType:"Form",contextType:"entitytemplate",guidEntity:t.properties.guidEntity||g[0].guidEntity}),t.processActionForm($.extend(p,u))}}})}):a.empty()})},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-action-launcher-actions-to-execute-container",e),i=$(".action-to-execute-label",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.tablet.actionLauncher.extend("bizagi.rendering.tablet.entityTemplate",{},{postRender:function(){if("design"!=this.getMode()){var e=this,t=e.properties,i=e.getControl();e.actions=[],e.configureQueueVisibility(),e.startLoading(),e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs).then(function(a){return e.engine.render(a,e.processPropertyValueDataTmplArgs).then(function(a){var r=e.renderFactory.getTemplate("render-actionLauncher-horizontal"),n=$($.fasttmpl(r,{template:!0}));return $(".bz-template",n.wrap("<div>").parent()).append(a),t.allowactions?e.dataService.multiaction().getActions(e.processPropertyValueArgs).then(function(t){return e.deferredActions.resolve(t),e.actions=t,e.actions.length>0?$("[data-element='actions-add-btn']",i).show():$("[data-element='actions-add-btn']",i).hide(),n}):n})}).done(function(t){$("[data-element='template-container']",i).append(t),e.configureActionsHandlers(),e.configureTemplateHandlers()}).always(function(){e.endLoading()})}},configureActionsHandlers:function(){var e=this,t=e.getControl();$(".action-launcher-control",t).on("click",function(){var t=e.actions[parseInt($(this).data("index"))],i={guidProcess:t[0],guidAction:t[4],displayName:t[1],actionType:t[3],xpathContext:void 0!==t[5]&&"true"===t[5],xpathActions:e.properties.xpathActions||""};"Form"===i.actionType&&(i.xpathContext=void 0,i.contextType="entitytemplate",i.guidEntity=e.properties.guidEntity),e.processAction(i)});for(var i=[],a=0,r=e.actions.length;a<r;a++)i.push({guid:e.actions[a][0],displayName:e.actions[a][1]});$("[data-element='actions-add-btn']",t).actionSheet({actions:i,actionClicked:function(t){var i=e.actions.find(function(e){return e[0]==t.guid});e.processAction({guidProcess:i[0],guidAction:i[4],displayName:i[1],actionType:i[3],xpathContext:void 0!==i[5]&&"true"===i[5]})}})},configureTemplateHandlers:function(){var e=this,t=e.getControl();e.engine.subscribe("onLoadDataNavigation",function(t,i){i.filters=[],i.calculateFilters=i.calculateFilters||!0,e.triggerGlobalHandler("dataNavigation",i)}),$(".bz-template-more-or-less",t).bind("click",function(){$(".bz-template",t).toggleClass("bz-template--collapsed")})}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.polymorphicLauncher",bizagi.rendering.polymorphicLauncher.prototype),bizagi.rendering.tablet.polymorphicLauncher.extend("bizagi.rendering.tablet.polymorphicLauncher",{},{postRender:function(){var e,t=this,i=t.properties;return"design"!=t.getMode()&&t.properties.surrogatedKey?(t.configureQueueVisibility(),$.when(t.dataService.multiaction().getPolymorphicActions(t.processPropertyValueArgs)).done(function(a){a=t.dataService.serializePolymorphicActions(a),t.totalActions=bizagi.clone(a);var r=bizagi.clone(a);t.lessActions=bizagi.clone(r);var n={actions:r,allowSearch:i.allowSearch,treeActionsList:t.getTreeItems(r)};e=t.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree");var o=t.getControl();$(".bz-polymorphic-launcher__constructors",o).append($.fasttmpl(e,n)),t.bindHandlers()})):""},getTreeItems:function(e,t){var i=this,a="<ul>",r=i.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree-item");return e=e||{},t=t||1,$.each(e,function(e,n){a+=$.fasttmpl(r,n),n.children&&(a+=i.getTreeItems(n.children,t+1))}),a+="</ul>"},bindHandlers:function(){var e=this,t=e.getControl();$(".bz-polymorphic-launcher__constructors li span",t).on("click",function(){var t=$(this).parent(),i={guidEntity:t.data("guidentity"),guidObject:t.data("guidobject"),guidConstructor:t.data("guidconstructor"),displayName:t.data("display-name"),actionType:t.data("action-type"),xpathContext:t.data("xpathcontext")};e.onActionClicked(i)}),$.expr[":"].FilterAction=function(e,t,i){var a=i[3];return!!a&&new RegExp(a,"i").test($(e).text())},$("input[data-action=search]",t).keyup(function(){var e=$(this).val();$(".bz-polymorphic-launcher__constructors li",t).show(),e&&$(".bz-polymorphic-launcher__constructors li",t).not(":FilterAction("+e+")").hide()})},onActionClicked:function(e){var t=this;$.when(t.actionManager(e)).done(function(e){t.executeAction(e)})},notifyExecution:function(e,t){"success"==e?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=t.properties.additionalXpath.join(","),n=new $.Deferred,o=(e.xpathContext,a.getParams()),l=t.properties.recordXpath,s=new bizagi.rendering.tablet.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:o.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){var a=i.idPageCache;return i.idPageCache=null,t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:s.form.properties.xpathContext,idPageCache:a,isOfflineForm:!1,isActionStartForm:!0}).done(function(i){e.editMode||0!=t.countSameActions(e)||(e.idStartScope=i.IdScope),n.resolve(i.IdScope)})},onCancel:function(e){}});return s.render({idForm:e.guidObject,contextType:"entity",guidEntity:e.guidEntity,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?o.idWorkitem:void 0,additionalXpaths:r,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,recordXpath:l}),n.promise()},processStartForm:function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=new $.Deferred,n=a.getParams();return e=e||{},new bizagi.rendering.tablet.startForm(t.dataService,t.renderFactory,{maximized:i.maximized,title:e.title||"",navigation:n.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==this.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return a.startLoading(),t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(e){a.endLoading(),r.resolve(e.IdScope)})}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?n.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),r.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.executeActionImmediately(e)})}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.setValue([]),$.when(t.actionManager(e)).done(function(e){t.executeAction(e)})})},setDisplayValue:function(e){var t=this,i=t.getControl(),a=$(".bz-polymorphic-launcher-constructors-to-execute-container",i),r=t.renderFactory.getTemplate("render-polymorphicLauncher-actions-to-execute");t.configureQueueVisibility(),$.when($.fasttmpl(r,{actions:e})).done(function(e){a.empty(),a.append(e);var i=$(".bz-pill .bz-btn-icn",a),r=$(".bz-pill__label",a);i.on("click",function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)}),r.bind("click",function(){var e=$(this).parent(),i=e.data("actiontype"),a=e.data("guidprocess"),r=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),l=e.data("identity")||"",s=e.data("guidentity"),d=o||t.properties.xpathContext;switch(i){case"Process":r&&t.processStartForm({guidprocess:a,idStartScope:r,title:n,xpathContext:o,recordXpath:d});break;case"Form":var c={guidProcess:a,idStartScope:r,editMode:!0,xpathContext:o,idEntity:l,guidEntity:s,guidObject:a};t.processActionForm(c)}})})},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-polymorphic-launcher-constructors-to-execute-container",e),i=$(".bz-polymorphic-launcher__title",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.checkList",bizagi.rendering.checkList.prototype),bizagi.rendering.tablet.checkList.extend("bizagi.rendering.tablet.checkList",{},{postRender:function(){this._super(),this.properties.unique=Math.ceil(1e3*Math.random()),this.properties.required=!0},configureHandlers:function(){var e=this;e._super(),$("input[type=checkbox]",e.getControl()).bind("change",function(){var t=$(this).data("item-guid");e.onCheckListGroupChange(t,this.checked)})},onCheckListGroupChange:function(e,t){var i,a=$.grep(this.properties.items,function(t,i){return t.guid===e});a&&a.length>0&&(i=a[0]),i.checked=t},clearDisplayValue:function(){$("input[type=checkbox]",this.getControl()).removeAttr("checked")},setDisplayValue:function(e){}}),bizagi.rendering.tablet.checkList.extend("bizagi.rendering.tablet.activityCheckList",{},{initializeData:function(e){this._super(e);var t=this.properties.activityDescription&&""!==this.properties.activityDescription?bizagi.localization.getResource("workportal-project-plan-activity-goal")+": "+this.properties.activityDescription:"";this.properties.displayName=""!==t?t:bizagi.localization.getResource("workportal-project-plan-activity-work-title"),this.properties.displayType="vertical"},postRender:function(){var e=this,t=e.getControl();this._super(),e.newItemName=$(".bz-checkList__input",t),e.addEditButton=$(".add-edit-item-button-checklist",t),e.cancelEditButton=$(".cancel-edit-item-button-checklist",t),e.additionalElements(),e.notifyLoadItems()},notifyLoadItems:function(){var e=this;setTimeout(function(){var t=e.properties.items.filter(function(e){return e.resolved}).length;bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!0,idActivity:e.properties.idActivity,itemsResolved:t,items:e.properties.items,progress:e.properties.activityWork})),bizagi.webpart.publish("onLoadDataItemsFromFormActivityPlan",{items:e.properties.items,activityWork:e.properties.activityWork})},100)},additionalElements:function(){var e=this;e.addEditButton&&e.addEditButton.length>0&&e.addEditButton.hide(),e.cancelEditButton&&e.cancelEditButton.length>0&&e.cancelEditButton.hide()},configureHandlers:function(){var e=this,t=e.getControl();this._super(),$("[data-action=add]",t).unbind("click").click(function(){var t=$(".bz-checkList__item.bz-checkList__item--selected",e.control);t.length<=0?e.prepareNewItem():$(".bz-checkList__input",t).focus()}),$("[data-action=delete]",e.control).bind("click",function(){var t=this,i=bizagi.localization.getResource("workportal-widget-reports-confirm"),a=$(this).closest(".bz-checkList__item");a.addClass("ui-bizagi-to-remove"),$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){var i=$(t).closest(".bz-checkList__item").data("item-guid");e.deleteItem(i)}).fail(function(){a.removeClass("ui-bizagi-to-remove")})}),$("label[data-action=edit-item]",e.control).bind("click",function(){var t=$(this).closest(".bz-checkList__item"),i=t.data("item-guid"),a=t.data("item-position");e.selectItem(i,a)})},selectItem:function(e){for(var t=this,i=0,a=t.properties.items.length;i<a;i++)t.properties.items[i].guid===e?t.properties.items[i].selected=!0:t.properties.items[i].selected=!1;t.repaintControl();var r=$(".bz-checkList__item.bz-checkList__item--selected",t.getControl()),n=$(".bz-checkList__input",r),o=n.val();n.focus(),n[0].setSelectionRange(o.length,o.length),t.addSelectedHandlers()},deleteItem:function(e){for(var t=this,i=0,a=t.properties.items.length;i<a;i++)if(t.properties.items[i].guid===e){t.properties.items.splice(i,1);break}t.setValue(t.properties.items),t.repaintControl(),t.addSelectedHandlers()},prepareNewItem:function(){var e=this,t={guid:Math.guid(),resolved:!1,name:"",selected:!0};e.properties.items.push(t),e.repaintControl(),e.newItemName.focus(),e.newItemName.blur(function(){var t=$(".bz-checkList__item.bz-checkList__item--selected",e.control);""===$(".bz-checkList__input",t).val()&&e.properties.items&&e.properties.items.length>=1&&""===e.properties.items.slice(-1)[0].name&&e.properties.items.pop()}),e.addSelectedHandlers(),e.newItemName.keypress(function(t){13==t.which&&(t.preventDefault(),e.addItem(),e.prepareNewItem())})},addSelectedHandlers:function(){var e=this,t=$(".bz-checkList__item.bz-checkList__item--selected",e.control),i=$(".bz-checkList__input",t);i.focus(),$("[data-action=accept-edit]",t).bind("click",function(){var t=i.val();t&&""!==t&&e.addItem()}),$("[data-action=cancel-edit]",t).bind("click",function(t){var a=i.val(),r=$(this).closest(".bz-checkList__item"),n=r.data("item-position"),o=r.data("item-guid");a&&""!==a&&""!==e.properties.items[n].name&&(e.properties.items[n].selected=!1),""!==a&&""!==e.properties.items[n].name||e.deleteItem(o),e.repaintControl()})},addItem:function(){var e=this,t=e.getControl(),i=$(".bz-checkList__item.bz-checkList__item--selected",t),a=$(".bz-checkList__input",i).val();$.each(e.properties.items,function(e,t){t.selected&&(t.name=a,t.selected=!1)}),e.updateOriginalValue(),e.setValue(e.properties.items),e.repaintControl()},repaintControl:function(){var e=this.renderControl();$("[data-component=checkList]",this.control).replaceWith(e),this.postRender(),this.configureHandlers()},onCheckListGroupChange:function(e,t){var i,a=this,r=$.grep(a.properties.items,function(t,i){return t.guid===e});r&&r.length>0&&(i=r[0]),i.resolved=t,a.setValue(a.properties.items),a.refreshValue(a.properties.items)},refreshValue:function(e){for(var t=e.length,i=0,a=0;a<t;a++)e[a].resolved&&(i+=1);this.properties.activityWork=t>0?Math.floor(100*i/t):100,this.notifyLoadItems()},getValue:function(){return this.value||[]},controlValueIsChanged:function(){return JSON.stringify(this.properties.originalValue)!==JSON.stringify(this.value)},updateOriginalValue:function(){this.properties.originalValue=bizagi.clone(this.value)},collectData:function(e){var t=this.properties,i=t.xpath,a=this.getValue(),r=this.properties.idActivity;this.controlValueIsChanged()?bizagi.util.isEmpty(i)||bizagi.util.isEmpty(r)||(Array.isArray(a)?e[t.xpath]={idActivity:r,items:a}:""===a&&(e[t.xpath]="")):bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!1}))},isValid:function(e){var t,i=this.properties,a=this.getValue();t=this.getResource("render-activity-check-list-validation");for(var r=0;r<a.length;r+=1){if(!a[r].resolved){e.push({xpath:i.xpath,message:t});break}}}}),bizagi.rendering.tablet.render.extend("bizagi.rendering.tablet.range",bizagi.rendering.range.prototype),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.range",{},{postRender:function(){this.properties},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.rangeDate",bizagi.rendering.rangeDate.prototype),bizagi.rendering.tablet.rangeDate.extend("bizagi.rendering.tablet.rangeDate",{},{setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.rangeMoney",bizagi.rendering.rangeMoney.prototype),bizagi.rendering.tablet.rangeMoney.extend("bizagi.rendering.tablet.rangeMoney",{},{postRender:function(){var e=new bizagi.rendering.money(this.getRenderProperties("min")),t=new bizagi.rendering.money(this.getRenderProperties("max"));this.setRanageControls(e,t)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,a={data:{properties:{id:i.id,xpath:i.xpath}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return a.data.properties.displayName="min"===e?"From":"To",a},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.tablet.range.extend("bizagi.rendering.tablet.rangeNumber",bizagi.rendering.rangeNumber.prototype),bizagi.rendering.tablet.rangeNumber.extend("bizagi.rendering.tablet.rangeNumber",{},{postRender:function(){var e=new bizagi.rendering.number(this.getRenderProperties("min")),t=new bizagi.rendering.number(this.getRenderProperties("max"));this.setRanageControls(e,t)},getRenderProperties:function(e){var t=this.getFormContainer(),i=this.properties,a={data:{properties:{id:i.id,xpath:i.xpath}},mode:"execute",parent:t,renderFactory:this.renderFactory,resources:bizagi.localization,dataService:this.dataService};return a.data.properties.displayName="min"===e?"From":"To",a},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.columns.column.extend("bizagi.rendering.tablet.columns.column",{},{applyOverrides:function(e){e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl)},getControl:function(){var e=this._super();return e&&0!=e.length||(e=$(this.element||this.observableElement)),e},render:function(e,t,i){var a=this._super(e,t,i),r=this.getDecorated(e);return r.element&&r.element.removeClass("ui-bizagi-render-display-normal ui-bizagi-render-display-vertical ui-bizagi-render-display-reversed").removeClass("ui-bizagi-render-display-vertical-reversed ui-bizagi-render-display-label ui-bizagi-render-display-value"),a},postRenderReadOnly:function(e,t){var i=this.getDecorated(e),a=this.properties.editable;i.properties.editable=!1,null==i.grid&&(i.grid=this.grid),this.properties.singleInstance&&(i.element=t),i.postRenderElement(t),i.properties.editable=a},applyColumnStyles:function(e){var t=this.properties;(e=$(e)).css("-webkit-box-pack",t.align),t.textFormat.background&&(e.css("background-color",t.textFormat.background),e.css("background-image","none"))}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.combo",{},bizagi.rendering.columns.combo.prototype),bizagi.rendering.tablet.columns.combo.extend("bizagi.rendering.tablet.columns.combo",{},{setValue:function(e,t){var i=this,a=i.getDecorated(e),r=bizagi.util.isOfflineForm({context:i});if(null!==a){if("summary"==e)return i._super(e,t);if(!r||"number"!=typeof t&&"string"!=typeof t)if(t&&t.length>0){n={id:t[0][0],value:t[0].length>2?$.grep(t[0],function(e,t){return 0!=t}):t[0][1]};i._super(e,n),a.selectedValue=n.value}else t&&t.id&&t.value?(i._super(e,t),a.selectedValue=t.value):"columnRadio"==i.properties.type?(i._super(e,null),a.selectedValue=t):t&&"number"==typeof t?i._super(e,t):r&&null!==t&&"object"==typeof t&&t.value?(i._super(e,t.value),a.selectedValue=t.value):(i._super(e,null),a.selectedValue="");else{var n="object"==typeof i.properties.data?i.properties.data.find(function(e){return e.id==t}):t;i._super(e,n),a.selectedValue=t}}}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.document",{},{applyOverrides:function(e){var t=this.getMode();this._super(e),"design"!==t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.getDocumentXpath=this.getDocumentXpath,e.getContextXpath=this.getContextXpath,e.documentTemplateGenerate=this.documentTemplateGenerate,e.preRenderControl=this.preRenderControl,e.deleteDocumentTemplate=this.deleteDocumentTemplate,e.properties.xpathContext=this.getContextXpath())},renderControl:function(){return this.preRenderControl(),this._super()},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath);var i=e.parent,a=e.getFormContainer();$.when(a.submitData()).done(function(){$.when(e.dataService.generateDocumentTemplate(t)).done(function(t){$.when(i.refresh()).done(function(){e.autoOpenDocuments()}),e.endLoading()}).fail(function(){e.showErrorMessage(),e.endLoading()})}).fail(function(t){e.getFormContainer().addErrorMessage(t),e.endLoading()})},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getDocumentXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),t},postRenderReadOnly:function(e,t,i){this._super(e,t,i)},getContextXpath:function(){var e=this.getFormContainer();return(e.properties.xpathContext?e.properties.xpathContext+".":"")+this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},preRenderControl:function(){null!=this.value&&null!=this.properties.value&&(this.properties.value=this.value)},deleteDocumentTemplate:function(e){var t=this,i=t.parent,a={};a.xpath=t.properties.xpath+"[fileName='"+e+"']",a.idRender=t.properties.id,a.xpathContext=t.getContextXpath(),a.idPageCache=t.properties.idPageCache,$.when(t.dataService.deleteUploadFile(a)).done(function(){i.refresh()})}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.date",{},{applyOverrides:function(e){this._super(e)}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.text",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.number",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.numberScientificNotation",{},{postRender:function(e,t){this._super(e,t);var i=$("input",t);this.applyColumnStyles(i)},renderSummary:function(e,t){return this.renderReadOnly(e,t)},postRenderSummary:function(e,t){return this.postRenderReadOnly(e,t),!0}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.image",{},{applyOverrides:function(e){var t=this.properties;this._super(e),e.properties.xpathContext=t.xpathContext.length>0?t.xpathContext+"."+this.grid.properties.xpath+"[id="+e.surrogateKey+"]":this.grid.properties.xpath+"[id="+e.surrogateKey+"]"}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.upload",{},{applyOverrides:function(e){this._super(e),e.getUploadXpath=this.getUploadXpath;e.applyUploadPlugin;e.getXpathContext=function(){this.surrogateKey;var e=this,t=e.properties;return t.xpathContext.length>0?t.xpathContext+"."+e.grid.properties.xpath+"[id="+e.surrogateKey+"]":e.grid.properties.xpath+"[id="+e.surrogateKey+"]"},e.buildItemUrl=function(e){var t=this.properties,i=this.getFormContainer(),a=this.getXpathContext();return this.dataService.getUploadFileUrl({idRender:t.id,xpath:t.xpath,xpathContext:a,idPageCache:t.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.contexttype})}},getUploadXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+this.properties.xpath}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.link",{},{applyOverrides:function(e){var t=this,i=t.getMode();t._super(e),"design"!==i&&"layout"!==i&&(t.surrogateKey=e.surrogateKey,e.getXpath=t.getXpath,e.properties.xpathContext=t.grid.properties.xpath+"[id="+t.surrogateKey+"]",t.grid.properties.xpathContext&&-1===e.properties.xpathContext.indexOf(t.grid.properties.xpathContext)&&(e.properties.xpathContext=t.grid.properties.xpathContext+"."+e.properties.xpathContext)),"columnFormLink"===e.properties.type&&(e.getFormLinkXpath=this.getFormLinkXpath)},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getContextXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},getFormLinkXpath:function(){if(this.properties.maximized=null!=bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties(),this.properties.xpath)return this.properties.xpath}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.uploadecm",{},{applyOverrides:function(e){this._super(e),e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl),e.getUploadXpath=this.getUploadXpath,e.buildItemUrl=function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=t.getUploadXpath(t.surrogateKey),n=(r=r.split("."))[r.length-1],o=t.getXpathContext(t.surrogateKey);return t.dataService.getUploadFileUrl({idRender:i.id,xpath:n,xpathContext:o,idPageCache:i.idPageCache,fileId:e.idFileUpload,sessionId:a.properties.sessionId,contexttype:i.contexttype})},e.getXpathContext=function(){var e=this,t=e.properties;return t.xpathContext.length>0?t.xpathContext+"."+e.grid.properties.xpath+"[id="+e.surrogateKey+"]":e.grid.properties.xpath+"[id="+e.surrogateKey+"]"}},renderReadOnly:function(e,t){var i="<div></div>",a=this.getDecorated(e);if(a.setValue(t),this.setValue(e,t),this.setSurrogateKey(e),this.applyOverrides(a),a.grid=this.grid,a.column=this,a.surrogateKey=e,this.readyDeferred=new $.Deferred,a.files.length>0){this.properties.editable;a.properties.editable=!1,i=a.render("cell.upload")}return i},getUploadXpath:function(e){return e=this.surrogateKey||e||"",this.grid.properties.xpath+"[id="+e+"]."+this.properties.xpath},getControl:function(){var e=this,t=e._super();return t&&0!=t.length?$(".ui-bizagi-render-control",e.element||e.observableElement):$(".ui-bizagi-cell-readonly",e.element||e.observableElement)}}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.button",{},{}),bizagi.rendering.tablet.columns.combo.extend("bizagi.rendering.tablet.columns.radio",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.search",{},bizagi.rendering.columns.search.prototype),bizagi.rendering.tablet.columns.search.extend("bizagi.rendering.tablet.columns.search",{},{renderReadOnly:function(e,t){return t&&t.length>0?(t=[].concat(t[0]),this._super(e,{id:t[0],label:t[1],additionallabel:t[2]||void 0})):this._super(e,t)},render:function(e,t){return t&&t.length>0?(t=[].concat(t[0]),this._super(e,{id:t[0],label:t[1],additionallabel:t[2]||void 0})):this._super(e,t)}}),bizagi.rendering.tablet.columns.combo.extend("bizagi.rendering.tablet.columns.list",{},{}),bizagi.rendering.tablet.columns.column.extend("bizagi.rendering.tablet.columns.exclusiveCheck",{},{}),bizagi.rendering.base.factory.extend("bizagi.rendering.tablet.factory",{},{loadTemplates:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplate("icons",e.getFileTemplate("common.bizagi.rendering.icons")),e.loadTemplate("form-error",e.getFileTemplate("bizagi.rendering.tablet.form-error")),e.loadTemplate("form-waiting",e.getFileTemplate("bizagi.rendering.tablet.form-waiting")),e.loadTemplate("form",e.getFileTemplate("bizagi.rendering.tablet.form")+"#bz-form-container"),e.loadTemplate("complexgateway",e.getFileTemplate("bizagi.rendering.tablet.form")+"#bz-form-complex-gateway"),e.loadTemplate("panel",e.getFileTemplate("bizagi.rendering.tablet.panel")),e.loadTemplate("tab",e.getFileTemplate("bizagi.rendering.tablet.tab")),e.loadTemplate("tabItem",e.getFileTemplate("bizagi.rendering.tablet.tabItem")),e.loadTemplate("horizontal",e.getFileTemplate("bizagi.rendering.tablet.horizontal")),e.loadTemplate("accordion",e.getFileTemplate("bizagi.rendering.tablet.accordion")),e.loadTemplate("accordionItem",e.getFileTemplate("bizagi.rendering.tablet.accordionItem")),e.loadTemplate("group",e.getFileTemplate("bizagi.rendering.tablet.group")),e.loadTemplate("searchForm",e.getFileTemplate("bizagi.rendering.tablet.searchForm")),e.loadTemplate("contentPanel",e.getFileTemplate("bizagi.rendering.tablet.contentPanel")),e.loadTemplate("render",e.getFileTemplate("bizagi.rendering.tablet.render")),e.loadTemplate("readonly",e.getFileTemplate("bizagi.rendering.tablet.readonly")),e.loadTemplate("text",e.getFileTemplate("bizagi.rendering.tablet.text")+"#bz-render-text"),e.loadTemplate("text-readOnly",e.getFileTemplate("bizagi.rendering.tablet.text")+"#bz-render-text-readonly"),e.loadTemplate("extendedText",e.getFileTemplate("bizagi.rendering.tablet.extendedText")+"#bz-render-extended-text"),e.loadTemplate("extendedText-readOnly",e.getFileTemplate("bizagi.rendering.tablet.extendedText")+"#bz-render-extended-text-readonly"),e.loadTemplate("number",e.getFileTemplate("bizagi.rendering.tablet.number")),e.loadTemplate("numberScientificNotation",e.getFileTemplate("bizagi.rendering.tablet.numberScientificNotation")),e.loadTemplate("date",e.getFileTemplate("bizagi.rendering.tablet.date")),e.loadTemplate("yesno",e.getFileTemplate("bizagi.rendering.tablet.yesno")),e.loadTemplate("check",e.getFileTemplate("bizagi.rendering.tablet.check")),e.loadTemplate("checkList",e.getFileTemplate("bizagi.rendering.tablet.checkList")),e.loadTemplate("combo",e.getFileTemplate("bizagi.rendering.tablet.combo")+"#bz-combo-control"),e.loadTemplate("combo-readonly",e.getFileTemplate("bizagi.rendering.tablet.combo")+"#bz-combo-control-readonly"),e.loadTemplate("combo-list",e.getFileTemplate("bizagi.rendering.tablet.combo")+"#bz-combo-control-list"),e.loadTemplate("modal-header-search",e.getFileTemplate("bizagi.rendering.tablet.modal")+"#bz-modal-view-header-search"),e.loadTemplate("modal-footer-done",e.getFileTemplate("bizagi.rendering.tablet.modal")+"#bz-modal-view-footer-done"),e.loadTemplate("list",e.getFileTemplate("bizagi.rendering.tablet.list")+"#bz-render-list"),e.loadTemplate("list-items",e.getFileTemplate("bizagi.rendering.tablet.list")+"#bz-render-list-items"),e.loadTemplate("radio",e.getFileTemplate("bizagi.rendering.tablet.radio")),e.loadTemplate("image",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image"),e.loadTemplate("image-item",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image-item"),e.loadTemplate("image-preview",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image-preview"),e.loadTemplate("image-readonly",e.getFileTemplate("bizagi.rendering.tablet.image")+"#bz-render-image-readonly"),e.loadTemplate("uploadSlide",e.getFileTemplate("bizagi.rendering.tablet.slide.upload")),e.loadTemplate("upload",e.getFileTemplate("bizagi.rendering.tablet.upload")+"#bz-render-upload"),e.loadTemplate("upload-item",e.getFileTemplate("bizagi.rendering.tablet.upload")+"#bz-render-upload-item"),e.loadTemplate("upload-readonly",e.getFileTemplate("bizagi.rendering.tablet.upload")+"#bz-render-upload-readonly"),e.loadTemplate("grid",e.getFileTemplate("bizagi.rendering.tablet.grid")),e.loadTemplate("cell",e.getFileTemplate("bizagi.rendering.tablet.cell")),e.loadTemplate("cell.readonly",e.getFileTemplate("bizagi.rendering.tablet.cell.readonly")),e.loadTemplate("cell.upload",e.getFileTemplate("bizagi.rendering.tablet.cell.upload")),e.loadTemplate("search",e.getFileTemplate("bizagi.rendering.tablet.search")+"#bz-render-search"),e.loadTemplate("search.item",e.getFileTemplate("bizagi.rendering.tablet.search")+"#bz-render-search-item"),e.loadTemplate("search.items",e.getFileTemplate("bizagi.rendering.tablet.search")+"#bz-render-search-items"),e.loadTemplate("searchItem",e.getFileTemplate("bizagi.rendering.tablet.searchItem")),e.loadTemplate("searchList",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list"),e.loadTemplate("searchList.item",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-item"),e.loadTemplate("searchList.items",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-items"),e.loadTemplate("searchList.actions",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-actions"),e.loadTemplate("searchList.tag",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-tag"),e.loadTemplate("searchList.readonly",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-readonly"),e.loadTemplate("searchList-modal-header",e.getFileTemplate("bizagi.rendering.tablet.searchList")+"#bz-render-search-list-modal-header"),e.loadTemplate("letter",e.getFileTemplate("bizagi.rendering.tablet.letter")),e.loadTemplate("letter.readonly",e.getFileTemplate("bizagi.rendering.tablet.letter.readonly")),e.loadTemplate("letter.dialog",e.getFileTemplate("bizagi.rendering.tablet.dialog-letter")),e.loadTemplate("button",e.getFileTemplate("bizagi.rendering.tablet.button")),e.loadTemplate("link",e.getFileTemplate("bizagi.rendering.tablet.link")),e.loadTemplate("formLink",e.getFileTemplate("bizagi.rendering.tablet.formLink")),e.loadTemplate("geolocation",e.getFileTemplate("bizagi.rendering.tablet.geolocation")),e.loadTemplate("association",e.getFileTemplate("bizagi.rendering.tablet.association")),e.loadTemplate("ecm",e.getFileTemplate("bizagi.rendering.tablet.ecm")+"#bz-render-ecm"),e.loadTemplate("ecm-item",e.getFileTemplate("bizagi.rendering.tablet.ecm")+"#bz-render-ecm-item"),e.loadTemplate("ecm-readonly",e.getFileTemplate("bizagi.rendering.tablet.ecm")+"#bz-render-ecm-readonly"),e.loadTemplate("list-multiselect",e.getFileTemplate("bizagi.rendering.tablet.multiSelect")+"#bz-multiselect"),e.loadTemplate("multiselect-list",e.getFileTemplate("bizagi.rendering.tablet.multiSelect")+"#bz-multiselect-list"),e.loadTemplate("document",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator"),e.loadTemplate("document-item",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator-item"),e.loadTemplate("document-readonly",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator-readonly"),e.loadTemplate("document-download",e.getFileTemplate("bizagi.rendering.tablet.document")+"#bz-document-generator-download"),e.loadTemplate("render-actionLauncher",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher"),e.loadTemplate("render-actionLauncher-horizontal",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-horizontal"),e.loadTemplate("render-actionLauncher-vertical",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-vertical"),e.loadTemplate("render-actionLauncher-actions-to-execute",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-actions-to-execute"),e.loadTemplate("render-actionLauncher-design",e.getFileTemplate("bizagi.rendering.tablet.actionLauncher")+"#bz-rendering-actionLauncher-design"),e.loadTemplate("render-polymorphicLauncher",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher"),e.loadTemplate("render-polymorphicLauncher-vertical-tree",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree"),e.loadTemplate("render-polymorphicLauncher-vertical-tree-item",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree-item"),e.loadTemplate("render-polymorphicLauncher-actions-to-execute",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-actions-to-execute"),e.loadTemplate("render-polymorphicLauncher-confirm",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-confirm"),e.loadTemplate("render-polymorphicLauncher-design",e.getFileTemplate("bizagi.rendering.tablet.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-design"),e.loadTemplate("render-layout",e.getFileTemplate("bizagi.rendering.tablet.layout.render")),e.loadTemplate("layout-image",e.getFileTemplate("bizagi.rendering.tablet.layout.image")+"#ui-bizagi-render-layout-image"),e.loadTemplate("layout-image64",e.getFileTemplate("bizagi.rendering.tablet.layout.image")+"#ui-bizagi-render-layout-image64"),e.loadTemplate("layout-label",e.getFileTemplate("bizagi.rendering.tablet.layout.label")),e.loadTemplate("layout-link",e.getFileTemplate("bizagi.rendering.tablet.layout.link")),e.loadTemplate("layout-text",e.getFileTemplate("bizagi.rendering.tablet.layout.text")),e.loadTemplate("layout-date-time",e.getFileTemplate("bizagi.rendering.tablet.layout.dateTime")),e.loadTemplate("layout-money",e.getFileTemplate("bizagi.rendering.tablet.layout.money")),e.loadTemplate("layout-number",e.getFileTemplate("bizagi.rendering.tablet.layout.number")),e.loadTemplate("layout-upload",e.getFileTemplate("bizagi.rendering.tablet.layout.upload")),e.loadTemplate("bizagi.grid.grid",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid"),e.loadTemplate("bizagi.grid.waiting",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-waiting"),e.loadTemplate("bizagi.grid.table",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-table"),e.loadTemplate("bizagi.grid.table.empty",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-table-empty"),e.loadTemplate("bizagi.grid.column",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-column"),e.loadTemplate("bizagi.grid.column.special",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-column-special"),e.loadTemplate("bizagi.grid.row",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-row"),e.loadTemplate("bizagi.grid.row.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-row-buttons"),e.loadTemplate("bizagi.grid.cell",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-cell"),e.loadTemplate("bizagi.grid.cell.special",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-cell-special"),e.loadTemplate("bizagi.grid.pager",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-pager"),e.loadTemplate("bizagi.grid.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-buttons"),e.loadTemplate("bizagi.grid.dynamicpager",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-dynamic-pager"),e.loadTemplate("bizagi.grid.totalizer",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#ui-bizagi-grid-totalizer"),e.loadTemplate("bizagi.grid.offline.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#bz-grid-offline-buttons"),e.loadTemplate("bizagi.grid.offline.row.buttons",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#bz-grid-offline-row-buttons"),e.loadTemplate("bizagi.grid.offline.cell.special",e.getFileTemplate("bizagi.rendering.tablet.grid.component")+"#bz-grid-offline-cell-special")).done(function(){var i=$.fasttmpl(e.getTemplate("icons"));0===$("head").find("#genome-forms-icons").length&&$("head").append(i),t.resolve()}),t.promise()},getFileTemplate:function(e,t){var i=bizagi.detectDevice();return bizagi.getTemplate(e,t,"desktop"==i?"tablet_ios":i)},getContainer:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"form"==(t=t.replace(/tablet/,""))?new bizagi.rendering.tablet.form(i):"template"==t?new bizagi.rendering.tablet.formTemplate(i):"queryForm"==t?new bizagi.rendering.tablet.queryForm(i):"layout"==t?new bizagi.rendering.tablet.layout(i):"usersForm"==t?new bizagi.rendering.tablet.usersForm(i):"panel"==t?new bizagi.rendering.tablet.panel(i):"contentPanel"==t||"contentpanel"==t?new bizagi.rendering.tablet.contentPanel(i):"nestedForm"==t?new bizagi.rendering.tablet.nestedForm(i):"tab"==t?new bizagi.rendering.tablet.tab(i):"tabItem"==t||"tabitem"==t?new bizagi.rendering.tablet.tabItem(i):"horizontal"==t?new bizagi.rendering.tablet.horizontal(i):"accordion"==t?new bizagi.rendering.tablet.accordion(i):"accordionItem"==t?new bizagi.rendering.tablet.accordionItem(i):"group"==t?new bizagi.rendering.tablet.group(i):"searchForm"==t?(i.context="search",i.contexttype="metadata",new bizagi.rendering.tablet.searchForm(i)):"mobileform"==t?new bizagi.rendering.mobileform(i):"mobilegroup"==t?new bizagi.rendering.mobilegroup(i):(bizagi.log(t+" not supported in render factory",e.data,"error"),null)},getColumn:function(e){var t=e.type,i=e.data,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance});if("columnText"==(t=t.replace(/tablet/,""))){var r=bizagi.util.parseBoolean(i.properties.isExtended)||!1;return a.decorated=r?bizagi.rendering.tablet.extendedText:bizagi.rendering.tablet.text,new bizagi.rendering.tablet.columns.text(a)}if("columnSearchList"==t)return a.decorated=bizagi.rendering.tablet.searchList,new bizagi.rendering.tablet.columns.searchList(a);if("columnNumber"==t)return a.decorated=bizagi.rendering.tablet.number,new bizagi.rendering.tablet.columns.number(a);if("columnMoney"==t)return a.decorated=bizagi.rendering.tablet.money,new bizagi.rendering.tablet.columns.number(a);if("columnDate"==t)return a.decorated=bizagi.rendering.tablet.date,new bizagi.rendering.tablet.columns.date(a);if("columnBoolean"==t){if("check"==(i.properties.display||"option")){if(a.decorated=bizagi.rendering.tablet.check,e.data.properties.isExclusive)return new bizagi.rendering.tablet.columns.exclusiveCheck(a)}else a.decorated=bizagi.rendering.tablet.yesno;return new bizagi.rendering.tablet.columns.column(a)}return"columnCombo"==t?(a.decorated=bizagi.rendering.tablet.combo,new bizagi.rendering.tablet.columns.combo(a)):"columnRadio"==t?(a.decorated=bizagi.rendering.tablet.radio,new bizagi.rendering.tablet.columns.radio(a)):"columnList"==t?(a.decorated=bizagi.rendering.tablet.list,new bizagi.rendering.tablet.columns.list(a)):"columnHidden"==t?(a.decorated=bizagi.rendering.tablet.hidden,new bizagi.rendering.tablet.columns.column(a)):"columnUpload"==t?(a.decorated=bizagi.rendering.tablet.upload,new bizagi.rendering.tablet.columns.upload(a)):"columnImage"==t?(a.decorated=bizagi.rendering.tablet.image,new bizagi.rendering.tablet.columns.image(a)):"columnUploadEcm"==t?(a.decorated=bizagi.rendering.tablet.ecm,new bizagi.rendering.tablet.columns.uploadecm(a)):"columnLink"==t?(a.decorated=bizagi.rendering.tablet.link,new bizagi.rendering.tablet.columns.link(a)):"columnFormLink"==t?(a.decorated=bizagi.rendering.tablet.formLink,new bizagi.rendering.tablet.columns.link(a)):"columnUserfield"==t?(a.decorated=bizagi.rendering.tablet.userfieldWrapper,new bizagi.rendering.tablet.columns.column(a)):"columnSearch"==t?(a.decorated=bizagi.rendering.tablet.search,new bizagi.rendering.tablet.columns.search(a)):"columnLabel"==t?(a.decorated=bizagi.rendering.tablet.label,new bizagi.rendering.tablet.columns.column(a)):"columnReadonly"==t?(a.decorated=bizagi.rendering.tablet.label,new bizagi.rendering.tablet.columns.readonly(a)):"columnDocument"==t?(a.decorated=bizagi.rendering.tablet.document,new bizagi.rendering.tablet.columns.document(a)):"columnButton"==t?(a.decorated=bizagi.rendering.tablet.button,new bizagi.rendering.tablet.columns.button(a)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRender:function(e){var t=e.type,i=e.data,a=i.properties,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService}),n=bizagi.util.isOfflineForm({container:e.parent});return t||(t="label"),"text"==(t=t.replace(/tablet/,""))?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.tablet.extendedText(r):new bizagi.rendering.tablet.text(r):"association"==t?new bizagi.rendering.tablet.association(r):"label"==t?new bizagi.rendering.tablet.label(r):"hidden"==t?new bizagi.rendering.tablet.hidden(r):"number"==t?a&&29===a.dataType?new bizagi.rendering.tablet.numberScientificNotation(r):new bizagi.rendering.tablet.number(r):"money"==t?new bizagi.rendering.tablet.money(r):"date"==t?new bizagi.rendering.tablet.date(r):"boolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.tablet.check(r):new bizagi.rendering.tablet.yesno(r):"combo"==t?new bizagi.rendering.tablet.combo(r):/^cascadingcombo$/i.test(t)?new bizagi.rendering.tablet.cascadingCombo(r):"list"==t?new bizagi.rendering.tablet.list(r):"radio"==t?new bizagi.rendering.tablet.radio(r):"image"==t?n&&!bizagi.util.isOfflineFormsV2Supported()?new bizagi.rendering.tablet.image.old(r):new bizagi.rendering.tablet.image(r):"uploadecm"==t?new bizagi.rendering.tablet.ecm(r):"upload"==t?n?bizagi.util.isOfflineFormsV2Supported()?new bizagi.rendering.tablet.upload.offline(r):new bizagi.rendering.tablet.upload.offline.old(r):new bizagi.rendering.tablet.upload(r):"grid"==t?n?bizagi.util.isOfflineFormsV2Supported()?new bizagi.rendering.tablet.grid.offline(r):new bizagi.rendering.tablet.grid.offline.old(r):new bizagi.rendering.tablet.grid(r):"groupedgrid"==t?new bizagi.rendering.tablet.grid(r):"search"==t?new bizagi.rendering.tablet.search(r):"suggest"==t?(r.data.properties.enableQuerySuggestBehavior=!0,new bizagi.rendering.tablet.search(r)):"searchList"==t?new bizagi.rendering.tablet.searchList(r):"multiSelect"==t?new bizagi.rendering.tablet.multiSelect(r):"button"==t?new bizagi.rendering.tablet.button(r):"formLink"==t?new bizagi.rendering.tablet.formLink(r):"link"==t?new bizagi.rendering.tablet.link(r):"actionLauncher"==t?new bizagi.rendering.tablet.actionLauncher(r):"entityTemplate"==t?new bizagi.rendering.tablet.entityTemplate(r):"polymorphicLauncher"==t?new bizagi.rendering.tablet.polymorphicLauncher(r):"userfield"==t?new bizagi.rendering.tablet.userfieldWrapper(r):0==t.indexOf("search")?this.getSearchRender(e):"document"==t?new bizagi.rendering.tablet.document(r):"image"==t?new bizagi.rendering.tablet.image(r):"fileprint"==t?new bizagi.rendering.tablet.fileprint(r):"geolocation"==t?new bizagi.rendering.tablet.geolocation(r):"collectionnavigator"==t?new bizagi.rendering.tablet.collectionnavigator(r):0===t.indexOf("layout")?this.getLayoutRender(e):0===t.indexOf("range")?this.getRangeRender(e):"activityCheckList"==t?new bizagi.rendering.tablet.activityCheckList(r):"mobiletext"==t?new bizagi.rendering.mobiletext(r):"letter"==t?new bizagi.rendering.tablet.letter(r):this._super(e)},getLayoutRender:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"layoutImage"==t?new bizagi.rendering.tablet.layoutImage(i):"layoutLink"==t?new bizagi.rendering.tablet.layoutLink(i):"layoutLabel"==t?new bizagi.rendering.tablet.layoutLabel(i):"layoutText"==t?new bizagi.rendering.tablet.layoutText(i):"layoutDateTime"==t?new bizagi.rendering.tablet.layoutDateTime(i):"layoutNumber"==t?new bizagi.rendering.tablet.layoutNumber(i):"layoutMoney"==t?new bizagi.rendering.tablet.layoutMoney(i):"layoutPlaceholder"==t?new bizagi.rendering.tablet.layoutPlaceholder(i):"layoutBoolean"==t?new bizagi.rendering.tablet.layoutBoolean(i):"layoutUpload"==t?new bizagi.rendering.tablet.layoutUpload(i):this._super(e)},getRangeRender:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"rangeDate"===t?new bizagi.rendering.tablet.rangeDate(i):"rangeMoney"===t?new bizagi.rendering.tablet.rangeMoney(i):"rangeNumber"===t?new bizagi.rendering.tablet.rangeNumber(i):(bizagi.log(t+" not supported in render factory",e.data,"error"),null)},getSearchRender:function(e){var t=e.type,i=e.data,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"searchText"==(t=t.replace(/tablet/,""))?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.tablet.extendedText(a):new bizagi.rendering.tablet.text(a):"searchBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.tablet.check(a):new bizagi.rendering.tablet.yesno(a):"searchNumber"==t?29==i.properties.dataType?new bizagi.rendering.tablet.numberScientificNotation(a):new bizagi.rendering.tablet.number(a):"searchMoney"==t?new bizagi.rendering.tablet.money(a):"searchDate"==t?new bizagi.rendering.tablet.date(a):"searchCombo"==t?new bizagi.rendering.tablet.combo(a):"searchSuggest"==t?new bizagi.rendering.tablet.search(a):"searchLabel"==t?new bizagi.rendering.tablet.label(a):(bizagi.log(t+" not supported in render factory",i,"error"),null)}}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.queryForm",{},{}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.formTemplate",bizagi.rendering.formTemplate.prototype),bizagi.rendering.tablet.formTemplate.extend("bizagi.rendering.tablet.formTemplate",{},{}),bizagi.rendering.tablet.form.extend("bizagi.rendering.tablet.usersForm",{},{});
//# sourceMappingURL=../../../../Maps/tablet_ios/forms.tablet.production.js.map
