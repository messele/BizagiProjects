bizagi.rendering.container.extend("bizagi.rendering.smartphone.container",{},{startLoading:function(){},endLoading:function(){}}),bizagi.rendering.render.extend("bizagi.rendering.smartphone.render",bizagi.rendering.render.base.prototype),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.render",{},{initializeData:function(e){this._super(e);var t=this.getFormContainer();this.formParams=t.getParams()},internalPostRender:function(e){this._super(e),this.changeDisplayOption()},postRender:function(){this._super()},getLabel:function(){return this.label||(this.label=$(".bz-form-label label",this.element||this.observableElement)),this.label},getContainerRender:function(){return $(this.element)},getAlignClass:function(e){return e},getControl:function(){return this.control&&0!==this.control.length||(this.control=$(".bz-control",this.element||this.observableElement)),this.control&&0!==this.control.length?this.control:null},getControlFiller:function(){return this.controlFiller||(this.controlFiller=$(".bz-form-item__control",this.element||this.observableElement)),this.controlFiller},getContainerMessage:function(){return this.containerMessage||(this.containerMessage=$(".bz-form-message__text",this.element||this.observableElement)),this.containerMessage},getColumnContainerMessage:function(){return this.containerMessage||(this.containerMessage=$(".bz-form-cell-message__text",this.element||this.observableElement)),this.containerMessage},changeLabelAlign:function(e){},changeValueAlign:function(e){},customizeRenderWidth:function(){},submitOnChange:function(e,t){var i=this,a=new $.Deferred;return bizagi.util.smartphone.startLoading(),$.when(i.isReadyToSave()).done(function(){$.when(i.internalSubmitOnChange(e,t)).done(function(){a.resolve()}).fail(function(){a.reject()}).always(function(){bizagi.util.smartphone.stopLoading()})}),a.promise()},setValidationMessage:function(e){this._super(e);var t="grid"===this.properties.type,i=this.column&&/column/.test(this.properties.type)?this.getColumnContainerMessage():this.getContainerMessage();e&&e.length>0?(e=e.replace(/<\w+>([^<]*)<\/\w+>/g,"$1"),i.attr("data-error",e),i.text(e),t?this.element.addClass("bz-form-item-grid--error"):this.element.addClass("bz-form-item--error")):(i.text(""),t?this.element.removeClass("bz-form-item-grid--error"):this.element.removeClass("bz-form-item--error"))},setDisplayValue:function(e){var t=this,i=t.getControl();if(t.setValue(e,!1),!t.properties.editable&&"check"!==t.properties.display){var a=t.getDisplayValue(e);"string"!=typeof a&&"number"!=typeof a||$(i).html("<label class='bz-form-label'>"+a+"</label>")}},actionSave:function(){this.setValue(this.inputEdition.val(),!1)},configureLabel:function(){return this.properties.displayName},startLoading:function(){},endLoading:function(){},getElementsToStylize:function(e){return $(".bz-input",e)},getDisplayOptionClass:function(e){return"reversed"===e?"bz-form-item--display-reversed":"label"===e?"bz-form-item--display-label":"value"===e?"bz-form-item--display-value":void 0},getFormattingLabel:function(){return this.getLabel()},clearDisplayValue:function(){var e=this,t=e.getControl().find("input").filter(function(e,t){return"file"!==t.type&&"radio"!==t.type&&"checkbox"!==t.type});t.length>0?t.val(e.getValue()):e.setDisplayValue("")},getFormParams:function(){return this.formParams||{}},getRTLDisplayType:function(e){return e},changeVisibility:function(e){this.properties.visible=e,bizagi.util.parseBoolean(e)?"hidden"!==this.properties.type&&(this.element.show(),this.element.css("display","")):this.element&&this.element.hide()},changeRequired:function(e){this.properties.required=e,bizagi.util.parseBoolean(e)&&this.properties.editable?this.element.addClass("bz-form-item--required"):this.element.removeClass("bz-form-item--required"),this.triggerRenderValidate()},changeRequiredLabel:function(e){},changeEditabilityCellControl:function(e,t,i){this._super(e,t,i)}}),bizagi.rendering.smartphone.container.extend("bizagi.rendering.smartphone.form",bizagi.rendering.form.prototype),bizagi.rendering.smartphone.form.extend("bizagi.rendering.smartphone.form",{},{init:function(e){e=e||{},this.warnings={},this.errors={},this._super(e)},postRenderContainer:function(e){var t=this;t._super(e);var i=t.getButtons();(i?i.length:0)&&($(document).data("auto-save","auto-save"),$(document).unbind("save-form").bind("save-form",function(e,i){t.autoSaveEvents(i)}),$(window).unbind("beforeunload").bind("beforeunload",function(e){var i={};if(t.collectRenderValues(i),!$.isEmptyObject(i)&&$(document).data("auto-save"))return bizagi.localization.getResource("confirmation-savebox-message2")}))},autoSaveEvents:function(e,t){var i=this,a={};if(i.collectRenderValues(a),$.isEmptyObject(a))e.resolve();else{var r="startform"===i.properties.formtype,n=r?bizagi.localization.getResource("confirmation-savebox-message4"):bizagi.localization.getResource("confirmation-savebox-message1");$.when(bizagi.showConfirmationBox(n,"Bizagi","warning")).done(function(){r||i.saveForm(),e.resolve()}).fail(function(){r?e.reject():e.resolve()})}},getButtons:function(){var e=this;return e.getParams()&&(handler=e.getParams().getButtons)&&handler(e),$(".ui-bizagi-button-container :button",e.container)},processButtons:function(){var e=this,t=e.getParams();t&&t.processButtons&&(0,t.processButtons)(e);var i=e.properties;i.buttons=e.buttons,e.saveButton=null,e.nextButton=null;for(var a=0,r=i.buttons.length;a<r;a++)"save"===i.buttons[a].action?e.saveButton=i.buttons[a]:"next"===i.buttons[a].action&&(e.nextButton=i.buttons[a]);var n=e.getNavigation();if(void 0!==n){var o=e.getViewContainer();void 0!==o?o.setNavigationButtons(e):n.setNavigationButtons(e)}e.bindTouchEvents(e.getButtons())},refreshForm:function(e){var t=this,i=t.getParams(),a=new $.Deferred;e=e||t.getFocus();var r={idCase:t.params.idCase||"",idWorkitem:t.params.idWorkitem||"",idTask:t.params.idTask||"",focus:e,selectedTabs:t.getSelectedTabs(),xpathContext:t.properties.xpathContext,idPageCache:t.properties.idPageCache,isRefresh:!0,action:t.getEndPointAction(),idStartScope:t.properties.idStartScope||"",navigation:i.navigation,view_container:i.view_container};return(i.postRenderEdit||i.processButtons)&&(r.postRenderEdit=i.postRenderEdit,r.processButtons=i.processButtons,r.originalParams=i.originalParams||{},r.getButtons=i.getButtons),t.startLoading(),$.when(t.triggerHandler("refresh",r)).done(function(){a.resolve()}).fail(function(){a.reject()}).always(function(){t.endLoading()}),a.promise()},addValidationMessage:function(e){var t=this;"string"==typeof e?t.validationController.showValidationMessage(e):$.each(e,function(e,i){t.validationController.showValidationMessage(i)}),t.validationController.expandNotificationBox();var i=t.getNavigation();i&&i.hasOwnProperty("undoRemoveLastSuscriber")&&t.getNavigation().undoRemoveLastSuscriber()},startLoading:function(e){bizagi.util.smartphone.startLoading()},endLoading:function(){bizagi.util.smartphone.stopLoading()},configureHandlers:function(){var e=this,t=e.container;e.configureComplexGateway(),e.processButtons(t),e.bind("ondomincluded",function(){e.validationController=new bizagi.command.controllers.validation(e,e.validations),e.actionController=new bizagi.command.controllers.action(e,e.actions),e.readyDeferred.resolve()}),e.bind("modalViewDidAppear",function(){e.params.navigation.modalViewDidAppear()}),e.bind("modalViewDidDisappear",function(){e.params.navigation.modalViewDidDisappear()})},internalSubmitForm:function(e){var t,i=this,a=[],r=$.Deferred(),n=null,o=null,s=null,l=null,d=null;if((e.submitData||e.executeRule||e.createnewcase)&&(t=i.collectRenderValuesForSubmit()),$.when(i.startLoading()).done(function(){$("html, body").animate({scrollTop:$(".ui-bizagi-loading-icon")},"slow")}),e.executeRule&&((n=i.dataService.submitData({action:"SUBMITDATA",data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0})).tag="submitData",l=i.prepareCheckpointAction(e.id),t={},(o=i.dataService.executeButton({idRender:e.id,xpathContext:i.properties.xpathContext||"",idPageCache:i.properties.idPageCache,prepare:!0})).tag="executeRule",d=i.prepareCommitAction(e.id)),e.next||e.back||e.save||e.createnewcase){if(i.transitions){var c=[];if($.each(this.activeTransitions,function(e,t){t&&c.push(e)}),0==bizagi.util.countProps(c)){var p=bizagi.localization.getResource("render-widget-complexgateway-path"),u=bizagi.localization.getResource("render-widget-complexgateway-error");return bizagi.showMessageBox(p,u,"info",!1),i.endLoading(),r.reject(),r.promise()}}(s=i.dataService.submitData({action:e.action,forcePlanCompletion:e.forcePlanCompletion,data:t,xpathContext:i.properties.xpathContext,idPageCache:i.properties.idPageCache,prepare:!0,transitions:c||"",contexttype:i.properties.contextType,surrogatekey:i.properties.surrogateKey})).tag="performAction"}o&&(a.push(n),l&&a.push(l),a.push(o),d&&a.push(d),a.push(o)),s&&a.push(s);var g=new $.Deferred;return t&&t.deferreds?$.when.apply(this,t.deferreds).done(function(e){g.resolve(e)}).fail(function(){console.log("Error: It was not possible resolve async actions on form "),g.reject()}):g.resolve(),$.when(g).done(function(){bizagi.util.smartphone.startLoading(),$.when(i.dataService.multiaction().execute({actions:a})).done(function(t){var a;if(i.endLoading(),$.each(t,function(e,t){"validationMessages"==t.result.type&&(i.addValidationMessage(t.result.messages),a=!0)}),a)e.executeRule&&i.sendRollbackAction(e.id);else{if(!i.postProcessButton(t,e))return;e.refresh&&i.refreshForm(),e.routing&&i.triggerHandler("routing",{idCase:i.params.idCase}),e.createnewcase&&t.length>0&&i.triggerHandler("routing",{idCase:t[0].result.IdCase,caseNumber:t[0].result.CaseNumber})}delete i.nonSupportedMethods,r.resolve()}).fail(function(t,t,a){var n="";e.executeRule&&i.sendRollbackAction(e.id),a&&a.error&&-1!==["WaitForCompletionPlanException","InvalidPlanStateException","CustomMessageException"].indexOf(a.error.errorType)?(n=bizagi.localization.getResource(a.error.message),i.endLoading(),$.when(bizagi.showConfirmationBox(n,null,!1)).then(function(){var t=$.extend({},e,{forcePlanCompletion:!0});return $.when(i.internalSubmitForm(t))}).done(function(){r.resolve()}).fail(function(){r.reject()})):(n=void 0===a?bizagi.localization.getResource("workportal-general-error"):a,i.failHandler({error:n}),r.reject(a))}).always(function(){bizagi.util.smartphone.stopLoading()})}).always(function(){bizagi.util.smartphone.stopLoading()}),r.promise()},prepareCheckpointAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},prepareCommitAction:function(e){return bizagi.util.validateFeatureSupport("commitRollbackActions")?this._super(e):null},getNavigation:function(){return this.getFormContainer().getParams().navigation},getViewContainer:function(){return this.getFormContainer().getParams().view_container},isFloatingButtonsEnabled:function(){var e=this.getNavigation();return e&&e.isFloatingButtonsEnabled()},isFormButtonsEnabled:function(){var e=this.getNavigation();return e&&e.isFormButtonsEnabled()},dispose:function(e){void 0!==e&&void 0!==e.isRefresh&&0!=e.isRefresh||this._super()},triggerGlobalHandler:function(e,t){var i=this;return i.parent?i.parent.triggerGlobalHandler(e,t):i.observableElement&&i.observableElement.trigger(e,t),i._super(e,t)},failHandler:function(e){var t=this;t._super(e);var i={};try{i=JSON.parse(e)||{}}catch(t){i=e.length&&e.length>1?e[0]:e}finally{i.error&&(i=i.error),i.error&&(i=i.error),void 0!==i.code&&"AUTH_ERROR"===i.code&&setTimeout(function(){t.triggerHandler("routing",{idCase:t.params.idCase,idWorkitem:t.params.idWorkitem})},5e3)}},renderContainer:function(){var e=this,t=this.properties,i=e.renderFactory.getTemplate("form"),a=$.fasttmpl(i,{buttons:e.buttons,transitions:e.transitions,uniqueId:t.uniqueId,helptext:t.helpText,mode:e.getMode(),queryForm:"queryForm"==e.getFormType(),summaryForm:e.params.summaryForm||!1,globalForm:e.properties.displayAsReadOnly||!1,idCase:"",displayName:e.params.displayName||"",processPath:t.processPath,breadCrumb:t.breadCrumb,orientation:t.orientation});return e.replaceChildrenHtml(a,e.renderChildrenHtml())},bindTouchEvents:function(e){var t=this,i=0;e&&0!==e.length&&(e.bind("touchstart",function(e){e.preventDefault();var t=(e.originalEvent.targetTouches?e.originalEvent.targetTouches[0]:e).pageY;i=t}),e.bind("touchend",function(e){e.preventDefault(),$(":focus",t.container).blur();var a=(e.originalEvent.changedTouches?e.originalEvent.changedTouches[0]:e).pageY;if(t.startLoading(),"click"!==e.type&&a>i+40||a<i-40)t.endLoading();else{var r=$(this).attr("ordinal"),n=t.buttons[r];$.when(t.processButton(n)).always(function(){t.endLoading()})}}),e.bind("click",function(){t.startLoading();var e=$(this).attr("ordinal"),i=t.buttons[e];$.when(t.processButton(i)).always(function(){t.endLoading()})}))},configureComplexGateway:function(){var e,t=this,i=t.container;i.length>1?$(i.children()).each(function(){$(this).hasClass(".bz-complex-gateway")&&(e=this)}):e=$(".bz-complex-gateway",i),t.activeTransitions={},$(".bz-checkbox__input",e).on("click",function(){var e=$(this),i=e.data("value")||"";void 0===t.activeTransitions[i]&&(t.activeTransitions[i]=!1),t.activeTransitions[i]=e.is(":checked")||!1})}}),bizagi.rendering.smartphone.container.extend("bizagi.rendering.smartphone.panel",bizagi.rendering.panel.prototype),bizagi.rendering.smartphone.panel.extend("bizagi.rendering.smartphone.panel",{},{}),bizagi.rendering.smartphone.container.extend("bizagi.rendering.smartphone.contentPanel",bizagi.rendering.contentPanel.prototype),bizagi.rendering.smartphone.contentPanel.extend("bizagi.rendering.smartphone.contentPanel",{},{}),bizagi.rendering.smartphone.panel.extend("bizagi.rendering.smartphone.nestedForm",{},{}),bizagi.rendering.smartphone.container.extend("bizagi.rendering.smartphone.tab",bizagi.rendering.tab.prototype),bizagi.rendering.smartphone.tab.extend("bizagi.rendering.smartphone.tab",{},{postRenderContainer:function(e){var t=this;this._super(e),e.material_bizagi_tabs({direction:this.properties.orientation,active_index_tab:this.activeTab}).on("updateActive",function(e,i){e.stopPropagation(),t.setActiveTab(i.index)}),$("> .bz-tabs > .bz-tab",e).rippleEffect()}}),bizagi.rendering.smartphone.container.extend("bizagi.rendering.smartphone.tabItem",bizagi.rendering.tabItem.prototype),bizagi.rendering.smartphone.tabItem.extend("bizagi.rendering.smartphone.tabItem",{},{setAsActiveContainer:function(e){var t=this;$.when(t.ready()).done(function(){var e=$("[data-reference='#ui-bizagi-tab-"+t.properties.id+"']",t.parent.tabs);e.css("display",""),e.click()})},focus:function(){this.activate(),this.setAsActiveContainer(),this._super()},changeVisibility:function(e){var t=this;t.properties.visible=bizagi.util.parseBoolean(e),$.when(t.ready()).done(function(){var e=$("[data-reference='#ui-bizagi-tab-"+t.properties.id+"']",t.parent.tabs),i=t.parent.container.material_bizagi_tabs("getActiveTab");t.properties.visible?(t.container.css("display",""),e.css("display",""),t.properties.counter===i.index?(e.css("display",""),t.setAsActiveContainer()):t.container.css("display","none")):(t.container.css("display","none"),e.css("display","none"),i=t.parent.container.material_bizagi_tabs("getActiveTab"),t.properties.counter===i.index?t.parent.container.material_bizagi_tabs("moveToNextTab"):t.parent.container.material_bizagi_tabs("refreshPositions"))})}}),bizagi.rendering.smartphone.container.extend("bizagi.rendering.smartphone.horizontal",bizagi.rendering.horizontal.prototype),bizagi.rendering.smartphone.horizontal.extend("bizagi.rendering.smartphone.horizontal",{},{}),bizagi.rendering.smartphone.container.extend("bizagi.rendering.smartphone.layout",bizagi.rendering.layout.prototype),bizagi.rendering.smartphone.layout.extend("bizagi.rendering.smartphone.layout",{},{}),bizagi.rendering.smartphone.container.extend("bizagi.rendering.smartphone.accordion",bizagi.rendering.accordion.prototype),bizagi.rendering.smartphone.accordion.extend("bizagi.rendering.smartphone.accordion",{},{}),bizagi.rendering.smartphone.container.extend("bizagi.rendering.smartphone.accordionItem",bizagi.rendering.accordionItem.prototype),bizagi.rendering.smartphone.accordionItem.extend("bizagi.rendering.smartphone.accordionItem",{},{}),bizagi.rendering.smartphone.container.extend("bizagi.rendering.smartphone.group",bizagi.rendering.group.prototype),bizagi.rendering.smartphone.group.extend("bizagi.rendering.smartphone.group",{},{configureHandlers:function(){var e=this;$(">h5.bz-collapsible__header",e.container).bind("click",function(){$(e.container).toggleClass("bz-collapsible--collapsed")})},postRenderContainer:function(e){this._super(e),this.properties.collapse&&this.collapse()},isOpen:function(){return!this.container.hasClass("bz-collapsible--collapsed")},focus:function(){this.expand(),this._super()},expand:function(){this.isOpen()||$(">h5.bz-collapsible__header",this.container).trigger("click")},collapse:function(){this.isOpen()&&$(">h5.bz-collapsible__header",this.container).trigger("click")},toogleContainer:function(e){e?this.expand():this.collapse()}}),bizagi.rendering.smartphone.form.extend("bizagi.rendering.smartphone.searchForm",bizagi.rendering.searchForm.prototype),bizagi.rendering.smartphone.searchForm.extend("bizagi.rendering.smartphone.searchForm",{},{renderResult:function(){var e=this,t=e.properties,i={};i.properties={displayName:e.getResource("render-search-advanced-results-label"),type:"grid",xpath:"searchForm"+t.id,id:t.id,skipInitialLoad:!0,rowsPerPage:10,sortBy:t.sortBy,sortOrder:t.sortOrder,overrideGetRemoteData:function(t){return e.getRemoteData(t)}},i.elements=[];var a=t.columns;$.each(a,function(t){var r={render:{}};r.render.properties={displayName:a[t].caption,xpath:a[t].xpath,editable:!1},$.extend(r.render.properties,e.parseAdditionalProperties(a[t].dataType)),0==a[t].dataType&&(r.render.properties.columnVisible=!1),7!=a[t].dataType&&8!=a[t].dataType||(r.render.properties.allowDecimals=a[t].allowDecimals),10!=a[t].dataType&&11!=a[t].dataType||(r.render.properties.allowDecimals=!0),12==a[t].dataType&&(r.render.properties.showTime=a[t].showTime),i.elements.push(r)});var r=e.renderFactory.getRender({type:"grid",data:i,parent:e,mode:e.getMode()});return r.properties.allowAdd=!1,r.properties.allowEdit=!1,r.properties.allowDelete=!1,e.resultsGrid=r,r.render()},postRenderContainer:function(e){var t=this;t._super(e);var i=e.find(".bz-container__search-results"),a=t.getMode();t.container=e;var r=$(i.children()[0]);t.resultsGrid.postRenderElement(r),"execution"==a&&t.configureHandlers(),"design"==a&&t.configureDesignView(),"layout"==a&&(t.configureDesignView(),t.configureLayoutView())},configureHandlers:function(){var e=this;e.criteriaContainer=$(".bz-container__search-criteria",e.container),e.resultsContainer=$(".bz-container__search-results",e.container),e.resultsGrid.bind("rowSelected",function(t,i){e.properties.searchParams.hasOwnProperty("multiSelect")?e.trigger("multiSelect",i):e.trigger("instanceSelected",i)})},refreshResults:function(){var e=this;e.trigger("instancerefresh"),$.when(e.resultsGrid.refresh()).done(function(){if(e.trigger("instancerefreshdone"),e.resultsGrid.properties.data&&0==e.resultsGrid.properties.data.records&&0==e.resultsGrid.properties.data.rows.length){var t=bizagi.localization.getResource("workportal-general-no-records-found"),i=bizagi.localization.getResource("render-dialog-sendemail-message");bizagi.showMessageBox(t,i)}})},triggerGlobalHandler:function(e,t){var i=this;return i._super(e,t),i.parent?i.parent.triggerGlobalHandler(e,t):i.observableElement?i.observableElement.trigger(e,t):null}}),$.Class.extend("bizagi.rendering.smartphone.helpers.searchForm",{},{init:function(e,t,i,a,r){this.dataService=e,this.renderFactory=t,this.searchForms=i,this.searchParams=a,this.searchFormParams=r,this.searchFormDeferred=new $.Deferred},renderEdition:function(e){return this.properties=e,this.renderSearchForm(e),this.searchFormDeferred.promise()},renderSearchForm:function(e){var t=this,i=t.searchFormParams.navigation.createRenderContainer({title:e.displayName});$.when(t.getSearchContainerData(e)).then(function(a){!1===e.editable&&(a.form.properties.editable=!1),a.form.properties&&(a.form.properties.orientation=t.searchParams.orientation||"ltr");var r=t.renderFactory.getContainer($.extend({},t.searchFormParams,{type:"form",data:a.form,navigation:t.searchFormParams.navigation,view_container:i}));return t.form=r,Object.keys(r.children).map(function(e){r.children[e].params=$.extend({},r.children[e].params,t.searchFormParams)}),r.render()},function(e){var i=t.renderFactory.getCommonTemplate("form-error");$.fasttmpl(i,{message:e}).appendTo(slideForm.find(".scroll-content"))}).done(function(a){var r="tab"===t.form.firstChild().properties.type?t.form.firstChild():null;r?(r.bind("selected",function(i,a){var r=t.searchForms[a.index];$.when(t.loadSearchTab(e,a.tab,r)).done(function(){t.currentSearchForm=a.tab.firstChild(),t.currentSearchForm.triggerHandler("ondomincluded")})}),r.container.tabs("select",0),t.currentSearchForm=r.firstChild().firstChild(),t.currentSearchForm.readyDeferred||(t.currentSearchForm.readyDeferred=new $.Deferred),t.currentSearchForm.triggerHandler("ondomincluded")):(t.currentSearchForm=t.form.firstChild(),t.currentSearchForm.readyDeferred||(t.currentSearchForm.readyDeferred=new $.Deferred),t.currentSearchForm.triggerHandler("ondomincluded")),i.element.html(a),t.searchFormParams.navigation.navigate(i.id),t.containerGridResults=t.currentSearchForm.container.find(".bz-container__search-results"),t.containerSearchCriteria=t.currentSearchForm.container.find(".bz-container__search-criteria"),t.applyButtons(i)})},renderAddForm:function(e){var t=this;e=e||{};var i=t.properties;if(void 0===t.addContainer){var a=bizagi.localization.getResource("render-dialog-entity");t.addContainer=t.searchFormParams.navigation.createRenderContainer({title:a}),t.addContainer.element.bind("close",function(){delete t.addContainer})}var r=e.isRefresh||!1,n={idPageCache:e.idPageCache,guidEntity:i.entity,contextType:"entity"};r?(n.isRefresh=!0,n.idStartScope=e.idStartScope):(n.idRender=i.idRender,n.requestedForm="addForm"),$.when(t.dataService.getFormData(n)).then(function(i){!1===e.editable&&(i.form.properties.editable=!1),void 0!==i.form.properties&&(i.form.properties.orientation=t.searchParams.orientation||"ltr"),i.form.contextType="entity";var a=t.renderFactory.getContainer($.extend({},t.addFormParams,{type:"form",data:i.form,focus:e.focus||!1,selectedTabs:e.selectedTabs,isRefresh:r,requestedForm:e.requestedForm,navigation:t.searchFormParams.navigation,view_container:t.addContainer}));for(var n in a.buttons=[$.extend(a.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""},{callback:function(){return t.saveDataAddForm(a).done(function(){t.addContainer.destroy(),delete t.addContainer,t.searchParams.maxRows=1,t.currentSearchForm.performSearch(t.searchParams)})}}),$.extend(a.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:""},{callback:function(){t.addContainer.destroy(),delete t.addContainer}})],$.extend(a,{processButtons:function(){$.each(a.buttons,function(e,i){switch(i.ordinal){case 1:$(a.getButtons()[e]).click(function(){t.addContainer.destroy(),delete t.addContainer}),a.getButtons()[e].innerHTML=bizagi.localization.getResource("render-form-dialog-box-close"),a.buttons[e].caption=bizagi.localization.getResource("render-form-dialog-box-close"),a.buttons[e].action="back";break;default:$(a.getButtons()[e]).click(function(){t.saveDataAddForm(a),t.addContainer.destroy(),delete t.addContainer})}})}}),a.children)a.children[n].params=$.extend({},a.children[n].params,t.addFormParams);return $.when(a.render()).done(function(e){t.currentAddForm=a.firstChild(),t.addContainer.element.html(e),r||t.searchFormParams.navigation.navigate(t.addContainer.id),t.addContainer.setNavigationButtons(a),a.triggerHandler("ondomincluded"),t.handleSearchFormZindex("show"),a.bind("refresh",function(e,i){return i.scrollTop=t.form.container.parent().scrollTop(),i=$.extend({focus:focus,selectedTabs:t.form.getSelectedTabs(),isRefresh:!0,contextType:t.properties.contextType||"",navigation:t.searchFormParams.navigation,view_container:t.addContainer},i),t.renderAddForm(i)})})}).fail(function(){t.addContainer.destroy(),delete t.addContainer})},saveDataAddForm:function(e){var t=this,i=$.Deferred();if(e.validateForm()){var a={};$.forceCollectData=!0,e.collectRenderValues(a),a.idPageCache=e.idPageCache;var r={action:"SAVE",data:a,idPageCache:a.idPageCache,guidEntity:e.properties.entity,contexttype:"entity"},n={};e.collectRenderValuesForSubmit(n),$.forceCollectData=!1,bizagi.util.isMapEmpty(n)?(bizagi.showMessageBox(bizagi.localization.getResource("render-search-advanced-no-filters")),i.reject()):$.when(t.dataService.submitData(r)).done(function(a){for(var r in n){var o=(s=r,void 0,"object"==typeof(l=t.currentSearchForm.getRender(s))&&null!==l?{found:!0,obj:l}:{found:!1,obj:{}});o.found&&(o.obj.setValue(n[r]),t.setDisplayValueToControl(o.obj,e,r,n))}var s,l;i.resolve()}).fail(function(t,a,r){e.addValidationMessage(r.message),i.reject()})}else i.reject();return i},setDisplayValueToControl:function(e,t,i,a){"searchSuggest"===e.properties.type?e.setDisplayValue(t.getRender(i).getDisplayValue()):e.setDisplayValue(a[i])},applyButtons:function(e){var t=this;t.displayBottomButtons(e),e.element.bind("close",function(){t.searchFormDeferred.reject()})},loadSearchTab:function(e,t,i){var a=this,r=new $.Deferred;return t.children.length>0?null:($.when(a.getSearchFormData(e,i)).pipe(function(e){var i=a.renderFactory.getContainer({type:"searchForm",data:e.form});return t.children.push(i),i.render()}).done(function(e){$(".ui-bizagi-button-container",e).detach(),t.container.append(e),r.resolve()}),r.promise())},getSearchContainerData:function(e){var t=this,i=new $.Deferred,a={form:{properties:{},elements:[]}},r=a.form,n=t.searchForms[0];if(t.searchForms.length>1){var o={properties:{type:"tab"},elements:[]},s=[];$.each(t.searchForms,function(e,i){var a=i.default||!1,l={};l.properties={id:e,type:"tabItem",displayName:i.caption},l.elements=[],a?(o.elements.push({container:l}),r=l,n=t.searchForms[0]):s.push({container:l})}),$.each(s,function(e,t){o.elements.push(t)}),a.form.elements.push({container:o})}return $.when(t.getSearchFormData(e,n)).done(function(e){r.elements.push(e),r.properties.id=Math.guid(),i.resolve(a)}),i.promise()},getSearchFormData:function(e,t){return this.dataService.getSearchFormData($.extend(e,{idSearchForm:t.id,url:t.url})).pipe(function(t){return t.form.properties.idRender=e.idRender,t})},displayBottomButtons:function(e){var t=this,i=t.currentSearchForm.container.find(".bz-container__button-edit").empty().show(),a="<button class='ui-bizagi-form-button ${name}'>${text}</button>",r=$.tmpl(a,{name:"bz-btn-search",text:bizagi.localization.getResource("render-form-dialog-box-search")}).appendTo(i),n=$.tmpl(a,{name:"bz-btn-select",text:bizagi.localization.getResource("render-search-advanced-results-button")}).appendTo(i),o=$.tmpl(a,{name:"bz-btn-add",text:bizagi.localization.getResource("render-form-dialog-box-add")}).appendTo(i),s=$.tmpl(a,{name:"bz-btn-cancel",text:bizagi.localization.getResource("render-form-dialog-box-cancel")}).appendTo(i);e.element.bind("close",function(e){"none"===t.containerSearchCriteria.css("display")&&(e.preventDefault(),l())});var l=function(){var i=[{ordinal:1,action:"search",caption:bizagi.localization.getResource("render-form-dialog-box-search"),callback:function(){return t.searchParams.maxRows=1,t.currentSearchForm.performSearch(t.searchParams)}},{ordinal:2,action:"cancel",caption:"cancel",callback:function(){t.searchFormDeferred.reject(),e.destroy()}},{ordinal:3,action:"add",caption:bizagi.localization.getResource("render-form-dialog-box-add"),callback:function(){var e={idCase:t.searchFormParams.idCase,idRender:t.properties.idRender,displayName:t.properties.displayName,idPageCache:t.properties.idPageCache};t.renderAddForm(e)}}];t.containerSearchCriteria.show(),t.containerGridResults.hide(),$(o).toggle(t.searchParams.allowNew),r.show(),n.hide(),t.searchParams.allowNew||i.pop(),t.form.buttons=i,delete t.form.properties.virtual,e.setNavigationButtons(t.form)};r.bind("click",function(){t.searchParams.maxRows=1,t.currentSearchForm.performSearch(t.searchParams)}),o.bind("click",function(){var e={idCase:t.searchFormParams.idCase,idRender:t.properties.idRender,displayName:t.properties.displayName,idPageCache:t.properties.idPageCache};t.renderAddForm(e)}),s.bind("click",function(){t.searchFormDeferred.reject(),e.destroy()}),n.bind("click",function(){t.searchFormDeferred.resolve(e.element.find(".bz-container__search-results [data-key]").data("business-key")),e.destroy()}),t.currentSearchForm.bind("instancerefreshdone",function(){var i;null!==t.currentSearchForm.resultsGrid.properties.data&&!$.isEmptyObject(t.currentSearchForm.resultsGrid.properties.data.rows)&&t.currentSearchForm.resultsGrid.properties.data.rows.length>0?(i=[{ordinal:4,action:"select",caption:bizagi.localization.getResource("render-search-advanced-results-button"),callback:function(){t.searchFormDeferred.resolve(e.element.find(".bz-container__search-results [data-key]").data("business-key")),e.destroy()}},{ordinal:5,action:"cancel",caption:"cancel",callback:function(){l()}},{ordinal:3,action:"add",caption:bizagi.localization.getResource("render-form-dialog-box-add"),callback:function(){var e={idCase:t.searchFormParams.idCase,idRender:t.properties.idRender,displayName:t.properties.displayName,idPageCache:t.properties.idPageCache};t.renderAddForm(e)}}],t.containerSearchCriteria.hide(),t.containerGridResults.show(),$(o).toggle(t.searchParams.allowNew),r.hide(),n.show(),t.searchParams.allowNew||i.pop(),t.form.buttons=i,t.form.properties.virtual=!0,e.setNavigationButtons(t.form)):l()}),l()},renderEditionAddForm:function(e){var t=this,i=t.properties,a=$(e.id+" .inputEditionContent"),r=$(e.id+" .inputEditionContent"),n=$(e.id,"body");t.viewContainer=e.viewContainer,t.addFormParams={container:a,canvas:r,kendoView:n,allowFullSearch:i.allowFullSearch,maxRecords:i.maxRecords,allowNew:!1},t.renderEdition({idRender:i.idRender,requestedForm:"addForm",xpathContext:i.xpathContext,idPageCache:i.idPageCache,isAddForm:!0,contextType:"entity"}).done(function(){if(t.form.validateForm()){var e={};$.forceCollectData=!0,t.form.collectRenderValues(e),e.idPageCache=t.form.idPageCache;var i=$.Deferred(),a={action:"SAVE",data:e,idPageCache:e.idPageCache,guidEntity:t.form.properties.entity,contexttype:"entity"},r={};t.form.collectRenderValuesForSubmit(r),$.forceCollectData=!1,bizagi.util.isMapEmpty(r)?bizagi.showMessageBox(bizagi.localization.getResource("render-search-advanced-no-filters")):(t.pane.navigate("#:back"),$.when(t.dataService.submitData(a)).done(function(i){for(var a in r){var n=(s=a,void 0,"object"==typeof(l=t.currentSearchForm.getRender(s))&&null!==l?{found:!0,obj:l}:{found:!1,obj:{}});if(n.found){var o=e[a];n.obj.setValue(o),n.obj.setDisplayValue(o),null!==t.currentSearchForm.resultsGrid.properties.data&&!jQuery.isEmptyObject(t.currentSearchForm.resultsGrid.properties.data.rows)&&t.currentSearchForm.resultsGrid.properties.data.rows.length>0&&(t.containerSearchCriteria.show(),t.currentSearchForm.container.find(".bz-btn-search").show(),t.currentSearchForm.container.find(".bz-btn-select").hide(),t.containerGridResults.hide())}}var s,l}).fail(function(e,t,a){"parsererror"===t?i.resolve({type:"error",message:a.message}):i.reject(arguments)}))}}).fail(function(){t.pane.navigate("#:back")}),t.pane.navigate(e.id)},handleSearchFormZindex:function(e){var t=$.grep($(".km-modalview-root"),function(e,t){return"block"==$(e).css("display")});t.length>0&&("show"==e?$(t).css("z-index",0):$(t).css("z-index",10001))}}),$.Class.extend("bizagi.rendering.smartphone.startForm",{},{init:function(e,t,i){var a=this;a.dataService=e,a.renderFactory=t,a.slideFormParams=i||{},a.slideContainer=a.slideFormParams.navigation.createRenderContainer({title:a.slideFormParams.title}),a.configureViewHandlers()},configureViewHandlers:function(){},goBack:function(){this.slideContainer.destroy()},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getStartForm(e)).then(function(a){!1===e.editable&&(a.form.properties.editable=!1);var r=bizagi.rendering.smartphone.form.extend({submitForm:function(){if(t.form&&(this.endLoading(),t.form.validateForm())){var e={};t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(e)).done(function(a){null===a||!0===a||"success"===a.type?(i.resolve(),t.goBack()):"validationMessages"===a.type?(t.form.addValidationMessage(a.messages),$.each(e,function(e){var i=t.form.getRenders(e);$.each(i,function(e,t){t.updateOriginalValue()})})):"error"===a.type&&t.form.addErrorMessage(a.message)}):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:a.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form=new r(n),t.form.bind("refresh",function(i,a){a=$.extend({selectedTabs:t.form.getSelectedTabs(),isRefresh:!0},e,a,{idStartScope:t.form.properties.idStartScope}),t.renderSlideForm(a)}),t.form.buttons=[$.extend(t.form.buttons[0]||{},{caption:t.slideFormParams.saveButtonLabel,actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""},{callback:function(){t.form.submitForm()}}),$.extend(t.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:""},{callback:function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()}})],t.form.render()}).done(function(i){var a=t.slideFormParams.saveButtonLabel?t.slideFormParams.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"),r=bizagi.localization.getResource("render-form-dialog-box-cancel");t.slideContainer.element.html(i),e.isRefresh||t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append("<div ordinal='0' id='formButton0' class='action-button ui-bizagi-form-button'>"+a+"</div>").delegate("div[ordinal='0']","click",function(){t.form.submitForm()}),$(".ui-bizagi-button-container",t.form.container).append("<div ordinal='1' id='formButton1' class='action-button ui-bizagi-form-button'>"+r+"</div>").delegate("div[ordinal='1']","click",function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()}),t.form.triggerHandler("ondomincluded")}).fail(function(e,i,a){var r=t.renderFactory.getCommonTemplate("form-error"),n=a.message||"Error";$.tmpl(r,{message:n}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)}),i.promise()}}),$.Class.extend("bizagi.rendering.smartphone.slide.form",{},{init:function(e,t,i){var a=this;a.dataService=e,a.renderFactory=t,a.slideFormParams=i||{},a.slideContainer=a.slideFormParams.navigation.createRenderContainer({title:a.slideFormParams.title}),a.configureViewHandlers()},goBack:function(){this.slideContainer.destroy()},configureViewHandlers:function(){},render:function(e){this.renderSlideForm(e)},renderSlideForm:function(e){var t=this,i=new $.Deferred;return $.when(t.dataService.getFormData(e)).pipe(function(a){!1===e.editable&&(a.form.properties.editable=!1);var r=bizagi.rendering.smartphone.form.extend({submitForm:function(arguments){if(t.form&&(this.endLoading(),t.form.validateForm())){var e={};t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),t.slideFormParams.onSave?$.when(t.slideFormParams.onSave(e)).done(function(a){null===a||!0===a||"success"===a.type?(i.resolve(),t.goBack()):"validationMessages"===a.type?(t.form.addValidationMessage(a.messages),$.each(e,function(e,i){var a=t.form.getRenders(e);$.each(a,function(e,t){t.updateOriginalValue()})})):"error"===a.type&&t.form.addErrorMessage(a.message)}):(i.resolve(),t.goBack())}}}),n=$.extend({type:"form",data:a.form,navigation:t.slideFormParams.navigation,view_container:t.slideContainer},{renderFactory:t.renderFactory,dataService:t.renderFactory.dataService});return t.form=new r(n),t.form.buttons=[$.extend(t.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:""},{callback:function(){t.form.submitForm()}}),$.extend(t.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:""},{callback:function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()}})],t.form.render()}).done(function(i){var a=t.slideFormParams.saveButtonLabel?t.slideFormParams.saveButtonLabel:bizagi.localization.getResource("render-form-dialog-box-save"),r=bizagi.localization.getResource("render-form-dialog-box-cancel");t.slideContainer.element.html(i),t.slideFormParams.navigation.navigate(t.slideContainer.id),$(".ui-bizagi-button-container div",t.form.container).remove(),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="0" id="formButton0" class="action-button ui-bizagi-form-button">'+a+"</div>").delegate('div[ordinal="0"]',"click",function(){t.form.submitForm()}),$(".ui-bizagi-button-container",t.form.container).append('<div ordinal="1" id="formButton1" class="action-button ui-bizagi-form-button">'+r+"</div>").delegate('div[ordinal="1"]',"click",function(){t.slideFormParams.onCancel&&t.slideFormParams.onCancel(),t.goBack()}),t.form.triggerHandler("ondomincluded"),t.form.bind("refresh",function(){t.renderSlideForm(e)})}).fail(function(e){var i=t.renderFactory.getCommonTemplate("form-error"),a=e.message||"Error";$.tmpl(i,{message:a}).appendTo(t.slideContainer.element),t.slideFormParams.navigation.navigate(t.slideContainer.id)}),i.promise()}}),$.Class.extend("bizagi.rendering.smartphone.slide.ecm",{},{init:function(e,t,i){var a=this;a.dataService=e,a.renderFactory=t,a.slideFormParams=i||{},a.slideFormDeferred=new $.Deferred,a.container=a.slideFormParams.navigation.createRenderContainer({title:a.slideFormParams.title})},render:function(e){return this.renderSlideForm(e),this.slideFormDeferred.promise()},renderSlideForm:function(e){var t=this,i=t.getMetadataForm(e);t.form=t.renderFactory.getContainer({type:"form",data:i.form,navigation:t.slideFormParams.navigation,view_container:t.container}),$.when(t.form.render()).done(function(i){t.container.element.html(i),t.slideFormParams.navigation.navigate(t.container.id),t.processButtons(t.form,e),t.container.setNavigationButtons(t.form),t.form.triggerHandler("ondomincluded")}).always(function(){t.slideFormDeferred.resolve()})},processButtons:function(e,t){var i=this;e.buttons=[{ordinal:0,action:"save",caption:bizagi.localization.getResource("render-form-dialog-box-save"),callback:i.onSaveDataMetadataForm.bind(i,t.fileData)},{ordinal:1,action:"back",caption:bizagi.localization.getResource("render-form-dialog-box-close"),callback:function(){i.slideFormParams.onCancel({}),i.goBack()}}],i.slideFormParams.editable||e.buttons.shift()},getMetadataForm:function(e){var t=this,i={type:"form",form:{elements:[],pageCacheId:e.pageCacheId,sessionId:e.sessionId,properties:{id:101,xpathContext:e.xpathContext,editable:t.slideFormParams.editable,orientation:t.slideFormParams.orientation||"ltr"}}};return $.each(e.metadata,function(e,a){var r=t.getRenderType(a.metadataType),n=Object.assign({id:e+1,xpath:a.metadataId,displayName:a.description,required:!0===bizagi.util.parseBoolean(a.required),editable:!1===bizagi.util.parseBoolean(a.readOnly),value:a.value},r);i.form.elements.push({render:{properties:n}})}),i},getRenderType:function(e){switch(e.toUpperCase()){case"INTEGER":return{type:"number",dataType:2,allowDecimals:!1,thousands:!1};case"DECIMAL":return{type:"number",dataType:10,allowDecimals:!0,thousands:!0};case"DATETIME":return{type:"date",dataType:12};case"BOOL":return{type:"boolean",dataType:5};case"STRING":default:return{type:"text",dataType:15,maxLength:50,autoExtend:!1}}},onSaveDataMetadataForm:function(e){var t=this,i=$.Deferred();if(t.form.validateForm()){var a={};if(t.form.collectRenderValuesForSubmit(a),$.forceCollectData=!1,bizagi.util.isMapEmpty(a))t.slideFormParams.onSave({update:!1}),i.resolve({update:!1}),t.goBack();else{var r=Object.keys(a).map(function(e,t){return{idMetadata:e,value:a[e]}}),n={idFileUpload:e.idFileUpload,fileName:e.fileName,idPageCache:e.idPageCache,xpathContext:e.xpathContext,xPath:e.xpath,idAttrib:e.idAttrib};n.metaValues=JSON.encode({metadataValues:r}),bizagi.loading.start(),$.when(t.dataService.updateECMMetadata(n)).done(function(a){a&&a.idFileUpload&&(t.slideFormParams.onSave({update:!0,idFileUpload:a.idFileUpload,fileName:e.fileName}),i.resolve({update:!0})),t.goBack()}).fail(function(e){t.form.addValidationMessage(e.message),i.reject()}).always(function(){bizagi.loading.stop()})}}i.promise()},goBack:function(){this.container.destroy()}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.text",bizagi.rendering.text.prototype),bizagi.rendering.smartphone.text.extend("bizagi.rendering.smartphone.text",{},{postRender:function(){this._super(),this.properties.maxLength>0&&this.input.attr("maxlength",this.properties.maxLength)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("text-read-only"),t=this.getValue(),i={value:t=null!=t?bizagi.util.sanitizeHTML(t):"",editable:this.properties.editable};return $.fasttmpl(e,i)},setDisplayValue:function(e){var t=this,i=bizagi.util.decodeURI(e);e=this.validateValue("string"==typeof i?i:"",t.properties.maxLength),t.setValue(e,!1),e&&(e=$.br2nl(e).replaceAll("\\n","\n")),t.properties.editable?t.input.val(e):$(".bz-text-readonly",t.getControl()).html(bizagi.util.sanitizeHTML(e))},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur(function(){var t=$(this);e.retypeDouble(t)})},retypeDouble:function(e){var t=this,i=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===i)return;i!==e.data("oldValue")?(t.setValue(""),t.createTooltip(e,"",t.getResource("render-text-retype-error"))):(e.data("newValue",i),e.data("oldValue",""),e.tooltip("destroy"))}else{if(""===i||i===e.attr("newValue"))return;t.createTooltip(e,i,t.getResource("render-number-retype"))}},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".bz-text-readonly",e)},validateValue:function(e,t){return e.length<=t?e:e.substr(0,t)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.extendedText",bizagi.rendering.extendedText.prototype),bizagi.rendering.smartphone.extendedText.extend("bizagi.rendering.smartphone.extendedText",{minLines:2,maxLines:8,maxCharactersToShow:100},{postRender:function(){var e=this;e._super(),e.textarea=e.getControl().find("textarea"),e.textarea&&e.textarea.css({resize:"vertical"})},initializeData:function(e){this._super(e);var t=this.properties.maxLines;this.properties.maxLines=t>this.Class.maxLines?this.Class.maxLines:t<this.Class.minLines?this.Class.minLines:t,this.isOfflineForm=bizagi.util.isOfflineForm({context:this})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("extendedText-readOnly"),t=this.getValue();t=null!=t?bizagi.util.sanitizeHTML(t):"";var i=this.Class.maxCharactersToShow,a={value:t,startString:t.substr(0,i),endString:t.substr(i-1,t.length-i)};return $.fasttmpl(e,a)},setDisplayValue:function(e){var t=this,i=bizagi.util.decodeURI(e);e=t.validateValue("string"==typeof i?i:"",t.properties.maxLength),t.setValue(e,!1),e&&(e=$.br2nl(e).replaceAll("\\n","\n")),t.properties.editable?t.textarea.val(e):$(".bz-textarea-readonly",t.getControl()).html(bizagi.util.sanitizeHTML(e))},configureHandlers:function(){var e=this;e._super(),e.properties.maxLength>0&&(e.textarea.attr("maxlength",e.properties.maxLength),e.actualMaxLength=e.properties.maxLength),$(e.textarea).bind("focus keyup paste",function(t){8!==t.which&&46!==t.which||e.textarea.prop("rows")>e.properties.maxLines&&e.textarea.prop("rows",e.properties.maxLines);e.updateTextareaSize(this)}),$(e.textarea).bind("blur",function(t){e.textarea.prop("rows",e.properties.maxLines)})},configureHandlersReadOnly:function(){var e=this,t=this.getControl();$(".bz-textarea-readonly",t).on("click",".bz-read-more",function(t){return $(t.delegateTarget).hasClass("bz-textarea-readonly--active")?($(t.delegateTarget).removeClass("bz-textarea-readonly--active"),$(this).html(e.getResource("workportal-project-discussion-comment-viewmore"))):($(t.delegateTarget).addClass("bz-textarea-readonly--active"),$(this).html(e.getResource("workportal-project-discussion-comment-viewless"))),!1})},updateTextareaSize:function(e){if(this.properties.autoExtend){var t=$(e).prop("rows");e.scrollHeight>e.offsetHeight&&t>=this.Class.minLines&&t<this.Class.maxLines&&($(e).prop("rows",t+1),this.updateTextareaSize(e))}},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input, textarea",t);i&&0!==i.length&&i.blur(function(){var t=$(this),i=e.previousValue,a=e.value;null!=i&&a!=i&&null!=$(this).data("newValue")&&t.val()!=$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)})},retypeDouble:function(e){var t=this,i=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""==i)return;i!==e.data("oldValue")?(t.setValue(""),t.createTooltip(e,"",t.getResource("render-text-retype-error"))):(e.data("newValue",i),e.data("oldValue",""),e.tooltip("destroy"))}else{if(""===i||i===e.attr("newValue"))return;t.createTooltip(e,i,t.getResource("render-number-retype"))}},getElementsToStylize:function(e){return this.properties.editable?$("textarea",e):$(".bz-textarea-readonly",e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.label",bizagi.rendering.label.prototype),bizagi.rendering.smartphone.label.extend("bizagi.rendering.smartphone.label",{},{}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.number",bizagi.rendering.number.prototype),bizagi.rendering.smartphone.number.extend("bizagi.rendering.smartphone.number",{},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{value:this.getDisplayValue(),editable:this.properties.editable,type:"text",isDesign:"execution"!==this.getMode()})},setDisplayValue:function(e){var t=this;t.setValue(e,!1),null!=e&&t.properties.editable&&(t.numericInput.val(e),t.value=t.properties.value=e,t.executeFormatCurrencyPlugin())},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!==i.length&&i.blur(function(){var t=$(this),i=e.previousValue,a=e.value;"grid"===e.parent.properties.type?(null!=i&&a!==i&&void 0!==$(this).data("newValue")&&t.val()!==$(this).data("newValue")&&($(this).data().newValue=void 0),e.retypeDouble(t)):e.retypeDouble(t)})},retypeDouble:function(e){var t=this,i=e.val();if("hidden"!==$(e).attr("type")&&"none"!==$(e).css("display")&&"hidden"!==$(e).css("visibility")&&void 0===$(this).data("newValue"))if(e.data("oldValue")&&""!==$(this).data("oldValue")){if(""===i)return;if(i!==e.data("oldValue"))t.setValue(""),t.createTooltip(e,"",t.getResource("render-text-retype-error"));else{e.data("newValue",i),e.data("oldValue","");try{e.tooltip("destroy")}catch(e){}}}else{if(""===i||i===e.attr("newValue"))return;t.createTooltip(e,i,t.getResource("render-number-retype"))}},getElementsToStylize:function(e){return $("input",e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.money",bizagi.rendering.number.prototype),bizagi.rendering.smartphone.money.extend("bizagi.rendering.smartphone.money",bizagi.rendering.money.prototype),bizagi.rendering.smartphone.money.extend("bizagi.rendering.smartphone.money",{},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("number");return $.fasttmpl(e,{value:this.getDisplayValue(),editable:this.properties.editable,type:"text",isDesign:"execution"!==this.getMode()})},setDisplayValue:function(e){this.setValue(e,!1),null!=e&&this.properties.editable&&(this.numericInput.val(e),this.executeFormatCurrencyPlugin())},getElementsToStylize:function(e){return $("input",e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.date",bizagi.rendering.date.prototype),bizagi.rendering.smartphone.date.extend("bizagi.rendering.smartphone.date",{MAX_YEARS_DISPLAY:100},{initializeData:function(e){this._super(e)},renderReadOnly:function(){var e=this.getFormattedDate(this.getValue(),this.properties.showTime,!0),t={value:e=bizagi.util.dateFormatter.formatDate(e,this.properties.fullFormat),editable:this.properties.editable},i=this.renderFactory.getTemplate("readonly");return $.fasttmpl(i,t)},postRenderReadOnly:function(){this.input=$("input",this.getDateControl())},postRender:function(){this._super(),this.input=$("input",this.getDateControl())},configureHandlers:function(){var e=this,t=e.properties.showTime?["calendar","time"]:["calendar"],i=e.getFormattedDate(e.properties.value,e.properties.showTime,!0),a=e.getFormattedDate(e.properties.minValue,e.properties.showTime,!1),r=e.getFormattedDate(e.properties.maxValue,e.properties.showTime,!1),n=e.properties.showTime?e.getTimeFormat():"";if(isNaN(Date.parse(a))&&((a=new Date).setFullYear(a.getFullYear()-e.Class.MAX_YEARS_DISPLAY),a.setHours(0,0,0,0)),isNaN(Date.parse(r))&&((r=new Date).setFullYear(r.getFullYear()+e.Class.MAX_YEARS_DISPLAY),r.setHours(23,59,59)),$(".bz-input-icon",this.getControl()).mobiscroll().calendar({mode:"mixed",display:"bottom",controls:t,min:a,max:r,defaultValue:i,timeFormat:n,showScrollArrows:!0,lang:bizagi.util.languages[BIZAGI_LANGUAGE]||"en",headerText:"{value}",buttons:["set",{text:this.getResource("render-plugin-search-users-clear-button-name"),handler:function(t,i){e.date=void 0,e.time=void 0,e.timeS=void 0,e.onChangeHandler(!0),i.clear()}},"cancel"],onSet:function(t,i){var a=i.getVal();e.date={day:a.getDate(),month:a.getMonth(),year:a.getFullYear()},e.properties.showTime&&(e.time={hours:a.getHours(),minutes:a.getMinutes()},e.is24h||(e.timeS=a.getHours()<12?"am":"pm")),e.onChangeHandler()},onBeforeShow:function(t,i){e.triggerGlobalHandler("modalViewDidAppear",{}),e.changeMinValue(e.properties.minValue),e.changeMaxValue(e.properties.maxValue),bizagi.util.isiOSDevice()&&$(".ui-bizagi-notifications-container").css("display","none")},onClose:function(t,i){e.triggerGlobalHandler("modalViewDidDisappear",{}),$(".mbsc-fr-scroll").css("overflow-y","auto")},onShow:function(e,t){$(".mbsc-fr-scroll").css("overflow-y","hidden")}}),this.input.on("focus",function(e){e.preventDefault(),e.stopPropagation(),bizagi.util.isCordovaSupported()&&bizagi.util.isAndroidDevice()&&(cordova.plugins.Keyboard.disableScroll(!0),cordova.plugins.Keyboard.close())}),""===e.properties.displayValue&&e.properties.value){var o=e.getFormattedDate(e.properties.value,e.properties.showTime,!0,!1);if(void 0!==o){var s=bizagi.util.dateFormatter.formatDate(o,e.properties.fullFormat);this.input.prop("value",s)}}this.input.attr("keyboard","disable")},getTimeFormat:function(){return-1!==this.properties.timeFormat.indexOf("H")||-1!==this.properties.timeFormat.indexOf("HH")?(this.is24h=!0,"HH:ii"):(this.is24h=!1,"hh:ii A")},getFormattedDate:function(e,t,i){if(e&&!bizagi.util.isObjectEmpty(e)){e="string"!=typeof e?e.toString():e;var a=t&&("0:0"===this.getTime()||i)?" "+e.substr(e.length-8,e.length):"",r=i&&t&&a.split("/").length>1||1===e.split(":").length?e+=" 00:00:00":e;e=bizagi.util.dateFormatter.getDateFromInvariant(r,t);var n=t?""!==a?a:" "+this.getTime():" 00:00",o=this.setHour(this.getFullFormatedDate(e,n));return o=bizagi.util.dateFormatter.getDateFromISO(o,!0)}},changeMinValue:function(e){var t=this.properties,i=this.getDateControl();e&&this.properties.editable&&("number"==typeof e?(e=new Date(e),i.mobiscroll("option",{min:e}),e=bizagi.util.dateFormatter.formatInvariant(e,t.showTime)):i.mobiscroll("option",{min:bizagi.util.dateFormatter.getDateFromInvariant(e,!0)}),t.minValue=e)},changeMaxValue:function(e){var t=this.properties,i=this.getDateControl();e&&this.properties.editable&&("number"==typeof e?(e=new Date(e),i.mobiscroll("option",{max:e}),e=bizagi.util.dateFormatter.formatInvariant(e,t.showTime)):i.mobiscroll("option",{max:bizagi.util.dateFormatter.getDateFromInvariant(e,!0)}),t.maxValue=e)},setDisplayValue:function(e){var t=this,i=t.getFormattedDate(e,t.properties.showTime,!1),a=t.preprocessDateValue(i);t.input=t.input?t.input:t.getDateControl(),!1===t.properties.editable?"string"!=typeof a&&"number"!=typeof a||t.input.html(a):t.input.prop("value",a)},getDateControl:function(){return $(".bz-input-icon",this.getControl())},getTime:function(){var e=this;if(e.properties.showTime&&e.time&&""!==e.time.minutes){var t=e.time.hours+":"+e.time.minutes;return-1!=(t+=e.timeS).indexOf("am")&&12==e.time.hours&&(t=t.replace("12","0")),-1!=t.indexOf("pm")&&e.time.hours<12&&(t=t.replace(e.time.hours,parseInt(e.time.hours)+12)),t.replace(/(am|pm)/,"")}return""},getDate:function(){return this.date&&""!==this.date.month?this.date.year+"-"+(parseInt(this.date.month)+1)+"-"+this.date.day:""},onChangeHandler:function(e){var t=this,i=t.properties,a=t.getDate(),r=i.showTime?" "+t.getTime():" 0:00";if(""===a&&!i.showTime||""===a&&""===r||e)t.setValue(""),t.input.prop("value",""),i.displayValue="";else{var n=t.setHour(t.getFullFormatedDate(a,r));if(!(n=bizagi.util.dateFormatter.getDateFromISO(n,!0))||0==n)return;t.setNewDateValue(n,i.showTime);var o=t.preprocessDateValue(n);i.displayValue=o,t.input.prop("value",t.properties.displayValue)}},getFullFormatedDate:function(e,t){var i="";i=e.length>0?e:void 0!==e?bizagi.util.dateFormatter.formatISO(e,!1):bizagi.util.dateFormatter.formatISO(new Date,!1),i+=t;var a=bizagi.util.dateFormatter.getDateFromFormat(i,"yyyy-MM-dd H:m");return bizagi.util.dateFormatter.formatDate(0!==a?a:e,"yyyy-MM-dd H:mm:ss")},setNewDateValue:function(e,t){var i="";""!=e&&(i=bizagi.util.dateFormatter.formatInvariant(e,t)),this.setValue(i)},applyDateFormat:function(e,t){if(!t){var i=null,a=(i=-1!=e.indexOf("00:00")?e.indexOf("00:00"):-1!=e.indexOf("0:00")?e.indexOf("0:00"):-1!=e.indexOf("12:00")?e.indexOf("12:00"):"-1")+8;e=-1===i?e:e.replace(e.substring(i,a),"").replace(" am","").replace(" pm","")}return e},preprocessDateValue:function(e){return bizagi.util.dateFormatter.formatDate(e,this.properties.fullFormat)},isValid:function(e){var t=this,i=t.properties,a=!0,r=t.getValue();return r&&bizagi.util.parseBoolean(i.editable)&&0!=(r=bizagi.util.dateFormatter.getDateFromInvariant(r))&&(r.setHours(0,0,0,0),i.minValue&&"string"==typeof i.minValue&&(a=!t.validateMinAndMaxValue(r,!0,i,e)&&a),i.maxValue&&"string"==typeof i.maxValue&&(a=!t.validateMinAndMaxValue(r,!1,i,e)&&a)),bizagi.util.parseBoolean(i.editable)&&i.required&&!t.hasValue()&&t.showMandatoryMessage(i,e),a&&t.setValidationMessage(""),a},validateMinAndMaxValue:function(e,t,i,a){var r=bizagi.util.dateFormatter.getDateFromInvariant(t?i.minValue:i.maxValue);if(0==r){var n="";-1==i.timeFormat.indexOf(":ss")&&(n=t?i.minValue+":00":i.maxValue+":00"),r=bizagi.util.dateFormatter.getDateFromFormat(n,i.fullFormat+":ss")}if(r.setHours(0,0,0,0),t&&e<r||!t&&e>r){var o=bizagi.util.dateFormatter.formatDate(r,i.fullFormat),s="";return s=t?this.getResource("render-date-minimum-validation").replaceAll("#label#",i.displayName).replaceAll("#minValue#",o):this.getResource("rendr-date-maximum-validation").replaceAll("#label#",propertiee).replaceAll("#maxValue#",o),a.push({xpath:i.xpath,message:s}),!0}return!1},showMandatoryMessage:function(e,t){var i=this.getResource("render-required-text").replaceAll("#label#",e.displayName);return t.push({xpath:e.xpath,message:i}),!1},setHour:function(e){return e.replace(" 0:"," 00:").replace(" 1:"," 01:").replace(" 2:"," 02:").replace(" 3:"," 03:").replace(" 4:"," 04:").replace(" 5:"," 05:").replace(" 6:"," 06:").replace(" 7:"," 07:").replace(" 8:"," 08:").replace(" 9:"," 09:")},clearDisplayValue:function(){var e=this;e.date=void 0,e.time=void 0,e.timeS=void 0,e.onChangeHandler(!0),e.setDisplayValue("")},isValidMinMaxValue:function(){var e=this,t=!0,i=e.getValue();return i&&0!==(i=bizagi.util.dateFormatter.getDateFromInvariant(i))&&(i.setHours(0,0,0,0),e.properties.minValue&&"string"==typeof e.properties.minValue&&(t=e.validateMinAndMaxValue(i,!0)),e.properties.maxValue&&"string"==typeof e.properties.maxValue&&(t=e.validateMinAndMaxValue(i,!1))),t},validateMinAndMaxValue:function(e,t){var i=t?this.properties.minValue:this.properties.maxValue,a=bizagi.util.dateFormatter.getDateFromInvariant(i);return a.setHours(0,0,0,0),!(t&&e<a||!t&&e>a)},getElementsToStylize:function(e){return $("input",e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.actionLauncher",bizagi.rendering.actionLauncher.prototype),bizagi.rendering.smartphone.actionLauncher.extend("bizagi.rendering.smartphone.actionLauncher",{},{postRender:function(){if("design"!=this.getMode()){var e=this,t=e.properties,i=e.getControl();e.actions=[],e.startLoading(),$.when(e.dataService.multiaction().getActions(e.processPropertyValueArgs)).then(function(a){return a=e.getPropertiesActionLaucher(a),e.actions=a,e.deferredActions.resolve(a),e.actions.length>0?$("[data-element='actions-add-btn']",i).show():$("[data-element='actions-add-btn']",i).hide(),t.isHorizontal?"none"!=t.templatetype?e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs).then(function(i){return e.engine.render($.extend(i,{isDefaultTemplate:"default"===t.templatetype,sessionId:e.properties.sessionId}),e.processPropertyValueDataTmplArgs)}).then(function(t){template=e.renderFactory.getTemplate("render-actionLauncher-horizontal");var i=$($.fasttmpl(template,{template:!0}));return $(".bz-template",i.wrap("<div>").parent()).append(t),i}):void 0:(template=e.renderFactory.getTemplate("render-actionLauncher-horizontal"),$.fasttmpl(template,{template:!1}))}).done(function(t){$("[data-element='template-container']",i).append(t),e.configureActionsHandlers(),e.configureTemplateHandlers()}).always(function(){e.endLoading()})}},hasValue:function(){var e=this.getValue();return null!=e&&e.length>0},configureActionsHandlers:function(){var e=this,t=e.getControl();$(".action-launcher-control",t).on("click",function(){var t=e.actions[parseInt($(this).data("index"))],i={guidProcess:t[0],guidAction:t[4],displayName:t[1],actionType:t[3],xpathContext:void 0!==t[5]&&"true"===t[5],readOnlyForm:t[6]||!1,guidEntity:e.properties.guidEntity,xpathActions:e.properties.xpathActions||""};e.processAction(i)});for(var i=[],a=0,r=e.actions.length;a<r;a++)i.push({guid:e.actions[a][0],displayName:e.actions[a][1]});$("[data-element='actions-add-btn']",t).actionSheet({actions:i,actionClicked:function(t){var i=e.actions.find(function(e){return e[0]==t.guid});e.processAction({guidProcess:i[0],guidAction:i[4],displayName:i[1],actionType:i[3],xpathContext:void 0!==i[5]&&"true"===i[5],readOnlyForm:i[6]||!1,xpathActions:e.properties.xpathActions||""})}}),$.expr[":"].FilterAction=function(e,t,i){var a=i[3];return!!a&&new RegExp(a,"i").test($(e).text())},$("input#ui-bizagi-render-action-launcher-filter-input",t).keyup(function(){var e=$(this).val();$(".action-launcher-control",t).show(),e&&$(".action-launcher-control",t).not(":FilterAction("+e+")").hide()})},configureTemplateHandlers:function(){var e=this,t=e.getControl();e.engine.subscribe("onLoadDataNavigation",function(t,i){i.filters=[],e.triggerGlobalHandler("dataNavigation",i)}),$(".bz-template-more-or-less",t).bind("click",function(){$(".bz-template",t).toggleClass("bz-template--collapsed")})},processAction:function(e){var t=this,i=t.getControl(),a=t.properties;void 0===a.multipleSelection||a.multipleSelection?"Form"==e.actionType&&t.countSameActions(e)>=1&&!e.xpathContext?$(".action-to-execute-control[data-guidaction='"+e.guidAction+"'] label",i).click():$.when(t.actionManager(e)).done(function(e){t.executeAction(e)}):t.getValue().length>0?t.showConfirmationDialog(e):$.when(t.actionManager(e)).done(function(e){t.executeAction(e)})},notifyExecution:function(e,t){"success"==e.response?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,a=t.getParams(),r=t.properties.additionalXpath.join(","),n=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,o=new $.Deferred,s=new bizagi.rendering.smartphone.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:a.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){return t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:s.form.properties.xpathContext,idPageCache:i.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(i){e.editMode||0!==t.countSameActions(e)||(e.idStartScope=i.IdScope),o.resolve(i.IdScope)})},onCancel:function(e){}}),l={idForm:e.guidProcess,contextType:"start",idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?a.idWorkitem:void 0,additionalXpaths:r,xpathContext:n,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath};return"Form"===e.actionType&&(l.contextType="entitytemplate",l.xpathContext=void 0,l.guidEntity=e.guidEntity,l.rewriteContextType=!0),s.render(l),o.promise()},processActionFormCollection:function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=t.properties.additionalXpath.join(","),n=new $.Deferred,o=e.xpathContext?t.properties.xpathActions+"."+e.xpathContext:t.properties.xpathActions,s=""!==o?printf("%s[id=%s]",o,e.idEntity):o,l=""!==o?printf("%s[]",o):o,d=a.getParams();return new bizagi.rendering.smartphone.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:d.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(a){return e.editMode?t.dataService.multiaction().submitData({action:"SAVE",data:a,xpathContext:s,idPageCache:a.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(e){n.resolve(e.IdScope)}):t.dataService.addGridRecordData({idRender:i.id,xpathContext:o,contexttype:"start",idPageCache:a.idPageCache,submitData:a}).done(function(i){e.idStartScope=i.IdScope,e.idEntity=i.IdEntity,t.addActionToQueue(e),n.resolve(i.IdScope)})},onCancel:function(e){}}).render({idForm:e.guidProcess,contextType:"start",idCase:d.idCase,additionalXpaths:r,xpathContext:e.editMode?s:l,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,readOnlyForm:e.readOnlyForm,recordXpath:e.recordXpath}),n.promise()},processStartForm:function(e){var t=this,i=new $.Deferred;e=e||{};var a=t.getFormContainer().getParams();return new bizagi.rendering.smartphone.startForm(t.dataService,t.renderFactory,{title:e.title||"",navigation:a.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(e){i.resolve(e.IdScope)})}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?a.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),i.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.executeActionImmediately(e)})}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.setValue([]),$.when(t.actionManager(e)).done(function(e){t.executeAction(e)})})},setDisplayValue:function(e){var t=this,i=t.getControl(),a=$("[data-element='actions-container']",i),r=t.renderFactory.getTemplate("render-actionLauncher-actions-to-execute");t.configureQueueVisibility(),$.when(t.deferredActions).done(function(i){$.each(e,function(t,a){var r,n,o=(r=a.guidAction,n=[],$.each(i,function(e,t){t[4]==r&&(n=t)}),n);e[t].displayName=o[1],e[t].guidProcess=o[0],e[t].actionType=o[3],e[t].xpathContext=o[5],e[t].readOnlyForm=o[6],e[t].params&&e[t].params.idStartScope&&(e[t].idStartScope=e[t].params.idStartScope),e[t].params&&e[t].params.idPageCache&&(e[t].idPageCache=e[t].params.idPageCache),e[t].params&&e[t].params.idEntity&&(e[t].idEntity=e[t].params.idEntity)}),e.length>0?$.when($.fasttmpl(r,{actions:e})).done(function(e){a.empty(),a.append(e);var i=$(".bz-actions-to-execute .bz-btn-icn",a),r=$("label",a);i.on("click",function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)}),r.on("click",function(){var e=$(this).parent(),i=e.data("actiontype"),a=e.data("guidprocess"),r=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("readonlyform")||!1,l=e.data("identity")||"",d=e.data("guidaction"),c=o||t.properties.xpathContext;switch(i){case"Process":r&&t.processStartForm({guidprocess:a,idStartScope:r,title:n,xpathContext:o,recordXpath:c});break;case"Form":var p={guidProcess:a,idStartScope:r,editMode:!0,xpathContext:o,readOnlyForm:s,idEntity:l,recordXpath:c};if(p.xpathContext)t.processActionFormCollection(p);else{p.xpathContext=void 0;var u={},g=t.value.filter(function(e){return e.guidAction==d});g.length>0&&(u={actionType:"Form",contextType:"entitytemplate",guidEntity:t.properties.guidEntity||g[0].guidEntity}),t.processActionForm($.extend(p,u))}}})}):a.empty()})},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-action-launcher-actions-to-execute-container",e),i=$(".action-to-execute-label",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.smartphone.actionLauncher.extend("bizagi.rendering.smartphone.entityTemplate",{},{postRender:function(){if("design"!=this.getMode()){var e=this,t=e.properties,i=e.getControl();e.actions=[],e.configureQueueVisibility(),e.startLoading(),e.dataService.multiaction().getPropertyData(e.processPropertyValueDataTmplArgs).then(function(a){return e.engine.render(a,e.processPropertyValueDataTmplArgs).then(function(a){var r=e.renderFactory.getTemplate("render-actionLauncher-horizontal"),n=$($.fasttmpl(r,{template:!0}));return $(".bz-template",n.wrap("<div>").parent()).append(a),t.allowactions?e.dataService.multiaction().getActions(e.processPropertyValueArgs).then(function(t){return e.deferredActions.resolve(t),e.actions=t,e.actions.length>0?$("[data-element='actions-add-btn']",i).show():$("[data-element='actions-add-btn']",i).hide(),n}):n})}).done(function(t){$("[data-element='template-container']",i).append(t),e.configureActionsHandlers(),e.configureTemplateHandlers()}).always(function(){e.endLoading()})}},configureActionsHandlers:function(){var e=this,t=e.getControl();$(".action-launcher-control",t).on("click",function(){var t=e.actions[parseInt($(this).data("index"))],i={guidProcess:t[0],guidAction:t[4],displayName:t[1],actionType:t[3],xpathContext:void 0!==t[5]&&"true"===t[5],xpathActions:e.properties.xpathActions||""};"Form"===i.actionType&&(i.xpathContext=void 0,i.contextType="entitytemplate",i.guidEntity=e.properties.guidEntity),e.processAction(i)});for(var i=[],a=0,r=e.actions.length;a<r;a++)i.push({guid:e.actions[a][0],displayName:e.actions[a][1]});$("[data-element='actions-add-btn']",t).actionSheet({actions:i,actionClicked:function(t){var i=e.actions.find(function(e){return e[0]==t.guid});e.processAction({guidProcess:i[0],guidAction:i[4],displayName:i[1],actionType:i[3],xpathContext:void 0!==i[5]&&"true"===i[5]})}})},configureTemplateHandlers:function(){var e=this,t=e.getControl();e.engine.subscribe("onLoadDataNavigation",function(t,i){i.filters=[],i.calculateFilters=i.calculateFilters||!0,e.triggerGlobalHandler("dataNavigation",i)}),$(".bz-template-more-or-less",t).bind("click",function(){$(".bz-template",t).toggleClass("bz-template--collapsed")})}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.polymorphicLauncher",bizagi.rendering.polymorphicLauncher.prototype),bizagi.rendering.smartphone.polymorphicLauncher.extend("bizagi.rendering.smartphone.polymorphicLauncher",{},{postRender:function(){var e,t=this,i=t.properties;return"design"!=t.getMode()&&t.properties.surrogatedKey?(t.configureQueueVisibility(),$.when(t.dataService.multiaction().getPolymorphicActions(t.processPropertyValueArgs)).done(function(a){a=t.dataService.serializePolymorphicActions(a),t.totalActions=bizagi.clone(a);var r=bizagi.clone(a);t.lessActions=bizagi.clone(r);var n={actions:r,allowSearch:i.allowSearch,treeActionsList:t.getTreeItems(r)};e=t.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree");var o=t.getControl();$(".bz-polymorphic-launcher__constructors",o).append($.fasttmpl(e,n)),t.bindHandlers()})):""},getTreeItems:function(e,t){var i=this,a="<ul>",r=i.renderFactory.getTemplate("render-polymorphicLauncher-vertical-tree-item");return e=e||{},t=t||1,$.each(e,function(e,n){a+=$.fasttmpl(r,n),n.children&&(a+=i.getTreeItems(n.children,t+1))}),a+="</ul>"},bindHandlers:function(){var e=this,t=e.getControl();$(".bz-polymorphic-launcher__constructors li span",t).on("click",function(){var t=$(this).parent(),i={guidEntity:t.data("guidentity"),guidObject:t.data("guidobject"),guidConstructor:t.data("guidconstructor"),displayName:t.data("display-name"),actionType:t.data("action-type"),xpathContext:t.data("xpathcontext")};e.onActionClicked(i)}),$.expr[":"].FilterAction=function(e,t,i){var a=i[3];return!!a&&new RegExp(a,"i").test($(e).text())},$("input[data-action=search]",t).keyup(function(){var e=$(this).val();$(".bz-polymorphic-launcher__constructors li",t).show(),e&&$(".bz-polymorphic-launcher__constructors li",t).not(":FilterAction("+e+")").hide()})},onActionClicked:function(e){var t=this;$.when(t.actionManager(e)).done(function(e){t.executeAction(e)})},notifyExecution:function(e,t){"success"==e?$.notifier.add({class_name:"success",title:t.displayName,text:this.getResource("render-action-launcher-success-excecution").replace("%s",t.displayName),sticky:!1}):$.notifier.add({class_name:"error",title:t.displayName,text:this.getResource("render-action-launcher-failed-excecution").replace("%s",t.displayName),sticky:!1})},processActionForm:function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=t.properties.additionalXpath.join(","),n=new $.Deferred,o=(e.xpathContext,a.getParams()),s=t.properties.recordXpath,l=new bizagi.rendering.smartphone.slide.form(t.dataService,t.renderFactory,{title:i.detailLabel||bizagi.localization.getResource("render-grid-details-form"),navigation:o.navigation,showSaveButton:!0,cancelButtonLabel:bizagi.localization.getResource("render-form-dialog-box-close"),onSave:function(i){var a=i.idPageCache;return i.idPageCache=null,t.dataService.multiaction().submitData({action:"SAVE",data:i,xpathContext:l.form.properties.xpathContext,idPageCache:a,isOfflineForm:!1,isActionStartForm:!0}).done(function(i){e.editMode||0!=t.countSameActions(e)||(e.idStartScope=i.IdScope),n.resolve(i.IdScope)})},onCancel:function(e){}});return l.render({idForm:e.guidObject,contextType:"entity",guidEntity:e.guidEntity,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?o.idWorkitem:void 0,additionalXpaths:r,idStartScope:e.idStartScope,surrogateKey:t.properties.surrogatedKey,recordXpath:s}),n.promise()},processStartForm:function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=new $.Deferred,n=a.getParams();return e=e||{},new bizagi.rendering.smartphone.startForm(t.dataService,t.renderFactory,{maximized:i.maximized,title:e.title||"",navigation:n.navigation,saveButtonLabel:"GlobalForm"==t.typeForm||"SummaryForm"==this.typeForm?bizagi.localization.getResource("render-form-button-create"):bizagi.localization.getResource("render-form-dialog-box-save"),onSave:function(e){return a.startLoading(),t.dataService.multiaction().submitData({action:"SAVE",data:e,xpathContext:t.properties.xpathContext,idPageCache:e.idPageCache,isOfflineForm:!1,isActionStartForm:!0}).done(function(e){a.endLoading(),r.resolve(e.IdScope)})}}).render({guidprocess:e.guidprocess,idStartScope:e.idStartScope,idCase:t.properties.caseId,idWorkitem:"SummaryForm"!=t.typeForm?n.idWorkitem:void 0,additionalXpaths:t.properties.additionalXpath.join(","),surrogatedKey:t.properties.surrogatedKey,recordXpath:e.recordXpath,mappingstakeholders:!0}),r.promise()},executeAction:function(e){var t=this;if("GlobalForm"==t.typeForm||"SummaryForm"==t.typeForm){var i=bizagi.localization.getResource("render-action-launcher-immediatly-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.executeActionImmediately(e)})}else t.addActionToQueue(e)},showConfirmationDialog:function(e){var t=this,i=bizagi.localization.getResource("render-action-launcher-single-action-confirmation");$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){t.setValue([]),$.when(t.actionManager(e)).done(function(e){t.executeAction(e)})})},setDisplayValue:function(e){var t=this,i=t.getControl(),a=$(".bz-polymorphic-launcher-constructors-to-execute-container",i),r=t.renderFactory.getTemplate("render-polymorphicLauncher-actions-to-execute");t.configureQueueVisibility(),$.when($.fasttmpl(r,{actions:e})).done(function(e){a.empty(),a.append(e);var i=$(".bz-pill .bz-btn-icn",a),r=$(".bz-pill__label",a);i.on("click",function(){var e=$(this).parent().data("index");t.removeActionToQueue(e)}),r.bind("click",function(){var e=$(this).parent(),i=e.data("actiontype"),a=e.data("guidprocess"),r=e.data("idstartscope"),n=e.data("title"),o=e.data("xpathcontext"),s=e.data("identity")||"",l=e.data("guidentity"),d=o||t.properties.xpathContext;switch(i){case"Process":r&&t.processStartForm({guidprocess:a,idStartScope:r,title:n,xpathContext:o,recordXpath:d});break;case"Form":var c={guidProcess:a,idStartScope:r,editMode:!0,xpathContext:o,idEntity:s,guidEntity:l,guidObject:a};t.processActionForm(c)}})})},configureQueueVisibility:function(){var e=this.getControl(),t=$(".bz-polymorphic-launcher-constructors-to-execute-container",e),i=$(".bz-polymorphic-launcher__title",e);this.getValue().length>0?(t.show(),i.show()):(t.hide(),i.hide())}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.yesno",bizagi.rendering.yesno.prototype),bizagi.rendering.smartphone.yesno.extend("bizagi.rendering.smartphone.yesno",{},{postRender:function(){var e=this.getControl();this.radio=e.find("input[type=radio]"),!this.properties.editable||null!=this.value&&void 0!==this.value||null==this.properties.value||(this.value=this.properties.value)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.radio=e.find("input"),this._super()},setDisplayValue:function(e){var t=this.getControl(),i=bizagi.util.parseBoolean(e);this.setValue(i,!1),this.properties.editable?i?(t.find("input[value=true]").prop("checked",!0),t.find("input[value=false]").prop("checked",!1)):(t.find("input[value=false]").prop("checked",!0),t.find("input[value=true]").prop("checked",!1)):this.radio.val(this.getDisplayValue())},configureHandlers:function(){var e=this;e.radio.change(function(){var t=$(this).prop("value");e.value!==t&&e.setValue(t)})},getElementsToStylize:function(e){return $("label.bz-radio__label",e)},cleanData:function(){this.setValue({id:"",label:""},!1),this.clearDisplayValue()},clearDisplayValue:function(){this.properties.editable?this.radio.prop("checked",!1):this.radio.val(this.getDisplayValue())}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.check",bizagi.rendering.check.prototype),bizagi.rendering.smartphone.check.extend("bizagi.rendering.smartphone.check",{},{postRender:function(){var e=this.getControl();this.check=e.find("input"),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.check=e.find("input"),this._super()},setDisplayValue:function(e){var t=bizagi.util.parseBoolean(e);this.setValue(t,!1),this.properties.editable?t?this.check.attr("checked","checked"):this.check.removeAttr("checked"):this.check.val(this.getDisplayValue())},configureHandlers:function(){var e=this;this.check.on("click",function(t){var i=$(this).is(":checked");e.setValue(i,!0)})},cleanData:function(){this.setDisplayValue(!1),this.setValue(!1,!1)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.checkList",bizagi.rendering.checkList.prototype),bizagi.rendering.smartphone.checkList.extend("bizagi.rendering.smartphone.checkList",{},{postRender:function(){this._super(),this.properties.unique=Math.ceil(1e3*Math.random()),this.properties.required=!0},configureHandlers:function(){var e=this;e._super(),$("input[type=checkbox]",e.getControl()).bind("change",function(){var t=$(this).data("item-guid");e.onCheckListGroupChange(t,this.checked)})},onCheckListGroupChange:function(e,t){var i,a=$.grep(this.properties.items,function(t,i){return t.guid===e});a&&a.length>0&&(i=a[0]),i.checked=t},clearDisplayValue:function(){$("input[type=checkbox]",this.getControl()).removeAttr("checked")},setDisplayValue:function(e){}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.list",bizagi.rendering.combo.prototype),bizagi.rendering.smartphone.list.extend("bizagi.rendering.smartphone.list",bizagi.rendering.list.prototype),bizagi.rendering.smartphone.list.extend("bizagi.rendering.smartphone.list",{},{renderControl:function(){var e=this.renderFactory.getTemplate("list");return $.fasttmpl(e,{editable:this.properties.editable,value:this.getDisplayValue()})},configureHandlers:function(){var e=this,t=e.getControl();"execution"===e.getMode()&&$(".bz-form-list",t).bind("click",function(){$(this).mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),displayName:e.properties.displayName||"",orientation:e.properties.orientation||"",contentTemplate:"",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},open:function(){e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){var i={};if(e.isDependant&&e.properties&&/^cascadingcombo$/i.test(e.properties.type)&&e.getParentCombo){var a=e.getParentCombo().getValue();a&&a.id&&(i[e.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=a.id)}$.when(e.renderCombo(i)).done(function(i){$(".bz-modal-view__content",t.content).html(i),e.configureModalViewHandlers(t)})}})})},processComboData:function(e){var t=this;e.forEach(function(e){t.validateValue(e)})},setDisplayValue:function(e){var t;if((e=this.mapValue(e))&&"object"==typeof e&&void 0!==e.label){if(""===e.label||bizagi.util.isNumeric(e.label)){var i=this.findDataValueById(e.value);t=i?i.value:""}else t=e.label;$.isArray(t)&&(t=t.join(" - ")),e={id:e.id,value:t}}var a=this.getControl();$("input",a).val(this.formatItem(e.value)),this.selectedValue=e,this.setValue(e)},configureModalViewHandlers:function(e){var t=this;$(".bz-list__item",e.content).on("click",function(){var i={id:$(this).data("value"),value:$(this).text()};""==i.id&&(i.value=""),t.setDisplayValue(i),t.trigger("select",[i,!1]),e.close()});var i=$(".bz-list li",e.content),a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);$("[data-action=close]",e.header).bind("click",function(){e.close()}),a.bind("click",function(){r.val("").trigger("change")}),r.bind("change keyup",function(){""==this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)}).focus()},filterList:function(e,t){t.filter(function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()}).show()},renderComboTemplate:function(e){var t=this.renderFactory.getTemplate("list-items"),i=this.getValue();return i=null!=i?i:{id:"",value:""},$.fasttmpl(t,{items:e,selectedId:i.id,hasItems:e.length>0},{validateItem:this.validateValue})},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".readonly-control",e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.multiSelect",bizagi.rendering.multiSelect.prototype),bizagi.rendering.smartphone.multiSelect.extend("bizagi.rendering.smartphone.multiSelect",{MORE_OPTION_WIDTH:40,SEARCH_MIN_LENGTH:1},{renderReadOnly:function(){var e=this.renderFactory.getTemplate("searchList.readonly");return $.fasttmpl(e,{items:this.properties.value||{},editable:this.properties.editable||!0},{formatItem:this.formatItem})},postRender:function(){var e=this;this.isExecutionMode()&&this.getData().done(function(t){e.properties.data=t}),this._super()},configureHandlers:function(){var e=this,t=e.getControl();$("[data-action=modal]",t).bind("click",function(){e.openModalView()})},setDisplayValue:function(e){var t=this;this._super(e),void 0!==e&&$(".bz-input-icon__input",this.getControl()).html(e.map(function(e){return t.formatItem(e.value)}).join(", "))},openModalView:function(){var e=this;e.getData().done(function(t){var i=e.renderFactory.getTemplate("multiselect-list"),a=e.getValue();$.isArray(a)||(a="string"==typeof a?JSON.parse(a).value:a.value);var r={values:t,isChecked:function(t){return e.isChecked(a,t)}},n=$.fasttmpl(i,r,{formatItem:e.formatItem}),o=e.renderFactory.getTemplate("modal-footer-done"),s=$.fasttmpl(o,{});e.getControl().mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),orientation:e.properties.orientation||"",contentTemplate:n,footerTemplate:s,transition:"slideIn:up",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(){e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.configureModalViewHandlers(t)}})})},configureModalViewHandlers:function(e){var t=this,i=$(".bz-checkbox-list li",e.content),a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);r.on("change keyup",function(){""==this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)}).on("focus",function(){e.header.addClass("bz-modal-view__header--active")}).on("blur",function(){e.header.removeClass("bz-modal-view__header--active")}),a.on("click",function(){r.val("").trigger("change")}),$("[data-action=close]",e.header).on("click",function(){e.close()}),$(e.footer).on("click","[data-action=save]",function(a){var r=[];$.each.call(this,i,function(e,t){var i=t.querySelector("input");if(i.checked){var a=i.getAttribute("data-id"),n=this.findItemById(a).value;r.push({id:a,value:n})}}.bind(t)),t.setDisplayValue(r),e.close()})}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.radio",bizagi.rendering.combo.prototype),bizagi.rendering.smartphone.radio.extend("bizagi.rendering.smartphone.radio",bizagi.rendering.radio.prototype),bizagi.rendering.smartphone.radio.extend("bizagi.rendering.smartphone.radio",{},{postRender:function(){var e=this.getControl();this.radio=e.find("input[type=radio]"),!this.properties.editable||null!=this.value&&void 0!==this.value||null==this.properties.value||(this.value=this.properties.value)},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.radio=e.find("input")},setDisplayValue:function(e){var t=this,i=t.getControl();(e=t.mapValue(e),t.setValue(e,!1),void 0!==e&&null!=e.id&&""!==e.id)&&(this.properties.editable?i.find('input[type="radio"][value="'+e.id+'"]').prop("checked","checked"):(t.radio.val(this.getDisplayValue()),t.radio.attr("id",e.id)))},configureHandlers:function(){var e=this;this.radio.change(function(){var t=$(this),i={id:t.prop("value"),value:$.trim(t.siblings("label").text())};e.setValue(i)})},getElementsToStylize:function(e){return $("label.bz-radio__label",e)},cleanData:function(){this.setValue({id:"",label:""},!1),this.clearDisplayValue()},clearDisplayValue:function(){this.properties.editable?this.radio.prop("checked",!1):this.radio.val(this.getDisplayValue())}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.cascadingCombo",bizagi.rendering.combo.prototype),bizagi.rendering.smartphone.cascadingCombo.extend("bizagi.rendering.smartphone.cascadingCombo",bizagi.rendering.cascadingCombo.prototype),bizagi.rendering.smartphone.cascadingCombo.extend("bizagi.rendering.smartphone.cascadingCombo",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX},{renderControl:function(){var e=this.getMode();return this.parentCombo=this.getParentCombo(),null!=this.parentCombo&&/cascadingcombo/i.test(this.parentCombo.properties.type)&&(this.isDependant=!0),this.initializingCascadingCombo=!0,"execution"!=e&&(this.initializingCascadingCombo=!1),bizagi.rendering.smartphone.combo.prototype.renderControl.apply(this,arguments)},postRender:function(){bizagi.rendering.smartphone.combo.prototype.postRender.apply(this,arguments)},configureHandlers:function(){this._super(),bizagi.rendering.smartphone.combo.prototype.configureHandlers.apply(this,arguments)},cleanData:function(){bizagi.rendering.smartphone.combo.prototype.cleanData.apply(this,arguments)},refresh:function(e,t){var i=this;$.when(i.isRendered()).done(function(){var e=i.getControl(),a=i.getMode();e.empty(),$.when(i.renderControl()).then(function(r){e.html(r),i.postRender(),"execution"==a&&i.configureHandlers(),t?i.setDisplayValue(i.getValue()):i.setDisplayValue({id:"",value:""}),i.deferredVisible&&i.deferredVisible.resolve(),i.trigger("select",[i.getValue(),t])})})},setDisplayValue:function(e){bizagi.rendering.smartphone.combo.prototype.setDisplayValue.apply(this,arguments)},processComboData:function(){bizagi.rendering.smartphone.combo.prototype.processComboData.apply(this,arguments)},validateValue:function(){return bizagi.rendering.smartphone.combo.prototype.validateValue.apply(this,arguments)},renderComboTemplate:function(){return bizagi.rendering.smartphone.combo.prototype.renderComboTemplate.apply(this,arguments)},configureModalViewHandlers:function(){bizagi.rendering.smartphone.combo.prototype.configureModalViewHandlers.apply(this,arguments)},configureCombo:function(){bizagi.rendering.smartphone.combo.prototype.configureCombo.apply(this,arguments)},changeCombo:function(e,t){bizagi.rendering.smartphone.combo.prototype.changeCombo.apply(this,arguments)},getSelectedValue:function(){return bizagi.rendering.smartphone.combo.prototype.getSelectedValue.call(this,arguments)},getTemplateName:function(){return"combo"},filterList:function(e,t){return bizagi.rendering.smartphone.combo.prototype.filterList.call(this,e,t)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.combo",bizagi.rendering.combo.prototype),bizagi.rendering.smartphone.combo.extend("bizagi.rendering.smartphone.combo",{},{renderControl:function(){var e=this.renderFactory.getTemplate("combo");return $.fasttmpl(e,{editable:this.properties.editable,value:this.getDisplayValue()})},postRender:function(){this._super(),this.itemSelected=void 0},configureHandlers:function(){var e=this,t=e.getControl();"execution"===e.getMode()&&$(".bz-form-combo",t).bind("click",function(){$(this).mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),displayName:e.properties.displayName||"",orientation:e.properties.orientation||"",contentTemplate:"",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},open:function(){e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){var i={};if(e.isDependant&&e.properties&&/cascadingcombo/i.test(e.properties.type)&&e.getParentCombo){var a=e.getParentCombo().getValue();a&&a.id&&(i[e.Class.BA_ACTION_PARAMETER_PREFIX+"parent"]=a.id)}$.when(e.renderCombo(i)).done(function(i){$(".bz-modal-view__content",t.content).html(i),e.configureModalViewHandlers(t)})}})})},processComboData:function(e){var t=this;e.forEach(function(e){t.validateValue(e)})},setDisplayValue:function(e){var t;if((e=this.mapValue(e))&&"object"==typeof e&&void 0!==e.label){if(""===e.label||bizagi.util.isNumeric(e.label)){var i=this.findDataValueById(e.value);t=i?i.value:""}else t=e.label;$.isArray(t)&&(t=t.join(" - ")),e={id:e.id,value:t}}var a=this.getControl();$("input",a).val(this.formatItem(e.value)),this.selectedValue=e,this.setValue(e)},configureModalViewHandlers:function(e){var t=this;$(".bz-list__item",e.content).on("click",function(){var i={id:$(this).data("value"),value:$(this).text()};""==i.id&&(i.value=""),t.itemSelected=!0,t.setDisplayValue(i),t.trigger("select",[i,!1]),e.close()});var i=$(".bz-list li",e.content),a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);$("[data-action=close]",e.header).bind("click",function(){e.close()}),a.bind("click",function(){r.val("").trigger("change")}),r.bind("change keyup",function(){""==this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),t.filterList(this.value,i)}).focus()},cleanData:function(){this.setDisplayValue({id:"",label:""})},filterList:function(e,t){t.filter(function(){var t=$(this).text().toUpperCase(),i=e.toUpperCase();if(t.indexOf(i)>=0)return $(this);$(this).hide()}).show()},renderComboTemplate:function(e){var t=this.renderFactory.getTemplate("combo-list"),i=this.getValue();return i=null!=i?i:{id:"",value:""},$.fasttmpl(t,{items:e,selectedId:i.id,hasItems:e.length>0},{validateItem:this.validateValue})},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".readonly-control",e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.collectionnavigator",bizagi.rendering.collectionnavigator.prototype),bizagi.rendering.smartphone.collectionnavigator.extend("bizagi.rendering.smartphone.collectionnavigator",{},{postRender:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")},postRenderReadOnly:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.hidden",bizagi.rendering.hidden.prototype),bizagi.rendering.smartphone.hidden.extend("bizagi.rendering.smartphone.hidden",{},{}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.upload",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.upload.prototype),bizagi.rendering.smartphone.upload.extend("bizagi.rendering.smartphone.upload",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{isNative:!1,isOfflineForm:!1,initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported()},renderControl:function(){var e=this.renderFactory.getTemplate("upload");return this.renderItem(e,{})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("upload-readonly"),t={noFiles:0===this.filesCount};return this.renderItem(e,t)},renderItem:function(e,t){for(var i=this,a="",r=$.fasttmpl(e,t),n=0;n<i.filesCount;n++){var o={id:i.files[n][0],fileName:i.files[n][1]};a+=i.renderUploadItem(o)}return r=i.replaceFilesHtml(r,a)},postRender:function(){var e=this.getControl();this.$contentFile=$(".bz-file-upload__container",e),this.$inputFile=$(".bz-file-upload__input",e),this.$nativeFile=$(".bz-file-upload__native",e)},configureHandlers:function(){this.checkFileExtensions(),this.attachEvents()},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-readonly-lists",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})})},attachEvents:function(){var e=this,t=e.getControl();this.$contentFile.off("click").on("click",function(t){e.chooseFile()}),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})}),$("ul.bz-files",t).on("click",".bz-file .bz-icn",function(){var t=$(this).parent(".bz-file"),i=t.data();e.removeFile(t,i.id)}),e.isNative?(this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-file-upload__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),$.when(e.handlerResolutionUpload(t.guid)).always(function(){bizagi.loading.stop()})},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})):(this.$inputFile.off("change").on("change",function(){e.addFile(),this.value=""}),this.$inputFile.off("click").on("click",function(e){e.stopPropagation()}))},handlerUploadFile:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture(function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then(function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i)){var a=bizagi.util.getAndroidVersion();if(a&&a<=4.2||t.isOfflineForm)return t.saveImage(t.dataImage);if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then(function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.handlerResolutionUpload(e)});$(".bz-file-upload__resolution",t.getControl()).click()}})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,correctOrientation:!0,sourceType:Camera.PictureSourceType.PHOTOLIBRARY});break;case 1:navigator.camera.getPicture(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then(function(i){return t.fileProperties=i,t.saveImage(e)})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;case 3:navigator.device.capture.captureVideo(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSizeVideo(e,t.properties)).then(function(){return t.saveVideo(e)}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{limit:t.Class.LIMIT})}},handlerResolutionUpload:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.saveImage(t.dataImage);var a=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,a)).then(function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.saveImage(t.dataImage)})},saveImage:function(e){var t=this,i="";t.editedImageURL?i=t.editedImageURL:t.fileProperties&&(i=t.fileProperties.url);var a={dataFile:bizagi.util.media.getImagePath(i),fileName:t.fileProperties.name,mimeType:"image/jpeg"};return t.editedImageURL=null,t.fileProperties=null,this.uploadFile(a)},saveVideo:function(e){var t={dataFile:e[0].fullPath,fileName:e[0].name,mimeType:"video/quicktime"};return this.uploadFile(t)},uploadFile:function(e){var t=this,i={},a=t.buildAddParams();return a.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),i.data=a,i.options=new FileUploadOptions,i.options.fileKey="file",i.options.fileName=e.fileName,i.options.uploadKey={key:a.h_xpath},i.options.addUrl=t.properties.addUrl,i.dataFile=e.dataFile,e.mimeType&&(i.options.mimeType=e.mimeType),$.when(bizagi.util.media.uploadFile(i)).then(function(e){var i=JSON.parse(decodeURIComponent(e.response));"error"===i.type?bizagi.showMessageBox(i.message,i.errorType):t.onUploadFileCompleted(i)}).fail(function(e){t.executeFormFailHandler(e)})},onFail:function(e){var t=bizagi.util.processFailMessage(e);if(bizagi.loading.stop(),t&&"string"==typeof t&&-1!==t.indexOf("No Activity found to handle Intent")){var i=bizagi.util.isValidResource("render-upload-error-media-app")?bizagi.localization.getResource("render-upload-error-media-app"):"Your device does not have an app to execute this action.";bizagi.showMessageBox(i)}},onUploadFileCompleted:function(e){var t=this,i=$(".bz-files",t.getControl());if(e.id&&e.fileName){var a=t.renderUploadItem(e);i.append(a),t.filesCount=t.filesCount+1;var r=t.files.slice();r.push([e.id,e.fileName]),t.setValue(r,!0),t.checkMaxFiles(),t.editedImageURL=null}else bizagi.showMessageBox(e.message,"Error")},checkMaxFiles:function(){this.isMaxFilesReached()?$(this.$contentFile).addClass("bz-file-upload__container--hidden"):$(this.$contentFile).removeClass("bz-file-upload__container--hidden")},isMaxFilesReached:function(){var e=this.properties.maxfiles,t=this.properties.value?this.properties.value.length:0;return 0!==e&&this.filesCount>=e&&t>=e},checkFileExtensions:function(){var e=this,t=e.properties.validExtensions||"";if(e.validOptions={video:!1,image:!1,file:!1},void 0===(t=t.replace(/\s+/g,"").toLowerCase())||""===t)e.validOptions={video:!0,image:!0,file:!0};else if(1===(t=t.split(";")).length&&-1!==t[0].indexOf("*.*"))e.validOptions.video=!0,e.validOptions.image=!0;else for(var i=0,a=t.length;i<a;i++)t[i]=t[i].replace("*.",""),e.Class.EXTENSIONSFILE.toString().indexOf(t[i])>=0?e.validOptions.file=!0:e.Class.EXTENSIONSIMG.toString().indexOf(t[i])>=0?e.validOptions.image=!0:e.Class.EXTENSIONSVIDEO.toString().indexOf(t[i])>=0&&(e.validOptions.video=!0);e.validOptions.file||e.validOptions.image||e.validOptions.video||$(e.$contentFile).addClass("bz-file-upload__container--hidden"),!e.isMaxFilesReached()&&(e.isNative||bizagi.util.media.fileAPISupported()&&!e.isOfflineForm)||$(this.$contentFile).addClass("bz-file-upload__container--hidden")},buildAddFileParams:function(e){var t=this,i=t.Class.BA_CONTEXT_PARAMETER_PREFIX,a=new FormData,r=t.getFormContainer();a.append(i+"xpath",t.getUploadXpath()),a.append(i+"idRender",t.properties.id),a.append(i+"xpathContext",t.properties.xpathContext),a.append(i+t.Class.BA_PAGE_CACHE,t.properties.idPageCache),a.append(t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",r.properties.sessionId),a.append(t.properties.xpath,e),t.properties.contexttype&&a.append(i+"contexttype",t.properties.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?a.append(BIZAGI_SESSION_NAME,r.properties.sessionId):a.append("JSESSIONID",r.properties.sessionId)}catch(e){a.append("JSESSIONID",r.properties.sessionId)}return a},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},clearDisplayValue:function(){var e=this,t=$(".bz-files",e.getControl());$(".bz-file",t).each(function(t,i){var a=(i=$(i)).data();e.removeFile(i,a.id)})},getUploadChoices:function(){var e=[];return this.validOptions.image&&(e.push({guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}),e.push({guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")})),this.validOptions.video&&e.push({guid:3,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-video")}),[].concat(e)},executeFormFailHandler:function(e){var t="";t=e&&e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error"),this.getFormContainer().failHandler(t)},chooseFile:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&!this.isOfflineForm&&this.$inputFile.click()},addFile:function(){var e=this,t=this.$inputFile[0].files[0],i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSFILE,e.Class.EXTENSIONSVIDEO);t.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.processUploadFile(t)).then(function(t){e.onUploadFileCompleted(JSON.parse(decodeURIComponent(t)))}).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()}):bizagi.loading.stop()},removeFile:function(e,t){var i=this;$.when(i.deleteUploadItem(e,t)).done(function(){e.hide(),e.remove(),i.setValue(i.files,!1),i.checkMaxFiles(),i.triggerRenderChange()})},getTemplateItemName:function(){return"upload-item"},getElementsToStylize:function(e){return $(".bz-input-icon__input",e)}}),bizagi.rendering.smartphone.upload.extend("bizagi.rendering.smartphone.upload.offline",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"]},{initializeData:function(e){this._super(e);var t=Number(this.properties.maxSize)||1048576,i="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;this.properties.maxSize=t<i?t:i,this.updateFilesCount()},renderItem:function(e,t){for(var i="",a=$.fasttmpl(e,t),r=0;r<this.files.length;r++){var n=this.files[r];if(n.status&&"deleted"!==n.status&&"new-deleted"!==n.status)i+=this.renderUploadItem(n,r)}return a=this.replaceFilesHtml(a,i)},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-files",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file");e.openOfflineFile(t)})},attachEvents:function(){var e=this,t=e.getControl();this.$contentFile.off("click").on("click",function(t){e.isNative?e.$nativeFile.click():e.$inputFile.click(),e.$inputFile.off("change").on("change",function(){e.handlerWebUploadFile()})}),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file");e.openOfflineFile(t)}),$("ul.bz-files",t).on("click",".bz-file .bz-icn",function(){var t=$(this).parent(".bz-file");e.removeOfflineFile(t)}),e.isNative&&this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})},handlerWebUploadFile:function(){var e,t,i=this,a=i.$inputFile[0].files[0],r=bizagi.util.randomNumber();$.when(i.getBlobFromPath(a)).then(function(a){return bizagi.loading.start(),t=a.type,e=a.name,i.saveOfflineFile(a,r,t)}).then(function(a){i.onUploadOfflineFileCompleted(e,t,r)}).always(function(){bizagi.loading.stop()}),i.$inputFile[0].value=""},handlerUploadFile:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture(function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then(function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i))return t.saveImage(t.dataImage)})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,correctOrientation:!0});break;case 1:navigator.camera.getPicture(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then(function(i){return t.fileProperties=i,t.saveImage(e)})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;default:console.log("The option is not supported!")}},addInteractions:function(){var e=this,t=e.getControl();$("ul.bz-files",t).on("click",".bz-file .bz-file__delete",function(){var t=$(this).parent(".bz-file");e.removeOfflineFile(t)})},collectData:function(e){var t=this;t.filesCount>0?e[t.properties.xpath]=t.files:"delete"===t.properties.method&&(e[t.properties.xpath]=[],delete t.properties.method)},saveImage:function(e){var t=this;bizagi.loading.start();var i,a=bizagi.util.randomNumber(),r=t.fileProperties.name;$.when(t.getBlobFromPath(e)).always(function(){bizagi.loading.stop()}).then(function(e){return i=e.type,r=e.name,t.saveOfflineFile(e,a,i)}).then(function(e){t.onUploadOfflineFileCompleted(r,i,a)}),t.$inputFile[0].value=""},checkFileExtensions:function(){var e=this,t=e.properties.validExtensions||"";if(e.validOptions={video:!1,image:!1,file:!1},void 0===(t=t.replace(/\s+/g,"").toLowerCase())||""===t)e.validOptions.image=!0;else if(1===(t=t.split(";")).length&&-1!==t[0].indexOf("*.*"))e.validOptions.image=!0;else for(var i=0,a=t.length;i<a;i++)t[i]=t[i].replace("*.",""),e.Class.EXTENSIONSIMG.toString().indexOf(t[i])>=0&&(e.validOptions.image=!0);e.validOptions.image||$(e.$contentFile).addClass("bz-file-upload__container--hidden"),!e.isMaxFilesReached()&&bizagi.util.media.fileAPISupported()||$(this.$contentFile).addClass("bz-file-upload__container--hidden")},onUploadOfflineFileCompleted:function(e,t,i){var a=this,r=$(".bz-files",a.getControl()),n={id:i,fileName:e,mimeType:t,status:"new"},o=a.renderUploadItem(n,a.files.length);r.append(o),a.filesCount=a.filesCount+1;var s=a.files.slice();s.push(n),a.setValue(s,!1),a.checkMaxFiles()},renderUploadItem:function(e,t){var i=this.getTemplateItemName(),a=this.renderFactory.getTemplate(i);return $.fasttmpl(a,{url:"javascript:void(0);",id:e.id,allowDelete:this.properties.allowDelete||!1,filename:e.fileName,index:t})},canBeSent:function(){return!0},failReadFile:function(e){try{bizagi.log("Error code: "+e.target.error.code)}catch(e){}},onFail:function(e){this._super(e)},removeOfflineFile:function(e){var t=this,i=e.data().index,a=t.files[i];a&&("new"!==a.status?a.status="deleted":a.status="new-deleted",e.hide(),e.remove(),t.setValue(t.files,!1),t.checkMaxFiles(),t.triggerRenderChange())},updateFilesCount:function(){for(var e=this.properties.value,t=0;t<e.length;t++){var i=e[t].status;i&&i.includes("deleted")&&(this.filesCount=this.filesCount-1)}},setValue:function(e,t){this._super(e,t),this.updateFilesCount(),0===this.filesCount&&(this.properties.method="delete")},isMaxFilesReached:function(){var e=this.properties.maxfiles;return 0!==e&&this.filesCount>=e},openOfflineFile:function(e){var t=e.data(),i=t.index,a="number"==typeof i?this.properties.value[i]:null;if(a){var r=this.getFormParams(),n={idCase:r.idCase,idWorkitem:r.idWorkitem,id:this.properties.xpath+"."+a.id,offlineType:r.offlineType};bizagi.loading.start(),$.when(this.dataService.getOfflineFile(n,"blob",a.mimeType)).done(function(e){var i=t.title;bizagi.util.media.handleBinaryFile(e,i)}).fail(function(e){console.log("Error opening offline file",e)}).always(function(){bizagi.loading.stop()})}},getBlobFromPath:function(e){var t=new $.Deferred;if(this.isNative){var i=this.fileProperties.name;e=bizagi.util.isAndroidDevice()?bizagi.util.media.getImagePath(e):bizagi.util.media.normalizeIOSFilePath(e);var a=function(e){console.log("Error converting path to blob",e),t.reject(e)};window.resolveLocalFileSystemURL(e,function(e){e.file(function(e){var a=new FileReader;a.onloadend=function(){var a=new Blob([this.result],{type:e.type});a.name=i,t.resolve(a)},a.readAsArrayBuffer(e)},a)},a)}else t.resolve(e);return t},saveOfflineFile:function(e,t,i){var a=this.getFormParams(),r={idCase:a.idCase,idWorkitem:a.idWorkitem,id:this.properties.xpath+"."+t,operationType:"edition",offlineType:a.offlineType};return this.dataService.saveOfflineFile(r,e,i)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.ecm",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.ecm.prototype),bizagi.rendering.smartphone.ecm.extend("bizagi.rendering.smartphone.ecm",{QUALITY_PICTURE:50,LIMIT:1,EXTENSIONSIMG:["image/jpeg","jpeg","image","png","jpg","bmp"],EXTENSIONSFILE:["doc","docx","xls","xlsx","ppt","pptx","pdf","zip","rar","txt"],EXTENSIONSVIDEO:["video/quicktime","quicktime","qt","mov"],EXTENSIONSAUDIO:["audio/wav","audio","wav","mp3"],ERROR_ECM_NO_AVAILABLE:3,ACTION_DETAILS:"details",ACTION_EDIT:"edit"},{isNative:!1,initializeData:function(e){this._super(e),this.isNative=bizagi.util.isCordovaSupported(),this.fileData=[]},renderControl:function(){var e=this.renderFactory.getTemplate("ecm");return this.files=this.properties.value||[],this.filesCount=this.files.length,this.renderItem(e,{})},renderReadOnly:function(){var e=this.renderFactory.getTemplate("ecm-readonly"),t={noFiles:0===this.filesCount};return this.renderItem(e,t)},renderItem:function(e,t){for(var i="",a=$.fasttmpl(e,t),r=0;r<this.filesCount;r++){i+=this.renderUploadItem(this.files[r])}return a=this.replaceFilesHtml(a,i)},renderUploadItem:function(e){var t=this,i=t.renderFactory.getTemplate("ecm-item"),a=t.getFormContainer(),r={id:t.properties.id,idFileUpload:e[0],fileName:e[1],editable:t.properties.editable,xPath:t.properties.xpath,xpathContext:t.getXpathContext()||a.properties.xpathContext||"",idPageCache:t.properties.idPageCache,idAttrib:t.properties.idAttrib,sessionId:a.properties.sessionId},n=$.extend({},r);return r.url=t.buildItemUrl(n),e.getFileProperties=$.when(t.renderFileLayout(r)),$.fasttmpl(i,r)},renderFileLayout:function(e){var t=this,i=t.getFormContainer(),a=new $.Deferred,r=$.extend({},e);return $.when(t.dataService.metadataECMMultiaction().getECMMetadata(e),t.dataService.metadataECMMultiaction().getFileProperties(r)).done(function(n,o){Array.isArray(o)&&(o=o[0]),Array.isArray(n)&&(n=n[0]),o.idAttrib=t.properties.idAttrib,o.showMetadata=t.properties.showMetadata,o.xpathContext=t.getXpathContext()||i.properties.xpathContext||"",o.xpath=t.properties.xpath,o.fileName=e.fileName,o.idPageCache=t.properties.idPageCache,o.fileData=r;var s=$.extend({},o,n);a.resolve(s)}),a.promise()},replaceFilesHtml:function(e,t){return e.replace("{{files}}",t)},postRender:function(){var e=this.getControl();this.$contentFile=$(".bz-file-upload__container",e),this.$inputFile=$(".bz-file-upload__input",e),this.$nativeFile=$(".bz-file-upload__native",e)},configureHandlers:function(){this.checkFileExtensions(),this.attachEvents()},configureHandlersReadOnly:function(){var e=this,t=e.getControl();$("ul.bz-readonly-lists",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})})},saveImage:function(){var e=this,t="";e.editedImageURL?t=e.editedImageURL:e.fileProperties&&(t=e.fileProperties.url);var i={dataFile:bizagi.util.media.getImagePath(t),fileName:e.fileProperties.name,mimeType:"image/jpeg"};return e.editedImageURL=null,e.fileProperties=null,this.uploadFile(i)},saveVideo:function(e){var t={dataFile:e[0].fullPath,fileName:e[0].name,mimeType:"video/quicktime"};return this.uploadFile(t)},uploadFile:function(e){var t=this,i={},a=t.buildAddParams();return a.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),a.xPath=a.xPath,a.Filename=e.fileName,i.data=a,i.options=new FileUploadOptions,i.options.fileKey="file",i.options.fileName=e.fileName,i.options.uploadKey={key:"Filedata"},i.options.addUrl=t.properties.addUrl,i.dataFile=e.dataFile,e.mimeType&&(i.options.mimeType=e.mimeType),$.when(bizagi.util.media.uploadFile(i)).then(function(e){t.onUploadFileCompleted(JSON.parse(decodeURIComponent(e.response)))}).fail(function(e){t.executeFormFailHandler(e)})},attachEvents:function(){var e=this,t=e.getControl();$.each(e.files,function(t,i){e.attackMenuEvents(i)}),this.$contentFile.off("click").on("click",function(t){e.chooseFile()}),$("ul.bz-files",t).on("click",".bz-file .bz-file-name",function(){var t=$(this).parent(".bz-file").data();bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(t.url,t.title)).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})}),e.isNative?(this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){e.handlerUploadFile(t.guid)},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-file-upload__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),$.when(e.handlerResolutionUpload(t.guid)).always(function(){bizagi.loading.stop()})},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})):(this.$inputFile.off("change").on("change",function(){e.addFile(),this.value=""}),this.$inputFile.off("click").on("click",function(e){e.stopPropagation()}))},addMenuEvents:function(e,t){var i=this,a=e.find(".bz-file-menu"),r=[];t.showMetadata&&r.push({name:i.getResource("render-collection-navigator-details-form"),fn:function(){i.processActionByType(i.Class.ACTION_DETAILS,t,e)}}),t.showMetadata&&t.allowUpdateMetadata&&r.push({name:i.getResource("render-collection-navigator-edit-form"),fn:function(){i.processActionByType(i.Class.ACTION_EDIT,t,e)}}),t.allowCheckOut&&r.push({name:i.getResource("render-ecm-bt-lock"),fn:function(){i.lockECMFile(e,t)}}),t.allowCancelCheckOut&&r.push({name:i.getResource("render-ecm-bt-unlock"),fn:function(){i.unlockECMFile(e,t)}}),t.allowDelete&&r.push({name:i.getResource("render-ecm-bt-delete"),fn:function(){i.deleteECMFile(e,t.idFileUpload)}}),a.overflowMenu({items:r})},deleteECMFile:function(e,t){var i=this;bizagi.showConfirmationBox(this.getResource("render-ecm-confirm-message")).done(function(){$.when(i.deleteUploadItem(e,t)).done(function(){e.hide(),e.remove(),i.setValue(i.files,!1),i.checkMaxFiles(),i.triggerRenderChange()})})},checkMaxFiles:function(){this.isMaxFilesReached()?$(this.$contentFile).addClass("bz-file-upload__container--hidden"):$(this.$contentFile).removeClass("bz-file-upload__container--hidden")},isMaxFilesReached:function(){var e=this.properties.maxfiles,t=this.properties.value?this.properties.value.length:0;return 0!==e&&this.filesCount>=e&&t>=e},executeFormFailHandler:function(e){var t="";t=e&&e.code===this.Class.ERROR_ECM_NO_AVAILABLE?this.getResource("render-ecm-service-not-available"):e&&e.responseText?e.responseText:this.getResource("render-ecm-service-general-error"),this.getFormContainer().failHandler(t)},lockECMFile:function(e,t){var i=this;$.when(i.lockUploadItem(t.idFileUpload)).done(function(a){var r=[a.idFileUpload,t.fileName],n=i.renderUploadItem(r);e.replaceWith(n),i.attackMenuEvents(r)})},unlockECMFile:function(e,t){var i=this;$.when(i.unlockUploadItem(t.idFileUpload)).done(function(a){var r=[a.idFileUpload,t.fileName],n=i.renderUploadItem(r);e.replaceWith(n),i.attackMenuEvents(r)})},chooseFile:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&this.$inputFile.click()},checkFileExtensions:function(){var e=this,t=e.properties.validExtensions||"";if(e.validOptions={video:!1,image:!1,file:!1},void 0===(t=t.replace(/\s+/g,"").toLowerCase())||""===t)e.validOptions={video:!0,image:!0,file:!0};else if(1===(t=t.split(";")).length&&-1!==t[0].indexOf("*.*"))e.validOptions.video=!0,e.validOptions.image=!0;else for(var i=0,a=t.length;i<a;i++)t[i]=t[i].replace("*.",""),e.Class.EXTENSIONSFILE.toString().indexOf(t[i])>=0?e.validOptions.file=!0:e.Class.EXTENSIONSIMG.toString().indexOf(t[i])>=0?e.validOptions.image=!0:e.Class.EXTENSIONSVIDEO.toString().indexOf(t[i])>=0&&(e.validOptions.video=!0);e.validOptions.file||e.validOptions.image||e.validOptions.video||$(e.$contentFile).addClass("bz-file-upload__container--hidden"),(e.isMaxFilesReached()||!e.isNative&&!bizagi.util.media.fileAPISupported())&&$(this.$contentFile).addClass("bz-file-upload__container--hidden")},getUploadChoices:function(){var e=[];return this.validOptions.image&&(e.push({guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}),e.push({guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")})),this.validOptions.video&&e.push({guid:3,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-video")}),[].concat(e)},handlerUploadFile:function(e){var t=this;switch(e||0){case 2:navigator.camera.getPicture(function(e){t.dataImage=e;var i=t.Class.EXTENSIONSIMG.concat(t.Class.EXTENSIONSVIDEO);bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(t.dataImage)).then(function(e){if(t.fileProperties=e,bizagi.util.media.checkFileTypes(e,t.properties,i)){if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then(function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.handlerResolutionUpload(e)});$(".bz-file-upload__resolution",t.getControl()).click()}})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY});break;case 1:navigator.camera.getPicture(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then(function(i){return t.fileProperties=i,t.saveImage(e)})}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{quality:t.Class.QUALITY_PICTURE,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,destinationType:Camera.DestinationType.FILE_URI,correctOrientation:!0,targetWidth:1280,targetHeight:960});break;case 3:navigator.device.capture.captureVideo(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSizeVideo(e,t.properties)).then(function(){return t.saveVideo(e)}).always(function(){bizagi.loading.stop()})},t.onFail.bind(t),{limit:t.Class.LIMIT})}},onFail:function(e){var t=bizagi.util.processFailMessage(e);if(bizagi.loading.stop(),t&&"string"==typeof t&&-1!==t.indexOf("No Activity found to handle Intent")){var i=bizagi.util.isValidResource("render-upload-error-media-app")?bizagi.localization.getResource("render-upload-error-media-app"):"Your device does not have an app to execute this action.";self.performValidationMessage(i)}},performValidationMessage:function(e){var t=bizagi.util.processFailMessage(e);bizagi.showMessageBox(t)},handlerResolutionUpload:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.saveImage(t.dataImage);var a=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,a)).then(function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.saveImage(t.dataImage)})},addFile:function(){var e=this,t=this.$inputFile[0].files[0],i=e.Class.EXTENSIONSIMG.concat(e.Class.EXTENSIONSFILE,e.Class.EXTENSIONSVIDEO);t.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(t,e.properties)&&bizagi.util.media.checkFileTypes(t,e.properties,i)?$.when(e.processUploadFile(t)).done(function(t){bizagi.util.isFailResponse(t)?e.performValidationMessage(t):e.onUploadFileCompleted(JSON.parse(decodeURIComponent(t)))}).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()}):bizagi.loading.stop()},buildAddFileParams:function(e){var t=this,i=t.Class.BA_CONTEXT_PARAMETER_PREFIX,a=new FormData,r=t.getFormContainer(),n=t.buildAddParams();Object.keys(n).map(function(e){a.append(e,n[e])}),a.append("Filedata",e),a.append("Filename",e.name.substr(e.name.replace(/([\\\/]+)/g,"/").lastIndexOf("/")+1)),a.append(t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",r.properties.sessionId),t.properties.contexttype&&a.append(i+"contexttype",t.properties.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?a.append(BIZAGI_SESSION_NAME,r.properties.sessionId):a.append("JSESSIONID",r.properties.sessionId)}catch(e){a.append("JSESSIONID",r.properties.sessionId)}return a},processUploadFile:function(e){var t={url:this.properties.addUrl,formData:this.buildAddFileParams(e)};return this.dataService.processUploadFile(t)},onUploadFileCompleted:function(e){var t=this,i=$(".bz-files",t.getControl());if(e.idFileUpload&&e.fileName){var a=[e.idFileUpload,e.fileName],r=t.renderUploadItem(a);i.append(r);var n=t.files.slice();n.push(a),t.setValue(n,!0),t.checkMaxFiles(),t.attackMenuEvents(a),t.editedImageURL=null}else t.performValidationMessage(e.message)},attackMenuEvents:function(e){var t=this,i=t.getControl();e&&e.getFileProperties&&$.when(e.getFileProperties).done(function(e){var a=$("."+t.properties.id+"-"+e.idFileUpload,i);t.fileData[e.idFileUpload]=e.metadata||[],t.addMenuEvents(a,e)})},processActionByType:function(e,t,i){var a=this,r=a.properties,n=a.getFormContainer();bizagi.loading.start(),new bizagi.rendering.smartphone.slide.ecm(a.dataService,a.renderFactory,{title:a.properties.displayName||"",container:n.container,navigation:a.getParams().navigation,editable:r.editable&&e!==a.Class.ACTION_DETAILS,orientation:r.orientation||"ltr",onSave:function(e){if(e.update){var t=[e.idFileUpload,e.fileName],r=a.renderUploadItem(t);i.replaceWith(r),a.attackMenuEvents(t)}},onCancel:function(){}}).render({metadata:t.metadata,fileData:t}).always(function(){bizagi.loading.stop()})}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.grid",bizagi.rendering.grid.prototype),bizagi.rendering.smartphone.grid.extend("bizagi.rendering.smartphone.grid",{},{init:function(e){var t=e.data;t.properties.singleInstance=!1,t.properties.rowsPerPage=1,t.properties.displayType="vertical",this._super(e),this.cellMetadata={};var i=this.properties;if(i.displayType="vertical",i.rowsPerPage=1,$.each(this.columns,function(e,t){this.properties&&this.properties.editable&&(this.properties.editable=1==i.allowEdit)}),i.data&&i.data.rows&&i.data.rows.length>1){var a=[];a.push(i.data.rows[0]),i.data.rows=a}},setDisplayValue:function(e){},setDisplayValueEdit:function(e){},actionSave:function(){},updateAffectedCellManually:function(){},getRowIndexByKey:function(){},showMore:function(e){},postRender:function(){var e=this;e._super();var t=e.properties;t.rowsPerPage=1;e.getContainerRender();e.getLabel().hide();var i=e.getControl(),a=e.grid=$(".bz-mobile-grid",i),r=e.getMode(),n=e.buildColumnModel(),o=jQuery.grep(n,function(e){return e.summarizeBy});if(a.bizagi_grid_smartphone({columns:n,title:t.displayName,mode:e.getMode(),template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),specialCell:e.renderFactory.getTemplate("bizagi.grid.cell.special"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),buttons:e.renderFactory.getTemplate("bizagi.grid.buttons")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm,details:t.allowDetail,remove:t.allowDelete,inlineAdd:t.inlineAdd,allowMore:!1,totalizer:t.showSummary,hasTotalizer:o.length>0&&t.data.rows.length>0},pageRequested:function(t){"execution"==r&&e.onPageRequested(t)},sortRequested:function(t){"execution"==r&&e.fetchData(t.page,t.sortBy,t.sortType)},isValid:function(t){return e.isValidGrid(t)},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(e){},totalData:function(t){"execution"==r&&e.onTotalData()},gridControlReady:function(){e.processLayout(isLabelFormat,e.properties.textFormat||{}),e.processLayout(!isLabelFormat,e.properties.valueFormat||{})},addRow:function(t){"execution"==r&&e.addRow()},editRow:function(t){"execution"==r&&e.editRow(t.key)},deleteRow:function(t){"execution"==r&&e.deleteRow(t.key)},showFormDetails:function(t){e.showDetailForm(t.key)},showMore:function(t){e.showMore(t.key)}}),t.data&&t.data.rows&&t.data.rows.length>1){var s=[];s.push(t.data.rows[0]),t.data.rows=s}t.skipInitialLoad=t.skipInitialLoad||!1,t.skipInitialLoad||(t.data?(e.updateData(t.data),$.when(e.ready()).done(function(){e.triggerRenderChange({changed:!1})})):e.fetchData(t.page,t.sortBy,t.sortOrder))},postRenderReadOnly:function(){this.postRender()},changeBackgroundColor:function(e){var t=this.getControl();return t&&("none"!=e?$(".bz-mobile-grid",t).css("background-color",e):$(".bz-mobile-grid",t).css("background-color","")),this},setHeaderStyles:function(e){var t="font-weight: bold; ",i=this.properties;if(i.headerFormat){var a=i.headerFormat;if(void 0!==a.bold&&(t="font-weight: normal; "),a.color&&(t+="color: "+a.color+";"),a.background&&(t+="background-color: "+a.background+";"),a.italic&&(t+="font-style: italic; "),a.underline||a.strikethru)t+="text-decoration: "+(bizagi.util.parseBoolean(a.strikethru)?"line-through ":"")+(bizagi.util.parseBoolean(a.underline)?"underline ":"")+";";if(a.size&&"0"!=a.size)t+="font-size: "+(100+10*Number(a.size)+"%")+";"}return e.replace("%labelStyle%",t)},onTotalData:function(e){var t=this;t.getFormContainer().saveForm(),bizagi.loading.start(),$.when(t.fetchTotalData()).done(function(e){var i,a,r=e.rows,n=(r.length,[]);t.buildColumnModel().forEach(function(e,o){if(e.bizAgiProperties){switch(a=e.bizAgiProperties.totalize.operation){case"sum":i=r.sum(function(t){var i=null!==t[o]?t[o]:e.bizAgiProperties.defaultvalue;return Number(i)},o);break;case"count":i=r.count(function(t){var i=null!==t[o]?t[o]:e.bizAgiProperties.defaultvalue;return bizagi.util.isArray(i)?bizagi.util.isArray(i)&&i.length>0?i:void 0:i},e,o);break;case"max":i=r.max(function(t){var i=null!==t[o]?t[o]:e.bizAgiProperties.defaultvalue;return Number(i)},o);break;case"min":i=r.min(function(t){var i=null!==t[o]?t[o]:e.bizAgiProperties.defaultvalue;return Number(i)},o);break;case"avg":i=(i=r.avg(function(t){var i=null!==t[o]?t[o]:e.bizAgiProperties.defaultvalue;return Number(i)},o)).toFixed(2)}a&&(i=t.formatTotalizedResult(a,e.bizAgiProperties.type,i),n.push({label:e.label,total:i}))}}),t.showTotals(n)}).fail(function(e){bizagi.showMessageBox(bizagi.localization.getResource("render-grid-no-records"),"Error")}).always(function(){bizagi.loading.stop()})},fetchTotalData:function(e){var t=this,i=t.properties;if(e=e||{},$.extend(e,{url:i.dataUrl,xpath:i.xpath,idRender:i.id,xpathContext:i.xpathContext,contexttype:i.contextType,idPageCache:i.idPageCache,sort:i.sort,page:1,rows:t.properties.data.records,searchFilter:i.searchFilter}),i.overrideGetRemoteData){var a=i.overrideGetRemoteData(e);return null!=a?a.promise():null}var r=new $.Deferred;return t.dataService.multiaction().getGridData(e).done(function(e){t.isRTL()&&(e.rows=t.changeOrderData(e.rows)),r.resolve(e)}).fail(function(e){r.reject(e)}),r.promise()},formatTotalizedResult:function(e,t,i){switch(e){case"sum":case"avg":case"min":case"max":if("columnMoney"==t||"money"==t)return bizagi.util.formatMonetaryCell(i)}return i||0},showTotals:function(e){var t=$.fasttmpl(this.renderFactory.getTemplate("bizagi.grid.totalizer"),{items:e});this.grid.mobileView({displayName:bizagi.localization.getResource("render-grid-totalizer"),orientation:this.properties.orientation,style:"width: 90%; height: 70%",transition:"fade:in",cssClass:"bz-modal-view--totalizer",showBorder:!0,contentTemplate:t})},buildColumnModel:function(){var e=this.columns,t=[];return t.push({name:"id",index:0,label:"id",hidden:!0,align:"",key:!0}),$.each(e,function(e,i){i.columnIndex=e+1;var a=bizagi.util.isEmpty(i.properties.displayName)?" ":i.properties.displayName,r={name:i.properties.xpath,index:e+1,label:a,key:!1,hidden:!i.properties.visible||"columnHidden"===i.properties.type||!1===i.properties.columnVisible,summarizeBy:i.properties.totalize&&i.properties.totalize.operation?i.properties.totalize.operation:void 0,bizAgiProperties:i.properties};t.push(r)}),t},refresh:function(){return $.when(this.fetchData())},dataReady:function(){return null!=this.dataReadyDeferred?this.dataReadyDeferred.promise():null},updateData:function(e){var t=this,i=t.columns;e&&t.properties&&(t.properties.data=e,t.setCellOverrides(e,i),t.triggerGridPluginHandler("setData",e))},fetchData:function(e,t,i){var a=this,r=a.properties;return e=e||1,t=t||"",i=i||"asc",r.page=e,r.sort=t+" "+i,bizagi.loading.start(),$.when(a.getRemoteData()).then(function(e){e&&$.when(a.updateData(e)).done(function(){a.triggerRenderChange({changed:!1})})}).always(function(){bizagi.loading.stop()})},collectData:function(e){var t=this,i=t.grid;if(i&&t.properties.inlineAdd)for(var a=i.bizagi_grid_smartphone.hasOwnProperty("getNewRowKeys")?i.bizagi_grid_smartphone("getNewRowKeys"):[],r=0,n=a.length;r<n;r++)t.changes[a[r]]&&delete t.changes[a[r]];t._super(e)},onPageRequested:function(e){var t=this.properties,i={};jQuery.isEmptyObject(i)||this.dataService.submitData({action:"SUBMITDATA",data:i,idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,idPageCache:t.idPageCache}),this.fetchData(e.page,e.sortBy,e.sortType)},drawCell:function(e,t,i,a){var r=this;if(r.newRecords={},e.key)return i;var n=e.index-1,o=r.columns[n];r.cellMetadata[t]||(r.cellMetadata[t]={}),r.cellMetadata[t][n]||(r.cellMetadata[t][n]={});var s=r.cellMetadata[t][n].properties||o.originalProperties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;o.properties.displayType="value",a&&(d=!0);var c=r.getCellOverride(t,e.index-1);if(c&&(l=c.visible,d=!!s.editable&&c.editable),o.properties.labelAlign="default",o.properties.columntitlealign&&(o.properties.labelAlign=o.properties.columntitlealign),o.properties.valueAlign="default",o.properties.columnAlign&&(o.properties.valueAlign=o.properties.columnAlign),l){if(d){var p=new $.Deferred;return $.when(o.render(t,i)).done(function(e){e&&$(e).css("display"),a&&!r.newRecords[t]&&(r.newRecords[t]={});for(var i=0,n=r.columns.length;i<n;i++)r.cellOverrides[t]=r.cellOverrides[t]||{},r.getCellOverride(t,i).visible=!0;r.bindRenderChange(o,t,!0),p.resolve(e)}),p.promise()}return $.when(o.renderReadOnly(t,i)).then(function(e){if(e&&"none"!==$(e).css("display")){var t=$(e);if(void 0!==r.properties.textFormat&&(void 0!==r.properties.textFormat.color&&$("label",t).css("color",r.properties.textFormat.color),void 0!==r.properties.textFormat.size&&r.properties.textFormat.size>0)){var i=100+10*Number(r.properties.textFormat.size)+"%";$("label",t).css("font-size",i)}e=t&&t[0]?t[0].outerHTML:e}return e||""})}return""},onCellReady:function(e,t,i,a){var r=this,n=e.index-1,o=r.columns[n],s=(null!=r.cellMetadata[t][n]?r.cellMetadata[t][n].properties:void 0)||o.originalProperties,l=void 0===s.visible||s.visible,d=void 0===s.editable||s.editable;if($(".bz-rn-messages",i).toggleClass("bz-rn-messages","bz-rn-messages-grid"),"summary"==t&&(d=!1),a&&(d=!0),l)if(d){var c=o.properties.editable;if(o.properties.editable=d,o.properties.submitOnChange)(p=o.getDecorated(t))&&(p.properties.submitOnChangexpathContext=r.properties.xpath+"[]");o.postRender(t,i),o.properties.editable=c}else{var p;if(o.properties.submitOnChange)(p=o.getDecorated(t))&&(p.properties.submitOnChangexpathContext=r.properties.xpath+"[]");o.postRender(t,i)}},addRow:function(){var e=this,t=e.properties,i=e.getFormContainer().container,a=e.dataService;bizagi.loading.start(),$.when(e.submitAddRequest()).done(function(r){var n=t.xpath+"[id="+r+"]",o={idRender:t.id,recordXPath:n,url:t.addPage,xpathContext:t.xpathContext,idPageCache:t.idPageCache,xpath:n,editable:!0,requestedForm:"addForm",displayName:t.addLabel,idAsigned:r,enableEditSubmitRequest:!1,hideLabel:!0,disableProcessButons:!0},s={renderFactory:e.renderFactory,dataService:a,parent:e,data:{properties:o}},l=new bizagi.rendering.smartphone.formLink(s);jQuery.extend(l,{contextEdit:$(i).find(".bz-container__item-edit"),element:e.element,actionSave:e.actionSaveNewRow,actionCancel:e.actionCancelRow,_sendRelation:function(){return!0},_getData:e.dataService.getFormData,_params:o}),e._InternalRenderLinkForm(l)}).fail(function(t){e.executeFormFailHandler(t)}).always(function(){bizagi.loading.stop()})},editRow:function(e){var t=this,i=t.getFormContainer(),a=t.properties,r=t.getFormContainer().container,n=t.dataService,o=a.xpath+"[id="+e+"]";bizagi.loading.start(),$.when(i.saveForm()).done(function(){var i={idRender:a.id,id:a.id,xpathContext:a.xpathContext,idPageCache:a.idPageCache,recordXPath:o,xpath:o,editable:!0,url:a.editPage,requestedForm:"editForm",displayName:a.editLabel,idAsigned:e,disableProcessButons:!0},s={renderFactory:t.renderFactory,dataService:n,parent:t,data:{properties:i}},l=new bizagi.rendering.smartphone.formLink(s);jQuery.extend(l,{contextEdit:$(r).find(".bz-container__item-edit"),element:t.element,actionSave:t.actionSaveNewRow,actionCancel:t.actionCancelRow,_sendRelation:l.submitEditRequest,_getData:t.dataService.getFormData,_params:i}),t._InternalRenderLinkForm(l)}).fail(function(e){t.executeFormFailHandler(e)}).always(function(){bizagi.loading.stop()})},_InternalRenderLinkForm:function(e){$.when(e.renderEdition()).done(function(){e.endLoading()})},showDetailForm:function(e){var t=this,i=t.properties,a=t.getFormContainer().container,r=t.dataService,n=i.xpath+"[id="+e+"]",o={idRender:i.id,id:i.id,xpathContext:i.xpathContext,idPageCache:i.idPageCache,recordXPath:n,xpath:n,editable:!1,url:i.editPage,requestedForm:"detailForm",displayName:i.editLabel,idAsigned:e,disableProcessButons:!0},s={renderFactory:t.renderFactory,dataService:r,parent:t,data:{properties:o}},l=new bizagi.rendering.smartphone.formLink(s);jQuery.extend(l,{contextEdit:$(a).find(".bz-container__item-edit"),element:t.element,_getData:t.dataService.getFormData,_params:o}),t._InternalRenderLinkForm(l)},deleteRow:function(e){var t=this;bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done(function(){$.when(t.submitDeleteRequest(e)).done(function(i){t.fetchData(),"success"==i.type&&t.triggerRenderChange({rowDeleted:!0,changed:!1,key:e})}).fail(function(e){t.executeFormFailHandler(e)})})},actionCancelRow:function(){var e=$.Deferred();return $.when(this.submitRollbackRequest()).done(function(){e.resolve()}),e.promise()},actionSaveNewRow:function(e){var t=this,i=$.Deferred();if(!0===t.form.validateForm()){var a=t.properties;e||t.form.collectRenderValues(e),e.idPageCache=t.form.getPageCache(),$.when(t.parent.submitSaveRequest(a.idAsigned,e)).done(function(e){"validationMessages"==e.type?(t.form.addValidationMessage(e.messages),a.submitOnChange=!1,i.reject(e.messages)):(t.parent.fetchData(),a.submitOnChange||(a.submitOnChange=!0),t.submitOnChange({},!0),i.resolve())})}else i.reject();return i.promise()},applyActionUpdateGrid:function(e,t){var i=t,a=(i.properties,e.decorated.actionSave);jQuery.extend(e.decorated,{actionSave:function(){var e=this;$.when(a.apply(e,arguments)).done(function(){var t={};i.collectRenderValues(t),$.when(i.submitSaveRequest(e.surrogateKey,t)).done(function(){i.fetchData()})})}})},collectRenderValues:function(e){$.each(this.columns,function(t,i){(i=i.decorated).getElementType()==bizagi.rendering.element.ELEMENT_TYPE_CONTAINER?i.collectRenderValues(e):i.getElementType()==bizagi.rendering.element.ELEMENT_TYPE_RENDER&&i.canBeSent()&&i.collectData(e)})},ready:function(){var e=this._super(),t=this.inlineAddDeferred?this.inlineAddDeferred.promise():null;return $.when(e,t)},setError:function(e,t){},changeCellValue:function(e,t,i){var a=this.getControlCell(e,t);if(a){null!=i&&a.setDisplayValue(i);var r=a.column.getValue(e),n=a.column.getCompositeValue(e);null!=i&&a.setDisplayValue(i);this.collectGridChange({id:e,xpath:t,value:r,compositeValue:n,columnIndex:a.column,trigger:!1})}},changeCellBackgroundColor:function(e,t,i){var a=this.getControlCell(e,t);a&&(a.changeCellBackgroundColor(i),a.element&&a.element.find(".bz-container-render-cell1, .bz-control").css({"background-color":i,"background-image":i}))},changeCellColor:function(e,t,i){var a=this.getControlCell(e,t);a&&a.changeCellColor(i)},changeCellVisibility:function(e,t,i){var a=this,r=a.getControlCell(e,t);if(r){r.changeCellVisibility(i);for(var n=0,o=a.columns.length;n<o&&a.columns[n].properties.xpath!=t;n++);a.cellOverrides[e]=a.cellOverrides[e]||{},a.getCellOverride(e,n).visible=i,r.properties.editable&&i?a.bindRenderChange(a.getColumn(t),e,!0):a.bindRenderChange(a.getColumn(t),e,!1)}},changeCellEditability:function(e,t,i){var a=this,r=a.getControlCell(e,t);if(r){r.changeEditability(i);for(var n=0,o=a.columns.length;n<o&&a.columns[n].properties.xpath!=t;n++);a.cellOverrides[e]=a.cellOverrides[e]||{},a.getCellOverride(e,n).editable=i,r.properties.visible&&i?a.bindRenderChange(a.getColumn(t),e,!0):a.bindRenderChange(a.getColumn(t),e,!1)}},changeCellMinValue:function(e,t,i){var a=this,r=a.getControlCell(e,t);if(r){r.changeMinValue(i);for(var n=0,o=a.columns.length;n<o&&a.columns[n].properties.xpath!=t;n++);a.cellOverrides[e]=a.cellOverrides[e]||{},a.getCellOverride(e,n).minValue=i}},changeCellMaxValue:function(e,t,i){var a=this,r=a.getControlCell(e,t);if(r){r.changeMaxValue(i);for(var n=0,o=a.columns.length;n<o&&a.columns[n].properties.xpath!=t;n++);a.cellOverrides[e]=a.cellOverrides[e]||{},a.getCellOverride(e,n).maxValue=i}},cleanCellData:function(e,t){var i=this,a=i.getControlCell(e,t);if(a){a.cleanData();for(var r=0;r<i.columns.length&&i.columns[r].properties.xpath!=t;r++);for(var n=i.properties.data.rows,o=0,s=n.length;o<s;o++)if(Number(e)===n[o][0]){n[o][r+1]=[["",""]];break}i.cellOverrides[e]=i.cellOverrides[e]||{},i.getCellOverride(e,r).value=null}},isValidGrid:function(e){var t=[],i=this.getFormContainer();if(void 0!==i.validationController&&i.validationController.clearValidationMessages(),this.isValid(t),t.length>0){if(void 0!==i.validationController)for(var a=0,r=t.length;a<r;a++)i.validationController.showValidationMessage(t[a].message,t[a].xpath);return!1}return!0},triggerGridPluginHandler:function(){var e=Array.prototype.slice.call(arguments,0);return this.grid.bizagi_grid_smartphone.apply(this.grid,e)},bindRenderChange:function(e,t,i){var a=this;i?e.getDecorated(t).bind("renderchange",function(t,i){var r=e.getValue(i.render.surrogateKey),n=e.getCompositeValue(i.render.surrogateKey);if("columnDate"==e.properties.type)if(bizagi.util.isEmpty(r))""===r&&(r="");else{var o=bizagi.util.dateFormatter.getDateFromInvariant(r,!0);o.setSeconds(0),o.setMilliseconds(0),r=bizagi.util.dateFormatter.formatInvariant(o,!0)}a.collectGridChange($.extend(i,{id:i.render.surrogateKey,xpath:e.properties.xpath||e.properties.id,value:r,compositeValue:n,columnIndex:e.columnIndex})),a.grid.bizagi_grid_smartphone("changeCellValue",i.render.surrogateKey,e.columnIndex,r),e.properties.totalize&&e.properties.totalize.operation&&a.grid.bizagi_grid_smartphone("refreshSummary",e.columnIndex)}):e.getDecorated(t).unbind("renderchange")},executeFormFailHandler:function(e){var t=e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error");this.getFormContainer().failHandler(t)},getIndexes:function(){return $.merge(this.properties.data.rows,this.getDataNewRows()).reduce(function(e,t){return void 0===e.find(function(e){return e[0]==t[0]})&&e.push(t),e},[]).map(function(e){return e[0]})},startLoading:function(){bizagi.loading.start()},endLoading:function(){bizagi.loading.stop()}}),bizagi.rendering.smartphone.grid.extend("bizagi.rendering.smartphone.grid.offline",{},{init:function(e){var t=this,i=bizagi.clone(e.data.properties.data.rows),a=bizagi.clone(e.data.properties.data.rows);this._super(e);var r=this.properties;r.data.originalRows=i,r.data.completeRows=a,this.isOfflineForm=bizagi.util.isOfflineForm({context:t});var n=t.getFormContainer();if(r.isTaskForm=n.properties.isTaskForm,t.newRecords={},r["new-records"])for(var o=Object.keys(r["new-records"]),s=0;s<o.length;s++)t.newRecords[o[s]]={createdOffline:!0},t.changes[o[s]]=r["new-records"][o[s]];t["deleted-records"]=r["deleted-records"]?r["deleted-records"]:{},(r.groupBy||r.groupSummary)&&n.addWarning(t.getResource("render-tablet-warning-grid"))},postRender:function(){var e=this,t=e.properties,i=e.getControl();if(e.initialLoadDone=!1,e.grid=$(">div",i),e.getLabel().hide(),e.applyGridPlugin(),t.data&&t.data.completeRows&&t.data.completeRows.length>0){var a=[];a.push(t.data.completeRows[0]),t.data.rows=a}for(var r in t.data&&(e.updateData(t.data),$.when(e.ready()).done(function(){e.triggerRenderChange({changed:!1})})),e.initialLoadDone=!0,e.pendingActions)e.pendingActions[r].method.apply(e,e.pendingActions[r].arguments)},postRenderReadOnly:function(){this.postRender()},applyGridPlugin:function(){var e=this,t=e.properties,i=e.grid,a=e.getMode(),r=e.buildColumnModel();i.bizagi_grid_smartphone({columns:r,title:t.displayName,isOfflineForm:this.isOfflineForm||!1,mode:e.getMode(),template:{grid:e.renderFactory.getTemplate("bizagi.grid.grid"),waiting:e.renderFactory.getTemplate("bizagi.grid.waiting"),table:e.renderFactory.getTemplate("bizagi.grid.table"),emptyTable:e.renderFactory.getTemplate("bizagi.grid.table.empty"),column:e.renderFactory.getTemplate("bizagi.grid.column"),specialColumn:e.renderFactory.getTemplate("bizagi.grid.column.special"),row:e.renderFactory.getTemplate("bizagi.grid.row"),rowButtons:e.renderFactory.getTemplate("bizagi.grid.row.buttons"),cell:e.renderFactory.getTemplate("bizagi.grid.cell"),pager:e.renderFactory.getTemplate("bizagi.grid.pager"),specialCell:e.renderFactory.getTemplate("bizagi.grid.offline.cell.special"),buttons:e.renderFactory.getTemplate("bizagi.grid.buttons")},actions:{add:t.allowAdd,edit:t.allowEdit&&t.withEditForm&&null!=t.data,remove:t.allowDelete,inlineAdd:t.inlineAdd,details:!1,allowMore:!1,enableXlsExport:!1,enablePdfExport:!1,hasTotalizer:!1},isValid:function(){return e.isValidGrid()},pageRequested:function(t){"execution"===a&&e.onPageRequested(t)},totalData:function(e){},drawCell:function(t){return e.drawCell(t.column,t.key,t.value,t.isNewRow)},cellReady:function(t){return e.onCellReady(t.column,t.key,t.cell,t.isNewRow)},rowSelected:function(e){},addRow:function(t){"execution"===a&&e.addRow()},editRow:function(t){"execution"===a&&e.editRow(t.key)},deleteRow:function(t){"execution"===a&&e.deleteRow(t.key)},showMore:function(t){e.showMore(t.key)}})},fetchData:function(e,t,i){var a=this,r=a.properties;e=e||1,t=t||"",i=i||"asc",r.page=e,r.sort=t+" "+i,a.dataReadyDeferred=new $.Deferred,a.startLoading(),$.when(a.getRemoteData()).then(function(e){a.endLoading(),e&&(a.updateData(e),a.triggerRenderChange(),a.dataReadyDeferred.resolve())})},processChanges:function(){return[]},collectData:function(e){var t=this,i=[],a=t.properties,r=t.properties.data,n={};if(t.isValidGrid())for(var o in t.changes){var s=[],l={};for(var d in t.changes[o])if(t.canColumnBeSent(o,d)){var c=t.getColumn(d).columnIndex-1;"string"==typeof(u=t.changes[o][d])&&null!==u.match(/\n/gm)&&(u=u.replaceAll("\n","\\n")),s[c]=u;var p=a.xpath+t.buildCellXpathFilter(o)+"."+d,u=t.changes[o][d].value?t.changes[o][d].value:t.changes[o][d];e[p]=u,l[p]=u}if(t.newRecords[o]){var g={url:a.addUrl,idRender:a.id,xpath:a.xpath,xpathContext:a.xpathContext,contexttype:a.contexttype,idPageCache:a.idPageCache,submitData:t.changes[o],prepare:!0,idRow:parseInt(o+"")};for(change in n[o]=g,l)delete e[change];var m={};m.idRow=parseInt(o+""),m.isNew=!0,m.changes=t.changes[o],s.push(m),t.newRecords[o].createdOffline||(i[i.length]=s)}}(JSON.stringify(r.completeRows)!==JSON.stringify(r.originalRows)||i.length>0)&&(e[a.xpath]=e[a.xpath]?e[a.xpath]:{},void 0!==r.completeRows&&r.completeRows.length>0?e[a.xpath].rows=t.processOldRows(r.completeRows):e[a.xpath].rows=i,t["deleted-records"]&&Object.keys(t["deleted-records"]).length>0&&(e[a.xpath]["deleted-records"]=t["deleted-records"]),n&&Object.keys(n).length>0&&(e[a.xpath]["new-records"]=n))},processOldRows:function(e){for(var t=[],i=e,a=0,r=i.length;a<r;a++){var n=i[a];t[a]=$.grep(n,function(e,t){return t>0});var o={};o.idRow=parseInt(n[0]+""),o.isNew=!!this.newRecords[n[0]],o.changes=this.changes[n[0]]?this.changes[n[0]]:{},t[a].push(o)}return t},processRow:function(e){return $.grep(e,function(e,t){return t>0})},onPageRequested:function(e){this.fetchData(e.page,e.sortBy,e.sortType)},drawCell:function(e,t,i,a){var r=this;if(e.key)return i;"object"!=typeof i||null===i||a||(i=i.hasOwnProperty("value")?i.value:i);var n=e.index-1,o=r.columns[n],s=r.getCellOverride(t,e.index-1);r.newRecords=r.newRecords||{},r.cellMetadata[t]||(r.cellMetadata[t]={}),r.cellMetadata[t][n]||(r.cellMetadata[t][n]={});var l=r.cellMetadata[t][n].properties||o.originalProperties,d=void 0===l.visible||l.visible,c=void 0===l.editable||l.editable;if(d=s.visible,c=!!l.editable&&s.editable,a&&(c=!0),"summary"===t&&(c=!1),o.properties.displayType="value",o.setValue(t,i),o.setSurrogateKey(t),o.properties.data=o.properties.data||[],"columnSearch"===o.properties.type&&null!=i)for(var p=0,u=o.properties.data.length;p<u;p++)o.properties.data[p].id==i&&(i={id:o.properties.data[p].id,label:o.properties.data[p].value});if(("columnCombo"===o.properties.type||"columnList"===o.properties.type)&&null!=i)for(p=0,u=o.properties.data.length;p<u;p++)o.properties.data[p].id==i&&(i=[[o.properties.data[p].id,o.properties.data[p].value]]);return d?c?r.drawEditableCell(o,l,t,i,a):r.drawReadonlyCell(o,l,t,i):""},drawEditableCell:function(e,t,i,a,r){var n=this,o=new $.Deferred,s=e.properties.editable;return e.properties.editable=!0,e.overrideProperties({required:t.required}),$.when(e.render(i,a)).done(function(t){r&&!n.newRecords[i]&&(n.newRecords[i]={});for(var a=0;a<n.columns.length;a++)n.cellOverrides[i]=n.cellOverrides[i]||{},n.getCellOverride(i,a).visible=null==n.getCellOverride(i,a).visible||n.getCellOverride(i,a).visible;e.getDecorated(i).bind("renderchange",function(a){n.onCellChange(e,t,i)}),o.resolve(t)}),e.properties.editable=s,o.promise()},drawReadonlyCell:function(e,t,i,a){var r="";if("summary"===i){var n=e.properties.textFormat;e.properties.totalize&&(e.properties.textFormat=e.properties.totalize.format),r=e.renderSummary(i,a),e.properties.textFormat=n}else r=e.renderReadOnly(i,a);return r},onCellChange:function(e,t,i){var a=this,r=e.getValue(i),n=e.getCompositeValue(i);if("columnDate"===e.properties.type&&1==e.data.properties.showTime)if(bizagi.util.isEmpty(r))""===r&&(r="");else{var o=bizagi.util.dateFormatter.getDateFromInvariant(r,!0);r=bizagi.util.dateFormatter.formatInvariant(o,!0)}else if("columnDate"===e.properties.type){if(bizagi.util.isEmpty(r))""===r&&(r="");else(o=bizagi.util.dateFormatter.getDateFromInvariant(r,!1)).setHours(0,0,0,0),r=bizagi.util.dateFormatter.formatInvariant(o,!0)}if(a.properties.allowEdit||a.grid.bizagi_grid_smartphone("isNewRecord",i)){var s=!a.grid.bizagi_grid_smartphone("isNewRecord",i);a.collectGridChange({id:i,xpath:e.properties.xpath,value:r,compositeValue:n,columnIndex:e.columnIndex,trigger:s})}a.grid.bizagi_grid_smartphone("changeCellValue",i,e.columnIndex,r),e.properties.totalize&&e.properties.totalize.operation&&a.grid.bizagi_grid_smartphone("refreshSummary",e.columnIndex)},collectGridChange:function(e){var t=(e=e||{}).id,i=e.xpath,a=e.value,r=void 0===e.trigger||e.trigger;this.changes[t]=this.changes[t]||{},this.changes[t][i]=a,r&&this.triggerRenderChange({key:t,column:i})},addRow:function(){var e=this,t=e.properties.data,i=[],a=e.createAddRowData();i.push(a),e.newRecords[a[0]]={createdOffline:!0},t.rows=i,t.completeRows.push(a),t.records++,t.page=t.records,e.updateData(t),e.triggerRenderChange()},createAddRowData:function(){var e=[],t=Math.ceil(1e5*Math.random());return e.push(t),$.each(this.columns,function(t){e.push(null)}),e},editRow:function(e){},deleteRow:function(e){var t=this;e&&0!=e?bizagi.showConfirmationBox(this.getResource("render-grid-delete-confirmation")).done(function(){$.when(t.submitDeleteRequest(e)).done(function(){t.fetchData()})}):bizagi.showMessageBox(bizagi.localization.getResource("render-grid-message-no-selected-row"),bizagi.localization.getResource("render-grid-header-no-selected-row"))},editInline:function(e){},saveInlineAddedRows:function(e,t){var i=this.processChanges();bizagi.util.isEmpty(i)||(this.properties.data.rows=$.merge(this.properties.data.rows,i))},removeNewRecords:function(e){var t=this;e&&e.keys&&$.each(e.keys,function(e,i){t.newRecords[i]&&delete t.newRecords[i]})},getRemoteData:function(e){var t=this.properties;if(e=e||{},t.overrideGetRemoteData){var i=t.overrideGetRemoteData(e);return null!=i?i.promise():null}var a=new $.Deferred,r=t.data;if(t.data&&t.data.completeRows&&t.data.completeRows.length>0){var n=[];n.push(t.data.completeRows[t.page-1]),t.data.rows=n,t.data.page=t.page}else t.data.completeRows&&0==t.data.completeRows.length&&(t.data.rows=[]);return this.isRTL()&&(r.rows=this.changeOrderData(r.rows)),a.resolve(r),a.promise()},submitDeleteRequest:function(e){for(var t=this,i=t.properties,a=t.properties.data,r=0,n=a.completeRows.length;r<n;r++)if(a.completeRows[r][0]==e){if(a.completeRows.splice(r,1),r--,a.records--,t.newRecords[e])delete t.newRecords[e],delete t.changes[e];else{var o=i.xpath+t.buildCellXpathFilter(e),s={url:i.deleteUrl,idRender:i.id,xpath:o,xpathContext:i.xpathContext,idPageCache:i.idPageCache,contexttype:i.contextType,prepare:!0};t["deleted-records"][e]=s}break}return a.completeRows},isValidGrid:function(){var e=[],t=this.getFormContainer();if(void 0!==t.validationController&&t.validationController.clearValidationMessages(),e.length>0){if(void 0!==t.validationController)for(var i=0;i<e.length;i++)t.validationController.showValidationMessage(e[i].message,e[i].xpath);return!1}return!0}}),bizagi.rendering.smartphone.grid.extend("bizagi.rendering.smartphone.grid.grouped",{},{postRender:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")},postRenderReadOnly:function(){this.getControlFiller().addClass("bz-form-item__control--hidden")},isValidGrid:function(e){return this._super(e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.search",bizagi.rendering.search.prototype),bizagi.rendering.smartphone.search.extend("bizagi.rendering.smartphone.search",{ADVANCED_SEARCH_ID:-1,ADVANCED_ADDITION_ID:-2,CLEAR_SEARCH_ID:-3,NO_RESULTS_SEARCH_ID:-4,DEFAULT_SEARCH_ID:"",SEARCH_MIN_LENGTH:3,SEARCH_DELAY:250,SEARCH_MAX_RECORDS:50},{initializeData:function(e){this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.properties.submitOnChange=!this.isOfflineForm&&this.properties.submitOnChange,this.deferredReference=null},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly"),t=this.getDisplayValue(),i=t.label||t.value;return void 0!==i?"object"==typeof i&&(i=i.join(" - ")):i="","string"==typeof i&&(t.additionallabel&&(i+=" - "+t.additionallabel),i=bizagi.util.sanitizeHTML(i)),$.fasttmpl(e,{value:i,editable:this.properties.editable})},postRender:function(){this.searchInput=$(".bz-input-icon",this.getControl())},postRenderReadOnly:function(){this.searchInput=$(".bz-input-icon",this.getControl())},configureHandlers:function(){var e=this,t=e.getControl();$(".bz-input-icon",t).on("click",function(){!e.properties.advancedSearch||e.isOfflineForm?e._simplySearchView():e._advanceSearchView()}),$(".bz-icn--clear",t).bind("click",function(i){$(".bz-input-icon",t).addClass("bz-input-icon--empty"),e.cleanData(),e.readyActionExecution().done(function(){e.properties.submitOnChange&&e.submitData()}),i.stopPropagation()})},configureModalViewHandlers:function(e){var t=this;t.modalViewList=$(".bz-list",e.content);var i=bizagi.util.debounce(function(e){t.autoCompleteSearchResults($.trim(e))},t.Class.SEARCH_DELAY);$("[data-action=close]",e.header).bind("click",function(){e.close()});var a=$(".bz-modal-view__clear",e.header),r=$(".bz-modal-view__search",e.header);a.bind("click",function(){r.val("").trigger("clean")}),$(".bz-list",e.content).on("click","li",function(){var i=$.data(this).item;!i||i&&i.id==t.Class.NO_RESULTS_SEARCH_ID||(t.selectItem(i),e.close())}),r.bind("clean keyup",function(){""==this.value?a.removeClass("bz-modal-view__clear--visible"):a.addClass("bz-modal-view__clear--visible"),i(this.value)}).on("focus",function(){e.header.addClass("bz-modal-view__header--active")}).on("blur",function(){e.header.removeClass("bz-modal-view__header--active")})},_advanceSearchView:function(){var e=this,t=e.properties,i=$.extend({},e.getParams(),{navigation:e.getFormContainer().getNavigation()});new bizagi.rendering.smartphone.helpers.searchForm(e.dataService,e.renderFactory,t.searchForms,{allowFullSearch:t.allowFullSearch,maxRecords:t.maxRecords,allowNew:t.allowNew||!1,orientation:t.orientation||"ltr",editable:t.editable},i).renderEdition({idRender:t.id,xpath:t.xpath,xpathContext:t.xpathContext,displayName:t.displayName,idPageCache:t.idPageCache}).done(function(i){e.setValue({id:i}),t.submitOnChange=!0,e.submitData()})},_simplySearchView:function(){var e=this,t=e.getContentTemplate();e.searchInput.mobileView({customHeader:$.fasttmpl(e.renderFactory.getTemplate("modal-header-search"),{}),orientation:e.properties.orientation||"",contentTemplate:t,transition:"slideIn:up",close:function(){e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.configureModalViewHandlers(t)}})},autoCompleteSearchResults:function(e){var t=this;$.when(t.processRequest({term:e})).done(function(e){t.modalViewList.find("li").remove();for(var i=0,a=e.length;i<a;i++){t.renderSearchItem(e[i]).appendTo(t.modalViewList)}})},renderSearchItem:function(e){var t=this.renderFactory.getTemplate("search.item"),i=$.tmpl(t,{id:e.id,label:e.label,value:e.value});return i.data("item",e),i},processRequest:function(e){var t=this,i=t.properties,a=new $.Deferred,r=[];if(t.properties.allowSuggest&&e.term.length>=t.properties.searchLength){i.term=e.term;var n=t.isOfflineForm?t.getOfflineData():t.getData();t.deferredReference&&"function"==typeof t.deferredReference.reject&&"resolved"!==t.deferredReference.state()&&t.deferredReference.reject({hideStatus:!0}),t.deferredReference=n.done(function(n){n&&n.length>0?((n=n.slice(0,i.maxRecords)).length>t.Class.SEARCH_MAX_RECORDS?(n=n.slice(0,t.Class.SEARCH_MAX_RECORDS),r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-search-maximum-records-allowed"),value:""})):n=n.slice(0,i.maxRecords),r.push({id:t.Class.DEFAULT_SEARCH_ID,label:t.getResource("render-combo-empty-value"),value:""}),$.each(n,function(t,a){if(0===i.maxRecords||t<i.maxRecords){var n=bizagi.util.highlightMatches(a,e.term);r.push({id:a.id,label:n,value:a.value})}})):r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-grid-no-records"),value:""}),a.resolve(r)}).fail(function(){a.reject()})}else a.resolve(r);return a.promise()},setDisplayValue:function(e){var t=this,i="";if(null!=(e=t.mapValue(e))&&void 0!==e.id){i=e.additionallabel&&e.label?e.label+" - "+e.additionallabel:e.label?e.label:"";var a=t.searchInput.find("input");a.val(i),a.attr("id",e.id),""!==e.id&&t.properties.allowClear&&$(".bz-input-icon",t.getControl()).removeClass("bz-input-icon--empty"),t.properties.editable&&t.setValue(e,!0)}},submitData:function(){var e=this,t={};t[e.properties.xpath]=e.getValue(),e.properties.submitOnChange&&null!=t[e.properties.xpath].id&&e.submitOnChange(t,!0)},cleanData:function(){var e={id:"",value:""};bizagi.util.isEmpty(this.value)&&(e={}),this.setValue(e),this.setDisplayValue(e)},getContentTemplate:function(){var e=this.renderFactory.getTemplate("search.items"),t=$.fasttmpl(e,{});return $.trim(t)},selectItem:function(e){var t=this,i=t.hasValue(),a=Array.isArray(e.value)?e.value.join(" - "):e.value;t.setDisplayValue({id:e.id,label:a}),t.properties.allowClear&&(e.id===t.Class.DEFAULT_SEARCH_ID?(t.searchInput.find(".gn-bz-search__clear").addClass("gn-bz-search--hidden"),t.searchInput.find(".gn-bz-search__icon").removeClass("gn-bz-search--hidden")):i||e.id===t.Class.DEFAULT_SEARCH_ID||(t.searchInput.find(".gn-bz-search__clear").removeClass("gn-bz-search--hidden"),t.searchInput.find(".gn-bz-search__icon").addClass("gn-bz-search--hidden")))},getOfflineData:function(){var e=this.properties.data||[],t=(this.properties.term||"").toLowerCase();return $.when(t.startsWith("%%")?e:e.filter(function(e){var i=e&&e.value?e.value:"";return"object"==typeof i&&(i=i.toString()),i.toLowerCase().indexOf(t)>-1}))}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.letter",bizagi.rendering.letter.prototype),bizagi.rendering.smartphone.label.extend("bizagi.rendering.smartphone.letter",{},{}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.button",bizagi.rendering.button.prototype),bizagi.rendering.smartphone.button.extend("bizagi.rendering.smartphone.button",{},{configureHandlers:function(){var e=this;$(":button",e.getControl()).on("click",function(){e.processButton()})},processButton:function(){var e=this;e.properties.editable&&(e.properties.needsUserConfirmation?$.when(bizagi.showConfirmationBox(e.properties.userConfirmationMessage,"Bizagi","warning")).done(function(){e.triggerRenderChange({pressed:!0})}):(e.properties.preventDefault||e.runButtonAction(),e.triggerRenderChange({pressed:!0})))},getElementsToStylize:function(e){return $("button",e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.fileprint",bizagi.rendering.fileprint.prototype),bizagi.rendering.smartphone.fileprint.extend("bizagi.rendering.smartphone.fileprint",{},{postRender:function(){this.getControl().parent().hide()}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.link",bizagi.rendering.link.prototype),bizagi.rendering.smartphone.link.extend("bizagi.rendering.smartphone.link",{},{postRender:function(){var e=this.getControl();this.link=e.find(".bz-link"),this._super(),this.preventDefaultForAnchorTag()},postRenderReadOnly:function(){var e=this.getControl();this.link=e.find(".bz-link"),this._super()},setDisplayValue:function(e){this.setValue(e,!1),this.isValidValue()&&(e=getFullyDecodedURI($.trim(e)),this.link.attr("href",e))},configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},attachEvents:function(){var e=this;e.isValidValue()&&e.link.on("click",function(t){t.preventDefault(),t.stopPropagation();var i=encodeURI(this.getAttribute("href"));e.linkSolver(i,e.properties.linktarget)})},isValidValue:function(){return this.hasValue()&&null!==$.trim(this.getValue()||"").toLowerCase().match(/^(http|https):\/\//)||!1},linkSolver:function(e,t){"newwindow"===t||bizagi.util.isCordovaSupported()?window.open(e,"_system","location=yes"):window.open(e,"_system")},processLayout:function(e){e?void 0!==this.properties.textFormat.background&&this._super(e,{background:this.properties.textFormat.background}):this._super(e,this.properties.textFormat)},getElementsToStylize:function(e){return $(".bz-link",e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.image",{BA_ACTION_PARAMETER_PREFIX:bizagi.render.services.service.BA_ACTION_PARAMETER_PREFIX,BA_CONTEXT_PARAMETER_PREFIX:bizagi.render.services.service.BA_CONTEXT_PARAMETER_PREFIX,BA_PAGE_CACHE:bizagi.render.services.service.BA_PAGE_CACHE},bizagi.rendering.image.prototype),bizagi.rendering.smartphone.image.extend("bizagi.rendering.smartphone.image",{QUALITY_PICTURE:80,EXTENSIONSIMG:["jpeg","jpg","png"]},{$inputFile:null,isNative:!1,isOfflineForm:!1,initializeData:function(e){if(this._super(e),this.isOfflineForm=bizagi.util.isOfflineForm({context:this}),this.isNative=bizagi.util.isCordovaSupported(),this.isOfflineForm){var t=Number(this.properties.maxSize)||1048576,i="undefined"!=typeof BIZAGI_SETTINGS&&void 0!==BIZAGI_SETTINGS.UploadMaxFileSize?Number(BIZAGI_SETTINGS.UploadMaxFileSize):1048576;this.properties.maxSize=t<i?t:i}},renderControl:function(){var e=this.renderFactory.getTemplate("image");return $.fasttmpl(e,{url:""})},getElementsToStylize:function(e){return $({})},renderReadOnly:function(){var e=this,t=this.renderFactory.getTemplate("image-readonly"),i=new $.Deferred;return $.when(e.buildItemUrl()).done(function(a){var r=a||"";if(!e.isDisposed()){e.properties.url=r,e.properties.value=r.length>0?[r]:null,e.setValue(e.properties.value);var n=$.fasttmpl(t,{url:e.properties.url});i.resolve(n)}}),i.promise()},postRender:function(){var e=this.getControl();this.$inputFile=$(".bz-image__input",e),this.$nativeFile=$(".bz-image__native",e),this.isDesignMode()||this.showAsyncImage()},configureHandlers:function(){var e=this,t=this.getControl();t.on("click","[data-action=upload]",function(t){e.choosePhoto()}),this.isNative?(this.$nativeFile.off("click").actionSheet({actions:e.getUploadChoices(),actionClicked:function(t){switch(t.guid){case 1:e.imageAdd();break;case 2:e.imageAdd(!0)}},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}}),$(".bz-image__resolution",t).off("click").actionSheet({actions:bizagi.util.media.getImageResolutionSizes(),withoutCancel:!0,actionClicked:function(t){bizagi.loading.start(),$.when(e.resolutionButtonHandler(t.guid)).always(function(){bizagi.loading.stop()})},appear:function(t){e.triggerGlobalHandler("modalViewDidAppear",{})},cancelClicked:function(t){e.triggerGlobalHandler("modalViewDidDisappear",{})}})):(this.$inputFile.off("change").on("change",function(){e.imageAdd(),this.value=""}),this.$inputFile.off("click").on("click",function(e){e.stopPropagation()}))},configureHandlersReadOnly:function(){var e=this;this.getControl().on("click",".bz-image",function(){e.imagePreview()})},imageAdd:function(e){var t=this;if(this.isNative){var i={quality:t.Class.QUALITY_PICTURE,targetWidth:1280,targetHeight:960,correctOrientation:!0};if(!e){var a=t.getControl()[0].getBoundingClientRect();i={quality:t.Class.QUALITY_PICTURE,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,popoverOptions:new CameraPopoverOptions(a.left,a.top-20,200,100,4),destinationType:navigator.camera.DestinationType.FILE_URI,correctOrientation:!0}}navigator.camera.getPicture(function(e){bizagi.loading.start(),$.when(bizagi.util.media.checkMaxSize(e,t.properties)).then(function(){return $.when(bizagi.util.media.getFileDataInfo(e)).then(function(i){if(bizagi.util.media.checkFileTypes(i,t.properties,t.Class.EXTENSIONSIMG)){t.dataImage=e,t.fileProperties=i;var a=bizagi.util.getAndroidVersion();if(a&&a<=4.2||t.isOfflineForm)return $.when(t.performUploadFile(t.dataImage)).always(function(){bizagi.loading.stop()});if(!bizagi.util.isAndroid())return $.when(bizagi.util.media.modalResolutionUpload()).then(function(e){if(e<=bizagi.util.media.getImageResolutionItems().length)return t.resolutionButtonHandler(e)});$(".bz-image__resolution",t.getControl()).click()}})}).always(function(){bizagi.loading.stop()})},t.onFail,i)}else{var r=this.Class.EXTENSIONSIMG,n=this.$inputFile[0].files[0];n.fullPath=this.$inputFile[0].value,bizagi.loading.start(),bizagi.util.media.checkMaxSizeFile(n,t.properties)&&bizagi.util.media.checkFileTypes(n,t.properties,r)?$.when(t.performUploadFile(n)).always(function(){bizagi.loading.stop()}):bizagi.loading.stop()}},onFail:function(e){bizagi.loading.stop()},imageDelete:function(){var e=this;bizagi.showConfirmationBox(e.getResource("render-grid-delete-confirmation")).done(function(){bizagi.loading.start(),$.when(e.dataService.deleteImage({url:e.properties.deleteUrl,idRender:e.properties.id,xpath:e.properties.xpath,xpathContext:e.properties.xpathContext,idPageCache:e.properties.idPageCache,contexttype:e.properties.contexttype})).done(function(){e.uploadFileCompleted()}).fail(function(t){var i,a=t.responseText;try{i=(i=JSON.parse(a)).message||a}catch(e){i=a}e.setValidationMessage(i)}).always(function(){bizagi.loading.stop()})})},uploadFile:function(e){var t=this,i=new $.Deferred;if(this.isOfflineForm)t.saveImageOffline(e,i),t.canBeSent=function(){return $.forceCollectData=!0,!0};else if(this.isNative){var a={},r=t.buildAddParams(),n=t.fileProperties.name;t.editedImageURL?a.dataFile=t.editedImageURL:t.fileProperties&&(a.dataFile=t.fileProperties.url),r.queueID="q_"+bizagi.util.encodeXpath(t.getUploadXpath()),a.data=r,a.options=new FileUploadOptions,a.options.fileKey="file",a.options.fileName=n,a.options.mimeType="image/jpeg",a.options.uploadKey={key:r.h_xpath},a.options.addUrl=t.properties.addUrl,t.editedImageURL=null,t.fileProperties=null,a.dataFile=bizagi.util.media.getImagePath(a.dataFile),$.when(bizagi.util.media.uploadFile(a)).done(function(e){"error"===(e=JSON.parse(decodeURIComponent(e.response))).type?i.reject(e):i.resolve(e)}).fail(function(e){i.reject(e)})}else bizagi.util.media.checkMaxSizeFile(e,t.properties)&&bizagi.util.media.checkFileTypes(e,t.properties,t.Class.EXTENSIONSIMG)?t.dataService.processUploadFile({url:t.properties.addUrl,formData:t.buildAddFileParams(e)}).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)}):i.reject();return i.promise()},uploadFileCompleted:function(){try{this.showAsyncImage(),this.editedImageURL=null}catch(e){this.getFormContainer().refreshForm()}},showAsyncImage:function(){var e=this,t=e.getControl(),i=$(".bz-input-icon",t);$.when(e.renderUploadItem()).done(function(t){if(!e.isDisposed()){i.empty(),i.append(t);var a=e.hasValue()?"update":"upload";i.attr("data-action",a),e.setValue(e.properties.value),e.hasValue()&&e.configureMenu()}})},resolutionButtonHandler:function(e){var t=this,i=e||0;if(i===bizagi.util.media.ResolutionType.ORIGINAL)return t.performUploadFile(t.dataImage);var a=bizagi.util.media.getImageResolution(i);return $.when(bizagi.util.media.transformImageSize(t.dataImage,a)).then(function(e){return t.editedImageURL=e.localUrl,t.properties.url=e.base64Image,t.performUploadFile(t.dataImage)})},imagePreview:function(){var e=this,t=e.getParams(),i=t.navigation.createRenderContainer({title:e.properties.displayName,view:{zoom:!0,useNativeScrolling:!1}}),a=e.renderFactory.getTemplate("image-preview"),r={url:e.value&&""!==e.value[0]?e.value[0]:""},n=$.fasttmpl(a,r);i.element.css("display","none"),e.inputEdition=i.element.html(n),t.navigation.navigate(i.id),e.isOfflineForm&&i.element.on("close",e.onPreviewActionBack.bind(e)),bizagi.loading.start(),$.when(e.buildFullItemUrl()).done(function(t){if(i.element.css("display","block"),t.indexOf("error")<0){var a=$(".bz-image__preview-item:first",i.element).attr("src",t),r=a.css("width");r=Number(r.substring(0,r.length-2)),-1!==e.properties.width&&e.properties.width<r&&a.css("width","100%")}}).always(function(){bizagi.loading.stop()})},buildAddFileParams:function(e){var t=this,i=t.properties,a=t.Class.BA_CONTEXT_PARAMETER_PREFIX,r=new FormData,n=t.getFormContainer();r.append(a+"xpath",i.xpath),r.append(a+"idRender",i.id),r.append(a+"xpathContext",i.xpathContext),r.append(a+t.Class.BA_PAGE_CACHE,i.idPageCache),r.append(t.Class.BA_ACTION_PARAMETER_PREFIX+"sessionId",n.properties.sessionId),r.append(a+"action","savefile"),r.append(t.properties.xpath,e),i.contexttype&&r.append(a+"contexttype",i.contexttype);try{"undefined"!=typeof BIZAGI_SESSION_NAME?r.append(BIZAGI_SESSION_NAME,n.properties.sessionId):r.append("JSESSIONID",n.properties.sessionId)}catch(e){r.append("JSESSIONID",n.properties.sessionId)}return r},executeFormFailHandler:function(e){var t=e.responseText?e.responseText:bizagi.localization.getResource("workportal-general-error");this.getFormContainer().failHandler(t)},performUploadFile:function(e){var t=this;return $.when(t.uploadFile(e)).done(function(e){t.uploadFileCompleted()}).fail(function(e){t.executeFormFailHandler(e)})},choosePhoto:function(){this.isNative?this.$nativeFile.click():bizagi.util.media.fileAPISupported()&&!self.isOfflineForm&&this.$inputFile.click()},configureMenu:function(){var e=this,t=[],i=this.getControl(),a=$(".bz-input-icon__input + .bz-icn",i),r=!e.isOfflineForm&&(e.properties.allowDelete&&e.properties.editable);t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-image-preview"),fn:function(){e.imagePreview()}}),t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo"),fn:function(){e.choosePhoto()}}),r&&t.push({name:bizagi.localization.getResource("workportal-actionsheet-upload-remove-photo"),fn:function(){e.imageDelete()}}),a.overflowMenu({items:t})},getUploadChoices:function(){return[{guid:1,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-choose-photo")},{guid:2,displayName:bizagi.localization.getResource("workportal-actionsheet-upload-take-photo")}]},buildItemUrl:function(e){return this.isOfflineForm?this.buildItemUrlOffline(e):this._super(e)},onPreviewActionBack:function(e){var t=$(".bz-image__preview-item",e.target).attr("src")||"",i=t.length>0?[].concat(t):null;this.setValue(i)},collectData:function(e){if(this.isOfflineForm&&this.controlValueIsChanged()){var t=this.properties.xpath;this.getValue();bizagi.util.isEmpty(t)||(e[t]="*")}else $._super(e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.formLink",{BA_ACTION_PARAMETER_PREFIX:"p_",BA_CONTEXT_PARAMETER_PREFIX:"h_",BA_PAGE_CACHE:"pageCacheId"},bizagi.rendering.formLink.prototype),bizagi.rendering.smartphone.formLink.extend("bizagi.rendering.smartphone.formLink",{},{initializeData:function(e){var t=this;t._super(e);var i=t.properties;t.originalElement=t.element,i.orgiginalDisplayType=i.displayType,i.displayType="normal",t._sendRelation=t.submitEditRequest,t._getData=t.dataService.getFormData,t._isRefreshForm=!1},init:function(e){this._super(e),e.context=e.context||"workflow";var t=$.extend({},this._params,{proxyPrefix:this.dataService.serviceLocator.proxyPrefix,context:this.dataService.serviceLocator.context});this.serviceLocator=new bizagi.render.services.context(t)},renderEdition:function(){var e=this,t=e.properties;if(e._params={idRender:t.id,xpathContext:e.getFormLinkXpathContext(),idPageCache:t.idPageCache,recordXPath:e.getFormLinkXpath(),requestedForm:"linkform",editable:t.editable,url:t.editPage},e.container=e.getParams().navigation.createRenderContainer({title:t.displayName}),e.inputEdition=e.container.element,!e.properties.hasentryrule)return e.openLink();var i=e.getFormContainer();$.when(i.saveForm()).done(function(){e.resolveCheckpointRequest().done(function(){return e.openLinkRule("entryrule")}).fail(function(e){bizagi.log("Error: "+err.code)})})},openLink:function(){var e=this;return $.when(e._sendRelation.apply(e)).done(function(){bizagi.loading.start(),$.when(e.paintFormLink()).done(function(){bizagi.loading.stop()}).fail(function(){bizagi.loading.start(),e.rollbackForm()}).always(function(){bizagi.loading.stop()})}).always(function(){bizagi.loading.stop()})},openLinkRule:function(e){var t=this,i=new $.Deferred;return bizagi.loading.start(),t.getPropertyValue(e,{}).done(function(a){if(a.messages){var r=a.messages[0];t.getFormContainer().validationController.showErrorMessage(r),i.reject()}else"entryrule"===e&&t.openLink();i.resolve()}).fail(function(){i.reject()}).always(function(){bizagi.loading.stop()}),i.promise()},getPropertyValue:function(e,t){var i=this,a=i.properties,r=new $.Deferred;return i.dataService.multiaction().getPropertyData({url:a.dataUrl,xpath:a.xpath,idRender:a.id,xpathContext:a.xpathContext,idPageCache:a.idPageCache,property:e,extra:t,dataType:t?t.dataType:null}).done(function(e){"error"===e.type?(i.getFormContainer().validationController.showErrorMessage(e.message),r.reject(e)):r.resolve(e)}).fail(function(e,t,a){i.getFormContainer().validationController.showErrorMessage(e.message),r.reject(e,t,a)}),r.promise()},paintFormLink:function(){var e=this,t=$.Deferred();return $.extend(e._params,{proxyPrefix:e.serviceLocator.proxyPrefix}),$.when(e._getData.call(e,e._params)).pipe(function(i){return e._params.recordXPath&&(i.form.properties.recordXpath=e._params.recordXPath),!1===e._params.editable&&(i.form.properties.editable=!1),e._params.hasOwnProperty("withAddForm")&&e._params.withAddForm&&(!i.form.elements||i.form.elements&&0===i.form.elements.length)&&(e._params.hideSaveButton=!0),e.form=e.renderFactory.getContainer({type:"form",data:i.form,navigation:e.getParams().navigation,wiew_container:e.container}),e.form.params=e.getFormContainer().getParams(),e.form.buttons=[$.extend(e.form.buttons[0]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-save"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:0,action:"save",save:!0,style:"",callback:function(){return e.saveRecord().then(function(){e.container.destroy()}).fail(function(t){t&&t.error_code&&1==t.error_code?$.when(e.actionSave(t.data)).then(function(){e.container.destroy()}):t&&"validationMessages"==t.type?e.form.addValidationMessage(t.messages):t&&t.responseText&&bizagi.showMessageBox(t.responseText||"Error","Error")})}}),$.extend(e.form.buttons[1]||{},{caption:bizagi.localization.getResource("render-form-dialog-box-close"),actions:["submitData","refresh"],submitData:!0,refresh:!0,ordinal:1,action:"back",save:!0,style:"",callback:function(){e.container.destroy(),t.reject()}})],$.extend(e.form,{processButtons:function(){$.each(e.form.buttons,function(i,a){switch(a.ordinal){case 1:$(e.form.getButtons()[i]).click(function(){e.container.destroy(),t.reject()}),e.form.getButtons()[i].innerHTML=bizagi.localization.getResource("render-form-dialog-box-close"),e.form.buttons[i].caption=bizagi.localization.getResource("render-form-dialog-box-close"),e.form.buttons[i].action="back";break;default:$(e.form.getButtons()[i]).click(function(){return e._params.hideSaveButton&&$(e.form.getButtons()[i]).hide(),e.saveRecord().then(function(){e.container.destroy()}).fail(function(t){t&&t.error_code&&1==t.error_code?$.when(e.actionSave(t.data)).then(function(){e.container.destroy()}):bizagi.showMessageBox(t.responseText||"Error","Error")})})}})}}),e.form.render()},function(i){var a=e.renderFactory.getCommonTemplate("form-error");$.tmpl(a,{message:i}).appendTo(e.inputEdition),t.reject()}).done(function(t){e.inputEdition.html(t),e._isRefreshForm||e.getParams().navigation.navigate(e.container.id),e.container.setNavigationButtons(e.form),e.form.triggerHandler("ondomincluded"),e.form.bind("refresh",function(){e.inputEdition.empty(),e._isRefreshForm=!0,$.when(e.paintFormLink()).done(function(){}).fail(function(){e.submitRollbackRequest()})}),e.container.element.bind("close",function(){e.rollbackForm()})}).always(function(){bizagi.loading.stop()}),t.promise()},rollbackForm:function(){var e=this,t=e.form||e.getFormContainer();$.when(e.submitRollbackRequest({idPageCache:t.idPageCache})).done(function(){e.properties.hasentryrule&&e.submitRollbackRequest({idPageCache:t.idPageCache})})},saveRecord:function(){var e=this,t=$.Deferred(),i=e.properties;if(e.form.validateForm()){var a={};e.form.collectRenderValues(a),a.idPageCache=e.form.getPageCache(),$.when(e.submitSaveRequest(a)).done(function(a){try{var r=!0;a&&"validationMessages"===a.type&&(r=!1,t.reject(a)),i.hasexitrule?e.closeExitRule().done(function(){r?e.resolveSubmitCommitRequest().then(function(){e.submitOnChange({}).then(function(){t.resolve(a),i.hasentryrule&&e.resolveSubmitCommitRequest()})}):t.reject()}).fail(function(){t.reject()}):r?e.resolveSubmitCommitRequest().then(function(){i.hasentryrule?e.resolveSubmitCommitRequest().done(function(){e.submitOnChange({}).then(function(){t.resolve(a)})}):e.submitOnChange({}).then(function(){t.resolve(a)})}):t.reject()}catch(e){t.reject()}}).fail(function(e){var i=JSON.parse(e.responseText||"{message:'', code: ''}");"UNKNOWN_ERROR"===i.code&&-1!==i.message.indexOf("Requested value")&&-1!==i.message.indexOf("was not found")?t.reject({error_code:1,data:a}):t.reject(e)})}else t.reject();return t.promise()},submitSaveRequest:function(e){var t=this.properties;if(!1===t.editable&&!t.value)return null;var i=this.getFormLinkXpath(),a=i;return void 0!==t.xpathContext&&""!==t.xpathContext&&(a=i?t.xpathContext+"."+i:t.xpathContext),this.dataService.saveGridRecord({url:t.saveUrl,idRender:t.id,xpathContext:a,submitData:e})},resolveSubmitCommitRequest:function(){var e=new $.Deferred;return this.submitCommitRequest().done(function(){e.resolve()}).fail(function(t){"UNKNOWN_ERROR"===JSON.parse(t.responseText||"{message:'', code: ''}").code?e.resolve():e.reject()}),e.promise()},resolveCheckpointRequest:function(){var e=new $.Deferred;return this.submitCheckpointRequest().done(function(){e.resolve()}).fail(function(t){var i=JSON.parse(t.responseText||"{message:'', code: ''}");"UNKNOWN_ERROR"===i.code&&-1!==i.message.indexOf("Requested value")&&-1!==i.message.indexOf("was not found")?e.resolve():e.reject()}),e.promise()},closeExitRule:function(){var e=new $.Deferred;return this.properties.hasexitrule?$.when(this.openLinkRule("exitrule")).done(function(t){e.resolve(t)}).fail(function(){e.reject()}):e.resolve(),e.promise()},getFormLinkXpathContext:function(){var e=this.properties.xpathContext,t=this.getXpathContext();return t&&e?0===e.indexOf(t)?e:t+"."+e:e},configureHandlers:function(){this.attachEvents()},configureHandlersReadOnly:function(){this.attachEvents()},attachEvents:function(){var e=this,t=e.getControl();$("[data-action=open]",t).on("click",function(){bizagi.loading.start(),$.when(e.renderEdition()).always(function(){bizagi.loading.stop()})})},processLayout:function(e){e?void 0!==this.properties.textFormat.background&&this._super(e,{background:this.properties.textFormat.background}):this._super(e,this.properties.textFormat)},getElementsToStylize:function(e){return $(".bz-link",e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.geolocation",bizagi.rendering.geolocation.prototype),bizagi.rendering.smartphone.geolocation.extend("bizagi.rendering.smartphone.geolocation",{ALLOW_UPDATE:"update"},{postRender:function(){var e=this.getControl();this.coordinate=e.find("input"),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate("readonly");return $.fasttmpl(e,{value:this.getDisplayValue()})},postRenderReadOnly:function(){var e=this.getControl();this.coordinate=e.find("input"),this._super()},configureHandlers:function(){var e=this,t=e.getControl();null==e.value&&e.updateDisplayValue(),t.on("click","[data-action="+e.Class.ALLOW_UPDATE+"]",e.processAction.bind(e))},setDisplayValue:function(e){var t=this,i=new $.Deferred;if(null!=e&&""!==e)t.coordinate&&t.coordinate.val(t.performPrecision(e)),t.setValue(e,!1),i.resolve();else{var a=function(e){var a=e.coords.latitude+" "+e.coords.longitude;t.coordinate.val(t.performPrecision(a)),t.setValue(a,!1),i.resolve()},r=function(e){i.reject(e)};bizagi.util.isCordovaSupported()&&bizagi.util.isiOSDevice()?navigator.geolocation.getCurrentPosition(a,r):t.getCurrentPosition(a,r)}return i.promise()},updateDisplayValue:function(){var e=this;e.setDisplayValue().then(function(){e.setValidationMessage("")}).fail(function(t){e.coordinate.val(""),e.setValidationMessage(t)})},processAction:function(){this.coordinate.empty(),this.updateDisplayValue()},getElementsToStylize:function(e){return this.properties.editable?$("input",e):$(".readonly-control",e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.association",bizagi.rendering.association.prototype),bizagi.rendering.smartphone.association.extend("bizagi.rendering.smartphone.association",{},{renderControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=new $.Deferred;return e.properties.property="flipped",e.properties.idRender=e.properties.id,$.when(e.getFlipAssociation()).done(function(a){e.makeJsonBase(),e.properties.flipped=bizagi.util.parseBoolean(a)||!1;var r=e.getColumnData(),n=$.fasttmpl(t,$.extend(e.properties,{columnData:r}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation});e.setValue(JSON.encode(e.properties.formatJson)),i.resolve(n)}),i.promise()},getColumnData:function(){var e=this,t=e.properties,i=[];e.data=t;var a=t.flipped?t.rightData:t.leftData;return $.each(a,function(t,a){i.push({id:a.id,value:a.value,association:e.getRightAssociation(a.id)})}),i},postRender:function(){var e=this,t="execution"===e.getMode(),i=e.getControl();e.association=$(".bz-association",i),t&&e.addEventControl(),e.showDefaultGroupList()},showDefaultGroupList:function(){var e=this.getControl(),t=$(".bz-association-group",e);t.length>0&&($("[data-action='collapse']",t[0]).toggleClass("bz-icn--expanded"),$(".bz-association-group__list",t[0]).slideDown(300,function(){$(this).toggleClass("bz-association-group__list--hidden")}))},addEventControl:function(){var e=this,t=e.renderFactory.getTemplate("association"),i=e.getControl();e.association.on("change","input:checkbox",function(){var t=$(this),i=t.data("parent-id"),a=t.data("id");t.prop("checked")?e.addElement(i,a):e.removeElement(i,a)}),e.association.find("[data-action='flip']").click(function(){$(i).empty(),e.properties.flipped=!e.properties.flipped,e.properties.flipstate=e.properties.flipped,e.dataService.getFlipAssociation(e.properties);var a=e.getColumnData();$($.fasttmpl(t,$.extend(e.properties,{columnData:a}),{getColumnData:e.getColumnData,getRightAssociation:e.getRightAssociation})).appendTo(i),e.postRender()}),e.association.on("click","[data-action='collapse']",function(){var t=$(this),i=t.parents(".bz-association-group").find(".bz-association-group__list");e.closeAccordionSection(),i.hasClass("bz-association-group__list--hidden")&&(t.toggleClass("bz-icn--expanded"),i.slideDown(300,function(){$(this).toggleClass("bz-association-group__list--hidden")}))})},closeAccordionSection:function(e){var t=this.getControl();$("[data-action='collapse']",t).removeClass("bz-icn--expanded"),$(".bz-association-group__list",t).slideUp(300,function(){$(this).addClass("bz-association-group__list--hidden")})},renderReadOnly:function(){return this.renderControl()},postRenderReadOnly:function(){this.postRender()},setDisplayValue:function(e){this.setValue(e,!1)},getLabel:function(){if(!this.label){var e=$("> .bz-form-label",this.element||this.observableElement);return e.length>0&&(this.label=e),e}return this.label}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.searchList",bizagi.rendering.searchList.prototype),bizagi.rendering.smartphone.searchList.extend("bizagi.rendering.smartphone.searchList",{SEARCH_MIN_LENGTH:2,SEARCH_MAX_RECORDS:50,SEARCH_DELAY:250,SEARCH_ELEMENTS:{}},{renderControl:function(){var e=this,t=e.properties,i=e.renderFactory.getTemplate("searchList");return $.fasttmpl(i,{id:t.id,value:t.value.map(function(t){return e.formatItem(t.value)}).join(", ")})},postRender:function(){this.searchListInput=$(".bz-search-list__input",this.getControl())},postRenderReadOnly:function(){this.searchListInput=$(".bz-search-list__input",this.getControl())},renderReadOnly:function(){var e=this.renderFactory.getTemplate("searchList.readonly");return $.fasttmpl(e,{items:this.properties.value||{},editable:this.properties.editable||!0},{formatItem:this.formatItem})},configureHandlers:function(){var e=this;e.searchListInput.on("click",function(t){($(t.target).parent()||{}).hasClass("bz-pill")||e._searchListViewModal()})},_searchListViewModal:function(){var e=this,t=e.getHeaderTemplate(),i=e.getContentTemplate(),a=e.getFooterTemplate();e.searchListInput.mobileView({customHeader:t,orientation:e.properties.orientation||"",cssClassHeader:"bz-modal-view__header-multiple",contentTemplate:i,footerTemplate:a,transition:"slideIn:up",close:function(){$(window).unbind("resize"),e.triggerGlobalHandler("modalViewDidDisappear",{})},afterOpenAnimation:function(e){$(".bz-modal-view__search",e.view.header).focus()},open:function(){e.triggerGlobalHandler("modalViewDidAppear",{})},configureActions:function(t){e.adjustResize(),e.configureModalViewHandlers(t)}})},setDisplayValue:function(e){var t=this,i="string"==typeof e?JSON.parse(e).value:e.value;t.setValue(i),void 0!==e&&t.properties.editable&&t.searchListInput.html(i.map(function(e){return t.formatItem(e.value)}).join(", "))},deleteItem:function(e){var t=e.parent("div");this.removeElement({id:t.data("id")}),t.remove()},selectItem:function(e){var t=this.getTagTemplate(e,this.properties.editable);this.modalViewTagList.append(t)},configureModalViewHandlers:function(e){var t=this,i=e.footer,a=e.header,r={};if(t.hasValue()){var n=t.getListItems();$.each(n,function(e,t){r[t.id]=t})}t.modalViewList=$(".bz-list",e.content),t.modalViewTagList=$(".bz-search-pill__results",a);var o=$(".bz-modal-view__clear",a),s=$(".bz-modal-view__search",a),l=bizagi.util.debounce(function(){""===this.value?o.removeClass("bz-modal-view__clear--visible"):o.addClass("bz-modal-view__clear--visible"),t.autoCompleteSearchResults($.trim(this.value))},this.Class.SEARCH_DELAY);s.on("change keyup",l).on("focus",function(){e.header.addClass("bz-modal-view__header--active")}).on("blur",function(){e.header.removeClass("bz-modal-view__header--active")}),o.bind("click",function(){s.val("").trigger("change")}),$("[data-action=close]",e.header).bind("click",function(){e.close()}),t.modalViewList.on("click","li",function(){var e=$.data(this).item;!e||e&&r[e.id]||(r[e.id]=e,$(i).find(".bz-btn").removeClass("bz-btn--secundary"),$(i).find(".bz-btn").addClass("bz-btn--primary"),1===(Object.keys(r)||[]).length&&$(a).find(".bz-search-pill__selected ").removeClass("bz-search-pill__selected--hidden"),t.selectItem(e))}),t.modalViewTagList.on("click",".bz-pill > .bz-btn-icn",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parent("div");$(i).find(".bz-btn").removeClass("bz-btn--secundary"),$(i).find(".bz-btn").addClass("bz-btn--primary"),delete r[t.data("id")],t.remove(),0===(Object.keys(r)||[]).length&&$(a).find(".bz-search-pill__selected ").addClass("bz-search-pill__selected--hidden")}),$(i).delegate("[data-action=save]","click",function(i){var a=[];$.each(r,function(e,t){a.push(t)}),t.setDisplayValue({value:a}),e.close()})},autoCompleteSearchResults:function(e){var t=this;$.when(t.processRequest({term:e})).done(function(e){t.modalViewList.find("li").remove();for(var i=0,a=e.length;i<a;i++){t.renderSearchItem(e[i]).appendTo(t.modalViewList)}})},renderSearchItem:function(e){var t=this.renderFactory.getTemplate("searchList.item"),i=$.tmpl(t,{id:e.id,label:e.label,value:this.formatItem(e.value)});return i.data("item",e),i},processRequest:function(e){var t=this,i=t.properties,a=new $.Deferred,r=[];return e.term.length>=this.Class.SEARCH_MIN_LENGTH?(i.term=e.term,t.deferredReference&&"function"==typeof t.deferredReference.reject&&"resolved"!==t.deferredReference.state()&&t.deferredReference.reject({hideStatus:!0}),t.deferredReference=t.getData().done(function(n){n&&n.length>0?((n=n.slice(0,i.maxRecords)).length>t.Class.SEARCH_MAX_RECORDS?(n=n.slice(0,t.Class.SEARCH_MAX_RECORDS),r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-search-maximum-records-allowed"),value:""})):n=n.slice(0,i.maxRecords),$.each(n,function(t,a){if(0===i.maxRecords||t<i.maxRecords){var n=bizagi.util.highlightMatches(a,e.term);r.push({id:a.id,label:n,value:a.value})}})):r.push({id:t.Class.NO_RESULTS_SEARCH_ID,label:t.getResource("render-grid-no-records"),value:""}),a.resolve(r)}).fail(function(){a.reject()})):a.resolve(r),a.promise()},getContentTemplate:function(){var e=this.getValue(),t="string"==typeof e?JSON.parse(e).value:e.value,i=this.renderFactory.getTemplate("searchList.items"),a=$.fasttmpl(i,{items:t||{},editable:this.properties.editable||!0},{formatItem:this.formatItem});return $.trim(a)},getFooterTemplate:function(){var e=this.renderFactory.getTemplate("searchList.actions"),t=$.fasttmpl(e,{items:this.properties.value||{},editable:this.properties.editable||!0});return $.trim(t)},getTagTemplate:function(e,t){var i=this.renderFactory.getTemplate("searchList.tag"),a=$.fasttmpl(i,{id:e.id,label:e.label,value:this.formatItem(e.value),editable:t});return $.trim(a)},adjustResize:function(){var e=window.innerHeight;$(window).off("resize").on("resize",bizagi.util.debounce(function(){$(this).height()<e?$(".bz-mobile-view__footer_content").addClass("bz-hidden"):$(".bz-mobile-view__footer_content").removeClass("bz-hidden")},this.Class.SEARCH_DELAY))},getHeaderTemplate:function(){var e=this.getValue(),t="string"==typeof e?JSON.parse(e).value:e.value,i=this.renderFactory.getTemplate("searchList-modal-header"),a=$.fasttmpl(i,{items:t||{},editable:this.properties.editable||!0,emptyItems:0===(t||[]).length},{formatItem:this.formatItem});return $.trim(a)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.userfieldWrapper",bizagi.rendering.userfieldWrapper.prototype),bizagi.rendering.smartphone.userfieldWrapper.extend("bizagi.rendering.smartphone.userfieldWrapper",{},{getUserfieldControl:function(){var self=this,sControl=self.userfieldName,mode=self.getMode(),exists="execution"!==mode||eval("bizagi.rendering.smartphone."+sControl+" !== undefined"),def=new $.Deferred;return exists?$.when(self.parent.ready()).done(function(){def.resolve(self.createUserfieldInstance(sControl))}):$.when(self.dataService.getUserfieldDefinition({userfield:self.userfieldGuid,device:"smartphone"})).pipe(function(e){self.loadUserfield(e),def.resolve(self.createUserfieldInstance(sControl))}),def.promise()},createUserfieldInstance:function(sControl){var self=this,control;try{var dynamicFunction="var baDynamicFn = function(renderParams){ \r\n";dynamicFunction+="return new bizagi.rendering.smartphone."+sControl+"(renderParams);\r\n",dynamicFunction+="}\r\n",dynamicFunction+="baDynamicFn",dynamicFunction=eval(dynamicFunction),control=dynamicFunction(self.initialParams)}catch(e){control=self.getUserFieldInstance(self.initialParams)}return control.properties.isUserField=!0,self.userfieldInstance=control,self.replicateUserfieldMethods(control),self.userfieldInstance.bind("renderchange",function(){self.triggerHandler("renderchange",arguments)}),control},loadUserfield:function(data){var self=this;self.properties.styleGuid=self.properties.styleGuid||Math.guid();try{try{data=eval(data)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}$.each(data,function(e,t){if("js"==t.type)try{t.content=t.content.replace(/bizagi\.rendering\.[^\s]+\.extend(\s|\n|\s)*\((\s|\n|\s)*\"bizagi\.rendering\.[^\s]+\"/gim,function(e){return e.replace(/bizagi.rendering/gi,"bizagi.rendering.smartphone")}),window.eval(t.content)}catch(e){bizagi.log("Could not parse result userfield3 "+self.userfieldName,e.message)}"css"==t.type&&bizagi.util.loadStyle(t.content,self.properties.styleGuid)});var control=eval("bizagi.rendering."+self.userfieldName)}catch(e){bizagi.log("Could not parse result userfield "+self.userfieldName,e.message)}},getUserFieldInstance:function(e){return"execution"===this.getMode()?new bizagi.rendering.smartphone.defaultUserField(e):new bizagi.rendering.smartphone.designUserField(e)}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.basicUserField",bizagi.rendering.userfieldDefinition.prototype),bizagi.rendering.smartphone.basicUserField.extend("bizagi.rendering.smartphone.basicUserField",bizagi.rendering.basicUserField.prototype),bizagi.rendering.smartphone.basicUserField.extend("bizagi.rendering.smartphone.basicUserField",{},{renderSingle:function(){return this.postRender()},renderEdition:function(){var e=this,t=$.Deferred();return $.when(e.postRender()).done(function(){$.when(e.renderUserfieldControl()).done(function(){e.inputEdition=e.input,t.resolve()})}),t.promise()},getEditableControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getEditableControl.apply(this,arguments)},getReadonlyControl:function(){if(!this.isSupported())return bizagi.rendering.defaultUserField.prototype.getReadonlyControl.apply(this,arguments)},isSupported:function(){return!0}}),bizagi.rendering.smartphone.basicUserField.extend("bizagi.rendering.smartphone.defaultUserField",{},{getEditableControl:function(){var e=this,t=e.getControl(),i=e.getContainerRender(),a=e.properties.control.replace(/column/g,"");return e.input=$("<label>Userfield: "+a+" not found</label>").appendTo(t),e.input.addClass("ui-bizagi-render-userfield-notSupported"),i.addClass("bz-command-not-edit"),e.input},collectData:function(e){},getDisplayValue:function(){return"Userfield: "+this.properties.control+" not found"},getReadonlyControl:function(){var e=this.getControl(),t=this.properties.control;return $("<label>Userfield: "+t+" not found</label>").appendTo(e)}}),bizagi.rendering.smartphone.checkList.extend("bizagi.rendering.smartphone.activityCheckList",{},{initializeData:function(e){this._super(e);var t=this.properties.activityDescription&&""!==this.properties.activityDescription?bizagi.localization.getResource("workportal-project-plan-activity-goal")+": "+this.properties.activityDescription:"";this.properties.displayName=""!==t?t:bizagi.localization.getResource("workportal-project-plan-activity-work-title"),this.properties.displayType="vertical"},postRender:function(){var e=this,t=e.getControl();this._super(),e.newItemName=$(".bz-checkList__input",t),e.addEditButton=$(".add-edit-item-button-checklist",t),e.cancelEditButton=$(".cancel-edit-item-button-checklist",t),e.additionalElements(),e.notifyLoadItems()},notifyLoadItems:function(){var e=this;setTimeout(function(){var t=e.properties.items.filter(function(e){return e.resolved}).length;bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!0,idActivity:e.properties.idActivity,itemsResolved:t,items:e.properties.items,progress:e.properties.activityWork})),bizagi.webpart.publish("onLoadDataItemsFromFormActivityPlan",{items:e.properties.items,activityWork:e.properties.activityWork})},100)},additionalElements:function(){var e=this;e.addEditButton&&e.addEditButton.length>0&&e.addEditButton.hide(),e.cancelEditButton&&e.cancelEditButton.length>0&&e.cancelEditButton.hide()},configureHandlers:function(){var e=this,t=e.getControl();this._super(),$("[data-action=add]",t).unbind("click").click(function(){var t=$(".bz-checkList__item.bz-checkList__item--selected",e.control);t.length<=0?e.prepareNewItem():$(".bz-checkList__input",t).focus()}),$("[data-action=delete]",e.control).bind("click",function(){var t=this,i=bizagi.localization.getResource("workportal-widget-reports-confirm"),a=$(this).closest(".bz-checkList__item");a.addClass("ui-bizagi-to-remove"),$.when(bizagi.showConfirmationBox(i,"Bizagi","info")).done(function(){var i=$(t).closest(".bz-checkList__item").data("item-guid");e.deleteItem(i)}).fail(function(){a.removeClass("ui-bizagi-to-remove")})}),$("label[data-action=edit-item]",e.control).bind("click",function(){var t=$(this).closest(".bz-checkList__item"),i=t.data("item-guid"),a=t.data("item-position");e.selectItem(i,a)})},selectItem:function(e){for(var t=this,i=0,a=t.properties.items.length;i<a;i++)t.properties.items[i].guid===e?t.properties.items[i].selected=!0:t.properties.items[i].selected=!1;t.repaintControl();var r=$(".bz-checkList__item.bz-checkList__item--selected",t.getControl()),n=$(".bz-checkList__input",r),o=n.val();n.focus(),n[0].setSelectionRange(o.length,o.length),t.addSelectedHandlers()},deleteItem:function(e){for(var t=this,i=0,a=t.properties.items.length;i<a;i++)if(t.properties.items[i].guid===e){t.properties.items.splice(i,1);break}t.setValue(t.properties.items),t.repaintControl(),t.addSelectedHandlers()},prepareNewItem:function(){var e=this,t={guid:Math.guid(),resolved:!1,name:"",selected:!0};e.properties.items.push(t),e.repaintControl(),e.newItemName.focus(),e.newItemName.blur(function(){var t=$(".bz-checkList__item.bz-checkList__item--selected",e.control);""===$(".bz-checkList__input",t).val()&&e.properties.items&&e.properties.items.length>=1&&""===e.properties.items.slice(-1)[0].name&&e.properties.items.pop()}),e.addSelectedHandlers(),e.newItemName.keypress(function(t){13==t.which&&(t.preventDefault(),e.addItem(),e.prepareNewItem())})},addSelectedHandlers:function(){var e=this,t=$(".bz-checkList__item.bz-checkList__item--selected",e.control),i=$(".bz-checkList__input",t);i.focus(),$("[data-action=accept-edit]",t).bind("click",function(){var t=i.val();t&&""!==t&&e.addItem()}),$("[data-action=cancel-edit]",t).bind("click",function(t){var a=i.val(),r=$(this).closest(".bz-checkList__item"),n=r.data("item-position"),o=r.data("item-guid");a&&""!==a&&""!==e.properties.items[n].name&&(e.properties.items[n].selected=!1),""!==a&&""!==e.properties.items[n].name||e.deleteItem(o),e.repaintControl()})},addItem:function(){var e=this,t=e.getControl(),i=$(".bz-checkList__item.bz-checkList__item--selected",t),a=$(".bz-checkList__input",i).val();$.each(e.properties.items,function(e,t){t.selected&&(t.name=a,t.selected=!1)}),e.updateOriginalValue(),e.setValue(e.properties.items),e.repaintControl()},repaintControl:function(){var e=this.renderControl();$("[data-component=checkList]",this.control).replaceWith(e),this.postRender(),this.configureHandlers()},onCheckListGroupChange:function(e,t){var i,a=this,r=$.grep(a.properties.items,function(t,i){return t.guid===e});r&&r.length>0&&(i=r[0]),i.resolved=t,a.setValue(a.properties.items),a.refreshValue(a.properties.items)},refreshValue:function(e){for(var t=e.length,i=0,a=0;a<t;a++)e[a].resolved&&(i+=1);this.properties.activityWork=t>0?Math.floor(100*i/t):100,this.notifyLoadItems()},getValue:function(){return this.value||[]},controlValueIsChanged:function(){return JSON.stringify(this.properties.originalValue)!==JSON.stringify(this.value)},updateOriginalValue:function(){this.properties.originalValue=bizagi.clone(this.value)},collectData:function(e){var t=this.properties,i=t.xpath,a=this.getValue(),r=this.properties.idActivity;this.controlValueIsChanged()?bizagi.util.isEmpty(i)||bizagi.util.isEmpty(r)||(Array.isArray(a)?e[t.xpath]={idActivity:r,items:a}:""===a&&(e[t.xpath]="")):bizagi.util.setItemLocalStorage("newChanges",JSON.stringify({hasChanges:!1}))},isValid:function(e){var t,i=this.properties,a=this.getValue();t=this.getResource("render-activity-check-list-validation");for(var r=0;r<a.length;r+=1){if(!a[r].resolved){e.push({xpath:i.xpath,message:t});break}}}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.numberScientificNotation",bizagi.rendering.numberScientificNotation.prototype),bizagi.rendering.smartphone.numberScientificNotation.extend("bizagi.rendering.smartphone.numberScientificNotation",{},{}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.range",bizagi.rendering.range.prototype),bizagi.rendering.smartphone.range.extend("bizagi.rendering.smartphone.range",{},{postRender:function(){this.properties},setDisplayValue:function(e){this.getControl()}}),bizagi.rendering.smartphone.range.extend("bizagi.rendering.smartphone.rangeDate",bizagi.rendering.rangeDate.prototype),bizagi.rendering.smartphone.rangeDate.extend("bizagi.rendering.smartphone.rangeDate",{},{postRender:function(){this.defineRangeControl()}}),bizagi.rendering.smartphone.range.extend("bizagi.rendering.smartphone.rangeMoney",bizagi.rendering.rangeMoney.prototype),bizagi.rendering.smartphone.rangeMoney.extend("bizagi.rendering.smartphone.rangeMoney",{},{postRender:function(){this.defineRangeControl()}}),bizagi.rendering.smartphone.range.extend("bizagi.rendering.smartphone.rangeNumber",bizagi.rendering.rangeNumber.prototype),bizagi.rendering.smartphone.rangeNumber.extend("bizagi.rendering.smartphone.rangeNumber",{},{postRender:function(){this.defineRangeControl()}}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.layoutRender",bizagi.rendering.layoutRender.prototype),bizagi.rendering.smartphone.layoutRender.extend("bizagi.rendering.smartphone.layoutImage",bizagi.rendering.layoutImage.prototype),bizagi.rendering.smartphone.layoutImage.extend("bizagi.rendering.smartphone.layoutImage",{},{renderControl:function(){var e=this.renderFactory.getTemplate("layout-image");return this.control=this.getControl(),$.fasttmpl(e,{})},postRender:function(){var e=this,t=e.getControl();if(e.value&&void 0!==e.value.value&&""!==e.value.value&&null!==e.value.value){var i=e.getImageUri();$.ajax({url:i,type:"GET",dataType:"binary",processData:!1,success:function(e){if("string"==typeof e){var i=arguments[2].getResponseHeader("Content-type");e=bizagi.util.media.byteArrayToBlob(bizagi.util.media.stringToByteArray(e),i)}var a=(window.URL||window.webkitURL).createObjectURL(e);$(t).find("img").attr("src",a)}})}},getImageUri:function(){var e=this,t={entity:e.value.guid,surrogateKey:e.value.surrogateKey,xpath:e.properties.xpath,width:96,height:96,hash:e.value.value};return e.dataService.serviceLocator.getUrl("render-entity-layout-imageByteArray").replaceMultiple(t)},getDisplayValue:function(){return[this.value]}}),bizagi.rendering.smartphone.layoutRender.extend("bizagi.rendering.smartphone.layoutPlaceholder",bizagi.rendering.layoutPlaceholder.prototype),bizagi.rendering.smartphone.layoutRender.extend("bizagi.rendering.smartphone.layoutBoolean",bizagi.rendering.layoutBoolean.prototype),bizagi.rendering.smartphone.layoutRender.extend("bizagi.rendering.smartphone.layoutLink",bizagi.rendering.layoutLink.prototype),bizagi.rendering.smartphone.layoutLink.extend("bizagi.rendering.smartphone.layoutLink",{configureHandlers:function(){var e=this.element;e&&e.on("click",$.proxy(this.onClickElement,this))},onClickElement:function(){var e=this,t={displayName:e.properties.displayName,navigateFromRender:!1,reference:e.properties.reference,referenceType:e.properties.referenceType,xpath:e.properties.xpath};bizagi.kendoMobileApplication&&"#renderSplitView"==bizagi.kendoMobileApplication.view().id&&(t.navigateFromRender=!0),e.triggerGlobalHandler("DATA-NAVIGATION",t)}}),bizagi.rendering.smartphone.layoutRender.extend("bizagi.rendering.smartphone.layoutLabel",bizagi.rendering.layoutLabel.prototype),bizagi.rendering.smartphone.layoutLabel.extend("bizagi.rendering.smartphone.layoutLabel",{setValue:function(e,t){this.properties.displayName=e,this._super(e,t);var i=this.getControl();i&&$(".ui-bizagi-render-label",i).text(e)}}),bizagi.rendering.smartphone.layoutRender.extend("bizagi.rendering.smartphone.layoutText",bizagi.rendering.layoutText.prototype),bizagi.rendering.smartphone.layoutText.extend("bizagi.rendering.smartphone.layoutText",{setDisplayValue:function(e){}}),bizagi.rendering.smartphone.layoutRender.extend("bizagi.rendering.smartphone.layoutDateTime",bizagi.rendering.layoutDateTime.prototype),bizagi.rendering.smartphone.layoutRender.extend("bizagi.rendering.smartphone.layoutNumber",bizagi.rendering.layoutNumber.prototype),bizagi.rendering.smartphone.layoutNumber.extend("bizagi.rendering.smartphone.layoutNumber",{setValue:function(e,t){var i=this.getControl();e=null==e?"":this.getDisplayValue(e),this.properties.displayName=e,this._super(e,t),i&&$(".ui-bizagi-render-number",i).text(e)},getDisplayValue:function(e){var t=this.properties,i=$("<label/>").html(e);return i.formatCurrency({symbol:t.symbol,positiveFormat:t.positiveFormat,negativeFormat:t.negativeFormat,decimalSymbol:t.decimalSymbol,digitGroupSymbol:t.digitGroupSymbol,groupDigits:t.groupDigits,roundToDecimalPlace:t.numDecimals,colorize:t.colorize}),[i.text()]}}),bizagi.rendering.smartphone.layoutRender.extend("bizagi.rendering.smartphone.layoutMoney",bizagi.rendering.layoutNumber.prototype),bizagi.rendering.smartphone.layoutMoney.extend("bizagi.rendering.smartphone.layoutMoney",bizagi.rendering.layoutMoney.prototype),bizagi.rendering.smartphone.layoutMoney.extend("bizagi.rendering.smartphone.layoutMoney",{setValue:function(e,t){var i=this.getControl();e=null==e?"":this.getDisplayValue(e),this.properties.displayName=e,this._super(e,t),i&&$(".ui-bizagi-render-number",i).text(e)}}),bizagi.rendering.smartphone.layoutRender.extend("bizagi.rendering.smartphone.layoutUpload",bizagi.rendering.layoutUpload.prototype),bizagi.rendering.smartphone.layoutUpload.extend("bizagi.rendering.smartphone.layoutUpload",{renderControl:function(){var e=this,t=e.properties,i=$.Deferred();return $.when(e.getValueFilesByData(bizagi.clone(t))).done(function(t,a){e.properties=t,e.files=a.files,i.resolve(e.getHTMLFiles())}),i.promise()},postRender:function(){var e=this;e.getControl().find(".ui-bizagi-render-upload-item a").on("click",function(){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile($(this).attr("data-url"),this.title)).fail(function(t){t.responseText&&e.getFormContainer().failHandler(t.responseText)}).always(function(){bizagi.loading.stop()})})},getHTMLFiles:function(){var e=this,t=$.map(e.files,function(t){var i={id:t[0],filename:t[1]};return i.url=e.buildItemUrl(i),i}),i=e.renderFactory.getTemplate("layout-upload");return $.fasttmpl(i,{files:t})},buildItemUrl:function(e){var t=this,i=t.properties,a=t.getFormContainer();return t.dataService.getUploadFileEntityUrl({isContextContainerWidgetRender:t.isContextContainerWidgetRender(),xpath:t.getUploadXpath(),fileId:e.id,idRender:a.properties.paramsRender.idRender||"undefined",xpathContext:i.xpathContext,idPageCache:a.properties.paramsRender.idPageCache||"undefined",xpathActions:a.properties.paramsRender.xpathActions||"undefined",sessionId:a.properties.sessionId,surrogatekey:t.properties.value.surrogateKey,guidentity:t.properties.value.guid})}}),bizagi.rendering.columns.column.extend("bizagi.rendering.smartphone.columns.column",{},{applyOverrides:function(e){e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl,e.properties.displayType="normal")},getContainerMessage:function(e){var t=this.getDecorated(e);return $(".bz-form-cell-message__text",t.element)},getControl:function(){return $(".bz-control",this.element||this.observableElement)},isValueValid:function(e,t,i,a){var r=this._super(e,t,i,a),n=this.getDecorated(e),o=this.getContainerMessage(e);if(r)o.text(""),n.element.removeClass("bz-form-item--error");else{var s=i.join(",").replace(/<\w+>([^<]*)<\/\w+>/g,"$1");o.text(s),n.element.addClass("bz-form-item--error")}return r},applyColumnStyles:function(e){var t=this.properties;t.textFormat.background&&(e.css("background-color",t.textFormat.background),e.css("background-image","none"))},postRenderReadOnly:function(e,t){if(this._super(key,t),t&&t.length>0){var i=$(".ui-bizagi-cell-icon",t);this.properties.editable||i.detach(),this.applyColumnStyles(t),"left"==this.properties.align&&i.addClass("ui-bizagi-cell-icon-right")}}}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.combo",{},bizagi.rendering.columns.combo.prototype),bizagi.rendering.smartphone.columns.combo.extend("bizagi.rendering.smartphone.columns.combo",{},{applyOverrides:function(e){this._super(e),e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl,e.properties.displayType="normal")},getControl:function(){var e=this._super();return e&&0!=e.length||(e=$(".ui-bizagi-cell-readonly",this.element||this.observableElement)),e},setValue:function(e,t){var i=this,a=i.getDecorated(e),r=bizagi.util.isOfflineForm({context:i});if(null!==a){if("summary"==e)return i._super(e,t);if(!r||"number"!=typeof t&&"string"!=typeof t)if(t&&t.length>0){n={id:t[0][0],value:t[0].length>2?$.grep(t[0],function(e,t){return 0!=t}):t[0][1]};i._super(e,n),a.selectedValue=n.value}else t&&t.id&&t.value?(i._super(e,t),a.selectedValue=t.value):"columnRadio"==i.properties.type?(i._super(e,null),a.selectedValue=t):t&&"number"==typeof t?i._super(e,t):r&&null!==t&&"object"==typeof t&&t.value?(i._super(e,t.value),a.selectedValue=t.value):(i._super(e,null),a.selectedValue="");else{var n="object"==typeof i.properties.data?i.properties.data.find(function(e){return e.id==t}):t;i._super(e,n),a.selectedValue=t}}}}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.document",{},{applyOverrides:function(e){var t=this.getMode();this._super(e),"design"!==t&&(this.surrogateKey=e.surrogateKey,e.getXpath=this.getXpath,e.getDocumentXpath=this.getDocumentXpath,e.getContextXpath=this.getContextXpath,e.documentTemplateGenerate=this.documentTemplateGenerate,e.preRenderControl=this.preRenderControl,e.deleteDocumentTemplate=this.deleteDocumentTemplate,e.properties.xpathContext=this.getContextXpath())},renderControl:function(){return this.preRenderControl(),this._super()},documentTemplateGenerate:function(){var e=this,t=e.properties;e.startLoading(),t.xpathcontext=e.getContextXpath(),t.xpath=e.getDocumentXpath(t.xpath);var i=e.parent,a=e.getFormContainer();$.when(a.submitData()).done(function(){$.when(e.dataService.generateDocumentTemplate(t)).done(function(t){$.when(i.refresh()).done(function(){e.autoOpenDocuments()}),e.endLoading()}).fail(function(){e.showErrorMessage(),e.endLoading()})}).fail(function(t){e.getFormContainer().addErrorMessage(t),e.endLoading()})},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getDocumentXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),t},postRenderReadOnly:function(e,t,i){this._super(e,t,i)},getContextXpath:function(){var e=this.getFormContainer();return(e.properties.xpathContext?e.properties.xpathContext+".":"")+this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},preRenderControl:function(){null!=this.value&&null!=this.properties.value&&(this.properties.value=this.value)},deleteDocumentTemplate:function(e){var t=this,i=t.parent,a={};a.xpath=t.properties.xpath+"[fileName='"+e+"']",a.idRender=t.properties.id,a.xpathContext=t.getContextXpath(),a.idPageCache=t.properties.idPageCache,$.when(t.dataService.deleteUploadFile(a)).done(function(){i.refresh()})}}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.date",{},{}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.text",{},{}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.number",{},{}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.image",{},{applyOverrides:function(e){this._super(e);var t=("undefined"!=this.grid.properties?this.grid.properties:e.grid.properties).xpath+"[id="+e.surrogateKey+"]";e.properties.xpathContext=this.properties.xpathContext.length>0?this.properties.xpathContext+"."+t:t,e.setDisplayValue=function(){return!0}}}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.upload",{},{applyOverrides:function(e){var t=this,i=t.getMode();t._super(e),"design"!=i&&"layout"!=i&&(e.getUploadXpath=t.getUploadXpath,e.getXpathContext=function(){var i=this.surrogateKey||"",a=t.getUploadXpath(e).split("."),r=a[a.length-1],n=t.grid.properties.xpath+"[id="+i+"]";return{xpathContext:t.properties.xpathContext.length>0?t.properties.xpathContext+"."+n:n,nameFile:r}},e.buildItemUrl=function(e){var t=this,i=t.getFormContainer(),a=t.getXpathContext();return t.dataService.getUploadFileUrl({idRender:t.properties.id,xpath:a.nameFile,xpathContext:a.xpathContext,idPageCache:t.properties.idPageCache,fileId:e.id,sessionId:i.properties.sessionId,contexttype:t.properties.contexttype})})},getUploadXpath:function(e){var t=e||this;return t.grid.properties.xpath+"[id="+t.surrogateKey+"]."+t.properties.xpath}}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.link",{},{applyOverrides:function(e){var t=this,i=t.getMode();t._super(e),"design"!==i&&"layout"!==i&&(t.surrogateKey=e.surrogateKey,e.getXpath=t.getXpath,e.properties.xpathContext=t.grid.properties.xpath+"[id="+t.surrogateKey+"]",t.grid.properties.xpathContext&&-1===e.properties.xpathContext.indexOf(t.grid.properties.xpathContext)&&(e.properties.xpathContext=t.grid.properties.xpathContext+"."+e.properties.xpathContext)),"columnFormLink"===e.properties.type&&(e.getFormLinkXpath=this.getFormLinkXpath)},getXpath:function(e){var t=e,i=t.indexOf(this.grid.properties.xpath);return-1!==i&&(t=t.substr(i+this.grid.properties.xpath.length+1)),this.grid.properties.xpath+"[id="+this.surrogateKey+"]."+t},getContextXpath:function(){return this.grid.properties.xpath+"[id="+this.surrogateKey+"]"},getFormLinkXpath:function(){if(this.properties.maximized=null!==bizagi.util.parseBoolean(this.properties.maximized)&&bizagi.util.parseBoolean(this.properties.maximized),this.calculateInitialLayoutProperties(),this.properties.xpath)return this.properties.xpath}}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.search",{},bizagi.rendering.columns.search.prototype),bizagi.rendering.smartphone.columns.search.extend("bizagi.rendering.smartphone.columns.search",{},{applyOverrides:function(e){this._super(e)},render:function(e,t){return t&&t.length>0?(t=[].concat(t[0]),this._super(e,{id:t[0],label:t[1],additionallabel:t[2]||void 0})):this._super(e,t)}}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.uploadecm",{},{applyOverrides:function(e){this._super(e),e&&e.getControl&&(this.originalGetControl=e.getControl,e.getControl=this.getControl),e.getUploadXpath=this.getUploadXpath,e.getXpathContext=this.getECMXpathContext,e.buildItemUrl=function(e){var t=this,i=t.properties,a=t.getFormContainer(),r=t.getUploadXpath(t.surrogateKey),n=(r=r.split("."))[r.length-1],o=t.getXpathContext(t.surrogateKey);return t.dataService.getUploadFileUrl({idRender:i.id,xpath:n,xpathContext:o,idPageCache:i.idPageCache,fileId:e.idFileUpload,sessionId:a.properties.sessionId,contexttype:i.contexttype})},e.buildAddParams=function(){var e=this,t=e.properties,i=e.getFormContainer(),a=e.getUploadXpath(e.surrogateKey),r=((a=a.split("."))[a.length-1],e.getXpathContext(e.surrogateKey));return{url:t.addUrl,xpath:t.xpath,idAttrib:t.idAttrib,xpathContext:r,metaValues:[],idPageCache:t.idPageCache,idSession:i.properties.sessionId,contexttype:"entity",validExtensions:t.validExtensions,maxSize:t.maxSize}}},getUploadXpath:function(e){return e=this.surrogateKey||e||"",this.grid.properties.xpath+"[id="+e+"]."+this.properties.xpath},getControl:function(){var e=this._super();return e&&0!=e.length?$(".bz-control",this.element||this.observableElement):$(".ui-bizagi-cell-readonly",this.element||this.observableElement)},getECMXpathContext:function(){var e=this.grid.properties.xpath+"[id="+this.surrogateKey+"]";return this.column.properties.xpathContext?this.column.properties.xpathContext+"."+e:e}}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.button",{},{}),bizagi.rendering.smartphone.columns.combo.extend("bizagi.rendering.smartphone.columns.radio",{},{}),bizagi.rendering.smartphone.columns.combo.extend("bizagi.rendering.smartphone.columns.list",{},{}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.exclusiveCheck",{},{}),bizagi.rendering.smartphone.columns.column.extend("bizagi.rendering.smartphone.columns.readonly",bizagi.rendering.columns.readonly.prototype),bizagi.rendering.smartphone.columns.readonly.extend("bizagi.rendering.smartphone.columns.readonly",{},{}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.document",bizagi.rendering.document.prototype),bizagi.rendering.smartphone.document.extend("bizagi.rendering.smartphone.document",{ACTION_SHOW:"show",ACTION_DOWNLOAD:"download",ACTION_DELETE:"delete"},{renderControl:function(){var e=this.renderFactory.getTemplate(this.getTemplate()),t=this.properties.value||[],i={downloadalldocuments:this.properties.downloadalldocuments,allowgenerate:this.properties.allowGenerate,noFiles:!t||0===t.length,append:this.properties.append,caption:this.properties.caption},a=$.fasttmpl(e,i),r=this.renderDocumentsHtml(t);a=this.replaceFilesHtml(a,r);var n=this.renderActionsHtml(t,i.noFiles,i.downloadalldocuments);return a=this.replaceActionsHtml(a,n)},postRender:function(){var e=this.getControl();this.$inputDocument=$(".bz-document-template__container",e),this.$listDocuments=$("[data-component=files]",e),this.$listActions=$("[data-component=actions]",e),this._super()},renderReadOnly:function(){var e=this.renderFactory.getTemplate(this.getTemplateReadonly()),t=this.properties.value||[],i=!t||0===t.length,a=$.fasttmpl(e,{noFiles:i}),r=this.renderDocumentsHtml(t);return a=this.replaceFilesHtml(a,r)},postRenderReadOnly:function(){var e=this.getControl();this.$listDocuments=$("[data-component=files]",e)},configureHandlers:function(){var e=this;this.$inputDocument.on("click",function(t){e.properties.buttonExecuted=!0,e.properties.validate?e.validateContainer()&&e.documentTemplateGenerate():e.documentTemplateGenerate(),e.properties.buttonExecuted=!1}),this.$listDocuments.on("click","[data-action]",function(t){var i=$(this),a=i.parent(".bz-document").data(),r=i.data("action");e.processAction(r,a)}),e.$listActions.on("click","[data-action]",function(t){var i=$(this),a=i.parent(".bz-document__download").data(),r=i.data("action");e.processAction(r,a)})},configureHandlersReadOnly:function(){var e=this;this.$listDocuments.on("click","[data-action]",function(t){var i=$(this),a=i.parent(".bz-document").data(),r=i.data("action");e.processAction(r,a)})},renderAllDocumentDownload:function(e){var t=this.renderFactory.getTemplate(this.getTemplateDownload()),i=this.buildAllDocumentsUrl();return this.isExecutionMode()||(i="javascript:void(0);"),$.fasttmpl(t,{url:i,filename:e.fileName,joined:!0})},redrawDocuments:function(e,t,i){var a=this.getControl(),r=$("[data-component='files']",a),n=$("[data-component='actions']",a);r.empty(),n.empty();var o=this.renderDocumentsHtml(e);r.append(o);var s=this.renderActionsHtml(e,t,i);n.append(s),this.setValue(e)},showDocumentPreview:function(e,t){bizagi.loading.start(),$.when(bizagi.util.media.downloadFile(e,t)).fail(function(e){e.responseText&&self.getFormContainer().failHandler(e.responseText)}).always(function(){bizagi.loading.stop()})},resolveDocumentTemplateGenerate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e},resolveDeleteDocumentTemplate:function(e,t,i){this.redrawDocuments(e,t,i),this.value=e},processAction:function(e,t){e===this.Class.ACTION_DELETE?this.deleteDocumentTemplate(t.filename):e===this.Class.ACTION_SHOW?this.showDocumentPreview(t.url,t.filename):e===this.Class.ACTION_DOWNLOAD&&this.showDocumentPreview(t.url,t.filename)}}),bizagi.rendering.smartphone.form.extend("bizagi.rendering.smartphone.queryForm",{},{}),bizagi.rendering.smartphone.form.extend("bizagi.rendering.smartphone.formTemplate",bizagi.rendering.formTemplate.prototype),bizagi.rendering.smartphone.formTemplate.extend("bizagi.rendering.smartphone.formTemplate",{},{}),bizagi.rendering.smartphone.form.extend("bizagi.rendering.smartphone.usersForm",{},{}),bizagi.rendering.smartphone.render.extend("bizagi.rendering.smartphone.specific_text",{},{initializeData:function(e){this._super(e);var t=this.properties;t.regularExpressionExpression&&(t.regularExpression={expression:t.regularExpressionExpression,message:t.regularExpressionMessage||this.getResource("render-text-regular-expression-default-message")})},renderControl:function(){var e=this.properties,t=this.renderFactory.getTemplate("text");return $.fasttmpl(t,{value:e.value,isEmptyField:void 0===e.value,helpText:e.helpText,editable:e.editable})},renderReadOnly:function(){this.properties;var e=this.renderFactory.getTemplate("text-read-only");return $.fasttmpl(e,{value:this.getValue()})},postRender:function(){var e=this,t=e.getControl(),i=e.properties;e._super(),e.input=t.find("input"),"double"==i.retype&&e.attachRetypeDouble()},attachRetypeDouble:function(){var e=this,t=e.element,i=$("input",t);i&&0!=i.length&&i.blur(function(){var t=$(this);if("hidden"!=$(t).attr("type")&&"none"!=$(t).css("display")&&"hidden"!=$(t).css("visibility"))if(t.data("oldValue")&&""!=$(this).data("oldValue"))t.val()!=t.data("oldValue")?(e.setValue(""),t.val(""),t.data("oldValue",""),t.tooltip("destroy"),t.attr("title",e.getResource("render-text-retype-error")),t.tooltip(),t.tooltip("open"),setTimeout(function(){t.focus()},100)):(t.data("newValue",t.val()),t.data("oldValue",""),t.tooltip("destroy"));else{if(""==t.val())return;if(t.val()==t.attr("newValue"))return;t.data("oldValue",t.val()),t.val("");try{t.tooltip("destroy")}catch(e){}t.attr("title",e.getResource("render-number-retype")),t.tooltip(),t.tooltip("open"),setTimeout(function(){t.focus(),i.focus()},100)}})},configureHandlers:function(){var e=this,t=e.properties;e.getControl(),e.input;t.mask&&e.input.mask({mask:t.mask}),e.input.bind("change",function(){e.getValue();e.setValue(e.input.val(),!1);var i=[];"duplicate"!=t.retype&&(e.isValid(i)||void 0===t.regularExpression?e.setValue(e.input.val(),!0):message=i[0].message)}).keypress(function(e){var t=(e=window.event||e).charCode||e.keyCode;void 0!==e&&13==t&&$(this).trigger("change")})},isValid:function(e){var t=this.properties,i=this._super(e),a=this.getValue();if("string"==typeof a)if(t.regularExpression){if(a&&(a.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!a.match(new RegExp(t.regularExpression.expression))&&this.properties&&"userName"===this.properties.xpath)){var r=t.regularExpression.message;e.push({xpath:t.xpath,message:r}),i=!1}else if(a&&(a.match(new RegExp(".*?(<|\\u003C)(.+?)(>|\\u003E)(.?)|eval\\(|eval\\u0028","g"))||!a.match(new RegExp(t.regularExpression.expression)))){r=t.regularExpression.message;e.push({xpath:t.xpath,message:r}),i=!1}}else if(a&&a.match(new RegExp(".*?eval\\(","g"))&&a.match(new RegExp(".*?eval\\u0028","g"))&&t.editable){r=this.getResource("render-text-regular-expression-default-message");e.push({xpath:t.xpath,message:r}),i=!1}return i},setDisplayValue:function(e){var t=this.getControl(),i=this.getDisplayValue(),a=bizagi.util.decodeURI(e),r=bizagi.util.decodeURI(i);if(!bizagi.util.parseBoolean(this.properties.editable))if("string"==typeof e){var n=r.replaceAll("&","&amp;");n=(n=(n=(n=n.replaceAll("<","&lt;").replaceAll(">","&gt;")).replaceAll('"',"&#34;").replaceAll("'","&#39;").replaceAll("/","&#47;")).replaceAll("\\n","<br/>")).replaceAll("\n","<br/>"),t.html("<input class='readonly-control bz-form-control' readonly='readonly' value="+n+" >")}else bizagi.util.isNull(e)&&t.html("");this.setValue(a,!1)},setValue:function(e){this._super(e)},performDesignModeMethods:function(){this.properties;var e=this.getControl();null!==e&&$("select, button, textarea",e).attr("readonly",!0),this.configureDesignView(),this.internalSetInitialValue()}}),bizagi.rendering.base.factory.extend("bizagi.rendering.smartphone.factory",{},{loadTemplates:function(){var e=this,t=new $.Deferred;return $.when(e.loadTemplate("icons",e.getFileTemplate("common.bizagi.rendering.icons")),e.loadTemplate("form",e.getFileTemplate("bizagi.rendering.smartphone.form")+"#bz-form-container"),e.loadTemplate("complexgateway",e.getFileTemplate("bizagi.rendering.smartphone.form")+"#bz-form-complex-gateway"),e.loadTemplate("panel",e.getFileTemplate("bizagi.rendering.smartphone.panel")),e.loadTemplate("tab",e.getFileTemplate("bizagi.rendering.smartphone.tab")),e.loadTemplate("tabItem",e.getFileTemplate("bizagi.rendering.smartphone.tabItem")),e.loadTemplate("horizontal",e.getFileTemplate("bizagi.rendering.smartphone.horizontal")),e.loadTemplate("group",e.getFileTemplate("bizagi.rendering.smartphone.group")),e.loadTemplate("searchForm",e.getFileTemplate("bizagi.rendering.smartphone.searchForm")),e.loadTemplate("accordion",e.getFileTemplate("bizagi.rendering.smartphone.accordion")),e.loadTemplate("accordionItem",e.getFileTemplate("bizagi.rendering.smartphone.accordionItem")),e.loadTemplate("contentPanel",e.getFileTemplate("bizagi.rendering.smartphone.contentPanel")),e.loadTemplate("render",e.getFileTemplate("bizagi.rendering.smartphone.render")),e.loadTemplate("readonly",e.getFileTemplate("bizagi.rendering.smartphone.readonly")),e.loadTemplate("text",e.getFileTemplate("bizagi.rendering.smartphone.text")+"#bz-render-text"),e.loadTemplate("text-read-only",e.getFileTemplate("bizagi.rendering.smartphone.text")+"#bz-render-text-readonly"),e.loadTemplate("number",e.getFileTemplate("bizagi.rendering.smartphone.number")),e.loadTemplate("extendedText",e.getFileTemplate("bizagi.rendering.smartphone.extendedText")+"#bz-render-extended-text"),e.loadTemplate("extendedText-readOnly",e.getFileTemplate("bizagi.rendering.smartphone.extendedText")+"#bz-render-extended-text-readonly"),e.loadTemplate("date",e.getFileTemplate("bizagi.rendering.smartphone.date")),e.loadTemplate("yesno",e.getFileTemplate("bizagi.rendering.smartphone.yesno")),e.loadTemplate("check",e.getFileTemplate("bizagi.rendering.smartphone.check")),e.loadTemplate("checkList",e.getFileTemplate("bizagi.rendering.smartphone.checkList")),e.loadTemplate("button",e.getFileTemplate("bizagi.rendering.smartphone.button")),e.loadTemplate("link",e.getFileTemplate("bizagi.rendering.smartphone.link")),e.loadTemplate("formLink",e.getFileTemplate("bizagi.rendering.smartphone.formLink")),e.loadTemplate("geolocation",e.getFileTemplate("bizagi.rendering.smartphone.geolocation")),e.loadTemplate("radio",e.getFileTemplate("bizagi.rendering.smartphone.radio")),e.loadTemplate("association",e.getFileTemplate("bizagi.rendering.smartphone.association")),e.loadTemplate("ecm",e.getFileTemplate("bizagi.rendering.smartphone.ecm")+"#bz-render-ecm"),e.loadTemplate("ecm-item",e.getFileTemplate("bizagi.rendering.smartphone.ecm")+"#bz-render-ecm-item"),e.loadTemplate("ecm-readonly",e.getFileTemplate("bizagi.rendering.smartphone.ecm")+"#bz-render-ecm-readonly"),e.loadTemplate("image",e.getFileTemplate("bizagi.rendering.smartphone.image")+"#bz-render-image"),e.loadTemplate("image-item",e.getFileTemplate("bizagi.rendering.smartphone.image")+"#bz-render-image-item"),e.loadTemplate("image-preview",e.getFileTemplate("bizagi.rendering.smartphone.image")+"#bz-render-image-preview"),e.loadTemplate("image-readonly",e.getFileTemplate("bizagi.rendering.smartphone.image")+"#bz-render-image-readonly"),e.loadTemplate("upload",e.getFileTemplate("bizagi.rendering.smartphone.upload")+"#bz-render-upload"),e.loadTemplate("upload-readonly",e.getFileTemplate("bizagi.rendering.smartphone.upload")+"#bz-render-upload-readonly"),e.loadTemplate("upload-item",e.getFileTemplate("bizagi.rendering.smartphone.upload")+"#bz-render-upload-item"),e.loadTemplate("document",e.getFileTemplate("bizagi.rendering.smartphone.document")+"#bz-document-generator"),e.loadTemplate("document-item",e.getFileTemplate("bizagi.rendering.smartphone.document")+"#bz-document-generator-item"),e.loadTemplate("document-readonly",e.getFileTemplate("bizagi.rendering.smartphone.document")+"#bz-document-generator-readonly"),e.loadTemplate("document-download",e.getFileTemplate("bizagi.rendering.smartphone.document")+"#bz-document-generator-download"),e.loadTemplate("list-multiselect",e.getFileTemplate("bizagi.rendering.smartphone.multiSelect")+"#bz-multiselect"),e.loadTemplate("multiselect-list",e.getFileTemplate("bizagi.rendering.smartphone.multiSelect")+"#bz-multiselect-list"),e.loadTemplate("combo",e.getFileTemplate("bizagi.rendering.smartphone.combo")+"#bz-combo-control"),e.loadTemplate("combo-readonly",e.getFileTemplate("bizagi.rendering.smartphone.combo")+"#bz-combo-control-readonly"),e.loadTemplate("combo-list",e.getFileTemplate("bizagi.rendering.smartphone.combo")+"#bz-combo-control-list"),e.loadTemplate("modal-header-search",e.getFileTemplate("bizagi.rendering.smartphone.modal")+"#bz-modal-view-header-search"),e.loadTemplate("modal-header-title",e.getFileTemplate("bizagi.rendering.smartphone.modal")+"#bz-modal-view-header-title"),e.loadTemplate("modal-footer-done",e.getFileTemplate("bizagi.rendering.smartphone.modal")+"#bz-modal-view-footer-done"),e.loadTemplate("list",e.getFileTemplate("bizagi.rendering.smartphone.list")+"#bz-render-list"),e.loadTemplate("list-items",e.getFileTemplate("bizagi.rendering.smartphone.list")+"#bz-render-list-items"),e.loadTemplate("search",e.getFileTemplate("bizagi.rendering.smartphone.search")+"#bz-render-search"),e.loadTemplate("search.item",e.getFileTemplate("bizagi.rendering.smartphone.search")+"#bz-render-search-item"),e.loadTemplate("search.items",e.getFileTemplate("bizagi.rendering.smartphone.search")+"#bz-render-search-items"),e.loadTemplate("searchList",e.getFileTemplate("bizagi.rendering.smartphone.searchList")+"#bz-render-search-list"),e.loadTemplate("searchList.item",e.getFileTemplate("bizagi.rendering.smartphone.searchList")+"#bz-render-search-list-item"),e.loadTemplate("searchList.items",e.getFileTemplate("bizagi.rendering.smartphone.searchList")+"#bz-render-search-list-items"),e.loadTemplate("searchList.actions",e.getFileTemplate("bizagi.rendering.smartphone.searchList")+"#bz-render-search-list-actions"),e.loadTemplate("searchList.tag",e.getFileTemplate("bizagi.rendering.smartphone.searchList")+"#bz-render-search-list-tag"),e.loadTemplate("searchList.readonly",e.getFileTemplate("bizagi.rendering.smartphone.searchList")+"#bz-render-search-list-readonly"),e.loadTemplate("searchList-modal-header",e.getFileTemplate("bizagi.rendering.smartphone.searchList")+"#bz-render-search-list-modal-header"),e.loadTemplate("letter",e.getFileTemplate("bizagi.rendering.smartphone.letter")),e.loadTemplate("form-error",e.getFileTemplate("bizagi.rendering.smartphone.form-error")),e.loadTemplate("form-waiting",e.getFileTemplate("bizagi.rendering.smartphone.form-waiting")),e.loadTemplate("render-actionLauncher",e.getFileTemplate("bizagi.rendering.smartphone.actionLauncher")+"#bz-rendering-actionLauncher"),e.loadTemplate("render-actionLauncher-horizontal",e.getFileTemplate("bizagi.rendering.smartphone.actionLauncher")+"#bz-rendering-actionLauncher-horizontal"),e.loadTemplate("render-actionLauncher-vertical",e.getFileTemplate("bizagi.rendering.smartphone.actionLauncher")+"#bz-rendering-actionLauncher-vertical"),e.loadTemplate("render-actionLauncher-actions-to-execute",e.getFileTemplate("bizagi.rendering.smartphone.actionLauncher")+"#bz-rendering-actionLauncher-actions-to-execute"),e.loadTemplate("render-actionLauncher-design",e.getFileTemplate("bizagi.rendering.smartphone.actionLauncher")+"#bz-rendering-actionLauncher-design"),e.loadTemplate("render-polymorphicLauncher",e.getFileTemplate("bizagi.rendering.smartphone.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher"),e.loadTemplate("render-polymorphicLauncher-vertical-tree",e.getFileTemplate("bizagi.rendering.smartphone.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree"),e.loadTemplate("render-polymorphicLauncher-vertical-tree-item",e.getFileTemplate("bizagi.rendering.smartphone.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-vertical-tree-item"),e.loadTemplate("render-polymorphicLauncher-actions-to-execute",e.getFileTemplate("bizagi.rendering.smartphone.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-actions-to-execute"),e.loadTemplate("render-polymorphicLauncher-confirm",e.getFileTemplate("bizagi.rendering.smartphone.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-confirm"),e.loadTemplate("render-polymorphicLauncher-design",e.getFileTemplate("bizagi.rendering.smartphone.polymorphicLauncher")+"#bz-rendering-polymorphicLauncher-design"),e.loadTemplate("grid",e.getFileTemplate("bizagi.rendering.smartphone.grid")),e.loadTemplate("cell",e.getFileTemplate("bizagi.rendering.smartphone.cell")),e.loadTemplate("cell.readonly",e.getFileTemplate("bizagi.rendering.smartphone.cell.readonly")),e.loadTemplate("bizagi.grid.grid",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid"),e.loadTemplate("bizagi.grid.totalizer",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-totalizer"),e.loadTemplate("bizagi.grid.waiting",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-waiting"),e.loadTemplate("bizagi.grid.table",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-table"),e.loadTemplate("bizagi.grid.table.empty",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-table-empty"),e.loadTemplate("bizagi.grid.column",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-column"),e.loadTemplate("bizagi.grid.column.special",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-column-special"),e.loadTemplate("bizagi.grid.row",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-row"),e.loadTemplate("bizagi.grid.row.buttons",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-row-buttons"),e.loadTemplate("bizagi.grid.cell",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-cell"),e.loadTemplate("bizagi.grid.cell.special",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-cell-special"),e.loadTemplate("bizagi.grid.pager",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-pager"),e.loadTemplate("bizagi.grid.buttons",e.getFileTemplate("bizagi.rendering.smartphone.bizagi.grid")+"#ui-bizagi-grid-buttons"),e.loadTemplate("render-layout",e.getFileTemplate("bizagi.rendering.smartphone.render.layout")),e.loadTemplate("layout-image",e.getFileTemplate("bizagi.rendering.smartphone.layout.image")+"#ui-bizagi-render-layout-image"),e.loadTemplate("layout-image64",e.getFileTemplate("bizagi.rendering.smartphone.layout.image")+"#ui-bizagi-render-layout-image64"),e.loadTemplate("layout-label",e.getFileTemplate("bizagi.rendering.smartphone.layout.label")),e.loadTemplate("layout-link",e.getFileTemplate("bizagi.rendering.smartphone.layout.link")),e.loadTemplate("layout-text",e.getFileTemplate("bizagi.rendering.smartphone.layout.text")),e.loadTemplate("layout-date-time",e.getFileTemplate("bizagi.rendering.smartphone.layout.dateTime")),e.loadTemplate("layout-money",e.getFileTemplate("bizagi.rendering.smartphone.layout.money")),e.loadTemplate("layout-number",e.getFileTemplate("bizagi.rendering.smartphone.layout.number")),e.loadTemplate("layout-upload",e.getFileTemplate("bizagi.rendering.smartphone.layout.upload"))).done(function(){var i=$.fasttmpl(e.getTemplate("icons"));0===$("head").find("#genome-forms-icons").length&&$("head").append(i),t.resolve()}),t.promise()},getFileTemplate:function(e,t){var i=bizagi.detectDevice();return bizagi.getTemplate(e,t,"desktop"==i?"smartphone_ios":i)},getContainer:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"form"==(t=t.replace(/smartphone/,""))?new bizagi.rendering.smartphone.form(i):"template"==t?new bizagi.rendering.smartphone.formTemplate(i):"queryForm"==t?new bizagi.rendering.smartphone.queryForm(i):"layout"==t?new bizagi.rendering.smartphone.layout(i):"usersForm"==t?new bizagi.rendering.smartphone.usersForm(i):"panel"==t?new bizagi.rendering.smartphone.panel(i):"contentPanel"==t||"contentpanel"==t?new bizagi.rendering.smartphone.contentPanel(i):"nestedForm"==t?new bizagi.rendering.smartphone.nestedForm(i):"tab"==t?new bizagi.rendering.smartphone.tab(i):"tabItem"==t||"tabitem"==t?new bizagi.rendering.smartphone.tabItem(i):"horizontal"==t?new bizagi.rendering.smartphone.horizontal(i):"accordion"==t?new bizagi.rendering.smartphone.accordion(i):"accordionItem"==t?new bizagi.rendering.smartphone.accordionItem(i):"group"==t?new bizagi.rendering.smartphone.group(i):"searchForm"==t?(i.context="search",i.contexttype="metadata",new bizagi.rendering.smartphone.searchForm(i)):"mobileform"==t?new bizagi.rendering.mobileform(i):"mobilegroup"==t?new bizagi.rendering.mobilegroup(i):(bizagi.log(t+" not supported in render factory",e.data,"error"),null)},getColumn:function(e){var t=e.type,i=e.data,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService,singleInstance:!!bizagi.util.isEmpty(e.singleInstance)||e.singleInstance});if("columnText"==(t=t.replace(/smartphone/,""))){var r=bizagi.util.parseBoolean(i.properties.isExtended)||!1;return a.decorated=r?bizagi.rendering.smartphone.extendedText:bizagi.rendering.smartphone.text,new bizagi.rendering.smartphone.columns.text(a)}if("columnSearchList"==t)return a.decorated=bizagi.rendering.smartphone.searchList,new bizagi.rendering.smartphone.columns.searchList(a);if("columnNumber"==t)return a.decorated=bizagi.rendering.smartphone.number,new bizagi.rendering.smartphone.columns.number(a);if("columnMoney"==t)return a.decorated=bizagi.rendering.smartphone.money,new bizagi.rendering.smartphone.columns.number(a);if("columnDate"==t)return a.decorated=bizagi.rendering.smartphone.date,new bizagi.rendering.smartphone.columns.date(a);if("columnBoolean"==t){if("check"==(i.properties.display||"option")){if(a.decorated=bizagi.rendering.smartphone.check,e.data.properties.isExclusive)return new bizagi.rendering.smartphone.columns.exclusiveCheck(a)}else a.decorated=bizagi.rendering.smartphone.yesno;return new bizagi.rendering.smartphone.columns.column(a)}return"columnCombo"==t?(a.decorated=bizagi.rendering.smartphone.combo,new bizagi.rendering.smartphone.columns.combo(a)):"columnRadio"==t?(a.decorated=bizagi.rendering.smartphone.radio,new bizagi.rendering.smartphone.columns.radio(a)):"columnList"==t?(a.decorated=bizagi.rendering.smartphone.list,new bizagi.rendering.smartphone.columns.list(a)):"columnHidden"==t?(a.decorated=bizagi.rendering.smartphone.hidden,new bizagi.rendering.smartphone.columns.column(a)):"columnUpload"==t?(a.decorated=bizagi.rendering.smartphone.upload,new bizagi.rendering.smartphone.columns.upload(a)):"columnImage"==t?(a.decorated=bizagi.rendering.smartphone.image,new bizagi.rendering.smartphone.columns.image(a)):"columnUploadEcm"==t?(a.decorated=bizagi.rendering.smartphone.ecm,new bizagi.rendering.smartphone.columns.uploadecm(a)):"columnLink"==t?(a.decorated=bizagi.rendering.smartphone.link,new bizagi.rendering.smartphone.columns.link(a)):"columnFormLink"==t?(a.decorated=bizagi.rendering.smartphone.formLink,new bizagi.rendering.smartphone.columns.link(a)):"columnUserfield"==t?(a.decorated=bizagi.rendering.smartphone.userfieldWrapper,new bizagi.rendering.smartphone.columns.column(a)):"columnSearch"==t?(a.decorated=bizagi.rendering.smartphone.search,new bizagi.rendering.smartphone.columns.search(a)):"columnLabel"==t?(a.decorated=bizagi.rendering.smartphone.label,new bizagi.rendering.smartphone.columns.column(a)):"columnReadonly"==t?(a.decorated=bizagi.rendering.smartphone.label,new bizagi.rendering.smartphone.columns.readonly(a)):"columnDocument"==t?(a.decorated=bizagi.rendering.smartphone.document,new bizagi.rendering.smartphone.columns.document(a)):"columnButton"==t?(a.decorated=bizagi.rendering.smartphone.button,new bizagi.rendering.smartphone.columns.button(a)):(bizagi.log(t+" not supported in render factory",i,"error"),null)},getRender:function(e){var t=e.type,i=e.data,a=i.properties,r=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService}),n=bizagi.util.isOfflineForm({container:e.parent});return t||(t="label"),"text"==(t=t.replace(/smartphone/,""))?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.smartphone.extendedText(r):new bizagi.rendering.smartphone.text(r):"association"==t?new bizagi.rendering.smartphone.association(r):"label"==t?new bizagi.rendering.smartphone.label(r):"hidden"==t?new bizagi.rendering.smartphone.hidden(r):"number"==t?a&&29===a.dataType?new bizagi.rendering.smartphone.numberScientificNotation(r):new bizagi.rendering.smartphone.number(r):"money"==t?new bizagi.rendering.smartphone.money(r):"date"==t?new bizagi.rendering.smartphone.date(r):"boolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.smartphone.check(r):new bizagi.rendering.smartphone.yesno(r):"combo"==t?new bizagi.rendering.smartphone.combo(r):/^cascadingcombo$/i.test(t)?new bizagi.rendering.smartphone.cascadingCombo(r):"list"==t?new bizagi.rendering.smartphone.list(r):"radio"==t?new bizagi.rendering.smartphone.radio(r):"image"==t?new bizagi.rendering.smartphone.image(r):"uploadecm"==t?new bizagi.rendering.smartphone.ecm(r):"upload"==t?n?new bizagi.rendering.smartphone.upload.offline(r):new bizagi.rendering.smartphone.upload(r):"grid"==t?n?new bizagi.rendering.smartphone.grid.offline(r):new bizagi.rendering.smartphone.grid(r):"groupedgrid"==t?new bizagi.rendering.smartphone.grid(r):"search"==t?new bizagi.rendering.smartphone.search(r):"suggest"==t?(r.data.properties.enableQuerySuggestBehavior=!0,new bizagi.rendering.smartphone.search(r)):"searchList"==t?new bizagi.rendering.smartphone.searchList(r):"multiSelect"==t?new bizagi.rendering.smartphone.multiSelect(r):"button"==t?new bizagi.rendering.smartphone.button(r):"formLink"==t?new bizagi.rendering.smartphone.formLink(r):"link"==t?new bizagi.rendering.smartphone.link(r):"actionLauncher"==t?new bizagi.rendering.smartphone.actionLauncher(r):"entityTemplate"==t?new bizagi.rendering.smartphone.entityTemplate(r):"polymorphicLauncher"==t?new bizagi.rendering.smartphone.polymorphicLauncher(r):"userfield"==t?new bizagi.rendering.smartphone.userfieldWrapper(r):0==t.indexOf("search")?this.getSearchRender(e):"document"==t?new bizagi.rendering.smartphone.document(r):"image"==t?new bizagi.rendering.smartphone.image(r):"fileprint"==t?new bizagi.rendering.smartphone.fileprint(r):"geolocation"==t?new bizagi.rendering.smartphone.geolocation(r):"collectionnavigator"==t?new bizagi.rendering.smartphone.collectionnavigator(r):"activityCheckList"==t?new bizagi.rendering.smartphone.activityCheckList(r):0===t.indexOf("layout")?this.getLayoutRender(e):0===t.indexOf("range")?this.getRangeRender(e):"mobiletext"==t?new bizagi.rendering.smartphone.specific_text(r):"letter"==t?new bizagi.rendering.smartphone.letter(r):this._super(e)},getLayoutRender:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"layoutImage"==(t=t.replace(/smartphone/,""))?new bizagi.rendering.smartphone.layoutImage(i):"layoutLink"==t?new bizagi.rendering.smartphone.layoutLink(i):"layoutLabel"==t?new bizagi.rendering.smartphone.layoutLabel(i):"layoutText"==t?new bizagi.rendering.smartphone.layoutText(i):"layoutDateTime"==t?new bizagi.rendering.smartphone.layoutDateTime(i):"layoutNumber"==t?new bizagi.rendering.smartphone.layoutNumber(i):"layoutMoney"==t?new bizagi.rendering.smartphone.layoutMoney(i):"layoutPlaceholder"==t?new bizagi.rendering.smartphone.layoutPlaceholder(i):"layoutBoolean"==t?new bizagi.rendering.smartphone.layoutBoolean(i):"layoutUpload"==t?new bizagi.rendering.smartphone.layoutUpload(i):this._super(e)},getRangeRender:function(e){var t=e.type,i=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"rangeDate"===(t=t.replace(/smartphone/,""))?new bizagi.rendering.smartphone.rangeDate(i):"rangeMoney"===t?new bizagi.rendering.smartphone.rangeMoney(i):"rangeNumber"===t?new bizagi.rendering.smartphone.rangeNumber(i):(bizagi.log(t+" not supported in render factory",e.data,"error"),null)},getSearchRender:function(e){var t=e.type,i=e.data,a=$.extend(e,{renderFactory:this,dataService:e.dataService||this.dataService});return"searchText"==(t=t.replace(/smartphone/,""))?bizagi.util.parseBoolean(i.properties.isExtended)||!1?new bizagi.rendering.smartphone.extendedText(a):new bizagi.rendering.smartphone.text(a):"searchBoolean"==t?"check"==(i.properties.display||"option")?new bizagi.rendering.smartphone.check(a):new bizagi.rendering.smartphone.yesno(a):"searchNumber"==t?29==i.properties.dataType?new bizagi.rendering.smartphone.numberScientificNotation(a):new bizagi.rendering.smartphone.number(a):"searchMoney"==t?new bizagi.rendering.smartphone.money(a):"searchDate"==t?new bizagi.rendering.smartphone.date(a):"searchCombo"==t?new bizagi.rendering.smartphone.combo(a):"searchSuggest"==t?new bizagi.rendering.smartphone.search(a):"searchLabel"==t?new bizagi.rendering.smartphone.label(a):(bizagi.log(t+" not supported in render factory",i,"error"),null)}});
//# sourceMappingURL=../../../../Maps/smartphone_ios/forms.smartphone.production.js.map
